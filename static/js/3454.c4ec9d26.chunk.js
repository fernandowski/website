"use strict";(self.webpackChunkpersonal_website=self.webpackChunkpersonal_website||[]).push([[3454],{29201:(e,t,n)=>{n.d(t,{I:()=>y,b:()=>v});var i=n(34981),r=n(26917),s=n(59395),o=n(81993),a=n(90235),l=n(80883),c=n(3799),u=n(21390),d=n(64839),h=n(32307),p=n(70367),f=n(10773),g=n(66470);function v(e){const t=new h.N5,{vertex:n,fragment:v}=t;return(0,c.NB)(n,e),t.include(s.d,e),t.attributes.add(g.r.POSITION,"vec3"),t.attributes.add(g.r.UV0,"vec2"),e.perspectiveInterpolation&&t.attributes.add(g.r.PERSPECTIVEDIVIDE,"float"),t.varyings.add("vpos","vec3"),e.multipassEnabled&&t.varyings.add("depth","float"),n.code.add(d.H`
    void main(void) {
      vpos = position;
      ${e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0;
      gl_Position = transformPosition(proj, view, vpos);

      ${e.perspectiveInterpolation?"gl_Position *= perspectiveDivide;":""}
    }
  `),t.include(r.HQ,e),t.include(o.Q,e),v.uniforms.add(new p.N("tex",(e=>e.texture)),new u.m("opacity",(e=>e.opacity))),t.varyings.add("vTexCoord","vec2"),e.transparencyPassType===f.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),v.include(l.a),v.code.add(d.H`
    void main() {
      discardBySlice(vpos);
      ${e.multipassEnabled?"terrainDepthTest(depth);":""}
      fragColor = texture(tex, vTexCoord) * opacity;

      if (fragColor.a < ${d.H.float(a.H)}) {
        discard;
      }

      fragColor = highlightSlice(fragColor, vpos);
      ${e.transparencyPassType===f.y.ColorAlpha?d.H`
              fragColor = premultiplyAlpha(fragColor);
              fragAlpha = fragColor.a;`:""}
      ${e.output===i.V.ObjectAndLayerIdColor?d.H`
              fragColor = vec4(0,0,0,1);`:""}
    }
    `),t}const y=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},46530:(e,t,n)=>{function i(e){const t=e.layer;return"floorInfo"in t&&t.floorInfo?.floorField&&"floors"in e.view?s(e.view.floors,t.floorInfo.floorField):null}function r(e,t){return"floorInfo"in t&&t.floorInfo?.floorField?s(e,t.floorInfo.floorField):null}function s(e,t){if(!e?.length)return null;const n=e.filter((e=>""!==e)).map((e=>`'${e}'`));return n.push("''"),`${t} IN (${n.join(",")}) OR ${t} IS NULL`}n.d(t,{E:()=>i,f:()=>r})},77447:(e,t,n)=>{n.d(t,{r:()=>A});var i=n(88105),r=n(34981),s=n(83490),o=n(75803),a=n(45463),l=n(60322),c=n(77730),u=n(86994),d=n(66470),h=n(82809),p=n(86401),f=n(63928),g=n(52757),v=n(35143),y=(n(64839),n(16506)),_=n(42693),m=n(99415),E=n(28584),w=n(96643),S=n(10773),x=n(92656),b=n(29201),L=n(93345),T=n(57162);class M extends _.w{initializeProgram(e){return new E.B(e.rctx,M.shader.get().build(this.configuration),N)}_setPipelineState(e,t){const n=this.configuration,i=e===S.y.NONE,s=e===S.y.FrontFace;return(0,T.Ey)({blending:n.output===r.V.Color&&n.transparent?i?P:(0,l.ez)(e):null,culling:(0,T.Xt)(n.cullFace),depthTest:{func:(0,l.K_)(e)},depthWrite:i?n.writeDepth?T.kn:null:(0,l.XO)(e),drawBuffers:(0,l.cl)(e),colorWrite:T.wE,stencilWrite:n.hasOccludees?w.v0:null,stencilTest:n.hasOccludees?t?w.a9:w.qh:null,polygonOffset:i||s?null:(0,l.aB)(n.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}M.shader=new y.$(b.I,(()=>n.e(8391).then(n.bind(n,48391))));const P=(0,T.ox)(L.dn.ONE,L.dn.ONE_MINUS_SRC_ALPHA);class R extends x.E{constructor(){super(...arguments),this.output=r.V.Color,this.cullFace=s.s2.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=S.y.NONE,this.multipassEnabled=!1,this.cullAboveGround=!1,this.perspectiveInterpolation=!0}}(0,v._)([(0,m.W)({count:r.V.COUNT})],R.prototype,"output",void 0),(0,v._)([(0,m.W)({count:s.s2.COUNT})],R.prototype,"cullFace",void 0),(0,v._)([(0,m.W)()],R.prototype,"hasSlicePlane",void 0),(0,v._)([(0,m.W)()],R.prototype,"transparent",void 0),(0,v._)([(0,m.W)()],R.prototype,"enableOffset",void 0),(0,v._)([(0,m.W)()],R.prototype,"writeDepth",void 0),(0,v._)([(0,m.W)()],R.prototype,"hasOccludees",void 0),(0,v._)([(0,m.W)({count:S.y.COUNT})],R.prototype,"transparencyPassType",void 0),(0,v._)([(0,m.W)()],R.prototype,"multipassEnabled",void 0),(0,v._)([(0,m.W)()],R.prototype,"cullAboveGround",void 0),(0,v._)([(0,m.W)()],R.prototype,"perspectiveInterpolation",void 0),(0,v._)([(0,m.W)({constValue:!1})],R.prototype,"occlusionPass",void 0);const N=new Map([[d.r.POSITION,0],[d.r.UV0,2],[d.r.PERSPECTIVEDIVIDE,3]]);class A extends f.W{constructor(e){super(e,new C),this.supportsEdges=!0,this.produces=new Map([[c.N.OPAQUE_MATERIAL,e=>(0,r.u5)(e)||(0,r._o)(e)&&!this.parameters.transparent],[c.N.TRANSPARENT_MATERIAL,e=>(0,r._o)(e)&&this.parameters.transparent&&this.parameters.writeDepth],[c.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>(0,r._o)(e)&&this.parameters.transparent&&!this.parameters.writeDepth],[c.N.DRAPED_MATERIAL,e=>(0,r._o)(e)||(0,r.u5)(e)]]),this._vertexAttributeLocations=N,this._configuration=new R}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<l.xt,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}createGLMaterial(e){return new F(e)}createBufferWriter(){const e=p.zK.clone();return this.parameters.perspectiveInterpolation&&e.f32(d.r.PERSPECTIVEDIVIDE),new I(e)}}class F extends o.m{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(M,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output===r.V.Color&&this._updateOccludeeState(e),this._updateParameters(e)}}class I extends h.Z{write(e,t,n,r,s){for(const o of this.vertexBufferLayout.fields.keys()){const a=n.attributes.get(o);if(a)if(o===d.r.PERSPECTIVEDIVIDE){(0,u.vA)(1===a.size);const e=r.getField(o,i.Y$);e&&(0,g.uO)(a,e,s)}else(0,g.zC)(o,a,e,t,r,s)}}}class C extends a.qA{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=s.s2.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0,this.perspectiveInterpolation=!1}}},82307:(e,t,n)=>{n.d(t,{NE:()=>l,TU:()=>d,ac:()=>u,fn:()=>c,oe:()=>h});var i=n(18690),r=n(54901),s=n(87663),o=n(57308),a=n(41036);const l={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},c={toggle:"Control"},u={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},d={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:a.i,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},undo:"z",redo:"r"};class h{constructor(){this._bindings=new Map}add(e,t){return this.addToggle(e,(e=>{"key-down"===e.type&&t(e)}))}addToggle(e,t){const n=p.fromDefinition(e,t),o=(0,s.tE)(this._bindings,n.key,(()=>[]));return o.push(n),(0,r.hA)((()=>(0,i.TF)(o,n)))}register(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.o.WIDGET;return(0,r.vE)([e.on("key-down",(t=>this.dispatch(e.inputManager,t)),t),e.on("key-up",(t=>this.dispatch(e.inputManager,t)),t)])}dispatch(e,t){const n=t.key,i=this._bindings.get(n);if(i)for(const r of i)r.process(e,t)}}class p{constructor(e,t,n,i,r){this.key=e,this.modifiers=t,this.repeats=n,this.continuePropagation=i,this.callback=r}process(e,t){if(!(t.key!==this.key||"repeat"in t&&t.repeat&&!this.repeats)){for(const t of this.modifiers)if(!e.isModifierKeyDown(t))return;this.continuePropagation||t.stopPropagation(),this.callback(t)}}static fromDefinition(e,t){if("string"==typeof e)return new p(e,[],!1,!1,t);const{key:n,modifier:i,repeats:r,continuePropagation:s}=e;return new p(n,i?Array.isArray(i)?i:[i]:[],!!r,!!s,t)}}},75543:(e,t,n)=>{n.d(t,{FX:()=>O,Mn:()=>S,QT:()=>H,WG:()=>Z,ej:()=>L,en:()=>D,fT:()=>se,i7:()=>E,jf:()=>j,qR:()=>N,xW:()=>ie});var i=n(18690),r=n(15941),s=n(19555),o=n(72745),a=n(20664),l=n(9392),c=n(43047),u=n(55855),d=n(63885),h=n(7137),p=n(13927),f=n(93582),g=n(94966),v=n(23862),y=n(79337),_=n(74050);class m{intersect(e){return W(this,e)}closestPoints(e){return[this.closestTo(e)]}}class E extends m{constructor(e){super(),this.point=e}equals(e){return this===e||se(e)&&(0,a.e)(this.point,e.point)}closestTo(){return(0,v.o8)(this.point)}}class w extends m{constructor(e,t,n){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:n}}equals(e){return this===e||oe(e)&&this.lineLike.type===e.lineLike.type&&(0,a.e)(this.start,e.start)&&(0,a.e)(this.end,e.end)}closestTo(e){const t=(0,v.Hh)();return(0,y.Yv)(e,this.lineLike,t),t}}class S extends w{constructor(e,t){super(e,t,_.Vv.LINE)}}class x extends w{constructor(e,t){super(e,t,_.Vv.RAY)}}class b extends m{constructor(e){super(),this.constraints=e}equals(e){return this===e||re(e)&&(0,i.aI)(this.constraints,e.constraints,((e,t)=>e.equals(t)))}closestTo(e){let t,n=1/0;for(const i of this.constraints){const r=i.closestTo(e),s=(0,a.a)(e,r);s<n&&(n=s,t=r)}return(0,v.o8)(t??e)}closestPoints(e){return this.constraints.flatMap((t=>t===this?[]:t.closestPoints(e)))}}class L extends m{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ce(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=(0,v.Hh)();return(0,y.Nm)(e,this.center,this.radius,t),t}}class T extends m{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ue(e)&&(0,a.e)(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=(0,v.Hh)();return(0,y.Nm)(e,this.center,this.radius,t),t[2]=this.center[2],t}asCircle(){return new M((0,v.o8)(this.center),this.radius,(0,v.fA)(0,0,1))}}class M extends m{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;super(),this.center=e,this.radius=t,this.normal=n,this.slicePlane=i}equals(e){return this===e||de(e)&&(0,a.e)(this.center,e.center)&&(0,a.e)(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:n}=this;(0,p._I)(this.getPlane(R),e,P);const i=(0,a.z)(P,P,t),r=(0,a.q)(i);if((0,y.Zj)(r,0))return(0,v.o8)(e);const s=n/Math.sqrt(r),o=(0,v.Hh)();(0,a.r)(o,t,i,s);const{slicePlane:l}=this;if(l&&!(0,y.F2)(l,o)){const t=U(l,this);return t?.closestTo(e)??(0,v.o8)(e)}return o}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,p.vt)();return(0,p.O_)(this.center,this.normal,e)}}const P=(0,l.vt)(),R=(0,p.vt)();class N extends m{constructor(e){super(),this.z=e}equals(e){return this===e||ae(e)&&this.z===e.z}closestTo(e){return(0,v.fA)(e[0],e[1],this.z)}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,p.vt)();return(0,a.s)(A,0,0,this.z),(0,p.O_)(A,l.Cb,e)}}const A=(0,l.vt)();class F extends m{constructor(e,t,n){super(),this.start=e,this.end=t,this.planeLike={start:(0,v.Xz)(e),end:(0,v.Xz)(t),type:n}}equals(e){return this===e||le(e)&&this.planeLike.type===e.planeLike.type&&(0,a.e)(this.start,e.start)&&(0,a.e)(this.end,e.end)}closestTo(e){const t=(0,v.Hh)();return(0,y.r2)(e,this.planeLike,t),t}closestEndTo(e){const{start:t,end:n}=this.planeLike;return Math.sign((0,s.Om)((0,s.Re)(I,n,t),(0,s.Re)(C,(0,v.Xz)(e),t)))>0?this.end:this.start}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,p.vt)();const t=(0,a.c)(V,this.end);return t[2]+=1,(0,p.Cr)(this.start,this.end,t,e)}getSlicePlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,p.vt)();const{start:t,end:n,type:i}=this.planeLike;if(i===y.pJ.PLANE)return;const r=(0,a.s)(V,t[0],t[1],0),s=(0,a.s)(z,n[0],n[1],0),o=(0,a.f)(z,s,r);return(0,p.O_)(r,o,e),e}}const I=(0,o.vt)(),C=(0,o.vt)(),V=(0,l.vt)(),z=(0,l.vt)();class O extends F{constructor(e,t){super(e,t,y.pJ.HALF_PLANE)}}class Z extends F{constructor(e,t){super(e,t,y.pJ.PLANE)}}class q extends m{constructor(e,t){super(),this.sphere=(0,f.k)(e,t)}equals(e){return this===e||he(e)&&(0,f.l)(this.sphere,e.sphere)}closestTo(e){const t=(0,v.Hh)();return(0,f.p)(this.sphere,e,t),t}get center(){return(0,f.g)(this.sphere)}get radius(){return this.sphere[3]}}class D extends m{constructor(e,t,n){super(),this.start=e,this.end=t,this.getZ=n,this.planeLike={start:(0,v.Xz)(e),end:(0,v.Xz)(t),type:y.pJ.PLANE}}equals(e){return this===e||pe(e)&&(0,a.e)(this.start,e.start)&&(0,a.e)(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return function(e,t){const n=(0,v.Hh)();return(0,y.r2)(t,e.planeLike,n),n[2]=e.getZ(n[0],n[1])??fe,n}(this,e)}addIfOnTheGround(e,t){for(const n of t){const t=this.getZ(n[0],n[1])??0;(0,y.Zj)(n[2],t)&&(n[2]=t,e.push(n))}}}class H extends m{constructor(e,t,n){super(),this._x=e,this._y=t,this._z=n}equals(e){return this===e||function(e){return e instanceof H}(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo(e){let[t,n,i]=e;return(0,v.vt)(this._x??t,this._y??n,this._z??i)}}class j extends m{constructor(e,t,n,i,r){super(),this._origin=e,this._spatialReference=t,this._distanceMeters=n,this._elevationMeters=i,this._directionDegrees=r}equals(e){return this===e||function(e){return e instanceof j}(e)&&(0,s.t2)(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._elevationMeters===e._elevationMeters&&this._directionDegrees===e._directionDegrees}closestTo(e){let[t,n,i]=e;return(0,s.hZ)(k,t,n),(0,s.t2)(k,this._origin)||this._applyDirectionAndDistance(k),(0,v.vt)(k[0],k[1],this._elevationMeters??i)}_applyDirectionAndDistance(e){if(null!=this._directionDegrees&&null!=this._distanceMeters)(0,h.vN)(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(null!=this._directionDegrees)!function(e,t,n,i,r){let{azimuth:s,distance:o}=(0,h._3)(G,t,i,r);s??=0;let a=o*Math.cos((s-n)*d.eh);a=Math.max(0,a),(0,h.vN)(e,t,n,a,r)}(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(null!=this._distanceMeters){const{azimuth:t}=(0,h._3)(X,this._origin,e,this._spatialReference);(0,h.vN)(e,this._origin,t??0,this._distanceMeters,this._spatialReference)}}}const k=[0,0],X=new h.Zj;const G=new h.Zj;function W(e,t){if(re(e)){const n=[];for(const i of e.constraints){const e=i.intersect(t);e&&n.push(e)}return ie(n)}if(re(t))return W(t,e);if(pe(e))return K(e,t);if(pe(t))return K(t,e);if(se(e)){const{point:n}=e;if(se(t))return(0,a.e)(n,t.point)?e:void 0;const i=t.closestTo(n);return(0,a.G)(i,n)?e:void 0}if(oe(e)){if(se(t))return W(t,e);if(oe(t))return te((0,y.SO)(e.lineLike,t.lineLike));if(ae(t))return B(e,t);if(le(t))return te((0,y.Mc)(t.planeLike,e.lineLike));if(ce(t))return te((0,y.K4)(e.lineLike,t.center,t.radius));if(de(t))return te((0,y.IB)(e.lineLike,t));if(ue(t))return function(e,t){let{lineLike:n}=e,{center:i,radius:r}=t;const s=i[2];return te((0,y.K4)(n,i,r).filter((e=>(0,y.Zj)(e[2],s))))}(e,t);if(he(t))return function(e,t){let{lineLike:n}=e,{sphere:i}=t;return te((0,f.m)(i,n.start,n.end))}(e,t)}else if(ae(e)){if(se(t)||oe(t))return W(t,e);if(ae(t))return function(e,t){return(0,y.Zj)(e.z,t.z)?e:void 0}(e,t);if(le(t))return function(e,t){let{z:n}=e,{planeLike:i}=t;const[r,s]=i.start,[o,a]=i.end,l=(0,v.fA)(r,s,n),c=(0,v.fA)(o,a,n);return i.type===y.pJ.PLANE?new S(l,c):new x(l,c)}(e,t);if(ce(t))return function(e,t){const[n,i]=t.center;return new T((0,v.fA)(n,i,e.z),t.radius)}(e,t);if(de(t))return $(e,t);if(ue(t))return function(e,t){return(0,y.Zj)(t.center[2],e.z)?t:void 0}(e,t);if(he(t))return function(e,t){let{center:n,radius:i}=t;const r=Math.abs(n[2]-e.z);if(r>i&&!(0,y.Zj)(r,i))return;const s=(0,v.fA)(n[0],n[1],e.z),o=Math.sqrt(i**2-r**2);return(0,y.Zj)(o,0)?void 0:new T(s,o)}(e,t)}else if(le(e)){if(se(t)||oe(t)||ae(t))return W(t,e);if(le(t))return ee((0,y.b_)(e.planeLike,t.planeLike));if(ce(t))return ee((0,y.Bn)(e.planeLike,t.center,t.radius));if(de(t))return J(e,t);if(ue(t))return Y(e,t);if(he(t))return Q(e,t)}else if(ce(e)){if(se(t)||oe(t)||ae(t)||le(t))return W(t,e);if(ce(t))return ee((0,y.t1)((0,v.Xz)(e.center),e.radius,(0,v.Xz)(t.center),t.radius));if(de(t))return;if(ue(t))return function(e,t){const n=(0,s.hG)((0,v.Xz)(e.center),(0,v.Xz)(t.center));return(0,y.Zj)(n,0)&&(0,y.Zj)(e.radius,t.radius)?t:ne((0,y.t1)((0,v.Xz)(e.center),e.radius,(0,v.Xz)(t.center),t.radius),t.center[2])}(e,t);if(he(t))return}else if(de(e)){if(se(t)||oe(t)||ae(t)||le(t)||ce(t))return W(t,e);if(de(t))return;if(ue(t))return void t.asCircle();if(he(t))return}else if(ue(e)){if(se(t)||oe(t)||ae(t)||le(t)||ce(t)||de(t))return W(t,e);if(ue(t))return function(e,t){if(!(0,y.HG)(e.center,t.center))return;const n=(0,s.hG)((0,v.Xz)(e.center),(0,v.Xz)(t.center));return(0,y.Zj)(n,0)&&(0,y.Zj)(e.radius,t.radius)?e:ne((0,y.t1)((0,v.Xz)(e.center),e.radius,(0,v.Xz)(t.center),t.radius),e.center[2])}(t,e);if(he(t))return}else if(he(e)){if(se(t)||oe(t)||ae(t)||le(t)||ce(t)||ue(t))return W(t,e);if(he(t))return}}const B=(()=>{const e=(0,p.vt)();return(t,n)=>{const{start:i,end:r}=t;if((0,y.HG)(i,r)&&(0,y.Zj)(i[2],n.z))return t;const s=(0,v.Hh)();return(0,p.U5)(n.getPlane(e),i,r,s)?new E(s):void 0}})();const U=(()=>{const e=(0,u.vt)(),t=(0,l.vt)(),n=(0,l.vt)();return(i,s,o)=>{const{normal:u,center:d,radius:h}=s;(0,g.VV)(u,t,n);const f=(0,p.Qj)(i),_=h*(0,a.m)(f,t),m=h*(0,a.m)(f,n);(0,c.s)(e,d[0],d[1],d[2],1);const w=(0,c.g)(i,e),S=Math.hypot(_,m),x=(0,y.Zj)(S,0);if((0,y.Zj)((0,p.Io)(i,d),0)){if(x)return s;if((0,y.Zj)(h,0))return!o||(0,y.F2)(o,d)?new E((0,v.o8)(d)):void 0;(0,a.b)(t,f,u),(0,a.n)(t,t);const e=new Array,n=(0,l.o8)(d);(0,a.r)(n,n,t,h),o&&!(0,y.F2)(o,n)||e.push(n);const i=(0,l.o8)(d);return(0,a.r)(i,i,t,-h),o&&!(0,y.F2)(o,i)||e.push(i),te(e)}if(x)return;const b=-w/S;if(Math.abs(b)>1||(0,y.Zj)(b,1))return;const L=Math.atan(_/m),T=(0,r.YN)(b)-L,M=Math.PI-T,P=new Array,R=(0,l.vt)();(0,a.r)(R,d,t,h*Math.cos(T)),(0,a.r)(R,R,n,h*Math.sin(T)),P.push(R);const N=(0,l.vt)();return(0,a.r)(N,d,t,h*Math.cos(M)),(0,a.r)(N,N,n,h*Math.sin(M)),P.push(N),te(o?(0,y.UL)(o,P):P)}})();const $=(()=>{const e=(0,p.vt)();return(t,n)=>U(t.getPlane(e),n,n.slicePlane)})();const Y=(()=>{const e=(0,p.vt)();return(t,n)=>{let{center:i,radius:r}=n;const s=(0,y.Bn)(t.planeLike,i,r),o=i[2];t.getSlicePlane(e);const a=new Array;for(const[l,c]of s){const t=[l,c,o];(0,y.F2)(e,t)&&a.push(t)}return te(a)}})(),J=(()=>{const e=(0,p.vt)(),t=(0,p.vt)();return(n,i)=>U(n.getPlane(e),i,n.getSlicePlane(t))})(),Q=(()=>{const e=(0,p.vt)();return(t,n)=>{let{center:i,radius:r}=n;const s=t.getPlane(e),o=(0,p.mN)(s,i),c=Math.abs(o);if(c>r&&!(0,y.Zj)(c,r))return;const u=Math.sqrt(r**2-o**2);if((0,y.Zj)(u,0)){const e=(0,v.Hh)();return(0,p._I)(s,i,e),new E(e)}const d=(0,v.Hh)(),h=(0,l.o8)((0,p.Qj)(s));return(0,a.r)(d,i,h,o),new M(d,u,h,t.getSlicePlane())}})();function K(e,t){const{planeLike:n,getZ:i}=e,r=new Array;if(se(t))e.addIfOnTheGround(r,(0,y.VT)(n,t.point));else if(oe(t))e.addIfOnTheGround(r,(0,y.Mc)(n,t.lineLike));else if(ce(t))for(const[s,o]of(0,y.Bn)(n,t.center,t.radius)){const e=i(s,o);null!=e&&r.push((0,l.fA)(s,o,e))}else if(le(t)||pe(t))for(const[s,o]of(0,y.b_)(n,t.planeLike)){const e=i(s,o)??fe;r.push((0,l.fA)(s,o,e))}return te(r)}function ee(e){return ie(e.map((e=>{let[t,n]=e;const i=(0,v.fA)(t,n,0),r=(0,v.fA)(t,n,1);return new S(i,r)})))}function te(e){return ie(e.map((e=>e?new E((0,v._7)(e)):void 0)))}function ne(e,t){return te(e.map((e=>{let[n,i]=e;return[n,i,t]})))}function ie(e){if(0!==e.length)return 1===e.length?e[0]??void 0:new b(e.filter(i.Ru))}function re(e){return e instanceof b}function se(e){return e instanceof E}function oe(e){return e instanceof w}function ae(e){return e instanceof N}function le(e){return e instanceof F}function ce(e){return e instanceof L}function ue(e){return e instanceof T}function de(e){return e instanceof M}function he(e){return e instanceof q}function pe(e){return e instanceof D}const fe=0},23862:(e,t,n)=>{n.d(t,{Ex:()=>f,FH:()=>m,Hh:()=>l,Lp:()=>g,Xz:()=>u,_7:()=>c,de:()=>p,fA:()=>d,io:()=>y,o8:()=>h,vf:()=>v,vt:()=>a,xF:()=>_});var i,r=n(9392),s=n(18117),o=n(12482);function a(e,t,n){return l(e,t,n)}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,r.fA)(e,t,n)}function c(e){return e}function u(e){return e}function d(e,t,n){return(0,r.fA)(e,t,n)}function h(e){const[t,n,i]=e;return e.length>3?[t,n,i,e[3]]:[t,n,i]}function p(e){return e[3]=((e.length>3?e[3]:void 0)??i.NONE)|i.TARGET,e}function f(e){return Boolean(((e.length>3?e[3]:void 0)??i.NONE)&i.TARGET)}function g(e,t,n,i){let{coordinateHelper:r,elevationInfo:s}=n;return e?v(r.vectorToDehydratedPoint(e,E),t,s,i):null}function v(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l();return i[0]=e.x,i[1]=e.y,i[2]=e.z??0,null==t||("2d"===t.type?i[2]=0:i[2]=(0,o.wS)(t,e,n,o.qt)??0),i}function y(e,t,n){return n?((0,s.J)(n,e[0],e[1],e[2],t),n):(0,s.T)(e[0],e[1],e[2],t)}function _(e,t,n,i,r){let{z:a,m:l}=n;const{spatialReference:c,elevationInfo:u}=i;let d;d=null==a&&null==l?void 0:null==t||"2d"===t.type?a??void 0:(0,o.xS)(t,e,c,o.qt,u)??0;const[h,p]=e;return r?(0,s.J)(r,h,p,d,c):r=(0,s.T)(h,p,d,c),null!=l&&(r.m=l,r.hasM=!0),r}function m(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l();const[a,c]=e;return s[0]=a,s[1]=c,e.length>3&&(s[3]=e[3]??i.NONE),"3d"!==n?.type?(s[2]=t.value,s):(s[2]=(0,o.Fo)(n,a,c,t.value,r,t.elevationInfo,o.qt)??0,s)}!function(e){e[e.NONE=0]="NONE",e[e.TARGET=1]="TARGET"}(i||(i={}));const E=(0,s.T)(0,0,0,null)},63078:(e,t,n)=>{n.d(t,{N:()=>u});var i=n(35143),r=n(69539),s=n(42553),o=n(46053),a=n(85842);let l=class extends s.oY{constructor(){super(...arguments),this.enabled=!0}};(0,i._)([(0,o.MZ)({type:Boolean})],l.prototype,"enabled",void 0),l=(0,i._)([(0,a.$)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],l);let c=class extends s.oY{constructor(e){super(e),this.lineSnapper=new l,this.parallelLineSnapper=new l,this.rightAngleSnapper=new l,this.rightAngleTriangleSnapper=new l,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new r.A([255,127,0]),this.orangeTransparent=new r.A([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"lineSnapper",void 0),(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"parallelLineSnapper",void 0),(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleSnapper",void 0),(0,i._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleTriangleSnapper",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"shortLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"distance",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"intersectionParallelLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"parallelLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"verticalLineThresholdMeters",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"touchSensitivityMultiplier",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointOnLineThreshold",void 0),(0,i._)([(0,o.MZ)({type:r.A,nonNullable:!0})],c.prototype,"orange",void 0),(0,i._)([(0,o.MZ)({type:r.A,nonNullable:!0})],c.prototype,"orangeTransparent",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthReference",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthTarget",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"lineHintFadedExtensions",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"parallelLineHintWidth",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],c.prototype,"parallelLineHintLength",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],c.prototype,"parallelLineHintOffset",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],c.prototype,"rightAngleHintSize",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],c.prototype,"rightAngleHintOutlineSize",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],c.prototype,"satisfiesConstraintScreenThreshold",void 0),c=(0,i._)([(0,a.$)("esri.views.interactive.snapping.Settings.Defaults")],c);const u=new c},99791:(e,t,n)=>{var i;n.d(t,{n:()=>i}),function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"}(i||(i={}))},45660:(e,t,n)=>{n.d(t,{X:()=>Ce});var i=n(54901),r=n(77944),s=n(19276),o=n(68134),a=n(35143),l=n(91967),c=n(46053),u=(n(81806),n(76460)),d=(n(47249),n(85842));let h=class extends l.A{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new s.A}};(0,a._)([(0,c.MZ)({constructOnly:!0})],h.prototype,"layer",void 0),(0,a._)([(0,c.MZ)()],h.prototype,"enabled",void 0),(0,a._)([(0,c.MZ)()],h.prototype,"updating",void 0),(0,a._)([(0,c.MZ)()],h.prototype,"availability",void 0),(0,a._)([(0,c.MZ)()],h.prototype,"sublayerSources",void 0),h=(0,a._)([(0,d.$)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],h);const p=h;var f=n(63078),g=n(18690);let v=class extends l.A{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.attributeRulesEnabled=!1,this.featureSources=new s.A,this.distance=f.N.distance,this.touchSensitivityMultiplier=f.N.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(_)&&u.A.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(E),n=this._get("_effectiveFeatureSources")?.filter(_)??new s.A;for(const s of t){const e=n.find((e=>e.layer===s.layer.parent));if(e)e.sublayerSources.includes(s)||e.sublayerSources.add(s);else if(s.layer.parent){const e=new p({layer:s.layer.parent});e.sublayerSources.add(s),n.add(e)}}for(const s of n){const e=s.sublayerSources.filter((e=>!t.includes(e)));s.sublayerSources.removeMany(e)}n.removeMany(n.filter((e=>0===e.sublayerSources.length)));const i=e.filter(m),r=this._get("_effectiveFeatureSources")??new s.A,{added:o,removed:a}=(0,g.iv)(r.toArray(),[...i,...n]);return r.removeMany(a),r.addMany(o),r}};(0,a._)([(0,c.MZ)()],v.prototype,"enabled",void 0),(0,a._)([(0,c.MZ)()],v.prototype,"enabledToggled",void 0),(0,a._)([(0,c.MZ)()],v.prototype,"forceDisabled",void 0),(0,a._)([(0,c.MZ)()],v.prototype,"selfEnabled",void 0),(0,a._)([(0,c.MZ)()],v.prototype,"featureEnabled",void 0),(0,a._)([(0,c.MZ)()],v.prototype,"attributeRulesEnabled",void 0),(0,a._)([(0,c.MZ)({type:s.A.ofType(p)})],v.prototype,"featureSources",void 0),(0,a._)([(0,c.MZ)()],v.prototype,"distance",void 0),(0,a._)([(0,c.MZ)()],v.prototype,"touchSensitivityMultiplier",void 0),(0,a._)([(0,c.MZ)({readOnly:!0})],v.prototype,"effectiveEnabled",null),(0,a._)([(0,c.MZ)({readOnly:!0})],v.prototype,"effectiveSelfEnabled",null),(0,a._)([(0,c.MZ)({readOnly:!0})],v.prototype,"effectiveFeatureEnabled",null),(0,a._)([(0,c.MZ)({readOnly:!0})],v.prototype,"_effectiveFeatureSources",null),v=(0,a._)([(0,d.$)("esri.views.interactive.snapping.SnappingOptions")],v);const y=v;function _(e){return"subtype-group"===e.layer.type}function m(e){return"subtype-group"!==e.layer.type}function E(e){return"subtype-sublayer"===e.layer.type}var w=n(50346),S=n(31633),x=n(19555),b=n(20664),L=n(9392),T=n(53494),M=n(19451),P=n(12482),R=n(75543),N=n(23862),A=n(34154),F=n(8203),I=n(46530),C=n(31933),V=n(9730),z=n(90992);let O=class extends l.A{set attributeRulesEnabled(e){this._set("attributeRulesEnabled",e),e&&this.loadRules()}get layerView(){return this.view?.allLayerViews?.find((e=>e.layer===this.layer))}get valid(){const{_valid:e,snappingSource:t,layer:n}=this;return!(!t||!n)&&e}get subtypeFilter(){const{layer:e,snappingSource:t}=this;if(!(0,C.F2)(e)||!e.subtypes?.length||!t)return{mode:"not-in-use",filter:null};const n=t.layerSource.sublayerSources.filter((e=>e.enabled&&e.layer.visible&&(0,z.JU)(this.view?.scale,e.layer.effectiveScaleRange.minScale,e.layer.effectiveScaleRange.maxScale))).map((e=>e.layer.subtypeCode));if(!n.length)return{mode:"none-visible",filter:null};if(n.length===e.subtypes.length)return{mode:"all-visible",filter:null};const i=e.fieldsIndex.get(e.subtypeField)?.name??e.subtypeField;return 1===n.length?{mode:"in-use",filter:`${i} = ${n.getItemAt(0)}`}:{mode:"in-use",filter:`${i} IN (${n.join(", ")})`}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?(0,I.E)({view:e,layer:t}):null}constructor(e){super(e),this.layer=null,this.snappingSource=null,this.rulesTable=null,this._valid=null}initialize(){if(!this.snappingSource||!this.layer)return void(this._valid=!1);const{layer:e,snappingSource:t}=this;if("refresh"in e){const n=e;this.addHandles(n.on("refresh",(()=>t.refresh())))}this.loadRules(),this.addHandles([(0,o.wB)((()=>t.updating),(e=>t.layerSource.updating=e),o.pc),(0,o.wB)((()=>t.availability),(e=>t.layerSource.availability=e),o.pc)])}getFetchCandidatesParameters(e,t,n){if(!this.valid)return[];const{layer:i,layerView:r,floorFilter:s,rulesTable:o,subtypeFilter:a}=this,l={distance:n,mode:this.view?.type??"2d",point:e,coordinateHelper:t.coordinateHelper,returnEdge:!0,vertexMode:"all",filter:r&&"filter"in r?r.filter:null};if(s&&(l.filter=Z(l.filter,s)),"not-in-use"!==a.mode&&"all-visible"!==a.mode){if("none-visible"===a.mode)return[];l.filter?l.filter.where=(0,A.m)(l.filter.where,a.mode):l.filter=new F.A({where:a.filter})}if(!this.attributeRulesEnabled)return[l];const c=t.feature,u="subtype-sublayer"===c?.sourceLayer?.type?c.sourceLayer.parent:c?.sourceLayer;if(o&&c&&(0,V.Tu)(this.view?.map)&&((0,C.yZ)(i)||(0,C.F2)(i))&&i.layerId&&((0,C.yZ)(u)||(0,C.F2)(u))&&this.view.map.utilityNetworks?.find((e=>e.isUtilityLayer(u)))){if("loaded"!==o.loadStatus)return[];const e=[],t=i.layerId,n=o.getFeatureSQL(u,c)?.[t];if(!n)return[];const r=n.anyVertex;let s=n.endVertex;return s&&r&&s===r&&(s=""),s&&e.push({...l,returnEdge:!1,vertexMode:"ends",filter:Z(l.filter,s)}),r&&e.push({...l,returnEdge:!1,vertexMode:"all",filter:Z(l.filter,r)}),e}return[l]}async loadRules(){this._valid=null;const{layer:e,view:t,attributeRulesEnabled:n}=this;if(n&&e&&t&&(0,V.Tu)(t?.map)&&((0,C.yZ)(e)||(0,C.F2)(e)))try{await Promise.allSettled(t.map.utilityNetworks?.map((e=>e.load()))??[]);const n=t.map.utilityNetworks?.find((t=>t.isUtilityLayer(e)));n&&(this.rulesTable=await n.getRulesTable(),await(this.rulesTable?.load()))}catch(se){return this._valid=!1,void u.A.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}this._valid=!0}remove(){this.destroy()}destroy(){this.snappingSource?.destroy()}};function Z(e,t){return null==e?new F.A({where:t}):e.where?new F.A({where:(0,A.m)(e.where,t)}):new F.A({where:t})}(0,a._)([(0,c.MZ)({constructOnly:!0})],O.prototype,"layer",void 0),(0,a._)([(0,c.MZ)({constructOnly:!0})],O.prototype,"snappingSource",void 0),(0,a._)([(0,c.MZ)({constructOnly:!0})],O.prototype,"view",void 0),(0,a._)([(0,c.MZ)({value:!1})],O.prototype,"attributeRulesEnabled",null),(0,a._)([(0,c.MZ)()],O.prototype,"layerView",null),(0,a._)([(0,c.MZ)()],O.prototype,"rulesTable",void 0),(0,a._)([(0,c.MZ)()],O.prototype,"valid",null),(0,a._)([(0,c.MZ)()],O.prototype,"subtypeFilter",null),(0,a._)([(0,c.MZ)()],O.prototype,"floorFilter",null),(0,a._)([(0,c.MZ)()],O.prototype,"_valid",void 0),O=(0,a._)([(0,d.$)("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],O);var q,D,H=n(99791),j=n(80794),k=n(9876),X=n(61751),G=n(30003),W=n(23543),B=n(56572);class U extends G.C{constructor(e){let{targetPoint:t,constraint:n,previousVertex:i,otherVertex:r,otherVertexType:s,isDraped:o,selfSnappingType:a,objectId:l,domain:c}=e;super(t,n,o,c??H.n.SELF),this.previousVertex=i,this.otherVertex=r,this.otherVertexType=s,this.selfSnappingType=a??D.None,this.objectId=l??null}get hints(){const e=this.previousVertex,t=this.otherVertexType===q.CENTER?this.otherVertex:this.targetPoint,n=this.otherVertexType===q.CENTER?this.targetPoint:this.otherVertex;return[new W.c(V.H3.TARGET,t,n,this.isDraped,this.domain),new W.c(V.H3.REFERENCE,e,t,this.isDraped,this.domain),new B.l(this.previousVertex,t,n,this.isDraped,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(q||(q={})),function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"}(D||(D={}));var $=n(17072);let Y=class extends l.A{get updating(){return this._snappingSources.some((e=>null==e?.valid||!0===e.valid&&!0===e.snappingSource?.updating))||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=H.n.FEATURE,this._updatingHandles=new M.U,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=(0,o.lZ)((()=>this.options?._effectiveFeatureSources),((e,t)=>this._createSourceInfo(e,t)));this._snappingSources=e,this.addHandles([(0,i.DQ)(e),(0,o.wB)((()=>({rulesEnabled:!!this.options?.attributeRulesEnabled,sources:this._snappingSources.filter(g.Ru)})),(e=>{let{rulesEnabled:t,sources:n}=e;for(const i of n)i.attributeRulesEnabled=t}),o.OH)])}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,n,i){if(!(t&this._domain&&null!=this.options&&this.options.effectiveFeatureEnabled))return[];const r=[],s=this._computeScreenSizeDistanceParameters(e,n);for(const a of this._snappingSources){if(!a?.valid||!a.snappingSource?.layerSource?.enabled||a.layerView?.suspended)continue;const t=a.getFetchCandidatesParameters(e,n,s);for(const e of t)r.push(a.snappingSource.fetchCandidates(e,i).then((e=>e.filter((e=>!this._candidateIsExcluded(a.snappingSource,e,n.excludeFeature))))))}const o=(await(0,w.nA)(r)).flat();return this._addRightAngleCandidates(o,e,s,n),(0,w.Te)(i),(0,V.xX)(e,o),o}_addRightAngleCandidates(e,t,n,i){const r=null!=i.vertexHandle?i.vertexHandle.rightEdge?.rightVertex?.pos:null!=i.editGeometryOperations&&"polygon"===i.editGeometryOperations.data.type?i.editGeometryOperations.data.components[0]?.getFirstVertex()?.pos:null,s=null!=i.vertexHandle?i.vertexHandle.leftEdge?.leftVertex?.pos:null!=i.editGeometryOperations?i.editGeometryOperations.data.components[0]?.getLastVertex()?.pos:null,{view:o}=this,a=(0,N.Lp)(r,o,i),l=(0,N.Lp)(s,o,i),c=e.length;for(let u=0;u<c;u++)this._addRightAngleCandidate(e[u],l,t,n,e),this._addRightAngleCandidate(e[u],a,t,n,e)}_addRightAngleCandidate(e,t,n,i,r){if(null==t||!function(e){return(e instanceof k.z||e instanceof j.X)&&!function(e){let{constraint:{start:t,end:n}}=e;const i=(0,b.a)(t,n),r=(0,x.hG)((0,N.Xz)(t),(0,N.Xz)(n));return i<(0,T.FD)()||r/i<ee}(e)}(e))return;const s=e.constraint.closestTo(t),o=(s[0]-n[0])/i.x,a=(s[1]-n[1])/i.y,{start:l,end:c}=e.constraint;if(o*o+a*a<=1){const n=(0,x.hG)((0,N.Xz)(s),(0,N.Xz)(l))>(0,x.hG)((0,N.Xz)(s),(0,N.Xz)(c))?l:c,i=new U({targetPoint:(0,N.de)(s),otherVertex:t,otherVertexType:q.NEXT,previousVertex:n,constraint:new R.FX(t,s),objectId:e.objectId,isDraped:e.isDraped,domain:H.n.FEATURE});r.push(i)}}_computeScreenSizeDistanceParameters(e,t){let n=null!=this.options?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return null==this.view?{x:n,y:n,z:n,distance:n}:"2d"===this.view.type?(n*=this.view.resolution,{x:n,y:n,z:n,distance:n}):this._computeScreenSizeDistanceParameters3D(e,n,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,n,i){const{spatialReference:r}=i;n.renderCoordsHelper.toRenderCoords(e,r,Q);const s=n.state.camera.computeScreenPixelSizeAt(Q),o=s*n.renderCoordsHelper.unitInMeters,a=o/(0,S.GA)(r),l=o/(0,S.G9)(r),c=t*a,u=t*l,d=(0,$.jq)(e,r,P.qt,n),h=d?J(d,e,a,0,0,n,i):0,p=d?J(d,e,0,a,0,n,i):0,f=d?J(d,e,0,0,l,n,i):0;return{x:0===h?0:c/h,y:0===p?0:c/p,z:0===f?0:u/f,distance:s*t}}_candidateIsExcluded(e,t,n){if(null==n)return!1;const i=this._getCandidateObjectId(t);if(null==i)return!1;const r=e.layerSource.layer;return"graphics"===r.type?n.uid===i:n.sourceLayer===r&&!(!n.attributes||!("objectIdField"in r))&&n.attributes[r.objectIdField]===i}_getCandidateObjectId(e){return e instanceof X.w?e.objectId:null}async _createSourceInfo(e,t){const n=e.layer;n.loaded||(await n.load(),(0,w.Te)(t));const{view:i}=this,r=await this._createFeatureSnappingSourceType(e);return(0,w.Te)(t),new O(null==r?{}:{snappingSource:r,view:i,layer:n})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return null==t||"3d"!==t.type?null:new((await this._getSourceModule("scene")).SceneLayerSnappingSource)({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source?.type){case"feature-layer":case"oriented-imagery":return new((await this._getSourceModule("featureService")).FeatureServiceSnappingSource)({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return"mesh"===e.layer.geometryType?null:new((await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource)({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new((await this._getSourceModule("graphics")).GraphicsSnappingSource)({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new((await this._getSourceModule("notes")).GraphicsSnappingSource)({getGraphicsLayers:()=>e.layer.sublayers?.toArray()??[],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(null==t.loader){const t=this._loadSourceModule(e),n={module:null,loader:t};this._sourceModules[e]=n;const i=await t,r={module:i,loader:t};return this._sourceModules[e]=r,i}return null==t.module?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(n.e(5376).then(n.bind(n,85376)));case"featureCollection":return t.addPromise(n.e(7567).then(n.bind(n,77567)));case"graphics":case"notes":return t.addPromise(Promise.all([n.e(7216),n.e(3620),n.e(2003),n.e(1047),n.e(9546)]).then(n.bind(n,99546)));case"scene":return t.addPromise(n.e(3537).then(n.bind(n,13537)))}}get test(){}};function J(e,t,n,i,r,s,o){let{spatialReference:a}=o;const l=(0,b.c)(K,t);l[0]+=n,l[1]+=i,l[2]+=r;const c=(0,$.jq)(l,a,P.qt,s);return c?(0,V.Mo)(c,e):1/0}(0,a._)([(0,c.MZ)({constructOnly:!0})],Y.prototype,"spatialReference",void 0),(0,a._)([(0,c.MZ)({constructOnly:!0})],Y.prototype,"view",void 0),(0,a._)([(0,c.MZ)()],Y.prototype,"options",void 0),(0,a._)([(0,c.MZ)({readOnly:!0})],Y.prototype,"updating",null),(0,a._)([(0,c.MZ)()],Y.prototype,"_snappingSources",void 0),Y=(0,a._)([(0,d.$)("esri.views.interactive.snapping.FeatureSnappingEngine")],Y);const Q=(0,L.vt)(),K=(0,L.vt)(),ee=1e-4;var te=n(54099),ne=n(9624),ie=n(73582),re=n(24648);class se{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=f.N.shortLineThreshold*f.N.shortLineThreshold}snap(e,t){return null!=t.vertexHandle?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold((0,N.Lp)(e.leftVertex.pos,this.view,t),(0,N.Lp)(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,n){let{spatialReference:i}=n;return 0===this.squaredShortLineThreshold||(0,V.pM)((0,$.jq)(t,i,P.qt,this.view),(0,$.jq)(e,i,P.qt,this.view))>this.squaredShortLineThreshold}isVertical(e,t,n){let{spatialReference:i}=n;const r=(0,S.GA)(i);return(0,x.Io)((0,N.Xz)(e),(0,N.Xz)(t))*r<f.N.verticalLineThresholdMeters}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}}class oe extends G.C{constructor(e){let{lineStart:t,lineEnd:n,targetPoint:i,isDraped:r}=e;super(i,new R.WG(t,n),r,H.n.SELF),this._referenceLineHint=new W.c(V.H3.REFERENCE_EXTENSION,t,n,r,this.domain)}get hints(){return[this._referenceLineHint,new W.c(V.H3.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}var ae=n(89646),le=n(23739),ce=n(79337),ue=n(74050);class de extends se{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=[];if(i<1)return r;const{spatialReference:s}=t,o=(0,$.jq)(e,s,P.qt,this.view),{view:a}=this,l=n.edges[i-1];let c=l;do{if(this.edgeExceedsShortLineThreshold(c,t)){const n=(0,V.is)(c,a,t);this._processCandidateProposal(n.left,n.right,e,o,t,r)}c=c.leftVertex.leftEdge}while(c&&c!==l);return r}snapExistingVertex(e,t){const n=[],i=t.vertexHandle,r=i.component;if(r.edges.length<2)return n;const{view:s}=this,{spatialReference:o}=t,a=(0,$.jq)(e,o,P.qt,s),l=i.leftEdge,c=i.rightEdge;l&&c&&this.edgeExceedsShortLineThreshold(l,t)&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal((0,N.Lp)(l.leftVertex.pos,s,t),(0,N.Lp)(c.rightVertex.pos,s,t),e,a,t,n);const u=r.edges[0];let d=u;do{if(d!==i.leftEdge&&d!==i.rightEdge&&this.edgeExceedsShortLineThreshold(d,t)){const i=(0,V.is)(d,s,t);this._processCandidateProposal(i.left,i.right,e,a,t,n)}d=d.rightVertex.rightEdge}while(d&&d!==u);return n}_processCandidateProposal(e,t,n,i,r,s){const{spatialReference:o,pointer:a}=r,l=(0,L.vt)();!function(e,t,n,i,r){(function(e,t,n,i,r){let{spatialReference:s}=r;const o=(0,ae.IP)(t,n,s,s);if(null==o)return!1;const a=(0,ae.IP)(n,i,s,s);if(null==a)return!1;const l=(0,le.n3)(n,i,s);if(null==l)return!1;const c=Math.abs(ie.wf.shortestSignedDiff(o,a))>Math.PI/2?ie.uC.normalize(o+Math.PI):o;return(0,ae.rT)(e,n,s,(0,re.l3)(l,"meters"),(0,re.Wq)(c,"radians","geographic"),"geodesic"),e[2]=i[2],!0})(e,t,n,i,r)||function(e,t,n,i){(0,ce.Yv)(t,{start:n,end:i,type:ue.Vv.LINE},e),e[2]=t[2]}(e,i,t,n)}(l,e,t,n,r);const c=(0,N.de)((0,N._7)(l));(0,V.pM)(i,(0,$.jq)(c,o,P.qt,this.view))<this.squaredProximityThreshold(a)&&s.push(new oe({lineStart:e,lineEnd:t,targetPoint:c,isDraped:"on-the-ground"===r.elevationInfo?.mode}))}}var he=n(72745),pe=n(20578);class fe extends G.C{constructor(e){let{referenceLine:t,lineStart:n,targetPoint:i,isDraped:r}=e;const s=(0,L.o8)(n),{left:o,right:a}=t;(0,b.f)(s,(0,b.g)(s,s,a),o),super(i,new R.WG(n,(0,N._7)(s)),r,H.n.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new W.c(V.H3.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new pe.r(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map((e=>new W.c(V.H3.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((n=>{(0,b.e)(e.right,n.edge.left)&&(n.fadeLeft=!1,t.fadeRight=!1),(0,b.e)(e.right,n.edge.right)&&(n.fadeRight=!1,t.fadeRight=!1),(0,b.e)(e.left,n.edge.right)&&(n.fadeRight=!1,t.fadeLeft=!1),(0,b.e)(e.left,n.edge.left)&&(n.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}class ge extends se{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=n.vertices.length,s=[];if(i<2)return s;const{view:o}=this,a=(0,$.jq)(e,t.spatialReference,P.qt,o),l=(0,N.Lp)(n.vertices[r-1].pos,o,t),c=(0,N.Lp)(n.vertices[0].pos,o,t),u=n.edges[i-1];let d=u;do{if(this.edgeExceedsShortLineThreshold(d,t)){const n=(0,V.is)(d,o,t);this._checkEdgeForParallelLines(n,l,e,a,t,s),this._checkEdgeForParallelLines(n,c,e,a,t,s)}d=d.leftVertex.leftEdge}while(d&&d!==u);return s}snapExistingVertex(e,t){const n=[],i=t.vertexHandle,r=i.component;if(r.edges.length<3)return n;const{view:s}=this,o=(0,$.jq)(e,t.spatialReference,P.qt,s),a=i.leftEdge,l=i.rightEdge,c=r.vertices[0],u=(0,N.Lp)(c.pos,s,t),d=r.vertices.length,h=r.vertices[d-1],p=(0,N.Lp)(h.pos,s,t),f=r.edges[0];let g=f;do{if(g!==a&&g!==l&&this.edgeExceedsShortLineThreshold(g,t)){const r=(0,V.is)(g,s,t);a&&this._checkEdgeForParallelLines(r,(0,N.Lp)(a.leftVertex.pos,s,t),e,o,t,n),l&&this._checkEdgeForParallelLines(r,(0,N.Lp)(l.rightVertex.pos,s,t),e,o,t,n),i===c?this._checkEdgeForParallelLines(r,p,e,o,t,n):i===h&&this._checkEdgeForParallelLines(r,u,e,o,t,n)}g=g.rightVertex.rightEdge}while(g&&g!==f);return n}_checkEdgeForParallelLines(e,t,n,i,r,s){const o=e.left,a=e.right;if((0,ue.fg)(ve,(0,N.Xz)(t),(0,N.Xz)(o),(0,N.Xz)(a)),(0,x.hG)(ve,(0,N.Xz)(t))<f.N.parallelLineThreshold)return;(0,ue.fg)(ve,(0,N.Xz)(n),(0,N.Xz)(o),(0,N.Xz)(a),(0,N.Xz)(t));const{spatialReference:l,pointer:c}=r,u=(0,N.de)((0,N.fA)(ve[0],ve[1],n[2]));if((0,V.pM)(i,(0,$.jq)(u,l,P.qt,this.view))<this.squaredProximityThreshold(c)){if(this.isVertical(u,t,r)||this.isVertical(o,a,r))return;if(function(e,t){const n=e.left,i=e.right;for(const r of t)if((0,ue.fg)(ve,(0,N.Xz)(i),(0,N.Xz)(r.constraint.start),(0,N.Xz)(r.constraint.end),(0,N.Xz)(n)),(0,x.hG)(ve,(0,N.Xz)(i))<f.N.parallelLineThreshold)return r.addReferenceLine(e),!0;return!1}(e,s))return;s.push(new fe({referenceLine:e,lineStart:t,targetPoint:u,isDraped:"on-the-ground"===r.elevationInfo?.mode}))}}}const ve=(0,he.vt)();class ye extends se{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=[];if(n.vertices.length<2)return i;const{view:r}=this,s=(0,$.jq)(e,t.spatialReference,P.qt,r),o=n.vertices.at(-1);this._checkForSnappingCandidate(D.LastVertex,i,o.leftEdge,o,o.leftEdge.leftVertex,e,s,t);const a=n.vertices[0];return this._checkForSnappingCandidate(D.FirstVertex,i,a.rightEdge,a,a.rightEdge.rightVertex,e,s,t),i}snapExistingVertex(e,t){const n=[],i=t.vertexHandle;if(i.component.vertices.length<3)return n;const{view:r}=this,s=(0,$.jq)(e,t.spatialReference,P.qt,r),o=i.leftEdge,a=i.rightEdge;if(o?.leftVertex.leftEdge){const i=o.leftVertex.leftEdge;this._checkForSnappingCandidate(D.ExistingEdge,n,i,i.rightVertex,i.leftVertex,e,s,t)}if(a?.rightVertex.rightEdge){const i=a.rightVertex.rightEdge;this._checkForSnappingCandidate(D.ExistingEdge,n,i,i.leftVertex,i.rightVertex,e,s,t)}return n}_checkForSnappingCandidate(e,t,n,i,r,s,o,a){if(!this.edgeExceedsShortLineThreshold(n,a))return;const l=this.view,c=(0,N.Lp)(i.pos,l,a),u=(0,N.Lp)(r.pos,l,a);(function(e,t,n,i,r){(function(e,t,n,i,r){let{spatialReference:s}=r;const o=(0,ae.IP)(t,n,s,s);if(null==o)return!1;const a=(0,ae.IP)(n,i,s,s);if(null==a)return!1;const l=Math.sign(ie.uC.shortestSignedDiff(o,a))*Math.PI*.5,c=(0,re.Wq)(o+l,"radians","geographic"),u=(0,L.vt)(),d=(0,le.n3)(n,i,s);return null!=d&&((0,ae.rT)(u,n,s,(0,re.l3)(d,"meters"),c,"geodesic"),(0,b.f)(e,u,n),!0)})(e,t,n,i,r)||function(e,t,n){const i=(0,x.Re)(_e,(0,N.Xz)(n),(0,N.Xz)(t));(0,b.s)(e,i[1],-i[0],0)}(e,t,n)})(me,u,c,s,a),this._checkForSnappingCandidateAlongProjectedRay(e,t,u,c,me,s,o,a)}_checkForSnappingCandidateAlongProjectedRay(e,t,n,i,r,s,o,a){const{spatialReference:l,pointer:c}=a,u=(0,x.Re)(_e,(0,N.Xz)(s),(0,N.Xz)(i)),d=(0,x.Om)(r,u)/(0,x.m3)(r),h=(0,x.Ln)(_e,(0,N.Xz)(i),r,d),p=(0,N.de)((0,N.fA)(h[0],h[1],s[2]));if((0,V.pM)(o,(0,$.jq)(p,l,P.qt,this.view))>this.squaredProximityThreshold(c)||this.isVertical(p,i,a)||this.isVertical(i,n,a))return;const f=(0,b.r)((0,L.vt)(),i,r,Math.sign(d));t.push(new U({targetPoint:p,constraint:new R.FX(i,(0,N._7)(f)),previousVertex:n,otherVertex:i,otherVertexType:q.CENTER,selfSnappingType:e,isDraped:"on-the-ground"===a.elevationInfo?.mode}))}}const _e=(0,he.vt)(),me=(0,L.vt)();class Ee extends G.C{constructor(e){let{targetPoint:t,point1:n,point2:i,isDraped:r}=e;super(t,new R.ej((0,N._7)((0,b.o)((0,L.vt)(),n,i,.5)),.5*(0,x.Io)((0,N.Xz)(n),(0,N.Xz)(i))),r,H.n.SELF),this._p1=n,this._p2=i}get hints(){return[new W.c(V.H3.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new W.c(V.H3.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new B.l(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}class we extends se{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=[],r=n.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return i;const{view:s}=this,o=n.vertices[0],a=n.vertices[r-1],l=(0,N.Lp)(o.pos,s,t),c=(0,N.Lp)(a.pos,s,t);return this._processCandidateProposal(l,c,e,t,i),i}snapExistingVertex(e,t){const n=[],i=t.vertexHandle,r=i.component;if(r.edges.length<2)return n;if("polyline"===t.editGeometryOperations.data.type&&(0===i.index||i.index===r.vertices.length-1))return n;const{view:s}=this,o=(0,N.Lp)(i.leftEdge.leftVertex.pos,s,t),a=(0,N.Lp)(i.rightEdge.rightVertex.pos,s,t);return this._processCandidateProposal(o,a,e,t,n),n}_processCandidateProposal(e,t,n,i,r){if(!this.exceedsShortLineThreshold(e,t,i))return;const s=(0,x.Cc)(Se,(0,N.Xz)(e),(0,N.Xz)(t),.5),o=.5*(0,x.Io)((0,N.Xz)(e),(0,N.Xz)(t)),a=(0,ue.Dh)(Se,(0,N.Xz)(n),s,o),l=(0,N.de)((0,N.fA)(a[0],a[1],n[2])),{spatialReference:c,pointer:u}=i,d=(0,$.jq)(n,c,P.qt,this.view);if((0,V.pM)(d,(0,$.jq)(l,c,P.qt,this.view))<this.squaredProximityThreshold(u)){if(this.isVertical(e,l,i)||this.isVertical(l,t,i))return;r.push(new Ee({targetPoint:l,point1:e,point2:t,isDraped:"on-the-ground"===i.elevationInfo?.mode}))}}}const Se=(0,he.vt)();let xe=class extends l.A{constructor(e){super(e),this.updating=!1,this._snappers=new s.A,this._domain=H.n.SELF}initialize(){this._snappers.push(new ge(this.view,this.options),new de(this.view,this.options),new ye(this.view,this.options),new we(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,n){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const i=[];for(const r of this._snappers.items)for(const t of r.snap(e,n))i.push(t);return(0,V.xX)(e,i),i}};function be(e,t){return[new xe({view:e,options:t}),new Y({view:e,options:t,spatialReference:e.spatialReference})]}(0,a._)([(0,c.MZ)({readOnly:!0})],xe.prototype,"updating",void 0),(0,a._)([(0,c.MZ)({constructOnly:!0})],xe.prototype,"view",void 0),(0,a._)([(0,c.MZ)()],xe.prototype,"options",null),xe=(0,a._)([(0,d.$)("esri.views.interactive.snapping.SelfSnappingEngine")],xe);var Le=n(30484);class Te extends G.C{constructor(e,t,n,i){super(e,new R.i7(e),i,H.n.ALL),this.first=t,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Le.v(this.targetPoint,this.isDraped,this.domain)]}}let Me=class extends(te.A.EventedMixin(l.A)){constructor(e){super(e),this.options=new y,this.snappingEnginesFactory=be,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Pe.MAIN}initialize(){this.addHandles([(0,o.wB)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:n,distance:i}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:n,distance:i}}),(()=>{this.doneSnapping(),this.emit("changed")}),o.OH),(0,o.wB)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),o.OH),(0,o.wB)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(e=>{let{viewReady:t,snappingEnginesFactory:n}=e;return this._recreateEngines(t,n)}),o.pc)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:n,options:i}=this;this._engines=t(n,i)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:n}=e;this._removeVisualization();const i=this._currentMainCandidate;if(null==i)return t;const r=this._selectUpdateInput(e);if(null==r)return t;const{spatialReference:s}=n,o=(0,ne.project)(r,s);if(null==o)return t;const{view:a}=this,{elevationInfo:l,visualizer:c}=n,u=[],d=(0,N.vf)(o,a,l),h=i.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,h,n)||!Ne(i,n.drawConstraints))return this._resetSnappingState(),t;i.targetPoint=(0,N.de)(h),u.push(...i.hints);for(const p of this._currentOtherActiveCandidates)Ne(p,n.drawConstraints)&&(p.targetPoint=(0,N.de)(h),u.push(...p.hints));return null!=c&&this.addHandles(c.draw(u,{spatialReference:s,elevationInfo:Fe(n),view:a,selfSnappingZ:n.selfSnappingZ}),Re),(0,N.xF)(h,a,t,n)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput(e){let{point:t,scenePoint:n}=e;switch(this._currentSnappedType){case Pe.MAIN:return t;case Pe.SCENE:return n}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Pe.MAIN}_removeVisualization(){this.removeHandles(Re)}async _snapSinglePoint(e){let{point:t,context:n,signal:i}=e;const{view:r}=this,{elevationInfo:s}=n,o=(0,N.vf)(t,r,s),a=await this._fetchCandidates(o,H.n.ALL,n,i);return this._createSnapResult(o,Pe.MAIN,a,r,t,n,i)}async _snapMultiPoint(e){let{point:t,scenePoint:n,context:i,signal:r}=e;const{view:s}=this,{coordinateHelper:o,elevationInfo:a,spatialReference:l}=i;await(0,ne.initializeProjection)(n.spatialReference,l);const c=(0,ne.project)(n,l),u=(0,N.vf)(c,s,a),d=await this._fetchCandidates(u,H.n.FEATURE,i,r);if(d.length>0){const e=await this._fetchCandidates(u,H.n.SELF,i,r);return this._createSnapResult(u,Pe.SCENE,[...d,...e],s,c,i,r)}const h=(0,N.vf)(t,s,a),p=await this._fetchCandidates(h,H.n.SELF,i,r);return this._createSnapResult(h,Pe.MAIN,p,s,{z:o.hasZ()&&t.hasZ?t.z??0:void 0,m:o.hasM()&&t.hasM?t.m??0:void 0},i,r)}async _fetchCandidates(e,t,n,i){return(await Promise.all(this._engines.map((r=>r.fetchCandidates(e,t,n,i))))).flat()}_createSnapResult(e,t,n,i,r,s,o){return{get valid(){return!(0,w.G4)(o)},apply:()=>{const{spatialReference:o}=s,{snappedPoint:a,hints:l}=this._processCandidates(e,t,n,s);return this._removeVisualization(),null!=s.visualizer&&this.addHandles(s.visualizer.draw(l,{spatialReference:o,elevationInfo:P.qt,view:i,selfSnappingZ:s.selfSnappingZ}),Re),(0,N.xF)(a,i,r,s)}}}_processCandidates(e,t,n,i){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,V.xX)(e,n);const r=this._currentMainCandidate;if(null!=r){const s=function(e,t){return e instanceof Te?Ae(t,e.first)>=0&&Ae(t,e.second)>=0?0:-1:Ae(t,e)}(r,n);if(s>=0){if(!(n[s]instanceof Te))return this._intersectWithOtherCandidates(s,n,e,t,i);if(this._arePointsWithinScreenThreshold(e,r.targetPoint,i))return this._updateSnappingCandidate(r,t,n,i)}}return this._intersectWithOtherCandidates(0,n,e,t,i)}_intersectWithOtherCandidates(e,t,n,i,r){const{coordinateHelper:s}=r,o=t[e],a=[];for(let l=0;l<t.length;++l){if(l===e)continue;const i=t[l],r=o.constraint.intersect(i.constraint);if(r)for(const e of r.closestPoints(o.targetPoint))a.push([new Te((0,N.de)(e),o,i,i.isDraped),this._squaredScreenDistance(n,e,s)])}return a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this._squaredPointProximityThreshold(r.pointer))?this._updateSnappingCandidate(a[0][0],i,t,r):Ne(o,r.drawConstraints)?this._updateSnappingCandidate(o,i,t,r):{snappedPoint:n,hints:[]}}_updateSnappingCandidate(e,t,n,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const r=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const o of n){if(e instanceof Te){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const t=o.constraint.closestTo(r);this._squaredScreenDistance(t,r,i.coordinateHelper)<f.N.satisfiesConstraintScreenThreshold*f.N.satisfiesConstraintScreenThreshold&&(o.targetPoint=r,this._currentOtherActiveCandidates.push(o),s.push(...o.hints))}return{snappedPoint:r,hints:s}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return(0,V.pM)(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return(0,$.jq)(e,t.spatialReference,P.qt,this.view)}get test(){}};var Pe;(0,a._)([(0,c.MZ)({constructOnly:!0})],Me.prototype,"view",void 0),(0,a._)([(0,c.MZ)()],Me.prototype,"options",void 0),(0,a._)([(0,c.MZ)({readOnly:!0})],Me.prototype,"updating",null),(0,a._)([(0,c.MZ)()],Me.prototype,"snappingEnginesFactory",void 0),(0,a._)([(0,c.MZ)()],Me.prototype,"_engines",void 0),(0,a._)([(0,c.MZ)()],Me.prototype,"_squaredMouseProximityThreshold",null),(0,a._)([(0,c.MZ)()],Me.prototype,"_squaredTouchProximityThreshold",null),Me=(0,a._)([(0,d.$)("esri.views.interactive.snapping.SnappingManager")],Me),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(Pe||(Pe={}));const Re="visualization-handle";function Ne(e,t){return!t||null==t.direction&&null==t.distance||!(e instanceof j.X||e instanceof k.z||e instanceof oe||e instanceof fe||e instanceof Ee)&&(!(e instanceof U)||null==t.direction&&e.selfSnappingType===D.LastVertex)}function Ae(e,t){let n=-1;for(let i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){n=i;break}return n}function Fe(e){let{coordinateHelper:t,elevationInfo:n}=e;return t.hasZ()?P.qt:n}const Ie=new Map;function Ce(e){if(!Ie.has(e)){const t=function(e,t){const n=new y({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:t?.distance??f.N.distance,touchSensitivityMultiplier:t?.touchSensitivityMultiplier??f.N.touchSensitivityMultiplier});return{...(0,o.wB)((()=>e.map?.allLayers?.toArray()??[]),(e=>{n.featureSources=new s.A(e.map((e=>new p({layer:e}))))}),o.Vh),options:n}}(e,{distance:10}),n=function(e,t){return new Me({view:e,options:t,snappingEnginesFactory:(t,n)=>[new Y({view:e,spatialReference:e.spatialReference,options:n})]})}(e,t.options);Ie.set(e,{referenceCount:0,snappingManager:n,remove:()=>{t.remove(),n.destroy()}})}const t=Ie.get(e);t.referenceCount++;const n=(0,i.hA)((()=>function(e,t){t.referenceCount--,t.referenceCount>0||(0,r.d)((()=>{0===t.referenceCount&&(t.remove(),Ie.delete(e))}))}(e,t)));return{snappingManager:t.snappingManager,...n}}},80794:(e,t,n)=>{n.d(t,{X:()=>a});var i=n(75543),r=n(9730),s=n(61751),o=n(23543);class a extends s.w{constructor(e){super({...e,isDraped:!0,constraint:new i.en(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new o.c(r.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},9876:(e,t,n)=>{n.d(t,{z:()=>a});var i=n(75543),r=n(9730),s=n(61751),o=n(23543);class a extends s.w{constructor(e){super({...e,constraint:new i.Mn(e.edgeStart,e.edgeEnd)})}get hints(){return[new o.c(r.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},61751:(e,t,n)=>{n.d(t,{w:()=>s});var i=n(99791),r=n(30003);class s extends r.C{constructor(e){let{targetPoint:t,objectId:n,constraint:r,isDraped:s}=e;super(t,r,s,i.n.FEATURE),this.objectId=n}}},30003:(e,t,n)=>{n.d(t,{C:()=>i});class i{constructor(e,t,n,i){this.targetPoint=e,this.constraint=t,this.isDraped=n,this.domain=i}}},30484:(e,t,n)=>{n.d(t,{v:()=>o});var i=n(20664),r=n(99791),s=n(64753);class o extends s.m{constructor(e,t){super(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.n.ALL),this.intersectionPoint=e}equals(e){return e instanceof o&&(0,i.e)(this.intersectionPoint,e.intersectionPoint)}}},23543:(e,t,n)=>{n.d(t,{c:()=>o});n(81806),n(76460);var i=n(20664),r=n(99791),s=n(64753);class o extends s.m{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r.n.ALL,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(i,s),this.type=e,this.lineStart=t,this.lineEnd=n,this.fadeLeft=o,this.fadeRight=a}equals(e){return e instanceof o&&this.type===e.type&&(0,i.e)(this.lineStart,e.lineStart)&&(0,i.e)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return(0,i.p)(this.lineStart,this.lineEnd)}}},20578:(e,t,n)=>{n.d(t,{r:()=>o});n(81806),n(76460);var i=n(20664),r=n(99791),s=n(64753);class o extends s.m{constructor(e,t,n){super(n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.n.ALL),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof o&&(0,i.e)(this.lineStart,e.lineStart)&&(0,i.e)(this.lineEnd,e.lineEnd)}}},56572:(e,t,n)=>{n.d(t,{l:()=>o});n(81806),n(76460);var i=n(20664),r=n(99791),s=n(64753);class o extends s.m{constructor(e,t,n,i){super(i,arguments.length>4&&void 0!==arguments[4]?arguments[4]:r.n.ALL),this.previousVertex=e,this.centerVertex=t,this.nextVertex=n}equals(e){return e instanceof o&&(0,i.e)(this.previousVertex,e.previousVertex)&&(0,i.e)(this.centerVertex,e.centerVertex)&&(0,i.e)(this.nextVertex,e.nextVertex)}}},64753:(e,t,n)=>{n.d(t,{m:()=>i});class i{constructor(e,t){this.isDraped=e,this.domain=t}}},9730:(e,t,n)=>{n.d(t,{H3:()=>i,is:()=>_,Tu:()=>S,HN:()=>m,nf:()=>y,Mo:()=>g,BY:()=>w,xX:()=>v,pM:()=>f});var i,r=n(68134),s=n(41289),o=n(34154),a=n(18288),l=n(20664),c=n(18117),u=n(68295),d=n(57308),h=n(82307),p=n(23862);function f(e,t){const n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function g(e,t){return Math.sqrt(f(e,t))}function v(e,t){t.sort(((t,n)=>(0,l.a)(t.targetPoint,e)-(0,l.a)(n.targetPoint,e)))}function y(e,t,n){let{point:i,distance:r,returnEdge:l,vertexMode:d,coordinateHelper:{spatialReference:h},filter:p}=e;return n=null!=n?n.clone():new u.A({where:"1=1"}),p&&(n.geometry=p.geometry,n.distance=p.distance,n.spatialRelationship=p.spatialRelationship,n.where=(0,o.m)(n.where,p.where),n.timeExtent=(0,a.pJ)(n.timeExtent,p.timeExtent),n.objectIds=function(e,t){return e||t?t?e?Array.from((0,s.E$)(new Set(e),new Set(t))):t:e:null}(n.objectIds,p.objectIds)),{point:(0,c.T)(i[0],i[1],i[2],h.toJSON()),mode:t,distance:r,returnEdge:l,vertexMode:d,query:n.toJSON()}}function _(e,t,n){return{left:(0,p.Lp)(e.leftVertex.pos,t,n),right:(0,p.Lp)(e.rightVertex.pos,t,n)}}function m(e){return e.createQuery()}!function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}(i||(i={}));const E=Symbol("snapping-toggle");function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};const n=(0,r.wB)((()=>({view:e.view,snappingOptions:e.snappingOptions})),(n=>{let{view:i,snappingOptions:r}=n;if(e.removeHandles(E),!i||!r)return;const s=d.o.TOOL,o=[i.on("key-down",(e=>{e.key!==h.fn.toggle||e.repeat||(r.enabledToggled=!0,t())}),s),i.on("key-up",(e=>{e.key===h.fn.toggle&&(r.enabledToggled=!1,t())}),s),i.on("pointer-move",(e=>{const n=e.native.ctrlKey;r.enabledToggled!==n&&(r.enabledToggled=n,t())}),s)];e.addHandles(o,E)}),r.pc);e.addHandles(n)}function S(e){return function(e){return null!=e&&"object"==typeof e&&"declaredClass"in e&&"esri.WebMap"===e.declaredClass}(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length}},89646:(e,t,n)=>{n.d(t,{$h:()=>f,Ef:()=>x,IP:()=>v,P1:()=>E,hF:()=>S,jQ:()=>m,rT:()=>w,rZ:()=>i,uR:()=>y});var i,r=n(73582),s=n(24648),o=n(31633),a=n(19555),l=n(72745),c=n(20664),u=n(9392),d=n(14487),h=n(7137),p=n(80963);function f(e,t){if(null==e||null==t)return;const n=g(e,t);return null!=n?(0,s.Wq)(n,"radians","geographic"):void 0}!function(e){e.Absolute="absolute",e.Relative="relative",e.RelativeBilateral="relative-bilateral"}(i||(i={}));const g=(()=>{const e=(0,u.vt)(),t=(0,u.vt)();return(n,i)=>((0,c.s)(e,n.x,n.y,n.z??0),(0,c.s)(t,i.x,i.y,i.z??0),v(e,t,n.spatialReference,i.spatialReference))})(),v=(()=>{const e=(0,l.vt)(),t=(0,u.vt)(),n=(0,u.vt)();return(i,r,s,u)=>{if((0,c.e)(i,r))return;const f=(0,h.Xn)(s),g=(0,h.Xn)(u);if(f&&g&&(0,p.aI)(f,g)&&(0,d.F)(i,s,t,f)&&(0,d.F)(r,u,n,g)){const{azimuth:e}=(0,h._3)(L,t,n,f);return null!=e?(0,o.oU)(e,"degrees","radians"):void 0}e[0]=r[0]-i[0],e[1]=r[1]-i[1];let v=(0,a.g7)(l.JP,e);return e[0]<0&&(v=T-v),v}})();function y(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.Absolute;if(t&&n)switch(r){case i.Absolute:return f(t,n);case i.Relative:return m(_(e,t,n),i.Relative);case i.RelativeBilateral:return m(_(e,t,n),i.RelativeBilateral)}}function _(e,t,n){if(!e||!t||!n)return;const i=g(e,t),r=g(t,n);return null!=i&&null!=r?(0,s.Wq)(r-i,"radians","geographic"):void 0}function m(e,t){if(null!=e)switch(t){case i.Absolute:return E(e);case i.Relative:{const t=S(e);let n=P.normalize(t,0,!0);return-180===n&&(n=180),(0,s.Wq)(n,"degrees","geographic")}case i.RelativeBilateral:{const t=S(e),n=Math.abs(P.normalize(t,0,!0));return(0,s.Wq)(n,"degrees","geographic")}}}function E(e){const t=S(e),n=M.normalize(t,0,!0);return(0,s.Wq)(n,"degrees","geographic")}const w=(()=>{const e=(0,u.vt)();return function(t,n,i,r,a){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"geodesic";(0,c.c)(e,n);const u=S(a);if("geodesic"===l){const s=(0,h.Xn)(i);if(s&&(0,d.F)(e,i,e,s))return(0,h.vN)(t,e,u,r,s),t[2]=n[2],!!(0,d.F)(t,s,t,i)}const p=(0,s.g2)(u,"geographic","arithmetic"),f=(0,o.oU)(p,"degrees","radians"),g=n[0]+r*Math.cos(f),v=n[1]+r*Math.sin(f),y=n[2];return(0,c.s)(t,g,v,y),!0}})();function S(e){if(null!=e)return(0,s.g2)(b(e),e.rotationType,"geographic")}function x(e){if(null!=e)return(0,s.g2)(b(e),e.rotationType,"arithmetic")}function b(e){return(0,o.oU)(e.value,e.unit,"degrees")}const L=new h.Zj,T=2*Math.PI,M=r.ie,P=new r.hr(-180,180)},74050:(e,t,n)=>{n.d(t,{Dh:()=>l,IB:()=>u,Vv:()=>i,fg:()=>a,jI:()=>c});n(15941);var i,r=n(19555),s=n(72745);function o(e,t){return e[0]*t[1]-e[1]*t[0]}function a(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n;return(0,r.Re)(h,i,n),(0,r.Re)(f,t,s),function(e,t,n){const i=(0,r.Om)(n,t)/(0,r.m3)(n);(0,r.hs)(e,n,i)}(g,f,h),(0,r.WQ)(e,s,g)}function l(e,t,n,i){(0,r.Re)(h,t,n);const s=i/(0,r.Bw)(h);return(0,r.Ln)(e,n,h,s)}function c(e,t){const n=e.start,s=e.end,a=t.start,l=t.end,c=(0,r.Re)(h,s,n),u=(0,r.Re)(p,l,a),v=o(c,u);if(Math.abs(v)<=d)return[];const y=(0,r.Re)(f,n,a),_=o(u,y)/v,m=o(c,y)/v;if(_>=0){if(m>=0||t.type===i.LINE)return[(0,r.Ln)(g,n,c,_)]}else if(e.type===i.LINE&&(m>=0||t.type===i.LINE))return[(0,r.Ln)(g,n,c,_)];return[]}function u(e,t,n){const s=[],o=(0,r.Re)(h,e.end,e.start),a=(0,r.Re)(p,e.start,t),l=(0,r.m3)(o),c=2*(0,r.Om)(o,a),u=c*c-4*l*((0,r.m3)(a)-n*n);if(0===u){const t=-c/(2*l);(e.type===i.LINE||t>=0)&&s.push((0,r.Ln)(g,e.start,o,t))}else if(u>0){const t=Math.sqrt(u),n=(-c+t)/(2*l);(e.type===i.LINE||n>=0)&&s.push((0,r.Ln)(g,e.start,o,n));const a=(-c-t)/(2*l);(e.type===i.LINE||a>=0)&&s.push((0,r.Ln)(f,e.start,o,a))}return s}!function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"}(i||(i={}));const d=1e-6,h=(0,s.vt)(),p=(0,s.vt)(),f=(0,s.vt)(),g=(0,s.vt)()},79337:(e,t,n)=>{n.d(t,{Bn:()=>h,F2:()=>M,HG:()=>b,IB:()=>m,K4:()=>E,Mc:()=>p,Nm:()=>y,SO:()=>w,UL:()=>T,VT:()=>f,Yv:()=>_,Zj:()=>L,b_:()=>g,pJ:()=>P,r2:()=>v,t1:()=>S});var i=n(15941),r=n(19555),s=n(72745),o=n(20664),a=n(9392),l=n(53494),c=n(13927),u=n(94966),d=n(74050);function h(e,t,n){let{start:i,end:o,type:a}=e;const l=[],c=(0,r.Re)(N,o,i),u=(0,r.Re)(A,i,t),d=(0,r.m3)(c),h=2*(0,r.Om)(c,u),p=h*h-4*d*((0,r.m3)(u)-n*n);if(0===p){const e=-h/(2*d);(a===P.PLANE||e>=0)&&l.push((0,r.Ln)((0,s.vt)(),i,c,e))}else if(p>0){const e=Math.sqrt(p),t=(-h+e)/(2*d);(a===P.PLANE||t>=0)&&l.push((0,r.Ln)((0,s.vt)(),i,c,t));const n=(-h-e)/(2*d);(a===P.PLANE||n>=0)&&l.push((0,r.Ln)((0,s.vt)(),i,c,n))}return l}function p(e,t){const n=e.start,i=e.end,s=(0,r.Re)(N,i,n),c=(0,o.s)(I,-s[1],s[0],0),u=t.start,h=t.end,p=(0,o.z)(C,h,u),f=(0,o.m)(p,c),g=(0,o.s)(V,n[0],n[1],0),v=(0,o.z)(z,g,u),y=(0,o.m)(v,c),_=(0,l.FD)();if(Math.abs(f)<_)return Math.abs(y),[];const m=(0,o.r)(O,u,p,y/f);if(t.type===d.Vv.RAY){const e=(0,o.z)(Z,m,u);if((0,o.m)(e,p)<-_)return[]}if(e.type===P.HALF_PLANE){const e=(0,r.jb)(A,m,n);if((0,r.Om)(e,s)<-_)return[]}return[(0,a.o8)(m)]}function f(e,t){return function(e,t){let{start:n,end:i,type:r}=e;const s=(0,o.z)(F,t,n),c=(0,o.z)(I,i,n),u=(0,o.b)(C,c,s),h=(0,o.x)(u)/(0,o.x)(c),p=(0,l.FD)();if(h<p)switch(r){case d.Vv.LINE:return[(0,a.o8)(t)];case d.Vv.RAY:return(0,o.m)(c,s)<-p?[]:[(0,a.o8)(t)]}return[]}(x(D,t[2],e),t)}function g(e,t){return w(x(D,0,e),x(H,0,t)).map((e=>{let[t,n]=e;return(0,s.fA)(t,n)}))}function v(e,t,n){return _(e,x(D,e[2],t),n)}function y(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,a.vt)();const s=(0,r.Re)(N,e,t),o=(0,r.Bw)(s);return(0,r.Ln)(i,t,s,0===o?1:n/o),i[2]=e[2],i}function _(e,t){let{start:n,end:i,type:r}=t,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,a.vt)();const l=(0,o.z)(F,e,n),c=(0,o.z)(I,i,n),u=(0,o.m)(l,c)/(0,o.m)(c,c);return(0,o.r)(s,n,c,r===d.Vv.RAY?Math.max(u,0):u)}const m=(()=>{const e=(0,a.vt)(),t=(0,a.vt)(),n=(0,a.vt)();return(i,l)=>{let{start:h,end:p}=i,{center:f,radius:g,normal:v,slicePlane:y}=l;const _=(0,c.O_)(f,v,q);if(L((0,c.Io)(_,h),0)&&L((0,c.Io)(_,p),0)){(0,u.VV)(v,e,t);const i=(i,s)=>((0,o.f)(n,s,f),(0,r.hZ)(i,(0,o.m)(n,e),(0,o.m)(n,t)),i),l=(0,d.IB)({start:i(N,h),end:i(A,p),type:d.Vv.LINE},s.uY,g),c=[];for(const[n,r]of l){const i=(0,o.c)((0,a.vt)(),f);(0,o.r)(i,i,e,n),(0,o.r)(i,i,t,r),y&&!M(y,i)||c.push(i)}return c}const m=(0,a.vt)();return(0,c.U5)(_,h,p,m)?!L((0,o.p)(m,f),g)||y&&!M(y,m)?[]:[m]:[]}})();function E(e,t,n){let{start:i,end:s,type:l}=e;const c=[],u=(0,o.f)(F,s,i),h=(0,r.Re)(A,i,t),p=(0,r.m3)(u),f=2*(0,r.Om)(u,h),g=f*f-4*p*((0,r.m3)(h)-n*n);if(0===g){const e=-f/(2*p);(l===d.Vv.LINE||e>=0)&&c.push((0,o.r)((0,a.vt)(),i,u,e))}else if(g>0){const e=Math.sqrt(g),t=(-f+e)/(2*p);(l===d.Vv.LINE||t>=0)&&c.push((0,o.r)((0,a.vt)(),i,u,t));const n=(-f-e)/(2*p);(l===d.Vv.LINE||n>=0)&&c.push((0,o.r)((0,a.vt)(),i,u,n))}return c}function w(e,t){const n=e.start,i=e.end,r=t.start,s=t.end,c=(0,o.z)(F,i,n),u=(0,o.z)(I,s,r),h=(0,o.z)(C,r,n),p=(0,o.b)(V,c,u);if(!L((0,o.m)(h,p),0))return[];const f=(0,o.x)(p);if(L(f,0))return[];const g=(0,o.b)(z,h,u),v=(0,o.m)(g,p)/f,y=(0,o.r)(O,n,c,v);if(e.type===d.Vv.RAY){const e=(0,o.z)(Z,y,n);if((0,o.m)(c,e)<-(0,l.FD)())return[]}if(t.type===d.Vv.RAY){const e=(0,o.z)(Z,y,r);if((0,o.m)(u,e)<-(0,l.FD)())return[]}return[(0,a.o8)(y)]}function S(e,t,n,i){const[o,a]=e,[l,c]=n,u=l-o,d=c-a,h=u*u+d*d,p=Math.sqrt(h);if(p>t+i)return[];if(p<Math.abs(t-i))return[];if(L(p,0)&&L(t,i))return[];const f=(t*t-i*i+h)/(2*p),g=Math.sqrt(t*t-f*f),v=g*d/p,y=g*u/p,[_,m]=(0,r.Cc)(N,e,n,f/p);return L(v,y)?[(0,s.fA)(_,m)]:[(0,s.fA)(_+v,m-y),(0,s.fA)(_-v,m+y)]}function x(e,t,n){let{start:i,end:r,type:s}=n;return(0,o.s)(e.start,i[0],i[1],t),(0,o.s)(e.end,r[0],r[1],t),e.type=R[s],e}function b(e,t){return L(e[2],t[2])}function L(e,t){return(0,i.Sp)(Math.abs(e-t),0,(0,l.FD)())}function T(e,t){return t.filter((t=>M(e,t)))}function M(e,t){return(0,c.Tj)(e,t)}var P;!function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"}(P||(P={}));const R={[P.PLANE]:d.Vv.LINE,[P.HALF_PLANE]:d.Vv.RAY},N=(0,s.vt)(),A=(0,s.vt)(),F=(0,a.vt)(),I=(0,a.vt)(),C=(0,a.vt)(),V=(0,a.vt)(),z=(0,a.vt)(),O=(0,a.vt)(),Z=(0,a.vt)(),q=(0,c.vt)(),D={start:(0,a.vt)(),end:(0,a.vt)(),type:d.Vv.LINE},H={start:(0,a.vt)(),end:(0,a.vt)(),type:d.Vv.LINE}}}]);
//# sourceMappingURL=3454.c4ec9d26.chunk.js.map