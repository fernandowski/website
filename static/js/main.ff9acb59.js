/*! For license information please see main.ff9acb59.js.LICENSE.txt */
(()=>{var e={29976:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=29976,e.exports=t},82730:(e,t,r)=>{"use strict";var i=r(65043),n=r(78853);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,a={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(a[e]=t,e=0;e<t.length;e++)o.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,r,i,n,s,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=n,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function _(e){return e[1].toUpperCase()}function v(e,t,r,i){var n=g.hasOwnProperty(t)?g[t]:null;(null!==n?0!==n.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,r,i){if(null===t||"undefined"===typeof t||function(e,t,r,i){if(null!==r&&0===r.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==r?!r.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,r,i))return!0;if(i)return!1;if(null!==r)switch(r.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,r,n,i)&&(r=null),i||null===n?function(e){return!!h.call(f,e)||!h.call(p,e)&&(d.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===r?e.removeAttribute(t):e.setAttribute(t,""+r)):n.mustUseProperty?e[n.propertyName]=null===r?3!==n.type&&"":r:(t=n.attributeName,i=n.attributeNamespace,null===r?e.removeAttribute(t):(r=3===(n=n.type)||4===n&&!0===r?"":""+r,i?e.setAttributeNS(i,t,r):e.setAttribute(t,r))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,_);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,_);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,_);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var b=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),x=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),C=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),I=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var L=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var N=Symbol.iterator;function D(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=N&&e[N]||e["@@iterator"])?e:null}var F,k=Object.assign;function z(e){if(void 0===F)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);F=t&&t[1]||""}return"\n"+F+e}var U=!1;function V(e,t){if(!e||U)return"";U=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var n=c.stack.split("\n"),s=i.stack.split("\n"),o=n.length-1,a=s.length-1;1<=o&&0<=a&&n[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(n[o]!==s[a]){if(1!==o||1!==a)do{if(o--,0>--a||n[o]!==s[a]){var l="\n"+n[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=a);break}}}finally{U=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?z(e):""}function B(e){switch(e.tag){case 5:return z(e.type);case 16:return z("Lazy");case 13:return z("Suspense");case 19:return z("SuspenseList");case 0:case 2:case 15:return e=V(e.type,!1);case 11:return e=V(e.type.render,!1);case 1:return e=V(e.type,!0);default:return""}}function j(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case x:return"Portal";case M:return"Profiler";case T:return"StrictMode";case R:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case A:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case O:return null!==(t=e.displayName||null)?t:j(e.type)||"Memo";case I:t=e._payload,e=e._init;try{return j(e(t))}catch(r){}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(t);case 8:return t===T?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function G(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function Z(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function $(e){e._valueTracker||(e._valueTracker=function(e){var t=Z(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof r&&"function"===typeof r.get&&"function"===typeof r.set){var n=r.get,s=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(e){i=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),i="";return e&&(i=Z(e)?e.checked?"true":"false":e.value),(e=i)!==r&&(t.setValue(e),!0)}function W(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var r=t.checked;return k({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=r?r:e._wrapperState.initialChecked})}function X(e,t){var r=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;r=G(null!=t.value?t.value:r),e._wrapperState={initialChecked:i,initialValue:r,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function K(e,t){J(e,t);var r=G(t.value),i=t.type;if(null!=r)"number"===i?(0===r&&""===e.value||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,r):t.hasOwnProperty("defaultValue")&&ee(e,t.type,G(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Q(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}""!==(r=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==r&&(e.name=r)}function ee(e,t,r){"number"===t&&W(e.ownerDocument)===e||(null==r?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var te=Array.isArray;function re(e,t,r,i){if(e=e.options,t){t={};for(var n=0;n<r.length;n++)t["$"+r[n]]=!0;for(r=0;r<e.length;r++)n=t.hasOwnProperty("$"+e[r].value),e[r].selected!==n&&(e[r].selected=n),n&&i&&(e[r].defaultSelected=!0)}else{for(r=""+G(r),t=null,n=0;n<e.length;n++){if(e[n].value===r)return e[n].selected=!0,void(i&&(e[n].defaultSelected=!0));null!==t||e[n].disabled||(t=e[n])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return k({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ne(e,t){var r=t.value;if(null==r){if(r=t.children,t=t.defaultValue,null!=r){if(null!=t)throw Error(s(92));if(te(r)){if(1<r.length)throw Error(s(93));r=r[0]}t=r}null==t&&(t=""),r=t}e._wrapperState={initialValue:G(r)}}function se(e,t){var r=G(t.value),i=G(t.defaultValue);null!=r&&((r=""+r)!==e.value&&(e.value=r),null==t.defaultValue&&e.defaultValue!==r&&(e.defaultValue=r)),null!=i&&(e.defaultValue=""+i)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue=function(e){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,r,i,n){MSApp.execUnsafeLocalFunction((function(){return e(t,r)}))}:e}((function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}}));function he(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&3===r.nodeType)return void(r.nodeValue=t)}e.textContent=t}var de={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function fe(e,t,r){return null==t||"boolean"===typeof t||""===t?"":r||"number"!==typeof t||0===t||de.hasOwnProperty(e)&&de[e]?(""+t).trim():t+"px"}function me(e,t){for(var r in e=e.style,t)if(t.hasOwnProperty(r)){var i=0===r.indexOf("--"),n=fe(r,t[r],i);"float"===r&&(r="cssFloat"),i?e.setProperty(r,n):e[r]=n}}Object.keys(de).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),de[t]=de[e]}))}));var ge=k({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function _e(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ve=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,xe=null,Se=null;function Te(e){if(e=mn(e)){if("function"!==typeof we)throw Error(s(280));var t=e.stateNode;t&&(t=yn(t),we(e.stateNode,e.type,t))}}function Me(e){xe?Se?Se.push(e):Se=[e]:xe=e}function Ae(){if(xe){var e=xe,t=Se;if(Se=xe=null,Te(e),t)for(e=0;e<t.length;e++)Te(t[e])}}function Ce(e,t){return e(t)}function Ee(){}var Re=!1;function Pe(e,t,r){if(Re)return e(t,r);Re=!0;try{return Ce(e,t,r)}finally{Re=!1,(null!==xe||null!==Se)&&(Ee(),Ae())}}function Oe(e,t){var r=e.stateNode;if(null===r)return null;var i=yn(r);if(null===i)return null;r=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(r&&"function"!==typeof r)throw Error(s(231,t,typeof r));return r}var Ie=!1;if(u)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){Ie=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(eu){Ie=!1}function Ne(e,t,r,i,n,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(r,c)}catch(u){this.onError(u)}}var De=!1,Fe=null,ke=!1,ze=null,Ue={onError:function(e){De=!0,Fe=e}};function Ve(e,t,r,i,n,s,o,a,l){De=!1,Fe=null,Ne.apply(Ue,arguments)}function Be(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(r=t.return),e=t.return}while(e)}return 3===t.tag?r:null}function je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Be(e)!==e)throw Error(s(188))}function Ge(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Be(e)))throw Error(s(188));return t!==e?null:e}for(var r=e,i=t;;){var n=r.return;if(null===n)break;var o=n.alternate;if(null===o){if(null!==(i=n.return)){r=i;continue}break}if(n.child===o.child){for(o=n.child;o;){if(o===r)return He(n),e;if(o===i)return He(n),t;o=o.sibling}throw Error(s(188))}if(r.return!==i.return)r=n,i=o;else{for(var a=!1,l=n.child;l;){if(l===r){a=!0,r=n,i=o;break}if(l===i){a=!0,i=n,r=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===r){a=!0,r=o,i=n;break}if(l===i){a=!0,i=o,r=n;break}l=l.sibling}if(!a)throw Error(s(189))}}if(r.alternate!==i)throw Error(s(190))}if(3!==r.tag)throw Error(s(188));return r.stateNode.current===r?e:t}(e))?Ze(e):null}function Ze(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ze(e);if(null!==t)return t;e=e.sibling}return null}var $e=n.unstable_scheduleCallback,qe=n.unstable_cancelCallback,We=n.unstable_shouldYield,Ye=n.unstable_requestPaint,Xe=n.unstable_now,Je=n.unstable_getCurrentPriorityLevel,Ke=n.unstable_ImmediatePriority,Qe=n.unstable_UserBlockingPriority,et=n.unstable_NormalPriority,tt=n.unstable_LowPriority,rt=n.unstable_IdlePriority,it=null,nt=null;var st=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(ot(e)/at|0)|0},ot=Math.log,at=Math.LN2;var lt=64,ct=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var r=e.pendingLanes;if(0===r)return 0;var i=0,n=e.suspendedLanes,s=e.pingedLanes,o=268435455&r;if(0!==o){var a=o&~n;0!==a?i=ut(a):0!==(s&=o)&&(i=ut(s))}else 0!==(o=r&~n)?i=ut(o):0!==s&&(i=ut(s));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&n)&&((n=i&-i)>=(s=t&-t)||16===n&&0!==(4194240&s)))return t;if(0!==(4&i)&&(i|=16&r),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)n=1<<(r=31-st(t)),i|=e[r],t&=~n;return i}function dt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function mt(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function gt(e,t,r){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=r}function yt(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var i=31-st(r),n=1<<i;n&t|e[i]&t&&(e[i]|=t),r&=~n}}var _t=0;function vt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,wt,xt,St,Tt,Mt=!1,At=[],Ct=null,Et=null,Rt=null,Pt=new Map,Ot=new Map,It=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Nt(e,t){switch(e){case"focusin":case"focusout":Ct=null;break;case"dragenter":case"dragleave":Et=null;break;case"mouseover":case"mouseout":Rt=null;break;case"pointerover":case"pointerout":Pt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ot.delete(t.pointerId)}}function Dt(e,t,r,i,n,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:r,eventSystemFlags:i,nativeEvent:s,targetContainers:[n]},null!==t&&(null!==(t=mn(t))&&wt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==n&&-1===t.indexOf(n)&&t.push(n),e)}function Ft(e){var t=fn(e.target);if(null!==t){var r=Be(t);if(null!==r)if(13===(t=r.tag)){if(null!==(t=je(r)))return e.blockedOn=t,void Tt(e.priority,(function(){xt(r)}))}else if(3===t&&r.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===r.tag?r.stateNode.containerInfo:null)}e.blockedOn=null}function kt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var r=Wt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==r)return null!==(t=mn(r))&&wt(t),e.blockedOn=r,!1;var i=new(r=e.nativeEvent).constructor(r.type,r);ve=i,r.target.dispatchEvent(i),ve=null,t.shift()}return!0}function zt(e,t,r){kt(e)&&r.delete(t)}function Ut(){Mt=!1,null!==Ct&&kt(Ct)&&(Ct=null),null!==Et&&kt(Et)&&(Et=null),null!==Rt&&kt(Rt)&&(Rt=null),Pt.forEach(zt),Ot.forEach(zt)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,Mt||(Mt=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Ut)))}function Bt(e){function t(t){return Vt(t,e)}if(0<At.length){Vt(At[0],e);for(var r=1;r<At.length;r++){var i=At[r];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Ct&&Vt(Ct,e),null!==Et&&Vt(Et,e),null!==Rt&&Vt(Rt,e),Pt.forEach(t),Ot.forEach(t),r=0;r<It.length;r++)(i=It[r]).blockedOn===e&&(i.blockedOn=null);for(;0<It.length&&null===(r=It[0]).blockedOn;)Ft(r),null===r.blockedOn&&It.shift()}var jt=b.ReactCurrentBatchConfig,Ht=!0;function Gt(e,t,r,i){var n=_t,s=jt.transition;jt.transition=null;try{_t=1,$t(e,t,r,i)}finally{_t=n,jt.transition=s}}function Zt(e,t,r,i){var n=_t,s=jt.transition;jt.transition=null;try{_t=4,$t(e,t,r,i)}finally{_t=n,jt.transition=s}}function $t(e,t,r,i){if(Ht){var n=Wt(e,t,r,i);if(null===n)Ui(e,t,i,qt,r),Nt(e,i);else if(function(e,t,r,i,n){switch(t){case"focusin":return Ct=Dt(Ct,e,t,r,i,n),!0;case"dragenter":return Et=Dt(Et,e,t,r,i,n),!0;case"mouseover":return Rt=Dt(Rt,e,t,r,i,n),!0;case"pointerover":var s=n.pointerId;return Pt.set(s,Dt(Pt.get(s)||null,e,t,r,i,n)),!0;case"gotpointercapture":return s=n.pointerId,Ot.set(s,Dt(Ot.get(s)||null,e,t,r,i,n)),!0}return!1}(n,e,t,r,i))i.stopPropagation();else if(Nt(e,i),4&t&&-1<Lt.indexOf(e)){for(;null!==n;){var s=mn(n);if(null!==s&&bt(s),null===(s=Wt(e,t,r,i))&&Ui(e,t,i,qt,r),s===n)break;n=s}null!==n&&i.stopPropagation()}else Ui(e,t,i,null,r)}}var qt=null;function Wt(e,t,r,i){if(qt=null,null!==(e=fn(e=be(i))))if(null===(t=Be(e)))e=null;else if(13===(r=t.tag)){if(null!==(e=je(t)))return e;e=null}else if(3===r){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Ke:return 1;case Qe:return 4;case et:case tt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Xt=null,Jt=null,Kt=null;function Qt(){if(Kt)return Kt;var e,t,r=Jt,i=r.length,n="value"in Xt?Xt.value:Xt.textContent,s=n.length;for(e=0;e<i&&r[e]===n[e];e++);var o=i-e;for(t=1;t<=o&&r[i-t]===n[s-t];t++);return Kt=n.slice(e,1<t?1-t:void 0)}function er(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function tr(){return!0}function rr(){return!1}function ir(e){function t(t,r,i,n,s){for(var o in this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=n,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(n):n[o]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?tr:rr,this.isPropagationStopped=rr,this}return k(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=tr)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=tr)},persist:function(){},isPersistent:tr}),t}var nr,sr,or,ar={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lr=ir(ar),cr=k({},ar,{view:0,detail:0}),ur=ir(cr),hr=k({},cr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xr,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==or&&(or&&"mousemove"===e.type?(nr=e.screenX-or.screenX,sr=e.screenY-or.screenY):sr=nr=0,or=e),nr)},movementY:function(e){return"movementY"in e?e.movementY:sr}}),dr=ir(hr),pr=ir(k({},hr,{dataTransfer:0})),fr=ir(k({},cr,{relatedTarget:0})),mr=ir(k({},ar,{animationName:0,elapsedTime:0,pseudoElement:0})),gr=ir(k({},ar,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),yr=ir(k({},ar,{data:0})),_r={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},br={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wr(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=br[e])&&!!t[e]}function xr(){return wr}var Sr=ir(k({},cr,{key:function(e){if(e.key){var t=_r[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=er(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?vr[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xr,charCode:function(e){return"keypress"===e.type?er(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?er(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),Tr=ir(k({},hr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Mr=ir(k({},cr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xr})),Ar=ir(k({},ar,{propertyName:0,elapsedTime:0,pseudoElement:0})),Cr=ir(k({},hr,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Er=[9,13,27,32],Rr=u&&"CompositionEvent"in window,Pr=null;u&&"documentMode"in document&&(Pr=document.documentMode);var Or=u&&"TextEvent"in window&&!Pr,Ir=u&&(!Rr||Pr&&8<Pr&&11>=Pr),Lr=String.fromCharCode(32),Nr=!1;function Dr(e,t){switch(e){case"keyup":return-1!==Er.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fr(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var kr=!1;var zr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ur(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!zr[e.type]:"textarea"===t}function Vr(e,t,r,i){Me(i),0<(t=Bi(t,"onChange")).length&&(r=new lr("onChange","change",null,r,i),e.push({event:r,listeners:t}))}var Br=null,jr=null;function Hr(e){Li(e,0)}function Gr(e){if(q(gn(e)))return e}function Zr(e,t){if("change"===e)return t}var $r=!1;if(u){var qr;if(u){var Wr="oninput"in document;if(!Wr){var Yr=document.createElement("div");Yr.setAttribute("oninput","return;"),Wr="function"===typeof Yr.oninput}qr=Wr}else qr=!1;$r=qr&&(!document.documentMode||9<document.documentMode)}function Xr(){Br&&(Br.detachEvent("onpropertychange",Jr),jr=Br=null)}function Jr(e){if("value"===e.propertyName&&Gr(jr)){var t=[];Vr(t,jr,e,be(e)),Pe(Hr,t)}}function Kr(e,t,r){"focusin"===e?(Xr(),jr=r,(Br=t).attachEvent("onpropertychange",Jr)):"focusout"===e&&Xr()}function Qr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Gr(jr)}function ei(e,t){if("click"===e)return Gr(t)}function ti(e,t){if("input"===e||"change"===e)return Gr(t)}var ri="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ii(e,t){if(ri(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var n=r[i];if(!h.call(t,n)||!ri(e[n],t[n]))return!1}return!0}function ni(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function si(e,t){var r,i=ni(e);for(e=0;i;){if(3===i.nodeType){if(r=e+i.textContent.length,e<=t&&r>=t)return{node:i,offset:t-e};e=r}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ni(i)}}function oi(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?oi(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ai(){for(var e=window,t=W();t instanceof e.HTMLIFrameElement;){try{var r="string"===typeof t.contentWindow.location.href}catch(i){r=!1}if(!r)break;t=W((e=t.contentWindow).document)}return t}function li(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function ci(e){var t=ai(),r=e.focusedElem,i=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&oi(r.ownerDocument.documentElement,r)){if(null!==i&&li(r))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if((e=(t=r.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var n=r.textContent.length,s=Math.min(i.start,n);i=void 0===i.end?s:Math.min(i.end,n),!e.extend&&s>i&&(n=i,i=s,s=n),n=si(r,s);var o=si(r,i);n&&o&&(1!==e.rangeCount||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(n.node,n.offset),e.removeAllRanges(),s>i?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=r;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof r.focus&&r.focus(),r=0;r<t.length;r++)(e=t[r]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var ui=u&&"documentMode"in document&&11>=document.documentMode,hi=null,di=null,pi=null,fi=!1;function mi(e,t,r){var i=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;fi||null==hi||hi!==W(i)||("selectionStart"in(i=hi)&&li(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},pi&&ii(pi,i)||(pi=i,0<(i=Bi(di,"onSelect")).length&&(t=new lr("onSelect","select",null,t,r),e.push({event:t,listeners:i}),t.target=hi)))}function gi(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var yi={animationend:gi("Animation","AnimationEnd"),animationiteration:gi("Animation","AnimationIteration"),animationstart:gi("Animation","AnimationStart"),transitionend:gi("Transition","TransitionEnd")},_i={},vi={};function bi(e){if(_i[e])return _i[e];if(!yi[e])return e;var t,r=yi[e];for(t in r)if(r.hasOwnProperty(t)&&t in vi)return _i[e]=r[t];return e}u&&(vi=document.createElement("div").style,"AnimationEvent"in window||(delete yi.animationend.animation,delete yi.animationiteration.animation,delete yi.animationstart.animation),"TransitionEvent"in window||delete yi.transitionend.transition);var wi=bi("animationend"),xi=bi("animationiteration"),Si=bi("animationstart"),Ti=bi("transitionend"),Mi=new Map,Ai="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ci(e,t){Mi.set(e,t),l(t,[e])}for(var Ei=0;Ei<Ai.length;Ei++){var Ri=Ai[Ei];Ci(Ri.toLowerCase(),"on"+(Ri[0].toUpperCase()+Ri.slice(1)))}Ci(wi,"onAnimationEnd"),Ci(xi,"onAnimationIteration"),Ci(Si,"onAnimationStart"),Ci("dblclick","onDoubleClick"),Ci("focusin","onFocus"),Ci("focusout","onBlur"),Ci(Ti,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Pi));function Ii(e,t,r){var i=e.type||"unknown-event";e.currentTarget=r,function(e,t,r,i,n,o,a,l,c){if(Ve.apply(this,arguments),De){if(!De)throw Error(s(198));var u=Fe;De=!1,Fe=null,ke||(ke=!0,ze=u)}}(i,t,void 0,e),e.currentTarget=null}function Li(e,t){t=0!==(4&t);for(var r=0;r<e.length;r++){var i=e[r],n=i.event;i=i.listeners;e:{var s=void 0;if(t)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&n.isPropagationStopped())break e;Ii(n,a,c),s=l}else for(o=0;o<i.length;o++){if(l=(a=i[o]).instance,c=a.currentTarget,a=a.listener,l!==s&&n.isPropagationStopped())break e;Ii(n,a,c),s=l}}}if(ke)throw e=ze,ke=!1,ze=null,e}function Ni(e,t){var r=t[hn];void 0===r&&(r=t[hn]=new Set);var i=e+"__bubble";r.has(i)||(zi(t,e,2,!1),r.add(i))}function Di(e,t,r){var i=0;t&&(i|=4),zi(r,e,i,t)}var Fi="_reactListening"+Math.random().toString(36).slice(2);function ki(e){if(!e[Fi]){e[Fi]=!0,o.forEach((function(t){"selectionchange"!==t&&(Oi.has(t)||Di(t,!1,e),Di(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Fi]||(t[Fi]=!0,Di("selectionchange",!1,t))}}function zi(e,t,r,i){switch(Yt(t)){case 1:var n=Gt;break;case 4:n=Zt;break;default:n=$t}r=n.bind(null,t,r,e),n=void 0,!Ie||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(n=!0),i?void 0!==n?e.addEventListener(t,r,{capture:!0,passive:n}):e.addEventListener(t,r,!0):void 0!==n?e.addEventListener(t,r,{passive:n}):e.addEventListener(t,r,!1)}function Ui(e,t,r,i,n){var s=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var a=i.stateNode.containerInfo;if(a===n||8===a.nodeType&&a.parentNode===n)break;if(4===o)for(o=i.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===n||8===l.nodeType&&l.parentNode===n))return;o=o.return}for(;null!==a;){if(null===(o=fn(a)))return;if(5===(l=o.tag)||6===l){i=s=o;continue e}a=a.parentNode}}i=i.return}Pe((function(){var i=s,n=be(r),o=[];e:{var a=Mi.get(e);if(void 0!==a){var l=lr,c=e;switch(e){case"keypress":if(0===er(r))break e;case"keydown":case"keyup":l=Sr;break;case"focusin":c="focus",l=fr;break;case"focusout":c="blur",l=fr;break;case"beforeblur":case"afterblur":l=fr;break;case"click":if(2===r.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=dr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=pr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Mr;break;case wi:case xi:case Si:l=mr;break;case Ti:l=Ar;break;case"scroll":l=ur;break;case"wheel":l=Cr;break;case"copy":case"cut":case"paste":l=gr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Tr}var u=0!==(4&t),h=!u&&"scroll"===e,d=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=Oe(f,d))&&u.push(Vi(f,m,p)))),h)break;f=f.return}0<u.length&&(a=new l(a,c,null,r,n),o.push({event:a,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||r===ve||!(c=r.relatedTarget||r.fromElement)||!fn(c)&&!c[un])&&(l||a)&&(a=n.window===n?n:(a=n.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=i,null!==(c=(c=r.relatedTarget||r.toElement)?fn(c):null)&&(c!==(h=Be(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=dr,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=Tr,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?a:gn(l),p=null==c?a:gn(c),(a=new u(m,f+"leave",l,r,n)).target=h,a.relatedTarget=p,m=null,fn(n)===i&&((u=new u(d,f+"enter",c,r,n)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(d=c,f=0,p=u=l;p;p=ji(p))f++;for(p=0,m=d;m;m=ji(m))p++;for(;0<f-p;)u=ji(u),f--;for(;0<p-f;)d=ji(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break e;u=ji(u),d=ji(d)}u=null}else u=null;null!==l&&Hi(o,a,l,u,!1),null!==c&&null!==h&&Hi(o,h,c,u,!0)}if("select"===(l=(a=i?gn(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var g=Zr;else if(Ur(a))if($r)g=ti;else{g=Qr;var y=Kr}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=ei);switch(g&&(g=g(e,i))?Vr(o,g,r,n):(y&&y(e,a,i),"focusout"===e&&(y=a._wrapperState)&&y.controlled&&"number"===a.type&&ee(a,"number",a.value)),y=i?gn(i):window,e){case"focusin":(Ur(y)||"true"===y.contentEditable)&&(hi=y,di=i,pi=null);break;case"focusout":pi=di=hi=null;break;case"mousedown":fi=!0;break;case"contextmenu":case"mouseup":case"dragend":fi=!1,mi(o,r,n);break;case"selectionchange":if(ui)break;case"keydown":case"keyup":mi(o,r,n)}var _;if(Rr)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else kr?Dr(e,r)&&(v="onCompositionEnd"):"keydown"===e&&229===r.keyCode&&(v="onCompositionStart");v&&(Ir&&"ko"!==r.locale&&(kr||"onCompositionStart"!==v?"onCompositionEnd"===v&&kr&&(_=Qt()):(Jt="value"in(Xt=n)?Xt.value:Xt.textContent,kr=!0)),0<(y=Bi(i,v)).length&&(v=new yr(v,e,null,r,n),o.push({event:v,listeners:y}),_?v.data=_:null!==(_=Fr(r))&&(v.data=_))),(_=Or?function(e,t){switch(e){case"compositionend":return Fr(t);case"keypress":return 32!==t.which?null:(Nr=!0,Lr);case"textInput":return(e=t.data)===Lr&&Nr?null:e;default:return null}}(e,r):function(e,t){if(kr)return"compositionend"===e||!Rr&&Dr(e,t)?(e=Qt(),Kt=Jt=Xt=null,kr=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ir&&"ko"!==t.locale?null:t.data}}(e,r))&&(0<(i=Bi(i,"onBeforeInput")).length&&(n=new yr("onBeforeInput","beforeinput",null,r,n),o.push({event:n,listeners:i}),n.data=_))}Li(o,t)}))}function Vi(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Bi(e,t){for(var r=t+"Capture",i=[];null!==e;){var n=e,s=n.stateNode;5===n.tag&&null!==s&&(n=s,null!=(s=Oe(e,r))&&i.unshift(Vi(e,s,n)),null!=(s=Oe(e,t))&&i.push(Vi(e,s,n))),e=e.return}return i}function ji(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Hi(e,t,r,i,n){for(var s=t._reactName,o=[];null!==r&&r!==i;){var a=r,l=a.alternate,c=a.stateNode;if(null!==l&&l===i)break;5===a.tag&&null!==c&&(a=c,n?null!=(l=Oe(r,s))&&o.unshift(Vi(r,l,a)):n||null!=(l=Oe(r,s))&&o.push(Vi(r,l,a))),r=r.return}0!==o.length&&e.push({event:t,listeners:o})}var Gi=/\r\n?/g,Zi=/\u0000|\uFFFD/g;function $i(e){return("string"===typeof e?e:""+e).replace(Gi,"\n").replace(Zi,"")}function qi(e,t,r){if(t=$i(t),$i(e)!==t&&r)throw Error(s(425))}function Wi(){}var Yi=null,Xi=null;function Ji(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Ki="function"===typeof setTimeout?setTimeout:void 0,Qi="function"===typeof clearTimeout?clearTimeout:void 0,en="function"===typeof Promise?Promise:void 0,tn="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof en?function(e){return en.resolve(null).then(e).catch(rn)}:Ki;function rn(e){setTimeout((function(){throw e}))}function nn(e,t){var r=t,i=0;do{var n=r.nextSibling;if(e.removeChild(r),n&&8===n.nodeType)if("/$"===(r=n.data)){if(0===i)return e.removeChild(n),void Bt(t);i--}else"$"!==r&&"$?"!==r&&"$!"!==r||i++;r=n}while(r);Bt(t)}function sn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function on(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var r=e.data;if("$"===r||"$!"===r||"$?"===r){if(0===t)return e;t--}else"/$"===r&&t++}e=e.previousSibling}return null}var an=Math.random().toString(36).slice(2),ln="__reactFiber$"+an,cn="__reactProps$"+an,un="__reactContainer$"+an,hn="__reactEvents$"+an,dn="__reactListeners$"+an,pn="__reactHandles$"+an;function fn(e){var t=e[ln];if(t)return t;for(var r=e.parentNode;r;){if(t=r[un]||r[ln]){if(r=t.alternate,null!==t.child||null!==r&&null!==r.child)for(e=on(e);null!==e;){if(r=e[ln])return r;e=on(e)}return t}r=(e=r).parentNode}return null}function mn(e){return!(e=e[ln]||e[un])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function gn(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function yn(e){return e[cn]||null}var _n=[],vn=-1;function bn(e){return{current:e}}function wn(e){0>vn||(e.current=_n[vn],_n[vn]=null,vn--)}function xn(e,t){vn++,_n[vn]=e.current,e.current=t}var Sn={},Tn=bn(Sn),Mn=bn(!1),An=Sn;function Cn(e,t){var r=e.type.contextTypes;if(!r)return Sn;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var n,s={};for(n in r)s[n]=t[n];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function En(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Rn(){wn(Mn),wn(Tn)}function Pn(e,t,r){if(Tn.current!==Sn)throw Error(s(168));xn(Tn,t),xn(Mn,r)}function On(e,t,r){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return r;for(var n in i=i.getChildContext())if(!(n in t))throw Error(s(108,H(e)||"Unknown",n));return k({},r,i)}function In(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Sn,An=Tn.current,xn(Tn,e),xn(Mn,Mn.current),!0}function Ln(e,t,r){var i=e.stateNode;if(!i)throw Error(s(169));r?(e=On(e,t,An),i.__reactInternalMemoizedMergedChildContext=e,wn(Mn),wn(Tn),xn(Tn,e)):wn(Mn),xn(Mn,r)}var Nn=null,Dn=!1,Fn=!1;function kn(e){null===Nn?Nn=[e]:Nn.push(e)}function zn(){if(!Fn&&null!==Nn){Fn=!0;var e=0,t=_t;try{var r=Nn;for(_t=1;e<r.length;e++){var i=r[e];do{i=i(!0)}while(null!==i)}Nn=null,Dn=!1}catch(n){throw null!==Nn&&(Nn=Nn.slice(e+1)),$e(Ke,zn),n}finally{_t=t,Fn=!1}}return null}var Un=[],Vn=0,Bn=null,jn=0,Hn=[],Gn=0,Zn=null,$n=1,qn="";function Wn(e,t){Un[Vn++]=jn,Un[Vn++]=Bn,Bn=e,jn=t}function Yn(e,t,r){Hn[Gn++]=$n,Hn[Gn++]=qn,Hn[Gn++]=Zn,Zn=e;var i=$n;e=qn;var n=32-st(i)-1;i&=~(1<<n),r+=1;var s=32-st(t)+n;if(30<s){var o=n-n%5;s=(i&(1<<o)-1).toString(32),i>>=o,n-=o,$n=1<<32-st(t)+n|r<<n|i,qn=s+e}else $n=1<<s|r<<n|i,qn=e}function Xn(e){null!==e.return&&(Wn(e,1),Yn(e,1,0))}function Jn(e){for(;e===Bn;)Bn=Un[--Vn],Un[Vn]=null,jn=Un[--Vn],Un[Vn]=null;for(;e===Zn;)Zn=Hn[--Gn],Hn[Gn]=null,qn=Hn[--Gn],Hn[Gn]=null,$n=Hn[--Gn],Hn[Gn]=null}var Kn=null,Qn=null,es=!1,ts=null;function rs(e,t){var r=Cc(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,null===(t=e.deletions)?(e.deletions=[r],e.flags|=16):t.push(r)}function is(e,t){switch(e.tag){case 5:var r=e.type;return null!==(t=1!==t.nodeType||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,Kn=e,Qn=sn(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,Kn=e,Qn=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(r=null!==Zn?{id:$n,overflow:qn}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},(r=Cc(18,null,null,0)).stateNode=t,r.return=e,e.child=r,Kn=e,Qn=null,!0);default:return!1}}function ns(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ss(e){if(es){var t=Qn;if(t){var r=t;if(!is(e,t)){if(ns(e))throw Error(s(418));t=sn(r.nextSibling);var i=Kn;t&&is(e,t)?rs(i,r):(e.flags=-4097&e.flags|2,es=!1,Kn=e)}}else{if(ns(e))throw Error(s(418));e.flags=-4097&e.flags|2,es=!1,Kn=e}}}function os(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Kn=e}function as(e){if(e!==Kn)return!1;if(!es)return os(e),es=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!Ji(e.type,e.memoizedProps)),t&&(t=Qn)){if(ns(e))throw ls(),Error(s(418));for(;t;)rs(e,t),t=sn(t.nextSibling)}if(os(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var r=e.data;if("/$"===r){if(0===t){Qn=sn(e.nextSibling);break e}t--}else"$"!==r&&"$!"!==r&&"$?"!==r||t++}e=e.nextSibling}Qn=null}}else Qn=Kn?sn(e.stateNode.nextSibling):null;return!0}function ls(){for(var e=Qn;e;)e=sn(e.nextSibling)}function cs(){Qn=Kn=null,es=!1}function us(e){null===ts?ts=[e]:ts.push(e)}var hs=b.ReactCurrentBatchConfig;function ds(e,t,r){if(null!==(e=r.ref)&&"function"!==typeof e&&"object"!==typeof e){if(r._owner){if(r=r._owner){if(1!==r.tag)throw Error(s(309));var i=r.stateNode}if(!i)throw Error(s(147,e));var n=i,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=n.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(s(284));if(!r._owner)throw Error(s(290,e))}return e}function ps(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function fs(e){return(0,e._init)(e._payload)}function ms(e){function t(t,r){if(e){var i=t.deletions;null===i?(t.deletions=[r],t.flags|=16):i.push(r)}}function r(r,i){if(!e)return null;for(;null!==i;)t(r,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function n(e,t){return(e=Rc(e,t)).index=0,e.sibling=null,e}function o(t,r,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<r?(t.flags|=2,r):i:(t.flags|=2,r):(t.flags|=1048576,r)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,r,i){return null===t||6!==t.tag?((t=Lc(r,e.mode,i)).return=e,t):((t=n(t,r)).return=e,t)}function c(e,t,r,i){var s=r.type;return s===S?h(e,t,r.props.children,i,r.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===I&&fs(s)===t.type)?((i=n(t,r.props)).ref=ds(e,t,r),i.return=e,i):((i=Pc(r.type,r.key,r.props,null,e.mode,i)).ref=ds(e,t,r),i.return=e,i)}function u(e,t,r,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==r.containerInfo||t.stateNode.implementation!==r.implementation?((t=Nc(r,e.mode,i)).return=e,t):((t=n(t,r.children||[])).return=e,t)}function h(e,t,r,i,s){return null===t||7!==t.tag?((t=Oc(r,e.mode,i,s)).return=e,t):((t=n(t,r)).return=e,t)}function d(e,t,r){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Lc(""+t,e.mode,r)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(r=Pc(t.type,t.key,t.props,null,e.mode,r)).ref=ds(e,null,t),r.return=e,r;case x:return(t=Nc(t,e.mode,r)).return=e,t;case I:return d(e,(0,t._init)(t._payload),r)}if(te(t)||D(t))return(t=Oc(t,e.mode,r,null)).return=e,t;ps(e,t)}return null}function p(e,t,r,i){var n=null!==t?t.key:null;if("string"===typeof r&&""!==r||"number"===typeof r)return null!==n?null:l(e,t,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return r.key===n?c(e,t,r,i):null;case x:return r.key===n?u(e,t,r,i):null;case I:return p(e,t,(n=r._init)(r._payload),i)}if(te(r)||D(r))return null!==n?null:h(e,t,r,i,null);ps(e,r)}return null}function f(e,t,r,i,n){if("string"===typeof i&&""!==i||"number"===typeof i)return l(t,e=e.get(r)||null,""+i,n);if("object"===typeof i&&null!==i){switch(i.$$typeof){case w:return c(t,e=e.get(null===i.key?r:i.key)||null,i,n);case x:return u(t,e=e.get(null===i.key?r:i.key)||null,i,n);case I:return f(e,t,r,(0,i._init)(i._payload),n)}if(te(i)||D(i))return h(t,e=e.get(r)||null,i,n,null);ps(t,i)}return null}function m(n,s,a,l){for(var c=null,u=null,h=s,m=s=0,g=null;null!==h&&m<a.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var y=p(n,h,a[m],l);if(null===y){null===h&&(h=g);break}e&&h&&null===y.alternate&&t(n,h),s=o(y,s,m),null===u?c=y:u.sibling=y,u=y,h=g}if(m===a.length)return r(n,h),es&&Wn(n,m),c;if(null===h){for(;m<a.length;m++)null!==(h=d(n,a[m],l))&&(s=o(h,s,m),null===u?c=h:u.sibling=h,u=h);return es&&Wn(n,m),c}for(h=i(n,h);m<a.length;m++)null!==(g=f(h,n,m,a[m],l))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),s=o(g,s,m),null===u?c=g:u.sibling=g,u=g);return e&&h.forEach((function(e){return t(n,e)})),es&&Wn(n,m),c}function g(n,a,l,c){var u=D(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var h=u=null,m=a,g=a=0,y=null,_=l.next();null!==m&&!_.done;g++,_=l.next()){m.index>g?(y=m,m=null):y=m.sibling;var v=p(n,m,_.value,c);if(null===v){null===m&&(m=y);break}e&&m&&null===v.alternate&&t(n,m),a=o(v,a,g),null===h?u=v:h.sibling=v,h=v,m=y}if(_.done)return r(n,m),es&&Wn(n,g),u;if(null===m){for(;!_.done;g++,_=l.next())null!==(_=d(n,_.value,c))&&(a=o(_,a,g),null===h?u=_:h.sibling=_,h=_);return es&&Wn(n,g),u}for(m=i(n,m);!_.done;g++,_=l.next())null!==(_=f(m,n,g,_.value,c))&&(e&&null!==_.alternate&&m.delete(null===_.key?g:_.key),a=o(_,a,g),null===h?u=_:h.sibling=_,h=_);return e&&m.forEach((function(e){return t(n,e)})),es&&Wn(n,g),u}return function e(i,s,o,l){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case w:e:{for(var c=o.key,u=s;null!==u;){if(u.key===c){if((c=o.type)===S){if(7===u.tag){r(i,u.sibling),(s=n(u,o.props.children)).return=i,i=s;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===I&&fs(c)===u.type){r(i,u.sibling),(s=n(u,o.props)).ref=ds(i,u,o),s.return=i,i=s;break e}r(i,u);break}t(i,u),u=u.sibling}o.type===S?((s=Oc(o.props.children,i.mode,l,o.key)).return=i,i=s):((l=Pc(o.type,o.key,o.props,null,i.mode,l)).ref=ds(i,s,o),l.return=i,i=l)}return a(i);case x:e:{for(u=o.key;null!==s;){if(s.key===u){if(4===s.tag&&s.stateNode.containerInfo===o.containerInfo&&s.stateNode.implementation===o.implementation){r(i,s.sibling),(s=n(s,o.children||[])).return=i,i=s;break e}r(i,s);break}t(i,s),s=s.sibling}(s=Nc(o,i.mode,l)).return=i,i=s}return a(i);case I:return e(i,s,(u=o._init)(o._payload),l)}if(te(o))return m(i,s,o,l);if(D(o))return g(i,s,o,l);ps(i,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==s&&6===s.tag?(r(i,s.sibling),(s=n(s,o)).return=i,i=s):(r(i,s),(s=Lc(o,i.mode,l)).return=i,i=s),a(i)):r(i,s)}}var gs=ms(!0),ys=ms(!1),_s=bn(null),vs=null,bs=null,ws=null;function xs(){ws=bs=vs=null}function Ss(e){var t=_s.current;wn(_s),e._currentValue=t}function Ts(e,t,r){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===r)break;e=e.return}}function Ms(e,t){vs=e,ws=bs=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ma=!0),e.firstContext=null)}function As(e){var t=e._currentValue;if(ws!==e)if(e={context:e,memoizedValue:t,next:null},null===bs){if(null===vs)throw Error(s(308));bs=e,vs.dependencies={lanes:0,firstContext:e}}else bs=bs.next=e;return t}var Cs=null;function Es(e){null===Cs?Cs=[e]:Cs.push(e)}function Rs(e,t,r,i){var n=t.interleaved;return null===n?(r.next=r,Es(t)):(r.next=n.next,n.next=r),t.interleaved=r,Ps(e,i)}function Ps(e,t){e.lanes|=t;var r=e.alternate;for(null!==r&&(r.lanes|=t),r=e,e=e.return;null!==e;)e.childLanes|=t,null!==(r=e.alternate)&&(r.childLanes|=t),r=e,e=e.return;return 3===r.tag?r.stateNode:null}var Os=!1;function Is(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ls(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ns(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ds(e,t,r){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Tl)){var n=i.pending;return null===n?t.next=t:(t.next=n.next,n.next=t),i.pending=t,Ps(e,r)}return null===(n=i.interleaved)?(t.next=t,Es(i)):(t.next=n.next,n.next=t),i.interleaved=t,Ps(e,r)}function Fs(e,t,r){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&r))){var i=t.lanes;r|=i&=e.pendingLanes,t.lanes=r,yt(e,r)}}function ks(e,t){var r=e.updateQueue,i=e.alternate;if(null!==i&&r===(i=i.updateQueue)){var n=null,s=null;if(null!==(r=r.firstBaseUpdate)){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};null===s?n=s=o:s=s.next=o,r=r.next}while(null!==r);null===s?n=s=t:s=s.next=t}else n=s=t;return r={baseState:i.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:i.shared,effects:i.effects},void(e.updateQueue=r)}null===(e=r.lastBaseUpdate)?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function zs(e,t,r,i){var n=e.updateQueue;Os=!1;var s=n.firstBaseUpdate,o=n.lastBaseUpdate,a=n.shared.pending;if(null!==a){n.shared.pending=null;var l=a,c=l.next;l.next=null,null===o?s=c:o.next=c,o=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==s){var h=n.baseState;for(o=0,u=c=l=null,a=s;;){var d=a.lane,p=a.eventTime;if((i&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,m=a;switch(d=t,p=r,m.tag){case 1:if("function"===typeof(f=m.payload)){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=m.payload)?f.call(p,h,d):f)||void 0===d)break e;h=k({},h,d);break e;case 2:Os=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(d=n.effects)?n.effects=[a]:d.push(a))}else p={eventTime:p,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,o|=d;if(null===(a=a.next)){if(null===(a=n.shared.pending))break;a=(d=a).next,d.next=null,n.lastBaseUpdate=d,n.shared.pending=null}}if(null===u&&(l=h),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=u,null!==(t=n.shared.interleaved)){n=t;do{o|=n.lane,n=n.next}while(n!==t)}else null===s&&(n.shared.lanes=0);Il|=o,e.lanes=o,e.memoizedState=h}}function Us(e,t,r){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],n=i.callback;if(null!==n){if(i.callback=null,i=r,"function"!==typeof n)throw Error(s(191,n));n.call(i)}}}var Vs={},Bs=bn(Vs),js=bn(Vs),Hs=bn(Vs);function Gs(e){if(e===Vs)throw Error(s(174));return e}function Zs(e,t){switch(xn(Hs,t),xn(js,e),xn(Bs,Vs),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}wn(Bs),xn(Bs,t)}function $s(){wn(Bs),wn(js),wn(Hs)}function qs(e){Gs(Hs.current);var t=Gs(Bs.current),r=le(t,e.type);t!==r&&(xn(js,e),xn(Bs,r))}function Ws(e){js.current===e&&(wn(Bs),wn(js))}var Ys=bn(0);function Xs(e){for(var t=e;null!==t;){if(13===t.tag){var r=t.memoizedState;if(null!==r&&(null===(r=r.dehydrated)||"$?"===r.data||"$!"===r.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Js=[];function Ks(){for(var e=0;e<Js.length;e++)Js[e]._workInProgressVersionPrimary=null;Js.length=0}var Qs=b.ReactCurrentDispatcher,eo=b.ReactCurrentBatchConfig,to=0,ro=null,io=null,no=null,so=!1,oo=!1,ao=0,lo=0;function co(){throw Error(s(321))}function uo(e,t){if(null===t)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!ri(e[r],t[r]))return!1;return!0}function ho(e,t,r,i,n,o){if(to=o,ro=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Qs.current=null===e||null===e.memoizedState?Yo:Xo,e=r(i,n),oo){o=0;do{if(oo=!1,ao=0,25<=o)throw Error(s(301));o+=1,no=io=null,t.updateQueue=null,Qs.current=Jo,e=r(i,n)}while(oo)}if(Qs.current=Wo,t=null!==io&&null!==io.next,to=0,no=io=ro=null,so=!1,t)throw Error(s(300));return e}function po(){var e=0!==ao;return ao=0,e}function fo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===no?ro.memoizedState=no=e:no=no.next=e,no}function mo(){if(null===io){var e=ro.alternate;e=null!==e?e.memoizedState:null}else e=io.next;var t=null===no?ro.memoizedState:no.next;if(null!==t)no=t,io=e;else{if(null===e)throw Error(s(310));e={memoizedState:(io=e).memoizedState,baseState:io.baseState,baseQueue:io.baseQueue,queue:io.queue,next:null},null===no?ro.memoizedState=no=e:no=no.next=e}return no}function go(e,t){return"function"===typeof t?t(e):t}function yo(e){var t=mo(),r=t.queue;if(null===r)throw Error(s(311));r.lastRenderedReducer=e;var i=io,n=i.baseQueue,o=r.pending;if(null!==o){if(null!==n){var a=n.next;n.next=o.next,o.next=a}i.baseQueue=n=o,r.pending=null}if(null!==n){o=n.next,i=i.baseState;var l=a=null,c=null,u=o;do{var h=u.lane;if((to&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,a=i):c=c.next=d,ro.lanes|=h,Il|=h}u=u.next}while(null!==u&&u!==o);null===c?a=i:c.next=l,ri(i,t.memoizedState)||(ma=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=c,r.lastRenderedState=i}if(null!==(e=r.interleaved)){n=e;do{o=n.lane,ro.lanes|=o,Il|=o,n=n.next}while(n!==e)}else null===n&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function _o(e){var t=mo(),r=t.queue;if(null===r)throw Error(s(311));r.lastRenderedReducer=e;var i=r.dispatch,n=r.pending,o=t.memoizedState;if(null!==n){r.pending=null;var a=n=n.next;do{o=e(o,a.action),a=a.next}while(a!==n);ri(o,t.memoizedState)||(ma=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),r.lastRenderedState=o}return[o,i]}function vo(){}function bo(e,t){var r=ro,i=mo(),n=t(),o=!ri(i.memoizedState,n);if(o&&(i.memoizedState=n,ma=!0),i=i.queue,Io(So.bind(null,r,i,e),[e]),i.getSnapshot!==t||o||null!==no&&1&no.memoizedState.tag){if(r.flags|=2048,Co(9,xo.bind(null,r,i,n,t),void 0,null),null===Ml)throw Error(s(349));0!==(30&to)||wo(r,t,n)}return n}function wo(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},null===(t=ro.updateQueue)?(t={lastEffect:null,stores:null},ro.updateQueue=t,t.stores=[e]):null===(r=t.stores)?t.stores=[e]:r.push(e)}function xo(e,t,r,i){t.value=r,t.getSnapshot=i,To(t)&&Mo(e)}function So(e,t,r){return r((function(){To(t)&&Mo(e)}))}function To(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!ri(e,r)}catch(i){return!0}}function Mo(e){var t=Ps(e,1);null!==t&&Kl(t,e,1,-1)}function Ao(e){var t=fo();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:go,lastRenderedState:e},t.queue=e,e=e.dispatch=Go.bind(null,ro,e),[t.memoizedState,e]}function Co(e,t,r,i){return e={tag:e,create:t,destroy:r,deps:i,next:null},null===(t=ro.updateQueue)?(t={lastEffect:null,stores:null},ro.updateQueue=t,t.lastEffect=e.next=e):null===(r=t.lastEffect)?t.lastEffect=e.next=e:(i=r.next,r.next=e,e.next=i,t.lastEffect=e),e}function Eo(){return mo().memoizedState}function Ro(e,t,r,i){var n=fo();ro.flags|=e,n.memoizedState=Co(1|t,r,void 0,void 0===i?null:i)}function Po(e,t,r,i){var n=mo();i=void 0===i?null:i;var s=void 0;if(null!==io){var o=io.memoizedState;if(s=o.destroy,null!==i&&uo(i,o.deps))return void(n.memoizedState=Co(t,r,s,i))}ro.flags|=e,n.memoizedState=Co(1|t,r,s,i)}function Oo(e,t){return Ro(8390656,8,e,t)}function Io(e,t){return Po(2048,8,e,t)}function Lo(e,t){return Po(4,2,e,t)}function No(e,t){return Po(4,4,e,t)}function Do(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Fo(e,t,r){return r=null!==r&&void 0!==r?r.concat([e]):null,Po(4,4,Do.bind(null,t,e),r)}function ko(){}function zo(e,t){var r=mo();t=void 0===t?null:t;var i=r.memoizedState;return null!==i&&null!==t&&uo(t,i[1])?i[0]:(r.memoizedState=[e,t],e)}function Uo(e,t){var r=mo();t=void 0===t?null:t;var i=r.memoizedState;return null!==i&&null!==t&&uo(t,i[1])?i[0]:(e=e(),r.memoizedState=[e,t],e)}function Vo(e,t,r){return 0===(21&to)?(e.baseState&&(e.baseState=!1,ma=!0),e.memoizedState=r):(ri(r,t)||(r=ft(),ro.lanes|=r,Il|=r,e.baseState=!0),t)}function Bo(e,t){var r=_t;_t=0!==r&&4>r?r:4,e(!0);var i=eo.transition;eo.transition={};try{e(!1),t()}finally{_t=r,eo.transition=i}}function jo(){return mo().memoizedState}function Ho(e,t,r){var i=Jl(e);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},Zo(e))$o(t,r);else if(null!==(r=Rs(e,t,r,i))){Kl(r,e,i,Xl()),qo(r,t,i)}}function Go(e,t,r){var i=Jl(e),n={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(Zo(e))$o(t,n);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var o=t.lastRenderedState,a=s(o,r);if(n.hasEagerState=!0,n.eagerState=a,ri(a,o)){var l=t.interleaved;return null===l?(n.next=n,Es(t)):(n.next=l.next,l.next=n),void(t.interleaved=n)}}catch(c){}null!==(r=Rs(e,t,n,i))&&(Kl(r,e,i,n=Xl()),qo(r,t,i))}}function Zo(e){var t=e.alternate;return e===ro||null!==t&&t===ro}function $o(e,t){oo=so=!0;var r=e.pending;null===r?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function qo(e,t,r){if(0!==(4194240&r)){var i=t.lanes;r|=i&=e.pendingLanes,t.lanes=r,yt(e,r)}}var Wo={readContext:As,useCallback:co,useContext:co,useEffect:co,useImperativeHandle:co,useInsertionEffect:co,useLayoutEffect:co,useMemo:co,useReducer:co,useRef:co,useState:co,useDebugValue:co,useDeferredValue:co,useTransition:co,useMutableSource:co,useSyncExternalStore:co,useId:co,unstable_isNewReconciler:!1},Yo={readContext:As,useCallback:function(e,t){return fo().memoizedState=[e,void 0===t?null:t],e},useContext:As,useEffect:Oo,useImperativeHandle:function(e,t,r){return r=null!==r&&void 0!==r?r.concat([e]):null,Ro(4194308,4,Do.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Ro(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ro(4,2,e,t)},useMemo:function(e,t){var r=fo();return t=void 0===t?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var i=fo();return t=void 0!==r?r(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Ho.bind(null,ro,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},fo().memoizedState=e},useState:Ao,useDebugValue:ko,useDeferredValue:function(e){return fo().memoizedState=e},useTransition:function(){var e=Ao(!1),t=e[0];return e=Bo.bind(null,e[1]),fo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var i=ro,n=fo();if(es){if(void 0===r)throw Error(s(407));r=r()}else{if(r=t(),null===Ml)throw Error(s(349));0!==(30&to)||wo(i,t,r)}n.memoizedState=r;var o={value:r,getSnapshot:t};return n.queue=o,Oo(So.bind(null,i,o,e),[e]),i.flags|=2048,Co(9,xo.bind(null,i,o,r,t),void 0,null),r},useId:function(){var e=fo(),t=Ml.identifierPrefix;if(es){var r=qn;t=":"+t+"R"+(r=($n&~(1<<32-st($n)-1)).toString(32)+r),0<(r=ao++)&&(t+="H"+r.toString(32)),t+=":"}else t=":"+t+"r"+(r=lo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Xo={readContext:As,useCallback:zo,useContext:As,useEffect:Io,useImperativeHandle:Fo,useInsertionEffect:Lo,useLayoutEffect:No,useMemo:Uo,useReducer:yo,useRef:Eo,useState:function(){return yo(go)},useDebugValue:ko,useDeferredValue:function(e){return Vo(mo(),io.memoizedState,e)},useTransition:function(){return[yo(go)[0],mo().memoizedState]},useMutableSource:vo,useSyncExternalStore:bo,useId:jo,unstable_isNewReconciler:!1},Jo={readContext:As,useCallback:zo,useContext:As,useEffect:Io,useImperativeHandle:Fo,useInsertionEffect:Lo,useLayoutEffect:No,useMemo:Uo,useReducer:_o,useRef:Eo,useState:function(){return _o(go)},useDebugValue:ko,useDeferredValue:function(e){var t=mo();return null===io?t.memoizedState=e:Vo(t,io.memoizedState,e)},useTransition:function(){return[_o(go)[0],mo().memoizedState]},useMutableSource:vo,useSyncExternalStore:bo,useId:jo,unstable_isNewReconciler:!1};function Ko(e,t){if(e&&e.defaultProps){for(var r in t=k({},t),e=e.defaultProps)void 0===t[r]&&(t[r]=e[r]);return t}return t}function Qo(e,t,r,i){r=null===(r=r(i,t=e.memoizedState))||void 0===r?t:k({},t,r),e.memoizedState=r,0===e.lanes&&(e.updateQueue.baseState=r)}var ea={isMounted:function(e){return!!(e=e._reactInternals)&&Be(e)===e},enqueueSetState:function(e,t,r){e=e._reactInternals;var i=Xl(),n=Jl(e),s=Ns(i,n);s.payload=t,void 0!==r&&null!==r&&(s.callback=r),null!==(t=Ds(e,s,n))&&(Kl(t,e,n,i),Fs(t,e,n))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var i=Xl(),n=Jl(e),s=Ns(i,n);s.tag=1,s.payload=t,void 0!==r&&null!==r&&(s.callback=r),null!==(t=Ds(e,s,n))&&(Kl(t,e,n,i),Fs(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Xl(),i=Jl(e),n=Ns(r,i);n.tag=2,void 0!==t&&null!==t&&(n.callback=t),null!==(t=Ds(e,n,i))&&(Kl(t,e,i,r),Fs(t,e,i))}};function ta(e,t,r,i,n,s,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,s,o):!t.prototype||!t.prototype.isPureReactComponent||(!ii(r,i)||!ii(n,s))}function ra(e,t,r){var i=!1,n=Sn,s=t.contextType;return"object"===typeof s&&null!==s?s=As(s):(n=En(t)?An:Tn.current,s=(i=null!==(i=t.contextTypes)&&void 0!==i)?Cn(e,n):Sn),t=new t(r,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ea,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=s),t}function ia(e,t,r,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(r,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(r,i),t.state!==e&&ea.enqueueReplaceState(t,t.state,null)}function na(e,t,r,i){var n=e.stateNode;n.props=r,n.state=e.memoizedState,n.refs={},Is(e);var s=t.contextType;"object"===typeof s&&null!==s?n.context=As(s):(s=En(t)?An:Tn.current,n.context=Cn(e,s)),n.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(Qo(e,t,s,r),n.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof n.getSnapshotBeforeUpdate||"function"!==typeof n.UNSAFE_componentWillMount&&"function"!==typeof n.componentWillMount||(t=n.state,"function"===typeof n.componentWillMount&&n.componentWillMount(),"function"===typeof n.UNSAFE_componentWillMount&&n.UNSAFE_componentWillMount(),t!==n.state&&ea.enqueueReplaceState(n,n.state,null),zs(e,r,n,i),n.state=e.memoizedState),"function"===typeof n.componentDidMount&&(e.flags|=4194308)}function sa(e,t){try{var r="",i=t;do{r+=B(i),i=i.return}while(i);var n=r}catch(s){n="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:n,digest:null}}function oa(e,t,r){return{value:e,source:null,stack:null!=r?r:null,digest:null!=t?t:null}}function aa(e,t){try{console.error(t.value)}catch(r){setTimeout((function(){throw r}))}}var la="function"===typeof WeakMap?WeakMap:Map;function ca(e,t,r){(r=Ns(-1,r)).tag=3,r.payload={element:null};var i=t.value;return r.callback=function(){Vl||(Vl=!0,Bl=i),aa(0,t)},r}function ua(e,t,r){(r=Ns(-1,r)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var n=t.value;r.payload=function(){return i(n)},r.callback=function(){aa(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(r.callback=function(){aa(0,t),"function"!==typeof i&&(null===jl?jl=new Set([this]):jl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),r}function ha(e,t,r){var i=e.pingCache;if(null===i){i=e.pingCache=new la;var n=new Set;i.set(t,n)}else void 0===(n=i.get(t))&&(n=new Set,i.set(t,n));n.has(r)||(n.add(r),e=wc.bind(null,e,t,r),t.then(e,e))}function da(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function pa(e,t,r,i,n){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,1===r.tag&&(null===r.alternate?r.tag=17:((t=Ns(-1,1)).tag=2,Ds(r,t,1))),r.lanes|=1),e):(e.flags|=65536,e.lanes=n,e)}var fa=b.ReactCurrentOwner,ma=!1;function ga(e,t,r,i){t.child=null===e?ys(t,null,r,i):gs(t,e.child,r,i)}function ya(e,t,r,i,n){r=r.render;var s=t.ref;return Ms(t,n),i=ho(e,t,r,i,s,n),r=po(),null===e||ma?(es&&r&&Xn(t),t.flags|=1,ga(e,t,i,n),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,Va(e,t,n))}function _a(e,t,r,i,n){if(null===e){var s=r.type;return"function"!==typeof s||Ec(s)||void 0!==s.defaultProps||null!==r.compare||void 0!==r.defaultProps?((e=Pc(r.type,null,i,t,t.mode,n)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,va(e,t,s,i,n))}if(s=e.child,0===(e.lanes&n)){var o=s.memoizedProps;if((r=null!==(r=r.compare)?r:ii)(o,i)&&e.ref===t.ref)return Va(e,t,n)}return t.flags|=1,(e=Rc(s,i)).ref=t.ref,e.return=t,t.child=e}function va(e,t,r,i,n){if(null!==e){var s=e.memoizedProps;if(ii(s,i)&&e.ref===t.ref){if(ma=!1,t.pendingProps=i=s,0===(e.lanes&n))return t.lanes=e.lanes,Va(e,t,n);0!==(131072&e.flags)&&(ma=!0)}}return xa(e,t,r,i,n)}function ba(e,t,r){var i=t.pendingProps,n=i.children,s=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},xn(Rl,El),El|=r;else{if(0===(1073741824&r))return e=null!==s?s.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,xn(Rl,El),El|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==s?s.baseLanes:r,xn(Rl,El),El|=i}else null!==s?(i=s.baseLanes|r,t.memoizedState=null):i=r,xn(Rl,El),El|=i;return ga(e,t,n,r),t.child}function wa(e,t){var r=t.ref;(null===e&&null!==r||null!==e&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function xa(e,t,r,i,n){var s=En(r)?An:Tn.current;return s=Cn(t,s),Ms(t,n),r=ho(e,t,r,i,s,n),i=po(),null===e||ma?(es&&i&&Xn(t),t.flags|=1,ga(e,t,r,n),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,Va(e,t,n))}function Sa(e,t,r,i,n){if(En(r)){var s=!0;In(t)}else s=!1;if(Ms(t,n),null===t.stateNode)Ua(e,t),ra(t,r,i),na(t,r,i,n),i=!0;else if(null===e){var o=t.stateNode,a=t.memoizedProps;o.props=a;var l=o.context,c=r.contextType;"object"===typeof c&&null!==c?c=As(c):c=Cn(t,c=En(r)?An:Tn.current);var u=r.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==i||l!==c)&&ia(t,o,i,c),Os=!1;var d=t.memoizedState;o.state=d,zs(t,i,o,n),l=t.memoizedState,a!==i||d!==l||Mn.current||Os?("function"===typeof u&&(Qo(t,r,u,i),l=t.memoizedState),(a=Os||ta(t,r,a,i,d,l,c))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):("function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,Ls(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:Ko(t.type,a),o.props=c,h=t.pendingProps,d=o.context,"object"===typeof(l=r.contextType)&&null!==l?l=As(l):l=Cn(t,l=En(r)?An:Tn.current);var p=r.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==h||d!==l)&&ia(t,o,i,l),Os=!1,d=t.memoizedState,o.state=d,zs(t,i,o,n);var f=t.memoizedState;a!==h||d!==f||Mn.current||Os?("function"===typeof p&&(Qo(t,r,p,i),f=t.memoizedState),(c=Os||ta(t,r,c,i,d,f,l)||!1)?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,f,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),o.props=i,o.state=f,o.context=l,i=c):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return Ta(e,t,r,i,s,n)}function Ta(e,t,r,i,n,s){wa(e,t);var o=0!==(128&t.flags);if(!i&&!o)return n&&Ln(t,r,!1),Va(e,t,s);i=t.stateNode,fa.current=t;var a=o&&"function"!==typeof r.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&o?(t.child=gs(t,e.child,null,s),t.child=gs(t,null,a,s)):ga(e,t,a,s),t.memoizedState=i.state,n&&Ln(t,r,!0),t.child}function Ma(e){var t=e.stateNode;t.pendingContext?Pn(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Pn(0,t.context,!1),Zs(e,t.containerInfo)}function Aa(e,t,r,i,n){return cs(),us(n),t.flags|=256,ga(e,t,r,i),t.child}var Ca,Ea,Ra,Pa,Oa={dehydrated:null,treeContext:null,retryLane:0};function Ia(e){return{baseLanes:e,cachePool:null,transitions:null}}function La(e,t,r){var i,n=t.pendingProps,o=Ys.current,a=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&o)),i?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),xn(Ys,1&o),null===e)return ss(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=n.children,e=n.fallback,a?(n=t.mode,a=t.child,l={mode:"hidden",children:l},0===(1&n)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=Ic(l,n,0,null),e=Oc(e,n,r,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Ia(r),t.memoizedState=Oa,e):Na(t,l));if(null!==(o=e.memoizedState)&&null!==(i=o.dehydrated))return function(e,t,r,i,n,o,a){if(r)return 256&t.flags?(t.flags&=-257,Da(e,t,a,i=oa(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=i.fallback,n=t.mode,i=Ic({mode:"visible",children:i.children},n,0,null),(o=Oc(o,n,a,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,0!==(1&t.mode)&&gs(t,e.child,null,a),t.child.memoizedState=Ia(a),t.memoizedState=Oa,o);if(0===(1&t.mode))return Da(e,t,a,null);if("$!"===n.data){if(i=n.nextSibling&&n.nextSibling.dataset)var l=i.dgst;return i=l,Da(e,t,a,i=oa(o=Error(s(419)),i,void 0))}if(l=0!==(a&e.childLanes),ma||l){if(null!==(i=Ml)){switch(a&-a){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}0!==(n=0!==(n&(i.suspendedLanes|a))?0:n)&&n!==o.retryLane&&(o.retryLane=n,Ps(e,n),Kl(i,e,n,-1))}return hc(),Da(e,t,a,i=oa(Error(s(421))))}return"$?"===n.data?(t.flags|=128,t.child=e.child,t=Sc.bind(null,e),n._reactRetry=t,null):(e=o.treeContext,Qn=sn(n.nextSibling),Kn=t,es=!0,ts=null,null!==e&&(Hn[Gn++]=$n,Hn[Gn++]=qn,Hn[Gn++]=Zn,$n=e.id,qn=e.overflow,Zn=t),t=Na(t,i.children),t.flags|=4096,t)}(e,t,l,n,i,o,r);if(a){a=n.fallback,l=t.mode,i=(o=e.child).sibling;var c={mode:"hidden",children:n.children};return 0===(1&l)&&t.child!==o?((n=t.child).childLanes=0,n.pendingProps=c,t.deletions=null):(n=Rc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==i?a=Rc(i,a):(a=Oc(a,l,r,null)).flags|=2,a.return=t,n.return=t,n.sibling=a,t.child=n,n=a,a=t.child,l=null===(l=e.child.memoizedState)?Ia(r):{baseLanes:l.baseLanes|r,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~r,t.memoizedState=Oa,n}return e=(a=e.child).sibling,n=Rc(a,{mode:"visible",children:n.children}),0===(1&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function Na(e,t){return(t=Ic({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Da(e,t,r,i){return null!==i&&us(i),gs(t,e.child,null,r),(e=Na(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Fa(e,t,r){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Ts(e.return,t,r)}function ka(e,t,r,i,n){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:n}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=r,s.tailMode=n)}function za(e,t,r){var i=t.pendingProps,n=i.revealOrder,s=i.tail;if(ga(e,t,i.children,r),0!==(2&(i=Ys.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Fa(e,r,t);else if(19===e.tag)Fa(e,r,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(xn(Ys,i),0===(1&t.mode))t.memoizedState=null;else switch(n){case"forwards":for(r=t.child,n=null;null!==r;)null!==(e=r.alternate)&&null===Xs(e)&&(n=r),r=r.sibling;null===(r=n)?(n=t.child,t.child=null):(n=r.sibling,r.sibling=null),ka(t,!1,n,r,s);break;case"backwards":for(r=null,n=t.child,t.child=null;null!==n;){if(null!==(e=n.alternate)&&null===Xs(e)){t.child=n;break}e=n.sibling,n.sibling=r,r=n,n=e}ka(t,!0,r,null,s);break;case"together":ka(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ua(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Va(e,t,r){if(null!==e&&(t.dependencies=e.dependencies),Il|=t.lanes,0===(r&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(r=Rc(e=t.child,e.pendingProps),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=Rc(e,e.pendingProps)).return=t;r.sibling=null}return t.child}function Ba(e,t){if(!es)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var i=null;null!==r;)null!==r.alternate&&(i=r),r=r.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function ja(e){var t=null!==e.alternate&&e.alternate.child===e.child,r=0,i=0;if(t)for(var n=e.child;null!==n;)r|=n.lanes|n.childLanes,i|=14680064&n.subtreeFlags,i|=14680064&n.flags,n.return=e,n=n.sibling;else for(n=e.child;null!==n;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags,i|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=i,e.childLanes=r,t}function Ha(e,t,r){var i=t.pendingProps;switch(Jn(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ja(t),null;case 1:case 17:return En(t.type)&&Rn(),ja(t),null;case 3:return i=t.stateNode,$s(),wn(Mn),wn(Tn),Ks(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(as(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ts&&(rc(ts),ts=null))),Ea(e,t),ja(t),null;case 5:Ws(t);var n=Gs(Hs.current);if(r=t.type,null!==e&&null!=t.stateNode)Ra(e,t,r,i,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(s(166));return ja(t),null}if(e=Gs(Bs.current),as(t)){i=t.stateNode,r=t.type;var o=t.memoizedProps;switch(i[ln]=t,i[cn]=o,e=0!==(1&t.mode),r){case"dialog":Ni("cancel",i),Ni("close",i);break;case"iframe":case"object":case"embed":Ni("load",i);break;case"video":case"audio":for(n=0;n<Pi.length;n++)Ni(Pi[n],i);break;case"source":Ni("error",i);break;case"img":case"image":case"link":Ni("error",i),Ni("load",i);break;case"details":Ni("toggle",i);break;case"input":X(i,o),Ni("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Ni("invalid",i);break;case"textarea":ne(i,o),Ni("invalid",i)}for(var l in ye(r,o),n=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"===typeof c?i.textContent!==c&&(!0!==o.suppressHydrationWarning&&qi(i.textContent,c,e),n=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&qi(i.textContent,c,e),n=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Ni("scroll",i)}switch(r){case"input":$(i),Q(i,o,!0);break;case"textarea":$(i),oe(i);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(i.onclick=Wi)}i=n,t.updateQueue=i,null!==i&&(t.flags|=4)}else{l=9===n.nodeType?n:n.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(r)),"http://www.w3.org/1999/xhtml"===e?"script"===r?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=l.createElement(r,{is:i.is}):(e=l.createElement(r),"select"===r&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,r),e[ln]=t,e[cn]=i,Ca(e,t,!1,!1),t.stateNode=e;e:{switch(l=_e(r,i),r){case"dialog":Ni("cancel",e),Ni("close",e),n=i;break;case"iframe":case"object":case"embed":Ni("load",e),n=i;break;case"video":case"audio":for(n=0;n<Pi.length;n++)Ni(Pi[n],e);n=i;break;case"source":Ni("error",e),n=i;break;case"img":case"image":case"link":Ni("error",e),Ni("load",e),n=i;break;case"details":Ni("toggle",e),n=i;break;case"input":X(e,i),n=Y(e,i),Ni("invalid",e);break;case"option":default:n=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},n=k({},i,{value:void 0}),Ni("invalid",e);break;case"textarea":ne(e,i),n=ie(e,i),Ni("invalid",e)}for(o in ye(r,n),c=n)if(c.hasOwnProperty(o)){var u=c[o];"style"===o?me(e,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&ue(e,u):"children"===o?"string"===typeof u?("textarea"!==r||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(a.hasOwnProperty(o)?null!=u&&"onScroll"===o&&Ni("scroll",e):null!=u&&v(e,o,u,l))}switch(r){case"input":$(e),Q(e,i,!1);break;case"textarea":$(e),oe(e);break;case"option":null!=i.value&&e.setAttribute("value",""+G(i.value));break;case"select":e.multiple=!!i.multiple,null!=(o=i.value)?re(e,!!i.multiple,o,!1):null!=i.defaultValue&&re(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof n.onClick&&(e.onclick=Wi)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return ja(t),null;case 6:if(e&&null!=t.stateNode)Pa(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(s(166));if(r=Gs(Hs.current),Gs(Bs.current),as(t)){if(i=t.stateNode,r=t.memoizedProps,i[ln]=t,(o=i.nodeValue!==r)&&null!==(e=Kn))switch(e.tag){case 3:qi(i.nodeValue,r,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&qi(i.nodeValue,r,0!==(1&e.mode))}o&&(t.flags|=4)}else(i=(9===r.nodeType?r:r.ownerDocument).createTextNode(i))[ln]=t,t.stateNode=i}return ja(t),null;case 13:if(wn(Ys),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(es&&null!==Qn&&0!==(1&t.mode)&&0===(128&t.flags))ls(),cs(),t.flags|=98560,o=!1;else if(o=as(t),null!==i&&null!==i.dehydrated){if(null===e){if(!o)throw Error(s(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(s(317));o[ln]=t}else cs(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;ja(t),o=!1}else null!==ts&&(rc(ts),ts=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=r,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Ys.current)?0===Pl&&(Pl=3):hc())),null!==t.updateQueue&&(t.flags|=4),ja(t),null);case 4:return $s(),Ea(e,t),null===e&&ki(t.stateNode.containerInfo),ja(t),null;case 10:return Ss(t.type._context),ja(t),null;case 19:if(wn(Ys),null===(o=t.memoizedState))return ja(t),null;if(i=0!==(128&t.flags),null===(l=o.rendering))if(i)Ba(o,!1);else{if(0!==Pl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=Xs(e))){for(t.flags|=128,Ba(o,!1),null!==(i=l.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=r,r=t.child;null!==r;)e=i,(o=r).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return xn(Ys,1&Ys.current|2),t.child}e=e.sibling}null!==o.tail&&Xe()>zl&&(t.flags|=128,i=!0,Ba(o,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=Xs(l))){if(t.flags|=128,i=!0,null!==(r=e.updateQueue)&&(t.updateQueue=r,t.flags|=4),Ba(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!es)return ja(t),null}else 2*Xe()-o.renderingStartTime>zl&&1073741824!==r&&(t.flags|=128,i=!0,Ba(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(null!==(r=o.last)?r.sibling=l:t.child=l,o.last=l)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Xe(),t.sibling=null,r=Ys.current,xn(Ys,i?1&r|2:1&r),t):(ja(t),null);case 22:case 23:return ac(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&El)&&(ja(t),6&t.subtreeFlags&&(t.flags|=8192)):ja(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function Ga(e,t){switch(Jn(t),t.tag){case 1:return En(t.type)&&Rn(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return $s(),wn(Mn),wn(Tn),Ks(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Ws(t),null;case 13:if(wn(Ys),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));cs()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return wn(Ys),null;case 4:return $s(),null;case 10:return Ss(t.type._context),null;case 22:case 23:return ac(),null;default:return null}}Ca=function(e,t){for(var r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}},Ea=function(){},Ra=function(e,t,r,i){var n=e.memoizedProps;if(n!==i){e=t.stateNode,Gs(Bs.current);var s,o=null;switch(r){case"input":n=Y(e,n),i=Y(e,i),o=[];break;case"select":n=k({},n,{value:void 0}),i=k({},i,{value:void 0}),o=[];break;case"textarea":n=ie(e,n),i=ie(e,i),o=[];break;default:"function"!==typeof n.onClick&&"function"===typeof i.onClick&&(e.onclick=Wi)}for(u in ye(r,i),r=null,n)if(!i.hasOwnProperty(u)&&n.hasOwnProperty(u)&&null!=n[u])if("style"===u){var l=n[u];for(s in l)l.hasOwnProperty(s)&&(r||(r={}),r[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=n?n[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(r||(r={}),r[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(r||(r={}),r[s]=c[s])}else r||(o||(o=[]),o.push(u,r)),r=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Ni("scroll",e),o||l===c||(o=[])):(o=o||[]).push(u,c))}r&&(o=o||[]).push("style",r);var u=o;(t.updateQueue=u)&&(t.flags|=4)}},Pa=function(e,t,r,i){r!==i&&(t.flags|=4)};var Za=!1,$a=!1,qa="function"===typeof WeakSet?WeakSet:Set,Wa=null;function Ya(e,t){var r=e.ref;if(null!==r)if("function"===typeof r)try{r(null)}catch(i){bc(e,t,i)}else r.current=null}function Xa(e,t,r){try{r()}catch(i){bc(e,t,i)}}var Ja=!1;function Ka(e,t,r){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var n=i=i.next;do{if((n.tag&e)===e){var s=n.destroy;n.destroy=void 0,void 0!==s&&Xa(t,r,s)}n=n.next}while(n!==i)}}function Qa(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var r=t=t.next;do{if((r.tag&e)===e){var i=r.create;r.destroy=i()}r=r.next}while(r!==t)}}function el(e){var t=e.ref;if(null!==t){var r=e.stateNode;e.tag,e=r,"function"===typeof t?t(e):t.current=e}}function tl(e){var t=e.alternate;null!==t&&(e.alternate=null,tl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ln],delete t[cn],delete t[hn],delete t[dn],delete t[pn])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function rl(e){return 5===e.tag||3===e.tag||4===e.tag}function il(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||rl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function nl(e,t,r){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===r.nodeType?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(8===r.nodeType?(t=r.parentNode).insertBefore(e,r):(t=r).appendChild(e),null!==(r=r._reactRootContainer)&&void 0!==r||null!==t.onclick||(t.onclick=Wi));else if(4!==i&&null!==(e=e.child))for(nl(e,t,r),e=e.sibling;null!==e;)nl(e,t,r),e=e.sibling}function sl(e,t,r){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(4!==i&&null!==(e=e.child))for(sl(e,t,r),e=e.sibling;null!==e;)sl(e,t,r),e=e.sibling}var ol=null,al=!1;function ll(e,t,r){for(r=r.child;null!==r;)cl(e,t,r),r=r.sibling}function cl(e,t,r){if(nt&&"function"===typeof nt.onCommitFiberUnmount)try{nt.onCommitFiberUnmount(it,r)}catch(a){}switch(r.tag){case 5:$a||Ya(r,t);case 6:var i=ol,n=al;ol=null,ll(e,t,r),al=n,null!==(ol=i)&&(al?(e=ol,r=r.stateNode,8===e.nodeType?e.parentNode.removeChild(r):e.removeChild(r)):ol.removeChild(r.stateNode));break;case 18:null!==ol&&(al?(e=ol,r=r.stateNode,8===e.nodeType?nn(e.parentNode,r):1===e.nodeType&&nn(e,r),Bt(e)):nn(ol,r.stateNode));break;case 4:i=ol,n=al,ol=r.stateNode.containerInfo,al=!0,ll(e,t,r),ol=i,al=n;break;case 0:case 11:case 14:case 15:if(!$a&&(null!==(i=r.updateQueue)&&null!==(i=i.lastEffect))){n=i=i.next;do{var s=n,o=s.destroy;s=s.tag,void 0!==o&&(0!==(2&s)||0!==(4&s))&&Xa(r,t,o),n=n.next}while(n!==i)}ll(e,t,r);break;case 1:if(!$a&&(Ya(r,t),"function"===typeof(i=r.stateNode).componentWillUnmount))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(a){bc(r,t,a)}ll(e,t,r);break;case 21:ll(e,t,r);break;case 22:1&r.mode?($a=(i=$a)||null!==r.memoizedState,ll(e,t,r),$a=i):ll(e,t,r);break;default:ll(e,t,r)}}function ul(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var r=e.stateNode;null===r&&(r=e.stateNode=new qa),t.forEach((function(t){var i=Tc.bind(null,e,t);r.has(t)||(r.add(t),t.then(i,i))}))}}function hl(e,t){var r=t.deletions;if(null!==r)for(var i=0;i<r.length;i++){var n=r[i];try{var o=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:ol=l.stateNode,al=!1;break e;case 3:case 4:ol=l.stateNode.containerInfo,al=!0;break e}l=l.return}if(null===ol)throw Error(s(160));cl(o,a,n),ol=null,al=!1;var c=n.alternate;null!==c&&(c.return=null),n.return=null}catch(u){bc(n,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)dl(t,e),t=t.sibling}function dl(e,t){var r=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(hl(t,e),pl(e),4&i){try{Ka(3,e,e.return),Qa(3,e)}catch(g){bc(e,e.return,g)}try{Ka(5,e,e.return)}catch(g){bc(e,e.return,g)}}break;case 1:hl(t,e),pl(e),512&i&&null!==r&&Ya(r,r.return);break;case 5:if(hl(t,e),pl(e),512&i&&null!==r&&Ya(r,r.return),32&e.flags){var n=e.stateNode;try{he(n,"")}catch(g){bc(e,e.return,g)}}if(4&i&&null!=(n=e.stateNode)){var o=e.memoizedProps,a=null!==r?r.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&J(n,o),_e(l,a);var u=_e(l,o);for(a=0;a<c.length;a+=2){var h=c[a],d=c[a+1];"style"===h?me(n,d):"dangerouslySetInnerHTML"===h?ue(n,d):"children"===h?he(n,d):v(n,h,d,u)}switch(l){case"input":K(n,o);break;case"textarea":se(n,o);break;case"select":var p=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!o.multiple;var f=o.value;null!=f?re(n,!!o.multiple,f,!1):p!==!!o.multiple&&(null!=o.defaultValue?re(n,!!o.multiple,o.defaultValue,!0):re(n,!!o.multiple,o.multiple?[]:"",!1))}n[cn]=o}catch(g){bc(e,e.return,g)}}break;case 6:if(hl(t,e),pl(e),4&i){if(null===e.stateNode)throw Error(s(162));n=e.stateNode,o=e.memoizedProps;try{n.nodeValue=o}catch(g){bc(e,e.return,g)}}break;case 3:if(hl(t,e),pl(e),4&i&&null!==r&&r.memoizedState.isDehydrated)try{Bt(t.containerInfo)}catch(g){bc(e,e.return,g)}break;case 4:default:hl(t,e),pl(e);break;case 13:hl(t,e),pl(e),8192&(n=e.child).flags&&(o=null!==n.memoizedState,n.stateNode.isHidden=o,!o||null!==n.alternate&&null!==n.alternate.memoizedState||(kl=Xe())),4&i&&ul(e);break;case 22:if(h=null!==r&&null!==r.memoizedState,1&e.mode?($a=(u=$a)||h,hl(t,e),$a=u):hl(t,e),pl(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!h&&0!==(1&e.mode))for(Wa=e,h=e.child;null!==h;){for(d=Wa=h;null!==Wa;){switch(f=(p=Wa).child,p.tag){case 0:case 11:case 14:case 15:Ka(4,p,p.return);break;case 1:Ya(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){i=p,r=p.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){bc(i,r,g)}}break;case 5:Ya(p,p.return);break;case 22:if(null!==p.memoizedState){yl(d);continue}}null!==f?(f.return=p,Wa=f):yl(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{n=d.stateNode,u?"function"===typeof(o=n.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=d.stateNode,a=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=fe("display",a))}catch(g){bc(e,e.return,g)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(g){bc(e,e.return,g)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:hl(t,e),pl(e),4&i&&ul(e);case 21:}}function pl(e){var t=e.flags;if(2&t){try{e:{for(var r=e.return;null!==r;){if(rl(r)){var i=r;break e}r=r.return}throw Error(s(160))}switch(i.tag){case 5:var n=i.stateNode;32&i.flags&&(he(n,""),i.flags&=-33),sl(e,il(e),n);break;case 3:case 4:var o=i.stateNode.containerInfo;nl(e,il(e),o);break;default:throw Error(s(161))}}catch(a){bc(e,e.return,a)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function fl(e,t,r){Wa=e,ml(e,t,r)}function ml(e,t,r){for(var i=0!==(1&e.mode);null!==Wa;){var n=Wa,s=n.child;if(22===n.tag&&i){var o=null!==n.memoizedState||Za;if(!o){var a=n.alternate,l=null!==a&&null!==a.memoizedState||$a;a=Za;var c=$a;if(Za=o,($a=l)&&!c)for(Wa=n;null!==Wa;)l=(o=Wa).child,22===o.tag&&null!==o.memoizedState?_l(n):null!==l?(l.return=o,Wa=l):_l(n);for(;null!==s;)Wa=s,ml(s,t,r),s=s.sibling;Wa=n,Za=a,$a=c}gl(e)}else 0!==(8772&n.subtreeFlags)&&null!==s?(s.return=n,Wa=s):gl(e)}}function gl(e){for(;null!==Wa;){var t=Wa;if(0!==(8772&t.flags)){var r=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:$a||Qa(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!$a)if(null===r)i.componentDidMount();else{var n=t.elementType===t.type?r.memoizedProps:Ko(t.type,r.memoizedProps);i.componentDidUpdate(n,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Us(t,o,i);break;case 3:var a=t.updateQueue;if(null!==a){if(r=null,null!==t.child)switch(t.child.tag){case 5:case 1:r=t.child.stateNode}Us(t,a,r)}break;case 5:var l=t.stateNode;if(null===r&&4&t.flags){r=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Bt(d)}}}break;default:throw Error(s(163))}$a||512&t.flags&&el(t)}catch(p){bc(t,t.return,p)}}if(t===e){Wa=null;break}if(null!==(r=t.sibling)){r.return=t.return,Wa=r;break}Wa=t.return}}function yl(e){for(;null!==Wa;){var t=Wa;if(t===e){Wa=null;break}var r=t.sibling;if(null!==r){r.return=t.return,Wa=r;break}Wa=t.return}}function _l(e){for(;null!==Wa;){var t=Wa;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{Qa(4,t)}catch(l){bc(t,r,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var n=t.return;try{i.componentDidMount()}catch(l){bc(t,n,l)}}var s=t.return;try{el(t)}catch(l){bc(t,s,l)}break;case 5:var o=t.return;try{el(t)}catch(l){bc(t,o,l)}}}catch(l){bc(t,t.return,l)}if(t===e){Wa=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Wa=a;break}Wa=t.return}}var vl,bl=Math.ceil,wl=b.ReactCurrentDispatcher,xl=b.ReactCurrentOwner,Sl=b.ReactCurrentBatchConfig,Tl=0,Ml=null,Al=null,Cl=0,El=0,Rl=bn(0),Pl=0,Ol=null,Il=0,Ll=0,Nl=0,Dl=null,Fl=null,kl=0,zl=1/0,Ul=null,Vl=!1,Bl=null,jl=null,Hl=!1,Gl=null,Zl=0,$l=0,ql=null,Wl=-1,Yl=0;function Xl(){return 0!==(6&Tl)?Xe():-1!==Wl?Wl:Wl=Xe()}function Jl(e){return 0===(1&e.mode)?1:0!==(2&Tl)&&0!==Cl?Cl&-Cl:null!==hs.transition?(0===Yl&&(Yl=ft()),Yl):0!==(e=_t)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function Kl(e,t,r,i){if(50<$l)throw $l=0,ql=null,Error(s(185));gt(e,r,i),0!==(2&Tl)&&e===Ml||(e===Ml&&(0===(2&Tl)&&(Ll|=r),4===Pl&&ic(e,Cl)),Ql(e,i),1===r&&0===Tl&&0===(1&t.mode)&&(zl=Xe()+500,Dn&&zn()))}function Ql(e,t){var r=e.callbackNode;!function(e,t){for(var r=e.suspendedLanes,i=e.pingedLanes,n=e.expirationTimes,s=e.pendingLanes;0<s;){var o=31-st(s),a=1<<o,l=n[o];-1===l?0!==(a&r)&&0===(a&i)||(n[o]=dt(a,t)):l<=t&&(e.expiredLanes|=a),s&=~a}}(e,t);var i=ht(e,e===Ml?Cl:0);if(0===i)null!==r&&qe(r),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=r&&qe(r),1===t)0===e.tag?function(e){Dn=!0,kn(e)}(nc.bind(null,e)):kn(nc.bind(null,e)),tn((function(){0===(6&Tl)&&zn()})),r=null;else{switch(vt(i)){case 1:r=Ke;break;case 4:r=Qe;break;case 16:default:r=et;break;case 536870912:r=rt}r=Mc(r,ec.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function ec(e,t){if(Wl=-1,Yl=0,0!==(6&Tl))throw Error(s(327));var r=e.callbackNode;if(_c()&&e.callbackNode!==r)return null;var i=ht(e,e===Ml?Cl:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=dc(e,i);else{t=i;var n=Tl;Tl|=2;var o=uc();for(Ml===e&&Cl===t||(Ul=null,zl=Xe()+500,lc(e,t));;)try{fc();break}catch(l){cc(e,l)}xs(),wl.current=o,Tl=n,null!==Al?t=0:(Ml=null,Cl=0,t=Pl)}if(0!==t){if(2===t&&(0!==(n=pt(e))&&(i=n,t=tc(e,n))),1===t)throw r=Ol,lc(e,0),ic(e,i),Ql(e,Xe()),r;if(6===t)ic(e,i);else{if(n=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var r=t.updateQueue;if(null!==r&&null!==(r=r.stores))for(var i=0;i<r.length;i++){var n=r[i],s=n.getSnapshot;n=n.value;try{if(!ri(s(),n))return!1}catch(a){return!1}}}if(r=t.child,16384&t.subtreeFlags&&null!==r)r.return=t,t=r;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(n)&&(2===(t=dc(e,i))&&(0!==(o=pt(e))&&(i=o,t=tc(e,o))),1===t))throw r=Ol,lc(e,0),ic(e,i),Ql(e,Xe()),r;switch(e.finishedWork=n,e.finishedLanes=i,t){case 0:case 1:throw Error(s(345));case 2:case 5:yc(e,Fl,Ul);break;case 3:if(ic(e,i),(130023424&i)===i&&10<(t=kl+500-Xe())){if(0!==ht(e,0))break;if(((n=e.suspendedLanes)&i)!==i){Xl(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=Ki(yc.bind(null,e,Fl,Ul),t);break}yc(e,Fl,Ul);break;case 4:if(ic(e,i),(4194240&i)===i)break;for(t=e.eventTimes,n=-1;0<i;){var a=31-st(i);o=1<<a,(a=t[a])>n&&(n=a),i&=~o}if(i=n,10<(i=(120>(i=Xe()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*bl(i/1960))-i)){e.timeoutHandle=Ki(yc.bind(null,e,Fl,Ul),i);break}yc(e,Fl,Ul);break;default:throw Error(s(329))}}}return Ql(e,Xe()),e.callbackNode===r?ec.bind(null,e):null}function tc(e,t){var r=Dl;return e.current.memoizedState.isDehydrated&&(lc(e,t).flags|=256),2!==(e=dc(e,t))&&(t=Fl,Fl=r,null!==t&&rc(t)),e}function rc(e){null===Fl?Fl=e:Fl.push.apply(Fl,e)}function ic(e,t){for(t&=~Nl,t&=~Ll,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-st(t),i=1<<r;e[r]=-1,t&=~i}}function nc(e){if(0!==(6&Tl))throw Error(s(327));_c();var t=ht(e,0);if(0===(1&t))return Ql(e,Xe()),null;var r=dc(e,t);if(0!==e.tag&&2===r){var i=pt(e);0!==i&&(t=i,r=tc(e,i))}if(1===r)throw r=Ol,lc(e,0),ic(e,t),Ql(e,Xe()),r;if(6===r)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,yc(e,Fl,Ul),Ql(e,Xe()),null}function sc(e,t){var r=Tl;Tl|=1;try{return e(t)}finally{0===(Tl=r)&&(zl=Xe()+500,Dn&&zn())}}function oc(e){null!==Gl&&0===Gl.tag&&0===(6&Tl)&&_c();var t=Tl;Tl|=1;var r=Sl.transition,i=_t;try{if(Sl.transition=null,_t=1,e)return e()}finally{_t=i,Sl.transition=r,0===(6&(Tl=t))&&zn()}}function ac(){El=Rl.current,wn(Rl)}function lc(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(-1!==r&&(e.timeoutHandle=-1,Qi(r)),null!==Al)for(r=Al.return;null!==r;){var i=r;switch(Jn(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Rn();break;case 3:$s(),wn(Mn),wn(Tn),Ks();break;case 5:Ws(i);break;case 4:$s();break;case 13:case 19:wn(Ys);break;case 10:Ss(i.type._context);break;case 22:case 23:ac()}r=r.return}if(Ml=e,Al=e=Rc(e.current,null),Cl=El=t,Pl=0,Ol=null,Nl=Ll=Il=0,Fl=Dl=null,null!==Cs){for(t=0;t<Cs.length;t++)if(null!==(i=(r=Cs[t]).interleaved)){r.interleaved=null;var n=i.next,s=r.pending;if(null!==s){var o=s.next;s.next=n,i.next=o}r.pending=i}Cs=null}return e}function cc(e,t){for(;;){var r=Al;try{if(xs(),Qs.current=Wo,so){for(var i=ro.memoizedState;null!==i;){var n=i.queue;null!==n&&(n.pending=null),i=i.next}so=!1}if(to=0,no=io=ro=null,oo=!1,ao=0,xl.current=null,null===r||null===r.return){Pl=1,Ol=t,Al=null;break}e:{var o=e,a=r.return,l=r,c=t;if(t=Cl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=da(a);if(null!==f){f.flags&=-257,pa(f,a,l,0,t),1&f.mode&&ha(o,u,t),c=u;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){ha(o,u,t),hc();break e}c=Error(s(426))}else if(es&&1&l.mode){var y=da(a);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),pa(y,a,l,0,t),us(sa(c,l));break e}}o=c=sa(c,l),4!==Pl&&(Pl=2),null===Dl?Dl=[o]:Dl.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,ks(o,ca(0,c,t));break e;case 1:l=c;var _=o.type,v=o.stateNode;if(0===(128&o.flags)&&("function"===typeof _.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===jl||!jl.has(v)))){o.flags|=65536,t&=-t,o.lanes|=t,ks(o,ua(o,l,t));break e}}o=o.return}while(null!==o)}gc(r)}catch(b){t=b,Al===r&&null!==r&&(Al=r=r.return);continue}break}}function uc(){var e=wl.current;return wl.current=Wo,null===e?Wo:e}function hc(){0!==Pl&&3!==Pl&&2!==Pl||(Pl=4),null===Ml||0===(268435455&Il)&&0===(268435455&Ll)||ic(Ml,Cl)}function dc(e,t){var r=Tl;Tl|=2;var i=uc();for(Ml===e&&Cl===t||(Ul=null,lc(e,t));;)try{pc();break}catch(n){cc(e,n)}if(xs(),Tl=r,wl.current=i,null!==Al)throw Error(s(261));return Ml=null,Cl=0,Pl}function pc(){for(;null!==Al;)mc(Al)}function fc(){for(;null!==Al&&!We();)mc(Al)}function mc(e){var t=vl(e.alternate,e,El);e.memoizedProps=e.pendingProps,null===t?gc(e):Al=t,xl.current=null}function gc(e){var t=e;do{var r=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(r=Ha(r,t,El)))return void(Al=r)}else{if(null!==(r=Ga(r,t)))return r.flags&=32767,void(Al=r);if(null===e)return Pl=6,void(Al=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Al=t);Al=t=e}while(null!==t);0===Pl&&(Pl=5)}function yc(e,t,r){var i=_t,n=Sl.transition;try{Sl.transition=null,_t=1,function(e,t,r,i){do{_c()}while(null!==Gl);if(0!==(6&Tl))throw Error(s(327));r=e.finishedWork;var n=e.finishedLanes;if(null===r)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var o=r.lanes|r.childLanes;if(function(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<r;){var n=31-st(r),s=1<<n;t[n]=0,i[n]=-1,e[n]=-1,r&=~s}}(e,o),e===Ml&&(Al=Ml=null,Cl=0),0===(2064&r.subtreeFlags)&&0===(2064&r.flags)||Hl||(Hl=!0,Mc(et,(function(){return _c(),null}))),o=0!==(15990&r.flags),0!==(15990&r.subtreeFlags)||o){o=Sl.transition,Sl.transition=null;var a=_t;_t=1;var l=Tl;Tl|=4,xl.current=null,function(e,t){if(Yi=Ht,li(e=ai())){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(r=(r=e.ownerDocument)&&r.defaultView||window).getSelection&&r.getSelection();if(i&&0!==i.rangeCount){r=i.anchorNode;var n=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{r.nodeType,o.nodeType}catch(w){r=null;break e}var a=0,l=-1,c=-1,u=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==r||0!==n&&3!==d.nodeType||(l=a+n),d!==o||0!==i&&3!==d.nodeType||(c=a+i),3===d.nodeType&&(a+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===r&&++u===n&&(l=a),p===o&&++h===i&&(c=a),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}r=-1===l||-1===c?null:{start:l,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(Xi={focusedElem:e,selectionRange:r},Ht=!1,Wa=t;null!==Wa;)if(e=(t=Wa).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Wa=e;else for(;null!==Wa;){t=Wa;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,y=m.memoizedState,_=t.stateNode,v=_.getSnapshotBeforeUpdate(t.elementType===t.type?g:Ko(t.type,g),y);_.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(s(163))}}catch(w){bc(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Wa=e;break}Wa=t.return}m=Ja,Ja=!1}(e,r),dl(r,e),ci(Xi),Ht=!!Yi,Xi=Yi=null,e.current=r,fl(r,e,n),Ye(),Tl=l,_t=a,Sl.transition=o}else e.current=r;if(Hl&&(Hl=!1,Gl=e,Zl=n),o=e.pendingLanes,0===o&&(jl=null),function(e){if(nt&&"function"===typeof nt.onCommitFiberRoot)try{nt.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(r.stateNode),Ql(e,Xe()),null!==t)for(i=e.onRecoverableError,r=0;r<t.length;r++)n=t[r],i(n.value,{componentStack:n.stack,digest:n.digest});if(Vl)throw Vl=!1,e=Bl,Bl=null,e;0!==(1&Zl)&&0!==e.tag&&_c(),o=e.pendingLanes,0!==(1&o)?e===ql?$l++:($l=0,ql=e):$l=0,zn()}(e,t,r,i)}finally{Sl.transition=n,_t=i}return null}function _c(){if(null!==Gl){var e=vt(Zl),t=Sl.transition,r=_t;try{if(Sl.transition=null,_t=16>e?16:e,null===Gl)var i=!1;else{if(e=Gl,Gl=null,Zl=0,0!==(6&Tl))throw Error(s(331));var n=Tl;for(Tl|=4,Wa=e.current;null!==Wa;){var o=Wa,a=o.child;if(0!==(16&Wa.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Wa=u;null!==Wa;){var h=Wa;switch(h.tag){case 0:case 11:case 15:Ka(8,h,o)}var d=h.child;if(null!==d)d.return=h,Wa=d;else for(;null!==Wa;){var p=(h=Wa).sibling,f=h.return;if(tl(h),h===u){Wa=null;break}if(null!==p){p.return=f,Wa=p;break}Wa=f}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}Wa=o}}if(0!==(2064&o.subtreeFlags)&&null!==a)a.return=o,Wa=a;else e:for(;null!==Wa;){if(0!==(2048&(o=Wa).flags))switch(o.tag){case 0:case 11:case 15:Ka(9,o,o.return)}var _=o.sibling;if(null!==_){_.return=o.return,Wa=_;break e}Wa=o.return}}var v=e.current;for(Wa=v;null!==Wa;){var b=(a=Wa).child;if(0!==(2064&a.subtreeFlags)&&null!==b)b.return=a,Wa=b;else e:for(a=v;null!==Wa;){if(0!==(2048&(l=Wa).flags))try{switch(l.tag){case 0:case 11:case 15:Qa(9,l)}}catch(x){bc(l,l.return,x)}if(l===a){Wa=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Wa=w;break e}Wa=l.return}}if(Tl=n,zn(),nt&&"function"===typeof nt.onPostCommitFiberRoot)try{nt.onPostCommitFiberRoot(it,e)}catch(x){}i=!0}return i}finally{_t=r,Sl.transition=t}}return!1}function vc(e,t,r){e=Ds(e,t=ca(0,t=sa(r,t),1),1),t=Xl(),null!==e&&(gt(e,1,t),Ql(e,t))}function bc(e,t,r){if(3===e.tag)vc(e,e,r);else for(;null!==t;){if(3===t.tag){vc(t,e,r);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===jl||!jl.has(i))){t=Ds(t,e=ua(t,e=sa(r,e),1),1),e=Xl(),null!==t&&(gt(t,1,e),Ql(t,e));break}}t=t.return}}function wc(e,t,r){var i=e.pingCache;null!==i&&i.delete(t),t=Xl(),e.pingedLanes|=e.suspendedLanes&r,Ml===e&&(Cl&r)===r&&(4===Pl||3===Pl&&(130023424&Cl)===Cl&&500>Xe()-kl?lc(e,0):Nl|=r),Ql(e,t)}function xc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ct,0===(130023424&(ct<<=1))&&(ct=4194304)));var r=Xl();null!==(e=Ps(e,t))&&(gt(e,t,r),Ql(e,r))}function Sc(e){var t=e.memoizedState,r=0;null!==t&&(r=t.retryLane),xc(e,r)}function Tc(e,t){var r=0;switch(e.tag){case 13:var i=e.stateNode,n=e.memoizedState;null!==n&&(r=n.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(s(314))}null!==i&&i.delete(t),xc(e,r)}function Mc(e,t){return $e(e,t)}function Ac(e,t,r,i){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cc(e,t,r,i){return new Ac(e,t,r,i)}function Ec(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Rc(e,t){var r=e.alternate;return null===r?((r=Cc(e.tag,t,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=14680064&e.flags,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Pc(e,t,r,i,n,o){var a=2;if(i=e,"function"===typeof e)Ec(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case S:return Oc(r.children,n,o,t);case T:a=8,n|=8;break;case M:return(e=Cc(12,r,t,2|n)).elementType=M,e.lanes=o,e;case R:return(e=Cc(13,r,t,n)).elementType=R,e.lanes=o,e;case P:return(e=Cc(19,r,t,n)).elementType=P,e.lanes=o,e;case L:return Ic(r,n,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case A:a=10;break e;case C:a=9;break e;case E:a=11;break e;case O:a=14;break e;case I:a=16,i=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Cc(a,r,t,n)).elementType=e,t.type=i,t.lanes=o,t}function Oc(e,t,r,i){return(e=Cc(7,e,i,t)).lanes=r,e}function Ic(e,t,r,i){return(e=Cc(22,e,i,t)).elementType=L,e.lanes=r,e.stateNode={isHidden:!1},e}function Lc(e,t,r){return(e=Cc(6,e,null,t)).lanes=r,e}function Nc(e,t,r){return(t=Cc(4,null!==e.children?e.children:[],e.key,t)).lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Dc(e,t,r,i,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=i,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function Fc(e,t,r,i,n,s,o,a,l){return e=new Dc(e,t,r,a,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Cc(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Is(s),e}function kc(e){if(!e)return Sn;e:{if(Be(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(En(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var r=e.type;if(En(r))return On(e,r,t)}return t}function zc(e,t,r,i,n,s,o,a,l){return(e=Fc(r,i,!0,e,0,s,0,a,l)).context=kc(null),r=e.current,(s=Ns(i=Xl(),n=Jl(r))).callback=void 0!==t&&null!==t?t:null,Ds(r,s,n),e.current.lanes=n,gt(e,n,i),Ql(e,i),e}function Uc(e,t,r,i){var n=t.current,s=Xl(),o=Jl(n);return r=kc(r),null===t.context?t.context=r:t.pendingContext=r,(t=Ns(s,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Ds(n,t,o))&&(Kl(e,n,o,s),Fs(e,n,o)),o}function Vc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Bc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var r=e.retryLane;e.retryLane=0!==r&&r<t?r:t}}function jc(e,t){Bc(e,t),(e=e.alternate)&&Bc(e,t)}vl=function(e,t,r){if(null!==e)if(e.memoizedProps!==t.pendingProps||Mn.current)ma=!0;else{if(0===(e.lanes&r)&&0===(128&t.flags))return ma=!1,function(e,t,r){switch(t.tag){case 3:Ma(t),cs();break;case 5:qs(t);break;case 1:En(t.type)&&In(t);break;case 4:Zs(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,n=t.memoizedProps.value;xn(_s,i._currentValue),i._currentValue=n;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(xn(Ys,1&Ys.current),t.flags|=128,null):0!==(r&t.child.childLanes)?La(e,t,r):(xn(Ys,1&Ys.current),null!==(e=Va(e,t,r))?e.sibling:null);xn(Ys,1&Ys.current);break;case 19:if(i=0!==(r&t.childLanes),0!==(128&e.flags)){if(i)return za(e,t,r);t.flags|=128}if(null!==(n=t.memoizedState)&&(n.rendering=null,n.tail=null,n.lastEffect=null),xn(Ys,Ys.current),i)break;return null;case 22:case 23:return t.lanes=0,ba(e,t,r)}return Va(e,t,r)}(e,t,r);ma=0!==(131072&e.flags)}else ma=!1,es&&0!==(1048576&t.flags)&&Yn(t,jn,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Ua(e,t),e=t.pendingProps;var n=Cn(t,Tn.current);Ms(t,r),n=ho(null,t,i,e,n,r);var o=po();return t.flags|=1,"object"===typeof n&&null!==n&&"function"===typeof n.render&&void 0===n.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,En(i)?(o=!0,In(t)):o=!1,t.memoizedState=null!==n.state&&void 0!==n.state?n.state:null,Is(t),n.updater=ea,t.stateNode=n,n._reactInternals=t,na(t,i,e,r),t=Ta(null,t,i,!0,o,r)):(t.tag=0,es&&o&&Xn(t),ga(null,t,n,r),t=t.child),t;case 16:i=t.elementType;e:{switch(Ua(e,t),e=t.pendingProps,i=(n=i._init)(i._payload),t.type=i,n=t.tag=function(e){if("function"===typeof e)return Ec(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===E)return 11;if(e===O)return 14}return 2}(i),e=Ko(i,e),n){case 0:t=xa(null,t,i,e,r);break e;case 1:t=Sa(null,t,i,e,r);break e;case 11:t=ya(null,t,i,e,r);break e;case 14:t=_a(null,t,i,Ko(i.type,e),r);break e}throw Error(s(306,i,""))}return t;case 0:return i=t.type,n=t.pendingProps,xa(e,t,i,n=t.elementType===i?n:Ko(i,n),r);case 1:return i=t.type,n=t.pendingProps,Sa(e,t,i,n=t.elementType===i?n:Ko(i,n),r);case 3:e:{if(Ma(t),null===e)throw Error(s(387));i=t.pendingProps,n=(o=t.memoizedState).element,Ls(e,t),zs(t,i,null,r);var a=t.memoizedState;if(i=a.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Aa(e,t,i,r,n=sa(Error(s(423)),t));break e}if(i!==n){t=Aa(e,t,i,r,n=sa(Error(s(424)),t));break e}for(Qn=sn(t.stateNode.containerInfo.firstChild),Kn=t,es=!0,ts=null,r=ys(t,null,i,r),t.child=r;r;)r.flags=-3&r.flags|4096,r=r.sibling}else{if(cs(),i===n){t=Va(e,t,r);break e}ga(e,t,i,r)}t=t.child}return t;case 5:return qs(t),null===e&&ss(t),i=t.type,n=t.pendingProps,o=null!==e?e.memoizedProps:null,a=n.children,Ji(i,n)?a=null:null!==o&&Ji(i,o)&&(t.flags|=32),wa(e,t),ga(e,t,a,r),t.child;case 6:return null===e&&ss(t),null;case 13:return La(e,t,r);case 4:return Zs(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=gs(t,null,i,r):ga(e,t,i,r),t.child;case 11:return i=t.type,n=t.pendingProps,ya(e,t,i,n=t.elementType===i?n:Ko(i,n),r);case 7:return ga(e,t,t.pendingProps,r),t.child;case 8:case 12:return ga(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(i=t.type._context,n=t.pendingProps,o=t.memoizedProps,a=n.value,xn(_s,i._currentValue),i._currentValue=a,null!==o)if(ri(o.value,a)){if(o.children===n.children&&!Mn.current){t=Va(e,t,r);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){a=o.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===o.tag){(c=Ns(-1,r&-r)).tag=2;var u=o.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}o.lanes|=r,null!==(c=o.alternate)&&(c.lanes|=r),Ts(o.return,r,t),l.lanes|=r;break}c=c.next}}else if(10===o.tag)a=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(a=o.return))throw Error(s(341));a.lanes|=r,null!==(l=a.alternate)&&(l.lanes|=r),Ts(a,r,t),a=o.sibling}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===t){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}ga(e,t,n.children,r),t=t.child}return t;case 9:return n=t.type,i=t.pendingProps.children,Ms(t,r),i=i(n=As(n)),t.flags|=1,ga(e,t,i,r),t.child;case 14:return n=Ko(i=t.type,t.pendingProps),_a(e,t,i,n=Ko(i.type,n),r);case 15:return va(e,t,t.type,t.pendingProps,r);case 17:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:Ko(i,n),Ua(e,t),t.tag=1,En(i)?(e=!0,In(t)):e=!1,Ms(t,r),ra(t,i,n),na(t,i,n,r),Ta(null,t,i,!0,e,r);case 19:return za(e,t,r);case 22:return ba(e,t,r)}throw Error(s(156,t.tag))};var Hc="function"===typeof reportError?reportError:function(e){console.error(e)};function Gc(e){this._internalRoot=e}function Zc(e){this._internalRoot=e}function $c(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Wc(){}function Yc(e,t,r,i,n){var s=r._reactRootContainer;if(s){var o=s;if("function"===typeof n){var a=n;n=function(){var e=Vc(o);a.call(e)}}Uc(t,o,e,n)}else o=function(e,t,r,i,n){if(n){if("function"===typeof i){var s=i;i=function(){var e=Vc(o);s.call(e)}}var o=zc(t,i,e,0,null,!1,0,"",Wc);return e._reactRootContainer=o,e[un]=o.current,ki(8===e.nodeType?e.parentNode:e),oc(),o}for(;n=e.lastChild;)e.removeChild(n);if("function"===typeof i){var a=i;i=function(){var e=Vc(l);a.call(e)}}var l=Fc(e,0,!1,null,0,!1,0,"",Wc);return e._reactRootContainer=l,e[un]=l.current,ki(8===e.nodeType?e.parentNode:e),oc((function(){Uc(t,l,r,i)})),l}(r,t,e,n,i);return Vc(o)}Zc.prototype.render=Gc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Uc(e,t,null,null)},Zc.prototype.unmount=Gc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;oc((function(){Uc(null,e,null,null)})),t[un]=null}},Zc.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var r=0;r<It.length&&0!==t&&t<It[r].priority;r++);It.splice(r,0,e),0===r&&Ft(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=ut(t.pendingLanes);0!==r&&(yt(t,1|r),Ql(t,Xe()),0===(6&Tl)&&(zl=Xe()+500,zn()))}break;case 13:oc((function(){var t=Ps(e,1);if(null!==t){var r=Xl();Kl(t,e,1,r)}})),jc(e,1)}},wt=function(e){if(13===e.tag){var t=Ps(e,134217728);if(null!==t)Kl(t,e,134217728,Xl());jc(e,134217728)}},xt=function(e){if(13===e.tag){var t=Jl(e),r=Ps(e,t);if(null!==r)Kl(r,e,t,Xl());jc(e,t)}},St=function(){return _t},Tt=function(e,t){var r=_t;try{return _t=e,t()}finally{_t=r}},we=function(e,t,r){switch(t){case"input":if(K(e,r),t=r.name,"radio"===r.type&&null!=t){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var i=r[t];if(i!==e&&i.form===e.form){var n=yn(i);if(!n)throw Error(s(90));q(i),K(i,n)}}}break;case"textarea":se(e,r);break;case"select":null!=(t=r.value)&&re(e,!!r.multiple,t,!1)}},Ce=sc,Ee=oc;var Xc={usingClientEntryPoint:!1,Events:[mn,gn,yn,Me,Ae,sc]},Jc={findFiberByHostInstance:fn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Kc={bundleType:Jc.bundleType,version:Jc.version,rendererPackageName:Jc.rendererPackageName,rendererConfig:Jc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ge(e))?null:e.stateNode},findFiberByHostInstance:Jc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Qc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qc.isDisabled&&Qc.supportsFiber)try{it=Qc.inject(Kc),nt=Qc}catch(eu){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Xc,t.createPortal=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!$c(t))throw Error(s(200));return function(e,t,r){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:x,key:null==i?null:""+i,children:e,containerInfo:t,implementation:r}}(e,t,null,r)},t.createRoot=function(e,t){if(!$c(e))throw Error(s(299));var r=!1,i="",n=Hc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(r=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(n=t.onRecoverableError)),t=Fc(e,1,!1,null,0,r,0,i,n),e[un]=t.current,ki(8===e.nodeType?e.parentNode:e),new Gc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=Ge(t))?null:e.stateNode},t.flushSync=function(e){return oc(e)},t.hydrate=function(e,t,r){if(!qc(t))throw Error(s(200));return Yc(null,e,t,!0,r)},t.hydrateRoot=function(e,t,r){if(!$c(e))throw Error(s(405));var i=null!=r&&r.hydratedSources||null,n=!1,o="",a=Hc;if(null!==r&&void 0!==r&&(!0===r.unstable_strictMode&&(n=!0),void 0!==r.identifierPrefix&&(o=r.identifierPrefix),void 0!==r.onRecoverableError&&(a=r.onRecoverableError)),t=zc(t,null,e,1,null!=r?r:null,n,0,o,a),e[un]=t.current,ki(e),i)for(e=0;e<i.length;e++)n=(n=(r=i[e])._getVersion)(r._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[r,n]:t.mutableSourceEagerHydrationData.push(r,n);return new Zc(t)},t.render=function(e,t,r){if(!qc(t))throw Error(s(200));return Yc(null,e,t,!1,r)},t.unmountComponentAtNode=function(e){if(!qc(e))throw Error(s(40));return!!e._reactRootContainer&&(oc((function(){Yc(null,null,e,!1,(function(){e._reactRootContainer=null,e[un]=null}))})),!0)},t.unstable_batchedUpdates=sc,t.unstable_renderSubtreeIntoContainer=function(e,t,r,i){if(!qc(r))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return Yc(e,t,r,!1,i)},t.version="18.3.1-next-f1338f8080-20240426"},84391:(e,t,r)=>{"use strict";var i=r(97950);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},97950:(e,t,r)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=r(82730)},51153:(e,t,r)=>{"use strict";var i=r(65043),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var i,s={},c=null,u=null;for(i in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,i)&&!l.hasOwnProperty(i)&&(s[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===s[i]&&(s[i]=t[i]);return{$$typeof:n,type:e,key:c,ref:u,props:s,_owner:a.current}}t.jsx=c,t.jsxs=c},14202:(e,t)=>{"use strict";var r=Symbol.for("react.element"),i=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||f}function _(){}function v(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=y.prototype;var b=v.prototype=new _;b.constructor=v,m(b,y.prototype),b.isPureReactComponent=!0;var w=Array.isArray,x=Object.prototype.hasOwnProperty,S={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function M(e,t,i){var n,s={},o=null,a=null;if(null!=t)for(n in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)x.call(t,n)&&!T.hasOwnProperty(n)&&(s[n]=t[n]);var l=arguments.length-2;if(1===l)s.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(e&&e.defaultProps)for(n in l=e.defaultProps)void 0===s[n]&&(s[n]=l[n]);return{$$typeof:r,type:e,key:o,ref:a,props:s,_owner:S.current}}function A(e){return"object"===typeof e&&null!==e&&e.$$typeof===r}var C=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function R(e,t,n,s,o){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case r:case i:l=!0}}if(l)return o=o(l=e),e=""===s?"."+E(l,0):s,w(o)?(n="",null!=e&&(n=e.replace(C,"$&/")+"/"),R(o,t,n,"",(function(e){return e}))):null!=o&&(A(o)&&(o=function(e,t){return{$$typeof:r,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,n+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(C,"$&/")+"/")+e)),t.push(o)),1;if(l=0,s=""===s?".":s+":",w(e))for(var c=0;c<e.length;c++){var u=s+E(a=e[c],c);l+=R(a,t,n,u,o)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(a=e.next()).done;)l+=R(a=a.value,t,n,u=s+E(a,c++),o);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function P(e,t,r){if(null==e)return e;var i=[],n=0;return R(e,i,"","",(function(e){return t.call(r,e,n++)})),i}function O(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var I={current:null},L={transition:null},N={ReactCurrentDispatcher:I,ReactCurrentBatchConfig:L,ReactCurrentOwner:S};function D(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:P,forEach:function(e,t,r){P(e,(function(){t.apply(this,arguments)}),r)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=n,t.Profiler=o,t.PureComponent=v,t.StrictMode=s,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N,t.act=D,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=m({},e.props),s=e.key,o=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,a=S.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)x.call(t,c)&&!T.hasOwnProperty(c)&&(n[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)n.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];n.children=l}return{$$typeof:r,type:e.type,key:s,ref:o,props:n,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=M,t.createFactory=function(e){var t=M.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=L.transition;L.transition={};try{e()}finally{L.transition=t}},t.unstable_act=D,t.useCallback=function(e,t){return I.current.useCallback(e,t)},t.useContext=function(e){return I.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return I.current.useDeferredValue(e)},t.useEffect=function(e,t){return I.current.useEffect(e,t)},t.useId=function(){return I.current.useId()},t.useImperativeHandle=function(e,t,r){return I.current.useImperativeHandle(e,t,r)},t.useInsertionEffect=function(e,t){return I.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return I.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return I.current.useMemo(e,t)},t.useReducer=function(e,t,r){return I.current.useReducer(e,t,r)},t.useRef=function(e){return I.current.useRef(e)},t.useState=function(e){return I.current.useState(e)},t.useSyncExternalStore=function(e,t,r){return I.current.useSyncExternalStore(e,t,r)},t.useTransition=function(){return I.current.useTransition()},t.version="18.3.1"},65043:(e,t,r)=>{"use strict";e.exports=r(14202)},70579:(e,t,r)=>{"use strict";e.exports=r(51153)},27234:(e,t)=>{"use strict";function r(e,t){var r=e.length;e.push(t);e:for(;0<r;){var i=r-1>>>1,n=e[i];if(!(0<s(n,t)))break e;e[i]=t,e[r]=n,r=i}}function i(e){return 0===e.length?null:e[0]}function n(e){if(0===e.length)return null;var t=e[0],r=e.pop();if(r!==t){e[0]=r;e:for(var i=0,n=e.length,o=n>>>1;i<o;){var a=2*(i+1)-1,l=e[a],c=a+1,u=e[c];if(0>s(l,r))c<n&&0>s(u,l)?(e[i]=u,e[c]=r,i=c):(e[i]=l,e[a]=r,i=a);else{if(!(c<n&&0>s(u,r)))break e;e[i]=u,e[c]=r,i=c}}}return t}function s(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,_="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=i(u);null!==t;){if(null===t.callback)n(u);else{if(!(t.startTime<=e))break;n(u),t.sortIndex=t.expirationTime,r(c,t)}t=i(u)}}function w(e){if(g=!1,b(e),!m)if(null!==i(c))m=!0,L(x);else{var t=i(u);null!==t&&N(w,t.startTime-e)}}function x(e,r){m=!1,g&&(g=!1,_(A),A=-1),f=!0;var s=p;try{for(b(r),d=i(c);null!==d&&(!(d.expirationTime>r)||e&&!R());){var o=d.callback;if("function"===typeof o){d.callback=null,p=d.priorityLevel;var a=o(d.expirationTime<=r);r=t.unstable_now(),"function"===typeof a?d.callback=a:d===i(c)&&n(c),b(r)}else n(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&N(w,h.startTime-r),l=!1}return l}finally{d=null,p=s,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,T=!1,M=null,A=-1,C=5,E=-1;function R(){return!(t.unstable_now()-E<C)}function P(){if(null!==M){var e=t.unstable_now();E=e;var r=!0;try{r=M(!0,e)}finally{r?S():(T=!1,M=null)}}else T=!1}if("function"===typeof v)S=function(){v(P)};else if("undefined"!==typeof MessageChannel){var O=new MessageChannel,I=O.port2;O.port1.onmessage=P,S=function(){I.postMessage(null)}}else S=function(){y(P,0)};function L(e){M=e,T||(T=!0,S())}function N(e,r){A=y((function(){e(t.unstable_now())}),r)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,L(x))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var r=p;p=t;try{return e()}finally{p=r}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=p;p=e;try{return t()}finally{p=r}},t.unstable_scheduleCallback=function(e,n,s){var o=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?o+s:o:s=o,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:h++,callback:n,priorityLevel:e,startTime:s,expirationTime:a=s+a,sortIndex:-1},s>o?(e.sortIndex=s,r(u,e),null===i(c)&&e===i(u)&&(g?(_(A),A=-1):g=!0,N(w,s-o))):(e.sortIndex=a,r(c,e),m||f||(m=!0,L(x))),e},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(e){var t=p;return function(){var r=p;p=t;try{return e.apply(this,arguments)}finally{p=r}}}},78853:(e,t,r)=>{"use strict";e.exports=r(27234)},194:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>L});var i=r(35143),n=r(3825),s=r(19276),o=r(3975),a=r(42553),l=r(53084),c=r(49304),u=r(27741),h=r(76460),d=r(30726),p=r(50346),f=r(90534),m=r(46053),g=(r(81806),r(85842)),y=r(17707),_=r(13312),v=r(65308),b=r(70652),w=r(54047),x=r(91967),S=(r(47249),r(38042));const T=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let M=class extends x.A{constructor(e){super(e),this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const e=(0,S.JK)().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const t=(0,S.Z0)(e);return"pt"===t?"pt-BR":t&&T.has(t)?t:"global"}};(0,i._)([(0,m.MZ)()],M.prototype,"id",void 0),(0,i._)([(0,m.MZ)()],M.prototype,"language",void 0),(0,i._)([(0,m.MZ)()],M.prototype,"places",void 0),(0,i._)([(0,m.MZ)()],M.prototype,"serviceUrl",void 0),(0,i._)([(0,m.MZ)()],M.prototype,"worldview",void 0),M=(0,i._)([(0,g.$)("esri.support.BasemapStyle")],M);const A=M;var C,E=r(8837);let R=0,P=C=class extends((0,a.Te)(c.A)){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+R++,this.baseLayers=new s.A,this.referenceLayers=new s.A;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"===e.type&&h.A.getLogger(this).error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=e=>{e.parent=null};this.addHandles([this.baseLayers.on("after-add",(e=>t(e.item))),this.referenceLayers.on("after-add",(e=>t(e.item))),this.baseLayers.on("after-remove",(e=>r(e.item))),this.referenceLayers.on("after-remove",(e=>r(e.item)))])}initialize(){this.when().catch((e=>{h.A.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.baseLayers.toArray();for(const r of e)r.destroy();const t=this.referenceLayers.toArray();for(const r of t)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=(0,d.pR)(this.portalItem)}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",(0,o.V)(e,this._get("baseLayers")))}_writeBaseLayers(e,t,r){const i=[];e?(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach((e=>{const t=(0,E.CJ)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);null!=t&&i.push(t)})),this.referenceLayers.forEach((e=>{const t=(0,E.CJ)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);null!=t&&("scene"!==e.type&&(t.isReference=!0),i.push(t))})),t.baseMapLayers=i):t.baseMapLayers=i}set referenceLayers(e){this._set("referenceLayers",(0,o.V)(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return(0,u.g)(this,(e=>{e(this.baseLayers,this.referenceLayers)}))}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map((e=>(0,l.Nb)(e)?e.clone():e)),referenceLayers:this.referenceLayers.map((e=>(0,l.Nb)(e)?e.clone():e))};return this.loaded&&(e.loadStatus="loaded"),new C({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t?.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map((e=>{const t=(0,l.o8)(e);return t.url&&(0,f.BQ)(t.url)&&(t.url=`https:${t.url}`),t.templateUrl&&(0,f.BQ)(t.templateUrl)&&(t.templateUrl=`https:${t.templateUrl}`),t}))),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:r,style:i}=this;(0,p.Te)(e);const n=[];if(t){const r=t.context?t.context.url:null;if(n.push(this._loadLayersFromJSON(t.data,r,e)),t.data.id&&!t.data.title){const e=t.data.id;n.push((0,w.q)(e).then((e=>{e&&this.read({title:e},t.context)})))}}else r?n.push(this._loadFromItem(r,e)):i&&n.push(this._loadFromStylesService(i,e));await Promise.all(n)}async _loadLayersFromJSON(e,t,i){const n=this.resourceInfo?.context,s=this.portalItem?.portal||n?.portal||null,o=I[n?.origin||""]??"web-map",{populateOperationalLayers:a}=await r.e(239).then(r.bind(r,60239)),l=[];if((0,p.Te)(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const r={context:{...n,origin:o,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},i=e=>"web-scene"===o&&"ArcGISSceneServiceLayer"===e.layerType||e.isReference,c=a(this.baseLayers,e.baseMapLayers.filter((e=>!i(e))),r);l.push(c);const u=a(this.referenceLayers,e.baseMapLayers.filter(i),r);l.push(u)}await Promise.allSettled(l)}async _loadFromItem(e,t){const r=await e.load(t),i=await r.fetchData("json",t),n=(0,f.An)(e.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:O[e.type||""]??"web-map",portal:e.portal||v.A.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||v.A.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,t)}async _loadFromStylesService(e,t){const r=`${e.serviceUrl}/${e.id}`,i=(await(0,n.A)(r,{query:{language:e.getLanguageParamValue(),places:e.places,worldview:e.worldview},signal:t?.signal})).data,s=(0,f.An)(r);return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:"web-map",url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=w.H[e];return t?t.itemId?new C({portalItem:{id:t.itemId,portal:{url:"https://www.arcgis.com"}}}):C.fromJSON(t,{origin:t.is3d?"web-scene":"web-map"}):null}};(0,i._)([(0,m.MZ)({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,r,i){this._writeBaseLayers(e,t,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:s.A}},writer(e,t,r,i){this._writeBaseLayers(e,t,i)}}}}}})],P.prototype,"baseLayers",null),(0,i._)([(0,m.MZ)({type:String,json:{origins:{"web-scene":{write:!0}}}})],P.prototype,"id",void 0),(0,i._)([(0,m.MZ)({type:b.default})],P.prototype,"portalItem",void 0),(0,i._)([(0,m.MZ)()],P.prototype,"referenceLayers",null),(0,i._)([(0,m.MZ)({readOnly:!0})],P.prototype,"resourceInfo",void 0),(0,i._)([(0,m.MZ)({type:_.A})],P.prototype,"spatialReference",void 0),(0,i._)([(0,m.MZ)({type:A})],P.prototype,"style",void 0),(0,i._)([(0,m.MZ)()],P.prototype,"thumbnailUrl",void 0),(0,i._)([(0,m.MZ)({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],P.prototype,"title",void 0),(0,i._)([(0,y.K)("title")],P.prototype,"writeTitle",null),P=C=(0,i._)([(0,g.$)("esri.Basemap")],P);const O={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},I={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},L=P},30358:(e,t,r)=>{"use strict";r.d(t,{A:()=>_});var i=r(35143),n=r(69098),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842));let a=class extends n.P{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return null!=e&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};(0,i._)([(0,s.MZ)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],a.prototype,"row",void 0),(0,i._)([(0,s.MZ)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],a.prototype,"column",void 0),(0,i._)([(0,s.MZ)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],a.prototype,"rows",void 0),(0,i._)([(0,s.MZ)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],a.prototype,"columns",void 0),a=(0,i._)([(0,o.$)("esri.CameraLayout")],a);const l=a;var c=r(73582),u=r(42553),h=r(15941),d=r(21403),p=r(28379),f=r(17707),m=r(40565),g=r(19247);let y=class extends((0,n.O)(u.oY)){constructor(){super(...arguments),this.position=new g.A([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new l}normalizeCtorArgs(e,t,r,i){if(e&&"object"==typeof e&&("x"in e||Array.isArray(e))){const n={position:e};return null!=t&&(n.heading=t),null!=r&&(n.tilt=r),null!=i&&(n.fov=i),n}return e}writePosition(e,t,r,i){const n=e.clone();n.x=(0,m.GB)(e.x||0),n.y=(0,m.GB)(e.y||0),n.z=e.hasZ?(0,m.GB)(e.z||0):e.z,t[r]=n.write({},i)}readPosition(e,t){const r=new g.A;return r.read(e,t),r.x=(0,m.GB)(r.x||0),r.y=(0,m.GB)(r.y||0),r.z=r.hasZ?(0,m.GB)(r.z||0):r.z,r}equals(e){return null!=e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};(0,i._)([(0,s.MZ)({type:g.A,json:{write:{isRequired:!0}}})],y.prototype,"position",void 0),(0,i._)([(0,f.K)("position")],y.prototype,"writePosition",null),(0,i._)([(0,p.w)("position")],y.prototype,"readPosition",null),(0,i._)([(0,s.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,d.w)((e=>c.ie.normalize((0,m.GB)(e))))],y.prototype,"heading",void 0),(0,i._)([(0,s.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,d.w)((e=>(0,h.qE)((0,m.GB)(e),-180,180)))],y.prototype,"tilt",void 0),(0,i._)([(0,s.MZ)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],y.prototype,"fov",void 0),(0,i._)([(0,s.MZ)({type:l,nonNullable:!0,json:{read:!1,write:!1}})],y.prototype,"layout",void 0),y=(0,i._)([(0,o.$)("esri.Camera")],y);const _=y},69539:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i=r(99746),n=r(15941),s=r(40565);function o(e){return(0,n.qE)((0,s.Vr)(e),0,255)}function a(e,t,r){return e=Number(e),isNaN(e)?r:e<t?t:e>r?r:e}function l(e,t){const r=e.toString(16).padStart(2,"0");return t?r.substring(0,1):r}class c{static blendColors(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c;return i.r=Math.round(e.r+(t.r-e.r)*r),i.g=Math.round(e.g+(t.g-e.g)*r),i.b=Math.round(e.b+(t.b-e.b)*r),i.a=e.a+(t.a-e.a)*r,i._sanitize()}static fromRgb(e,t){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s.\-,%0-9]+)\)/);if(r){const e=r[2].split(/\s*,\s*/),n=r[1];if("rgb"===n&&3===e.length||"rgba"===n&&4===e.length){const r=e[0];if("%"===r.charAt(r.length-1)){const r=e.map((e=>2.56*parseFloat(e)));return 4===e.length&&(r[3]=parseFloat(e[3])),c.fromArray(r,t)}return c.fromArray(e.map((e=>parseFloat(e))),t)}if("hsl"===n&&3===e.length||"hsla"===n&&4===e.length)return c.fromArray((0,i.z$)(parseFloat(e[0]),parseFloat(e[1])/100,parseFloat(e[2])/100,parseFloat(e[3])),t)}return null}static fromHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new c;if("#"!==e[0]||isNaN(Number(`0x${e.substring(1)}`)))return null;switch(e.length){case 4:case 5:{const r=parseInt(e.substring(1,2),16),i=parseInt(e.substring(2,3),16),n=parseInt(e.substring(3,4),16),s=5===e.length?15:parseInt(e.substring(4),16);return c.fromArray([r+16*r,i+16*i,n+16*n,(s+16*s)/255],t)}case 7:case 9:{const r=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16),s=7===e.length?255:parseInt(e.substring(7),16);return c.fromArray([r,i,n,s/255],t)}default:return null}}static fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new c;return t._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(t.a)&&(t.a=1),t._sanitize()}static fromString(e,t){const r=(0,i.V6)(e)?(0,i.TS)(e):null;return r&&c.fromArray(r,t)||c.fromRgb(e,t)||c.fromHex(e,t)}static fromJSON(e){return null!=e?new c([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return null!=e?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return null!=e?[e.r/255,e.g/255,e.b/255,null!=e.a?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return.299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return"string"==typeof e?c.fromString(e,this):Array.isArray(e)?c.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof c||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const t=e?.capitalize??!1,r=e?.digits??6,i=3===r||4===r,n=4===r||8===r,s=`#${l(this.r,i)}${l(this.g,i)}${l(this.b,i)}${n?l(Math.round(255*this.a),i):""}`;return t?s.toUpperCase():s}toCss(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.r+", "+this.g+", "+this.b;return e?`rgba(${t}, ${this.a})`:`rgb(${t})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.AlphaMode.ALWAYS;const t=o(this.r),r=o(this.g),i=o(this.b);return e===c.AlphaMode.ALWAYS||1!==this.a?[t,r,i,o(255*this.a)]:[t,r,i]}clone(){return new c(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return null!=e&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(a(this.r,0,255)),this.g=Math.round(a(this.g,0,255)),this.b=Math.round(a(this.b,0,255)),this.a=a(this.a,0,1),this}_set(e,t,r,i){this.r=e,this.g=t,this.b=r,this.a=i}}c.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(c||(c={}));const u=c},39356:(e,t,r)=>{"use strict";r.d(t,{A:()=>v});var i,n=r(35143),s=r(35238),o=r(16868),a=r(95444),l=r(69098),c=r(63241),u=r(42553),h=r(76460),d=r(68134),p=r(90632),f=r(46053),m=(r(81806),r(47249),r(85842)),g=r(19902);function y(e){if(null==e)return null;const t={};for(const r in e){const i=e[r];i&&(t[r]=i.toJSON())}return 0!==Object.keys(t).length?t:null}let _=i=class extends((0,l.O)(u.oY)){constructor(e){super(e),this.isAggregate=!1,this.layer=null,this.origin=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:(0,p.c)(),configurable:!0}),Object.defineProperty(this,"_lastMeshTransform",{value:{},configurable:!0,writable:!0,enumerable:!1}),arguments.length>1&&(0,c.eF)(h.A.getLogger(this),"Graphic",{version:"4.30"})}initialize(){this._watchMeshGeometryChanges()}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),"mesh"!==e?.type&&this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}cloneShallow(){return new i({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.popupTemplate)return this.popupTemplate;const t=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const r of[t,this.sourceLayer,this.layer])if(r){if("popupTemplate"in r&&r.popupTemplate)return r.popupTemplate;if(e&&"defaultPopupTemplate"in r&&null!=r.defaultPopupTemplate)return r.defaultPopupTemplate}return null}getAttribute(e){return this.attributes?.[e]}setAttribute(e,t){if(this.attributes){const r=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",r,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:y(this.aggregateGeometries),geometry:null!=this.geometry?this.geometry.toJSON():null,symbol:null!=this.symbol?this.symbol.toJSON():null,attributes:(0,u.Wj)(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:this.popupTemplate?.toJSON()??null}}notifyMeshTransformChanged(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{geometry:t}=this;if("mesh"===t?.type){const r={origin:t.origin,transform:t.transform};this._notifyLayer("origin-transform",r,r,e.action)}}_notifyLayer(e,t,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:e,oldValue:t,newValue:r};"origin-transform"===e&&(n.action=i),"attributes"===e&&(n.attributeName=i),this.layer.graphicChanged(n)}_watchMeshGeometryChanges(){this.addHandles([(0,d.z7)((()=>"mesh"===this.geometry?.type&&this.geometry.vertexSpace.origin?{localMatrix:this.geometry.transform?.localMatrix,origin:this.geometry.vertexSpace.origin}:void 0),(e=>{let{localMatrix:t,origin:r}=e;this._lastMeshTransform.localMatrix===t&&this._lastMeshTransform.origin===r||(this._lastMeshTransform.localMatrix=t,this._lastMeshTransform.origin=r,this.notifyMeshTransformChanged())})),(0,d.z7)((()=>"mesh"===this.geometry?.type?{vertexAttributes:this.geometry.vertexAttributes}:void 0),(()=>{const e=this.geometry;"mesh"===e?.type&&e.vertexSpace.origin?(this._lastMeshTransform.localMatrix=e.transform?.localMatrix,this._lastMeshTransform.origin=e.vertexSpace.origin):(this._lastMeshTransform.localMatrix=void 0,this._lastMeshTransform.origin=void 0),this._notifyLayer("geometry",this.geometry,this.geometry)}),{equals:(e,t)=>e===t,sync:!0})])}};(0,n._)([(0,f.MZ)({value:null,json:{read:function(e){if(!e)return null;const t={};for(const r in e){const i=(0,g.rS)(e[r]);i&&(t[r]=i)}return 0!==Object.keys(t).length?t:null}}})],_.prototype,"aggregateGeometries",null),(0,n._)([(0,f.MZ)({value:null})],_.prototype,"attributes",null),(0,n._)([(0,f.MZ)({value:null,types:s.yR,json:{read:g.rS}})],_.prototype,"geometry",null),(0,n._)([(0,f.MZ)({type:Boolean})],_.prototype,"isAggregate",void 0),(0,n._)([(0,f.MZ)({clonable:"reference"})],_.prototype,"layer",void 0),(0,n._)([(0,f.MZ)({clonable:"reference"})],_.prototype,"origin",void 0),(0,n._)([(0,f.MZ)({type:o.A})],_.prototype,"popupTemplate",void 0),(0,n._)([(0,f.MZ)({clonable:"reference"})],_.prototype,"sourceLayer",void 0),(0,n._)([(0,f.MZ)({value:null,types:a.Es})],_.prototype,"symbol",null),(0,n._)([(0,f.MZ)({type:Boolean,value:!0})],_.prototype,"visible",null),_=i=(0,n._)([(0,m.$)("esri.Graphic")],_),function(e){e.generateUID=p.c}(_||(_={}));const v=_},16868:(e,t,r)=>{"use strict";r.d(t,{A:()=>Z});var i=r(35143),n=r(69098),s=r(19276),o=r(42553),a=r(53084),l=r(76460),c=r(50346),u=r(46053),h=r(21403),d=r(28379),p=r(85842),f=r(17707),m=r(40565),g=r(53430),y=r(75900),_=r(56362),v=r(87015),b=r(81940),w=r(6929),x=r(7198),S=r(93616),T=r(53539);const M={base:null,key:"type",typeMap:{attachment:y.A,media:x.A,text:T.A,expression:b.A,field:w.A,relationship:S.A}};var A,C=r(81779),E=r(40585);r(81806),r(47249);let R=A=class extends o.oY{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new A({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};(0,i._)([(0,u.MZ)({type:Boolean,json:{write:!0}})],R.prototype,"returnTopmostRaster",void 0),(0,i._)([(0,u.MZ)({type:Boolean,json:{write:!0}})],R.prototype,"showNoDataRecords",void 0),R=A=(0,i._)([(0,p.$)("esri.popup.LayerOptions")],R);const P=R;var O,I=r(64362);let L=O=class extends o.oY{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new O({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?(0,a.o8)(this.orderByFields):null})}};(0,i._)([(0,u.MZ)({type:Boolean,json:{write:!0}})],L.prototype,"showRelatedRecords",void 0),(0,i._)([(0,u.MZ)({type:[I.A],json:{write:!0}})],L.prototype,"orderByFields",void 0),L=O=(0,i._)([(0,p.$)("esri.popup.RelatedRecordsInfo")],L);const N=L;var D=r(11662),F=r(50037),k=r(16700),z=r(76192);const U="relationships/",V="expression/",B=s.A.ofType({key:"type",defaultKeyValue:"button",base:F.A,typeMap:{button:k.A,toggle:z.A}}),j={base:_.A,key:"type",typeMap:{media:x.A,custom:v.A,text:T.A,attachments:y.A,fields:w.A,expression:b.A,relationship:S.A}},H=new Set(["attachments","fields","media","text","expression","relationship"]);let G=class extends((0,n.O)(o.oY)){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map((e=>(0,m.aq)(j,e))):"string"==typeof e||"function"==typeof e||e instanceof HTMLElement||(0,c.$X)(e)?e:(l.A.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:r}=t;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(t.description,t.mediaInfos,r):this._readPopupInfo(t)}writeContent(e,t,r,i){"string"!=typeof e?Array.isArray(e)&&(t.popupElements=e.filter((e=>H.has(e.type))).map((e=>e?.toJSON(i))),t.popupElements.forEach((e=>{"attachments"===e.type?this._writeAttachmentContent(t):"media"===e.type?this._writeMediaContent(e,t):"text"===e.type?this._writeTextContent(e,t):"relationship"===e.type&&this._writeRelationshipContent(e,t)}))):t.description=e}writeFieldInfos(e,t,r,i){const{content:n}=this,s=Array.isArray(n)?n:null;if(e){const r=s?s.filter((e=>"fields"===e.type)):[],n=r.length&&r.every((e=>e.fieldInfos?.length));t.fieldInfos=e.filter(Boolean).map((e=>{const t=e.toJSON(i);return n&&(t.visible=!1),t}))}if(s)for(const o of s)"fields"===o.type&&this._writeFieldsContent(o,t)}writeLayerOptions(e,t,r,i){t[r]=!e||null===e.showNoDataRecords&&null===e.returnTopmostRaster?null:e.toJSON(i)}writeTitle(e,t){t.title=e||""}async collectRequiredFields(e,t){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...r,...this._getContentExpressionInfos(this.content,r)]),(0,g._w)(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=(0,a.o8)(e.fieldInfos);Array.isArray(t.fieldInfos)?r.forEach((e=>{const r=t.fieldInfos.find((t=>t.fieldName?.toLowerCase()===e.fieldName?.toLowerCase()));r?r.visible=!0:t.fieldInfos.push(e)})):t.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,t){const r=e.orderByFields?.map((t=>this._toFieldOrderJSON(t,e.relationshipId)))||[],i=[...t.relatedRecordsInfo?.orderByFields||[],...r];t.relatedRecordsInfo={showRelatedRecords:!0,...i?.length&&{orderByFields:i}}}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=(0,a.o8)(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...r]:t.mediaInfos=r}_readPopupInfoElements(e,t,r){const i={description:!1,mediaInfos:!1};return r.map((r=>"media"===r.type?(r.mediaInfos||!t||i.mediaInfos||(r.mediaInfos=t,i.mediaInfos=!0),x.A.fromJSON(r)):"text"===r.type?(r.text||!e||i.description||(r.text=e,i.description=!0),T.A.fromJSON(r)):"attachments"===r.type?y.A.fromJSON(r):"fields"===r.type?w.A.fromJSON(r):"expression"===r.type?b.A.fromJSON(r):"relationship"===r.type?S.A.fromJSON(r):void 0)).filter(Boolean)}_toRelationshipContent(e){const{field:t,order:r}=e;if(!t?.startsWith(U))return null;const i=t.replace(U,"").split("/");if(2!==i.length)return null;const n=parseInt(i[0],10),s=i[1];return"number"==typeof n&&s?S.A.fromJSON({relationshipId:n,orderByFields:[{field:s,order:r}]}):null}_toFieldOrderJSON(e,t){const{order:r,field:i}=e;return{field:`${U}${t}/${i}`,order:r}}_readPopupInfo(e){let{description:t,mediaInfos:r,showAttachments:i,relatedRecordsInfo:n={showRelatedRecords:!1}}=e;const s=[];t?s.push(new T.A({text:t})):s.push(new w.A),Array.isArray(r)&&r.length&&s.push(x.A.fromJSON({mediaInfos:r})),i&&s.push(y.A.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=n;return o&&a?.length&&a.forEach((e=>{const t=this._toRelationshipContent(e);t&&s.push(t)})),s.length?s:t}_getContentElementFields(e){const t=e?.type;if("attachments"===t)return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if("custom"===t)return e.outFields||[];if("fields"===t)return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if("media"===t){const t=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...t.reduce(((e,t)=>[...e,...this._getMediaInfoFields(t)]),[])]}return"text"===t?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:r,value:i}=e,n=i||{},{fields:s,normalizeField:o,tooltipField:a,sourceURL:l,linkURL:c}=n,u=[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...s??[]];return o&&u.push(o),a&&u.push(a),u}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce(((e,t)=>[...e,..."expression"===t.type&&t.expressionInfo?[t.expressionInfo]:[]]),t):[]}_getContentFields(e){return"string"==typeof e?this._extractFieldNames(e):Array.isArray(e)?e.reduce(((e,t)=>[...e,...this._getContentElementFields(t)]),[]):[]}async _collectExpressionInfoFields(e,t,r){r&&await Promise.all(r.map((r=>(0,g.Dx)(e,t,r.expression))))}_getFieldInfoFields(e){return e?e.filter((e=>{let{fieldName:t,visible:r}=e;return!(void 0!==r&&!r||!t||t.startsWith(U)||t.startsWith(V))})).map((e=>e.fieldName)):[]}_getActionsFields(e){return e?e.toArray().reduce(((e,t)=>[...e,...this._getActionFields(t)]),[]):[]}_getActionFields(e){const{className:t,title:r,type:i}=e,n="button"===i||"toggle"===i?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(n)]}_getTitleFields(e){return"string"==typeof e?this._extractFieldNames(e):[]}_extractFieldNames(e){return(0,g.nw)(e).filter((e=>!(0===e.indexOf(U)||0===e.indexOf(V))))}};(0,i._)([(0,u.MZ)({type:B})],G.prototype,"actions",void 0),(0,i._)([(0,u.MZ)()],G.prototype,"content",void 0),(0,i._)([(0,h.w)("content")],G.prototype,"castContent",null),(0,i._)([(0,d.w)("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],G.prototype,"readContent",null),(0,i._)([(0,f.K)("content",{popupElements:{type:s.A.ofType(M)},showAttachments:{type:Boolean},mediaInfos:{type:s.A.ofType(D.g)},description:{type:String},relatedRecordsInfo:{type:N}})],G.prototype,"writeContent",null),(0,i._)([(0,u.MZ)({type:[C.A],json:{write:!0}})],G.prototype,"expressionInfos",void 0),(0,i._)([(0,u.MZ)({type:[E.A]})],G.prototype,"fieldInfos",void 0),(0,i._)([(0,f.K)("fieldInfos")],G.prototype,"writeFieldInfos",null),(0,i._)([(0,u.MZ)({type:P})],G.prototype,"layerOptions",void 0),(0,i._)([(0,f.K)("layerOptions")],G.prototype,"writeLayerOptions",null),(0,i._)([(0,u.MZ)({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],G.prototype,"lastEditInfoEnabled",void 0),(0,i._)([(0,u.MZ)()],G.prototype,"outFields",void 0),(0,i._)([(0,u.MZ)()],G.prototype,"overwriteActions",void 0),(0,i._)([(0,u.MZ)()],G.prototype,"returnGeometry",void 0),(0,i._)([(0,u.MZ)({json:{type:String}})],G.prototype,"title",void 0),(0,i._)([(0,f.K)("title")],G.prototype,"writeTitle",null),G=(0,i._)([(0,p.$)("esri.PopupTemplate")],G);const Z=G},82111:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var i,n=r(35143),s=r(42553),o=r(18288),a=r(46053),l=(r(81806),r(76460),r(47249),r(28379)),c=r(85842),u=r(17707),h=r(67478);let d=i=class extends s.oY{static get allTime(){return p}static get empty(){return f}static fromArray(e){return new i({start:null!=e[0]?new Date(e[0]):e[0],end:null!=e[1]?new Date(e[1]):e[1]})}constructor(e){super(e),this.end=null,this.start=null}readEnd(e,t){return null!=t.end?new Date(t.end):null}writeEnd(e,t){t.end=e?.getTime()??null}get isAllTime(){return this.equals(i.allTime)}get isEmpty(){return this.equals(i.empty)}readStart(e,t){return null!=t.start?new Date(t.start):null}writeStart(e,t){t.start=e?.getTime()??null}clone(){return new i({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=this.start?.getTime()??this.start,r=this.end?.getTime()??this.end,i=e.start?.getTime()??e.start,n=e.end?.getTime()??e.end;return t===i&&r===n}expandTo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.qU;if(this.isEmpty||this.isAllTime)return this.clone();let r=this.start;r&&(r=(0,o.lL)(r,e,t));let n=this.end;if(n){const r=(0,o.lL)(n,e,t);n=n.getTime()===r.getTime()?r:(0,o.S1)(r,1,e,t)}return new i({start:r,end:n})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return i.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=this.start?.getTime()??-1/0,r=this.end?.getTime()??1/0,n=e.start?.getTime()??-1/0,s=e.end?.getTime()??1/0;let o,a;return n>=t&&n<=r?o=n:t>=n&&t<=s&&(o=t),r>=n&&r<=s?a=r:s>=t&&s<=r&&(a=s),null==o||null==a||isNaN(o)||isNaN(a)?i.empty:new i({start:o===-1/0?null:new Date(o),end:a===1/0?null:new Date(a)})}offset(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.qU;if(this.isEmpty||this.isAllTime)return this.clone();const n=new i,{start:s,end:a}=this;return null!=s&&(n.start=(0,o.S1)(s,e,t,r)),null!=a&&(n.end=(0,o.S1)(a,e,t,r)),n}toArray(){return this.isEmpty?[void 0,void 0]:[this.start?.getTime()??null,this.end?.getTime()??null]}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return p.clone();const t=null!=this.start&&null!=e.start?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,r=null!=this.end&&null!=e.end?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new i({start:t,end:r})}};(0,n._)([(0,a.MZ)({type:Date,json:{write:{allowNull:!0}}})],d.prototype,"end",void 0),(0,n._)([(0,l.w)("end")],d.prototype,"readEnd",null),(0,n._)([(0,u.K)("end")],d.prototype,"writeEnd",null),(0,n._)([(0,a.MZ)({readOnly:!0,json:{read:!1}})],d.prototype,"isAllTime",null),(0,n._)([(0,a.MZ)({readOnly:!0,json:{read:!1}})],d.prototype,"isEmpty",null),(0,n._)([(0,a.MZ)({type:Date,json:{write:{allowNull:!0}}})],d.prototype,"start",void 0),(0,n._)([(0,l.w)("start")],d.prototype,"readStart",null),(0,n._)([(0,u.K)("start")],d.prototype,"writeStart",null),d=i=(0,n._)([(0,c.$)("esri.TimeExtent")],d);const p=new d,f=new d({start:void 0,end:void 0}),m=d},53666:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i=r(35143),n=r(69098),s=r(42553),o=r(18288),a=r(46053),l=(r(81806),r(76460),r(47249),r(6409)),c=r(85842),u=r(90115);let h=class extends((0,n.O)(s.oY)){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return(0,o.t)(this.value,this.unit,"milliseconds")}};(0,i._)([(0,l.e)(u.j,{nonNullable:!0})],h.prototype,"unit",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0},nonNullable:!0})],h.prototype,"value",void 0),h=(0,i._)([(0,c.$)("esri.TimeInterval")],h);const d=h},28899:(e,t,r)=>{"use strict";r.d(t,{N:()=>l,s:()=>c});var i=r(86560),n=r(3825),s=r(50076),o=r(76460),a=r(90534);function l(e,t){return(0,n.A)(c(e),t)}function c(e){if(!i.A.assetsPath)throw o.A.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new s.A("assets:path-not-set","config.assetsPath is not set");return(0,a.fj)(i.A.assetsPath,e)}},78677:(e,t,r)=>{"use strict";r.d(t,{A:()=>a,a:()=>c,b:()=>l});var i=r(73398),n=r(64839),s=r(32307),o=r(70367);class a extends n.Y{}function l(e){const t=new s.N5;t.include(i.c),t.fragment.uniforms.add(new o.N("colorTexture",(e=>e.color)),new o.N("depthTexture",(e=>e.depth)));const r=e.haze;return t.fragment.code.add(n.H`
    void main() {
      float depthSample = texture(depthTexture, uv).r;
      if (depthSample ${r?n.H`== 1.0`:n.H`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `),t}const c=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:a,build:l},Symbol.toStringTag,{value:"Module"}))},28590:(e,t,r)=>{"use strict";r.d(t,{B:()=>f,a:()=>i,b:()=>p});var i,n=r(10909),s=r(4747),o=r(79360),a=r(25252),l=r(5517),c=r(21390),u=r(64839),h=r(32307),d=r(70367);function p(e){const t=new h.N5,r=t.fragment;if(t.include(a.W),e.background===i.Only){const i=e.output===s.x.ColorComposite;return i?r.uniforms.add(new l.t("backgroundColor",(e=>e.backgroundColor))):r.include(n.z),r.code.add(u.H`
      void main() {
        fragColor = vec4(${i?u.H`backgroundColor`:u.H`gridColor(uv)`}, 1.0);
      }
    `),t}return t.include(o.P,e),r.uniforms.add(new d.N("tex",(e=>e.texture)),new c.m("opacity",(e=>e.opacity))).code.add(u.H`void main() {
fragColor = blendLayers(uv, texture(tex, uv), opacity);
}`),t}!function(e){e[e.BelowLayer=0]="BelowLayer",e[e.Only=1]="Only",e[e.COUNT=2]="COUNT"}(i||(i={}));const f=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return i},build:p},Symbol.toStringTag,{value:"Module"}))},32581:(e,t,r)=>{"use strict";r.d(t,{B:()=>c,b:()=>l});var i=r(73398),n=r(64839),s=r(32307),o=r(70367);const a={maxSearchSteps:8,maxDistanceAreaTex:16};function l(){const e=new s.N5;return e.include(i.c),e.fragment.uniforms.add(new o.N("edgesTexture",(e=>e.inputTexture)),new o.N("areaTexture",(e=>e.areaTexture)),new o.N("searchTexture",(e=>e.searchTexture))),e.fragment.code.add(n.H`
    #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
    #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

    vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
      return texture(tex, coord + offset.x * resolution, 0.0);
    }

    float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture( searchTex, e, 0.0 ).r;
    }

    float searchLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${n.H.int(a.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${n.H.int(a.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
      return texcoord.x;
    }

    float searchUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${n.H.int(a.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
      return texcoord.y;
    }

    float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${n.H.int(a.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
      return texcoord.y;
    }

    vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
      vec2 texcoord = float( ${n.H.int(a.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
      texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
      texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
      return texture( areaTex, texcoord, 0.0 ).rg;
    }

    void main() {
      vec2 size = vec2(textureSize(edgesTexture, 0));
      vec2 resolution = 1.0 / size;
      vec2 pixelCoord = uv * size;
      vec4 offsets[2];
      offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
      offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
      vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${n.H.int(a.maxSearchSteps)} );

      ivec4 subsampleIndices = ivec4(0.0);
      vec4 weights = vec4(0.0);
      vec2 e = texture( edgesTexture, uv ).rg;
      if ( e.g > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.x = searchLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
        coords.y = offsets[1].y;
        d.x = coords.x;
        float e1 = texture( edgesTexture, coords, 0.0 ).r;
        coords.x = searchRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
        d.y = coords.x;
        d = d * size.x - pixelCoord.x;
        vec2 sqrt_d = sqrt( abs(d) );
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
        weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
      }

      if ( e.r > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.y = searchUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
        coords.x = offsets[0].x;
        d.x = coords.y;
        float e1 = texture( edgesTexture, coords, 0.0 ).g;
        coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
        d.y = coords.y;
        d = d * size.y - pixelCoord.y;
        vec2 sqrt_d = sqrt(abs(d));
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
        weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

        // for some reason the following lines are necessary to prevent
        // texture lookup precision issues on some Intel integrated graphics chips
        vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
        weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
      }
      fragColor = weights;
    }`),e}const c=Object.freeze(Object.defineProperty({__proto__:null,build:l},Symbol.toStringTag,{value:"Module"}))},58090:(e,t,r)=>{"use strict";r.d(t,{B:()=>l,b:()=>a});var i=r(73398),n=r(64839),s=r(32307),o=r(70367);function a(){const e=new s.N5;return e.include(i.c),e.fragment.uniforms.add(new o.N("blendWeightsTexture",(e=>e.inputTexture)),new o.N("colorTexture",(e=>e.color))),e.fragment.code.add(n.H`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),e}const l=Object.freeze(Object.defineProperty({__proto__:null,build:a},Symbol.toStringTag,{value:"Module"}))},60071:(e,t,r)=>{"use strict";r.d(t,{C:()=>A,a:()=>T,b:()=>b});var i=r(34761),n=r(13191),s=r(9392),o=r(45462),a=r(97808),l=r(65058),c=r(94759),u=r(43557),h=r(95756),d=r(5517),p=r(58350),f=r(21390),m=r(64839),g=r(43425),y=r(32307),_=r(70367),v=r(66470);const b=(0,s.fA)(parseFloat(Number(5802e-9).toFixed(6)),parseFloat(Number(13558e-9).toFixed(6)),parseFloat(Number(331e-7).toFixed(6))),w=(0,s.fA)(3*parseFloat(Number(65e-8).toFixed(6)),3*parseFloat(Number(1881e-9).toFixed(6)),3*parseFloat(Number(85e-9).toFixed(6))),x=3996e-9,S=(0,s.fA)(parseFloat(Number(b[0]+w[0]).toFixed(6)),parseFloat(Number(b[1]+w[1]).toFixed(6)),parseFloat(Number(b[2]+w[2]).toFixed(6)));function T(e){const t=new y.N5;t.attributes.add(v.r.POSITION,"vec2"),t.include(a.U,{textureCoordinateType:a.q.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:r,fragment:n}=t;return r.uniforms.add(new g.X("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new g.X("inverseViewMatrix",((e,t)=>(0,i.Qw)(M,t.camera.viewMatrix)))),r.code.add(m.H`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),n.uniforms.add(new d.t("backgroundColor",(e=>e.backgroundColor)),new h.G("radii",(e=>e.radii)),new d.t("cameraPosition",((e,t)=>t.camera.eye)),new p.E("heightParameters",(e=>e.heightParameters)),new f.m("innerFadeDistance",(e=>e.innerFadeDistance)),new f.m("altitudeFade",(e=>e.altitudeFade)),new _.N("depthTexture",(e=>e.depthTexture)),new f.m("hazeStrength",(e=>e.hazeStrength))),n.constants.add("betaRayleigh","vec3",b),n.constants.add("betaCombined","vec3",S),n.constants.add("betaMie","float",x),n.constants.add("scaleHeight","float",o.nv*o.yv),(0,u.Gc)(n),t.include(c.C),e.haze&&n.include(l.E),n.code.add(m.H`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),n.code.add(m.H`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),n.code.add(m.H`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),n.code.add(m.H`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?m.H`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?"":m.H`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":m.H`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${e.haze?m.H`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:m.H`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${e.haze?"":m.H`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${e.haze&&e.reduced?m.H`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?m.H`
          float depthSample = texture(depthTexture, vuv0).r;
          if (depthSample != 1.0) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${e.reduced?m.H`cameraSpaceRay *= -textureBilinear(vuv0);`:m.H`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:m.H`${e.reduced?"":m.H`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${e.haze?m.H`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != 1.0){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:m.H`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":m.H`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),t}const M=(0,n.vt)(),A=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:b,build:T},Symbol.toStringTag,{value:"Module"}))},16619:(e,t,r)=>{"use strict";r.d(t,{C:()=>y,a:()=>b,b:()=>_});var i=r(15941),n=r(44680),s=r(19555),o=r(72745),a=r(46141),l=r(60645),c=r(89426),u=r(73398),h=r(95756),d=r(21390),p=r(64839),f=r(72106),m=r(32307),g=r(70367);class y extends p.Y{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=a.n.default.raymarchingSteps,this.weatherTile=(0,o.vt)(),this.viewMatrix=(0,n.vt)()}}function _(e){const t=new m.N5;t.include(u.c,!1);const r=t.fragment;return r.uniforms.add(new d.m("cloudRadius",(e=>e.cloudRadius)),new d.m("power",(e=>(0,i.Cc)(35,120,e.absorption))),new d.m("sigmaE",(e=>1+e.absorption)),new d.m("density",(e=>(0,i.Cc)(0,.3,e.density))),new d.m("cloudSize",(e=>(0,i.Cc)(0,.02,Math.max(.01,1-e.cloudSize)))),new d.m("detailSize",(e=>(0,i.Cc)(0,.2,Math.max(.01,1-e.detailSize)))),new d.m("smoothness",(e=>(0,i.Cc)(0,.5,1-e.smoothness))),new d.m("cloudHeight",(e=>(0,i.Cc)(0,1500,e.cloudHeight))),new d.m("coverage",(e=>e.coverage)),new f.k("view",(e=>e.viewMatrix)),new g.N("cloudShapeTexture",(e=>null!=e.noiseTexture?e.noiseTexture.textureAtlas:null)),new h.G("cloudVariables",(e=>(0,s.hZ)(v,e.coverage,e.absorption)))),r.constants.add("halfCubeMapSize","float",.5*e.cubeMapSize),r.code.add(p.H`
    const int STEPS = ${e.steps===l.p.SIXTEEN?p.H`16`:e.steps===l.p.HUNDRED?p.H`100`:p.H`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(p.H`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${p.H.float(c.jj)};
      const float dataWidth = ${p.H.float(c.jj)};
      const float tileRows = ${p.H.float(c.ik)};
      const vec3 atlasDimensions = vec3(${p.H.float(c.CQ)}, ${p.H.float(c.CQ)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${p.H.float(c.Y8)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${p.H.float(c.fI)} * p) / ${p.H.float(c.jj)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),r.code.add(p.H`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(p.H`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add("\n    float multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation = 1.0;\n      float contribution = 1.0;\n      float phaseAttenuation = 1.0;\n      float luminance = 0.0;\n\n      for (int i = 0; i < 4; i++) {\n        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *= 0.2;\n        contribution *= 0.6;\n        phaseAttenuation *= 0.5;\n      }\n\n      return luminance;\n    }"),r.code.add(p.H`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(p.H`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(p.H`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),t}const v=(0,o.vt)(),b=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:y,build:_},Symbol.toStringTag,{value:"Module"}))},2565:(e,t,r)=>{"use strict";r.d(t,{C:()=>b,b:()=>_});var i=r(34761),n=r(13191),s=r(50819),o=r(94759),a=r(43557),l=r(26719),c=r(36324),u=r(24475),h=r(80883),d=r(81449),p=r(5517),f=r(64839),m=r(43425),g=r(32307),y=r(66470);function _(){const e=new g.N5,{attributes:t,varyings:r,vertex:n,fragment:_}=e;return t.add(y.r.POSITION,"vec2"),r.add("worldRay","vec3"),n.uniforms.add(new m.X("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new m.X("inverseViewMatrix",((e,t)=>(0,i.Qw)(v,t.camera.viewMatrix)))),n.code.add(f.H`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),_.include(h.a),_.include(d.W),e.include(s.W,{pbrMode:l.A9.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(c.p),e.include(o.C),e.include(a.qU),e.include(u.g),_.uniforms.add(new p.t("cameraPosition",((e,t)=>t.camera.eye))),_.code.add(f.H`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const v=(0,n.vt)(),b=Object.freeze(Object.defineProperty({__proto__:null,build:_},Symbol.toStringTag,{value:"Module"}))},37923:(e,t,r)=>{"use strict";r.d(t,{C:()=>b,b:()=>v});var i=r(34981),n=r(26917),s=r(59395),o=r(90080),a=r(54478),l=r(48020),c=r(81993),u=r(66763),h=r(90235),d=r(80883),p=r(3799),f=r(58350),m=r(64839),g=r(32307),y=r(10773),_=r(66470);function v(e){const t=new g.N5,{vertex:r,fragment:v,attributes:b,varyings:w}=t;(0,p.NB)(r,e),t.include(s.d,e),t.include(a.c,e),t.include(u.A,e),t.include(o.g,e),b.add(_.r.POSITION,"vec3"),e.vvColor&&b.add(_.r.COLORFEATUREATTRIBUTE,"float"),w.add("vColor","vec4"),w.add("vpos","vec3");const x=e.multipassEnabled&&e.output===i.V.Color;x&&w.add("depth","float"),r.uniforms.add(new f.E("eColor",(e=>e.color))),r.code.add(m.H`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${e.hasVertexColors?"vColor *= eColor;":e.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${x?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(n.HQ,e),x&&t.include(c.Q,e),v.include(d.a);const S=e.output===i.V.Highlight;return S&&t.include(l.Qh,e),e.transparencyPassType===y.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),v.code.add(m.H`
  void main() {
    discardBySlice(vpos);
    ${x?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${e.output===i.V.ObjectAndLayerIdColor?m.H`fColor.a = 1.0;`:""}

    if (fColor.a < ${m.H.float(h.y)}) {
      discard;
    }

    ${e.output===i.V.Color?m.H`fragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===y.y.ColorAlpha?m.H`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}`:""}
    ${S?m.H`outputHighlight();`:""};
    ${e.output===i.V.ObjectAndLayerIdColor?m.H`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const b=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},42287:(e,t,r)=>{"use strict";r.d(t,{C:()=>k,b:()=>F});var i=r(14556),n=r(29898),s=r(44493),o=r(13545),a=r(28710),l=r(72412),c=r(34981),u=r(26917),h=r(59046),d=r(97808),p=r(54478),f=r(55386),m=r(36358),g=r(49399),y=r(48020),_=r(65058),v=r(90011),b=r(72937),w=r(21372),x=r(67799),S=r(43557),T=r(81993),M=r(26719),A=r(47331),C=r(86279),E=r(12057),R=r(90235),P=r(55806),O=r(81148),I=r(64839),L=r(32307),N=r(70367),D=r(10773);function F(e){const t=new L.N5;t.include(m.em,e),t.include(f.Mh,e),t.include(p.c,e),t.include(d.U,e),t.include(l.oD,e),t.include(o.cz,e),t.include(P.H,e),t.include(u.S4,e),t.include(A.E,e),t.include(a.j,e);const{vertex:r,fragment:F}=t;e.pbrMode!==M.A9.Normal&&e.pbrMode!==M.A9.Schematic||(t.include(M._Z,e),e.hasNormalTexture&&t.include(b.W,e));const k=e.output===c.V.Shadow||e.output===c.V.ShadowHighlight||e.output===c.V.ShadowExcludeHighlight;k&&e.componentData===o.Sg.Varying?r.code.add(I.H`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(I.H`#define discardShadows(castShadows) {}`);const z=e.integratedMeshMode===s.g.ColorOverlay||e.integratedMeshMode===s.g.ColorOverlayWithWater,U=z&&e.output===c.V.Color&&e.pbrMode===M.A9.WaterOnIntegratedMesh;z&&(t.include(x.kA,e),t.include(E.Tv,e),e.spherical?r.code.add(I.H`
      const float invEllipsoidRadius = ${I.H.float(1/(e.ellipsoidMode===O.T.Earth?i.$O.radius:e.ellipsoidMode===O.T.Mars?i.sH.radius:i.Sw.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(I.H`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),U&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3")),r.code.add(I.H`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${e.output===c.V.ObjectAndLayerIdColor?I.H`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${I.H.float(R.y)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${e.output===c.V.ObjectAndLayerIdColor?I.H`forwardObjectAndLayerIdColor();`:""}
      ${U?e.spherical?I.H`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:I.H`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${z?I.H`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),e.output===c.V.Color&&(F.include(_.D),t.include(T.Q,e),t.include(v.o,e),t.include(w.f,e),t.include(x.kA,e),e.transparencyPassType===D.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),e.receiveShadows?(t.include(C.G,e),F.code.add(I.H`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):F.code.add(I.H`float evaluateShadow() { return 0.0; }`),z&&F.uniforms.add(new N.N("ovColorTex",((e,t)=>(0,E.Lg)(e,t)))),F.code.add(I.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.multipassEnabled?I.H`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${z?I.H`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),e.pbrMode===M.A9.Normal||e.pbrMode===M.A9.Schematic?((0,S.O4)(F),F.code.add(I.H`
        ${e.pbrMode===M.A9.Normal?I.H`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),e.hasNormalTexture?F.code.add(I.H`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):F.code.add(I.H`vec3 shadingNormal = normalVertex;`),F.code.add(I.H`${e.spherical?I.H`vec3 normalGround = normalize(positionWorld());`:I.H`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),F.code.add(I.H`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();
        ${e.snowCover?I.H`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                ssao = mix(ssao, 0.5 * ssao, snow);
                shadingNormal = mix(shadingNormal, surfaceNormal, snow);`:""}

        ${z?I.H` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(e.receiveShadows?F.code.add(I.H`float shadow = evaluateShadow();`):e.spherical?((0,x.eU)(F),F.code.add(I.H`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):F.code.add(I.H`float shadow = 0.0;`),U&&F.uniforms.add(new N.N("ovNormalTex",((e,t)=>t.overlay?.getTexture(n.A.WaterNormal)))),e.snowCover&&F.code.add(I.H`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),F.code.add(I.H`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${z?I.H` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${U?I.H`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),F.code.add(I.H`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.transparencyPassType===D.y.ColorAlpha?I.H`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `));const V=e.output===c.V.Depth;return(V||k||e.output===c.V.ViewshedShadow)&&(V||t.include(g.L,e),F.code.add(I.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${V?"":I.H`outputDepth(linearDepth);`}
      }
    `)),e.output===c.V.Normal&&(t.include(w.f,e),F.code.add(I.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${e.normalType===h.W.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===c.V.ObjectAndLayerIdColor&&t.fragment.code.add(I.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${z?I.H`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),e.output===c.V.Highlight&&(t.include(y.Qh),F.code.add(I.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${z?I.H`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),t}const k=Object.freeze(Object.defineProperty({__proto__:null,build:F},Symbol.toStringTag,{value:"Module"}))},80517:(e,t,r)=>{"use strict";r.d(t,{C:()=>h,a:()=>p,b:()=>d});var i=r(73398),n=r(65058),s=r(81449),o=r(95756),a=r(21390),l=r(64839),c=r(32307),u=r(70367);class h extends l.Y{constructor(){super(...arguments),this.opacity=1}}function d(e){const t=new c.N5;return t.include(i.c),t.fragment.uniforms.add(new u.N("tex",(e=>e.texture))),e.hasOpacityFactor&&t.fragment.uniforms.add(new a.m("opacity",(e=>e.opacity))),e.isDepthBlit&&(t.fragment.uniforms.add(new o.G("nearFar",((e,t)=>t.camera.nearFar))),t.fragment.include(n.E),t.fragment.include(s.W)),t.fragment.code.add(l.H`
    void main() {
      ${e.isDepthBlit?l.H`
              float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
              fragColor = float2rgba(normalizedLinearDepth);`:l.H`
              fragColor = texture(tex, uv) ${e.hasOpacityFactor?"* opacity":""};`}
    }`),t}const p=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:h,build:d},Symbol.toStringTag,{value:"Module"}))},68745:(e,t,r)=>{"use strict";r.d(t,{D:()=>B,b:()=>V});var i=r(72412),n=r(62026),s=r(34981),o=r(26917),a=r(59395),l=r(45937),c=r(59046),u=r(838),h=r(22148),d=r(97808),p=r(54478),f=r(55386),m=r(25530),g=r(15710),y=r(72937),_=r(78264),v=r(67799),b=r(43557),w=r(81993),x=r(27920),S=r(42953),T=r(26719),M=r(86279),A=r(55696),C=r(66763),E=r(90235),R=r(55806),P=r(77904),O=r(3799),I=r(5517),L=r(58350),N=r(21390),D=r(64839),F=r(32307),k=r(70367),z=r(10773),U=r(66470);function V(e){const t=new F.N5,{vertex:r,fragment:V,varyings:B}=t;if((0,O.NB)(r,e),t.include(u.I),B.add("vpos","vec3"),t.include(C.A,e),t.include(l.BK,e),t.include(m.G,e),t.include(A.q2,e),e.output===s.V.Color){t.include(A.Sx,e),t.include(A.MU,e),t.include(A.O1,e),t.include(A.QM,e),(0,O.yu)(r,e),t.include(c.Y,e),t.include(a.d,e);const s=e.normalType===c.W.Attribute||e.normalType===c.W.Compressed;s&&e.offsetBackfaces&&t.include(n.M),t.include(y.W,e),t.include(f.Mh,e),e.instancedColor&&t.attributes.add(U.r.INSTANCECOLOR,"vec4"),B.add("vPositionLocal","vec3"),t.include(d.U,e),t.include(i.oD,e),t.include(h.K,e),t.include(p.c,e),r.uniforms.add(new L.E("externalColor",(e=>e.externalColor))),B.add("vcolorExt","vec4"),e.multipassEnabled&&B.add("depth","float"),r.code.add(D.H`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${D.H.float(E.y)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${s?D.H`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${s&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        forwardColorUV();
        forwardNormalUV();
        forwardEmissiveUV();
        forwardOcclusionUV();
        forwardMetallicRoughnessUV();
      }
    `),t.include(o.HQ,e),t.include(v.kA,e),t.include(_.n,e),t.include(R.S,e),t.include(e.instancedDoublePrecision?M.G:M.Bz,e),t.include(w.Q,e),(0,O.yu)(V,e),V.uniforms.add(r.uniforms.get("localOrigin"),new I.t("ambient",(e=>e.ambient)),new I.t("diffuse",(e=>e.diffuse)),new N.m("opacity",(e=>e.opacity)),new N.m("layerOpacity",(e=>e.layerOpacity))),e.hasColorTexture&&V.uniforms.add(new k.N("tex",(e=>e.texture))),t.include(T._Z,e),t.include(S.c,e),V.include(P.N),t.include(x.r,e),(0,v.a8)(V),(0,v.eU)(V),(0,b.O4)(V),e.transparencyPassType===z.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),V.code.add(D.H`
      void main() {
        discardBySlice(vpos);
        ${e.multipassEnabled?"terrainDepthTest(depth);":""}
        ${e.hasColorTexture?D.H`
                vec4 texColor = texture(tex, ${e.hasColorTextureTransform?D.H`colorUV`:D.H`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:D.H`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===c.W.ScreenDerivative?D.H`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:D.H`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===T.A9.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${e.receiveShadows?"readShadowMap(vpos, linearDepth)":e.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?D.H`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:D.H`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?D.H`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${e.hasNormalTextureTransform?D.H`normalUV`:"vuv0"});`:D.H`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?D.H`normalize(posWorld);`:D.H`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?D.H`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===T.A9.Normal||e.pbrMode===T.A9.Schematic?D.H`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${e.snowCover?D.H`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:D.H`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===z.y.ColorAlpha?D.H`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
      }
    `)}return t.include(g.E,e),t}const B=Object.freeze(Object.defineProperty({__proto__:null,build:V},Symbol.toStringTag,{value:"Module"}))},21199:(e,t,r)=>{"use strict";r.d(t,{E:()=>c,b:()=>l});var i=r(73398),n=r(64839),s=r(32307),o=r(70367);const a={threshold:.05,localConstrastAdaption:2};function l(){const e=new s.N5;return e.include(i.c),e.fragment.uniforms.add(new o.N("colorTexture",(e=>e.color))),e.outputs.add("fragEdges","vec2"),e.fragment.code.add(n.H`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${n.H.float(a.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${n.H.float(a.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `),e}const c=Object.freeze(Object.defineProperty({__proto__:null,build:l},Symbol.toStringTag,{value:"Module"}))},48761:(e,t,r)=>{"use strict";r.d(t,{F:()=>y,a:()=>b,b:()=>_});var i=r(34761),n=r(13191),s=r(9392),o=r(97808),a=r(65058),l=r(94759),c=r(95756),u=r(5517),h=r(21390),d=r(64839),p=r(43425),f=r(32307),m=r(70367),g=r(66470);class y extends d.Y{constructor(){super(...arguments),this.fogColor=(0,s.vt)(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}}function _(){const e=new f.N5;e.attributes.add(g.r.POSITION,"vec2"),e.include(o.U,{textureCoordinateType:o.q.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:t,fragment:r}=e;return t.uniforms.add(new p.X("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new p.X("inverseViewMatrix",((e,t)=>(0,i.Qw)(v,t.camera.viewMatrix)))),t.code.add(d.H`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new h.m("atmosphereC",(e=>e.atmosphereC)),new u.t("cameraPosition",((e,t)=>t.camera.eye)),new c.G("nearFar",((e,t)=>t.camera.nearFar)),new m.N("depthTexture",(e=>e.depthTexture)),new h.m("fogStrength",(e=>e.fogStrength)),new h.m("fogAmount",(e=>e.fogAmount)),new u.t("fogColor",(e=>e.fogColor))),e.include(l.C),r.include(a.D),r.code.add(d.H`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(d.H`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(d.H`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),e}const v=(0,n.vt)(),b=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:y,build:_},Symbol.toStringTag,{value:"Module"}))},35072:(e,t,r)=>{"use strict";r.d(t,{H:()=>a,a:()=>c,b:()=>l});var i=r(73398),n=r(64839),s=r(32307),o=r(70367);class a extends n.Y{}function l(){const e=new s.N5;return e.include(i.c),e.fragment.uniforms.add(new o.N("tex",(e=>e.texture))),e.fragment.code.add(n.H`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),e}const c=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:a,build:l},Symbol.toStringTag,{value:"Module"}))},19061:(e,t,r)=>{"use strict";r.d(t,{H:()=>I,b:()=>E,c:()=>P});var i=r(19555),n=r(72745),s=r(55855),o=r(34981),a=r(26917),l=r(90080),c=r(98720),u=r(40318),h=r(38280),d=r(62374),p=r(48020),f=r(66763),m=r(90235),g=r(80883),y=r(81449),_=r(69817),v=r(3799),b=r(95756),w=r(58350),x=r(21390),S=r(64839),T=r(32307),M=r(70367),A=r(10773),C=r(66470);function E(e){const t=new T.N5,r=e.signedDistanceFieldEnabled;if(t.include(u.Q,e),t.include(a.HQ,e),e.occlusionPass)return t.include(h.I,e),t;const{vertex:n,fragment:E}=t;t.include(_.Y6),E.include(y.W),E.include(g.a),t.include(f.A,e),t.include(l.g,e),t.include(d.y),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),t.varyings.add("voccluded","float"),n.uniforms.add(new w.E("viewport",((e,t)=>t.camera.fullViewport)),new b.G("screenOffset",((e,t)=>(0,i.hZ)(O,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new b.G("anchorPosition",(e=>P(e))),new w.E("materialColor",(e=>e.color))),(0,v.Nz)(n),r&&(n.uniforms.add(new w.E("outlineColor",(e=>e.outlineColor))),E.uniforms.add(new w.E("outlineColor",(e=>R(e)?e.outlineColor:s.uY)),new x.m("outlineSize",(e=>R(e)?e.outlineSize:0)))),e.pixelSnappingEnabled&&n.include(c.K),e.hasScreenSizePerspective&&((0,_.pM)(n),(0,_.OH)(n)),e.debugDrawLabelBorder&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(C.r.UV0,"vec2"),t.attributes.add(C.r.COLOR,"vec4"),t.attributes.add(C.r.SIZE,"vec2"),t.attributes.add(C.r.FEATUREATTRIBUTE,"vec4"),n.code.add(S.H`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?S.H`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:S.H`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const I=S.H`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,L=e.pixelSnappingEnabled?r?S.H`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:S.H`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:S.H`posProj += quadOffset;`;n.code.add(S.H`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${I}
    ${e.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${e.output===o.V.ObjectAndLayerIdColor?S.H`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${S.H.float(m.y)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${S.H.float(m.y)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${L}
      gl_Position = posProj;
    }

    vtc = uv;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?S.H`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),E.uniforms.add(new M.N("tex",(e=>e.texture)));const N=e.debugDrawLabelBorder?S.H`(isBorder > 0.0 ? 0.0 : ${S.H.float(m.H)})`:S.H.float(m.H),D=S.H`
    ${e.debugDrawLabelBorder?S.H`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${e.sampleSignedDistanceFieldTexelCenter?S.H`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:S.H`
      vec2 samplePos = vtc;
      `}

    ${r?S.H`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${N} ||
          fillPixelColor.a + outlinePixelColor.a < ${S.H.float(m.y)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${N}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:S.H`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${N}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?S.H`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(e.output){case o.V.Color:e.transparencyPassType===A.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),E.code.add(S.H`
        void main() {
          ${D}
          ${e.transparencyPassType===A.y.FrontFace?"fragColor.rgb /= fragColor.a;":""}
          ${e.transparencyPassType===A.y.ColorAlpha?"fragAlpha = fragColor.a;":""}
        }`);break;case o.V.ObjectAndLayerIdColor:E.code.add(S.H`
        void main() {
          ${D}
          outputObjectAndLayerIdColor();
        }`);break;case o.V.Highlight:E.constants.add("occludedHighlightFlag","vec4",p.U),E.constants.add("unoccludedHighlightFlag","vec4",p.bO),E.code.add(S.H`
        void main() {
          ${D}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return t}function R(e){return e.outlineColor[3]>0&&e.outlineSize>0}function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O;return e.textureIsSignedDistanceField?function(e,t,r){null!=t?(0,i.hZ)(r,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):(0,i.hZ)(r,0,0)}(e.anchorPosition,e.distanceFieldBoundingBox,t):(0,i.C)(t,e.anchorPosition),t}const O=(0,n.vt)(),I=Object.freeze(Object.defineProperty({__proto__:null,build:E,calculateAnchorPosForRendering:P},Symbol.toStringTag,{value:"Module"}))},61157:(e,t,r)=>{"use strict";r.d(t,{H:()=>f,b:()=>d});var i=r(43047),n=r(55855),s=r(95756),o=r(58350),a=r(64839),l=r(32307),c=r(70367),u=r(66470),h=r(21019);function d(){const e=new l.N5,{vertex:t,fragment:r}=e,n=t.code,d=r.code;return e.attributes.add(u.r.POSITION,"vec2"),e.varyings.add("uv","vec2"),e.attributes.add(u.r.UV0,"vec2"),t.uniforms.add(new c.N("coverageTex",(e=>e.coverageTexture)),new s.G("coverageRounding",(e=>e.coverageRounding))),n.add(a.H`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new c.N("tex",(e=>e.blurTexture)),new c.N("highlightTexture",(e=>e.highlightTexture)),new o.E("uColor",(e=>e.color)),new o.E("haloColor",(e=>e.haloColor)),new o.E("opacities",(e=>(0,i.s)(p,e.haloOpacity,e.haloOpacityOccluded,e.fillOpacity,e.fillOpacityOccluded)))),r.constants.add("inner","float",1-(h.o-h.b)/h.o),d.add(a.H`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),e}const p=(0,n.vt)(),f=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}))},43666:(e,t,r)=>{"use strict";r.d(t,{H:()=>h,a:()=>p,b:()=>d});var i=r(72745),n=r(56289),s=r(95756),o=r(64839),a=r(32307),l=r(27374),c=r(70367),u=r(66470);class h extends o.Y{constructor(){super(...arguments),this.blurSize=(0,i.vt)()}}function d(){const e=new a.N5,{attributes:t,varyings:r,vertex:i,fragment:h}=e;return t.add(u.r.POSITION,"vec2"),t.add(u.r.UV0,"vec2"),r.add("blurCoordinate","vec3"),i.uniforms.add(new c.N("coverageTex",(e=>e.coverageTexture)),new s.G("coverageRounding",(e=>e.coverageRounding))),i.code.add(o.H`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`),h.uniforms.add(new n.t("blurSize",(e=>e.blurSize)),new l.o("tex",(e=>e.blurInputTexture))),h.code.add(o.H`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),e}const p=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:h,build:d},Symbol.toStringTag,{value:"Module"}))},21019:(e,t,r)=>{"use strict";r.d(t,{H:()=>a,a:()=>d,b:()=>h,c:()=>l,g:()=>c,o:()=>u});var i=r(73398),n=r(64839),s=r(32307),o=r(27374);class a extends n.Y{}function l(){const e=new s.N5,{outputs:t,fragment:r}=e;return e.include(i.c),r.uniforms.add(new o.o("textureInput",(e=>e.input))),r.constants.add("sampleArea","int",Math.ceil(u/2)),t.add("fragGrid","vec2"),r.code.add(n.H`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${n.H.int(c)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -sampleArea; x < cellSize + sampleArea; x += 2) {
        for(int y = -sampleArea; y < cellSize + sampleArea; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`),e}const c=32,u=9,h=.4,d=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:a,blurSize:h,build:l,gridCellPixelSize:c,outlineSize:u},Symbol.toStringTag,{value:"Module"}))},40431:(e,t,r)=>{"use strict";r.d(t,{L:()=>w,b:()=>_});var i=r(19555),n=r(72745),s=r(55855),o=r(26917),a=r(98720),l=r(40318),c=r(62374),u=r(10708),h=r(69817),d=r(95756),p=r(58350),f=r(21390),m=r(64839),g=r(32307),y=r(66470);function _(e){const t=new g.N5,{vertex:r,fragment:n}=t;return r.include(a.K),t.include(l.Q,e),t.include(o.HQ,e),t.attributes.add(y.r.UV0,"vec2"),r.uniforms.add(new p.E("viewport",((e,t)=>t.camera.fullViewport)),new f.m("lineSize",((e,t)=>e.size>0?Math.max(1,e.size)*t.camera.pixelRatio:0)),new d.G("pixelToNDC",((e,t)=>(0,i.hZ)(b,2/t.camera.fullViewport[2],2/t.camera.fullViewport[3]))),new f.m("borderSize",((e,t)=>null!=e.borderColor?t.camera.pixelRatio:0)),new d.G("screenOffset",((e,t)=>(0,i.hZ)(b,e.horizontalScreenOffset*t.camera.pixelRatio,0)))),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.multipassEnabled&&t.varyings.add("depth","float"),e.occlusionTestEnabled&&t.include(c.y),e.hasScreenSizePerspective&&(0,h.OH)(r),r.code.add(m.H`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?m.H`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?m.H`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:m.H`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.multipassEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?m.H`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:m.H`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?m.H`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:m.H`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),n.uniforms.add(new p.E("uColor",(e=>v(e.color))),new p.E("borderColor",(e=>v(e.borderColor)))),e.multipassEnabled&&(n.include(u.H,e),n.uniforms.add(new d.G("inverseViewport",((e,t)=>t.inverseViewport)))),n.code.add(m.H`
    void main() {
      ${e.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?m.H`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:m.H`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function v(e){return null!=e?e:s.uY}const b=(0,n.vt)(),w=Object.freeze(Object.defineProperty({__proto__:null,build:_},Symbol.toStringTag,{value:"Module"}))},88849:(e,t,r)=>{"use strict";r.d(t,{L:()=>T,b:()=>S});var i=r(99443),n=r(34981),s=r(26917),o=r(3838),a=r(17698),l=r(81993),c=r(90235),u=r(80883),h=r(81449),d=r(3799),p=r(95756),f=r(58350),m=r(21390),g=r(64839),y=r(43425),_=r(32307),v=r(70367),b=r(10773),w=r(66470),x=r(50125);function S(e){const t=new _.N5,r=e.multipassEnabled&&e.output===n.V.Color,S=e.space===x.lM.World;t.include(o.s,e),t.include(a.r,e);const{vertex:T,fragment:M}=t;return M.include(h.W),(0,d.NB)(T,e),t.attributes.add(w.r.POSITION,"vec3"),t.attributes.add(w.r.PREVPOSITION,"vec3"),t.attributes.add(w.r.UV0,"vec2"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),r&&t.varyings.add("depth","float"),e.hasTip&&t.varyings.add("vLineWidth","float"),T.uniforms.add(new p.G("nearFar",((e,t)=>t.camera.nearFar)),new f.E("viewport",((e,t)=>t.camera.fullViewport))),T.code.add(g.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),T.code.add(g.H`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),S?(t.attributes.add(w.r.NORMAL,"vec3"),(0,d.S7)(T),T.constants.add("tiltThreshold","float",.7),T.code.add(g.H`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):T.code.add(g.H`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),T.code.add(g.H`
      #define vecN ${S?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${S?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${e.anchor===x.kJ.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),e.space===x.lM.Screen&&(T.uniforms.add(new y.X("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix))),T.code.add(g.H`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),T.code.add(g.H`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),T.uniforms.add(new m.m("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),T.code.add(g.H`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?"\n                if(prev.z > posLeft.z) {\n                  vec2 diff = posLeft.xy - posRight.xy;\n                  planeOrigin.xy += perpendicular(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),(0,d.Nz)(T),T.code.add(g.H`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position, 1.0);
vec4 prev = view * vec4(prevPosition, 1.0);
clip(pos, prev);`),S?(e.hideOnShortSegments&&T.code.add(g.H`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),T.code.add(g.H`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(T.code.add(g.H`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),e.space===x.lM.Screen&&T.code.add(g.H`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),T.code.add(g.H`
        ${r?"depth = pos.z;":""}

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${S?"":"vUV *= displacedPosScreen.w;"}

        ${e.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&t.include(l.Q,e),t.include(s.HQ,e),M.uniforms.add(new f.E("intrinsicColor",(e=>e.color)),new v.N("tex",(e=>e.markerTexture))),M.include(u.a),t.constants.add("texelSize","float",1/i.vO),M.code.add(g.H`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),e.hasTip&&(t.constants.add("relativeMarkerSize","float",i.Cz/i.vO),t.constants.add("relativeTipLineWidth","float",i.DZ),M.code.add(g.H`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${S?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.transparencyPassType===b.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),t.constants.add("symbolAlphaCutoff","float",c.y),M.code.add(g.H`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${S?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${e.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${e.output===n.V.ObjectAndLayerIdColor?g.H`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${e.output===n.V.Color?g.H`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===n.V.Color&&e.transparencyPassType===b.y.ColorAlpha?g.H`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${e.output===n.V.Highlight?g.H`fragColor = vec4(1.0);`:""}
  }
  `),t}const T=Object.freeze(Object.defineProperty({__proto__:null,build:S},Symbol.toStringTag,{value:"Module"}))},99129:(e,t,r)=>{"use strict";r.d(t,{M:()=>d,a:()=>y,b:()=>p});var i=r(76931),n=r(43047),s=r(55855),o=r(53736),a=r(58350),l=r(64839),c=r(32307),u=r(70367),h=r(66470);class d extends l.Y{constructor(){super(...arguments),this.mask=null,this.overlay=null,this.input=null,this.size=0}}function p(){const e=new c.N5;return e.attributes.add(h.r.POSITION,"vec2"),e.vertex.uniforms.add(new a.E("drawPosition",((e,t)=>function(e,t){const r=t.camera.pixelRatio,s=e.magnifier.offset.x*r,o=e.magnifier.offset.y*r;(0,i.WA)(e.magnifier.position,f);const a=t.camera.screenToRender(f,m),l=Math.ceil(r*e.magnifier.size),c=t.camera.fullWidth,u=t.camera.fullHeight;return(0,n.s)(g,(a[0]+s)/c*2-1,(a[1]-o)/u*2-1,l/c*2,l/u*2)}(e,t)))),e.varyings.add("vUV","vec2"),e.vertex.code.add(l.H`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add(new u.N("textureInput",(e=>e.input))),e.fragment.uniforms.add(new u.N("textureMask",(e=>e.mask))),e.fragment.uniforms.add(new u.N("textureOverlay",(e=>e.overlay))),e.fragment.uniforms.add(new o.e("maskEnabled",(e=>e.magnifier.maskEnabled))),e.fragment.uniforms.add(new o.e("overlayEnabled",(e=>e.magnifier.overlayEnabled))),e.fragment.code.add(l.H`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}const f=(0,i.gs)(),m=(0,i.QG)(),g=(0,s.vt)(),y=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:d,build:p},Symbol.toStringTag,{value:"Module"}))},34026:(e,t,r)=>{"use strict";r.d(t,{N:()=>g,b:()=>m});var i=r(34981),n=r(26917),s=r(59395),o=r(54478),a=r(48020),l=r(90235),c=r(3799),u=r(58350),h=r(21390),d=r(64839),p=r(32307),f=r(66470);function m(e){const t=new p.N5,{vertex:r,fragment:m}=t;return t.include(s.d,e),t.include(o.c,e),(0,c.NB)(r,e),t.attributes.add(f.r.POSITION,"vec3"),t.varyings.add("vpos","vec3"),r.code.add(d.H`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`),e.output===i.V.Highlight&&t.include(a.Qh,e),t.include(n.HQ,e),m.uniforms.add(new h.m("alphaCoverage",((e,t)=>Math.min(1,e.width*t.camera.pixelRatio)))),e.hasVertexColors||m.uniforms.add(new u.E("constantColor",(e=>e.color))),m.code.add(d.H`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    ${e.output===i.V.ObjectAndLayerIdColor?d.H`color.a = 1.0;`:""}

    if (color.a < ${d.H.float(l.y)}) {
      discard;
    }

    ${e.output===i.V.Color?d.H`fragColor = highlightSlice(color, vpos);`:""}
    ${e.output===i.V.Highlight?d.H`outputHighlight();`:""}
  }
  `),t}const g=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}))},80573:(e,t,r)=>{"use strict";r.d(t,{N:()=>u,a:()=>d,b:()=>h});var i=r(72745),n=r(39033),s=r(89426),o=r(73398),a=r(95756),l=r(64839),c=r(32307);class u extends l.Y{constructor(){super(...arguments),this.weatherTile=(0,i.fA)(0,0)}}function h(e){const t=new c.N5;if(t.include(o.c,!1),t.fragment.code.add(l.H`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),e.mode===n.L.Full){const e=2,r=8;t.fragment.code.add(l.H`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${l.H.float(s.ik)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${l.H.float(r)});

      float worley0 = worley(p, ${l.H.float(e)} * 2.0);
      float worley1 = worley(p, ${l.H.float(e)} * 8.0);
      float worley2 = worley(p, ${l.H.float(e)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${l.H.float(e)});
      float worley1 = worley(p, ${l.H.float(e)} * 2.0);
      float worley2 = worley(p, ${l.H.float(e)} * 4.0);
      float worley3 = worley(p, ${l.H.float(e)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `)}return t.fragment.uniforms.add(new a.G("weatherTile",(e=>e.weatherTile))),t.fragment.code.add(l.H`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${l.H.float(s.QG)});

      // Get global coordinates of p
      p += weatherTile * ${l.H.float(s.QG)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${l.H.float(s.M4)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.fragment.code.add(l.H`void main() {`),e.mode===n.L.Full&&t.fragment.code.add(l.H`
        float padWidth = 1.0;
        float paddedSize = ${l.H.float(s.CQ)} + 2.0 * padWidth;
        float tileCount = ${l.H.float(s.ik)} * ${l.H.float(s.ik)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${l.H.float(s.CQ)};
          }

          if (startPadY) {
            pixel.y += ${l.H.float(s.CQ)};
          }

          if (endPadX) {
            pixel.x -= ${l.H.float(s.CQ)};
          }

          if (endPadY) {
            pixel.y -= ${l.H.float(s.CQ)};
          }

          uv = vec2(pixel.xy / ${l.H.float(s.CQ)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${l.H.float(s.CQ)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${l.H.float(s.ik)} * ${l.H.float(s.ik)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${l.H.float(s.ik)} * ${l.H.float(s.ik)});
        p = p_;
        p.z /= (${l.H.float(s.ik)} * ${l.H.float(s.ik)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),t.fragment.code.add(l.H`
      vec2 mapUV = ${l.H.float(s.QG)} * (gl_FragCoord.xy / ${l.H.float(s.jj)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${e.mode===n.L.Full?l.H`fragColor.ba = vec2(0.0, map);`:l.H`fragColor = vec4(map);`};
    }
  `),t}const d=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:u,build:h},Symbol.toStringTag,{value:"Module"}))},16309:(e,t,r)=>{"use strict";r.d(t,{O:()=>a,a:()=>c,b:()=>l});var i=r(73398),n=r(64839),s=r(32307),o=r(70367);class a extends n.Y{}function l(){const e=new s.N5;return e.include(i.c),e.fragment.uniforms.add(new o.N("colorTexture",(e=>e.colorTexture)),new o.N("alphaTexture",(e=>e.alphaTexture)),new o.N("frontFaceTexture",(e=>e.frontFaceTexture))),e.fragment.code.add(n.H`void main() {
float srcAlpha = texture(alphaTexture, uv).r;
if(srcAlpha <= 1e-5){
discard;
}
vec4 srcColor = texture(colorTexture, uv);
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb / srcAlpha, frontFace.rgb, frontFace.a), 1.0 - srcColor.a);
}`),e}const c=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:a,build:l},Symbol.toStringTag,{value:"Module"}))},80381:(e,t,r)=>{"use strict";r.d(t,{O:()=>u,a:()=>d,b:()=>h});var i=r(19539),n=r(73398),s=r(21390),o=r(72790),a=r(64839),l=r(32307),c=r(70367);class u extends a.Y{constructor(){super(...arguments),this.overlayIndex=i.vr.INNER,this.opacity=1}}function h(){const e=new l.N5;return e.include(n.c),e.fragment.uniforms.add(new c.N("tex",(e=>e.texture))),e.fragment.uniforms.add(new o.c("overlayIdx",(e=>e.overlayIndex))),e.fragment.uniforms.add(new s.m("opacity",(e=>e.opacity))),e.fragment.code.add(a.H`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:u,build:h},Symbol.toStringTag,{value:"Module"}))},91116:(e,t,r)=>{"use strict";r.d(t,{P:()=>A,b:()=>M});var i=r(72412),n=r(34981),s=r(26917),o=r(59395),a=r(90080),l=r(85887),c=r(49399),u=r(48020),h=r(78264),d=r(67799),p=r(43557),f=r(81993),m=r(27920),g=r(2260),y=r(86279),_=r(80883),v=r(3799),b=r(5517),w=r(21390),x=r(64839),S=r(32307),T=r(10773);function M(e){const t=new S.N5,{vertex:r,fragment:M}=t;switch((0,v.NB)(r,e),t.varyings.add("vpos","vec3"),t.include(l.H,e),e.output!==n.V.Color&&e.output!==n.V.ObjectAndLayerIdColor||(t.include(o.d,e),t.include(y.Bz,e),t.include(i.oD,e),t.include(a.g,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.multipassEnabled&&t.varyings.add("depth","float"),r.code.add(x.H`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===n.V.Color?"forwardLinearDepth();":""}
        forwardObjectAndLayerIdColor();

        vcolor = getColor();
      }
    `)),t.include(f.Q,e),e.output){case n.V.Color:t.include(s.HQ,e),t.include(d.kA,e),t.include(h.n,e),t.include(y.Bz,e),t.include(m.r,e),(0,v.yu)(M,e),(0,d.a8)(M),(0,d.eU)(M),M.uniforms.add(r.uniforms.get("localOrigin"),new b.t("ambient",(e=>e.ambient)),new b.t("diffuse",(e=>e.diffuse)),new b.t("specular",(e=>e.specular)),new w.m("opacity",(e=>e.opacity))),M.include(_.a),e.transparencyPassType===T.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),(0,p.O4)(M),M.code.add(x.H`
        void main() {
          discardBySlice(vpos);
          ${e.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${e.transparencyPassType===T.y.ColorAlpha?x.H`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
        }
      `);break;case n.V.Depth:t.include(o.d,e),r.code.add(x.H`void main() {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(s.HQ,e),M.code.add(x.H`void main() {
discardBySlice(vpos);
}`);break;case n.V.Shadow:case n.V.ShadowHighlight:case n.V.ShadowExcludeHighlight:case n.V.ViewshedShadow:t.include(o.d,e),(0,i.xJ)(t),t.varyings.add("depth","float"),r.code.add(x.H`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(s.HQ,e),t.include(c.L,e),M.code.add(x.H`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case n.V.ObjectAndLayerIdColor:t.include(s.HQ,e),M.code.add(x.H`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`);break;case n.V.Normal:t.include(o.d,e),t.include(g.n,e),(0,v.S7)(r),t.varyings.add("vnormal","vec3"),r.code.add(x.H`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(s.HQ,e),M.code.add(x.H`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case n.V.Highlight:t.include(o.d,e),t.include(g.n,e),t.varyings.add("vnormal","vec3"),r.code.add(x.H`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(s.HQ,e),t.include(u.Qh,e),M.code.add(x.H`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return t}const A=Object.freeze(Object.defineProperty({__proto__:null,build:M},Symbol.toStringTag,{value:"Module"}))},58071:(e,t,r)=>{"use strict";r.d(t,{P:()=>M,b:()=>T});var i=r(34981),n=r(26917),s=r(59395),o=r(90080),a=r(54478),l=r(48020),c=r(81993),u=r(66763),h=r(90235),d=r(80883),p=r(3799),f=r(58350),m=r(21390),g=r(64839),y=r(32307),_=r(10773),v=r(66470),b=r(30250);const w=.70710678118,x=w,S=.08715574274;function T(e){const t=new y.N5,r=e.multipassEnabled&&e.output===i.V.Color,{vertex:T,fragment:M,attributes:A,varyings:C}=t;(0,p.NB)(T,e),t.include(s.d,e),t.include(a.c,e),t.include(u.A,e),t.include(o.g,e),e.draped?T.uniforms.add(new m.m("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):A.add(v.r.BOUNDINGRECT,"mat3"),A.add(v.r.POSITION,"vec3"),A.add(v.r.UVMAPSPACE,"vec4"),e.vvColor&&A.add(v.r.COLORFEATUREATTRIBUTE,"float"),C.add("vColor","vec4"),C.add("vpos","vec3"),C.add("vuv","vec2"),r&&C.add("depth","float"),T.uniforms.add(new f.E("uColor",(e=>e.color)));const E=e.style===b.O.ForwardDiagonal||e.style===b.O.BackwardDiagonal||e.style===b.O.DiagonalCross;return E&&T.code.add(g.H`
      const mat2 rotate45 = mat2(${g.H.float(w)}, ${g.H.float(-x)},
                                 ${g.H.float(x)}, ${g.H.float(w)});
    `),e.draped||((0,p.yu)(T,e),T.uniforms.add(new m.m("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),T.code.add(g.H`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),T.code.add(g.H`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),T.code.add(g.H`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${g.H.float(S)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),T.code.add(g.H`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${E?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${E?" * rotate45":""};

      ${e.draped?"":g.H`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${g.H.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),T.code.add(g.H`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${e.hasVertexColors?"vColor *= uColor;":e.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(n.HQ,e),M.include(d.a),e.draped&&M.uniforms.add(new m.m("texelSize",((e,t)=>1/t.camera.pixelRatio))),e.output===i.V.Highlight&&t.include(l.Qh,e),r&&t.include(c.Q,e),e.output!==i.V.Highlight&&(M.code.add(g.H`
      const float lineWidth = ${g.H.float(e.lineWidth)};
      const float spacing = ${g.H.float(e.patternSpacing)};
      const float spacingINV = ${g.H.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||M.code.add(g.H`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),e.transparencyPassType===_.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),M.code.add(g.H`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${e.output!==i.V.Highlight?g.H`color.a *= ${function(e){function t(t){return e.draped?g.H`coverage(vuv.${t}, texelSize)`:g.H`sampleAA(vuv.${t})`}switch(e.style){case b.O.ForwardDiagonal:case b.O.Horizontal:return t("y");case b.O.BackwardDiagonal:case b.O.Vertical:return t("x");case b.O.DiagonalCross:case b.O.Cross:return g.H`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}(e)};`:""}

      ${e.output===i.V.ObjectAndLayerIdColor?g.H`color.a = 1.0;`:""}

      if (color.a < ${g.H.float(h.y)}) {
        discard;
      }

      ${e.output===i.V.Color?g.H`fragColor = color; ${e.transparencyPassType===_.y.ColorAlpha?g.H`
                    fragColor = premultiplyAlpha(fragColor);
                    fragAlpha = fragColor.a;`:""}`:""}
      ${e.output===i.V.Highlight?g.H`outputHighlight();`:""}
      ${e.output===i.V.ObjectAndLayerIdColor?g.H`outputObjectAndLayerIdColor();`:""}
    }
  `),t}const M=Object.freeze(Object.defineProperty({__proto__:null,build:T},Symbol.toStringTag,{value:"Module"}))},28080:(e,t,r)=>{"use strict";r.d(t,{P:()=>_,b:()=>d});var i=r(20664),n=r(9392),s=r(90376),o=r(5517),a=r(21390),l=r(64839),c=r(43425),u=r(32307),h=r(66470);function d(e){const t=new u.N5;return t.attributes.add(h.r.POSITION,"vec3"),t.attributes.add(h.r.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new o.t("cameraPosition",((e,t)=>t.camera.eye))),t.vertex.uniforms.add(new o.t("offset",((e,t)=>function(e,t){const r=t.camera.eye,n=.5*e.width,s=1/e.width,o=(0,i.J)(p,(0,i.s)(p,(r[0]+n)*s,(r[1]+n)*s,(r[2]+n)*s));return(0,i.z)(o,r,(0,i.j)(o,o,e.width))}(e,t)))),t.vertex.uniforms.add(new a.m("width",(e=>e.width))),t.vertex.uniforms.add(new c.X("proj",((e,t)=>t.camera.projectionMatrix))),t.vertex.uniforms.add(new c.X("view",((e,t)=>t.camera.viewMatrix))),t.vertex.uniforms.add(new a.m("time",(e=>e.time))),t.varyings.add("vUv","vec2"),t.vertex.code.add(l.H`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===s.C.Rain?l.H`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:l.H`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add(new a.m("opacity",(e=>e.opacity)),new o.t("particleColor",((t,r)=>function(e,t){const r=t.type===s.C.Rain?g:m,n=(0,i.j)(p,r,y),o=e.camera.eye;(0,i.n)(f,o);const a=Math.max(0,(0,i.m)(f,e.lighting.mainLight.direction));return(0,i.o)(n,n,r,a)}(r,e)))),t.fragment.code.add(l.H`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===s.C.Rain?l.H`d = 0.35 * smoothstep(0.5, 0.0, d);`:l.H`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}const p=(0,n.vt)(),f=(0,n.vt)(),m=(0,n.fA)(1,1,1),g=(0,n.fA)(.85,.85,.85),y=.7,_=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}))},745:(e,t,r)=>{"use strict";r.d(t,{C:()=>_,R:()=>x,a:()=>v,b:()=>b,c:()=>w});var i=r(9392),n=r(72770),s=r(91156),o=r(67199),a=r(79360),l=r(25252),c=r(80883),u=r(53736),h=r(95756),d=r(21390),p=r(60205),f=r(72790),m=r(64839),g=r(32307),y=r(70367);class _ extends o.p{constructor(e,t,r,n,s,o){super(e,n,s),this.colormap=t,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=i.uY,this.fboTexture=null,this.baseOpacity=1}}class v extends _{}class b extends _{}function w(e){const t=new g.N5;return t.include(l.W),t.include(o.y,e),t.include(s.M,e),t.include(a.P,e),t.fragment.code.add(m.H`vec4 applyBackgroundBlend(vec4 layerColor) {
return blendLayers(vuv, layerColor, u_opacity);
}`),e.colorizerType===n.T.Stretch?function(e,t){e.fragment.uniforms.add(new f.c("u_bandCount",(e=>e.symbolizer.u_bandCount)),new p.x("u_minCutOff",(e=>e.symbolizer.u_minCutOff),3),new p.x("u_maxCutOff",(e=>e.symbolizer.u_maxCutOff),3),new p.x("u_factor",(e=>e.symbolizer.u_factor),3),new d.m("u_minOutput",(e=>e.symbolizer.u_minOutput)),new d.m("u_maxOutput",(e=>e.symbolizer.u_maxOutput)),new u.e("u_useGamma",(e=>e.symbolizer.u_useGamma)),new p.x("u_gamma",(e=>e.symbolizer.u_gamma),3),new p.x("u_gammaCorrection",(e=>e.symbolizer.u_gammaCorrection),3),new d.m("u_opacity",(e=>e.common.u_opacity))),e.fragment.code.add(m.H`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=t.applyColormap?m.H`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:m.H`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.code.add(m.H`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===n.M.Noop?m.H`
        fragColor = applyBackgroundBlend(currentPixel);`:m.H`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}(t,e):e.colorizerType===n.T.Lut?function(e){e.fragment.code.add(m.H`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}(t):e.colorizerType===n.T.Hillshade&&function(e,t){const r=e.fragment;r.uniforms.add(new y.N("u_image",(e=>e.u_image)),new f.c("u_hillshadeType",(e=>e.symbolizer.u_hillshadeType)),new p.x("u_sinZcosAs",(e=>e.symbolizer.u_sinZcosAs),6),new p.x("u_sinZsinAs",(e=>e.symbolizer.u_sinZsinAs),6),new p.x("u_cosZs",(e=>e.symbolizer.u_cosZs),6),new p.x("u_weights",(e=>e.symbolizer.u_weights),6),new h.G("u_factor",(e=>e.symbolizer.u_factor)),new d.m("u_minValue",(e=>e.symbolizer.u_minValue)),new d.m("u_maxValue",(e=>e.symbolizer.u_maxValue)),new h.G("u_srcImageSize",(e=>e.common.u_srcImageSize))),r.include(c.a),r.code.add(m.H`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(m.H`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=t.applyColormap?m.H`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:m.H`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(m.H`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}(t,e),t}const x=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:b,ColorizerStretchUniforms:v,ColorizerUniforms:_,build:w},Symbol.toStringTag,{value:"Module"}))},35249:(e,t,r)=>{"use strict";r.d(t,{R:()=>k,b:()=>F});var i=r(72412),n=r(62026),s=r(34981),o=r(26917),a=r(59395),l=r(45937),c=r(59046),u=r(838),h=r(22148),d=r(97808),p=r(54478),f=r(25530),m=r(15710),g=r(78264),y=r(67799),_=r(43557),v=r(81993),b=r(42953),w=r(26719),x=r(86279),S=r(66763),T=r(90235),M=r(55806),A=r(77904),C=r(3799),E=r(5517),R=r(58350),P=r(21390),O=r(64839),I=r(32307),L=r(70367),N=r(10773),D=r(66470);function F(e){const t=new I.N5,{vertex:r,fragment:F,varyings:k}=t;return(0,C.NB)(r,e),t.include(u.I),k.add("vpos","vec3"),t.include(S.A,e),t.include(l.BK,e),t.include(f.G,e),e.output===s.V.Color&&((0,C.yu)(t.vertex,e),t.include(c.Y,e),t.include(a.d,e),e.offsetBackfaces&&t.include(n.M),e.instancedColor&&t.attributes.add(D.r.INSTANCECOLOR,"vec4"),k.add("vNormalWorld","vec3"),k.add("localvpos","vec3"),e.multipassEnabled&&k.add("depth","float"),t.include(d.U,e),t.include(i.oD,e),t.include(h.K,e),t.include(p.c,e),r.uniforms.add(new R.E("externalColor",(e=>e.externalColor))),k.add("vcolorExt","vec4"),r.code.add(O.H`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${O.H.float(T.y)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.multipassEnabled?O.H`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===s.V.Color&&(t.include(o.HQ,e),t.include(y.kA,e),t.include(g.n,e),t.include(M.S,e),t.include(e.instancedDoublePrecision?x.G:x.Bz,e),t.include(v.Q,e),(0,C.yu)(t.fragment,e),(0,_.Gc)(F),(0,y.a8)(F),(0,y.eU)(F),F.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new E.t("ambient",(e=>e.ambient)),new E.t("diffuse",(e=>e.diffuse)),new P.m("opacity",(e=>e.opacity)),new P.m("layerOpacity",(e=>e.layerOpacity))),e.hasColorTexture&&F.uniforms.add(new L.N("tex",(e=>e.texture))),t.include(w._Z,e),t.include(b.c,e),F.include(A.N),e.transparencyPassType===N.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),(0,_.O4)(F),F.code.add(O.H`
      void main() {
        discardBySlice(vpos);
        ${e.multipassEnabled?O.H`terrainDepthTest(depth);`:""}
        ${e.hasColorTexture?O.H`
                vec4 texColor = texture(tex, ${e.hasColorTextureTransform?O.H`colorUV`:O.H`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:O.H`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===w.A9.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?O.H`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:O.H`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?O.H`albedo = mix(albedo, vec3(1), 0.9);`:O.H``}
        ${O.H`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${e.pbrMode===w.A9.Normal||e.pbrMode===w.A9.Schematic?e.spherical?O.H`vec3 normalGround = normalize(vpos + localOrigin);`:O.H`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:O.H``}
        ${e.pbrMode===w.A9.Normal||e.pbrMode===w.A9.Schematic?O.H`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${e.snowCover?O.H`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:O.H`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===N.y.ColorAlpha?O.H`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `)),t.include(m.E,e),t}const k=Object.freeze(Object.defineProperty({__proto__:null,build:F},Symbol.toStringTag,{value:"Module"}))},14623:(e,t,r)=>{"use strict";r.d(t,{R:()=>A,b:()=>M,r:()=>T});var i=r(34981),n=r(26917),s=r(90080),o=r(3838),a=r(2443),l=r(17698),c=r(81993),u=r(36324),h=r(90235),d=r(80883),p=r(3799),f=r(95756),m=r(58350),g=r(21390),y=r(64839),_=r(43425),v=r(32307),b=r(10773),w=r(66470),x=r(50125),S=r(46259);const T=1;function M(e){const t=new v.N5,{attributes:r,varyings:M,constants:A,vertex:C,fragment:E}=t;t.include(u.p),t.include(o.s,e),t.include(a.q,e);const R=e.applyMarkerOffset&&!e.draped;R&&(C.uniforms.add(new g.m("markerScale",(e=>e.markerScale))),t.include(l.r,{space:x.lM.World,draped:!1})),t.include(s.g,e),(0,p.NB)(C,e),C.uniforms.add(new _.X("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new f.G("nearFar",((e,t)=>t.camera.nearFar)),new g.m("miterLimit",(e=>"miter"!==e.join?0:e.miterLimit)),new m.E("viewport",((e,t)=>t.camera.fullViewport))),C.constants.add("LARGE_HALF_FLOAT","float",65500),r.add(w.r.POSITION,"vec3"),r.add(w.r.PREVPOSITION,"vec3"),r.add(w.r.NEXTPOSITION,"vec3"),r.add(w.r.SUBDIVISIONFACTOR,"float"),r.add(w.r.UV0,"vec2"),M.add("vColor","vec4"),M.add("vpos","vec3"),M.add("vLineDistance","float"),M.add("vLineWidth","float");const P=e.multipassEnabled&&e.output===i.V.Color;P&&M.add("depth","float");const O=e.stippleEnabled;O&&M.add("vLineSizeInv","float"),A.add("aaWidth","float",e.stippleEnabled?0:1);const I=e.capType===S.x.ROUND,L=e.stippleEnabled&&I,N=e.falloffEnabled||L;N&&M.add("vLineDistanceNorm","float"),I&&(M.add("vSegmentSDF","float"),M.add("vReverseSegmentSDF","float")),C.code.add(y.H`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),C.code.add(y.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),C.code.add(y.H`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${P?"depth = pos.z;":""}

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),(0,p.Nz)(C),C.code.add(y.H`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${O?y.H`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),R&&C.code.add(y.H`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),C.code.add(y.H`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(e.stippleEnabled||I)&&C.code.add(y.H`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${I?y.H`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),C.code.add(y.H`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?C.code.add(y.H`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?y.H`min(1.0, subdivisionFactor * ${y.H.float((T+2)/(T+1))})`:y.H`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):C.code.add(y.H`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const D=e.capType!==S.x.BUTT;return C.code.add(y.H`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${D?y.H`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),C.code.add(y.H`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${N?y.H`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),I&&C.code.add(y.H`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?C.uniforms.add(new g.m("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):C.code.add(y.H`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),C.code.add(y.H`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?C.code.add(y.H`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):C.code.add(y.H`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),C.uniforms.add(new g.m("stipplePatternPixelSize",(e=>(0,a.h)(e)))),C.code.add(y.H`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),C.code.add(y.H`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),P&&t.include(c.Q,e),t.include(n.HQ,e),E.include(d.a),E.code.add(y.H`
  void main() {
    discardBySlice(vpos);
    ${P?"terrainDepthTest(depth);":""}
  `),e.wireframe?E.code.add(y.H`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(I&&E.code.add(y.H`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${y.H.float(h.y)}) {
          discard;
        }
      `),L?E.code.add(y.H`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${y.H.float(h.y)}, stippleCoverage);
      `):E.code.add(y.H`float stippleAlpha = getStippleAlpha();`),e.output!==i.V.ObjectAndLayerIdColor&&E.code.add(y.H`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),E.uniforms.add(new m.E("intrinsicColor",(e=>e.color))),E.code.add(y.H`vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(E.uniforms.add(new m.E("innerColor",(e=>e.innerColor??e.color)),new g.m("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio))),E.code.add(y.H`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),E.code.add(y.H`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(E.uniforms.add(new g.m("falloff",(e=>e.falloff))),E.code.add(y.H`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),e.stippleEnabled||E.code.add(y.H`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),e.transparencyPassType===b.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),E.code.add(y.H`
    ${e.output===i.V.ObjectAndLayerIdColor?y.H`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${y.H.float(h.y)}) {
      discard;
    }

    ${e.output===i.V.Color?y.H`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===i.V.Color&&e.transparencyPassType===b.y.ColorAlpha?y.H`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${e.output===i.V.Highlight?y.H`fragColor = vec4(1.0);`:""}
    ${e.output===i.V.ObjectAndLayerIdColor?y.H`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const A=Object.freeze(Object.defineProperty({__proto__:null,build:M,ribbonlineNumRoundJoinSubdivisions:T},Symbol.toStringTag,{value:"Module"}))},51331:(e,t,r)=>{"use strict";r.d(t,{S:()=>y,b:()=>f,g:()=>m});var i=r(19555),n=r(72745),s=r(73398),o=r(65058),a=r(27963),l=r(95756),c=r(21390),u=r(64839),h=r(32307),d=r(70367);const p=16;function f(){const e=new h.N5,t=e.fragment;return e.include(s.c),e.include(a.Ir),t.include(o.E),t.uniforms.add(new c.m("radius",((e,t)=>m(t.camera)))).code.add(u.H`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),t.code.add(u.H`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.uniforms.add(new d.N("normalMap",(e=>e.normalTexture)),new d.N("depthMap",(e=>e.depthTexture)),new c.m("projScale",(e=>e.projScale)),new d.N("rnm",(e=>e.noiseTexture)),new l.G("rnmScale",((e,t)=>(0,i.hZ)(g,t.camera.fullWidth/e.noiseTexture.descriptor.width,t.camera.fullHeight/e.noiseTexture.descriptor.height))),new c.m("intensity",(e=>e.intensity)),new l.G("screenSize",((e,t)=>(0,i.hZ)(g,t.camera.fullWidth,t.camera.fullHeight)))),e.outputs.add("fragOcclusion","float"),t.code.add(u.H`
    void main(void) {
      float depth = depthFromTexture(depthMap, uv);

      // Early out if depth is out of range, such as in the sky
      if (depth >= 1.0 || depth <= 0.0) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      float currentPixelDepth = linearizeDepth(depth);
      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${u.H.int(p)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${u.H.int(p)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `),e}function m(e){return Math.max(10,20*e.computeScreenPixelSizeAtDist(Math.abs(4*e.relativeElevation)))}const g=(0,n.vt)(),y=Object.freeze(Object.defineProperty({__proto__:null,build:f,getRadius:m},Symbol.toStringTag,{value:"Module"}))},29228:(e,t,r)=>{"use strict";r.d(t,{S:()=>f,b:()=>p});var i=r(20664),n=r(73398),s=r(65058),o=r(56289),a=r(21390),l=r(64839),c=r(32307),u=r(27374),h=r(70367);const d=4;function p(){const e=new c.N5,t=e.fragment;e.include(n.c);const r=(d+1)/2,p=1/(2*r*r);return t.include(s.E),t.uniforms.add(new h.N("depthMap",(e=>e.depthTexture)),new u.o("tex",(e=>e.colorTexture)),new o.t("blurSize",(e=>e.blurSize)),new a.m("projScale",((e,t)=>{const r=(0,i.p)(t.camera.eye,t.camera.center);return r>5e4?Math.max(0,e.projScale-(r-5e4)):e.projScale}))),t.code.add(l.H`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${l.H.float(p)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.outputs.add("fragBlur","float"),t.code.add(l.H`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${l.H.int(d)}; r <= ${l.H.int(d)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `),e}const f=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}))},59922:(e,t,r)=>{"use strict";r.d(t,{S:()=>f,a:()=>_,b:()=>g});var i=r(34761),n=r(13191),s=r(73398),o=r(65058),a=r(86279),l=r(27963),c=r(81449),u=r(64839),h=r(43425),d=r(32307),p=r(70367);const f=255,m=1/f;function g(e){const t=new d.N5,r=t.fragment;return r.include(c.W),r.include(o.E),t.include(l.Ir),t.include(s.c),t.include(a.G,e),r.uniforms.add(new p.N("shadowMap",((e,t)=>t.shadowMap.depthTexture)),new p.N("depthMap",((e,t)=>t.depth?.attachment)),new h.X("inverseViewMatrix",((e,t)=>(0,i.B8)(y,(0,i.Tl)(y,t.camera.viewMatrix,t.camera.center))))),r.constants.add("sampleValue","float",m),t.outputs.add("sampleCount","float"),r.code.add(u.H`void main(void) {
float depth = depthFromTexture(depthMap, uv);
if (depth >= 1.0 || depth <= 0.0) {
discard;
}
float currentPixelDepth = linearizeDepth(depth);
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`),t}const y=(0,n.vt)(),_=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:f,build:g},Symbol.toStringTag,{value:"Module"}))},99604:(e,t,r)=>{"use strict";r.d(t,{S:()=>m,a:()=>_,b:()=>y});var i=r(55855),n=r(73398),s=r(65058),o=r(27963),a=r(81449),l=r(58350),c=r(21390),u=r(64839),h=r(32307),d=r(70367),p=r(59922),f=r(50578);class m extends u.Y{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=(0,i.o8)(g),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}}const g=(0,i.fA)(.01,0,.25,1);function y(e){const t=new h.N5,r=t.fragment;r.include(a.W),r.include(s.D),t.include(o.Ir),t.include(n.c);const{visualization:i,bandsEnabled:m}=e;r.constants.add("inverseSampleValue","float",p.S),r.uniforms.add(new d.N("shadowCastMap",(e=>e.shadowCastMap)),new c.m("sampleScale",(e=>e.sampleScale)),new c.m("opacityFromElevation",(e=>e.opacityFromElevation)),new l.E("uColor",(e=>e.color)));const g=i===f.o.Gradient,y=i===f.o.Threshold;return g&&m?r.uniforms.add(new c.m("bandSize",(e=>e.bandSize))):y&&r.uniforms.add(new c.m("threshold",(e=>e.threshold))),r.code.add(u.H`
    void main(void) {
      float record = texture(shadowCastMap, uv).r;
      float pixelSamples = record * inverseSampleValue;
      if (pixelSamples < 1.0) {
        discard;
      }

      float strength = pixelSamples * sampleScale;

      ${y?u.H`
          if (strength <= threshold) {
            discard;
          }`:""}

      ${g&&m?u.H`strength = ceil(strength / bandSize) * bandSize;`:""}

      fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${g?u.H`* strength`:""});
    }
  `),t}const _=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:m,build:y},Symbol.toStringTag,{value:"Module"}))},97157:(e,t,r)=>{"use strict";r.d(t,{S:()=>M,b:()=>x});var i=r(34761),n=r(13191),s=r(20664),o=r(9392),a=r(62423),l=r(73398),c=r(48020),u=r(86279),h=r(81449),d=r(5517),p=r(58350),f=r(21390),m=r(64839),g=r(43425),y=r(32307),_=r(70367),v=r(90877);const b=.99999,w=.025;function x(e){const t=new y.N5;t.include(u.G,e),t.include(l.c),t.include(a.r);const r=t.fragment;return r.include(h.W),r.uniforms.add(new _.N("defaultDepthTex",((e,t)=>t.shadowMap.getSnapshot(v.z.ExcludeHighlight))),new _.N("highlightDepthTex",((e,t)=>t.shadowMap.getSnapshot(v.z.Highlight))),new _.N("depthMap",((e,t)=>t.depth?.attachment)),new _.N("highlightTexture",(e=>e.highlight)),new p.E("uColor",(e=>e.shadowColor)),new f.m("opacity",(e=>e.shadowOpacity)),new f.m("occludedOpacity",(e=>e.occludedShadowOpacity)),new f.m("terminationFactor",(e=>e.opacityElevation*e.dayNightTerminator)),new d.t("lightingMainDirectionView",((e,t)=>(0,s.n)(T,(0,s.h)(T,t.lighting.mainLight.direction,t.camera.viewInverseTransposeMatrix)))),new g.X("inverseViewMatrix",((e,t)=>(0,i.B8)(S,(0,i.Tl)(S,t.camera.viewMatrix,t.camera.center))))),r.constants.add("unoccludedHighlightFlag","vec4",c.bO),r.code.add(m.H`
    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${m.H.float(b)}) {
        discard;
      }

      float depth = depthFromTexture(depthMap, uv);

      // 1.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth >= 1.0 || depth <= 0.0) {
        discard;
      }

      float currentPixelDepth = linearizeDepth(depth);
      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);
      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;
      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(depthMap, currentPixelPos.xyz, gl_FragCoord.xy, uv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${m.H.float(w)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `),t}const S=(0,n.vt)(),T=(0,o.vt)(),M=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}))},76955:(e,t,r)=>{"use strict";r.d(t,{S:()=>g,a:()=>v,b:()=>y,c:()=>_});var i=r(72745),n=r(9392),s=r(99650),o=r(59395),a=r(43557),l=r(95756),c=r(5517),u=r(21390),h=r(64839),d=r(43425),p=r(32307),f=r(70367),m=r(66470);class g extends h.Y{constructor(){super(...arguments),this.texV=(0,i.vt)(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new y}}class y{constructor(){this.center=(0,n.vt)(),this.v1=(0,n.vt)(),this.v2=(0,n.vt)()}}function _(e){const t=new p.N5,{vertex:r,fragment:i}=t;if((0,a.Gc)(r),e.geometry===s.d.Underground)t.attributes.add(m.r.POSITION,"vec2"),t.varyings.add("color","vec4"),r.uniforms.add(new c.t("cameraPosition",((e,t)=>t.camera.eye)),new u.m("undergroundFadeAlpha",(e=>e.undergroundFadeAlpha))),r.code.add(h.H`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(h.H`void main() {
fragColor = color;
}`);else{t.include(o.d,e),t.attributes.add(m.r.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const n=e.geometry===s.d.Cylinder;r.uniforms.add(new d.X("proj",((e,t)=>t.camera.projectionMatrix)),new d.X("view",((e,t)=>t.camera.viewMatrix))),n||(t.varyings.add("innerFactor","float"),r.uniforms.add(new c.t("silCircleCenter",(e=>e.silhouette.center))),r.uniforms.add(new c.t("silCircleV1",(e=>e.silhouette.v1))),r.uniforms.add(new c.t("silCircleV2",(e=>e.silhouette.v2))),r.uniforms.add(new l.G("texV",(e=>e.texV))),r.uniforms.add(new u.m("innerScale",(e=>e.innerScale))));const a=6.2831853,p=1/128;r.code.add(h.H`
		void main(void) {
      ${n?h.H`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:h.H`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${h.H.float(a*p)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${h.H.float(p)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new f.N("tex",(e=>e.texture))),n||i.uniforms.add(new u.m("altitudeFade",(e=>e.altitudeFade))),i.code.add(h.H`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${n?h.H`fragColor = atmosphereColor;`:h.H`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const v=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:y,SimpleAtmospherePassParameters:g,build:_},Symbol.toStringTag,{value:"Module"}))},21594:(e,t,r)=>{"use strict";r.d(t,{S:()=>p,b:()=>h});var i=r(34761),n=r(13191),s=r(58350),o=r(21390),a=r(64839),l=r(43425),c=r(32307),u=r(66470);function h(){const e=new c.N5;return e.attributes.add(u.r.POSITION,"vec3"),e.attributes.add(u.r.COLOR,"vec4"),e.attributes.add(u.r.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add(new l.X("transform",((e,t)=>function(e,t){const r=24e-8;return(0,i.C)(d,t.camera.projectionMatrix),d[10]=r-1,d[11]=-1,d[14]=(r-2)*t.camera.near,(0,i.lw)(d,d,t.camera.viewMatrix),(0,i.lw)(d,d,e.modelMatrix)}(e,t))),new s.E("viewport",((e,t)=>t.camera.fullViewport)),new o.m("pixelRatio",((e,t)=>t.camera.pixelRatio))),e.vertex.code.add(a.H`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(a.H`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),e}const d=(0,n.vt)(),p=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}))},43074:(e,t,r)=>{"use strict";r.d(t,{T:()=>I,a:()=>F,b:()=>L});var i=r(34761),n=r(13191),s=r(20664),o=r(9392),a=r(29898),l=r(72412),c=r(34981),u=r(26917),h=r(59395),d=r(59046),p=r(838),f=r(97808),m=r(112),g=r(49399),y=r(48020),_=r(78264),v=r(67799),b=r(43557),w=r(2260),x=r(26719),S=r(86279),T=r(12057),M=r(14209),A=r(3799),C=r(5517),E=r(64839),R=r(12216),P=r(32307),O=r(70367);class I extends M.Rq{}function L(e){const t=new P.N5,{vertex:r,fragment:n,varyings:o}=t;t.include(p.I),t.include(d.Y,e),t.include(f.U,e);const I=()=>{t.include(w.n,e),r.code.add(E.H`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};(0,A.NB)(r,e),t.include(h.d,e);const L=e.overlayMode!==T.w9.Disabled,F=L&&e.invisible;switch(e.output){case c.V.Color:{t.include(M.BK,e),t.include(v.kA,e),L&&t.include(T.eO,{...e,pbrMode:e.pbrMode===x.A9.Simplified?x.A9.TerrainWithWater:x.A9.Water});const c=e.overlayMode===T.w9.EnabledWithWater;c&&t.include(m.O,e),o.add("vnormal","vec3"),o.add("vpos","vec3"),o.add("vup","vec3"),I(),e.screenSizePerspective&&(0,A.S7)(r);const h=e.receiveShadows&&!e.renderOccluded;h&&t.include(l.oD,e),e.screenSizePerspective&&(o.add("screenSizeDistanceToCamera","float"),o.add("screenSizeCosAngle","float")),r.code.add(E.H`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${c?E.H`forwardVertexTangent(vnormal);`:E.H``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${L?E.H`setOverlayVTC(uv);`:""}
          ${e.tileBorders?E.H`forwardTextureCoordinates();`:""}

          ${e.screenSizePerspective?E.H`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${h?E.H`forwardLinearDepth();`:""}

        }
      `),t.include(u.HQ,e),t.include(v.kA,e),t.include(_.n,e),t.include(S.Bz,e),(0,A.yu)(n,e),(0,v.a8)(n),(0,v.eU)(n),n.uniforms.add(r.uniforms.get("localOrigin"),new C.t("viewDirection",((e,t)=>(0,s.n)(D,(0,s.s)(D,t.camera.viewMatrix[12],t.camera.viewMatrix[13],t.camera.viewMatrix[14]))))),c&&n.uniforms.add(new O.N("ovWaterTex",((e,t)=>t.overlay?.getTexture(a.A.WaterNormal))),new R.S("view",((e,t)=>(0,i.Tl)(N,t.camera.viewMatrix,e.origin)))),n.code.add(E.H`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),(0,b.Gc)(n),(0,b.O4)(n),n.code.add(E.H`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${e.receiveShadows&&!e.renderOccluded?"readShadowMap(vpos, linearDepth)":e.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${L?E.H`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${e.invisible?E.H`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${e.pbrMode===x.A9.Simplified||e.pbrMode===x.A9.TerrainWithWater?E.H`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:E.H`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${c?E.H`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${e.screenSizePerspective?E.H`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${e.visualizeNormals?e.spherical?E.H`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:E.H`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${e.tileBorders?E.H`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case c.V.Depth:F&&t.include(T.eO,e),r.code.add(E.H`
              void main(void) {
                ${F?E.H`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPosition(proj, view, position);
              }
          `),n.code.add(E.H`
              void main() {
                ${F?E.H`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              }
          `);break;case c.V.Shadow:case c.V.ShadowHighlight:case c.V.ShadowExcludeHighlight:case c.V.ViewshedShadow:t.include(g.L,e),(0,l.Mu)(t),(0,l.xJ)(t),r.code.add(E.H`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),n.code.add(E.H`void main() {
outputDepth(linearDepth);
}`);break;case c.V.Normal:F&&t.include(T.eO,e),o.add("vnormal","vec3"),(0,A.S7)(r),I(),r.code.add(E.H`
        void main(void) {
          ${F?E.H`setOverlayVTC(getUV0());`:""}
          gl_Position = transformPosition(proj, view, position);
          vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
        }
      `),n.code.add(E.H`
        void main() {
          ${F?E.H`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) {
            normal = -normal;
          }
          fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
        }
      `);break;case c.V.Highlight:L&&t.include(T.eO,e),r.code.add(E.H`
          void main() {
            ${L?E.H`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),t.include(y.Qh,e),n.code.add(E.H`
          void main() {
            ${L?E.H`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return e.output===c.V.ObjectAndLayerIdColor&&(L?(t.include(T.eO,{...e,pbrMode:x.A9.Disabled}),r.code.add(E.H`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),n.code.add(E.H`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(r.code.add(E.H`void main(void) {
        ${e.opaque?E.H` gl_Position = transformPosition(proj, view, position);`:""}
      }`),n.code.add(E.H`void main() {
fragColor = vec4(0.0);
}`))),t}const N=(0,n.vt)(),D=(0,o.vt)(),F=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:I,build:L},Symbol.toStringTag,{value:"Module"}))},53070:(e,t,r)=>{"use strict";r.d(t,{T:()=>c,a:()=>h,b:()=>u});var i=r(9392),n=r(73398),s=r(5517),o=r(64839),a=r(32307),l=r(70367);class c extends o.Y{constructor(){super(...arguments),this.color=(0,i.fA)(1,1,1)}}function u(){const e=new a.N5;return e.include(n.c),e.fragment.uniforms.add(new l.N("tex",(e=>e.texture)),new s.t("uColor",(e=>e.color))),e.fragment.code.add(o.H`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);
}`),e}const h=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},27456:(e,t,r)=>{"use strict";r.d(t,{V:()=>b,a:()=>S,b:()=>w});var i=r(34761),n=r(13191),s=r(62423),o=r(73398),a=r(65058),l=r(30041),c=r(87572),u=r(23976),h=r(95756),d=r(5517),p=r(60205),f=r(72790),m=r(64839),g=r(43425),y=r(44640),_=r(32307),v=r(70367);class b extends l.${constructor(){super(...arguments),this.targetVector=[1,0,0],this.upVector=[0,0,1],this.fovs=[45,45],this.headingAndTilt=[0,0],this.shadowMap={depthTexture:null,nearFar:[1,100],numActiveFaces:1,atlasRegions:[[0,0,1,1]]},this.projectionMatrices=n.zK.flat(),this.viewMatrices=n.zK.flat()}}function w(e){const t=new _.N5,r=t.fragment;t.include(o.c),t.include(l.K),t.include(u.r),r.include(a.E),r.include(c.U),r.uniforms.add(new v.N("depthTexture",((e,t)=>t.depth?.attachment))),r.uniforms.add(new g.X("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new g.X("inverseViewNormalMatrix",((e,t)=>(0,i.Qw)(x,t.camera.viewInverseTransposeMatrix)))),r.uniforms.add(new d.t("viewshedTargetVector",((e,t)=>e.targetVector)),new d.t("viewshedUpVector",((e,t)=>e.upVector)),new h.G("viewshedFOVs",((e,t)=>e.fovs)),new h.G("viewshedHeadingAndTilt",((e,t)=>e.headingAndTilt)),new h.G("viewshedNearFar",((e,t)=>e.shadowMap.nearFar??[1,100]))),r.uniforms.add(new v.N("viewshedShadowMap",(e=>e.shadowMap.depthTexture)),new y.m("viewshedProjectionMatrices",((e,t)=>e.projectionMatrices),6),new y.m("viewshedViewMatrices",((e,t)=>e.viewMatrices),6),new f.c("viewshedNumFaces",((e,t)=>e.shadowMap.numActiveFaces)),new p.x("viewshedAtlasRegions",((e,t)=>e.shadowMap.atlasRegions.flat()),24)),r.constants.add("visibleColor","vec4",[0,1,0,.5]),r.constants.add("occludedColor","vec4",[1,0,0,.5]);const n=e.useNormalMap;return n?(r.uniforms.add(new v.N("normalMap",((e,t)=>e.normalTexture))),r.code.add(m.H`vec3 normalFromTexture() {
vec4 norm4 = texture(normalMap, uv);
vec3 nNormal = vec3(-1.0) + 2.0 * norm4.xyz;
return normalize((inverseViewNormalMatrix * vec4(nNormal, 1.0)).xyz);
}`)):t.include(s.r),r.code.add(m.H`
    // UV coordinates of point projected onto viewshed shadow map
    vec2 getViewshedUv(vec4 worldPosition, int face) {
      mat4 viewshedMatrix = viewshedProjectionMatrices[face];
      vec4 viewshedUv4 = viewshedMatrix * worldPosition;
      vec3 viewshedUv = viewshedUv4.xyz / viewshedUv4.w;
      return viewshedUv.xy;
    }

    float viewshedDepthToFloat(float depth) {
      return (depth - viewshedNearFar[0]) / (viewshedNearFar[1] - viewshedNearFar[0]);
    }

    // Orthographic depth to viewshed of given point and given cube map face in range [0, 1].
    float getOrthographicDepthToViewshed(vec4 worldPosition, int face) {
      mat4 viewshedViewMatrix = viewshedViewMatrices[face];
      vec4 viewshedUv4 = viewshedViewMatrix * worldPosition;
      vec3 viewshedUv = viewshedUv4.xyz / viewshedUv4.w;
      float depth = -viewshedUv.z;
      return viewshedDepthToFloat(depth);
    }

    // Read depth from shadow map given uv and cube map face
    float getDepthFromShadowMap(vec2 uv, int face) {
      int index = 4 * face;

      float umin = viewshedAtlasRegions[index];
      float umax = viewshedAtlasRegions[index + 1];
      float vmin = viewshedAtlasRegions[index + 2];
      float vmax = viewshedAtlasRegions[index + 3];

      vec4 atlasRegion = vec4(umin, vmin, umax, vmax);
      return rgba4ToFloat(textureAtlasLookup(viewshedShadowMap, uv, atlasRegion));
    }

    struct ViewshedPoint {
      int face;
      vec2 uv;
      bool isWithin;
      float orthographicDepth;
    };

    // Find cube map face the given position lies in and return relevant information about it
    bool getViewshedPoint(vec4 worldPosition, out ViewshedPoint point) {
      vec3 nUp = normalize(viewshedUpVector);

      // Try with all active cube map faces
      for(int i=0; i < viewshedNumFaces; i++) {

        // Check if when projected, point lies within shadow map texture
        vec2 viewshedUv = getViewshedUv(worldPosition, i);
        if (viewshedUv.x > 0.0 && viewshedUv.x < 1.0 && viewshedUv.y > 0.0 && viewshedUv.y < 1.0) {
          float orthoDepth = getOrthographicDepthToViewshed(worldPosition, i);
          if (orthoDepth >= 0.0) { // found a cube map face

            // Check whether point is really inside viewshed geometry, not just within the camera frustum

            // outside farDistance
            vec3 position = worldPosition.xyz;
            bool isWithin = length(position) <= viewshedNearFar[1];

            // horizontally outside fov
            float t = dot(nUp, position);
            bool isBottomHalf = t > 0.0;
            vec3 nProjVector = normalize(position - t * nUp);
            if (isWithin) {
              float angle = acos(dot(normalize(viewshedTargetVector), nProjVector));
              if (angle > viewshedFOVs[0] / 2.0) {
                isWithin = false;
              }
            }

            // vertically outside fov
            if (isWithin) {
              float angle = acos(dot(nProjVector, normalize(position)));
              if (!isBottomHalf) {
                angle = -angle;
              }
              float tilt = viewshedHeadingAndTilt[1];
              float limit = viewshedFOVs[1] / 2.0;
              if (angle > limit || angle < -limit) {
                isWithin = false;
              }
            }

            point = ViewshedPoint(i, viewshedUv, isWithin, orthoDepth);
            return true;
          }
        }
      }

      // no cube face matches
      return false;
    }

    float normalCosAngle(float linearDepth, vec3 localPosition) {
      ${n?m.H`vec3 normal = normalFromTexture();`:m.H`
        vec3 cameraSpacePosition = reconstructPosition(gl_FragCoord.xy, linearDepth);
        vec3 normal = normalFromDepth(depthTexture, cameraSpacePosition, gl_FragCoord.xy, uv);
        normal = (inverseViewNormalMatrix * vec4(normal, 1.0)).xyz;
        `};

      vec3 viewingDir = normalize(localPosition);
      return dot(normal, viewingDir);
    }

    void main() {
      float depth = depthFromTexture(depthTexture, uv);

      // Outside camera planes
      if (depth >= 1.0 || depth <= 0.0) {
        return;
      }

      float linearDepth = linearizeDepth(depth);

      // Relative to viewshed position
      vec4 localPosition = reconstructLocalPosition(gl_FragCoord.xy, linearDepth);

      ViewshedPoint point;
      bool foundFace = getViewshedPoint(localPosition, point);

      // Outside every viewshed
      if (!foundFace || !point.isWithin) {
        return;
      }

      float viewshedDepth = getDepthFromShadowMap(point.uv, point.face);
      float distance = point.orthographicDepth;

      bool visible = distance < viewshedDepth;
      fragColor = visible ? visibleColor : occludedColor;

      float cosAngle = normalCosAngle(linearDepth, localPosition.xyz);

      // Everything facing away, and close to parallel is considered occluded.
      // Theshold corresponds to around 0.6 degrees, tuned empirically.
      if (cosAngle > -0.01) {
        fragColor = occludedColor;
      }
    }`),t}const x=(0,n.vt)(),S=Object.freeze(Object.defineProperty({__proto__:null,ViewshedPassParameters:b,build:w},Symbol.toStringTag,{value:"Module"}))},15263:(e,t,r)=>{"use strict";r.d(t,{W:()=>C,b:()=>A});var i=r(72412),n=r(34981),s=r(26917),o=r(59395),a=r(90080),l=r(48020),c=r(50819),u=r(43557),h=r(81993),d=r(2260),p=r(26719),f=r(86279),m=r(59640),g=r(82884),y=r(90235),_=r(80883),v=r(3799),b=r(58350),w=r(21390),x=r(64839),S=r(32307),T=r(10773),M=r(66470);function A(e){const t=new S.N5,{vertex:r,fragment:A}=t;(0,v.NB)(r,e),t.include(o.d,e),t.attributes.add(M.r.POSITION,"vec3"),t.attributes.add(M.r.UV0,"vec2");const C=new b.E("waterColor",(e=>e.color));if(e.output===n.V.Color&&e.draped)return t.varyings.add("vpos","vec3"),r.uniforms.add(C),r.code.add(x.H`
        void main(void) {
          if (waterColor.a < ${x.H.float(y.y)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),A.uniforms.add(C),A.code.add(x.H`void main() {
fragColor = waterColor;
}`),t;switch(e.output===n.V.Color&&(t.include(d.n,e),t.include(i.oD,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassEnabled&&t.varyings.add("depth","float"),r.uniforms.add(C),r.code.add(x.H`
      void main(void) {
        if (waterColor.a < ${x.H.float(y.y)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===n.V.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(h.Q,e),e.output){case n.V.Color:t.include(u.qU),t.include(c.W,{pbrMode:p.A9.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(g.V),t.include(s.HQ,e),t.include(f.Bz,e),t.include(m.E,e),A.uniforms.add(C,new w.m("timeElapsed",(e=>e.timeElapsed)),r.uniforms.get("view"),r.uniforms.get("localOrigin")),(0,v.yu)(A,e),A.include(_.a),e.transparencyPassType===T.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),(0,u.Gc)(A),(0,u.O4)(A),A.code.add(x.H`
      void main() {
        discardBySlice(vpos);
        ${e.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?x.H`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${e.transparencyPassType===T.y.ColorAlpha?x.H`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `);break;case n.V.Normal:t.include(d.n,e),t.include(g.V,e),t.include(s.HQ,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),r.uniforms.add(C),r.code.add(x.H`
        void main(void) {
          if (waterColor.a < ${x.H.float(y.y)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),A.uniforms.add(new w.m("timeElapsed",(e=>e.timeElapsed))),A.code.add(x.H`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case n.V.Highlight:t.include(l.Qh,e),t.varyings.add("vpos","vec3"),r.uniforms.add(C),r.code.add(x.H`
      void main(void) {
        if (waterColor.a < ${x.H.float(y.y)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(s.HQ,e),A.code.add(x.H`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case n.V.ObjectAndLayerIdColor:t.include(a.g,e),t.varyings.add("vpos","vec3"),r.uniforms.add(C),r.code.add(x.H`
      void main(void) {
        if (waterColor.a < ${x.H.float(y.y)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),t.include(s.HQ,e),A.code.add(x.H`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return t}const C=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}))},54787:(e,t,r)=>{"use strict";r.d(t,{c:()=>i,g:()=>n});var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}},79650:(e,t,r)=>{"use strict";r.d(t,{B:()=>y,a:()=>_,b:()=>Y,c:()=>v,d:()=>L,e:()=>O,f:()=>b,g:()=>S,h:()=>P,i:()=>T,n:()=>F,r:()=>D,t:()=>N,u:()=>w});r(81806);var i=r(76460),n=r(15941),s=r(97467),o=r(34761),a=r(13191),l=r(20664),c=r(9392),u=r(5568),h=r(44230),d=r(13927),p=r(95925),f=r(96190),m=r(75762);const g=()=>i.A.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");const y=class{constructor(){this.plane=(0,d.vt)(),this.origin=(0,c.vt)(),this.basis1=(0,c.vt)(),this.basis2=(0,c.vt)()}};function _(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B;return{plane:(0,d.vt)(e.plane),origin:(0,c.o8)(e.origin),basis1:(0,c.o8)(e.basis1),basis2:(0,c.o8)(e.basis2)}}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_();return b(e.origin,e.basis1,e.basis2,t)}function b(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_();return(0,l.c)(i.origin,e),(0,l.c)(i.basis1,t),(0,l.c)(i.basis2,r),w(i),function(e,t){Math.abs((0,l.m)(e.basis1,e.basis2)/((0,l.l)(e.basis1)*(0,l.l)(e.basis2)))>1e-6&&g().warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,l.m)(e.basis1,F(e)))>1e-6&&g().warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,l.m)(F(e),e.origin)-e.plane[3])>1e-6&&g().warn(t,"Plane offset is not consistent with plane origin")}(i,"fromValues()"),i}function w(e){(0,d.mR)(e.basis2,e.basis1,e.origin,e.plane)}function x(e,t,r){e!==r&&v(e,r);const i=(0,l.j)(m.rq.get(),F(e),t);return(0,l.g)(r.origin,r.origin,i),r.plane[3]-=t,r}function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_();const r=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return(0,l.s)(t.origin,e[0]+r,e[1]+i,0),(0,l.s)(t.basis1,r,0,0),(0,l.s)(t.basis2,0,i,0),(0,d.fA)(0,0,1,0,t.plane),t}function T(e,t,r){return!!(0,d.Ui)(e.plane,t,r)&&k(e,r)}function M(e,t,r){const i=j.get();V(e,t,i,j.get());let s=Number.POSITIVE_INFINITY;for(const o of $){const a=U(e,o,H.get()),c=m.rq.get();if((0,d.T7)(i,a,c)){const e=(0,l.E)(m.rq.get(),t.origin,c),i=Math.abs((0,n.XM)((0,l.m)(t.direction,e)));i<s&&(s=i,(0,l.c)(r,c))}}return s===Number.POSITIVE_INFINITY?A(e,t,r):r}function A(e,t,r){if(T(e,t,r))return r;const i=j.get(),n=j.get();V(e,t,i,n);let s=Number.POSITIVE_INFINITY;for(const o of $){const a=U(e,o,H.get()),c=m.rq.get();if((0,d.gv)(i,a,c)){const e=(0,p.kb)(t,c);if(!(0,d.Tj)(n,c))continue;e<s&&(s=e,(0,l.c)(r,c))}}return R(e,t.origin)<s&&C(e,t.origin,r),r}function C(e,t,r){const i=(0,d._I)(e.plane,t,m.rq.get()),n=(0,h.H6)(z(e,e.basis1),i,-1,1,m.rq.get()),s=(0,h.H6)(z(e,e.basis2),i,-1,1,m.rq.get());return(0,l.f)(r,(0,l.g)(m.rq.get(),n,s),e.origin),r}function E(e,t,r){const{origin:i,basis1:n,basis2:s}=e,o=(0,l.f)(m.rq.get(),t,i),a=(0,f.gr)(n,o),c=(0,f.gr)(s,o),u=(0,f.gr)(F(e),o);return(0,l.s)(r,a,c,u)}function R(e,t){const r=E(e,t,m.rq.get()),{basis1:i,basis2:n}=e,s=(0,l.l)(i),o=(0,l.l)(n),a=Math.max(Math.abs(r[0])-s,0),c=Math.max(Math.abs(r[1])-o,0),u=r[2];return a*a+c*c+u*u}function P(e,t){return Math.sqrt(R(e,t))}function O(e,t){return(0,d.Tj)(e.plane,t)&&k(e,t)}function I(e,t){const r=-e.plane[3];return(0,f.gr)(F(e),t)-r}function L(e,t){return(0,l.e)(e.basis1,t.basis1)&&(0,l.e)(e.basis2,t.basis2)&&(0,l.e)(e.origin,t.origin)}function N(e,t,r){return e!==r&&v(e,r),(0,o.B8)(q,t),(0,o.mg)(q,q),(0,l.h)(r.basis1,e.basis1,q),(0,l.h)(r.basis2,e.basis2,q),(0,l.h)((0,d.Qj)(r.plane),(0,d.Qj)(e.plane),q),(0,l.h)(r.origin,e.origin,t),(0,d.mP)(r.plane,r.plane,r.origin),r}function D(e,t,r,i){return e!==i&&v(e,i),(0,o.$0)(W,t,r),(0,l.h)(i.basis1,e.basis1,W),(0,l.h)(i.basis2,e.basis2,W),w(i),i}function F(e){return(0,d.Qj)(e.plane)}function k(e,t){const r=(0,l.f)(m.rq.get(),t,e.origin),i=(0,l.q)(e.basis1),n=(0,l.q)(e.basis2),s=(0,l.m)(e.basis1,r),o=(0,l.m)(e.basis2,r);return-s-i<0&&s-i<0&&-o-n<0&&o-n<0}function z(e,t){const r=H.get();return(0,l.c)(r.origin,e.origin),(0,l.c)(r.vector,t),r}function U(e,t,r){const{basis1:i,basis2:n,origin:s}=e,o=(0,l.j)(m.rq.get(),i,t.origin[0]),a=(0,l.j)(m.rq.get(),n,t.origin[1]);(0,l.g)(r.origin,o,a),(0,l.g)(r.origin,r.origin,s);const c=(0,l.j)(m.rq.get(),i,t.direction[0]),u=(0,l.j)(m.rq.get(),n,t.direction[1]);return(0,l.j)(r.vector,(0,l.g)(c,c,u),2),r}function V(e,t,r,i){const n=F(e);(0,d.mR)(n,t.direction,t.origin,r),(0,d.mR)((0,d.Qj)(r),n,t.origin,i)}const B={plane:(0,d.vt)(),origin:(0,c.fA)(0,0,0),basis1:(0,c.fA)(1,0,0),basis2:(0,c.fA)(0,1,0)},j=new s.I(d.vt),H=new s.I(h.vt),G=(0,c.vt)(),Z=new s.I((()=>_())),$=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],q=(0,a.vt)(),W=(0,a.vt)(),Y=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:y,altitudeAt:I,axisAt:function(e,t,r,i){return function(e,t,r){switch(t){case u._.X:(0,l.c)(r,e.basis1),(0,l.n)(r,r);break;case u._.Y:(0,l.c)(r,e.basis2),(0,l.n)(r,r);break;case u._.Z:(0,l.c)(r,F(e))}return r}(e,r,i)},closestPoint:A,closestPointOnSilhouette:M,copy:v,copyWithoutVerify:function(e,t){(0,l.c)(t.origin,e.origin),(0,l.c)(t.basis1,e.basis1),(0,l.c)(t.basis2,e.basis2),(0,d.C)(t.plane,e.plane)},create:_,distance:P,distance2:R,distanceToSilhouette:function(e,t){let r=Number.NEGATIVE_INFINITY;for(const i of $){const n=U(e,i,H.get()),s=(0,h.kb)(n,t);s>r&&(r=s)}return Math.sqrt(r)},elevate:x,equals:L,extrusionContainsPoint:O,fromAABoundingRect:S,fromValues:b,intersectRay:T,intersectRayClosestSilhouette:function(e,t,r){if(T(e,t,r))return r;const i=M(e,t,m.rq.get());return(0,l.g)(r,t.origin,(0,l.j)(m.rq.get(),t.direction,(0,l.p)(t.origin,i)/(0,l.l)(t.direction))),r},normal:F,projectPoint:C,projectPointLocal:E,rotate:D,setAltitudeAt:function(e,t,r,i){const n=I(e,t),s=(0,l.j)(G,F(e),r-n);return(0,l.g)(i,t,s),i},setExtent:function(e,t,r){return S(t,r),x(r,I(e,e.origin),r),r},transform:N,up:B,updateUnboundedPlane:w,wrap:function(e,t,r){const i=Z.get();return i.origin=e,i.basis1=t,i.basis2=r,i.plane=(0,d.LV)(0,0,0,0),w(i),i}},Symbol.toStringTag,{value:"Module"}))},35363:(e,t,r)=>{"use strict";r.d(t,{b:()=>h,l:()=>o,o:()=>c});var i,n=r(54787),s={exports:{}};void 0!==(i=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])&&(s.exports=i);const o=(0,n.g)(s.exports);var a,l={exports:{}};a=l,function(){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];void 0!==e&&(a.exports=e)}();const c=(0,n.g)(l.exports);var u={exports:{}};!function(e){!function(){var t=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"];void 0!==t&&(e.exports=t)}()}(u);const h=(0,n.g)(u.exports)},38983:(e,t,r)=>{"use strict";r.d(t,{e:()=>l});var i,n,s,o=r(54787),a={exports:{}};i=a,n=function(){function e(e,r,n){n=n||2;var s,o,a,c,u,h,d,p=r&&r.length,f=p?r[0]*n:e.length,m=t(e,0,f,n,!0),g=[];if(!m||m.next===m.prev)return g;if(p&&(m=l(e,r,m,n)),e.length>80*n){s=a=e[0],o=c=e[1];for(var y=n;y<f;y+=n)(u=e[y])<s&&(s=u),(h=e[y+1])<o&&(o=h),u>a&&(a=u),h>c&&(c=h);d=0!==(d=Math.max(a-s,c-o))?1/d:0}return i(m,g,n,s,o,d),g}function t(e,t,r,i,n){var s,o;if(n===E(e,t,r,i)>0)for(s=t;s<r;s+=i)o=M(s,e[s],e[s+1],o);else for(s=r-i;s>=t;s-=i)o=M(s,e[s],e[s+1],o);if(o&&v(o,o.next)){var a=o.next;A(o),o=a}return o}function r(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!v(i,i.next)&&0!==_(i.prev,i,i.next))i=i.next;else{var n=i.prev;if(A(i),(i=t=n)===i.next)break;r=!0}}while(r||i!==t);return t}function i(e,t,l,c,u,h,d){if(e){!d&&h&&p(e,c,u,h);for(var f,m,g=e;e.prev!==e.next;)if(f=e.prev,m=e.next,h?s(e,c,u,h):n(e))t.push(f.i/l),t.push(e.i/l),t.push(m.i/l),A(e),e=m.next,g=m.next;else if((e=m)===g){d?1===d?i(e=o(r(e),t,l),t,l,c,u,h,2):2===d&&a(e,t,l,c,u,h):i(r(e),t,l,c,u,h,1);break}}}function n(e){var t=e.prev,r=e,i=e.next;if(_(t,r,i)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(g(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&_(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function s(e,t,r,i){var n=e.prev,s=e,o=e.next;if(_(n,s,o)>=0)return!1;for(var a=n.x<s.x?n.x<o.x?n.x:o.x:s.x<o.x?s.x:o.x,l=n.y<s.y?n.y<o.y?n.y:o.y:s.y<o.y?s.y:o.y,c=n.x>s.x?n.x>o.x?n.x:o.x:s.x>o.x?s.x:o.x,u=n.y>s.y?n.y>o.y?n.y:o.y:s.y>o.y?s.y:o.y,h=f(a,l,t,r,i),d=f(c,u,t,r,i),p=e.prevZ,m=e.nextZ;p&&p.z>=h&&m&&m.z<=d;){if(p!==e.prev&&p!==e.next&&g(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==e.prev&&m!==e.next&&g(n.x,n.y,s.x,s.y,o.x,o.y,m.x,m.y)&&_(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&g(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=d;){if(m!==e.prev&&m!==e.next&&g(n.x,n.y,s.x,s.y,o.x,o.y,m.x,m.y)&&_(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function o(e,t,i){var n=e;do{var s=n.prev,o=n.next.next;!v(s,o)&&b(s,n,n.next,o)&&S(s,o)&&S(o,s)&&(t.push(s.i/i),t.push(n.i/i),t.push(o.i/i),A(n),A(n.next),n=e=o),n=n.next}while(n!==e);return r(n)}function a(e,t,n,s,o,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&y(l,c)){var u=T(l,c);return l=r(l,l.next),u=r(u,u.next),i(l,t,n,s,o,a),void i(u,t,n,s,o,a)}c=c.next}l=l.next}while(l!==e)}function l(e,i,n,s){var o,a,l,u=[];for(o=0,a=i.length;o<a;o++)(l=t(e,i[o]*s,o<a-1?i[o+1]*s:e.length,s,!1))===l.next&&(l.steiner=!0),u.push(m(l));for(u.sort(c),o=0;o<u.length;o++)n=r(n=h(u[o],n),n.next);return n}function c(e,t){return e.x-t.x}function u(e){if(e.next.prev===e)return e;let t=e;for(;;){const r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function h(e,t){var i=function(e,t){var r,i=t,n=e.x,s=e.y,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>o){if(o=a,a===n){if(s===i.y)return i;if(s===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===o)return r;var l,c=r,u=r.x,h=r.y,p=1/0;i=r;do{n>=i.x&&i.x>=u&&n!==i.x&&g(s<h?n:o,s,u,h,s<h?o:n,s,i.x,i.y)&&(l=Math.abs(s-i.y)/(n-i.x),S(i,e)&&(l<p||l===p&&(i.x>r.x||i.x===r.x&&d(r,i)))&&(r=i,p=l)),i=i.next}while(i!==c);return r}(e,t);if(!i)return t;var n=T(i,e),s=r(i,i.next);let o=u(n);return r(o,o.next),s=u(s),u(t===i?s:t)}function d(e,t){return _(e.prev,e,t.prev)<0&&_(t.next,e,e.next)<0}function p(e,t,r,i){var n=e;do{null===n.z&&(n.z=f(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,s,o,a,l,c=1;do{for(r=e,e=null,s=null,o=0;r;){for(o++,i=r,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,a--):(n=i,i=i.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;r=i}s.nextZ=null,c*=2}while(o>1)}(n)}function f(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function m(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function g(e,t,r,i,n,s,o,a){return(n-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(i-a)-(r-o)*(t-a)>=0&&(r-o)*(s-a)-(n-o)*(i-a)>=0}function y(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&b(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(S(e,t)&&S(t,e)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)&&(_(e.prev,e,t.prev)||_(e,t.prev,t))||v(e,t)&&_(e.prev,e,e.next)>0&&_(t.prev,t,t.next)>0)}function _(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function v(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,r,i){var n=x(_(e,t,r)),s=x(_(e,t,i)),o=x(_(r,i,e)),a=x(_(r,i,t));return n!==s&&o!==a||!(0!==n||!w(e,r,t))||!(0!==s||!w(e,i,t))||!(0!==o||!w(r,e,i))||!(0!==a||!w(r,t,i))}function w(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function x(e){return e>0?1:e<0?-1:0}function S(e,t){return _(e.prev,e,e.next)<0?_(e,t,e.next)>=0&&_(e,e.prev,t)>=0:_(e,t,e.prev)<0||_(e,e.next,t)<0}function T(e,t){var r=new C(e.i,e.x,e.y),i=new C(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function M(e,t,r,i){var n=new C(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function A(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function C(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(e,t,r,i){for(var n=0,s=t,o=r-i;s<r;s+=i)n+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return n}return e.deviation=function(e,t,r,i){var n=t&&t.length,s=n?t[0]*r:e.length,o=Math.abs(E(e,0,s,r));if(n)for(var a=0,l=t.length;a<l;a++){var c=t[a]*r,u=a<l-1?t[a+1]*r:e.length;o-=Math.abs(E(e,c,u,r))}var h=0;for(a=0;a<i.length;a+=3){var d=i[a]*r,p=i[a+1]*r,f=i[a+2]*r;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var s=0;s<e[n].length;s++)for(var o=0;o<t;o++)r.vertices.push(e[n][s][o]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r},e},void 0!==(s=n())&&(i.exports=s);const l=(0,o.g)(a.exports)},7724:(e,t,r)=>{"use strict";r.d(t,{P:()=>h,a:()=>u,c:()=>g,g:()=>c,h:()=>m,i:()=>a,j:()=>b,l:()=>l,p:()=>C});var i=r(28899),n=r(81806);let s,o=null;function a(){return!!o}function l(){return s||(s=r.e(5665).then(r.bind(r,65665)).then((e=>e.p)).then((e=>{let{default:t}=e;return t({locateFile:e=>(0,i.s)(`esri/geometry/support/${e}`)})})).then((e=>{x(e)})),s)}var c,u,h;!function(e){function t(e,t,r){o.ensureCache.prepare();const i=M(r),n=r===i,s=o.ensureFloat64(i),a=o._pe_geog_to_proj(o.getPointer(e),t,s);return a&&A(r,t,s,n),a}function r(e,t,r){return i(e,t,r,0)}function i(e,t,r,i){o.ensureCache.prepare();const n=M(r),s=r===n,a=o.ensureFloat64(n),l=o._pe_proj_to_geog_center(o.getPointer(e),t,a,i);return l&&A(r,t,a,s),l}e.geogToProj=t,e.projGeog=function(e,i,n,s){switch(s){case u.PE_TRANSFORM_P_TO_G:return r(e,i,n);case u.PE_TRANSFORM_G_TO_P:return t(e,i,n)}return 0},e.projToGeog=r,e.projToGeogCenter=i}(c||(c={})),function(e){e.init=function(){e.PE_BUFFER_MAX=o.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=o.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=o.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=o.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=o.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=o.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=o.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=o.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=o.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=o.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=o.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=o.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=o.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=o.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=o.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=o.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=o.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=o.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=o.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=o.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_STR_FMT_WKT=o.PeDefs.prototype.PE_STR_FMT_WKT,e.PE_STR_FMT_WKT2=o.PeDefs.prototype.PE_STR_FMT_WKT2,e.PE_PARM_X0=o.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=o.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=o.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=o.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=o.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=o.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=o.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=o.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=o.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=o.PeDefs.prototype.PE_HORIZON_DELTA}}(u||(u={})),function(e){const t={},r={},i=e=>{if(e){const t=e.getType();switch(t){case u.PE_TYPE_GEOGCS:e=o.castObject(e,o.PeGeogcs);break;case u.PE_TYPE_PROJCS:e=o.castObject(e,o.PeProjcs);break;case u.PE_TYPE_GEOGTRAN:e=o.castObject(e,o.PeGeogtran);break;default:t&u.PE_TYPE_UNIT&&(e=o.castObject(e,o.PeUnit))}}return e};function n(e,r){let n=null,s=t[e];if(s||(s={},t[e]=s),s.hasOwnProperty(String(r)))n=s[r];else{const t=o.PeFactory.prototype.factoryByType(e,r);o.compare(t,o.NULL)||(n=t,s[r]=n)}return n=i(n),n}e.initialize=function(){o.PeFactory.prototype.initialize(null)},e.coordsys=function(e){return n(u.PE_TYPE_COORDSYS,e)},e.factoryByType=n,e.fromString=function(e,t){let n=null,s=r[e];if(s||(s={},r[e]=s),s.hasOwnProperty(t))n=s[t];else{const r=o.PeFactory.prototype.fromString(e,t);o.compare(r,o.NULL)||(n=r,s[t]=n)}return n=i(n),n},e.geogcs=function(e){return n(u.PE_TYPE_GEOGCS,e)},e.geogtran=function(e){return n(u.PE_TYPE_GEOGTRAN,e)},e.getCode=function(e){return o.PeFactory.prototype.getCode(e)},e.projcs=function(e){return n(u.PE_TYPE_PROJCS,e)},e.unit=function(e){return n(u.PE_TYPE_UNIT,e)}}(h||(h={}));let d=null;var p,f,m,g,y,_,v,b,w;function x(e){function t(e,t,r){e[t]=r(e[t])}o=e,u.init(),p.init(),y.init(),v.init(),b.init(),d=class extends o.PeGCSExtent{destroy(){o.destroy(this)}};const r=[o.PeDatum,o.PeGeogcs,o.PeGeogtran,o.PeObject,o.PeParameter,o.PePrimem,o.PeProjcs,o.PeSpheroid,o.PeUnit];for(const s of r)t(s.prototype,"getName",(e=>function(){return e.call(this,new Array(u.PE_NAME_MAX))}));for(const s of[o.PeGeogtran,o.PeProjcs])t(s.prototype,"getParameters",(e=>function(){const t=new Array(u.PE_PARM_MAX);let r=e.call(this);for(let e=0;e<t.length;e++){const i=o.getValue(r,"*");t[e]=i?o.wrapPointer(i,o.PeParameter):null,r+=Int32Array.BYTES_PER_ELEMENT}return t}));t(o.PeHorizon.prototype,"getCoord",(e=>function(){const t=this.getSize();if(!t)return null;const r=[];return A(r,t,e.call(this)),r})),t(o.PeGTlistExtendedEntry.prototype,"getEntries",(e=>{const t=o._pe_getPeGTlistExtendedGTsSize();return function(){let r=null;const i=e.call(this);if(!o.compare(i,o.NULL)){r=[i];const e=this.getSteps();if(e>1){const n=o.getPointer(i);for(let i=1;i<e;i++)r.push(o.wrapPointer(n+t*i,o.PeGTlistExtendedGTs))}}return r}}));const i=o._pe_getPeHorizonSize(),n=e=>function(){let t=this._cache;if(t||(t=new Map,this._cache=t),t.has(e))return t.get(e);let r=null;const n=e.call(this);if(!o.compare(n,o.NULL)){r=[n];const e=n.getNump();if(e>1){const t=o.getPointer(n);for(let n=1;n<e;n++)r.push(o.wrapPointer(t+i*n,o.PeHorizon))}}return t.set(e,r),r};t(o.PeProjcs.prototype,"horizonGcsGenerate",n),t(o.PeProjcs.prototype,"horizonPcsGenerate",n),o.PeObject.prototype.toString=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.PE_STR_OPTS_NONE;o.ensureCache.prepare();const t=o.getPointer(this),r=o.ensureInt8(new Array(u.PE_BUFFER_MAX));return o.UTF8ToString(o._pe_object_to_string_ext(t,e,r))}}function S(e){if(!e)return;const t=o.getClass(e);if(!t)return;const r=o.getCache(t);if(!r)return;const i=o.getPointer(e);i&&delete r[i]}function T(e,t){const r=[],i=new Array(t);for(let n=0;n<e;n++)r.push(o.ensureInt8(i));return r}function M(e){let t;return Array.isArray(e[0])?(t=[],e.forEach((e=>{t.push(e[0],e[1])}))):t=e,t}function A(e,t,r){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3])for(let i=0;i<2*t;i++)e[i]=o.getValue(r+i*Float64Array.BYTES_PER_ELEMENT,"double");else{const i=0===e.length;for(let n=0;n<t;n++)i&&(e[n]=new Array(2)),e[n][0]=o.getValue(r,"double"),e[n][1]=o.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}!function(e){let t;e.init=function(){e.PE_GTLIST_OPTS_COMMON=o.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=o._pe_getPeGTlistExtendedEntrySize()},e.getGTlist=function(e,r,i,n,s,a){let l=null;const c=new o.PeInteger(a);try{const u=o.PeGTlistExtended.prototype.getGTlist(e,r,i,n,s,c);if((a=c.val)&&(l=[u],a>1)){const e=o.getPointer(u);for(let r=1;r<a;r++)l.push(o.wrapPointer(e+t*r,o.PeGTlistExtendedEntry))}}finally{o.destroy(c)}return l}}(p||(p={})),function(e){e.destroy=function(e){if(e?.length){for(const t of e)S(t),t.getEntries().forEach((e=>{S(e);const t=e.getGeogtran();S(t),t.getParameters().forEach(S),[t.getGeogcs1(),t.getGeogcs2()].forEach((e=>{S(e);const t=e.getDatum();S(t),S(t.getSpheroid()),S(e.getPrimem()),S(e.getUnit())}))}));o.PeGTlistExtendedEntry.prototype.Delete(e[0])}}}(f||(f={})),function(e){e.geogToGeog=function(e,t,r,i,n){o.ensureCache.prepare();const s=M(r),a=r===s,l=o.ensureFloat64(s);let c=0;i&&(c=o.ensureFloat64(i));const u=o._pe_geog_to_geog(o.getPointer(e),t,l,c,n);return u&&A(r,t,l,a),u}}(m||(m={})),function(e){const t=(e,t,r,i,n,s)=>{let a,l;switch(o.ensureCache.prepare(),e){case"dd":a=o._pe_geog_to_dd,l=u.PE_DD_MAX;break;case"ddm":a=o._pe_geog_to_ddm,l=u.PE_DDM_MAX;break;case"dms":a=o._pe_geog_to_dms,l=u.PE_DMS_MAX}let c=0;t&&(c=o.getPointer(t));const h=M(i),d=o.ensureFloat64(h),p=T(r,l),f=a(c,r,d,n,o.ensureInt32(p));if(f)for(let u=0;u<r;u++)s[u]=o.UTF8ToString(p[u]);return f},r=(e,t,r,i,n)=>{let s;switch(o.ensureCache.prepare(),e){case"dd":s=o._pe_dd_to_geog;break;case"ddm":s=o._pe_ddm_to_geog;break;case"dms":s=o._pe_dms_to_geog}let a=0;t&&(a=o.getPointer(t));const l=i.map((e=>o.ensureString(e))),c=o.ensureInt32(l),u=o.ensureFloat64(new Array(2*r)),h=s(a,r,c,u);return h&&A(n,r,u),h};e.geogToDms=function(e,r,i,n,s){return t("dms",e,r,i,n,s)},e.dmsToGeog=function(e,t,i,n){return r("dms",e,t,i,n)},e.geogToDdm=function(e,r,i,n,s){return t("ddm",e,r,i,n,s)},e.ddmToGeog=function(e,t,i,n){return r("ddm",e,t,i,n)},e.geogToDd=function(e,r,i,n,s){return t("dd",e,r,i,n,s)},e.ddToGeog=function(e,t,i,n){return r("dd",e,t,i,n)}}(g||(g={})),function(e){e.init=function(){e.PE_MGRS_STYLE_NEW=o.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=o.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=o.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=o.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=o.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES},e.geogToMgrsExtended=function(e,t,r,i,n,s,a){o.ensureCache.prepare();let l=0;e&&(l=o.getPointer(e));const c=M(r),h=o.ensureFloat64(c),d=T(t,u.PE_MGRS_MAX),p=o.ensureInt32(d),f=o._pe_geog_to_mgrs_extended(l,t,h,i,n,s,p);if(f)for(let u=0;u<t;u++)a[u]=o.UTF8ToString(d[u]);return f},e.mgrsToGeogExtended=function(e,t,r,i,n){o.ensureCache.prepare();let s=0;e&&(s=o.getPointer(e));const a=r.map((e=>o.ensureString(e))),l=o.ensureInt32(a),c=o.ensureFloat64(new Array(2*t)),u=o._pe_mgrs_to_geog_extended(s,t,l,i,c);return u&&A(n,t,c),u}}(y||(y={})),function(e){e.geogToUsng=function(e,t,r,i,n,s,a){o.ensureCache.prepare();let l=0;e&&(l=o.getPointer(e));const c=M(r),h=o.ensureFloat64(c),d=T(t,u.PE_MGRS_MAX),p=o.ensureInt32(d),f=o._pe_geog_to_usng(l,t,h,i,n,s,p);if(f)for(let u=0;u<t;u++)a[u]=o.UTF8ToString(d[u]);return f},e.usngToGeog=function(e,t,r,i){o.ensureCache.prepare();let n=0;e&&(n=o.getPointer(e));const s=r.map((e=>o.ensureString(e))),a=o.ensureInt32(s),l=o.ensureFloat64(new Array(2*t)),c=o._pe_usng_to_geog(n,t,a,l);return c&&A(i,t,l),c}}(_||(_={})),function(e){e.init=function(){e.PE_UTM_OPTS_NONE=o.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=o.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=o.PeNotationUtm.prototype.PE_UTM_OPTS_NS},e.geogToUtm=function(e,t,r,i,n){o.ensureCache.prepare();let s=0;e&&(s=o.getPointer(e));const a=M(r),l=o.ensureFloat64(a),c=T(t,u.PE_UTM_MAX),h=o.ensureInt32(c),d=o._pe_geog_to_utm(s,t,l,i,h);if(d)for(let u=0;u<t;u++)n[u]=o.UTF8ToString(c[u]);return d},e.utmToGeog=function(e,t,r,i,n){o.ensureCache.prepare();let s=0;e&&(s=o.getPointer(e));const a=r.map((e=>o.ensureString(e))),l=o.ensureInt32(a),c=o.ensureFloat64(new Array(2*t)),u=o._pe_utm_to_geog(s,t,l,i,c);return u&&A(n,t,c),u}}(v||(v={})),function(e){const t=new Map;e.init=function(){e.PE_PCSINFO_OPTION_NONE=o.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=o.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=o.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=o.PePCSInfo.prototype.PE_POLE_POINT},e.generate=function(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.PE_PCSINFO_OPTION_DOMAIN,n=null,s=null;return t.has(r)&&(s=t.get(r),s[i]&&(n=s[i])),n||(n=o.PePCSInfo.prototype.generate(r,i),s||(s=[],t.set(r,s)),s[i]=n),n}}(b||(b={})),function(e){e.versionString=function(){return o.PeVersion.prototype.version_string()}}(w||(w={}));const C=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return c},get PeDefs(){return u},get PeFactory(){return h},get PeGCSExtent(){return d},get PeGTTransformations(){return m},get PeGTlistExtended(){return p},get PeGTlistExtendedEntry(){return f},get PeNotationDms(){return g},get PeNotationMgrs(){return y},get PeNotationUsng(){return _},get PeNotationUtm(){return v},get PePCSInfo(){return b},get PeVersion(){return w},_init:x,get _pe(){return o},isLoaded:a,isSupported:function(){return!!(0,n.A)("esri-wasm")},load:l},Symbol.toStringTag,{value:"Module"}))},79453:(e,t,r)=>{"use strict";r.d(t,{M:()=>_,a:()=>g,b:()=>v,e:()=>f,f:()=>o,i:()=>d,p:()=>p,r:()=>l,t:()=>a,w:()=>c});var i=r(55171),n=r(90534),s=r(47437);function o(e,t){const r=t?.url?.path;if(e&&r&&(e=(0,n.s2)(e,r,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const r=(0,n.V1)(e,t.portalItem.itemUrl);null!=r&&h.test(r)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(r).path)}return(e=m(e,t?.portal))&&u.test(e)?g(e):e}function a(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.YES;if(null==(e=e&&u.test(e)?y(e):e))return e;!(0,n.oP)(e)&&t?.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let i=(0,n.s2)(e);if(t){const r=t.verifyItemRelativeUrls?.rootPath||t.url?.path;if(r){const s=m(r,t.portal),o=m(i,t.portal);i=(0,n.V1)(o,s,s),null!=i&&i!==o&&i!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=f(i,t?.portal),(0,n.oP)(i)&&(i=(0,n.S8)(i)),t?.resources&&t?.portalItem&&!(0,n.oP)(i)&&!(0,n.DB)(i)&&r===_.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(i),compress:!1}),i}function l(e,t,r){return o(e,r)}function c(e,t,r,i){const n=a(e,i);void 0!==n&&(t[r]=n)}const u=/\/items\/([^/]+)\/resources\/(.*)/,h=/^\.\/resources\//;function d(e){const t=e?.match(u)??null;return t?.[1]??null}function p(e){const t=e?.match(u)??null;if(null==t)return null;const r=t[2],i=r.lastIndexOf("/");if(-1===i){const{path:e,extension:t}=(0,n.xw)(r);return{prefix:null,filename:e,extension:t}}const{path:s,extension:o}=(0,n.xw)(r.slice(i+1));return{prefix:r.slice(0,i),filename:s,extension:o}}function f(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?(0,n.T1)(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function m(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const r=`${t.urlKey}.${t.customBaseUrl}`,i=(0,n.Xq)();return(0,n.FX)(i,`${i.scheme}://${r}`)?(0,n.T1)(e,t.portalHostname,r):(0,n.T1)(e,r,t.portalHostname)}function g(e){if(!e)return e||null;let t=e;return t&&i.id&&!i.id.findCredential(t)&&(t=(0,s.qG)(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}function y(e){if(!e)return e||null;let t=e;return t=t.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),t=t.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),t=t.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),t&&i.id&&!i.id.findCredential(t)&&(t=(0,s.qG)(t)),t}var _;!function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"}(_||(_={}));const v=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return _},ensureMainOnlineDomain:f,fromCDNUrl:y,fromJSON:o,itemIdFromResourceUrl:d,prefixAndFilenameFromResourceUrl:p,read:l,toCDNUrl:g,toJSON:a,write:c},Symbol.toStringTag,{value:"Module"}))},39539:(e,t,r)=>{"use strict";function i(e,t){const r=e.count;t||(t=new e.TypedArrayConstructor(r));for(let i=0;i<r;i++)t[i]=e.get(i);return t}r.d(t,{m:()=>i});Object.freeze(Object.defineProperty({__proto__:null,makeDense:i},Symbol.toStringTag,{value:"Module"}))},93582:(e,t,r)=>{"use strict";r.d(t,{N:()=>f,a:()=>_,b:()=>x,c:()=>m,d:()=>L,e:()=>O,f:()=>T,g:()=>S,h:()=>w,i:()=>M,j:()=>P,k:()=>v,l:()=>g,m:()=>A,n:()=>z,p:()=>I,s:()=>j,t:()=>B,u:()=>U,w:()=>b});r(81806),r(76460);var i=r(15941),n=r(34761),s=r(20664),o=r(9392),a=r(43047),l=r(55855),c=r(53494),u=r(5568),h=r(95925),d=r(96190),p=r(75762);const f=m();function m(){return(0,l.vt)()}const g=a.e,y=a.e;function _(e,t){return(0,a.c)(t,e)}function v(e,t){return(0,l.fA)(e[0],e[1],e[2],t)}function b(e){return e}function w(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function x(e){return e[3]}function S(e){return e}function T(e,t,r,i){return(0,l.fA)(e,t,r,i)}function M(e,t,r){if(null==t)return!1;if(!E(e,t,C))return!1;let{t0:i,t1:n}=C;if((i<0||n<i&&n>0)&&(i=n),i<0)return!1;if(r){const{origin:e,direction:n}=t;r[0]=e[0]+n[0]*i,r[1]=e[1]+n[1]*i,r[2]=e[2]+n[2]*i}return!0}function A(e,t,r){const i=(0,h.Cr)(t,r);if(!E(e,i,C))return[];const{origin:n,direction:a}=i,{t0:l,t1:u}=C,d=t=>{const r=(0,o.vt)();return(0,s.r)(r,n,a,t),I(e,r,r)};return Math.abs(l-u)<(0,c.FD)()?[d(l)]:[d(l),d(u)]}const C={t0:0,t1:0};function E(e,t,r){const{origin:i,direction:n}=t,s=R;s[0]=i[0]-e[0],s[1]=i[1]-e[1],s[2]=i[2]-e[2];const o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(0===o)return!1;const a=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=a*a-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);return r.t0=(-a-c)/(2*o),r.t1=(-a+c)/(2*o),!0}const R=(0,o.vt)();function P(e,t){return M(e,t,null)}function O(e,t,r){const i=p.rq.get(),o=p.Rc.get();(0,s.b)(i,t.origin,t.direction);const a=x(e);(0,s.b)(r,i,t.origin),(0,s.j)(r,r,1/(0,s.l)(r)*a);const l=N(e,t.origin),c=(0,d.g7)(t.origin,r);return(0,n.$0)(o,c+l,i),(0,s.h)(r,r,o),r}function I(e,t,r){const i=(0,s.f)(p.rq.get(),t,e),n=(0,s.j)(p.rq.get(),i,e[3]/(0,s.l)(i));return(0,s.g)(r,n,e)}function L(e,t){const r=(0,s.f)(p.rq.get(),t,e),i=(0,s.q)(r),n=e[3]*e[3];return Math.sqrt(Math.abs(i-n))}function N(e,t){const r=(0,s.f)(p.rq.get(),t,e),n=(0,s.l)(r),o=x(e),a=o+Math.abs(o-n);return(0,i.XM)(o/a)}const D=(0,o.vt)();function F(e,t,r,n){const o=(0,s.f)(D,t,e);switch(r){case u._.X:{const e=(0,i.jU)(o,D)[2];return(0,s.s)(n,-Math.sin(e),Math.cos(e),0)}case u._.Y:{const e=(0,i.jU)(o,D),t=e[1],r=e[2],a=Math.sin(t);return(0,s.s)(n,-a*Math.cos(r),-a*Math.sin(r),Math.cos(t))}case u._.Z:return(0,s.n)(n,o);default:return}}function k(e,t){const r=(0,s.f)(V,t,e);return(0,s.l)(r)-e[3]}function z(e,t){const r=(0,s.a)(e,t),i=x(e);return r<=i*i}function U(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,l.vt)();const i=(0,s.p)(e,t),n=e[3],o=t[3];return i+o<n?((0,a.c)(r,e),r):i+n<o?((0,a.c)(r,t),r):((0,s.o)(r,e,t,(i+o-n)/(2*i)),r[3]=(i+n+o)/2,r)}const V=(0,o.vt)(),B=m(),j=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:f,altitudeAt:k,angleToSilhouette:N,axisAt:F,clear:function(e){e[0]=e[1]=e[2]=e[3]=0},closestPoint:function(e,t,r){return M(e,t,r)?r:((0,h.oC)(t,e,r),I(e,r,r))},closestPointOnSilhouette:O,containsPoint:z,copy:_,create:m,distanceToSilhouette:L,elevate:function(e,t,r){return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),r[3]=e[3]+t,r},equals:y,exactEquals:g,fromCenterAndRadius:v,fromRadius:w,fromValues:T,getCenter:S,getRadius:x,intersectLine:A,intersectRay:M,intersectRayClosestSilhouette:function(e,t,r){if(M(e,t,r))return r;const i=O(e,t,p.rq.get());return(0,s.g)(r,t.origin,(0,s.j)(p.rq.get(),t.direction,(0,s.p)(t.origin,i)/(0,s.l)(t.direction))),r},intersectsRay:P,projectPoint:I,setAltitudeAt:function(e,t,r,i){const n=k(e,t),o=F(e,t,u._.Z,V),a=(0,s.j)(V,o,r-n);return(0,s.g)(i,t,a)},setExtent:function(e,t,r){return e!==r&&_(e,r),r},tmpSphere:B,union:U,wrap:b},Symbol.toStringTag,{value:"Module"}))},35143:(e,t,r)=>{"use strict";function i(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}function n(e,t){return function(r,i){t(r,i,e)}}function s(e,t,r,i){function n(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,s){function o(e){try{l(i.next(e))}catch(t){s(t)}}function a(e){try{l(i.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):n(e.value).then(o,a)}l((i=i.apply(e,t||[])).next())}))}r.d(t,{_:()=>i,a:()=>n,b:()=>s}),"function"==typeof SuppressedError&&SuppressedError},52007:(e,t,r)=>{"use strict";r.d(t,{a:()=>n,f:()=>o,n:()=>s});var i=r(78393);function n(e,t){s(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function s(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;const s=t.length/2;let o=0,a=0;if((0,i.cy)(t)||(0,i.dk)(t)){for(let i=0;i<s;++i)e[o]=t[a],e[o+1]=t[a+1],o+=r,a+=n;return}const l=(0,i.a3)(t);if((0,i.JI)(t))for(let i=0;i<s;++i)e[o]=Math.max(t[a]/l,-1),e[o+1]=Math.max(t[a+1]/l,-1),o+=r,a+=n;else for(let i=0;i<s;++i)e[o]=t[a]/l,e[o+1]=t[a+1]/l,o+=r,a+=n}function o(e,t,r,i){const n=e.typedBuffer,s=e.typedBufferStride,o=i?.count??e.count;let a=(i?.dstIndex??0)*s;for(let l=0;l<o;++l)n[a]=t,n[a+1]=r,a+=s}Object.freeze(Object.defineProperty({__proto__:null,fill:o,normalizeIntegerBuffer:s,normalizeIntegerBufferView:n},Symbol.toStringTag,{value:"Module"}))},45136:(e,t,r)=>{"use strict";r.d(t,{a:()=>n,b:()=>c,c:()=>s,d:()=>i,e:()=>u,f:()=>a,n:()=>h,s:()=>l,t:()=>o});r(81806),r(76460);function i(e,t,r){n(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function n(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i;if(e.length/i!==Math.ceil(t.length/n))return e;const s=e.length/i,o=r[0],a=r[1],l=r[2],c=r[4],u=r[5],h=r[6],d=r[8],p=r[9],f=r[10],m=r[12],g=r[13],y=r[14];let _=0,v=0;for(let b=0;b<s;b++){const r=t[_],s=t[_+1],b=t[_+2];e[v]=o*r+c*s+d*b+m,e[v+1]=a*r+u*s+p*b+g,e[v+2]=l*r+h*s+f*b+y,_+=n,v+=i}return e}function s(e,t,r){o(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function o(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i;if(e.length/i!==Math.ceil(t.length/n))return;const s=e.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],d=r[6],p=r[7],f=r[8];let m=0,g=0;for(let y=0;y<s;y++){const r=t[m],s=t[m+1],y=t[m+2];e[g]=o*r+c*s+d*y,e[g+1]=a*r+u*s+p*y,e[g+2]=l*r+h*s+f*y,m+=n,g+=i}}function a(e,t,r){l(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function l(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i;const s=Math.min(e.length/i,t.length/n);let o=0,a=0;for(let l=0;l<s;l++)e[a]=r*t[o],e[a+1]=r*t[o+1],e[a+2]=r*t[o+2],o+=n,a+=i;return e}function c(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i;const s=e.length/i;if(s!==Math.ceil(t.length/n))return e;let o=0,a=0;for(let l=0;l<s;l++)e[a]=t[o]+r[0],e[a+1]=t[o+1]+r[1],e[a+2]=t[o+2]+r[2],o+=n,a+=i;return e}function u(e,t){h(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function h(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;const n=Math.min(e.length/r,t.length/i);let s=0,o=0;for(let a=0;a<n;a++){const n=t[s],a=t[s+1],l=t[s+2],c=n*n+a*a+l*l;if(c>0){const t=1/Math.sqrt(c);e[o]=t*n,e[o+1]=t*a,e[o+2]=t*l}s+=i,o+=r}}Object.freeze(Object.defineProperty({__proto__:null,normalize:h,normalizeView:u,scale:l,scaleView:a,shiftRight:function(e,t,r){const i=Math.min(e.count,t.count),n=e.typedBuffer,s=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;let l=0,c=0;for(let u=0;u<i;u++)n[c]=o[l]>>r,n[c+1]=o[l+1]>>r,n[c+2]=o[l+2]>>r,l+=a,c+=s},transformMat3:o,transformMat3View:s,transformMat4:n,transformMat4View:i,translate:c},Symbol.toStringTag,{value:"Module"}))},20664:(e,t,r)=>{"use strict";r.d(t,{A:()=>f,B:()=>u,C:()=>g,D:()=>h,E:()=>k,F:()=>B,G:()=>F,H:()=>H,I:()=>Z,J:()=>d,K:()=>O,a:()=>b,b:()=>A,c:()=>o,d:()=>I,e:()=>D,f:()=>c,g:()=>l,h:()=>E,i:()=>S,j:()=>y,k:()=>x,l:()=>s,m:()=>M,n:()=>T,o:()=>C,p:()=>v,q:()=>w,r:()=>_,s:()=>a,t:()=>R,u:()=>P,v:()=>p,w:()=>j,x:()=>G,y:()=>m,z:()=>z});var i=r(9392),n=r(53494);function s(e){const t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function a(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function l(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function c(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function u(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function h(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function d(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function p(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function f(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function m(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function g(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function y(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function _(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function v(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}function b(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function w(e){const t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function x(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function S(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function T(e,t){const r=t[0],i=t[1],n=t[2];let s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e}function M(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function A(e,t,r){const i=t[0],n=t[1],s=t[2],o=r[0],a=r[1],l=r[2];return e[0]=n*l-s*a,e[1]=s*o-i*l,e[2]=i*a-n*o,e}function C(e,t,r,i){const n=t[0],s=t[1],o=t[2];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=o+i*(r[2]-o),e}function E(e,t,r){const i=t[0],n=t[1],s=t[2];return e[0]=r[0]*i+r[4]*n+r[8]*s+r[12],e[1]=r[1]*i+r[5]*n+r[9]*s+r[13],e[2]=r[2]*i+r[6]*n+r[10]*s+r[14],e}function R(e,t,r){const i=t[0],n=t[1],s=t[2];return e[0]=i*r[0]+n*r[3]+s*r[6],e[1]=i*r[1]+n*r[4]+s*r[7],e[2]=i*r[2]+n*r[5]+s*r[8],e}function P(e,t,r){const i=r[0],n=r[1],s=r[2],o=r[3],a=t[0],l=t[1],c=t[2],u=n*c-s*l,h=s*a-i*c,d=i*l-n*a,p=n*d-s*h,f=s*u-i*d,m=i*h-n*u,g=2*o;return e[0]=a+u*g+2*p,e[1]=l+h*g+2*f,e[2]=c+d*g+2*m,e}function O(e,t,r,i){const n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function I(e,t){T(L,e),T(N,t);const r=M(L,N);return r>1?0:r<-1?Math.PI:Math.acos(r)}const L=(0,i.vt)(),N=(0,i.vt)();function D(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function F(e,t){if(e===t)return!0;const r=e[0],i=e[1],s=e[2],o=t[0],a=t[1],l=t[2],c=(0,n.FD)();return Math.abs(r-o)<=c*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=c*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=c*Math.max(1,Math.abs(s),Math.abs(l))}function k(e,t,r){const i=r[0]-t[0],n=r[1]-t[1],s=r[2]-t[2];let o=i*i+n*n+s*s;return o>0?(o=1/Math.sqrt(o),e[0]=i*o,e[1]=n*o,e[2]=s*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const z=c,U=u,V=h,B=v,j=b,H=s,G=w,Z=Object.freeze(Object.defineProperty({__proto__:null,abs:p,add:l,angle:I,bezier:function(e,t,r,i,n,s){const o=1-s,a=o*o,l=s*s,c=a*o,u=3*s*a,h=3*l*o,d=l*s;return e[0]=t[0]*c+r[0]*u+i[0]*h+n[0]*d,e[1]=t[1]*c+r[1]*u+i[1]*h+n[1]*d,e[2]=t[2]*c+r[2]*u+i[2]*h+n[2]*d,e},ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},copy:o,cross:A,direction:k,dist:B,distance:v,div:V,divide:h,dot:M,equals:F,exactEquals:D,floor:d,hermite:function(e,t,r,i,n,s){const o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),u=o*(3-2*s);return e[0]=t[0]*a+r[0]*l+i[0]*c+n[0]*u,e[1]=t[1]*a+r[1]*l+i[1]*c+n[1]*u,e[2]=t[2]*a+r[2]*l+i[2]*c+n[2]*u,e},inverse:S,len:H,length:s,lerp:C,max:g,min:m,mul:U,multiply:u,negate:x,normalize:T,random:function(e,t){t=t||1;const r=n.Ov,i=2*r()*Math.PI,s=2*r()-1,o=Math.sqrt(1-s*s)*t;return e[0]=Math.cos(i)*o,e[1]=Math.sin(i)*o,e[2]=s*t,e},rotateX:function(e,t,r,i){const n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e},rotateY:function(e,t,r,i){const n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e},rotateZ:O,round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:y,scaleAndAdd:_,set:a,sign:f,sqrDist:j,sqrLen:G,squaredDistance:b,squaredLength:w,str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},sub:z,subtract:c,transformMat3:R,transformMat4:E,transformQuat:P},Symbol.toStringTag,{value:"Module"}))},64591:(e,t,r)=>{"use strict";function i(e,t){n(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function n(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;const n=t.length/i;let s=0,o=0;for(let a=0;a<n;++a)e[s]=t[o],e[s+1]=t[o+1],e[s+2]=t[o+2],s+=r,o+=i}function s(e,t,r,i,n){const s=e.typedBuffer,o=e.typedBufferStride,a=n?.count??e.count;let l=(n?.dstIndex??0)*o;for(let c=0;c<a;++c)s[l]=t,s[l+1]=r,s[l+2]=i,l+=o}r.d(t,{a:()=>i,c:()=>n,f:()=>s});Object.freeze(Object.defineProperty({__proto__:null,copy:n,copyView:i,fill:s},Symbol.toStringTag,{value:"Module"}))},33328:(e,t,r)=>{"use strict";r.d(t,{a:()=>n,b:()=>a,n:()=>o,s:()=>l,t:()=>s});r(81806);var i=r(76460);function n(e,t,r){s(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function s(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i;if(e.length/i!=t.length/n)return;const s=e.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],d=r[6],p=r[7],f=r[8];let m=0,g=0;for(let y=0;y<s;y++){const r=t[m],s=t[m+1],y=t[m+2],_=t[m+3];e[g]=o*r+c*s+d*y,e[g+1]=a*r+u*s+p*y,e[g+2]=l*r+h*s+f*y,e[g+3]=_,m+=n,g+=i}}function o(e,t){const r=Math.min(e.count,t.count),i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<r;a++){const e=a*n,t=a*o,r=s[t],l=s[t+1],c=s[t+2],u=r*r+l*l+c*c;if(u>0){const t=1/Math.sqrt(u);i[e]=t*r,i[e+1]=t*l,i[e+2]=t*c}}}function a(e,t,r){l(e.typedBuffer,t,r,e.typedBufferStride)}function l(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;const n=Math.min(e.length/i,t.count),s=t.typedBuffer,o=t.typedBufferStride;let a=0,l=0;for(let c=0;c<n;c++)e[l]=r*s[a],e[l+1]=r*s[a+1],e[l+2]=r*s[a+2],e[l+3]=r*s[a+3],a+=o,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:o,scale:l,scaleView:a,transformMat3:s,transformMat3View:n,transformMat4:function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n;if(e.length/n!=t.length/s)return void i.A.getLogger("esri.views.3d.support.buffer.math").error("source and destination buffers need to have the same number of elements");const o=e.length/n,a=r[0],l=r[1],c=r[2],u=r[3],h=r[4],d=r[5],p=r[6],f=r[7],m=r[8],g=r[9],y=r[10],_=r[11],v=r[12],b=r[13],w=r[14],x=r[15];let S=0,T=0;for(let i=0;i<o;i++){const r=t[S],i=t[S+1],o=t[S+2],M=t[S+3];e[T]=a*r+h*i+m*o+v*M,e[T+1]=l*r+d*i+g*o+b*M,e[T+2]=c*r+p*i+y*o+w*M,e[T+3]=u*r+f*i+_*o+x*M,S+=s,T+=n}},transformMat4View:function(e,t,r){if(e.count!==t.count)return;const i=e.count,n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],y=r[13],_=r[14],v=r[15],b=e.typedBuffer,w=e.typedBufferStride,x=t.typedBuffer,S=t.typedBufferStride;for(let T=0;T<i;T++){const e=T*w,t=T*S,r=x[t],i=x[t+1],M=x[t+2],A=x[t+3];b[e]=n*r+l*i+d*M+g*A,b[e+1]=s*r+c*i+p*M+y*A,b[e+2]=o*r+u*i+f*M+_*A,b[e+3]=a*r+h*i+m*M+v*A}}},Symbol.toStringTag,{value:"Module"}))},43047:(e,t,r)=>{"use strict";r.d(t,{a:()=>b,b:()=>h,c:()=>n,d:()=>p,e:()=>w,f:()=>a,g:()=>y,h:()=>s,i:()=>f,j:()=>m,l:()=>_,n:()=>g,s:()=>o,t:()=>v,v:()=>R});var i=r(53494);function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function o(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function a(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function l(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function c(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function u(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function h(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function d(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(r*r+i*i+n*n+s*s)}function p(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return r*r+i*i+n*n+s*s}function f(e){const t=e[0],r=e[1],i=e[2],n=e[3];return Math.sqrt(t*t+r*r+i*i+n*n)}function m(e){const t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function g(e,t){const r=t[0],i=t[1],n=t[2],s=t[3];let o=r*r+i*i+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=i*o,e[2]=n*o,e[3]=s*o),e}function y(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function _(e,t,r,i){const n=t[0],s=t[1],o=t[2],a=t[3];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=o+i*(r[2]-o),e[3]=a+i*(r[3]-a),e}function v(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*o,e[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*o,e[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*o,e[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*o,e}function b(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function w(e,t){const r=e[0],n=e[1],s=e[2],o=e[3],a=t[0],l=t[1],c=t[2],u=t[3],h=(0,i.FD)();return Math.abs(r-a)<=h*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=h*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=h*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(o-u)<=h*Math.max(1,Math.abs(o),Math.abs(u))}const x=l,S=c,T=u,M=d,A=p,C=f,E=m,R=Object.freeze(Object.defineProperty({__proto__:null,add:a,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},copy:n,copyVec3:s,dist:M,distance:d,div:T,divide:u,dot:y,equals:w,exactEquals:b,floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},len:C,length:f,lerp:_,max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},mul:S,multiply:c,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},normalize:g,random:function(e,t){const r=i.Ov;let n,s,o,a,l,c;t=t||1;do{n=2*r()-1,s=2*r()-1,l=n*n+s*s}while(l>=1);do{o=2*r()-1,a=2*r()-1,c=o*o+a*a}while(c>=1);const u=Math.sqrt((1-l)/c);return e[0]=t*n,e[1]=t*s,e[2]=t*o*u,e[3]=t*a*u,e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:h,scaleAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},set:o,sqrDist:A,sqrLen:E,squaredDistance:p,squaredLength:m,str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},sub:x,subtract:l,transformMat4:v,transformQuat:function(e,t,r){const i=t[0],n=t[1],s=t[2],o=r[0],a=r[1],l=r[2],c=r[3],u=c*i+a*s-l*n,h=c*n+l*i-o*s,d=c*s+o*n-a*i,p=-o*i-a*n-l*s;return e[0]=u*c+p*-o+h*-l-d*-a,e[1]=h*c+p*-a+d*-o-u*-l,e[2]=d*c+p*-l+u*-a-h*-o,e[3]=t[3],e}},Symbol.toStringTag,{value:"Module"}))},2e3:(e,t,r)=>{"use strict";function i(e,t){n(e.typedBuffer,t,e.typedBufferStride)}function n(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;const i=t.typedBuffer,n=t.typedBufferStride,s=t.count;let o=0,a=0;for(let l=0;l<s;++l)e[o]=i[a],e[o+1]=i[a+1],e[o+2]=i[a+2],e[o+3]=i[a+3],o+=r,a+=n}function s(e,t,r,i,n,s){const o=e.typedBuffer,a=e.typedBufferStride,l=s?.count??e.count;let c=(s?.dstIndex??0)*a;for(let u=0;u<l;++u)o[c]=t,o[c+1]=r,o[c+2]=i,o[c+3]=n,c+=a}r.d(t,{a:()=>i,c:()=>n,f:()=>s});Object.freeze(Object.defineProperty({__proto__:null,copy:n,copyView:i,fill:s},Symbol.toStringTag,{value:"Module"}))},99746:(e,t,r)=>{"use strict";r.d(t,{TS:()=>s,V6:()=>n,c4:()=>o,qh:()=>c,z$:()=>l});const i={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function n(e){return!!i[e]||!!i[e.toLowerCase()]}function s(e){return i[e]??i[e.toLowerCase()]}function o(e){return[...s(e)]}function a(e,t,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?e+(t-e)*i:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}function l(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const n=(e%360+360)%360/360,s=r<=.5?r*(t+1):r+t-r*t,o=2*r-s;return[Math.round(255*a(o,s,n+1/3)),Math.round(255*a(o,s,n)),Math.round(255*a(o,s,n-1/3)),i]}function c(e){const t=e.length>5,r=t?8:4,i=(1<<r)-1,n=t?1:17,s=t?9===e.length:5===e.length;let o=Number("0x"+e.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return s&&(l=o&i,o>>=r,a[3]=n*l/255),l=o&i,o>>=r,a[2]=n*l,l=o&i,o>>=r,a[1]=n*l,l=o&i,o>>=r,a[0]=n*l,a}},86560:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});r(81806);var i=r(48611);const n={apiKey:void 0,applicationName:"",applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",respectPrefersReducedMotion:!0,routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],internalInterceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&((0,i.$N)(n,globalThis.esriConfig,!0),delete n.has),!n.assetsPath){{const e="4.30";n.assetsPath=`https://js.arcgis.com/${e}/@arcgis/core/assets`}n.defaultAssetsPath=n.assetsPath}},91967:(e,t,r)=>{"use strict";r.d(t,{A:()=>D});var i=r(63241),n=r(88321),s=r(76460),o=r(30726),a=r(37596),l=r(17879),c=r(39299),u=r(19258),h=(r(81806),r(53084)),d=r(3789),p=r(40836),f=r(49140),m=r(99486),g=r(15434);class y extends p.T{constructor(e,t){super(),this.propertyName=e,this.metadata=t,this._accessed=null,this._handles=null,this.flags=0,this.flags=g.i.Dirty|(t.nonNullable?g.i.NonNullable:0)|(t.hasOwnProperty("value")?g.i.HasDefaultValue:0)|(void 0===t.get?g.i.DepTrackingInitialized:0)|(void 0===t.dependsOn?g.i.AutoTracked:0)}destroy(){this.flags&g.i.Dirty&&this.onCommitted(),super.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){(0,m.gc)(this);const t=e.store,r=this.propertyName,i=this.flags,n=t.get(r);if(i&g.i.Computing)return n;if(~i&g.i.Dirty&&t.has(r))return n;this.flags|=g.i.Computing;const s=e.host;let o;i&g.i.AutoTracked?o=(0,m.a)(this,this.metadata.get,s):((0,m.Xr)(s,this),o=this.metadata.get.call(s)),t.set(r,o,f.Gr.COMPUTED);const a=t.get(r);return a===n?this.flags&=~g.i.Dirty:(0,m.F_)(this.commit,this),this.flags&=~g.i.Computing,a}onObservableAccessed(e){e!==this&&(this._accessed??=new Set,this._accessed.add(e))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=g.i.DepTrackingInitialized,null!=this._accessed&&(this._handles??=[],this._accessed.forEach((e=>{this._handles.push(e.observe(this))})),this._accessed.clear())}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~g.i.Dirty,this.onCommitted()}_clearObservationHandles(){const e=this._handles;if(null!==e){for(let t=0;t<e.length;++t)e[t].remove();e.length=0}}onInvalidated(){~this.flags&g.i.Overridden&&(this.flags|=g.i.Dirty);const e=this._observers;if(e&&e.length>0)for(const t of e)t.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const t=e.slice();for(const e of t)e.onCommitted()}}}class _{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const t=new _;return this._values.forEach(((r,i)=>{e&&e.has(i)||t.set(i,(0,h.o8)(r))})),t}get(e){return this._values.get(e)}originOf(){return f.Gr.USER}keys(){return[...this._values.keys()]}set(e,t){this._values.set(e,t)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}}function v(e,t,r){return void 0!==e}function b(e,t,r,i){return void 0!==e&&(!(null==r&&e.flags&g.i.NonNullable)||(i.lifecycle,c.v.INITIALIZING,!1))}class w{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=c.v.INITIALIZING,this.store=new _,this._origin=f.Gr.USER;const t=this.host.constructor.__accessorMetadata__;for(const r in t){const e=new y(r,t[r]);this.propertiesByName.set(r,e)}this.metadata=t}initialize(){this.lifecycle=c.v.CONSTRUCTING}constructed(){this.lifecycle=c.v.CONSTRUCTED}destroy(){this.lifecycle=c.v.DESTROYED,this.propertiesByName.forEach((e=>e.destroy()))}get initialized(){return this.lifecycle!==c.v.INITIALIZING}get(e){const t=this.propertiesByName.get(e);if(t.metadata.get)return t.getComputed(this);(0,m.gc)(t);const r=this.store;return r.has(e)?r.get(e):t.metadata.value}originOf(e){const t=this.store.originOf(e);if(void 0===t){const t=this.propertiesByName.get(e);if(void 0!==t&&t.flags&g.i.HasDefaultValue)return"defaults"}return(0,f.OL)(t)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const t=this.propertiesByName.get(e);if(v(t))return this.store.has(e)?this.store.get(e):t.metadata.value}internalSet(e,t){const r=this.propertiesByName.get(e);v(r)&&this._internalSet(r,t)}getDependsInfo(e,t,r){const i=this.propertiesByName.get(t);if(!v(i))return"";const n=new Set,s=(0,m.a)({onObservableAccessed:e=>n.add(e),onTrackingEnd:()=>{}},(()=>i.metadata.get?.call(e)));let o=`${r}${e.declaredClass.split(".").pop()}.${t}: ${s}\n`;if(0===n.size)return o;r+="  ";for(const a of n)a instanceof y&&(o+=`${r}${a.propertyName}: undefined\n`);return o}setAtOrigin(e,t,r){const i=this.propertiesByName.get(e);if(v(i))return this._setAtOrigin(i,t,r)}isOverridden(e){const t=this.propertiesByName.get(e);return void 0!==t&&!!(t.flags&g.i.Overridden)}clearOverride(e){const t=this.propertiesByName.get(e);t&&t.flags&g.i.Overridden&&(t.flags&=~g.i.Overridden,t.notifyChange())}override(e,t){const r=this.propertiesByName.get(e);if(!b(r,0,t,this))return;const i=r.metadata.cast;if(i){const e=this._cast(i,t),{valid:r,value:n}=e;if(x.release(e),!r)return;t=n}r.flags|=g.i.Overridden,this._internalSet(r,t)}set(e,t){const r=this.propertiesByName.get(e);if(!b(r,0,t,this))return;const i=r.metadata.cast;if(i){const e=this._cast(i,t),{valid:r,value:n}=e;if(x.release(e),!r)return;t=n}const n=r.metadata.set;n?n.call(this.host,t):this._internalSet(r,t)}setDefaultOrigin(e){this._origin=(0,f.aB)(e)}getDefaultOrigin(){return(0,f.OL)(this._origin)}notifyChange(e){const t=this.propertiesByName.get(e);void 0!==t&&t.notifyChange()}invalidate(e){const t=this.propertiesByName.get(e);void 0!==t&&t.invalidate()}commit(e){const t=this.propertiesByName.get(e);void 0!==t&&t.commit()}_internalSet(e,t){const r=this.lifecycle!==c.v.INITIALIZING?this._origin:f.Gr.DEFAULTS;this._setAtOrigin(e,t,r)}_setAtOrigin(e,t,r){const i=this.store,n=e.propertyName;i.has(n,r)&&(0,h.aI)(t,i.get(n))&&~e.flags&g.i.Overridden&&r===i.originOf(n)||(e.invalidate(),i.set(n,t,r),e.commit(),(0,m.fE)(this.host,e))}_cast(e,t){const r=x.acquire();return r.valid=!0,r.value=t,e&&(r.value=e.call(this.host,t,r)),r}}const x=new d.A(class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}});var S=r(8819);let T;function M(){return T}var A;!function(e){e[e.Ignore=0]="Ignore",e[e.Destroy=1]="Destroy",e[e.ThrowError=2]="ThrowError"}(A||(A={}));var C,E,R=r(68452),P=r(46053),O=r(85842);function I(e){if(null==e)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return e.constructor?.__accessorMetadata__||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const L=Symbol("Accessor-Handles"),N=Symbol("Accessor-Initialized");class D{static createSubclass(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:t,declaredClass:r,constructor:i}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class s extends n{constructor(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];super(...t),this.inherited=null,i&&i.apply(this,t)}}(0,u.tD)(s.prototype);for(const o in e){const t=e[o];s.prototype[o]="function"==typeof t?function(){const e=this.inherited;let r;this.inherited=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(n.prototype[o])return n.prototype[o].apply(this,t)};try{for(var i=arguments.length,a=new Array(i),l=0;l<i;l++)a[l]=arguments[l];r=t.apply(this,a)}catch(s){throw this.inherited=e,s}return this.inherited=e,r}:e[o]}for(const o in t){const e=I(t[o]);(0,P.MZ)(e)(s.prototype,o)}return(0,O.$)(r)(s)}constructor(){if(this[C]=null,this[E]=!1,this.constructor===D)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const e=new w(this);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];Object.defineProperty(this,"__accessor__",{enumerable:!1,value:e}),r.length>0&&(e.ctorArgs=this.normalizeCtorArgs?.apply(this,r)??r[0]),M()?.onInstanceConstruct(this)}postscript(){const e=this.__accessor__,t=e.ctorArgs;e.initialize(),t&&(this.set(t),e.ctorArgs=null),e.constructed(),this.initialize(),this[N]=!0}initialize(){}[a.G](){this[L]=(0,o.pR)(this[L])}destroy(){this.destroyed||((0,R.iS)(this),this.__accessor__.destroy(),M()?.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[N]}get destroyed(){return this.__accessor__?.lifecycle===c.v.DESTROYED||!1}commitProperty(e){(0,l.Jt)(this,e)}get(e){return(0,i.eO)(s.A.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),(0,l.Jt)(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,t){return(0,S.h)(this,e,t),this}watch(e,t,r){return(0,R.wB)(this,e,t,r)}addHandles(e,t){if(this.destroyed){const t=Array.isArray(e)?e:[e];for(const e of t)e.remove()}else(this[L]??=new n.A).add(e,t)}removeHandles(e){this[L]?.remove(e)}removeAllHandles(){this[L]?.removeAll()}removeHandlesReference(e){this[L]?.removeReference(e)}hasHandles(e){return!0===this[L]?.has(e)}_override(e,t){void 0===t?this.__accessor__.clearOverride(e):this.__accessor__.override(e,t)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,t){null==t?this.__accessor__.clearOverride(e):this.__accessor__.override(e,t)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,t){return this.__accessor__.internalSet(e,t),this}}C=L,E=N},11373:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var i=r(3789);function n(e){e.length=0}class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;this._pool=new i.A(Array,void 0,n,t,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return o.acquire()}static release(e){return o.release(e)}static prune(){o.prune()}}const o=new s(100)},23164:(e,t,r)=>{"use strict";r.d(t,{A:()=>D});const i=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["\xab","\xbb"],["\xbb","\xab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]],n=["\u0622","\u0623","\u0625","\u0627"],s=["\ufef5","\ufef7","\ufef9","\ufefb"],o=["\ufef6","\ufef8","\ufefa","\ufefc"],a=["\u0627","\u0628","\u062a","\u062b","\u062c","\u062d","\u062e","\u062f","\u0630","\u0631","\u0632","\u0633","\u0634","\u0635","\u0636","\u0637","\u0638","\u0639","\u063a","\u0641","\u0642","\u0643","\u0644","\u0645","\u0646","\u0647","\u0648","\u064a","\u0625","\u0623","\u0622","\u0629","\u0649","\u0644","\u0645","\u0646","\u0647","\u0648","\u064a","\u0625","\u0623","\u0622","\u0629","\u0649","\u06cc","\u0626","\u0624"],l=["\ufe8d","\ufe8f","\ufe95","\ufe99","\ufe9d","\ufea1","\ufea5","\ufea9","\ufeab","\ufead","\ufeaf","\ufeb1","\ufeb5","\ufeb9","\ufebd","\ufec1","\ufec5","\ufec9","\ufecd","\ufed1","\ufed5","\ufed9","\ufedd","\ufee1","\ufee5","\ufee9","\ufeed","\ufef1","\ufe87","\ufe83","\ufe81","\ufe93","\ufeef","\ufbfc","\ufe89","\ufe85","\ufe70","\ufe72","\ufe74","\ufe76","\ufe78","\ufe7a","\ufe7c","\ufe7e","\ufe80","\ufe89","\ufe85"],c=["\ufe8e","\ufe90","\ufe96","\ufe9a","\ufe9e","\ufea2","\ufea6","\ufeaa","\ufeac","\ufeae","\ufeb0","\ufeb2","\ufeb6","\ufeba","\ufebe","\ufec2","\ufec6","\ufeca","\ufece","\ufed2","\ufed6","\ufeda","\ufede","\ufee2","\ufee6","\ufeea","\ufeee","\ufef2","\ufe88","\ufe84","\ufe82","\ufe94","\ufef0","\ufbfd","\ufe8a","\ufe86","\ufe70","\ufe72","\ufe74","\ufe76","\ufe78","\ufe7a","\ufe7c","\ufe7e","\ufe80","\ufe8a","\ufe86"],u=["\ufe8e","\ufe92","\ufe98","\ufe9c","\ufea0","\ufea4","\ufea8","\ufeaa","\ufeac","\ufeae","\ufeb0","\ufeb4","\ufeb8","\ufebc","\ufec0","\ufec4","\ufec8","\ufecc","\ufed0","\ufed4","\ufed8","\ufedc","\ufee0","\ufee4","\ufee8","\ufeec","\ufeee","\ufef4","\ufe88","\ufe84","\ufe82","\ufe94","\ufef0","\ufbff","\ufe8c","\ufe86","\ufe71","\ufe72","\ufe74","\ufe77","\ufe79","\ufe7b","\ufe7d","\ufe7f","\ufe80","\ufe8c","\ufe86"],h=["\ufe8d","\ufe91","\ufe97","\ufe9b","\ufe9f","\ufea3","\ufea7","\ufea9","\ufeab","\ufead","\ufeaf","\ufeb3","\ufeb7","\ufebb","\ufebf","\ufec3","\ufec7","\ufecb","\ufecf","\ufed3","\ufed7","\ufedb","\ufedf","\ufee3","\ufee7","\ufeeb","\ufeed","\ufef3","\ufe87","\ufe83","\ufe81","\ufe93","\ufeef","\ufbfe","\ufe8b","\ufe85","\ufe70","\ufe72","\ufe74","\ufe76","\ufe78","\ufe7a","\ufe7c","\ufe7e","\ufe80","\ufe8b","\ufe85"],d=["\u0621","\u0622","\u0623","\u0624","\u0625","\u0627","\u0629","\u062f","\u0630","\u0631","\u0632","\u0648","\u0649"],p=["\u064b","\u064b","\u064c","\u061f","\u064d","\u061f","\u064e","\u064e","\u064f","\u064f","\u0650","\u0650","\u0651","\u0651","\u0652","\u0652","\u0621","\u0622","\u0622","\u0623","\u0623","\u0624","\u0624","\u0625","\u0625","\u0626","\u0626","\u0626","\u0626","\u0627","\u0627","\u0628","\u0628","\u0628","\u0628","\u0629","\u0629","\u062a","\u062a","\u062a","\u062a","\u062b","\u062b","\u062b","\u062b","\u062c","\u062c","\u062c","\u062c","\u062d","\u062d","\u062d","\u062d","\u062e","\u062e","\u062e","\u062e","\u062f","\u062f","\u0630","\u0630","\u0631","\u0631","\u0632","\u0632","\u0633","\u0633","\u0633","\u0633","\u0634","\u0634","\u0634","\u0634","\u0635","\u0635","\u0635","\u0635","\u0636","\u0636","\u0636","\u0636","\u0637","\u0637","\u0637","\u0637","\u0638","\u0638","\u0638","\u0638","\u0639","\u0639","\u0639","\u0639","\u063a","\u063a","\u063a","\u063a","\u0641","\u0641","\u0641","\u0641","\u0642","\u0642","\u0642","\u0642","\u0643","\u0643","\u0643","\u0643","\u0644","\u0644","\u0644","\u0644","\u0645","\u0645","\u0645","\u0645","\u0646","\u0646","\u0646","\u0646","\u0647","\u0647","\u0647","\u0647","\u0648","\u0648","\u0649","\u0649","\u064a","\u064a","\u064a","\u064a","\ufef5","\ufef6","\ufef7","\ufef8","\ufef9","\ufefa","\ufefb","\ufefc","\u061f","\u061f","\u061f"],f=["\u0621","\u0641"],m=["\u063a","\u064a"],g=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],y=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],_=0,v=1,b=2,w=3,x=4,S=5,T=6,M=7,A=8,C=10,E=11,R=12,P=18,O=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],I=100,L=[I+0,_,_,_,_,I+1,I+2,I+3,v,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,I+4,x,x,x,_,x,_,x,_,x,x,x,_,_,x,x,_,_,_,_,_,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,_,_,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,_,_,_,_,_,_,_,_,_,_,_,_,_,_,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,_,_,x,x,_,_,x,x,_,_,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,_,_,_,I+5,M,M,I+6,I+7],N=[[P,P,P,P,P,P,P,P,P,T,S,T,A,S,P,P,P,P,P,P,P,P,P,P,P,P,P,P,S,S,S,T,A,x,x,E,E,E,x,x,x,x,x,C,9,C,9,9,b,b,b,b,b,b,b,b,b,b,9,x,x,x,x,x,x,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,x,x,x,x,x,x,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,x,x,x,x,P,P,P,P,P,P,S,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,9,x,E,E,E,E,x,x,x,x,_,x,x,P,x,x,E,E,b,b,x,_,x,x,x,b,_,x,x,x,x,x,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,x,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,x,_,_,_,_,_,_,_,_],[_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,x,x,x,x,x,x,x,x,x,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,x,x,_,_,_,_,_,_,_,x,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,x,_,x,x,x,x,x,x,x,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,v,R,v,R,R,v,R,R,v,R,x,x,x,x,x,x,x,x,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,x,x,x,x,x,v,v,v,v,v,x,x,x,x,x,x,x,x,x,x,x],[w,w,w,w,x,x,x,x,M,E,E,M,9,M,x,x,R,R,R,R,R,R,R,R,R,R,R,M,x,x,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,w,w,w,w,w,w,w,w,w,w,E,w,w,M,M,M,R,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,R,R,R,R,R,R,R,w,x,R,R,R,R,R,R,M,M,R,R,x,R,R,R,R,M,M,b,b,b,b,b,b,b,b,b,b,M,M,M,M,M,M],[M,M,M,M,M,M,M,M,M,M,M,M,M,M,x,M,M,R,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,x,x,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,R,R,R,R,R,R,R,R,R,R,R,M,x,x,x,x,x,x,x,x,x,x,x,x,x,x,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,R,R,R,R,R,R,R,R,R,v,v,x,x,x,x,v,x,x,x,x,x],[A,A,A,A,A,A,A,A,A,A,A,P,P,P,_,v,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,A,S,13,14,15,16,17,9,E,E,E,E,E,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,9,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,A,P,P,P,P,P,x,x,x,x,x,P,P,P,P,P,P,b,_,x,x,b,b,b,b,b,b,C,C,x,x,x,_,b,b,b,b,b,b,b,b,b,b,C,C,x,x,x,x,_,_,_,_,_,_,_,_,_,_,_,_,_,x,x,x,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x],[_,_,_,_,_,_,_,x,x,x,x,x,x,x,x,x,x,x,x,_,_,_,_,_,x,x,x,x,x,v,R,v,v,v,v,v,v,v,v,v,v,C,v,v,v,v,v,v,v,v,v,v,v,v,v,x,v,v,v,v,v,x,v,x,v,v,x,v,v,x,v,v,v,v,v,v,v,v,v,v,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M],[R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,R,R,R,R,R,R,R,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,9,x,9,x,x,9,x,x,x,x,x,x,x,x,x,E,x,x,C,C,x,x,x,x,x,E,E,x,x,x,x,x,M,M,M,M,M,x,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,x,x,P],[x,x,x,E,E,E,x,x,x,x,x,C,9,C,9,9,b,b,b,b,b,b,b,b,b,b,9,x,x,x,x,x,x,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,x,x,x,x,x,x,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,x,x,x,x,x,x,x,x,x,x,x,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,x,x,x,_,_,_,_,_,_,x,x,_,_,_,_,_,_,x,x,_,_,_,_,_,_,x,x,_,_,_,x,x,x,E,E,x,x,x,E,E,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x]];class D{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(e,t,r){if(this.sourceToTarget=[],this.targetToSource=[],!e)return"";if(function(e,t,r){ie=[],se=[];for(let i=0;i<r;i++)e[i]=i,t[i]=i,ie[i]=i}(this.sourceToTarget,this.targetToSource,e.length),!this.checkParameters(t,r))return e;t=this.inputFormat,r=this.outputFormat;let i=e;const a=oe,u=Q(t.charAt(1)),d=Q(r.charAt(1)),f=("I"===t.charAt(0)?"L":t.charAt(0))+u,m=("I"===r.charAt(0)?"L":r.charAt(0))+d,g=t.charAt(2)+r.charAt(2);a.defInFormat=f,a.defOutFormat=m,a.defSwap=g;const y=F(e,f,m,g,a);let _=!1;return"R"===r.charAt(1)?_=!0:"C"!==r.charAt(1)&&"D"!==r.charAt(1)||(_="rtl"===this.checkContextual(y)),this.sourceToTarget=ie,this.targetToSource=function(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[e[r]]=r;return t}(this.sourceToTarget),ne=this.targetToSource,i=t.charAt(3)===r.charAt(3)?y:"S"===r.charAt(3)?function(e,t){if(0===t.length)return"";void 0===e&&(e=!0);const r=(t=String(t)).split("");let i=0,n=1,a=r.length;e||(i=r.length-1,n=-1,a=1);const u=function(e,t,r,i){let n=0;const a=[];let u=0;for(let d=t;d*r<i;d+=r)if(H(e[d])||K(e[d])){if("\u0644"===e[d]&&Z(e,d+r,r,i)){e[d]=te(e[d+r],0===n?s:o),d+=r,ee(e,d,r,i),a[u]=d,u++,n=0;continue}const t=e[d];1===n?e[d]=G(e,d+r,r,i)?X(e[d]):J(e[d],c):!0===G(e,d+r,r,i)?e[d]=J(e[d],h):e[d]=J(e[d],l),K(t)||(n=1),!0===Y(t)&&(n=0)}else n=0;return a}(r,i,n,a);let d="";for(let s=0;s<r.length;s++)j(u,u.length,s)>-1?(re(ne,s,!e,-1),ie.splice(s,1)):d+=r[s];return d}(_,y):function(e,t,r){if(0===e.length)return"";void 0===t&&(t=!0);let i="";const s=(e=String(e)).split("");for(let o=0;o<e.length;o++){let a=!1;if(s[o]>="\ufe70"&&s[o]<"\ufeff"){const l=e.charCodeAt(o);s[o]>="\ufef5"&&s[o]<="\ufefc"?(t?(o>0&&r&&" "===s[o-1]?i=i.substring(0,i.length-1)+"\u0644":(i+="\u0644",a=!0),i+=n[(l-65269)/2]):(i+=n[(l-65269)/2],i+="\u0644",o+1<e.length&&r&&" "===s[o+1]?o++:a=!0),a&&(re(ne,o,!0,1),ie.splice(o,0,ie[o]))):i+=p[l-65136]}else i+=s[o]}return i}(y,_,!0),this.sourceToTarget=ie,this.targetToSource=ne,this.levels=se,i}_inputFormatSetter(e){if(!he.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!he.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,t){return e?this._inputFormatSetter(e):e=this.inputFormat,t?this._outputFormatSetter(t):t=this.outputFormat,e!==t}checkContextual(e){let t=k(e);if("ltr"!==t&&"rtl"!==t){try{t=document.dir.toLowerCase()}catch(y){}"ltr"!==t&&"rtl"!==t&&(t="ltr")}return t}hasBidiChar(e){return de.test(e)}}function F(e,t,r,i,n){const s=function(e,t,r){if(void 0===t.inFormat&&(t.inFormat=r.defInFormat),void 0===t.outFormat&&(t.outFormat=r.defOutFormat),void 0===t.swap&&(t.swap=r.defSwap),t.inFormat===t.outFormat)return t;const i=t.inFormat.substring(0,1),n=t.outFormat.substring(0,1);let s,o=t.inFormat.substring(1,4),a=t.outFormat.substring(1,4);return"C"===o.charAt(0)&&(s=k(e),o="ltr"===s||"rtl"===s?s.toUpperCase():"L"===t.inFormat.charAt(2)?"LTR":"RTL",t.inFormat=i+o),"C"===a.charAt(0)&&(s=k(e),"rtl"===s?a="RTL":"ltr"===s?(s=function(e){const t=e.split("");return t.reverse(),k(t.join(""))}(e),a=s.toUpperCase()):a="L"===t.outFormat.charAt(2)?"LTR":"RTL",t.outFormat=n+a),t}(e,{inFormat:t,outFormat:r,swap:i},n);if(s.inFormat===s.outFormat)return e;t=s.inFormat,r=s.outFormat,i=s.swap;const o=t.substring(0,1),a=t.substring(1,4),l=r.substring(0,1),c=r.substring(1,4);if(n.inFormat=t,n.outFormat=r,n.swap=i,"L"===o&&"VLTR"===r){if("LTR"===a)return n.dir=ce,z(e,n);if("RTL"===a)return n.dir=ue,z(e,n)}if("V"===o&&"V"===l)return n.dir="RTL"===a?ue:ce,B(e,n);if("L"===o&&"VRTL"===r)return"LTR"===a?(n.dir=ce,e=z(e,n)):(n.dir=ue,e=z(e,n)),B(e);if("VLTR"===t&&"LLTR"===r)return n.dir=ce,z(e,n);if("V"===o&&"L"===l&&a!==c)return e=B(e),"RTL"===a?F(e,"LLTR","VLTR",i,n):F(e,"LRTL","VRTL",i,n);if("VRTL"===t&&"LRTL"===r)return F(e,"LRTL","VRTL",i,n);if("L"===o&&"L"===l){const t=n.swap;return n.swap=t.substr(0,1)+"N","RTL"===a?(n.dir=ue,e=z(e,n),n.swap="N"+t.substr(1,2),n.dir=ce,e=z(e,n)):(n.dir=ce,e=z(e,n),n.swap="N"+t.substr(1,2),e=F(e,"VLTR","LRTL",n.swap,n)),e}return e}function k(e){const t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(e);return t?t[0]<="z"?"ltr":"rtl":""}function z(e,t){const r=e.split(""),i=[];return U(r,i,t),function(e,t,r){if(0!==r.hiLevel&&r.swap.substr(0,1)!==r.swap.substr(1,2))for(let i=0;i<e.length;i++)1===t[i]&&(e[i]=W(e[i]))}(r,i,t),$(2,r,i,t),$(1,r,i,t),se=i,r.join("")}function U(e,t,r){const i=e.length,n=r.dir?y:g;let s=0,o=-1;const a=[],l=[];r.hiLevel=r.dir,r.lastArabic=!1,r.hasUbatAl=!1,r.hasUbatB=!1,r.hasUbatS=!1;for(let c=0;c<i;c++)a[c]=V(e[c]);for(let c=0;c<i;c++){const i=s,u=q(e,a,l,c,r);l[c]=u,s=n[i][u];const h=240&s;s&=15;const d=n[s][ae];if(t[c]=d,h>0)if(16===h){for(let e=o;e<c;e++)t[e]=1;o=-1}else o=-1;if(n[s][le])-1===o&&(o=c);else if(o>-1){for(let e=o;e<c;e++)t[e]=d;o=-1}a[c]===S&&(t[c]=0),r.hiLevel|=d}r.hasUbatS&&function(e,t,r,i){for(let n=0;n<r;n++)if(e[n]===T){t[n]=i.dir;for(let r=n-1;r>=0&&e[r]===A;r--)t[r]=i.dir}}(a,t,i,r)}function V(e){const t=e.charCodeAt(0),r=L[t>>8];return r<I?r:N[r-I][255&t]}function B(e,t){const r=e.split("");if(t){const e=[];U(r,e,t),se=e}return r.reverse(),ie.reverse(),r.join("")}function j(e,t,r){for(let i=0;i<t;i++)if(e[i]===r)return i;return-1}function H(e){for(let t=0;t<f.length;t++)if(e>=f[t]&&e<=m[t])return!0;return!1}function G(e,t,r,i){for(;t*r<i&&K(e[t]);)t+=r;return!!(t*r<i&&H(e[t]))}function Z(e,t,r,i){for(;t*r<i&&K(e[t]);)t+=r;let s=" ";if(!(t*r<i))return!1;s=e[t];for(let o=0;o<n.length;o++)if(n[o]===s)return!0;return!1}function $(e,t,r,i){if(i.hiLevel<e)return;if(1===e&&i.dir===ue&&!i.hasUbatB)return t.reverse(),void ie.reverse();const n=t.length;let s,o,a,l,c,u=0;for(;u<n;){if(r[u]>=e){for(s=u+1;s<n&&r[s]>=e;)s++;for(o=u,a=s-1;o<a;o++,a--)l=t[o],t[o]=t[a],t[a]=l,c=ie[o],ie[o]=ie[a],ie[a]=c;u=s}u++}}function q(e,t,r,i,n){const s=t[i];return{UBAT_L:()=>(n.lastArabic=!1,_),UBAT_R:()=>(n.lastArabic=!1,v),UBAT_ON:()=>x,UBAT_AN:()=>w,UBAT_EN:()=>n.lastArabic?w:b,UBAT_AL:()=>(n.lastArabic=!0,n.hasUbatAl=!0,v),UBAT_WS:()=>x,UBAT_CS:()=>{let e,s;return i<1||i+1>=t.length||(e=r[i-1])!==b&&e!==w||(s=t[i+1])!==b&&s!==w?x:(n.lastArabic&&(s=w),s===e?s:x)},UBAT_ES:()=>(i>0?r[i-1]:S)===b&&i+1<t.length&&t[i+1]===b?b:x,UBAT_ET:()=>{if(i>0&&r[i-1]===b)return b;if(n.lastArabic)return x;let e=i+1;const s=t.length;for(;e<s&&t[e]===E;)e++;return e<s&&t[e]===b?b:x},UBAT_NSM:()=>{if("VLTR"===n.inFormat){const r=t.length;let n=i+1;for(;n<r&&t[n]===R;)n++;if(n<r){const r=e[i].charCodeAt(0),s=r>=1425&&r<=2303||64286===r,o=t[n];if(s&&(o===v||o===M))return v}}return i<1||t[i-1]===S?x:r[i-1]},UBAT_B:()=>(n.lastArabic=!0,n.hasUbatB=!0,n.dir),UBAT_S:()=>(n.hasUbatS=!0,x),UBAT_LRE:()=>(n.lastArabic=!1,x),UBAT_RLE:()=>(n.lastArabic=!1,x),UBAT_LRO:()=>(n.lastArabic=!1,x),UBAT_RLO:()=>(n.lastArabic=!1,x),UBAT_PDF:()=>(n.lastArabic=!1,x),UBAT_BN:()=>x}[O[s]]()}function W(e){let t,r=0,n=i.length-1;for(;r<=n;)if(t=Math.floor((r+n)/2),e<i[t][0])n=t-1;else{if(!(e>i[t][0]))return i[t][1];r=t+1}return e}function Y(e){for(let t=0;t<d.length;t++)if(d[t]===e)return!0;return!1}function X(e){for(let t=0;t<a.length;t++)if(e===a[t])return u[t];return e}function J(e,t){for(let r=0;r<a.length;r++)if(e===a[r])return t[r];return e}function K(e){return e>="\u064b"&&e<="\u0655"}function Q(e){return"L"===e?"LTR":"R"===e?"RTL":"C"===e?"CLR":"D"===e?"CRL":""}function ee(e,t,r,i){for(;t*r<i&&K(e[t]);)t+=r;return t*r<i&&(e[t]=" ",!0)}function te(e,t){for(let r=0;r<n.length;r++)if(e===n[r])return t[r];return e}function re(e,t,r,i){for(let n=0;n<e.length;n++)(e[n]>t||!r&&e[n]===t)&&(e[n]+=i)}let ie=[],ne=[],se=[];const oe={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},ae=5,le=6,ce=0,ue=1,he=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,de=/[\u0591-\u06ff\ufb1d-\ufefc]/},55877:(e,t,r)=>{"use strict";var i;r.d(t,{u:()=>i}),function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"}(i||(i={}))},69098:(e,t,r)=>{"use strict";r.d(t,{O:()=>u,P:()=>h});var i=r(35143),n=r(91967),s=(r(81806),r(53084)),o=(r(76460),r(30726)),a=r(49140),l=r(39314),c=r(85842);const u=e=>{let t=class extends e{clone(){const e=(0,l.oY)(this);(0,o.Lw)(e,"unable to clone instance of non-accessor class");const t=e.metadata,r=e.store,i={},n=new Map;for(const o in t){const e=t[o],l=r?.originOf(o),c=e.clonable;if(e.readOnly||!1===c||l!==a.Gr.USER&&l!==a.Gr.DEFAULTS&&l!==a.Gr.WEB_MAP&&l!==a.Gr.WEB_SCENE)continue;const u=this[o];let h=null;h="function"==typeof c?c(u):"reference"===c?u:(0,s.TU)(u),null!=u&&null==h||(l===a.Gr.DEFAULTS?n.set(o,h):i[o]=h)}const c=new(0,Object.getPrototypeOf(this).constructor)(i);if(n.size){const e=(0,l.oY)(c)?.store;if(e)for(const[t,r]of n)e.set(t,r,a.Gr.DEFAULTS)}return c}};return t=(0,i._)([(0,c.$)("esri.core.Clonable")],t),t};let h=class extends(u(n.A)){};h=(0,i._)([(0,c.$)("esri.core.Clonable")],h)},19276:(e,t,r)=>{"use strict";r.d(t,{A:()=>O});var i,n=r(35143),s=r(11373),o=r(54099),a=r(54901),l=r(53084),c=r(3789),u=r(44892),h=r(52394),d=r(40565),p=r(99486),f=r(46053),m=r(29101),g=r(85842),y=r(99702);class _{constructor(e,t,r,i,n){this.target=e,this.added=t,this.removed=r,this.start=i,this.deleteCount=n}}const v=new c.A(class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},void 0,(e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}));function b(e){e&&"object"==typeof e&&"destroy"in e&&"function"==typeof e.destroy&&e.destroy()}function w(e){return e?e instanceof P?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function x(e){if(e?.length)return e[0]}function S(e,t,r,i){const n=Math.min(e.length-r,t.length-i);let s=0;for(;s<n&&e[r+s]===t[i+s];)s++;return s}function T(e,t,r,i){t&&t.forEach(((t,n,s)=>{e.push(t),T(e,r.call(i,t,n,s),r,i)}))}const M=new Set,A=new Set,C=new Set,E=new Map;let R=0,P=i=class extends o.A.EventedAccessor{static isCollection(e){return null!=e&&e instanceof i}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new y.I,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:R++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof i?{items:e}:e:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return(0,p.gc)(this._observable),this._items}set items(e){this._emitBeforeChanges(u.R.ADD)||(this._splice(0,this.length,w(e)),this._emitAfterChanges(u.R.ADD))}hasEventListener(e){return!this.destroyed&&("change"===e?this._chgListeners.length>0:this._emitter.hasEventListener(e))}on(e,t){if(this.destroyed)return(0,a.hA)();if("change"===e){const e=this._chgListeners,r={removed:!1,callback:t};return e.push(r),this._notifications&&this._notifications.push({listeners:e.slice(),items:this._items.slice(),changes:[]}),(0,a.hA)((()=>{r.removed=!0,e.splice(e.indexOf(r),1)}))}return this._emitter.on(e,t)}once(e,t){const r="deref"in t?()=>t.deref():()=>t,i=this.on(e,(e=>{r()?.call(null,e),i.remove()}));return i}add(e,t){if((0,p.gc)(this._observable),this._emitBeforeChanges(u.R.ADD))return this;const r=this.getNextIndex(t??null);return this._splice(r,0,[e]),this._emitAfterChanges(u.R.ADD),this}addMany(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._items.length;if((0,p.gc)(this._observable),!e?.length)return this;if(this._emitBeforeChanges(u.R.ADD))return this;const r=this.getNextIndex(t);return this._splice(r,0,w(e)),this._emitAfterChanges(u.R.ADD),this}at(e){if((0,p.gc)(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if((0,p.gc)(this._observable),!this.length||this._emitBeforeChanges(u.R.REMOVE))return[];const e=this._removeAllRaw();return this._emitAfterChanges(u.R.REMOVE),e}_removeAllRaw(){return 0===this.length?[]:this._splice(0,this.length)||[]}clone(){return(0,p.gc)(this._observable),this._createNewInstance({items:this._items.map(l.o8)})}concat(){(0,p.gc)(this._observable);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const i=t.map(w);return this._createNewInstance({items:this._items.concat(...i)})}drain(e,t){if((0,p.gc)(this._observable),!this.length||this._emitBeforeChanges(u.R.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let n=0;n<i;n++)e.call(t,r[n],n,r);this._emitAfterChanges(u.R.REMOVE)}destroyAll(){this.drain(b)}destroyMany(e){const t=this.removeMany(e);return t.forEach(b),t}every(e,t){return(0,p.gc)(this._observable),this._items.every(e,t)}filter(e,t){let r;return(0,p.gc)(this._observable),r=2===arguments.length?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:r})}find(e,t){return(0,p.gc)(this._observable),this._items.find(e,t)}findIndex(e,t){return(0,p.gc)(this._observable),this._items.findIndex(e,t)}flatten(e,t){(0,p.gc)(this._observable);const r=[];return T(r,this,e,t),new i(r)}forEach(e,t){return(0,p.gc)(this._observable),this._items.forEach(e,t)}getItemAt(e){return(0,p.gc)(this._observable),this._items[e]}getNextIndex(e){(0,p.gc)(this._observable);const t=this.length;return(e=e??t)<0?e=0:e>t&&(e=t),e}includes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,p.gc)(this._observable),this._items.includes(e,t)}indexOf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,p.gc)(this._observable),this._items.indexOf(e,t)}join(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:",";return(0,p.gc)(this._observable),this._items.join(e)}lastIndexOf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length-1;return(0,p.gc)(this._observable),this._items.lastIndexOf(e,t)}map(e,t){(0,p.gc)(this._observable);const r=this._items.map(e,t);return new i({items:r})}reorder(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length-1;(0,p.gc)(this._observable);const r=this.indexOf(e);if(-1!==r){if(t<0?t=0:t>=this.length&&(t=this.length-1),r!==t){if(this._emitBeforeChanges(u.R.MOVE))return e;this._splice(r,1),this._splice(t,0,[e]),this._emitAfterChanges(u.R.MOVE)}return e}}pop(){if((0,p.gc)(this._observable),!this.length||this._emitBeforeChanges(u.R.REMOVE))return;const e=x(this._splice(this.length-1,1));return this._emitAfterChanges(u.R.REMOVE),e}push(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,p.gc)(this._observable),this._emitBeforeChanges(u.R.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(u.R.ADD)),this.length}reduce(e,t){(0,p.gc)(this._observable);const r=this._items;return 2===arguments.length?r.reduce(e,t):r.reduce(e)}reduceRight(e,t){(0,p.gc)(this._observable);const r=this._items;return 2===arguments.length?r.reduceRight(e,t):r.reduceRight(e)}remove(e){return(0,p.gc)(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if((0,p.gc)(this._observable),e<0||e>=this.length||this._emitBeforeChanges(u.R.REMOVE))return;const t=x(this._splice(e,1));return this._emitAfterChanges(u.R.REMOVE),t}removeMany(e){if((0,p.gc)(this._observable),!e?.length||this._emitBeforeChanges(u.R.REMOVE))return[];const t=e instanceof i?e.toArray():e,r=this._items,n=[],s=t.length;for(let i=0;i<s;i++){const e=t[i],s=r.indexOf(e);if(s>-1){const e=1+S(t,r,i+1,s+1),o=this._splice(s,e);o&&o.length>0&&n.push.apply(n,o),i+=e-1}}return this._emitAfterChanges(u.R.REMOVE),n}reverse(){if((0,p.gc)(this._observable),this._emitBeforeChanges(u.R.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(u.R.MOVE),this}shift(){if((0,p.gc)(this._observable),!this.length||this._emitBeforeChanges(u.R.REMOVE))return;const e=x(this._splice(0,1));return this._emitAfterChanges(u.R.REMOVE),e}slice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length;return(0,p.gc)(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return(0,p.gc)(this._observable),this._items.some(e,t)}sort(e){if((0,p.gc)(this._observable),!this.length||this._emitBeforeChanges(u.R.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(u.R.MOVE),this}splice(e,t){(0,p.gc)(this._observable);for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];const s=(t?u.R.REMOVE:0)|(i.length?u.R.ADD:0);if(this._emitBeforeChanges(s))return[];const o=this._splice(e,t,i)||[];return this._emitAfterChanges(s),o}toArray(){return(0,p.gc)(this._observable),this._items.slice()}toJSON(){return(0,p.gc)(this._observable),this.toArray()}toLocaleString(){return(0,p.gc)(this._observable),this._items.toLocaleString()}toString(){return(0,p.gc)(this._observable),this._items.toString()}unshift(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,p.gc)(this._observable),!t.length||this._emitBeforeChanges(u.R.ADD)||(this._splice(0,0,t),this._emitAfterChanges(u.R.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,r){const i=this._items,n=this.itemType;let s,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=(0,h._)((()=>this._dispatchChange()))),e<0&&(e+=this.length),t){if(o=i.splice(e,t),this.hasEventListener("before-remove")){const t=v.acquire();t.target=this,t.cancellable=!0;for(let r=0,n=o.length;r<n;r++)s=o[r],t.reset(s),this.emit("before-remove",t),t.defaultPrevented&&(o.splice(r,1),i.splice(e,0,s),e+=1,r-=1,n-=1);v.release(t)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const e=v.acquire();e.target=this,e.cancellable=!1;const t=o.length;for(let r=0;r<t;r++)e.reset(o[r]),this.emit("after-remove",e);v.release(e)}}if(r?.length){if(n){const e=[];for(const t of r){const r=n.ensureType(t);null==r&&null!=t||e.push(r)}r=e}const t=this.hasEventListener("before-add"),s=this.hasEventListener("after-add"),o=e===this.length;if(t||s){const n=v.acquire();n.target=this,n.cancellable=!0;const a=v.acquire();a.target=this,a.cancellable=!1;for(const l of r)t?(n.reset(l),this.emit("before-add",n),n.defaultPrevented||(o?i.push(l):i.splice(e++,0,l),this._set("length",i.length),s&&(a.reset(l),this.emit("after-add",a)))):(o?i.push(l):i.splice(e++,0,l),this._set("length",i.length),a.reset(l),this.emit("after-add",a));v.release(a),v.release(n)}else{if(o)for(const e of r)i.push(e);else i.splice(e,0,...r);this._set("length",i.length)}}if((r?.length||o?.length)&&this._notifyChangeEvent(r,o),this.hasEventListener("after-splice")){const i=new _(this,r,o,e,t);this.emit("after-splice",i)}return o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const r=v.acquire();r.target=this,r.cancellable=!0,r.type=e,this.emit("before-changes",r),t=r.defaultPrevented,v.release(r)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=v.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),v.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const e=t.changes;M.clear(),A.clear(),C.clear();for(const{added:t,removed:s}of e){if(t)if(0===C.size&&0===A.size)for(const e of t)M.add(e);else for(const e of t)A.has(e)?(C.add(e),A.delete(e)):C.has(e)||M.add(e);if(s)if(0===C.size&&0===M.size)for(const e of s)A.add(e);else for(const e of s)M.has(e)?M.delete(e):(C.delete(e),A.add(e))}const r=s.A.acquire();M.forEach((e=>{r.push(e)}));const i=s.A.acquire();A.forEach((e=>{i.push(e)}));const n=this._items,o=t.items,a=s.A.acquire();if(C.forEach((e=>{o.indexOf(e)!==n.indexOf(e)&&a.push(e)})),t.listeners&&(r.length||i.length||a.length)){const e={target:this,added:r,removed:i,moved:a},n=t.listeners.length;for(let r=0;r<n;r++){const i=t.listeners[r];i.removed||i.callback.call(this,e)}}s.A.release(r),s.A.release(i),s.A.release(a)}M.clear(),A.clear(),C.clear()}};P.ofType=e=>{if(!e)return i;if(E.has(e))return E.get(e);let t=null;if("function"==typeof e)t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const i in e.typeMap){const r=e.typeMap[i].prototype.declaredClass;t?t+=` | ${r}`:t=r}let r=class extends i{};return(0,n._)([(0,m.u)({Type:e,ensureType:"function"==typeof e?(0,d.dp)(e):(0,d.aq)(e)})],r.prototype,"itemType",void 0),r=(0,n._)([(0,g.$)(`esri.core.Collection<${t}>`)],r),E.set(e,r),r},(0,n._)([(0,f.MZ)()],P.prototype,"_updating",void 0),(0,n._)([(0,f.MZ)()],P.prototype,"length",void 0),(0,n._)([(0,f.MZ)()],P.prototype,"items",null),(0,n._)([(0,f.MZ)({readOnly:!0})],P.prototype,"updating",null),P=i=(0,n._)([(0,g.$)("esri.core.Collection")],P);const O=P},73763:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i=r(35143),n=r(19276),s=(r(98773),r(50076),r(76460),r(68452),r(49281)),o=r(46053),a=r(85842);let l=class extends n.A{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles((0,s.fm)((()=>this._refresh())))}destroy(){this.getCollections=null}_refresh(){const e=null!=this.getCollections?this.getCollections():null;if(null==e)return void this.removeAll();let t=0;for(const r of e)null!=r&&(t=this._processCollection(t,r));this.splice(t,this.length)}_createNewInstance(e){return new n.A(e)}_processCollection(e,t){if(!t)return e;const r=this.itemFilterFunction??(e=>!!e);for(const i of t)if(i){if(r(i)){const t=this.indexOf(i,e);t>=0?t!==e&&this.reorder(i,e):this.add(i,e),++e}if(this.getChildrenFunction){const t=this.getChildrenFunction(i);if(Array.isArray(t))for(const r of t)e=this._processCollection(e,r);else e=this._processCollection(e,t)}}return e}};(0,i._)([(0,o.MZ)()],l.prototype,"getCollections",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"getChildrenFunction",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"itemFilterFunction",void 0),l=(0,i._)([(0,a.$)("esri.core.CollectionFlattener")],l);const c=l},73582:(e,t,r)=>{"use strict";r.d(t,{hr:()=>n,ie:()=>c,uC:()=>a,wf:()=>l});var i=r(15941);class n{constructor(e,t){this.min=e,this.max=t,this.range=t-e}normalize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return s(this.range,this.min,this.max,e,t,r)}clamp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,i.qE)(e-t,this.min,this.max)+t}monotonic(e,t,r){return e<t?t:t+o(this.range,e-t,r)}minimalMonotonic(e,t,r){return s(this.range,e,e+this.range,t,r)}center(e,t,r){return t=this.monotonic(e,t,r),this.normalize((e+t)/2,r)}diff(e,t,r){return this.monotonic(e,t,r)-e}shortestSignedDiff(e,t){e=this.normalize(e);const r=(t=this.normalize(t))-e,i=t<e?this.minimalMonotonic(e,t)-e:t-this.minimalMonotonic(t,e);return Math.abs(r)<Math.abs(i)?r:i}contains(e,t,r){return t=this.minimalMonotonic(e,t),(r=this.minimalMonotonic(e,r))>e&&r<t}}function s(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return(i-=n)<t?i+=o(e,t-i):i>r&&(i-=o(e,i-r)),s&&i===r&&(i=t),i+n}function o(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Math.ceil((t-r)/e)*e+r}const a=new n(0,2*Math.PI),l=new n(-Math.PI,Math.PI),c=new n(0,360)},50076:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var i=r(53084),n=r(76460),s=r(83113);class o extends s.A{constructor(e,t,r){super(e,t,r)}toJSON(){if(null!=this.details)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,((e,t)=>{if(t&&"object"==typeof t&&"function"==typeof t.toJSON)return t;try{return(0,i.o8)(t)}catch(o){return"[object]"}})))}}catch(e){throw n.A.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new o(e.name,e.message,e.details)}}o.prototype.type="error"},54099:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var i=r(35143),n=r(91967),s=r(54901),o=r(85842);class a{constructor(){this._emitter=new a.EventEmitter(this)}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}}!function(e){class t{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._target=e,this._listenersMap=null}clear(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clear()}emit(e,t){let r=this._listenersMap?.get(e);if(!r)return!1;const i=this._target||this;let n=!1;for(const s of r.slice()){const e="deref"in s?s.deref():s;e?e?.call(i,t):n=!0}return n&&(r=r.filter((e=>!("deref"in e)||null!=e.deref())),this._listenersMap.set(e,r)),r.length>0}on(e,t){if(Array.isArray(e)){const r=e.map((e=>this.on(e,t)));return(0,s.vE)(r)}if(e.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??=new Map;const r=this._listenersMap.get(e)||[];return r.push(t),this._listenersMap.set(e,r),(0,s.hA)((()=>{const r=this._listenersMap?.get(e),i=r?.indexOf(t)??-1;i>=0&&r.splice(i,1)}))}once(e,t){const r=this.on(e,(e=>{r.remove();const i="deref"in t?t.deref():t;i?.call(null,e)}));return r}hasEventListener(e){const t=this._listenersMap?.get(e);return null!=t&&t.length>0}}e.EventEmitter=t,e.EventedMixin=e=>{let r=class extends e{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}};return r=(0,i._)([(0,o.$)("esri.core.Evented")],r),r};let r=class extends n.A{constructor(){super(...arguments),this._emitter=new a.EventEmitter(this)}destroy(){this._emitter.clear()}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}};r=(0,i._)([(0,o.$)("esri.core.Evented.EventedAccessor")],r),e.EventedAccessor=r}(a||(a={}));const l=a},88321:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var i=r(85361);class n{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach((t=>{e+=t.length})),e}add(e,t){if((0,i.xZ)(e)){const r=this._getOrCreateGroup(t);for(const t of e)a(t)&&r.push(t)}else a(e)&&this._getOrCreateGroup(t).push(e);return this}forEach(e,t){if("function"==typeof e)this._groups.forEach((t=>t.forEach(e)));else{const r=this._getGroup(e);r&&t&&r.forEach(t)}}has(e){return this._groups.has(s(e))}remove(e){if("string"!=typeof e&&(0,i.xZ)(e)){for(const t of e)this.remove(t);return this}return this.has(e)?(o(this._getGroup(e)),this._groups.delete(s(e)),this):this}removeAll(){return this._groups.forEach(o),this._groups.clear(),this}removeReference(e){return this._groups.delete(e),this}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(s(e),t),t}_getGroup(e){return this._groups.get(s(e))}}function s(e){return e||"_default_"}function o(e){for(const t of e)t instanceof n?t.removeAll():t.remove()}function a(e){return null!=e&&(!!e.remove||e instanceof n)}},5632:(e,t,r)=>{"use strict";r.d(t,{LJ:()=>l,PH:()=>a,sA:()=>o});var i=r(35143),n=r(85842);let s=0;const o=e=>{let t=class extends e{constructor(){super(...arguments),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+s++})}};return t=(0,i._)([(0,n.$)("esri.core.Identifiable")],t),t},a=e=>{let t=class extends e{constructor(){super(...arguments),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:s++})}};return t=(0,i._)([(0,n.$)("esri.core.Identifiable.NumericIdentifiable")],t),t};let l=class extends(o(class{})){};l=(0,i._)([(0,n.$)("esri.core.Identifiable")],l)},42553:(e,t,r)=>{"use strict";r.d(t,{oY:()=>y,Te:()=>f,Wj:()=>g});var i=r(35143),n=r(91967),s=r(53084),o=r(49140);class a{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const t=new a;return this._values.forEach(((r,i)=>{e&&e.has(i)||t.set(i,(0,s.o8)(r.value),r.origin)})),t}get(e,t){t=this._normalizeOrigin(t);const r=this._values.get(e);return null==t||r?.origin===t?r?.value:void 0}originOf(e){return this._values.get(e)?.origin??o.Gr.USER}keys(e){e=this._normalizeOrigin(e);const t=[...this._values.keys()];return null==e?t:t.filter((t=>this._values.get(t)?.origin===e))}set(e,t,r){if((r=this._normalizeOrigin(r))===o.Gr.DEFAULTS){const t=this._values.get(e);if(null!=t?.origin&&t.origin>r)return}this._values.set(e,new l(t,r))}delete(e,t){null!=(t=this._normalizeOrigin(t))&&this._values.get(e)?.origin!==t||this._values.delete(e)}has(e,t){return null!=(t=this._normalizeOrigin(t))?this._values.get(e)?.origin===t:this._values.has(e)}forEach(e){this._values.forEach(((t,r)=>{let{value:i}=t;return e(i,r)}))}_normalizeOrigin(e){if(null!=e)return e===o.Gr.DEFAULTS?e:o.Gr.USER}}class l{constructor(e,t){this.value=e,this.origin=t}}var c=r(60351),u=r(6527),h=r(39314),d=r(29584),p=r(85842);const f=e=>{let t=class extends e{constructor(){super(...arguments);const e=(0,h.oY)(this),t=e.store,r=new a;e.store=r,(0,c.k)(e,t,r)}read(e,t){(0,u.L)(this,e,t)}write(e,t){return(0,d.M)(this,e??{},t)}toJSON(e){return this.write({},e)}static fromJSON(e,t){return m.call(this,e,t)}};return t=(0,i._)([(0,p.$)("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function m(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(e,t),r}function g(e){return e&&"object"==typeof e&&"toJSON"in e&&"function"==typeof e.toJSON}let y=class extends(f(n.A)){};y=(0,i._)([(0,p.$)("esri.core.JSONSupport")],y)},53521:(e,t,r)=>{"use strict";r.d(t,{q:()=>n});var i=r(79369);class n{constructor(e,t){this._storage=new i.F,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},49304:(e,t,r)=>{"use strict";r.d(t,{A:()=>f});var i=r(35143),n=r(50076),s=r(30726),o=r(91291),a=r(50346),l=r(62754),c=r(46053),u=r(85842);const h="loaded",d=e=>{let t=class extends e{constructor(){super(...arguments),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise((e=>{const t=this.load.bind(this);this.load=r=>{const i=new Promise(((e,t)=>{const i=(0,a.NY)(r,t);this.destroyed&&t(new n.A("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(e,t).finally((()=>{i&&i.remove()}))}));if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const e=this._loadController=new AbortController;t({signal:e.signal})}return e(),i}}))),this.when((()=>{this._set("loadStatus",h),this._loadController=null}),(e=>{this._set("loadStatus","failed"),this._set("loadError",e),this._loadController=null}))}destroy(){this._loadController&&(this._loadController=(0,s.DC)(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===h}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new n.A("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return(0,i._)([(0,c.MZ)({readOnly:!0})],t.prototype,"loaded",null),(0,i._)([(0,c.MZ)({readOnly:!0})],t.prototype,"loadError",void 0),(0,i._)([(0,c.MZ)({clonable:!1})],t.prototype,"loadStatus",void 0),(0,i._)([(0,c.MZ)({type:[l.A],readOnly:!0})],t.prototype,"loadWarnings",null),t=(0,i._)([(0,u.$)("esri.core.Loadable")],t),t};let p=class extends(d(o.Z)){};p=(0,i._)([(0,u.$)("esri.core.Loadable")],p),function(e){e.LoadableMixin=d,e.isLoadable=function(e){return!(!e||!e.load)}}(p||(p={}));const f=p},76460:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var i=r(86560),n=(r(81806),r(88685));const s={info:0,warn:1,error:2,none:3};class o{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},null!=e.level&&(this.level=e.level),null!=e.writer&&(this.writer=e.writer),this._module=e.module,o._loggers.set(this.module,this);const t=this.module.lastIndexOf(".");-1!==t&&(this._parent=o.getLogger(this.module.slice(0,t)))}get module(){return this._module}get parent(){return this._parent}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._log("error","always",...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._log("warn","always",...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._log("info","always",...t)}errorOnce(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._log("error","once",...t)}warnOnce(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._log("warn","once",...t)}infoOnce(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._log("info","once",...t)}errorOncePerTick(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._log("error","oncePerTick",...t)}warnOncePerTick(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._log("warn","oncePerTick",...t)}infoOncePerTick(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._log("info","oncePerTick",...t)}get test(){}static get test(){}static getLogger(e){return e="string"!=typeof e?e.declaredClass:e,o._loggers.get(e)||new o({module:e})}_log(e,t){if(this._matchLevel(e)){for(var r=arguments.length,s=new Array(r>2?r-2:0),a=2;a<r;a++)s[a-2]=arguments[a];if("always"!==t&&!o._throttlingDisabled){const r=function(){const e=(e,t)=>"object"!=typeof t||Array.isArray(t)?t:"[Object]";for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(0,n.Wm)(JSON.stringify(r,e))}(s),i=this._loggedMessages[e].get(r);if("once"===t&&null!=i||"oncePerTick"===t&&i&&i>=o._tickCounter)return;this._loggedMessages[e].set(r,o._tickCounter),o._scheduleTickCounterIncrement()}for(const t of i.A.log.interceptors)if(t(e,this.module,...s))return;this._inheritedWriter()(e,this.module,...s)}}_parentWithMember(e,t){let r=this;for(;null!=r;){const t=r[e];if(null!=t)return t;r=r.parent}return t}_inheritedWriter(){return this._parentWithMember("writer",a)}_matchLevel(e){const t=i.A.log.level||"warn";return s[this._parentWithMember("level",t)]<=s[e]}static _scheduleTickCounterIncrement(){o._tickCounterScheduled||(o._tickCounterScheduled=!0,Promise.resolve().then((()=>{o._tickCounter++,o._tickCounterScheduled=!1})))}}function a(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];console[e](`[${t}]`,...i)}o._loggers=new Map,o._tickCounter=0,o._tickCounterScheduled=!1,o._throttlingDisabled=!1},53514:(e,t,r)=>{"use strict";r.d(t,{T:()=>i,d:()=>m});const i={Base64:0,Hex:1,String:2,Raw:3},n=8,s=(1<<n)-1;function o(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function a(e){const t=[];for(let r=0,i=e.length*n;r<i;r+=n)t[r>>5]|=(e.charCodeAt(r/n)&s)<<r%32;return t}function l(e){const t=[];for(let r=0,i=32*e.length;r<i;r+=n)t.push(String.fromCharCode(e[r>>5]>>>r%32&s));return t.join("")}function c(e,t,r,i,n,s){return o(function(e,t){return e<<t|e>>>32-t}(o(o(t,e),o(i,s)),n),r)}function u(e,t,r,i,n,s,o){return c(t&r|~t&i,e,t,n,s,o)}function h(e,t,r,i,n,s,o){return c(t&i|r&~i,e,t,n,s,o)}function d(e,t,r,i,n,s,o){return c(t^r^i,e,t,n,s,o)}function p(e,t,r,i,n,s,o){return c(r^(t|~i),e,t,n,s,o)}function f(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let r=1732584193,i=-271733879,n=-1732584194,s=271733878;for(let a=0;a<e.length;a+=16){const t=r,l=i,c=n,f=s;r=u(r,i,n,s,e[a],7,-680876936),s=u(s,r,i,n,e[a+1],12,-389564586),n=u(n,s,r,i,e[a+2],17,606105819),i=u(i,n,s,r,e[a+3],22,-1044525330),r=u(r,i,n,s,e[a+4],7,-176418897),s=u(s,r,i,n,e[a+5],12,1200080426),n=u(n,s,r,i,e[a+6],17,-1473231341),i=u(i,n,s,r,e[a+7],22,-45705983),r=u(r,i,n,s,e[a+8],7,1770035416),s=u(s,r,i,n,e[a+9],12,-1958414417),n=u(n,s,r,i,e[a+10],17,-42063),i=u(i,n,s,r,e[a+11],22,-1990404162),r=u(r,i,n,s,e[a+12],7,1804603682),s=u(s,r,i,n,e[a+13],12,-40341101),n=u(n,s,r,i,e[a+14],17,-1502002290),i=u(i,n,s,r,e[a+15],22,1236535329),r=h(r,i,n,s,e[a+1],5,-165796510),s=h(s,r,i,n,e[a+6],9,-1069501632),n=h(n,s,r,i,e[a+11],14,643717713),i=h(i,n,s,r,e[a],20,-373897302),r=h(r,i,n,s,e[a+5],5,-701558691),s=h(s,r,i,n,e[a+10],9,38016083),n=h(n,s,r,i,e[a+15],14,-660478335),i=h(i,n,s,r,e[a+4],20,-405537848),r=h(r,i,n,s,e[a+9],5,568446438),s=h(s,r,i,n,e[a+14],9,-1019803690),n=h(n,s,r,i,e[a+3],14,-187363961),i=h(i,n,s,r,e[a+8],20,1163531501),r=h(r,i,n,s,e[a+13],5,-1444681467),s=h(s,r,i,n,e[a+2],9,-51403784),n=h(n,s,r,i,e[a+7],14,1735328473),i=h(i,n,s,r,e[a+12],20,-1926607734),r=d(r,i,n,s,e[a+5],4,-378558),s=d(s,r,i,n,e[a+8],11,-2022574463),n=d(n,s,r,i,e[a+11],16,1839030562),i=d(i,n,s,r,e[a+14],23,-35309556),r=d(r,i,n,s,e[a+1],4,-1530992060),s=d(s,r,i,n,e[a+4],11,1272893353),n=d(n,s,r,i,e[a+7],16,-155497632),i=d(i,n,s,r,e[a+10],23,-1094730640),r=d(r,i,n,s,e[a+13],4,681279174),s=d(s,r,i,n,e[a],11,-358537222),n=d(n,s,r,i,e[a+3],16,-722521979),i=d(i,n,s,r,e[a+6],23,76029189),r=d(r,i,n,s,e[a+9],4,-640364487),s=d(s,r,i,n,e[a+12],11,-421815835),n=d(n,s,r,i,e[a+15],16,530742520),i=d(i,n,s,r,e[a+2],23,-995338651),r=p(r,i,n,s,e[a],6,-198630844),s=p(s,r,i,n,e[a+7],10,1126891415),n=p(n,s,r,i,e[a+14],15,-1416354905),i=p(i,n,s,r,e[a+5],21,-57434055),r=p(r,i,n,s,e[a+12],6,1700485571),s=p(s,r,i,n,e[a+3],10,-1894986606),n=p(n,s,r,i,e[a+10],15,-1051523),i=p(i,n,s,r,e[a+1],21,-2054922799),r=p(r,i,n,s,e[a+8],6,1873313359),s=p(s,r,i,n,e[a+15],10,-30611744),n=p(n,s,r,i,e[a+6],15,-1560198380),i=p(i,n,s,r,e[a+13],21,1309151649),r=p(r,i,n,s,e[a+4],6,-145523070),s=p(s,r,i,n,e[a+11],10,-1120210379),n=p(n,s,r,i,e[a+2],15,718787259),i=p(i,n,s,r,e[a+9],21,-343485551),r=o(r,t),i=o(i,l),n=o(n,c),s=o(s,f)}return[r,i,n,s]}function m(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.Hex)||i.Base64,r=f(a(e),e.length*n);switch(t){case i.Raw:return r;case i.Hex:return function(e){const t="0123456789abcdef",r=[];for(let i=0,n=4*e.length;i<n;i++)r.push(t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15));return r.join("")}(r);case i.String:return l(r);case i.Base64:return function(e){const t=[];for(let r=0,i=4*e.length;r<i;r+=3){const i=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255;for(let n=0;n<4;n++)8*r+6*n>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>6*(3-n)&63))}return t.join("")}(r)}}},87663:(e,t,r)=>{"use strict";function i(e,t){for(const[r,i]of e)if(t(i,r))return!0;return!1}function n(e,t){for(const[r,i]of e)if(t(i,r))return i;return null}function s(e,t,r){const i=e.get(t);if(void 0!==i)return i;const n=r();return e.set(t,n),n}function o(e){const t=new Map;return r=>(t.has(r)||t.set(r,e(r)),t.get(r))}r.d(t,{$n:()=>n,Bj:()=>o,Bs:()=>i,tE:()=>s})},79369:(e,t,r)=>{"use strict";r.d(t,{Cn:()=>s,F:()=>l,Mn:()=>a,Ti:()=>n,k2:()=>o});var i=r(30015);const n=-3,s=n-1;var o;!function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"}(o||(o={}));class a{constructor(e,t,r){this.name=e,this._storage=t,this.id=c+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),r&&(this._storage.registerRemoveFunc(this.id,r),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._storage.put(this,e,t,r,i)}pop(e){const t=this._storage.pop(this,e);return void 0===t?++this._miss:++this._hit,t}get(e){const t=this._storage.get(this,e);return void 0===t?++this._miss:++this._hit,t}peek(e){return this._storage.peek(this,e)}updateSize(e,t,r){this._storage.updateSize(this,e,t,r)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class l{get size(){return this._size}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10485760;this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new i.A,this._users=new i.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const r=this._db.get(e.id+t);return r?.size??0}put(e,t,r,i,a){t=e.id+t;const l=this._db.get(t);if(l&&(this._size-=l.size,e.size-=l.size,this._db.delete(t),l.entry!==r&&this._notifyRemove(t,l.entry,l.size,o.ALL)),i>this._maxSize)return void this._notifyRemove(t,r,i,o.ALL);if(void 0===r)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return console.warn(`Refusing to cache entry with size ${i} for key ${t}`),void this._notifyRemove(t,r,0,o.ALL);const c=1+Math.max(a,s)-n;this._db.set(t,new u(r,i,c)),this._size+=i,e.size+=i,this._checkSize()}updateSize(e,t,r,i){t=e.id+t;const n=this._db.get(t);if(n&&n.entry===r){for(this._size-=n.size,e.size-=n.size;i>this._maxSize;){const e=this._notifyRemove(t,r,i,o.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);i=e}n.size=i,this._size+=i,e.size+=i,this._checkSize()}}pop(e,t){t=e.id+t;const r=this._db.get(t);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(e,t){t=e.id+t;const r=this._db.get(t);if(void 0!==r)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}peek(e,t){const r=this._db.get(e.id+t);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach(((e,i)=>{const n=e.lifetime;r[n]=(r[n]||0)+e.size,this._users.forAll((r=>{const{id:n,name:s}=r;if(i.startsWith(n)){const r=t[s]||0;t[s]=r+e.size}}))}));const i={};this._users.forAll((e=>{const r=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const n=t[r]||0;t[r]=n,i[r]=Math.round(100*e.hitRate)+"%"}else i[r]="0%"}));const s=Object.keys(t);s.sort(((e,r)=>t[r]-t[e])),s.forEach((r=>e[r]=Math.round(t[r]/2**20)+"MB / "+i[r]));for(let o=r.length-1;o>=0;--o){const t=r[o];t&&(e["Priority "+(o+n-1)]=Math.round(t/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,r)=>{r.startsWith(t)&&(this._size-=e.size,this._db.delete(r),this._notifyRemove(r,e.entry,e.size,o.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,o.ALL))),this._users.forAll((e=>e.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,r,i){let n;return this._removeFuncs.some((s=>{if(e.startsWith(s[0])){const e=s[1](t,i,r);return"number"==typeof e&&(n=e),!0}return!1})),n}_checkSize(){this._users.forAll((e=>this._checkSizeLimits(e))),this._checkSizeLimits()}_checkSizeLimits(e){const t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;const r=e?.id;let i=!0;for(;i;){i=!1;for(const[n,s]of this._db)if(0===s.lifetime&&(!r||n.startsWith(r))){if(this._purgeItem(n,s,e),t.size<=.9*t.maxSize)return;i||=this._db.has(n)}}for(const[n,s]of this._db)if((!r||n.startsWith(r))&&(this._purgeItem(n,s,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._users.find((t=>e.startsWith(t.id)));if(this._db.delete(e),t.lives<=1){this._size-=t.size,r&&(r.size-=t.size);const i=this._notifyRemove(e,t.entry,t.size,o.SOME);null!=i&&i>0&&(this._size+=i,r&&(r.size+=i),t.lives=t.lifetime,t.size=i,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}let c=0;class u{constructor(e,t,r){this.entry=e,this.size=t,this.lifetime=r,this.lives=r}}},23859:(e,t,r)=>{"use strict";r.d(t,{I:()=>n});var i=r(79369);class n{constructor(e,t){this._cache=e(t,((e,t,r)=>{switch(t){case i.k2.ALL:return e.forEach((e=>e.dispose())),0;case i.k2.SOME:{const t=e.shift();return t&&(r-=Math.round(t.usedMemory),t.dispose()),r}}}))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const t=this._cache.peek(e);if(!t)return;const r=t.pop();if(t.length>0){if(r){const i=this._cache.getSize(e)-Math.round(r.usedMemory);this._cache.updateSize(e,t,i)}}else this._cache.pop(e);return r}put(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.Cn;const n=this._cache.peek(e);if(!n)return void this._cache.put(e,[t],t.usedMemory,r);n.push(t);const s=this._cache.getSize(e)+Math.round(t.usedMemory);this._cache.updateSize(e,n,s)}}},83113:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var i=r(48611);class n{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.name=e,this.details=r,this.message=(t&&function(e,t){return e.replaceAll(/\$\{([^\s:}]*)(?::([^\s:}]+))?\}/g,((e,r)=>""===r?"$":((0,i.wc)(r,t)??"").toString()))}(t,r))??""}toString(){return"["+this.name+"]: "+this.message}}},77717:(e,t,r)=>{"use strict";r.d(t,{P:()=>v,L:()=>b});var i=r(35143),n=r(91967),s=r(60351),o=r(53084),a=r(49140);class l{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(a.AU),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const t=new l,r=this._originStores[a.Gr.DEFAULTS];r&&r.forEach(((e,r)=>{t.set(r,(0,o.o8)(e),a.Gr.DEFAULTS)}));for(let i=a.Gr.SERVICE;i<a.AU;i++){const r=this._originStores[i];r&&r.forEach(((r,n)=>{e&&e.has(n)||t.set(n,(0,o.o8)(r),i)}))}return t}get(e,t){const r=void 0===t?this._values:this._originStores[t];return r?r.get(e):void 0}keys(e){const t=null==e?this._values:this._originStores[e];return t?[...t.keys()]:[]}set(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.Gr.USER,i=this._originStores[r];if(i||(i=new Map,this._originStores[r]=i),i.set(e,t),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const i=this._values.get(e);return this._values.set(e,t),this._propertyOriginMap.set(e,r),i!==t}return!1}delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Gr.USER;const r=this._originStores[t];if(!r)return;const i=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===t){this._values.delete(e);for(let r=t-1;r>=0;r--){const t=this._originStores[r];if(t&&t.has(e)){this._values.set(e,t.get(e)),this._propertyOriginMap.set(e,r);break}}}return i}has(e,t){const r=void 0===t?this._values:this._originStores[t];return!!r&&r.has(e)}revert(e,t){for(;t>0&&!this.has(e,t);)--t;const r=this._originStores[t],i=r?.get(e),n=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,t),n!==i}originOf(e){return this._propertyOriginMap.get(e)||a.Gr.DEFAULTS}forEach(e){this._values.forEach(e)}}var c=r(6527),u=r(39314),h=r(85842);const d=e=>{let t=class extends e{constructor(){super(...arguments);const e=(0,u.oY)(this),t=e.store,r=new l;e.store=r,(0,s.k)(e,t,r)}read(e,t){(0,c.L)(this,e,t)}getAtOrigin(e,t){const r=p(this),i=(0,a.aB)(t);if("string"==typeof e)return r.get(e,i);const n={};return e.forEach((e=>{n[e]=r.get(e,i)})),n}originOf(e){return(0,a.OL)(this.originIdOf(e))}originIdOf(e){return p(this).originOf(e)}revert(e,t){const r=p(this),i=(0,a.aB)(t),n=(0,u.oY)(this);let s;s="string"==typeof e?"*"===e?r.keys(i):[e]:e,s.forEach((e=>{n.invalidate(e),r.revert(e,i),n.commit(e)}))}};return t=(0,i._)([(0,h.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function p(e){return(0,u.oY)(e).store}let f=class extends(d(n.A)){};f=(0,i._)([(0,h.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],f);var m=r(17879),g=r(29584);const y=e=>{let t=class extends e{constructor(){super(...arguments)}clear(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"user";return _(this).delete(e,(0,a.aB)(t))}write(e,t){return(0,g.M)(this,e=e||{},t),e}setAtOrigin(e,t,r){(0,u.oY)(this).setAtOrigin(e,t,(0,a.aB)(r))}removeOrigin(e){const t=_(this),r=(0,a.aB)(e),i=t.keys(r);for(const n of i)t.originOf(n)===r&&t.set(n,t.get(n,r),a.Gr.USER)}updateOrigin(e,t){const r=_(this),i=(0,a.aB)(t),n=(0,m.Jt)(this,e);for(let s=i+1;s<a.AU;++s)r.delete(e,s);r.set(e,n,i)}toJSON(e){return this.write({},e)}};return t=(0,i._)([(0,h.$)("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function _(e){return(0,u.oY)(e).store}const v=e=>{let t=class extends(y(d(e))){constructor(){super(...arguments)}};return t=(0,i._)([(0,h.$)("esri.core.MultiOriginJSONSupport")],t),t};let b=class extends(v(n.A)){};b=(0,i._)([(0,h.$)("esri.core.MultiOriginJSONSupport")],b)},75941:(e,t,r)=>{"use strict";r.d(t,{O:()=>i});class i{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){return this._outer.get(e)?.get(t)}set(e,t,r){const i=this._outer.get(e);i?i.set(t,r):this._outer.set(e,new Map([[t,r]]))}delete(e,t){const r=this._outer.get(e);r&&(r.delete(t),0===r.size&&this._outer.delete(e))}forEach(e){this._outer.forEach(((t,r)=>e(t,r)))}}},3789:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});class i{constructor(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(this._ctor=e,this._acquireFunction=t,this._releaseFunction=r,this.allocationSize=i,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let s=0;s<n;s++)this._pool[s]=new this._ctor;this.allocationSize=Math.max(i,1)}destroy(){this.prune(0)}acquire(){let e;if(i.test.disabled)e=new this._ctor;else{if(0===this._pool.length){const e=this.allocationSize;for(let t=0;t<e;t++)this._pool[t]=new this._ctor}e=this._pool.pop()}for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this._acquireFunction?this._acquireFunction(e,...r):function(e){return e?.acquire&&"function"==typeof e.acquire}(e)&&e.acquire(...r),e}release(e){e&&!i.test.disabled&&(this._releaseFunction?this._releaseFunction(e):function(e){return e?.release&&"function"==typeof e.release}(e)&&e.release(),this._pool.push(e))}prune(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._initialSize;if(!(e>=this._pool.length)){for(let t=e;t<this._pool.length;++t){const e=this._pool[t];this._dispose(e)}this._pool.length=e}}_dispose(e){e.dispose&&"function"==typeof e.dispose&&e.dispose()}}i.test={disabled:!1}},97467:(e,t,r)=>{"use strict";r.d(t,{I:()=>n});var i=r(77944);class n{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&(0,i.d)((()=>this._reset())),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*s);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,s));e++)this._items.push(this._allocator())}}const s=1024},44892:(e,t,r)=>{"use strict";var i;r.d(t,{R:()=>i}),function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"}(i||(i={}))},32634:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});class i{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;this.name=e,this._counter=0,this._samples=new Array(t)}record(e){null!=e&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort(((e,t)=>e-t))[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce(((e,t)=>e+t),0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}}},30015:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var i,n=r(18690);!function(e){const t=(e,t,r,i)=>{let n=t,s=t;const o=r>>>1,a=e[n-1];for(;s<=o;){s=n<<1,s<r&&i(e[s-1],e[s])<0&&++s;const t=e[s-1];if(i(t,a)<=0)break;e[n-1]=t,n=s}e[n-1]=a},r=(e,t)=>e<t?-1:e>t?1:0;e.sort=function(e,i,n,s){void 0===i&&(i=0),void 0===n&&(n=e.length),void 0===s&&(s=r);for(let r=n>>>1;r>i;r--)t(e,r,n,s);const o=i+1;for(let r=n-1;r>i;r--){const n=e[i];e[i]=e[r],e[r]=n,t(e,o,r,s)}},e.iterableSort=function*(e,i,n,s){void 0===i&&(i=0),void 0===n&&(n=e.length),void 0===s&&(s=r);for(let r=n>>>1;r>i;r--)t(e,r,n,s),yield;const o=i+1;for(let r=n-1;r>i;r--){const n=e[i];e[i]=e[r],e[r]=n,t(e,o,r,s),yield}}}(i||(i={}));const s=i;class o{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new n.vW,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),void 0!==e.deallocator&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>a(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const t=new Array;for(let r=0;r<this._length;r++){const i=this.data[r];e(i)&&t.push(i)}return t}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,t){const r=this.data.indexOf(e,t);return-1!==r&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let t=e;t<this._length;++t)this.data[t]=this._deallocator(this.data[t]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;for(let r=0;r<t;r++)this.data[this._length++]=e[r]}fill(e,t){for(let r=0;r<t;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,a(this)}pop(){if(0===this.length)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const t=(0,n.qh)(this.data,e,this.length,this._hint);if(-1!==t)return this.data.splice(t,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex((0,n.qh)(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,r=arguments.length>2?arguments[2]:void 0;this.length=(0,n.mW)(this.data,e,this.length,t,this._hint,r),this._shrink()}front(){if(0!==this.length)return this.data[0]}back(){if(0!==this.length)return this.data[this.length-1]}swapElements(e,t){if(e>=this.length||t>=this.length||e===t)return;const r=this.data[e];this.data[e]=this.data[t],this.data[t]=r}sort(e){s.sort(this.data,0,this.length,e)}iterableSort(e){return s.iterableSort(this.data,0,this.length,e)}some(e,t){for(let r=0;r<this.length;++r)if(e.call(t,this.data[r],r,this.data))return!0;return!1}find(e,t){for(let r=0;r<this.length;++r){const i=this.data[r];if(e.call(t,i,r))return i}}filterInPlace(e,t){let r=0;for(let i=0;i<this._length;++i){const n=this.data[i];e.call(t,n,i,this.data)&&(this.data[i]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let i=r;i<this._length;i++)this.data[i]=this._deallocator(this.data[i]);return this._length=r,this._shrink(),this}forAll(e,t){const{data:r,length:i}=this;for(let n=0;n<i;++n)e.call(t,r[n],n,r)}forEach(e,t){this.data.slice(0,this.length).forEach(e,t)}map(e,t){const r=new Array(this.length);for(let i=0;i<this.length;++i)r[i]=e.call(t,this.data[i],i,this.data);return r}reduce(e,t){let r=t;for(let i=0;i<this.length;++i)r=e(r,this.data[i],i,this.data);return r}has(e){const t=this.length,r=this.data;for(let i=0;i<t;++i)if(r[i]===e)return!0;return!1}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.data[e]}}function a(e){e.data.length>1.5*e.length&&(e.data.length=Math.floor(1.1*e.length))}},91291:(e,t,r)=>{"use strict";r.d(t,{Z:()=>u,g:()=>c});var i,n=r(35143),s=r(91967),o=r(50346),a=r(85842);!function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"}(i||(i={}));class l{constructor(){this._resolver=(0,o.Tw)(),this._status=i.PENDING,this._resolvingPromises=[],this._resolver.promise.then((()=>{this._status=i.RESOLVED,this._cleanUp()}),(()=>{this._status=i.REJECTED,this._cleanUp()})),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===i.RESOLVED}isRejected(){return this._status===i.REJECTED}isFulfilled(){return this._status!==i.PENDING}abort(){this._resolver.reject((0,o.NK)())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=(0,o.Tw)(),t=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(t);r.then((()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()}),(e=>{this.isFulfilled()||this._allPromise!==r||(0,o.zf)(e)||this._resolver.reject(e)})),e.resolve()}}const c=e=>{let t=class extends e{constructor(){super(...arguments),this._promiseProps=new l,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(e,t){return this._promiseProps.promise.then((()=>this)).then(e,t)}catch(e){return this.when(null,e)}addResolvingPromise(e){e&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in e?e.when():e)}};return t=(0,n._)([(0,a.$)("esri.core.Promise")],t),t};let u=class extends(c(s.A)){};u=(0,n._)([(0,a.$)("esri.core.Promise")],u)},59649:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var i=r(99486),n=r(99702);class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>e.values().next().value;this._peeker=e,this._observable=new n.I,this._items=new Set}get length(){return(0,i.gc)(this._observable),this._items.size}clear(){0!==this.length&&(this._items.clear(),this._observable.notify())}last(){if(0===this.length)return;let e;for(e of this._items);return e}peek(){if(0!==this.length)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return(0,i.gc)(this._observable),this._items.has(e)}pop(){if(0===this.length)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(0===this.length)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const t=this.length;return this._items.forEach((t=>{e(t)||this._items.delete(t)})),t!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){(0,i.gc)(this._observable),yield*this._items}}},47249:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});class i{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._seed=e}set seed(e){this._seed=e??Math.random()*i._m}getInt(){return this._seed=(i._a*this._seed+i._c)%i._m,this._seed}getFloat(){return this.getInt()/(i._m-1)}getIntRange(e,t){return Math.round(this.getFloatRange(e,t))}getFloatRange(e,t){const r=t-e;return e+this.getInt()/i._m*r}}i._m=2147483647,i._a=48271,i._c=0},67993:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var i=r(99486),n=r(99702);class s{constructor(e){this._observable=new n.I,this._map=new Map(e)}get size(){return(0,i.gc)(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const t=this._map.delete(e);return t&&this._observable.notify(),t}entries(){return(0,i.gc)(this._observable),this._map.entries()}forEach(e,t){(0,i.gc)(this._observable),this._map.forEach(((r,i)=>e.call(t,r,i,this)),t)}get(e){return(0,i.gc)(this._observable),this._map.get(e)}has(e){return(0,i.gc)(this._observable),this._map.has(e)}keys(){return(0,i.gc)(this._observable),this._map.keys()}set(e,t){return this._map.set(e,t),this._observable.notify(),this}values(){return(0,i.gc)(this._observable),this._map.values()}[Symbol.iterator](){return(0,i.gc)(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}},92154:(e,t,r)=>{"use strict";r.d(t,{P:()=>n});var i=r(3789);class n extends i.A{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(){const e=super.acquire(...arguments);return this._set.delete(e),e}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}}},41289:(e,t,r)=>{"use strict";function i(e,t){for(const r of e.entries())if(t(r[0]))return!0;return!1}function n(e,t){if(!t)return e;for(const r of t)null!=r&&e.add(r);return e}function s(e,t){return null!=t&&e.add(t),e}function o(e,t){const r=new Set;return n(r,e),n(r,t),r}function a(e,t){const r=new Set;for(const i of t)e.has(i)&&r.add(i);return r}function l(e,t){if(!e||!t)return!1;if(e===t)return!0;for(const r of e)if(!t.has(r))return!1;return!0}function c(e,t){if(null==e&&null==t)return!0;if(null==e||null==t||e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}function u(e,t){const r=new Set(e);for(const i of t)r.delete(i);return r}function h(e,t){return u(o(e,t),a(e,t))}r.d(t,{BT:()=>h,E$:()=>a,FB:()=>n,KC:()=>o,Yy:()=>l,aI:()=>c,bw:()=>i,iv:()=>u,kb:()=>s})},19898:(e,t,r)=>{"use strict";r.d(t,{R:()=>n});var i=r(50076);let n=class e{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.major=e,this.minor=t,this._context=r}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}since(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const t=this._context&&this._context+":",r=this._context&&this._context+" ";throw new i.A(t+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new e(this.major,this.minor,this._context)}static parse(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const[n,s]=t.split("."),o=/^\s*\d+\s*$/;if(!n?.match||!o.test(n))throw new i.A((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!s?.match||!o.test(s))throw new i.A((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});const a=parseInt(n,10),l=parseInt(s,10);return new e(a,l,r)}}},62754:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var i=r(83113);class n extends i.A{constructor(e,t,r){super(e,t,r)}}n.prototype.type="warning"},17555:(e,t,r)=>{"use strict";r.d(t,{O:()=>n});var i=r(86560);const n=()=>i.A.respectPrefersReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches},40836:(e,t,r)=>{"use strict";r.d(t,{T:()=>o});var i=r(54901),n=r(18690);class s{constructor(e,t){this._observers=e,this._observer=t}remove(){(0,n.TF)(this._observers,this._observer)}}class o{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return a;null==this._observers&&(this._observers=[]);const t=this._observers;let r=!1,i=!1;const n=t.length;for(let s=0;s<n;++s){const n=t[s];if(n.destroyed)i=!0;else if(n===e){r=!0;break}}return r||(t.push(e),i&&this._removeDestroyedObservers()),new s(t,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||0===e.length)return;const t=e.length;let r=0;for(let i=0;i<t;++i){for(;i+r<t&&e[i+r].destroyed;)++r;if(r>0){if(!(i+r<t))break;e[i]=e[i+r]}}e.length=t-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(null!=e){for(const t of e)t.onCommitted();this._observers=null}}}const a=(0,i.hA)()},49140:(e,t,r)=>{"use strict";var i;r.d(t,{AU:()=>n,Gr:()=>i,OL:()=>o,aB:()=>s,in:()=>a}),function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.LINK_CHART=6]="LINK_CHART",e[e.USER=7]="USER"}(i||(i={}));const n=i.USER+1;function s(e){switch(e){case"defaults":return i.DEFAULTS;case"service":return i.SERVICE;case"portal-item":return i.PORTAL_ITEM;case"web-scene":return i.WEB_SCENE;case"web-map":return i.WEB_MAP;case"link-chart":return i.LINK_CHART;case"user":return i.USER;default:return null}}function o(e){switch(e){case i.DEFAULTS:return"defaults";case i.SERVICE:return"service";case i.PORTAL_ITEM:return"portal-item";case i.WEB_SCENE:return"web-scene";case i.WEB_MAP:return"web-map";case i.LINK_CHART:return"link-chart";case i.USER:return"user"}}function a(e){return o(e)}},37596:(e,t,r)=>{"use strict";r.d(t,{G:()=>i});const i=Symbol("Accessor-beforeDestroy")},21403:(e,t,r)=>{"use strict";r.d(t,{w:()=>l});var i=r(40565),n=r(19258);const s=Object.prototype.toString;function o(e){const t="__accessorMetadata__"in e?(0,i.dp)(e):e;return function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(r.push(t),"number"==typeof r[2])throw new Error("Using @cast has parameter decorator is not supported since 4.16");return a.apply(this,r)}}function a(e,t,r,i){(0,n.z4)(e,t).cast=i}function l(){if(3!==arguments.length||"string"!=typeof(arguments.length<=1?void 0:arguments[1]))return 1===arguments.length&&"[object Function]"===s.call(arguments.length<=0?void 0:arguments[0])?o(arguments.length<=0?void 0:arguments[0]):1===arguments.length&&"string"==typeof(arguments.length<=0?void 0:arguments[0])?function(e){return(t,r)=>{(0,n.z4)(t,e).cast=t[r]}}(arguments.length<=0?void 0:arguments[0]):void 0}},6409:(e,t,r)=>{"use strict";r.d(t,{e:()=>s});var i=r(45802),n=r(46053);function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e instanceof i.J?e:new i.J(e,t),s={type:t?.ignoreUnknown??1?r.apiValues:String,json:{type:r.jsonValues,read:!t?.readOnly&&{reader:r.read},write:{writer:r.write}}};return void 0!==t?.readOnly&&(s.readOnly=!!t.readOnly),void 0!==t?.default&&(s.json.default=t.default),void 0!==t?.name&&(s.json.name=t.name),void 0!==t?.nonNullable&&(s.nonNullable=t.nonNullable),(0,n.MZ)(s)}},46053:(e,t,r)=>{"use strict";r.d(t,{MZ:()=>l,Qp:()=>u,rM:()=>c});var i=r(76460),n=r(40565),s=r(17879),o=r(19258),a=r(8819);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t,r)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${r}. Accessor does not support static properties.`);const l=Object.getOwnPropertyDescriptor(t,r),c=(0,o.z4)(t,r);l&&(l.get||l.set?(c.get=l.get||c.get,c.set=l.set||c.set):"value"in l&&("value"in e&&i.A.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${t.constructor.name}" already defined in the metadata`,e),c.value=e.value=l.value)),null!=e.readOnly&&(c.readOnly=e.readOnly);const h=e.aliasOf;if(h){const e="string"==typeof h?h:h.source,t="string"==typeof h?null:!0===h.overridable;let i;c.dependsOn=[e],c.get=function(){let t=(0,s.Jt)(this,e);if("function"==typeof t){i||(i=e.split(".").slice(0,-1).join("."));const r=(0,s.Jt)(this,i);r&&(t=t.bind(r))}return t},c.readOnly||(c.set=t?function(e){this._override(r,e)}:function(t){(0,a.h)(this,e,t)})}const d=e.type,p=e.types;c.cast||(d?c.cast=function(e){let t=0,r=e;if((0,n.Zu)(e))return(0,n.Nd)(e);for(;Array.isArray(r)&&1===r.length&&"string"!=typeof r[0]&&"number"!=typeof r[0];)r=r[0],t++;const i=r;if((0,n.EK)(i))return 0===t?(0,n.MB)(i):(0,n._e)((0,n.MB)(i),t);if(1===t)return(0,n.eC)(i);if(t>1)return(0,n.e6)(i,t);const s=e;return s.from?s.from:(0,n.dp)(s)}(d):p&&(Array.isArray(p)?c.cast=(0,n.wB)((0,n.aq)(p[0])):c.cast=(0,n.aq)(p))),(0,o.CX)(c,e),e.range&&(c.cast=u(c.cast,e.range))}}function c(e,t,r){const i=(0,o.z4)(e,r);i.json||(i.json={});let n=i.json;return void 0!==t&&(n.origins||(n.origins={}),n.origins[t]||(n.origins[t]={}),n=n.origins[t]),n}function u(e,t){return r=>{let i=+e(r);return null!=t.step&&(i=Math.round(i/t.step)*t.step),null!=t.min&&(i=Math.max(t.min,i)),null!=t.max&&(i=Math.min(t.max,i)),i}}},28379:(e,t,r)=>{"use strict";r.d(t,{w:()=>n});var i=r(46053);function n(e,t,r){let n,s;return void 0===t||Array.isArray(t)?(s=e,r=t,n=[void 0]):(s=t,n=Array.isArray(e)?e:[e]),(e,t)=>{const o=e.constructor.prototype;n.forEach((n=>{const a=(0,i.rM)(e,n,s);a.read&&"object"==typeof a.read||(a.read={}),a.read.reader=o[t],r&&(a.read.source=(a.read.source||[]).concat(r))}))}}},29101:(e,t,r)=>{"use strict";function i(e){return(t,r)=>{t[r]=e}}r.d(t,{u:()=>i})},85842:(e,t,r)=>{"use strict";r.d(t,{$:()=>h});r(81806);var i=r(76460),n=r(37596),s=r(39299),o=r(19258),a=r(99486),l=r(95922);const c=new Set,u=new Set;function h(e){return t=>{e??="esri.core.Accessor",t.prototype.declaredClass=e,p(t);const r=[],i=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!c.has(s.initialize)&&(c.add(s.initialize),r.push(s.initialize)),s.hasOwnProperty("destroy")&&!u.has(s.destroy)&&(u.add(s.destroy),i.push(s.destroy)),s=Object.getPrototypeOf(s);c.clear(),u.clear();const a=class extends t{constructor(){if(super(...arguments),this.constructor===a&&"function"==typeof this.postscript){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let e=r.length-1;e>=0;e--)r[e].call(this)}}),i.length){let e=!1;const t=this[n.G];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!e){e=!0,t.call(this);for(let e=0;e<i.length;e++)i[e].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript()}}};a.__accessorMetadata__=(0,o.tD)(t.prototype),a.prototype.declaredClass=e;const l=(e||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(a,"name",{value:l,configurable:!0}),a}}function d(e,t){return null==t.get?function(){const t=this.__accessor__,r=t.propertiesByName.get(e);if(void 0===r)return;(0,a.gc)(r);const i=t.store;return i.has(e)?i.get(e):r.metadata.value}:function(){const t=this.__accessor__,r=t.propertiesByName.get(e);if(void 0!==r)return r.getComputed(t)}}function p(e){const t=e.prototype,r=(0,o.tD)(t),i={};for(const n of Object.getOwnPropertyNames(r)){const e=r[n];(0,l.qk)(e),i[n]={enumerable:!0,configurable:!0,get:d(n,e),set(t){const r=this.__accessor__;if(void 0!==r){if(!Object.isFrozen(this))return r.initialized&&e.readOnly?f("read-only",n):r.lifecycle===s.v.CONSTRUCTED&&e.constructOnly?f("construct-only",n):void r.set(n,t)}else Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:t})}}}Object.defineProperties(e.prototype,i)}const f=(e,t)=>{i.A.getLogger("esri.core.Accessor").error(`cannot assign to ${e} property '${t}'`)}},17707:(e,t,r)=>{"use strict";r.d(t,{K:()=>n});var i=r(46053);function n(e,t,r){let n,s;return void 0===t?(s=e,n=[void 0]):"string"!=typeof t?(s=e,n=[void 0],r=t):(s=t,n=Array.isArray(e)?e:[e]),(e,t)=>{const o=e.constructor.prototype;for(const a of n){const n=(0,i.rM)(e,a,s);n.write&&"object"==typeof n.write||(n.write={}),r&&(n.write.target=r),n.write.writer=o[t]}}}},60351:(e,t,r)=>{"use strict";r.d(t,{k:()=>n});var i=r(49140);function n(e,t,r){t.keys().forEach((e=>{r.set(e,t.get(e),i.Gr.DEFAULTS)}));const n=e.metadata;Object.keys(n).forEach((t=>{e.internalGet(t)&&r.set(t,e.internalGet(t),i.Gr.DEFAULTS)}))}},15011:(e,t,r)=>{"use strict";r.d(t,{Im:()=>g,Mj:()=>d,Ui:()=>m,w2:()=>f});var i=r(91967),n=r(19276),s=r(39314);const o=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function a(e){return e instanceof i.A}function l(e){return e instanceof n.A?Object.keys(e.items):a(e)?(0,s.oY)(e).keys():e?Object.keys(e):[]}function c(e,t){return e instanceof n.A?e.items[t]:e[t]}function u(e){return e?e.declaredClass:null}function h(e,t){const r=e.diff;if(r&&"function"==typeof r)return r(e,t);const i=l(e),n=l(t);if(0===i.length&&0===n.length)return;if(!i.length||!n.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const s=n.filter((e=>!i.includes(e))),d=i.filter((e=>!n.includes(e))),p=i.filter((r=>n.includes(r)&&c(e,r)!==c(t,r))).concat(s,d).sort(),f=u(e);if(f&&o.has(f)&&p.length)return{type:"complete",oldValue:e,newValue:t};let m;const g=a(e)&&a(t);for(const o of p){const i=c(e,o),n=c(t,o);let s;if((g||"function"!=typeof i&&"function"!=typeof n)&&i!==n&&(null!=i||null!=n)){if(r&&r[o]&&"function"==typeof r[o])s=r[o]?.(i,n);else if(i instanceof Date&&n instanceof Date){if(i.getTime()===n.getTime())continue;s={type:"complete",oldValue:i,newValue:n}}else s="object"==typeof i&&"object"==typeof n&&u(i)===u(n)?h(i,n):{type:"complete",oldValue:i,newValue:n};null!=s&&(null!=m?m.diff[o]=s:m={type:"partial",diff:{[o]:s}})}}return m}function d(e,t){return p(e,t)}function p(e,t){if(null==e)return!1;const r=t.split(".");let i=e;for(const n of r){if("complete"===i.type)return!0;if("partial"!==i.type)return!1;{const e=i.diff[n];if(!e)return!1;i=e}}return!0}function f(e,t){if(!e)return!1;if("partial"===e.type){const r=Object.keys(e.diff);return 1===r.length&&r[0]===t}return!1}function m(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&u(e)!==u(t)?{type:"complete",oldValue:e,newValue:t}:h(e,t)}function g(e){if(null==e)return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!g(e))return!1;for(const e of t.removed)if(!g(e))return!1;for(const e of t.changed)if(!g(e))return!1;return!0}case"partial":for(const t in e.diff)if(!g(e.diff[t]))return!1;return!0}}},40565:(e,t,r)=>{"use strict";r.d(t,{EK:()=>A,GB:()=>c,GX:()=>l,MB:()=>C,Nd:()=>L,PZ:()=>y,Uv:()=>P,Vr:()=>u,Zu:()=>I,_e:()=>T,aq:()=>E,dp:()=>b,e6:()=>M,eC:()=>x,gK:()=>O,jz:()=>R,wB:()=>w});r(81806);var i=r(76460),n=r(87663);const s=()=>i.A.getLogger("esri.core.accessorSupport.ensureTypes");function o(e){return null==e?e:new Date(e)}function a(e){return null==e?e:!!e}function l(e){return null==e?e:e.toString()}function c(e){return null==e?e:(e=parseFloat(e),isNaN(e)?0:e)}function u(e){return null==e?e:Math.round(parseFloat(e))}function h(e){return null}function d(e){return e?.constructor&&void 0!==e.constructor.__accessorMetadata__}function p(e,t){return null!=t&&e&&!(t instanceof e)}function f(e){return e&&"isCollection"in e}function m(e){return e?.Type?"function"==typeof e.Type?e.Type:e.Type.base:null}function g(e,t){return!!d(t)&&(s().error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+_(e)+"'"),!0)}function y(e,t){return null==t?t:f(e)?function(e,t){if(!t?.constructor||!f(t.constructor))return g(e,t)?t:new e(t);const r=m(e.prototype.itemType),i=m(t.constructor.prototype.itemType);return r?i?r===i?t:r.prototype.isPrototypeOf(i.prototype)?new e(t):(g(e,t),t):new e(t):t}(e,t):p(e,t)?g(e,t)?t:new e(t):t}function _(e){return e?.prototype?.declaredClass||"unknown"}const v=new WeakMap;function b(e,t){const r=function(e){switch(e){case Number:return c;case R:return u;case Boolean:return a;case String:return l;case Date:return o;case P:return h;default:return(0,n.tE)(v,e,(()=>y.bind(null,e)))}}(e);return 1===arguments.length?r:r(t)}function w(e,t,r){return 1===arguments.length?w.bind(null,e):t?Array.isArray(t)?t.map((t=>e(t,r))):[e(t,r)]:t}function x(e,t){return 1===arguments.length?w((t=>b(e,t))):w((t=>b(e,t)),t)}function S(e,t,r){return 0!==t&&Array.isArray(r)?r.map((r=>S(e,t-1,r))):e(r)}function T(e,t,r){if(2===arguments.length)return r=>T(e,t,r);if(!r)return r;r=S(e,t,r);let i=t,n=r;for(;i>0&&Array.isArray(n);)i--,n=n[0];if(void 0!==n)for(let s=0;s<i;s++)r=[r];return r}function M(e,t,r){return 2===arguments.length?T((t=>b(e,t)),t):T((t=>b(e,t)),t,r)}function A(e){return!!Array.isArray(e)&&!e.some((t=>{const r=typeof t;return!("string"===r||"number"===r||"function"===r&&e.length>1)}))}function C(e,t){if(2===arguments.length)return C(e).call(null,t);const r=new Set,i=e.filter((e=>"function"!=typeof e)),n=e.filter((e=>"function"==typeof e));for(const s of e)"string"!=typeof s&&"number"!=typeof s||r.add(s);let o=null,a=null;return(e,t)=>{if(null==e)return e;const l=typeof e,c="string"===l||"number"===l;return c&&(r.has(e)||n.some((e=>"string"===l&&e===String||"number"===l&&e===Number)))||"object"===l&&n.some((t=>!p(e,t)))?e:(c&&i.length?(o||(o=i.map((e=>"string"==typeof e?`'${e}'`:`${e}`)).join(", ")),s().error("Accessor#set",`'${e}' is not a valid value for this property, only the following values are valid: ${o}`)):"object"==typeof e&&n.length?(a||(a=n.map((e=>_(e))).join(", ")),s().error("Accessor#set",`'${e}' is not a valid value for this property, value must be one of ${a}`)):s().error("Accessor#set",`'${e}' is not a valid value for this property`),t&&(t.valid=!1),null)}}function E(e,t){if(2===arguments.length)return E(e).call(null,t);const r={},i=[],n=[];for(const s in e.typeMap){const t=e.typeMap[s];r[s]=b(t),i.push(_(t)),n.push(s)}const o=()=>`'${i.join("', '")}'`,a=()=>`'${n.join("', '")}'`,l="string"==typeof e.key?t=>t[e.key]:e.key;return t=>{if(e.base&&!p(e.base,t))return t;if(null==t)return t;const i=l(t)||e.defaultKeyValue,n=r[i];if(!n)return s().error("Accessor#set",`Invalid property value, value needs to be one of ${o()}, or a plain object that can autocast (having .type = ${a()})`),null;if(!p(e.typeMap[i],t))return t;if("string"==typeof e.key&&!d(t)){const r={};for(const i in t)i!==e.key&&(r[i]=t[i]);return n(r)}return n(t)}}class R{}class P{}const O={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function I(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function L(e){switch(e.type){case"native":return b(e.value);case"array":return w(L(e.value));case"one-of":return function(e){let t=null;return(r,i)=>D(r,e)?r:(null==t&&(t=N(e)),s().error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),i&&(i.valid=!1),null)}(e);default:return null}}function N(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case R:return"integer";case Date:return"date";case P:return"null";default:return _(e.value)}case"array":return`array of ${N(e.value)}`;case"one-of":{const t=e.values.map((e=>N(e)));return`one of ${t.slice(0,-1)} or ${t[t.length-1]}`}}return"unknown"}function D(e,t){if(null==e)return!0;switch(t.type){case"native":switch(t.value){case Number:case R:return"number"==typeof e;case Boolean:return"boolean"==typeof e;case String:return"string"==typeof e;case P:return null===e}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some((e=>!D(e,t.value)));case"one-of":return t.values.some((t=>D(e,t)))}}},95922:(e,t,r)=>{"use strict";r.d(t,{xF:()=>u,N5:()=>h,k4:()=>d,qk:()=>_});var i=r(40565);var n=r(7982);function s(e){if(e.json||(e.json={}),a(e.json),l(e.json),o(e.json),e.json.origins)for(const t in e.json.origins)a(e.json.origins[t]),l(e.json.origins[t]),o(e.json.origins[t]);return!0}function o(e){e.name&&(e.read&&"object"==typeof e.read?void 0===e.read.source&&(e.read.source=e.name):e.read={source:e.name},e.write&&"object"==typeof e.write?void 0===e.write.target&&(e.write.target=e.name):e.write={target:e.name})}function a(e){"boolean"==typeof e.read?e.read={enabled:e.read}:"function"==typeof e.read?e.read={enabled:!0,reader:e.read}:e.read&&"object"==typeof e.read&&void 0===e.read.enabled&&(e.read.enabled=!0)}function l(e){"boolean"==typeof e.write?e.write={enabled:e.write}:"function"==typeof e.write?e.write={enabled:!0,writer:e.write}:e.write&&"object"==typeof e.write&&void 0===e.write.enabled&&(e.write.enabled=!0)}var c=r(22382);function u(e,t){return p(e,"any",t?.origin)}function h(e,t){return p(e,"read",t?.origin)}function d(e,t){return p(e,"write",t?.origin)}function p(e,t,r){let i=e?.json;if(i?.origins&&r){let e;e="link-chart"===r?i.origins[r]&&("any"===t||t in i.origins[r])?i.origins[r]:i.origins["web-map"]:i.origins[r],e&&("any"===t||t in e)&&(i=e)}return i}function f(e){const t=function(e){return e.json.types?y(e.json):e.type?g(e):y(e)}(e);if(e.json.origins)for(const r in e.json.origins){const i=e.json.origins[r],s=i.types?m(i):t;(0,n.v)(s,i,!1),i.types&&!i.write&&e.json.write?.enabled&&(i.write={...e.json.write}),(0,c.v)(s,i)}(0,n.v)(t,e.json,!0),(0,c.v)(t,e.json)}function m(e){return e.type?g(e):y(e)}function g(e){if(!e.type)return;let t=0,r=e.type;for(;Array.isArray(r)&&!(0,i.EK)(r);)r=r[0],t++;return{type:r,ndimArray:t}}function y(e){if(!e.types)return;let t=0,r=e.types;for(;Array.isArray(r);)r=r[0],t++;return{types:r,ndimArray:t}}function _(e){s(e)&&(function(e){if(e.json&&e.json.origins){const t=e.json.origins,r={"web-document":["web-scene","web-map"]};for(const e in r)if(t[e]){const i=t[e];r[e].forEach((e=>{t[e]=i})),delete t[e]}}}(e),f(e))}},7982:(e,t,r)=>{"use strict";r.d(t,{C:()=>u,v:()=>c});var i=r(76460),n=r(48611),s=r(62754),o=r(19258),a=r(28013);const l=()=>i.A.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function c(e,t,r){e&&(!r&&!t.read||t.read?.reader||!1===t.read?.enabled||function(e){return"types"in e?g(e.types):m(e.type)}(e)&&(0,n.sM)("read.reader",u(e),t))}function u(e){const t=e.ndimArray??0;if(t>1)return function(e){const t=h(e),r=d.bind(null,t),i=e.ndimArray??0;return(e,t,n)=>{if(null==e)return e;e=r(e,n,i);let s=i,o=e;for(;s>0&&Array.isArray(o);)s--,o=o[0];if(void 0!==o)for(let r=0;r<s;r++)e=[e];return e}}(e);if(1===t)return p(e);if("type"in e&&f(e.type)){const t=e.type.prototype?.itemType?.Type,r=p("function"==typeof t?{type:t}:{types:t});return(t,i,n)=>{const s=r(t,i,n);return s?new e.type(s):s}}return h(e)}function h(e){return"type"in e?function(e){return e.prototype.read?(t,r,i)=>{if(null==t)return t;const n=typeof t;if("object"!==n)return void l().error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${n}'`);const s=new e;return s.read(t,i),s}:e.fromJSON}(e.type):function(e){let t=null;const r=e.errorContext??"type",i=e.validate;return(n,a,c)=>{if(null==n)return n;const u=typeof n;if("object"!==u)return void l().error(`Expected JSON value of type 'object' to deserialize, but got '${u}'`);t||(t=function(e){const t={};for(const r in e.typeMap){const i=e.typeMap[r],n=(0,o.tD)(i.prototype);if("function"==typeof e.key)continue;const s=n[e.key];if(!s)continue;if(s.json?.type&&Array.isArray(s.json.type)&&1===s.json.type.length&&"string"==typeof s.json.type[0]){t[s.json.type[0]]=i;continue}const a=s.json?.write;if(!a?.writer){t[r]=i;continue}const l=a.target,c="string"==typeof l?l:e.key,u={};a.writer(r,u,c),u[c]&&(t[u[c]]=i)}return t}(e));const h=e.key;if("string"!=typeof h)return;const d=n[h],p=d?t[d]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!p){const e=`Type '${d||"unknown"}' is not supported`;return c?.messages&&n&&c.messages.push(new s.A(`${r}:unsupported`,e,{definition:n,context:c})),void l().error(e)}const f=new p;return f.read(n,c),i?i(f):f}}(e.types)}function d(e,t,r,i){return 0!==i&&Array.isArray(t)?t.map((t=>d(e,t,r,i-1))):e(t,void 0,r)}function p(e){const t=h(e);return(e,r,i)=>{if(null==e)return e;if(Array.isArray(e)){const r=[];for(const n of e){const e=t(n,void 0,i);void 0!==e&&r.push(e)}return r}const n=t(e,void 0,i);return void 0!==n?[n]:void 0}}function f(e){if(!(0,a.P)(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&("function"==typeof t.Type?m(t.Type):g(t.Type))}function m(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||f(e))}function g(e){for(const t in e.typeMap)if(!m(e.typeMap[t]))return!1;return!0}},28013:(e,t,r)=>{"use strict";function i(e){return!!e&&e.prototype?.declaredClass&&0===e.prototype.declaredClass.indexOf("esri.core.Collection")}r.d(t,{P:()=>i})},22382:(e,t,r)=>{"use strict";r.d(t,{B:()=>h,v:()=>a});var i=r(50076),n=r(76460),s=r(48611),o=r(28013);function a(e,t){if(!t.write||t.write.writer||!1===t.write.enabled&&!t.write.overridePolicy)return;const r=e?.ndimArray??0;e&&(1===r||"type"in e&&(0,o.P)(e.type))?t.write.writer=d:r>1?t.write.writer=function(e){return(t,r,i,n)=>{let o;if(null===t)o=null;else{o=p(t,n,e);let r=e,i=o;for(;r>0&&Array.isArray(i);)r--,i=i[0];if(void 0!==i)for(let e=0;e<r;e++)o=[o]}(0,s.sM)(i,o,r)}}(r):t.types?Array.isArray(t.types)?t.write.writer=function(e){return(t,r,i,n)=>t&&Array.isArray(t)?c(t.filter((t=>l(t,e,n))),r,i,n):c(t,r,i,n)}(t.types[0]):t.write.writer=function(e){return(t,r,i,n)=>t?l(t,e,n)?c(t,r,i,n):void 0:c(t,r,i,n)}(t.types):t.write.writer=c}function l(e,t,r){for(const i in t.typeMap)if(e instanceof t.typeMap[i])return!0;if(r?.messages){const s=t.errorContext??"type",o=`Values of type '${("function"!=typeof t.key?e[t.key]:e.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&e&&r.messages.push(new i.A(`${s}:unsupported`,o,{definition:e,context:r})),n.A.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(o)}return!1}function c(e,t,r,i){(0,s.sM)(r,u(e,i),t)}function u(e,t){return e&&"function"==typeof e.write?e.write({},t):e&&"function"==typeof e.toJSON?e.toJSON():"number"==typeof e?h(e):e}function h(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function d(e,t,r,i){let n;null===e?n=null:e&&"function"==typeof e.map?(n=e.map((e=>u(e,i))),"function"==typeof n.toArray&&(n=n.toArray())):n=[u(e,i)],(0,s.sM)(r,n,t)}function p(e,t,r){return 0!==r&&Array.isArray(e)?e.map((e=>p(e,t,r-1))):u(e,t)}},17879:(e,t,r)=>{"use strict";r.d(t,{Jt:()=>a,RP:()=>o,t2:()=>l});var i=r(39314);function n(e,t){const r="?"===e[e.length-1]?e.slice(0,-1):e;if(null!=t.getItemAt||Array.isArray(t)){const e=parseInt(r,10);if(!isNaN(e))return Array.isArray(t)?t[e]:t.at(e)}const n=(0,i.oY)(t);return(0,i.yh)(n,r)?n.get(r):t[r]}function s(e,t,r){if(null==e)return e;const i=n(t[r],e);return!i&&r<t.length-1?void 0:r===t.length-1?i:s(i,t,r+1)}function o(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return"string"!=typeof t||t.includes(".")?s(e,(0,i.AH)(t),r):n(t,e)}function a(e,t){return o(e,t)}function l(e,t){return void 0!==o(t,e)}},39299:(e,t,r)=>{"use strict";var i;r.d(t,{v:()=>i}),function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED",e[e.DESTROYED=3]="DESTROYED"}(i||(i={}))},80979:(e,t,r)=>{"use strict";r.d(t,{K:()=>i});const i=["operational-layers","basemap","ground"]},19258:(e,t,r)=>{"use strict";r.d(t,{CX:()=>a,tD:()=>s,z4:()=>o});var i=r(53084),n=r(39314);function s(e){let t=e.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!r){t=Object.create(t);for(const e in t)t[e]=(0,i.o8)(t[e]);Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t={},Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function o(e,t){const r=s(e);let i=r[t];return i||(i=r[t]={}),i}function a(e,t){return(0,n.h1)(e,t,c)}const l=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function c(e){return l.test(e)?"replace":"merge"}},6527:(e,t,r)=>{"use strict";r.d(t,{L:()=>u,t:()=>h});var i=r(17879),n=r(39314),s=r(95922);function o(e,t,r){if(!e?.read||!1===e.read.enabled||!e.read.source)return!1;const n=e.read.source;if("string"==typeof n){if(n===t)return!0;if(n.includes(".")&&0===n.indexOf(t)&&(0,i.t2)(n,r))return!0}else for(const s of n){if(s===t)return!0;if(s.includes(".")&&0===s.indexOf(t)&&(0,i.t2)(s,r))return!0}return!1}function a(e,t,r,i,n){let a=(0,s.N5)(t[r],n);(function(e){return e&&(!e.read||!1!==e.read.enabled&&!e.read.source)})(a)&&(e[r]=!0);for(const l of Object.getOwnPropertyNames(t))a=(0,s.N5)(t[l],n),o(a,r,i)&&(e[l]=!0)}function l(e,t,r,i){const n=r.metadata,o=(0,s.xF)(n[t],i),a=o?.default;if(void 0===a)return;const l="function"==typeof a?a.call(e,t,i):a;void 0!==l&&r.set(t,l)}const c={origin:"service"};function u(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c;if(!t||"object"!=typeof t)return;const o=(0,n.oY)(e),u=o.metadata,h={};for(const i of Object.getOwnPropertyNames(t))a(h,u,i,t,r);o.setDefaultOrigin(r.origin);for(const n of Object.getOwnPropertyNames(h)){const a=(0,s.N5)(u[n],r).read,l=a?.source;let c;c=l&&"string"==typeof l?(0,i.RP)(t,l):t[n],a?.reader&&(c=a.reader.call(e,c,t,r)),void 0!==c&&o.set(n,c)}if(!r||!r.ignoreDefaults){o.setDefaultOrigin("defaults");for(const t of Object.getOwnPropertyNames(u))h[t]||l(e,t,o,r)}o.setDefaultOrigin("user")}function h(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c;const n={...i,messages:[]};r(n),n.messages?.forEach((t=>{"warning"!==t.type||e.loaded?i?.messages&&i.messages.push(t):e.loadWarnings.push(t)}))}},8819:(e,t,r)=>{"use strict";r.d(t,{h:()=>o});var i=r(50076),n=r(81806),s=(r(76460),r(17879));function o(e,t,r){if(e&&t)if("object"==typeof t)for(const i of Object.getOwnPropertyNames(t))o(e,i,t[i]);else{if(t.includes(".")){const i=t.split("."),n=i.splice(-1,1)[0];return void o((0,s.Jt)(e,i),n,r)}const i=e.__accessor__;null!=i&&a(t,i),e[t]=r}}function a(e,t){if((0,n.A)("esri-unknown-property-errors")&&!function(e,t){return null!=t.metadata[e]}(e,t))throw new i.A("set:unknown-property",function(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}(e,t))}},99486:(e,t,r)=>{"use strict";r.d(t,{F_:()=>p,Xr:()=>v,a:()=>d,fE:()=>y,gc:()=>c});r(81806);var i=r(76460),n=r(39314),s=r(15434);const o={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},a=[];let l=o;function c(e){l.onObservableAccessed(e)}let u=!1,h=!1;function d(e,t,r){if(u)return f(e,t,r);m(e);const i=t.call(r);return g(),i}function p(e,t){return d(o,e,t)}function f(e,t,r){const n=u;u=!0,m(e);let s=null;try{s=t.call(r)}catch(l){h&&i.A.getLogger("esri.core.accessorSupport.tracking").error(l)}return g(),u=n,s}function m(e){l=e,a.push(e)}function g(){const e=a.length;if(e>1){const t=a.pop();l=a[e-2],t.onTrackingEnd()}else if(1===e){const e=a.pop();l=o,e.onTrackingEnd()}else l=o}function y(e,t){if(t.flags&s.i.DepTrackingInitialized)return;const r=h;h=!1,t.flags&s.i.AutoTracked?f(t,t.metadata.get,e):v(e,t),h=r}const _=[];function v(e,t){t.flags&s.i.ExplicitlyTracking||(t.flags|=s.i.ExplicitlyTracking,f(t,(()=>{const r=t.metadata.dependsOn||_;for(const t of r)if("string"!=typeof t||t.includes(".")){const r=(0,n.AH)(t);for(let t=0,i=e;t<r.length&&null!=i&&"object"==typeof i;++t)i=b(i,r[t],t!==r.length-1)}else b(e,t,!1)})),t.flags&=~s.i.ExplicitlyTracking)}function b(e,t,r){const i="?"===t[t.length-1]?t.slice(0,-1):t;if(null!=e.getItemAt||Array.isArray(e)){const t=parseInt(i,10);if(!isNaN(t))return Array.isArray(e)?e[t]:e.at(t)}const s=(0,n.oY)(e);if(s){const t=s.propertiesByName.get(i);t&&(c(t),y(e,t))}return r?e[i]:void 0}},15434:(e,t,r)=>{"use strict";var i;r.d(t,{i:()=>i}),function(e){e[e.Dirty=1]="Dirty",e[e.Overridden=2]="Overridden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"}(i||(i={}))},99702:(e,t,r)=>{"use strict";r.d(t,{I:()=>n});var i=r(40836);class n extends i.T{notify(){const e=this._observers;if(e&&e.length>0){const t=e.slice();for(const e of t)e.onInvalidated(),e.onCommitted()}}}},94151:(e,t,r)=>{"use strict";r.d(t,{r:()=>i});class i{constructor(e){this._accessed=new Set,this._handles=[],this._observerObject=new n(e),s.register(this,new WeakRef(this._observerObject),this)}destroy(){s.unregister(this._observerObject),this._accessed.clear(),this._observerObject?.destroy(),this.clear()}onObservableAccessed(e){this._accessed.add(e)}onTrackingEnd(){const e=this._handles,t=this._observerObject;this._accessed.forEach((r=>{e.push(r.observe(t))})),this._accessed.clear()}clear(){const e=this._handles;for(let t=0;t<e.length;++t)e[t].remove();e.length=0}}class n{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(1===e)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=o}}const s=new FinalizationRegistry((e=>{e.deref()?.destroy()}));function o(){}},49281:(e,t,r)=>{"use strict";r.d(t,{Df:()=>c,fm:()=>u,mJ:()=>l});var i=r(54901),n=r(99486),s=r(94151);let o=!1;const a=[];function l(e,t){let r=new s.r((function i(){if(!r||l)return;if(o)return void h(i);const s=a;r.clear(),o=!0,l=!0,a=(0,n.a)(r,e),l=!1,o=!1,t(a,s),d()})),a=null,l=!1;return l=!0,a=(0,n.a)(r,e),l=!1,(0,i.hA)((function(){r&&(r.destroy(),r=null,a=null)}))}function c(e,t){let r=new s.r((function(){t(o,a)})),o=null;function a(){return r?(r.clear(),o=(0,n.a)(r,e),o):null}return a(),(0,i.hA)((function(){r&&(r.destroy(),r=null),o=null}))}function u(e){let t=new s.r((function i(){t&&!r&&(o?h(i):(t.clear(),o=!0,r=!0,(0,n.a)(t,e),r=!1,o=!1,d()))})),r=!1;return r=!0,(0,n.a)(t,e),r=!1,(0,i.hA)((function(){t&&(t.destroy(),t=null)}))}function h(e){a.includes(e)||a.unshift(e)}function d(){for(;a.length;)a.pop()()}},39314:(e,t,r)=>{"use strict";r.d(t,{AH:()=>c,h1:()=>a,oY:()=>s,qg:()=>h,yh:()=>o});var i=r(54901),n=r(53084);function s(e){return e.__accessor__??null}function o(e,t){return null!=e?.metadata?.[t]}function a(e,t,r){return l(e,t,r?{policy:r,path:""}:null)}function l(e,t,r){return t?Object.keys(t).reduce(((e,i)=>{const s=i;let o=null,a="merge";if(r&&(o=r.path?`${r.path}.${i}`:i,a=r.policy(o)),"replace"===a)return e[s]=t[s],e;if("replace-arrays"===a&&Array.isArray(e[s]))return e[s]=t[s],e;if(void 0===e[s])return e[s]=(0,n.o8)(t[s]),e;let c=e[s],u=t[s];if(c===u)return e;if(Array.isArray(u)||Array.isArray(e))c=c?Array.isArray(c)?e[s]=c.concat():e[s]=[c]:e[s]=[],u&&(Array.isArray(u)||(u=[u]),u.forEach((e=>{c.includes(e)||c.push(e)})));else if(u&&"object"==typeof u)if(r){const t=r.path;r.path=o,e[s]=l(c,u,r),r.path=t}else e[s]=l(c,u,null);else e.hasOwnProperty(i)&&!t.hasOwnProperty(i)||(e[s]=u);return e}),e||{}):e}function c(e){return Array.isArray(e)?e:e.split(".")}function u(e){return e.includes(",")?e.split(",").map((e=>e.trim())):[e.trim()]}function h(e,t,r,n){const s=function(e){if(Array.isArray(e)){const t=[];for(const r of e)t.push(...u(r));return t}return u(e)}(t);if(1!==s.length){const t=s.map((t=>n(e,t,r)));return(0,i.vE)(t)}return n(e,s[0],r)}},68452:(e,t,r)=>{"use strict";r.d(t,{Cn:()=>C,Gs:()=>E,iS:()=>w,rs:()=>M,wB:()=>A});var i,n=r(11373),s=r(54901),o=r(53084),a=r(92154),l=r(52394),c=r(41289),u=r(90632),h=r(17879),d=r(39299),p=r(49281),f=r(39314);!function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"}(i||(i={}));class m{constructor(){this.uid=(0,u.c)(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,t,r,n,s){return this.pool.acquire(i.Untracked,e,t,r,n,s,o.aI)}static acquireTracked(e,t,r,n){return this.pool.acquire(i.Tracked,e,t,r,null,null,n)}notify(e,t){this.type===i.Untracked?this.callback.call(this.target,e,t,this.path,this.target):this.callback.call(null,e,t,void 0,void 0)}acquire(e,t,r,i,n,s,o){this.uid=(0,u.c)(),this.removed=!1,this.type=e,this.oldValue=t,this.callback=r,this.getValue=i,this.target=n,this.path=s,this.equals=o}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=(0,u.c)(),this.removed=!0}}m.pool=new a.P(m);const g=new n.A,y=new Set;let _;function v(e){y.delete(e),y.add(e),_||(_=(0,l._)(x))}function b(e){if(e.removed)return;const t=e.oldValue,r=e.getValue();e.equals(t,r)||(e.oldValue=r,e.notify(r,t))}function w(e){for(const t of y.values())t.target===e&&(t.removed=!0)}function x(){let e=10;for(;_&&e--;){_=null;const e=S(),t=g.acquire();for(const r of e){const e=r.uid;b(r),e===r.uid&&r.removed&&t.push(r)}for(const r of y)r.removed&&(t.push(r),y.delete(r));for(const r of t)m.pool.release(r);g.release(t),g.release(e),T.forEach((e=>e()))}}function S(){const e=g.acquire();e.length=y.size;let t=0;for(const r of y)e[t]=r,++t;return y.clear(),e}const T=new Set;function M(e){return T.add(e),(0,s.hA)((()=>T.delete(e)))}function A(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e.__accessor__&&e.__accessor__.lifecycle!==d.v.DESTROYED?i?function(e,t,r){const i=(0,f.qg)(e,t,r,((e,t,r)=>{let n=!1;return(0,p.mJ)((()=>(0,h.RP)(e,t)),((s,a)=>{e.__accessor__.lifecycle!==d.v.DESTROYED?n||(n=!0,(0,o.aI)(a,s)||r.call(e,s,a,t,e),n=!1):i.remove()}))}));return i}(e,t,r):function(e,t,r){let i=(0,f.qg)(e,t,r,((e,t,r)=>{let n,o,a=(0,p.Df)((()=>(0,h.RP)(e,t)),((s,a)=>{e.__accessor__?.lifecycle===d.v.DESTROYED||n&&n.uid!==o?i.remove():(n||(n=m.acquireUntracked(s,r,a,e,t),o=n.uid),v(n))}));return(0,s.hA)((()=>{a.remove(),n&&(n.uid!==o||n.removed||(n.removed=!0,v(n)),n=null),i=a=null}))}));return i}(e,t,r):(0,s.hA)()}function C(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.gh;return r?function(e,t,r){let i=!1;return(0,p.mJ)(e,((e,n)=>{i||(i=!0,r(n,e)||t(e,n),i=!1)}))}(e,t,i):function(e,t,r){let i,n,o=(0,p.Df)(e,((e,s)=>{i&&i.uid!==n?o.remove():(i||(i=m.acquireTracked(e,t,s,r),n=i.uid),v(i))}));return(0,s.hA)((()=>{o.remove(),i&&(i.uid!==n||i.removed||(i.removed=!0,v(i)),i=null),o=null}))}(e,t,i)}function E(e){return(0,c.bw)(y,(t=>t.oldValue===e))}},29584:(e,t,r)=>{"use strict";r.d(t,{M:()=>p,R:()=>d});var i=r(18690),n=r(50076),s=r(76460),o=r(17879),a=r(49140),l=r(39314),c=r(95922);function u(e,t,r,i,n){const s={};return t.write?.writer?.call(e,i,s,r,n),s}function h(e,t,r,l,c,u){if(!l?.write)return!1;const h=(0,o.Jt)(e,r);if(!c&&l.write.overridePolicy){const t=l.write.overridePolicy.call(e,h,r,u??void 0);void 0!==t&&(c=t)}if(c||(c=l.write),!c||!1===c.enabled)return!1;if(c.layerContainerTypes&&u?.layerContainerType&&!c.layerContainerTypes.includes(u.layerContainerType))return!1;if((null===h&&!c.allowNull&&!c.writerEnsuresNonNull||void 0===h)&&c.isRequired){const t=new n.A("web-document-write:property-required",`Missing value for required property '${r}' on '${e.declaredClass}'`,{propertyName:r,target:e});return t&&u?.messages?u.messages.push(t):t&&!u&&s.A.getLogger("esri.core.accessorSupport.write").error(t.name,t.message),!1}return void 0!==h&&(!(null===h&&!c.allowNull&&!c.writerEnsuresNonNull)&&(!(!(c.alwaysWriteDefaults||t.store.multipleOriginsSupported&&t.store.originOf(r)!==a.Gr.DEFAULTS)&&function(e,t,r,n,s){const o=n.default;if(void 0===o)return!1;if(null!=n.defaultEquals)return n.defaultEquals(s);if("function"==typeof o){if(Array.isArray(s)){const n=o.call(e,t,r??void 0);return(0,i.aI)(n,s)}return!1}return o===s}(e,r,u,l,h))&&!(!c.ignoreOrigin&&u?.origin&&t.store.multipleOriginsSupported&&t.store.originOf(r)<(0,a.aB)(u.origin))))}function d(e,t,r,i){const n=(0,l.oY)(e),s=n.metadata,o=(0,c.k4)(s[t],i);return!!o&&h(e,n,t,o,r,i)}function p(e,t,r){if(e&&"function"==typeof e.toJSON&&(!e.toJSON.isDefaultToJSON||!e.write))return(0,l.h1)(t,e.toJSON(r));const i=(0,l.oY)(e),n=i.metadata;for(const s in n){const d=(0,c.k4)(n[s],r);if(!h(e,i,s,d,void 0,r))continue;const p=(0,o.Jt)(e,s),f=u(e,d,d.write&&"string"==typeof d.write.target?d.write.target:s,p,r);Object.keys(f).length>0&&(t=(0,l.h1)(t,f),r?.resources?.pendingOperations?.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then((()=>(0,l.h1)(t,f,(()=>"replace-arrays"))))),r?.writtenProperties&&r.writtenProperties.push({target:e,propName:s,oldOrigin:(0,a.in)(i.store.originOf(s)),newOrigin:r.origin}))}return t}},18690:(e,t,r)=>{"use strict";r.d(t,{$U:()=>o,$i:()=>b,Am:()=>a,FQ:()=>p,He:()=>s,Ho:()=>d,Ji:()=>n,L1:()=>M,Ru:()=>A,TF:()=>T,Xj:()=>h,Xy:()=>y,aI:()=>l,iv:()=>u,k4:()=>x,mW:()=>v,qh:()=>g,tR:()=>C,vW:()=>f,yo:()=>c});var i=r(47249);const n=1.5,s=1/n,o=.5;function a(e,t){return t?e.filter(((e,r,i)=>i.findIndex(t.bind(null,e))===r)):Array.from(new Set(e))}function l(e,t,r){if(null==e&&null==t)return!0;if(null==e||null==t||e.length!==t.length)return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function c(e,t){let r=e.length!==t.length;r&&(e.length=t.length);for(let i=0;i<t.length;++i)e[i]!==t[i]&&(e[i]=t[i],r=!0);return r}function u(e,t,r){let i,n;return r?(i=t.filter((t=>!e.some((e=>r(e,t))))),n=e.filter((e=>!t.some((t=>r(t,e)))))):(i=t.filter((t=>!e.includes(t))),n=e.filter((e=>!t.includes(e)))),{added:i,removed:n}}function h(e){return e&&"number"==typeof e.length}function d(e,t){const r=e.length;if(0===r)return[];const i=[];for(let n=0;n<r;n+=t)i.push(e.slice(n,n+t));return i}function p(e,t,r){const i=e.length;let n=0,s=i-1;for(;n<s;){const r=n+Math.floor((s-n)/2);t>e[r]?n=r+1:s=r}const o=e[n];return r?t>=e[i-1]?-1:o===t?n:n-1:o===t?n:-1}class f{constructor(){this.last=0}}const m=new f;function g(e,t,r,i){i=i||m;const n=Math.max(0,i.last-10);for(let o=n;o<r;++o)if(e[o]===t)return i.last=o,o;const s=Math.min(n,r);for(let o=0;o<s;++o)if(e[o]===t)return i.last=o,o;return-1}function y(e,t,r,i){const n=r??e.length,s=g(e,t,n,i);if(-1!==s)return e[s]=e[n-1],null==r&&e.pop(),t}const _=new Set;function v(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length,n=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;if(0===i||0===r)return r;_.clear();for(let a=0;a<i;++a)_.add(t[a]);n=n||m;const o=Math.max(0,n.last-10);for(let a=o;a<r;++a)if(_.has(e[a])&&(s?.push(e[a]),_.delete(e[a]),e[a]=e[r-1],--r,--a,0===_.size||0===r))return _.clear(),r;for(let a=0;a<o;++a)if(_.has(e[a])&&(s?.push(e[a]),_.delete(e[a]),e[a]=e[r-1],--r,--a,0===_.size||0===r))return _.clear(),r;return _.clear(),r}function b(e,t){let r=0;for(let i=0;i<e.length;++i){const n=e[i];t(n,i)&&(e[r]=n,r++)}e.length=r}function w(e){return e?(S.seed=e,()=>S.getFloat()):Math.random}function x(e,t){const r=w(t);for(let i=e.length-1;i>0;i--){const t=Math.floor(r()*(i+1)),n=e[i];e[i]=e[t],e[t]=n}return e}const S=new i.A;function T(e,t){const r=e.indexOf(t);return-1!==r?(e.splice(r,1),t):null}function M(e,t){const r=new Map,i=e.length;for(let n=0;n<i;n++){const i=e[n],s=t(i,n,e),o=r.get(s);o?o.push(i):r.set(s,[i])}return r}function A(e,t){return null!=e}const C=[]},98773:(e,t,r)=>{"use strict";r.d(t,{DZ:()=>f,Ke:()=>p,QA:()=>m,Tj:()=>u,UT:()=>g,jJ:()=>c});var i=r(35143),n=r(91967),s=r(30726),o=r(50346),a=r(46053),l=r(85842);function c(e,t,r){return(0,o.Lx)(e.map(((e,i)=>t.apply(r,[e,i]))))}async function u(e,t,r){return(await(0,o.Lx)(e.map(((e,i)=>t.apply(r,[e,i]))))).map((e=>e.value))}function h(e){return{ok:!0,value:e}}function d(e){return{ok:!1,error:e}}async function p(e){if(null==e)return{ok:!1,error:new Error("no promise provided")};try{return h(await e)}catch(t){return d(t)}}async function f(e){try{return h(await e)}catch(t){return(0,o.QP)(t),d(t)}}function m(e){if(!0===e.ok)return e.value;throw e.error}function g(e,t){return new y(e,t)}let y=class extends n.A{get value(){return function(e){return null!=e&&!0===e.ok?e.value:null}(this._result)}get error(){return function(e){return null!=e&&!1===e.ok?e.error:null}(this._result)}get finished(){return null!=this._result}constructor(e,t){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=(0,s.DC)(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then((e=>{this._result=h(e),this._cleanup()}),(e=>{this._result=d(e),this._cleanup()})),this._abortHandle=(0,o.u7)(t,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=(0,s.xt)(this._abortHandle),this._abortController=null}};(0,i._)([(0,a.MZ)()],y.prototype,"value",null),(0,i._)([(0,a.MZ)()],y.prototype,"error",null),(0,i._)([(0,a.MZ)()],y.prototype,"finished",null),(0,i._)([(0,a.MZ)()],y.prototype,"promise",void 0),(0,i._)([(0,a.MZ)()],y.prototype,"_result",void 0),y=(0,i._)([(0,l.$)("esri.core.asyncUtils.ReactiveTask")],y)},21499:(e,t,r)=>{"use strict";function i(e){return 32+e.length}function n(){return 16}function s(e){if(!e)return 0;let t=c;for(const r in e)if(e.hasOwnProperty(r)){const n=e[r];switch(typeof n){case"string":t+=i(n);break;case"number":t+=16;break;case"boolean":t+=4}}return t}function o(e){if(!e)return 0;if(Array.isArray(e))return function(e){const t=e.length;if(0===t||"number"==typeof e[0])return 32+8*t;let r=u;for(let i=0;i<t;i++)r+=a(e[i]);return r}(e);let t=c;for(const r in e)e.hasOwnProperty(r)&&(t+=a(e[r]));return t}function a(e){switch(typeof e){case"object":return o(e);case"string":return i(e);case"number":return 16;case"boolean":return 4;default:return 8}}function l(e,t){return u+e.length*t}r.d(t,{eY:()=>s,f3:()=>n,iL:()=>o,xU:()=>i,zd:()=>l});const c=32,u=16},50176:(e,t,r)=>{"use strict";r.d(t,{p:()=>n});var i=r(54901);const n=function(e){return{setTimeout:(t,r)=>{const n=e.setTimeout(t,r);return(0,i.hA)((()=>e.clearTimeout(n)))}}}(globalThis)},3975:(e,t,r)=>{"use strict";r.d(t,{H:()=>s,V:()=>n});var i=r(19276);function n(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.A;return t||(t=new r),t===e||(t.removeAll(),function(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}(e)?t.addMany(e):e&&t.add(e)),t}function s(e){return e}},59784:(e,t,r)=>{"use strict";r.d(t,{$:()=>v,IB:()=>o,N2:()=>b,QP:()=>P,RH:()=>x,Vl:()=>R,Ws:()=>T,ZD:()=>w,_L:()=>E,bJ:()=>A,e$:()=>C,f6:()=>L,pW:()=>M,pf:()=>I,we:()=>O});var i=r(69539),n=r(43047),s=r(55855);function o(e){return"r"in e&&"g"in e&&"b"in e}function a(e){return"h"in e&&"s"in e&&"v"in e}function l(e){return"l"in e&&"a"in e&&"b"in e}function c(e){return"l"in e&&"c"in e&&"h"in e}const u=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],h=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function d(e,t){const r=[];let i,n;if(e[0].length!==t.length)throw new Error("dimensions do not match");const s=e.length,o=e[0].length;let a=0;for(i=0;i<s;i++){for(a=0,n=0;n<o;n++)a+=e[i][n]*t[n];r.push(a)}return r}function p(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),r=d(u,t);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function f(e){const t=d(h,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function m(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function g(e){const t=e.l,r=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function y(e){return function(e){const t=e.l,r=e.a,i=e.b,n=Math.sqrt(r*r+i*i);let s=Math.atan2(i,r);return s=s>0?s:s+2*Math.PI,{l:t,c:n,h:s}}(m(p(e)))}function _(e){return f(g(function(e){const t=e.l,r=e.c,i=e.h;return{l:t,a:r*Math.cos(i),b:r*Math.sin(i)}}(e)))}function v(e){return o(e)?e:c(e)?_(e):l(e)?function(e){return f(g(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?f(e):a(e)?function(e){const t=(e.h+360)%360/60,r=e.s/100,i=e.v/100*255,n=i*r,s=n*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:n,g:s,b:0};break;case 1:o={r:s,g:n,b:0};break;case 2:o={r:0,g:n,b:s};break;case 3:o={r:0,g:s,b:n};break;case 4:o={r:s,g:0,b:n};break;case 5:case 6:o={r:n,g:0,b:s};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+i-n),o.g=Math.round(o.g+i-n),o.b=Math.round(o.b+i-n),o}(e):e}function b(e){return a(e)?e:function(e){const t=e.r,r=e.g,i=e.b,n=Math.max(t,r,i),s=n-Math.min(t,r,i);let o=n,a=0===s?0:n===t?(r-i)/s%6:n===r?(i-t)/s+2:(t-r)/s+4,l=0===s?0:s/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}(v(e))}function w(e){return l(e)?e:function(e){return m(p(e))}(v(e))}function x(e){return c(e)?e:y(v(e))}function S(e){let{r:t,g:r,b:n,a:s}=e;return s<1&&(t=Math.round(s*t+255*(1-s)),r=Math.round(s*r+255*(1-s)),n=Math.round(s*n+255*(1-s))),new i.A({r:t,g:r,b:n})}function T(e,t){const{r:r,g:i,b:n}=t?.ignoreAlpha?e:S(e);return.2126*r+.7152*i+.0722*n}var M;function A(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M.High;return T(e,{ignoreAlpha:!0})>t?new i.A([0,0,0,e.a]):new i.A([255,255,255,e.a])}function C(e,t){const r=w(e);r.l*=1-t;const i=v(r),n=e.clone();return n.setColor(i),n.a=e.a,n}function E(e,t){const r=e.clone();return r.a*=t,r}function R(e,t){const r=b(e);r.s*=t;const i=v(r),n=e.clone();return n.setColor(i),n.a=e.a,n}function P(e){return i.A.toUnitRGBA(e)}function O(e,t){return e===t||null!=e&&null!=t&&(0,n.e)(e,t)}function I(e){return(0,s.fA)(e[0],e[1],e[2],e.length>3?e[3]:1)}function L(e,t){const r=i.A.toUnitRGBA(e);return r[3]*=t,r}!function(e){e[e.Low=160]="Low",e[e.High=225]="High"}(M||(M={}))},4212:(e,t,r)=>{"use strict";r.d(t,{GB:()=>n,Xb:()=>i});r(81806);function i(e){}function n(e){return()=>e}},63241:(e,t,r)=>{"use strict";r.d(t,{Lx:()=>a,eF:()=>l,eO:()=>o,io:()=>c});var i=r(81806);const n=new WeakMap;function s(e,t){const r=`\ud83d\uded1 DEPRECATED - ${t}`;if(!(arguments.length>2&&void 0!==arguments[2]&&arguments[2]))return void e.warn(r);let i=n.get(e);i||(i=new Set,n.set(e,i)),i.has(t)||(i.add(t),e.warn(r))}function o(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if((0,i.A)("esri-deprecation-warnings")){const{moduleName:i}=r;c(e,"Function: "+((i?i+"::":"")+t+"()"),r)}}function a(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if((0,i.A)("esri-deprecation-warnings")){const{moduleName:i}=r;c(e,"Property: "+((i?i+"::":"")+t),r)}}function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,i.A)("esri-deprecation-warnings")&&c(e,`Multiple argument constructor: ${t}`,{warnOnce:!0,replacement:`new ${t}({ <your properties here> })`,...r})}function c(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if((0,i.A)("esri-deprecation-warnings")){const{replacement:i,version:n,see:o,warnOnce:a}=r;let l=t;i&&(l+=`\n\t\ud83d\udee0\ufe0f Replacement: ${i}`),n&&(l+=`\n\t\u2699\ufe0f Version: ${n}`),o&&(l+=`\n\t\ud83d\udd17 See ${o} for more details.`),s(e,l,a)}}},93795:(e,t,r)=>{"use strict";function i(e){return e=e||globalThis.location.hostname,c.some((t=>null!=e?.match(t)))}function n(e,t){return e&&(t=t||globalThis.location.hostname)?null!=t.match(s)||null!=t.match(a)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(o)||null!=t.match(l)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}r.d(t,{EM:()=>n,b5:()=>i});const s=/^devext\.arcgis\.com$/,o=/^qaext\.arcgis\.com$/,a=/^[\w-]*\.mapsdevext\.arcgis\.com$/,l=/^[\w-]*\.mapsqa\.arcgis\.com$/,c=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local\.esri\.com$/,s,o,/^jsapps\.esri\.com$/,a,l]},30113:(e,t,r)=>{"use strict";function i(e){return"string"==typeof e?document.getElementById(e):e??null}function n(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function s(e,t){const r=t.parentNode;r&&r.insertBefore(e,t)}function o(e,t){for(;;){const r=e.firstChild;if(!r)break;t.appendChild(r)}}r.d(t,{$H:()=>i,Ie:()=>n,nc:()=>s,yC:()=>o});Element.prototype.closest},79053:(e,t,r)=>{"use strict";r.d(t,{Oo:()=>a,on:()=>o,wb:()=>n});var i=r(54901);function n(e){return function(e){return null!=e&&"object"==typeof e&&"on"in e&&"function"==typeof e.on}(e)||s(e)}function s(e){return null!=e&&"object"==typeof e&&"addEventListener"in e&&"function"==typeof e.addEventListener}function o(e,t,r){if(!n(e))throw new TypeError("target is not a Evented or EventTarget object");return s(e)?function(e,t,r,n){if(Array.isArray(t)){const s=t.slice();for(const t of s)e.addEventListener(t,r,n);return(0,i.hA)((()=>{for(const t of s)e.removeEventListener(t,r,n)}))}return e.addEventListener(t,r,n),(0,i.hA)((()=>e.removeEventListener(t,r,n)))}(e,t,r):e.on(t,r)}function a(e,t,r){if(!n(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,r);const i=o(e,t,(t=>{i.remove(),r.call(e,t)}));return i}},14522:(e,t,r)=>{"use strict";r.d(t,{T:()=>s,U:()=>n});var i=r(15941);function n(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=(0,i.qE)(e,0,l);for(let i=0;i<4;i++)t[r+i]=Math.floor(256*c(n*o[i]))}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;for(let i=0;i<4;i++)r+=e[t+i]*a[i];return r}const o=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=s(new Uint8ClampedArray([255,255,255,255]));function c(e){return e-Math.floor(e)}},85504:(e,t,r)=>{"use strict";r.d(t,{Al:()=>c,NZ:()=>u,Vb:()=>n});var i=r(86560);const n="arial-unicode-ms",s="woff2",o=new Map,a=new Set;class l{constructor(e,t){this.fontFace=e,this.promise=t}}async function c(e){const t=p(e),r=d(e),n=o.get(t);if(n)return n.promise;const c=new FontFace(e.family,`url('${i.A.fontsUrl}/woff2/${r}.${s}') format('${s}')`,{style:e.style,weight:e.weight}),u=document.fonts;if(u.has(c)&&"loading"===c.status)return c.loaded;const h=c.load().then((()=>(u.add(c),c)));return o.set(t,new l(c,h)),a.add(c),h}function u(e){return a.has(e)}function h(e){if(!e)return n;const t=e.toLowerCase().split(" ").join("-");switch(t){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return t}}function d(e){const t=f(e)+m(e);return h(e.family)+(t.length>0?t:"-regular")}function p(e){const t=f(e)+m(e);return(e.family||n)+(t.length>0?t:"-regular")}function f(e){if(!e.weight)return"";switch(e.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function m(e){if(!e.style)return"";switch(e.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}},54901:(e,t,r)=>{"use strict";r.d(t,{DQ:()=>l,a0:()=>s,a2:()=>a,hA:()=>n,vE:()=>o});const i={remove:()=>{}};function n(e){return e?{remove(){e&&(e(),e=void 0)}}:i}function s(e){e.forEach((e=>e?.remove()))}function o(e){return n((()=>s(e)))}function a(e){return n((()=>e()?.remove()))}function l(e){return n(null!=e?()=>e.destroy():void 0)}},81806:(e,t,r)=>{"use strict";let i;function n(e){return"function"==typeof i[e]?i[e]=i[e](globalThis):i[e]}r.d(t,{A:()=>n}),i=globalThis.dojoConfig?.has||globalThis.esriConfig?.has?{...globalThis.dojoConfig?.has,...globalThis.esriConfig?.has}:{},n.add=(e,t,r,s)=>((s||void 0===i[e])&&(i[e]=t),r&&n(e)),n.cache=i,n.add("big-integer-warning-enabled",!0),n.add("esri-deprecation-warnings",!0),n.add("esri-tests-disable-screenshots",!1),n.add("esri-tests-use-full-window",!1),n.add("esri-tests-post-to-influx",!0),(()=>{n.add("host-webworker",void 0!==globalThis.WorkerGlobalScope&&self instanceof globalThis.WorkerGlobalScope);const e="undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location===location&&window.document===document;if(n.add("host-browser",e),n.add("host-node","object"==typeof globalThis.process&&globalThis.process.versions?.node&&globalThis.process.versions.v8),n.add("dom",e),n("host-browser")){const e=navigator,t=e.userAgent,r=e.appVersion,i=parseFloat(r);if(n.add("wp",parseFloat(t.split("Windows Phone")[1])||void 0),n.add("msapp",parseFloat(t.split("MSAppHost/")[1])||void 0),n.add("khtml",r.includes("Konqueror")?i:void 0),n.add("edge",parseFloat(t.split("Edge/")[1])||void 0),n.add("opr",parseFloat(t.split("OPR/")[1])||void 0),n.add("webkit",!n("wp")&&!n("edge")&&parseFloat(t.split("WebKit/")[1])||void 0),n.add("chrome",!n("edge")&&!n("opr")&&parseFloat(t.split("Chrome/")[1])||void 0),n.add("android",!n("wp")&&parseFloat(t.split("Android ")[1])||void 0),n.add("safari",!r.includes("Safari")||n("wp")||n("chrome")||n("android")||n("edge")||n("opr")?void 0:parseFloat(r.split("Version/")[1])),n.add("mac",r.includes("Macintosh")),!n("wp")&&/(iPhone|iPod|iPad)/.test(t)){const e=RegExp.$1.replace(/P/,"p"),r=/OS ([\d_]+)/.test(t)?RegExp.$1:"1",i=parseFloat(r.replace(/_/,".").replaceAll("_",""));n.add(e,i),n.add("ios",i)}n("webkit")||(!t.includes("Gecko")||n("wp")||n("khtml")||n("edge")||n.add("mozilla",i),n("mozilla")&&n.add("ff",parseFloat(t.split("Firefox/")[1]||t.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),r=/iPhone/i.test(e);t&&n.add("esri-mobile",t),r&&n.add("esri-iPhone",r),n.add("esri-geolocation",!!navigator.geolocation)}n.add("esri-wasm","WebAssembly"in globalThis),n.add("esri-performance-mode-frames-between-render",20),n.add("esri-force-performance-mode",!1),n.add("esri-shared-array-buffer",(()=>{const e="SharedArrayBuffer"in globalThis,t=!1===globalThis.crossOriginIsolated;return e&&!t})),n.add("wasm-simd",(()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])))),n.add("esri-atomics","Atomics"in globalThis),n.add("esri-workers","Worker"in globalThis),n.add("web-feat:cache","caches"in globalThis),n.add("esri-workers-arraybuffer-transfer",!n("safari")||Number(n("safari"))>=12),n.add("workers-pool-size",8),n.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),n.add("featurelayer-simplify-payload-size-factors",[1,1,4]),n.add("featurelayer-fast-triangulation-enabled",!0),n.add("featurelayer-animation-enabled",!0),n.add("featurelayer-snapshot-enabled",!0),n.add("featurelayer-snapshot-point-min-threshold",8e4),n.add("featurelayer-snapshot-point-max-threshold",4e5),n.add("featurelayer-snapshot-point-coverage",.1),n.add("featurelayer-query-max-depth",4),n.add("featurelayer-query-pausing-enabled",!1),n.add("featurelayer-advanced-symbols",!1),n.add("featurelayer-pbf",!0),n.add("featurelayer-pbf-statistics",!1),n.add("feature-layers-workers",!0),n.add("feature-polyline-generalization-factor",1),n.add("mapview-transitions-duration",200),n.add("mapview-essential-goto-duration",200),n.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),n.add("mapserver-pbf-version-support",10.81),n.add("mapservice-popup-identify-max-tolerance",20),n("host-webworker")||n("host-browser")&&(n.add("esri-csp-restrictions",(()=>{try{new Function}catch{return!0}return!1})),n.add("esri-image-decode",(()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then((()=>{n.add("esri-image-decode",!0,!0,!0)})).catch((()=>{n.add("esri-image-decode",!1,!0,!0)}))}return!1})),n.add("esri-url-encodes-apostrophe",(()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")})))})()},16770:(e,t,r)=>{"use strict";r.d(t,{M5:()=>p,eV:()=>h,xR:()=>u});var i=r(3825),n=r(50076),s=r(50346),o=r(90534),a=r(59056);let l=null,c=!0;function u(e,t,r){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(c)try{return new ImageData(e,t)}catch(i){c=!1}return d(e,t,r)}function h(e,t,r,i){if(!t||!r)throw new Error("Cannot construct image data without dimensions");if(c)try{return new ImageData(e,t,r)}catch(l){c=!1}const n=d(t,r,i);return n.data.set(e,0),n}function d(e,t,r){return r||(l||(l=document.createElement("canvas"),l.width=1,l.height=1),r=l),r.getContext("2d").createImageData(e,t)}async function p(e,t){const{arrayBuffer:l,mediaType:u}=await async function(e,t){const r=(0,o.r$)(e);if(r?.isBase64)return{arrayBuffer:(0,a.M)(r.data),mediaType:r.mediaType};const n=await(0,i.A)(e,{responseType:"array-buffer",...t});return{arrayBuffer:n.data,mediaType:n.getHeader?.("Content-Type")??""}}(e,t),h="image/png"===u;if("image/gif"===u){const{isAnimatedGIF:e,parseGif:i}=await r.e(3078).then(r.bind(r,3078));if(e(l))return i(l,t)}if(h){const{isAnimatedPNG:e,parseApng:i}=await r.e(6588).then(r.bind(r,56588));if(e(l))return i(l,t)}return async function(e,t){const r=window.URL.createObjectURL(e);try{const{data:e}=await(0,i.A)(r,{...t,responseType:"image"});return e}catch(c){if(!(0,s.zf)(c))throw new n.A("invalid-image",`Could not fetch requested image at ${r}`);throw c}finally{window.URL.revokeObjectURL(r)}}(new Blob([l],{type:u}),t)}},85361:(e,t,r)=>{"use strict";function i(e){const t=[];return function*(){yield*t;for(const r of e)t.push(r),yield r}}function n(e,t){for(const r of e)if(null!=r&&t(r))return r}function s(e){return null!=e&&"function"==typeof e[Symbol.iterator]}r.d(t,{I6:()=>n,PP:()=>i,xZ:()=>s})},45802:(e,t,r)=>{"use strict";r.d(t,{J:()=>n,O:()=>o});var i=r(48611);class n{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ignoreUnknown:!1,useNumericKeys:!1};this._jsonToAPI=e,this._options=t,this.apiValues=[],this.jsonValues=[],this._apiToJSON=function(e){const t={};for(const r in e)t[e[r]]=r;return t}(e),this.apiValues=s(this._apiToJSON),this.jsonValues=s(this._jsonToAPI),this.read=e=>this.fromJSON(e),this.write=(e,t,r)=>{const n=this.toJSON(e);void 0!==n&&(0,i.sM)(r,n,t)},this.write.isJSONMapWriter=!0}toJSON(e){if(null==e)return null;if(this._apiToJSON.hasOwnProperty(e)){const t=this._apiToJSON[e];return this._options.useNumericKeys?+t:t}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return null!=e&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}}function s(e){const t=[];for(const r in e)t.push(r);return t.sort(),t}function o(){return function(e,t){return new n(e,{ignoreUnknown:!0,...t})}}},53084:(e,t,r)=>{"use strict";r.d(t,{Nb:()=>l,TU:()=>a,aI:()=>p,gh:()=>f,o8:()=>o,oy:()=>s});var i=r(18690),n=r(78393);function s(e,t){let r;if(t)for(r in e)e.hasOwnProperty(r)&&(void 0===e[r]?delete e[r]:e[r]instanceof Object&&s(e[r],!0));else for(r in e)e.hasOwnProperty(r)&&void 0===e[r]&&delete e[r];return e}function o(e){if(!e||"object"!=typeof e||"function"==typeof e)return e;const t=d(e);if(null!=t)return t;if(l(e))return e.clone();if(c(e))return e.map(o);if(u(e))return e.clone();const r={};for(const i of Object.getOwnPropertyNames(e))r[i]=o(e[i]);return r}function a(e){if(!e||"object"!=typeof e||"function"==typeof e||"HTMLElement"in globalThis&&e instanceof HTMLElement)return e;const t=d(e);if(null!=t)return t;if(c(e)){let t=!0;const r=e.map((e=>{const r=a(e);return null!=e&&null==r&&(t=!1),r}));return t?r:null}if(l(e))return e.clone();if(e instanceof File||e instanceof Blob)return e;if(!u(e)){const t=new(0,Object.getPrototypeOf(e).constructor);for(const r of Object.getOwnPropertyNames(e)){const i=e[r],n=a(i);if(null!=i&&null==n)return null;t[r]=n}return t}return null}function l(e){return"function"==typeof e.clone}function c(e){return"function"==typeof e.map&&"function"==typeof e.forEach}function u(e){return"function"==typeof e.notifyChange&&"function"==typeof e.watch}function h(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function d(e){if((0,n.dz)(e)||(0,n.mg)(e)||(0,n.UR)(e)||(0,n.IY)(e)||(0,n.jq)(e)||(0,n._G)(e)||(0,n.XJ)(e)||(0,n.vZ)(e)||(0,n.aI)(e))return e.slice();if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;for(const[r,i]of e)t.set(r,o(i));return t}if(e instanceof Set){const t=new Set;for(const r of e)t.add(o(r));return t}return null}function p(e,t){return e===t||"number"==typeof e&&isNaN(e)&&"number"==typeof t&&isNaN(t)||"function"==typeof e?.getTime&&"function"==typeof t?.getTime&&e.getTime()===t.getTime()||!1}function f(e,t){return e===t||(null==e||"string"==typeof e?e===t:"number"==typeof e?e===t||"number"==typeof t&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&(0,i.aI)(e,t):e instanceof Set?t instanceof Set&&function(e,t){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}(e,t):e instanceof Map?t instanceof Map&&function(e,t){if(e.size!==t.size)return!1;for(const[r,i]of e){const e=t.get(r);if(e!==i||void 0===e&&!t.has(r))return!1}return!0}(e,t):!!h(e)&&h(t)&&function(e,t){if(null===e||null===t)return!1;const r=Object.keys(e);if(null===t||Object.keys(t).length!==r.length)return!1;for(const i of r)if(e[i]!==t[i]||!Object.prototype.hasOwnProperty.call(t,i))return!1;return!0}(e,t))}},98006:(e,t,r)=>{"use strict";function i(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function n(e,t,r,i){const n=t[i],s=t[i+1];e[i]=r[0]*n+r[2]*s+r[4],e[i+1]=r[1]*n+r[3]*s+r[5]}function s(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;const o=(arguments.length>4&&void 0!==arguments[4]?arguments[4]:0)||t.length/s;for(let a=i;a<o;a++)n(e,t,r,a*s)}r.d(t,{gb:()=>s,vt:()=>i});Object.freeze(Object.defineProperty({__proto__:null,clone:function(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},create:i,createView:function(e,t){return new Float32Array(e,t,6)},fromValues:function(e,t,r,i,n,s){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o},transform:n,transformMany:s},Symbol.toStringTag,{value:"Module"}))},85827:(e,t,r)=>{"use strict";function i(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function n(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function s(e,t,r,i,n,s,o,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=n,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c}r.d(t,{fA:()=>s,o8:()=>n,vt:()=>i});Object.freeze(Object.defineProperty({__proto__:null,clone:n,create:i,createView:function(e,t){return new Float32Array(e,t,9)},fromValues:s},Symbol.toStringTag,{value:"Module"}))},44680:(e,t,r)=>{"use strict";function i(){return[1,0,0,0,1,0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function s(e,t,r,i,n,s,o,a,l){return[e,t,r,i,n,s,o,a,l]}r.d(t,{fA:()=>s,o8:()=>n,vt:()=>i,zK:()=>o});const o=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:n,create:i,createView:function(e,t){return new Float64Array(e,t,9)},fromValues:s},Symbol.toStringTag,{value:"Module"}))},13191:(e,t,r)=>{"use strict";function i(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function s(e,t,r,i,n,s,o,a,l,c,u,h,d,p,f,m){return[e,t,r,i,n,s,o,a,l,c,u,h,d,p,f,m]}r.d(t,{fA:()=>s,o8:()=>n,vt:()=>i,zK:()=>o});const o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:n,create:i,createView:function(e,t){return new Float64Array(e,t,16)},fromValues:s},Symbol.toStringTag,{value:"Module"}))},4336:(e,t,r)=>{"use strict";function i(){return[0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3]]}function s(e,t,r,i){return[e,t,r,i]}r.d(t,{fA:()=>s,o8:()=>n,vt:()=>i,zK:()=>o});const o=[0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:n,create:i,createView:function(e,t){return new Float64Array(e,t,4)},fromValues:s},Symbol.toStringTag,{value:"Module"}))},59422:(e,t,r)=>{"use strict";function i(){return new Float32Array(2)}function n(e,t){const r=new Float32Array(2);return r[0]=e,r[1]=t,r}function s(){return i()}function o(){return n(1,1)}function a(){return n(1,0)}function l(){return n(0,1)}r.d(t,{Un:()=>u,fA:()=>n,uY:()=>c,vt:()=>i});const c=s(),u=o(),h=a(),d=l();Object.freeze(Object.defineProperty({__proto__:null,ONES:u,UNIT_X:h,UNIT_Y:d,ZEROS:c,clone:function(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},create:i,createView:function(e,t){return new Float32Array(e,t,2)},fromValues:n,ones:o,unitX:a,unitY:l,zeros:s},Symbol.toStringTag,{value:"Module"}))},72745:(e,t,r)=>{"use strict";function i(){return[0,0]}function n(e){return[e[0],e[1]]}function s(e,t){return[e,t]}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];const r=Math.min(2,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function a(){return[0,0]}function l(){return s(1,1)}function c(){return s(1,0)}function u(){return s(0,1)}r.d(t,{Cw:()=>p,JP:()=>f,Un:()=>d,ci:()=>o,fA:()=>s,o8:()=>n,uY:()=>h,vt:()=>i});const h=[0,0],d=l(),p=c(),f=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:p,UNIT_Y:f,ZEROS:h,clone:n,create:i,createView:function(e,t){return new Float64Array(e,t,2)},fromArray:o,fromValues:s,ones:l,unitX:c,unitY:u,zeros:a},Symbol.toStringTag,{value:"Module"}))},83755:(e,t,r)=>{"use strict";function i(){return new Float32Array(3)}function n(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function s(e,t,r){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function o(){return i()}function a(){return s(1,1,1)}function l(){return s(1,0,0)}function c(){return s(0,1,0)}function u(){return s(0,0,1)}r.d(t,{Ul:()=>o,fA:()=>s,o8:()=>n,vt:()=>i});const h=o(),d=a(),p=l(),f=c(),m=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:p,UNIT_Y:f,UNIT_Z:m,ZEROS:h,clone:n,create:i,createView:function(e,t){return new Float32Array(e,t,3)},fromValues:s,ones:a,unitX:l,unitY:c,unitZ:u,zeros:o},Symbol.toStringTag,{value:"Module"}))},9392:(e,t,r)=>{"use strict";function i(){return[0,0,0]}function n(e){return[e[0],e[1],e[2]]}function s(e,t,r){return[e,t,r]}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];const r=Math.min(3,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function a(){return[0,0,0]}function l(){return s(1,1,1)}function c(){return s(1,0,0)}function u(){return s(0,1,0)}function h(){return s(0,0,1)}r.d(t,{Cb:()=>g,Cw:()=>f,JP:()=>m,TS:()=>h,Ul:()=>a,Un:()=>p,ci:()=>o,fA:()=>s,o8:()=>n,uY:()=>d,vt:()=>i});const d=[0,0,0],p=l(),f=c(),m=u(),g=h();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_X:f,UNIT_Y:m,UNIT_Z:g,ZEROS:d,clone:n,create:i,createView:function(e,t){return new Float64Array(e,t,3)},fromArray:o,fromValues:s,ones:l,unitX:c,unitY:u,unitZ:h,zeros:a},Symbol.toStringTag,{value:"Module"}))},55855:(e,t,r)=>{"use strict";function i(){return[0,0,0,0]}function n(e){return[e[0],e[1],e[2],e[3]]}function s(e,t,r,i){return[e,t,r,i]}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0];const r=Math.min(4,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function a(){return[0,0,0,0]}function l(){return s(1,1,1,1)}function c(){return s(1,0,0,0)}function u(){return s(0,1,0,0)}function h(){return s(0,0,1,0)}function d(){return s(0,0,0,1)}r.d(t,{Un:()=>f,ci:()=>o,fA:()=>s,o8:()=>n,uY:()=>p,vt:()=>i});const p=[0,0,0,0],f=l(),m=c(),g=u(),y=h(),_=d();Object.freeze(Object.defineProperty({__proto__:null,ONES:f,UNIT_W:_,UNIT_X:m,UNIT_Y:g,UNIT_Z:y,ZEROS:p,clone:n,create:i,createView:function(e,t){return new Float64Array(e,t,4)},fromArray:o,fromValues:s,ones:l,unitW:d,unitX:c,unitY:u,unitZ:h,zeros:a},Symbol.toStringTag,{value:"Module"}))},53494:(e,t,r)=>{"use strict";r.d(t,{DF:()=>l,FD:()=>n,Ov:()=>s,ct:()=>c});let i=1e-6;function n(){return i}const s=Math.random,o=Math.PI/180,a=180/Math.PI;function l(e){return e*o}function c(e){return e*a}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:s,equals:function(e,t){return Math.abs(e-t)<=i*Math.max(1,Math.abs(e),Math.abs(t))},getEpsilon:n,setEpsilon:function(e){i=e},toDegree:c,toRadian:l},Symbol.toStringTag,{value:"Module"}))},94967:(e,t,r)=>{"use strict";r.d(t,{$0:()=>u,B8:()=>s,D_:()=>n,Tl:()=>c,e$:()=>a,hs:()=>l,lw:()=>o});var i=r(53494);function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function s(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5];let l=r*s-i*n;return l?(l=1/l,e[0]=s*l,e[1]=-i*l,e[2]=-n*l,e[3]=r*l,e[4]=(n*a-s*o)*l,e[5]=(i*o-r*a)*l,e):null}function o(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=r[0],u=r[1],h=r[2],d=r[3],p=r[4],f=r[5];return e[0]=i*c+s*u,e[1]=n*c+o*u,e[2]=i*h+s*d,e[3]=n*h+o*d,e[4]=i*p+s*f+a,e[5]=n*p+o*f+l,e}function a(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(r),u=Math.cos(r);return e[0]=i*u+s*c,e[1]=n*u+o*c,e[2]=i*-c+s*u,e[3]=n*-c+o*u,e[4]=a,e[5]=l,e}function l(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=r[0],u=r[1];return e[0]=i*c,e[1]=n*c,e[2]=s*u,e[3]=o*u,e[4]=a,e[5]=l,e}function c(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=r[0],u=r[1];return e[0]=i,e[1]=n,e[2]=s,e[3]=o,e[4]=i*c+s*u+a,e[5]=n*c+o*u+l,e}function u(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function h(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}const d=o,p=h;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},equals:function(e,t){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=t[0],u=t[1],h=t[2],d=t[3],p=t[4],f=t[5],m=(0,i.FD)();return Math.abs(r-c)<=m*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-u)<=m*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-h)<=m*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-d)<=m*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-p)<=m*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(l-f)<=m*Math.max(1,Math.abs(l),Math.abs(f))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},fromRotation:u,fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},identity:n,invert:s,mul:d,multiply:o,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e},rotate:a,scale:l,set:function(e,t,r,i,n,s,o){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=o,e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},sub:p,subtract:h,translate:c},Symbol.toStringTag,{value:"Module"}))},63919:(e,t,r)=>{"use strict";r.d(t,{B8:()=>l,D_:()=>o,Ge:()=>g,I0:()=>f,KC:()=>c,Tl:()=>h,dR:()=>m,e$:()=>d,hZ:()=>s,hs:()=>p,lw:()=>u,mg:()=>a,z0:()=>n});var i=r(53494);function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function s(e,t,r,i,n,s,o,a,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function o(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function a(e,t){if(e===t){const r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function l(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*o-a*c,d=-u*s+a*l,p=c*s-o*l;let f=r*h+i*d+n*p;return f?(f=1/f,e[0]=h*f,e[1]=(-u*i+n*c)*f,e[2]=(a*i-n*o)*f,e[3]=d*f,e[4]=(u*r-n*l)*f,e[5]=(-a*r+n*s)*f,e[6]=p*f,e[7]=(-c*r+i*l)*f,e[8]=(o*r-i*s)*f,e):null}function c(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=o*u-a*c,e[1]=n*c-i*u,e[2]=i*a-n*o,e[3]=a*l-s*u,e[4]=r*u-n*l,e[5]=n*s-r*a,e[6]=s*c-o*l,e[7]=i*l-r*c,e[8]=r*o-i*s,e}function u(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=r[0],p=r[1],f=r[2],m=r[3],g=r[4],y=r[5],_=r[6],v=r[7],b=r[8];return e[0]=d*i+p*o+f*c,e[1]=d*n+p*a+f*u,e[2]=d*s+p*l+f*h,e[3]=m*i+g*o+y*c,e[4]=m*n+g*a+y*u,e[5]=m*s+g*l+y*h,e[6]=_*i+v*o+b*c,e[7]=_*n+v*a+b*u,e[8]=_*s+v*l+b*h,e}function h(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=r[0],p=r[1];return e[0]=i,e[1]=n,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=d*i+p*o+c,e[7]=d*n+p*a+u,e[8]=d*s+p*l+h,e}function d(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(r),p=Math.cos(r);return e[0]=p*i+d*o,e[1]=p*n+d*a,e[2]=p*s+d*l,e[3]=p*o-d*i,e[4]=p*a-d*n,e[5]=p*l-d*s,e[6]=c,e[7]=u,e[8]=h,e}function p(e,t,r){const i=r[0],n=r[1],s=r[2];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=s*t[6],e[7]=s*t[7],e[8]=s*t[8],e}function f(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=r+r,a=i+i,l=n+n,c=r*o,u=i*o,h=i*a,d=n*o,p=n*a,f=n*l,m=s*o,g=s*a,y=s*l;return e[0]=1-h-f,e[3]=u-y,e[6]=d+g,e[1]=u+y,e[4]=1-c-f,e[7]=p-m,e[2]=d-g,e[5]=p+m,e[8]=1-c-h,e}function m(e,t){const r=t[0],i=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10],h=u*o-a*c,d=-u*s+a*l,p=c*s-o*l,f=r*h+i*d+n*p;if(!f)return null;const m=1/f;return e[0]=h*m,e[1]=(-u*i+n*c)*m,e[2]=(a*i-n*o)*m,e[3]=d*m,e[4]=(u*r-n*l)*m,e[5]=(-a*r+n*s)*m,e[6]=p*m,e[7]=(-c*r+i*l)*m,e[8]=(o*r-i*s)*m,e}function g(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=r*a-i*o,v=r*l-n*o,b=r*c-s*o,w=i*l-n*a,x=i*c-s*a,S=n*c-s*l,T=u*m-h*f,M=u*g-d*f,A=u*y-p*f,C=h*g-d*m,E=h*y-p*m,R=d*y-p*g;let P=_*R-v*E+b*C+w*A-x*M+S*T;return P?(P=1/P,e[0]=(a*R-l*E+c*C)*P,e[1]=(l*A-o*R-c*M)*P,e[2]=(o*E-a*A+c*T)*P,e[3]=(n*E-i*R-s*C)*P,e[4]=(r*R-n*A+s*M)*P,e[5]=(i*A-r*E-s*T)*P,e[6]=(m*S-g*x+y*w)*P,e[7]=(g*b-f*S-y*v)*P,e[8]=(f*x-m*b+y*_)*P,e):null}function y(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}const _=u,v=y;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},adjoint:c,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},determinant:function(e){const t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*s-o*l)+r*(-c*n+o*a)+i*(l*n-s*a)},equals:function(e,t){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=t[0],p=t[1],f=t[2],m=t[3],g=t[4],y=t[5],_=t[6],v=t[7],b=t[8],w=(0,i.FD)();return Math.abs(r-d)<=w*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-p)<=w*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-f)<=w*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(o-m)<=w*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-g)<=w*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-y)<=w*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-_)<=w*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(u-v)<=w*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(h-b)<=w*Math.max(1,Math.abs(h),Math.abs(b))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromMat4:n,fromQuat:f,fromRotation:function(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},identity:o,invert:l,isOrthoNormal:function(e){const t=(0,i.FD)(),r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8];return Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(n*n+a*a+u*u))<=t&&Math.abs(1-(s*s+l*l+h*h))<=t},mul:_,multiply:u,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e},normalFromMat4:g,normalFromMat4Legacy:m,projection:function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},rotate:d,scale:p,scaleByVec2:function(e,t,r){const i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e},set:s,str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},sub:v,subtract:y,translate:h,transpose:a},Symbol.toStringTag,{value:"Module"}))},34761:(e,t,r)=>{"use strict";r.d(t,{$0:()=>b,$h:()=>I,B8:()=>u,C:()=>s,CV:()=>v,D_:()=>a,I0:()=>O,IL:()=>C,N9:()=>S,O7:()=>P,Qr:()=>y,Qw:()=>c,Tl:()=>d,Z8:()=>g,aI:()=>z,e$:()=>f,eL:()=>m,hM:()=>w,hZ:()=>o,hs:()=>p,i1:()=>x,kN:()=>_,l:()=>E,lK:()=>B,lw:()=>h,mg:()=>l,o1:()=>R,sC:()=>A,t2:()=>k,t5:()=>N,tZ:()=>V,ut:()=>U,v3:()=>L,xI:()=>D});var i=r(9392),n=r(53494);function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function o(e,t,r,i,n,s,o,a,l,c,u,h,d,p,f,m,g){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=g,e}function a(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function l(e,t){if(e===t){const r=t[1],i=t[2],n=t[3],s=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=n,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function c(e,t){return u(e,t)||a(e),e}function u(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=r*a-i*o,v=r*l-n*o,b=r*c-s*o,w=i*l-n*a,x=i*c-s*a,S=n*c-s*l,T=u*m-h*f,M=u*g-d*f,A=u*y-p*f,C=h*g-d*m,E=h*y-p*m,R=d*y-p*g;let P=_*R-v*E+b*C+w*A-x*M+S*T;return P?(P=1/P,e[0]=(a*R-l*E+c*C)*P,e[1]=(n*E-i*R-s*C)*P,e[2]=(m*S-g*x+y*w)*P,e[3]=(d*x-h*S-p*w)*P,e[4]=(l*A-o*R-c*M)*P,e[5]=(r*R-n*A+s*M)*P,e[6]=(g*b-f*S-y*v)*P,e[7]=(u*S-d*b+p*v)*P,e[8]=(o*E-a*A+c*T)*P,e[9]=(i*A-r*E-s*T)*P,e[10]=(f*x-m*b+y*_)*P,e[11]=(h*b-u*x-p*_)*P,e[12]=(a*M-o*C-l*T)*P,e[13]=(r*C-i*M+n*T)*P,e[14]=(m*v-f*w-g*_)*P,e[15]=(u*w-h*v+d*_)*P,e):null}function h(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],y=t[14],_=t[15];let v=r[0],b=r[1],w=r[2],x=r[3];return e[0]=v*i+b*a+w*h+x*m,e[1]=v*n+b*l+w*d+x*g,e[2]=v*s+b*c+w*p+x*y,e[3]=v*o+b*u+w*f+x*_,v=r[4],b=r[5],w=r[6],x=r[7],e[4]=v*i+b*a+w*h+x*m,e[5]=v*n+b*l+w*d+x*g,e[6]=v*s+b*c+w*p+x*y,e[7]=v*o+b*u+w*f+x*_,v=r[8],b=r[9],w=r[10],x=r[11],e[8]=v*i+b*a+w*h+x*m,e[9]=v*n+b*l+w*d+x*g,e[10]=v*s+b*c+w*p+x*y,e[11]=v*o+b*u+w*f+x*_,v=r[12],b=r[13],w=r[14],x=r[15],e[12]=v*i+b*a+w*h+x*m,e[13]=v*n+b*l+w*d+x*g,e[14]=v*s+b*c+w*p+x*y,e[15]=v*o+b*u+w*f+x*_,e}function d(e,t,r){const i=r[0],n=r[1],s=r[2];if(t===e)e[12]=t[0]*i+t[4]*n+t[8]*s+t[12],e[13]=t[1]*i+t[5]*n+t[9]*s+t[13],e[14]=t[2]*i+t[6]*n+t[10]*s+t[14],e[15]=t[3]*i+t[7]*n+t[11]*s+t[15];else{const r=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7],p=t[8],f=t[9],m=t[10],g=t[11];e[0]=r,e[1]=o,e[2]=a,e[3]=l,e[4]=c,e[5]=u,e[6]=h,e[7]=d,e[8]=p,e[9]=f,e[10]=m,e[11]=g,e[12]=r*i+c*n+p*s+t[12],e[13]=o*i+u*n+f*s+t[13],e[14]=a*i+h*n+m*s+t[14],e[15]=l*i+d*n+g*s+t[15]}return e}function p(e,t,r){const i=r[0],n=r[1],s=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function f(e,t,r,i){let s,o,a,l,c,u,h,d,p,f,m,g,y,_,v,b,w,x,S,T,M,A,C,E,R=i[0],P=i[1],O=i[2],I=Math.sqrt(R*R+P*P+O*O);return I<(0,n.FD)()?null:(I=1/I,R*=I,P*=I,O*=I,s=Math.sin(r),o=Math.cos(r),a=1-o,l=t[0],c=t[1],u=t[2],h=t[3],d=t[4],p=t[5],f=t[6],m=t[7],g=t[8],y=t[9],_=t[10],v=t[11],b=R*R*a+o,w=P*R*a+O*s,x=O*R*a-P*s,S=R*P*a-O*s,T=P*P*a+o,M=O*P*a+R*s,A=R*O*a+P*s,C=P*O*a-R*s,E=O*O*a+o,e[0]=l*b+d*w+g*x,e[1]=c*b+p*w+y*x,e[2]=u*b+f*w+_*x,e[3]=h*b+m*w+v*x,e[4]=l*S+d*T+g*M,e[5]=c*S+p*T+y*M,e[6]=u*S+f*T+_*M,e[7]=h*S+m*T+v*M,e[8]=l*A+d*C+g*E,e[9]=c*A+p*C+y*E,e[10]=u*A+f*C+_*E,e[11]=h*A+m*C+v*E,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function m(e,t,r){const i=Math.sin(r),n=Math.cos(r),s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+c*i,e[5]=o*n+u*i,e[6]=a*n+h*i,e[7]=l*n+d*i,e[8]=c*n-s*i,e[9]=u*n-o*i,e[10]=h*n-a*i,e[11]=d*n-l*i,e}function g(e,t,r){const i=Math.sin(r),n=Math.cos(r),s=t[0],o=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-c*i,e[1]=o*n-u*i,e[2]=a*n-h*i,e[3]=l*n-d*i,e[8]=s*i+c*n,e[9]=o*i+u*n,e[10]=a*i+h*n,e[11]=l*i+d*n,e}function y(e,t,r){const i=Math.sin(r),n=Math.cos(r),s=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+c*i,e[1]=o*n+u*i,e[2]=a*n+h*i,e[3]=l*n+d*i,e[4]=c*n-s*i,e[5]=u*n-o*i,e[6]=h*n-a*i,e[7]=d*n-l*i,e}function _(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function v(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function b(e,t,r){if(0===t)return a(e);let i,s,o,l=r[0],c=r[1],u=r[2],h=Math.sqrt(l*l+c*c+u*u);return h<(0,n.FD)()?null:(h=1/h,l*=h,c*=h,u*=h,i=Math.sin(t),s=Math.cos(t),o=1-s,e[0]=l*l*o+s,e[1]=c*l*o+u*i,e[2]=u*l*o-c*i,e[3]=0,e[4]=l*c*o-u*i,e[5]=c*c*o+s,e[6]=u*c*o+l*i,e[7]=0,e[8]=l*u*o+c*i,e[9]=c*u*o-l*i,e[10]=u*u*o+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function w(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function x(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function S(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function T(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=i+i,l=n+n,c=s+s,u=i*a,h=i*l,d=i*c,p=n*l,f=n*c,m=s*c,g=o*a,y=o*l,_=o*c;return e[0]=1-(p+m),e[1]=h+_,e[2]=d-y,e[3]=0,e[4]=h-_,e[5]=1-(u+m),e[6]=f+g,e[7]=0,e[8]=d+y,e[9]=f-g,e[10]=1-(u+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}const M=(0,i.vt)();function A(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function C(e,t){const r=t[0],i=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+i*i+n*n),e[1]=Math.sqrt(s*s+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e}function E(e,t){const r=t[0]+t[5]+t[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e}function R(e,t,r,i){const n=t[0],s=t[1],o=t[2],a=t[3],l=n+n,c=s+s,u=o+o,h=n*l,d=n*c,p=n*u,f=s*c,m=s*u,g=o*u,y=a*l,_=a*c,v=a*u,b=i[0],w=i[1],x=i[2];return e[0]=(1-(f+g))*b,e[1]=(d+v)*b,e[2]=(p-_)*b,e[3]=0,e[4]=(d-v)*w,e[5]=(1-(h+g))*w,e[6]=(m+y)*w,e[7]=0,e[8]=(p+_)*x,e[9]=(m-y)*x,e[10]=(1-(h+f))*x,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function P(e,t,r,i,n){const s=t[0],o=t[1],a=t[2],l=t[3],c=s+s,u=o+o,h=a+a,d=s*c,p=s*u,f=s*h,m=o*u,g=o*h,y=a*h,_=l*c,v=l*u,b=l*h,w=i[0],x=i[1],S=i[2],T=n[0],M=n[1],A=n[2],C=(1-(m+y))*w,E=(p+b)*w,R=(f-v)*w,P=(p-b)*x,O=(1-(d+y))*x,I=(g+_)*x,L=(f+v)*S,N=(g-_)*S,D=(1-(d+m))*S;return e[0]=C,e[1]=E,e[2]=R,e[3]=0,e[4]=P,e[5]=O,e[6]=I,e[7]=0,e[8]=L,e[9]=N,e[10]=D,e[11]=0,e[12]=r[0]+T-(C*T+P*M+L*A),e[13]=r[1]+M-(E*T+O*M+N*A),e[14]=r[2]+A-(R*T+I*M+D*A),e[15]=1,e}function O(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=r+r,a=i+i,l=n+n,c=r*o,u=i*o,h=i*a,d=n*o,p=n*a,f=n*l,m=s*o,g=s*a,y=s*l;return e[0]=1-h-f,e[1]=u+y,e[2]=d-g,e[3]=0,e[4]=u-y,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function I(e,t,r,i,n,s,o){const a=1/(r-t),l=1/(n-i),c=1/(s-o);return e[0]=2*s*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(n+i)*l,e[10]=(o+s)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*c,e[15]=0,e}function L(e,t,r,i,n,s,o){const a=1/(t-r),l=1/(i-n),c=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(n+i)*l,e[14]=(o+s)*c,e[15]=1,e}function N(e,t,r,i){const s=t[0],o=t[1],l=t[2];let c=s-r[0],u=o-r[1],h=l-r[2];const d=(0,n.FD)();if(Math.abs(c)<d&&Math.abs(u)<d&&Math.abs(h)<d)return void a(e);let p=1/Math.sqrt(c*c+u*u+h*h);c*=p,u*=p,h*=p;const f=i[0],m=i[1],g=i[2];let y=m*h-g*u,_=g*c-f*h,v=f*u-m*c;p=Math.sqrt(y*y+_*_+v*v),p?(p=1/p,y*=p,_*=p,v*=p):(y=0,_=0,v=0);let b=u*v-h*_,w=h*y-c*v,x=c*_-u*y;p=Math.sqrt(b*b+w*w+x*x),p?(p=1/p,b*=p,w*=p,x*=p):(b=0,w=0,x=0),e[0]=y,e[1]=b,e[2]=c,e[3]=0,e[4]=_,e[5]=w,e[6]=u,e[7]=0,e[8]=v,e[9]=x,e[10]=h,e[11]=0,e[12]=-(y*s+_*o+v*l),e[13]=-(b*s+w*o+x*l),e[14]=-(c*s+u*o+h*l),e[15]=1}function D(e,t,r,i){const n=t[0],s=t[1],o=t[2],a=i[0],l=i[1],c=i[2];let u=n-r[0],h=s-r[1],d=o-r[2],p=u*u+h*h+d*d;p>0&&(p=1/Math.sqrt(p),u*=p,h*=p,d*=p);let f=l*d-c*h,m=c*u-a*d,g=a*h-l*u;return p=f*f+m*m+g*g,p>0&&(p=1/Math.sqrt(p),f*=p,m*=p,g*=p),e[0]=f,e[1]=m,e[2]=g,e[3]=0,e[4]=h*g-d*m,e[5]=d*f-u*g,e[6]=u*m-h*f,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=n,e[13]=s,e[14]=o,e[15]=1,e}function F(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function k(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function z(e,t){if(e===t)return!0;const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],y=e[14],_=e[15],v=t[0],b=t[1],w=t[2],x=t[3],S=t[4],T=t[5],M=t[6],A=t[7],C=t[8],E=t[9],R=t[10],P=t[11],O=t[12],I=t[13],L=t[14],N=t[15],D=(0,n.FD)();return Math.abs(r-v)<=D*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(i-b)<=D*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(s-w)<=D*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(o-x)<=D*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-S)<=D*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(l-T)<=D*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-M)<=D*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(u-A)<=D*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(h-C)<=D*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(d-E)<=D*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(p-R)<=D*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(f-P)<=D*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-O)<=D*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(g-I)<=D*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(y-L)<=D*Math.max(1,Math.abs(y),Math.abs(L))&&Math.abs(_-N)<=D*Math.max(1,Math.abs(_),Math.abs(N))}function U(e){const t=(0,n.FD)(),r=e[0],i=e[1],s=e[2],o=e[4],a=e[5],l=e[6],c=e[8],u=e[9],h=e[10];return Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(i*i+a*a+u*u))<=t&&Math.abs(1-(s*s+l*l+h*h))<=t}function V(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[8]&&0===e[9]&&1===e[10]}const B=h,j=F;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},adjoint:function(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15];return e[0]=a*(d*y-p*g)-h*(l*y-c*g)+m*(l*p-c*d),e[1]=-(i*(d*y-p*g)-h*(n*y-s*g)+m*(n*p-s*d)),e[2]=i*(l*y-c*g)-a*(n*y-s*g)+m*(n*c-s*l),e[3]=-(i*(l*p-c*d)-a*(n*p-s*d)+h*(n*c-s*l)),e[4]=-(o*(d*y-p*g)-u*(l*y-c*g)+f*(l*p-c*d)),e[5]=r*(d*y-p*g)-u*(n*y-s*g)+f*(n*p-s*d),e[6]=-(r*(l*y-c*g)-o*(n*y-s*g)+f*(n*c-s*l)),e[7]=r*(l*p-c*d)-o*(n*p-s*d)+u*(n*c-s*l),e[8]=o*(h*y-p*m)-u*(a*y-c*m)+f*(a*p-c*h),e[9]=-(r*(h*y-p*m)-u*(i*y-s*m)+f*(i*p-s*h)),e[10]=r*(a*y-c*m)-o*(i*y-s*m)+f*(i*c-s*a),e[11]=-(r*(a*p-c*h)-o*(i*p-s*h)+u*(i*c-s*a)),e[12]=-(o*(h*g-d*m)-u*(a*g-l*m)+f*(a*d-l*h)),e[13]=r*(h*g-d*m)-u*(i*g-n*m)+f*(i*d-n*h),e[14]=-(r*(a*g-l*m)-o*(i*g-n*m)+f*(i*l-n*a)),e[15]=r*(a*d-l*h)-o*(i*d-n*h)+u*(i*l-n*a),e},copy:s,determinant:function(e){const t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return(t*o-r*s)*(h*g-d*m)-(t*a-i*s)*(u*g-d*f)+(t*l-n*s)*(u*m-h*f)+(r*a-i*o)*(c*g-d*p)-(r*l-n*o)*(c*m-h*p)+(i*l-n*a)*(c*f-u*p)},equals:z,exactEquals:k,frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)},fromQuat:O,fromQuat2:function(e,t){const r=M,i=-t[0],n=-t[1],s=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=i*i+n*n+s*s+o*o;return h>0?(r[0]=2*(a*o+u*i+l*s-c*n)/h,r[1]=2*(l*o+u*n+c*i-a*s)/h,r[2]=2*(c*o+u*s+a*n-l*i)/h):(r[0]=2*(a*o+u*i+l*s-c*n),r[1]=2*(l*o+u*n+c*i-a*s),r[2]=2*(c*o+u*s+a*n-l*i)),T(e,t,r),e},fromRotation:b,fromRotationTranslation:T,fromRotationTranslationScale:R,fromRotationTranslationScaleOrigin:P,fromScaling:v,fromTranslation:_,fromXRotation:w,fromYRotation:x,fromZRotation:S,frustum:I,getRotation:E,getScaling:C,getTranslation:A,hasIdentityRotation:V,identity:a,invert:u,invertOrIdentity:c,isOrthoNormal:U,lookAt:N,mul:B,multiply:h,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e},ortho:L,perspective:function(e,t,r,i,n){const s=1/Math.tan(t/2);let o;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(o=1/(i-n),e[10]=(n+i)*o,e[14]=2*n*i*o):(e[10]=-1,e[14]=-2*i),e},perspectiveFromFieldOfView:function(e,t,r,i){const n=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(n+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(n-s)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e},rotate:f,rotateX:m,rotateY:g,rotateZ:y,scale:p,set:o,str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},sub:j,subtract:F,targetTo:D,translate:d,transpose:l},Symbol.toStringTag,{value:"Module"}))},60008:(e,t,r)=>{"use strict";r.d(t,{A6:()=>g,B8:()=>p,Xd:()=>u,Xr:()=>f,Yc:()=>O,hZ:()=>_,lw:()=>h,t2:()=>R,x8:()=>c});var i=r(44680),n=r(4336),s=r(9392),o=r(53494),a=r(20664),l=r(43047);function c(e,t,r){r*=.5;const i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function u(e,t){const r=2*Math.acos(t[3]),i=Math.sin(r/2);return i>(0,o.FD)()?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function h(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*u+o*a+n*c-s*l,e[1]=n*u+o*l+s*a-i*c,e[2]=s*u+o*c+i*l-n*a,e[3]=o*u-i*a-n*l-s*c,e}function d(e,t,r,i){const n=t[0],s=t[1],a=t[2],l=t[3];let c,u,h,d,p,f=r[0],m=r[1],g=r[2],y=r[3];return u=n*f+s*m+a*g+l*y,u<0&&(u=-u,f=-f,m=-m,g=-g,y=-y),1-u>(0,o.FD)()?(c=Math.acos(u),h=Math.sin(c),d=Math.sin((1-i)*c)/h,p=Math.sin(i*c)/h):(d=1-i,p=i),e[0]=d*n+p*f,e[1]=d*s+p*m,e[2]=d*a+p*g,e[3]=d*l+p*y,e}function p(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=r*r+i*i+n*n+s*s,a=o?1/o:0;return e[0]=-r*a,e[1]=-i*a,e[2]=-n*a,e[3]=s*a,e}function f(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function m(e,t){const r=t[0]+t[4]+t[8];let i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const n=(r+1)%3,s=(r+2)%3;i=Math.sqrt(t[3*r+r]-t[3*n+n]-t[3*s+s]+1),e[r]=.5*i,i=.5/i,e[3]=(t[3*n+s]-t[3*s+n])*i,e[n]=(t[3*n+r]+t[3*r+n])*i,e[s]=(t[3*s+r]+t[3*r+s])*i}return e}function g(e,t,r,i){const n=.5*Math.PI/180;t*=n,r*=n,i*=n;const s=Math.sin(t),o=Math.cos(t),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return e[0]=s*l*u-o*a*c,e[1]=o*a*u+s*l*c,e[2]=o*l*c-s*a*u,e[3]=o*l*u+s*a*c,e}const y=l.c,_=l.s,v=l.f,b=h,w=l.b,x=l.g,S=l.l,T=l.i,M=T,A=l.j,C=A,E=l.n,R=l.a,P=l.e;function O(e,t,r){const i=(0,a.m)(t,r);return i<-.999999?((0,a.b)(I,L,t),(0,a.H)(I)<1e-6&&(0,a.b)(I,N,t),(0,a.n)(I,I),c(e,I,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):((0,a.b)(I,t,r),e[0]=I[0],e[1]=I[1],e[2]=I[2],e[3]=1+i,E(e,e))}const I=(0,s.vt)(),L=(0,s.fA)(1,0,0),N=(0,s.fA)(0,1,0);const D=(0,n.vt)(),F=(0,n.vt)();const k=(0,i.vt)();Object.freeze(Object.defineProperty({__proto__:null,add:v,calculateW:function(e,t){const r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e},conjugate:f,copy:y,dot:x,equals:P,exactEquals:R,fromEuler:g,fromMat3:m,getAxisAngle:u,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},invert:p,len:M,length:T,lerp:S,mul:b,multiply:h,normalize:E,random:function(e){const t=o.Ov,r=t(),i=t(),n=t(),s=Math.sqrt(1-r),a=Math.sqrt(r);return e[0]=s*Math.sin(2*Math.PI*i),e[1]=s*Math.cos(2*Math.PI*i),e[2]=a*Math.sin(2*Math.PI*n),e[3]=a*Math.cos(2*Math.PI*n),e},rotateX:function(e,t,r){r*=.5;const i=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*a,e[1]=n*l+s*a,e[2]=s*l-n*a,e[3]=o*l-i*a,e},rotateY:function(e,t,r){r*=.5;const i=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l-s*a,e[1]=n*l+o*a,e[2]=s*l+i*a,e[3]=o*l-n*a,e},rotateZ:function(e,t,r){r*=.5;const i=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*a,e[1]=n*l-i*a,e[2]=s*l+o*a,e[3]=o*l-s*a,e},rotationTo:O,scale:w,set:_,setAxes:function(e,t,r,i){const n=k;return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],E(e,m(e,n))},setAxisAngle:c,slerp:d,sqlerp:function(e,t,r,i,n,s){return d(D,t,n,s),d(F,r,i,s),d(e,D,F,2*s*(1-s)),e},sqrLen:C,squaredLength:A,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}},Symbol.toStringTag,{value:"Module"}))},19555:(e,t,r)=>{"use strict";r.d(t,{Bw:()=>g,C:()=>n,Cc:()=>w,Io:()=>f,Ln:()=>p,Om:()=>b,Re:()=>a,S8:()=>v,T9:()=>h,Vj:()=>E,WQ:()=>o,ZF:()=>x,aI:()=>C,e$:()=>T,g7:()=>M,hG:()=>m,hZ:()=>s,hs:()=>d,jb:()=>P,jk:()=>u,l0:()=>S,m3:()=>y,t2:()=>A,xg:()=>L,ze:()=>_});var i=r(53494);function n(e,t){return e[0]=t[0],e[1]=t[1],e}function s(e,t,r){return e[0]=t,e[1]=r,e}function o(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function l(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function c(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function u(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function h(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function d(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function p(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function f(e,t){const r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function m(e,t){const r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function g(e){const t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function y(e){const t=e[0],r=e[1];return t*t+r*r}function _(e,t){return e[0]=-t[0],e[1]=-t[1],e}function v(e,t){const r=t[0],i=t[1];let n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e}function b(e,t){return e[0]*t[0]+e[1]*t[1]}function w(e,t,r,i){const n=t[0],s=t[1];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e}function x(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function S(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function T(e,t,r,i){const n=t[0]-r[0],s=t[1]-r[1],o=Math.sin(i),a=Math.cos(i);return e[0]=n*a-s*o+r[0],e[1]=n*o+s*a+r[1],e}function M(e,t){const r=e[0],i=e[1],n=t[0],s=t[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=n*n+s*s;a>0&&(a=1/Math.sqrt(a));const l=(r*n+i*s)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function A(e,t){return e[0]===t[0]&&e[1]===t[1]}function C(e,t){const r=e[0],n=e[1],s=t[0],o=t[1],a=(0,i.FD)();return Math.abs(r-s)<=a*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-o)<=a*Math.max(1,Math.abs(n),Math.abs(o))}function E(e,t,r,i,n){let s=t[0]-r[0],o=t[1]-r[1];const a=(i[0]*s+i[1]*o)*(n-1);return s=i[0]*a,o=i[1]*a,e[0]=t[0]+s,e[1]=t[1]+o,e}const R=g,P=a,O=l,I=c,L=f,N=m,D=y;Object.freeze(Object.defineProperty({__proto__:null,add:o,angle:M,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},copy:n,cross:function(e,t,r){const i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e},dist:L,distance:f,div:I,divide:c,dot:b,equals:C,exactEquals:A,floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},len:R,length:g,lerp:w,max:h,min:u,mul:O,multiply:l,negate:_,normalize:v,projectAndScale:E,random:function(e,t){t=t||1;const r=2*(0,i.Ov)()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},rotate:T,round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:d,scaleAndAdd:p,set:s,sqrDist:N,sqrLen:D,squaredDistance:m,squaredLength:y,str:function(e){return"vec2("+e[0]+", "+e[1]+")"},sub:P,subtract:a,transformMat2:x,transformMat2d:S,transformMat3:function(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e},transformMat4:function(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}},Symbol.toStringTag,{value:"Module"}))},27741:(e,t,r)=>{"use strict";r.d(t,{L:()=>a,g:()=>o});var i=r(98773),n=r(19276),s=r(49304);async function o(e,t){return await e.load(),a(e,t)}async function a(e,t){const r=[],o=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(const a of t)null!=a&&(Array.isArray(a)?o(...a):n.A.isCollection(a)?a.forEach((e=>o(e))):s.A.isLoadable(a)&&r.push(a))};t(o);let a=null;if(await(0,i.Tj)(r,(async e=>{const t=await(0,i.Ke)(function(e){return"loadAll"in e&&"function"==typeof e.loadAll}(e)?e.loadAll():e.load());!1!==t.ok||a||(a=t)})),a)throw a.error;return e}},15941:(e,t,r)=>{"use strict";r.d(t,{$8:()=>M,Cc:()=>u,Io:()=>S,J_:()=>f,KJ:()=>p,Sp:()=>y,TF:()=>C,Vr:()=>c,XM:()=>m,YN:()=>g,b6:()=>T,cU:()=>s,hs:()=>h,jU:()=>E,kU:()=>d,or:()=>R,pq:()=>P,qE:()=>o,r6:()=>a,yR:()=>l});var i=r(20664);const n=new Float32Array(1);function s(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function o(e,t,r){return Math.min(Math.max(e,t),r)}function a(e){return!(e&e-1)}function l(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function c(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function u(e,t,r){return e+(t-e)*r}function h(e,t,r,i,n){return u(i,n,(e-t)/(r-t))}function d(e){return e*Math.PI/180}function p(e){return 180*e/Math.PI}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-6;return(e<0?-1:1)/Math.max(Math.abs(e),t)}function m(e){return Math.acos(o(e,-1,1))}function g(e){return Math.asin(o(e,-1,1))}function y(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6;return e===t||!(!Number.isFinite(e)||!Number.isFinite(t))&&(e>t?e-t:t-e)<=r}const _=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function v(e){return _.setFloat64(0,e),_.getBigInt64(0)}const b=BigInt("1000000"),w=x(1);function x(e){const t=v(e=Math.abs(e)),r=function(e){return _.setBigInt64(0,e),_.getFloat64(0)}(t<=b?b:t-b);return Math.abs(e-r)}function S(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w;if(e===t)return!0;if(!Number.isFinite(e)||!Number.isFinite(t))return!1;if(null!=r&&x(Math.min(Math.abs(e),Math.abs(t)))<r)return Math.abs(e-t)<=r;const i=v(e),n=v(t);return i<0==n<0&&!((i<n?n-i:i-n)>b)}function T(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6;if(e===t)return!0;if(!Number.isFinite(e)||!Number.isFinite(t))return!1;const i=Math.abs(e-t),n=Math.abs(e),s=Math.abs(t);if(0===e||0===t||n<1e-12&&s<1e-12){if(i>.01*r)return!1}else if(i/(n+s)>r)return!1;return!0}function M(e){return A(Math.max(-P,Math.min(e,P)))}function A(e){return n[0]=e,n[0]}function C(e,t,r){const i=o((r-e)/(t-e),0,1);return i*i*(3-2*i)}function E(e,t){const r=(0,i.l)(e),n=g(e[2]/r),s=Math.atan2(e[1]/r,e[0]/r);return(0,i.s)(t,r,n,s),t}function R(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],i=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(y(t,1)&&y(r,1)&&y(i,1))}const P=A(34028234663852886e22)},30726:(e,t,r)=>{"use strict";function i(e,t){if(null==e)throw new Error(t??"value is None")}function n(e){return e?.destroy(),null}function s(e){return e?.dispose(),null}function o(e){return e?.remove(),null}function a(e){return e?.abort(),null}function l(e){return e?.release(),null}function c(e,t,r){return null!=e&&null!=t?null!=r?r(e,t):e.equals(t):e===t}function u(e,t){return e?.[t]}function h(e,t){let r;return e.some(((e,i)=>(r=t(e,i),null!=r))),r??void 0}r.d(t,{CM:()=>c,DC:()=>a,Gz:()=>l,Lw:()=>i,Pb:()=>h,WD:()=>s,eJ:()=>u,pR:()=>n,xt:()=>o})},77944:(e,t,r)=>{"use strict";r.d(t,{d:()=>n});const i=[];function n(e){i.push(e),1===i.length&&queueMicrotask((()=>{const e=i.slice();i.length=0;for(const t of e)t()}))}},48611:(e,t,r)=>{"use strict";r.d(t,{$N:()=>n,i8:()=>a,sM:()=>o,wc:()=>s});var i=r(53084);function n(e,t){return c(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}function s(e,t){if(null!=t)return t[e]||l(e.split("."),!1,t)}function o(e,t,r){const i=e.split("."),n=i.pop(),s=l(i,!0,r);s&&n&&(s[n]=t)}function a(e,t){if(null==e&&null==t)return!1;if(null==e)return!0;if(null==t)return!0;if("object"==typeof e){if(Array.isArray(e)){const r=t;if(e.length!==r.length)return!0;for(let t=0;t<e.length;t++)if(a(e[t],r[t]))return!0;return!1}if(Object.keys(e).length!==Object.keys(t).length)return!0;for(const r in e)if(a(e[r],t[r]))return!0;return!1}return e!==t}function l(e,t,r){let i=r;for(const n of e){if(null==i)return;if(!(n in i)){if(!t)return;i[n]={}}i=i[n]}return i}function c(e,t,r){return t?Object.keys(t).reduce(((e,n)=>{let s=e[n],o=t[n];return s===o?e:void 0===s?(e[n]=(0,i.o8)(o),e):(Array.isArray(o)||Array.isArray(e)?(s=s?Array.isArray(s)?e[n]=s.concat():e[n]=[s]:e[n]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach((e=>{s.includes(e)||s.push(e)})):e[n]=o.concat())):o&&"object"==typeof o?e[n]=c(s,o,r):e.hasOwnProperty(n)&&!t.hasOwnProperty(n)||(e[n]=o),e)}),e||{}):e}},50346:(e,t,r)=>{"use strict";r.d(t,{$X:()=>M,G4:()=>h,Gk:()=>R,Lx:()=>b,Mq:()=>u,NK:()=>l,NO:()=>P,NY:()=>m,Ol:()=>x,Pl:()=>S,QP:()=>d,QZ:()=>_,Qg:()=>v,Te:()=>c,Tw:()=>E,YL:()=>T,jH:()=>p,nA:()=>w,qr:()=>g,sg:()=>C,u7:()=>f,z7:()=>A,zf:()=>y});var i=r(50176),n=r(50076),s=r(79053),o=r(76460),a=r(30726);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Aborted";return new n.A("AbortError",e)}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Aborted";if(h(e))throw l(t)}function u(e){return e instanceof AbortSignal?e:e?.signal}function h(e){const t=u(e);return null!=t&&t.aborted}function d(e){if(y(e))throw e}function p(e){if(!y(e))throw e}function f(e,t){const r=u(e);if(null!=r){if(!r.aborted)return(0,s.Oo)(r,"abort",(()=>t()));t()}}function m(e,t){const r=u(e);if(null!=r)return c(r),(0,s.Oo)(r,"abort",(()=>t(l())))}function g(e,t){return null==u(t)?e:new Promise(((r,i)=>{let n=f(t,(()=>i(l())));const s=()=>{n=(0,a.xt)(n)};e.then(s,s),e.then(r,i)}))}function y(e){return"AbortError"===e?.name}async function _(e){try{return await e}catch(t){if(!y(t))throw t;return}}async function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.A.getLogger("esri");try{return await e}catch(r){y(r)||t.error(r)}}async function b(e){if(!e)return;if("function"!=typeof e.forEach){const t=Object.keys(e),r=t.map((t=>e[t])),i=await b(r),n={};return t.map(((e,t)=>n[e]=i[t])),n}const t=e;return Promise.allSettled(t).then((e=>Array.from(t,((t,r)=>{const i=e[r];return"fulfilled"===i.status?{promise:t,value:i.value}:{promise:t,error:i.reason}}))))}async function w(e){return(await Promise.allSettled(e)).filter((e=>"fulfilled"===e.status)).map((e=>e.value))}async function x(e){return(await Promise.allSettled(e)).filter((e=>"rejected"===e.status)).map((e=>e.reason))}function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;const i=new AbortController;return f(r,(()=>i.abort())),new Promise(((r,n)=>{let s=setTimeout((()=>{s=0,r(t)}),e);f(i,(()=>{s&&(clearTimeout(s),n(l()))}))}))}function T(e,t){const r=new AbortController,i=setTimeout((()=>r.abort()),t);return f(e,(()=>{r.abort(),clearTimeout(i)})),{...e,signal:r.signal}}function M(e){return e&&"function"==typeof e.then}function A(e){return M(e)?e:Promise.resolve(e)}function C(e){let t,r,i,n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,o=null;const a=function(){for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];if(t){r=u,n&&n.reject(l()),n=E();const e=n.promise;if(o){const e=o;o=null,e.abort()}return e}if(i=n||E(),n=null,s>0){const r=new AbortController;t=A(e(...u,r.signal));const i=t;S(s).then((()=>{t===i&&(n?r.abort():o=r)}))}else t=1,t=A(e(...u));const d=()=>{const e=r;r=i=t=o=null,null!=e&&a(...e)},p=t,f=i;return p.then(d,d),p.then(f.resolve,f.reject),f.promise};return a}function E(){let e,t;const r=new Promise(((r,i)=>{e=r,t=i})),n=t=>{e(t)};return n.resolve=t=>e(t),n.reject=e=>t(e),n.timeout=(e,t)=>i.p.setTimeout((()=>n.reject(t)),e),n.promise=r,n}function R(e,t){return e.then(t,t)}async function P(e){await Promise.resolve(),c(e)}},24648:(e,t,r)=>{"use strict";r.d(t,{IV:()=>m,LF:()=>n,T9:()=>u,Wq:()=>a,d_:()=>s,g2:()=>d,gT:()=>o,hs:()=>h,iT:()=>f,kM:()=>l,l3:()=>c,n0:()=>g,r7:()=>p});var i=r(31633);function n(e){return{value:e}}function s(e,t){return{type:(0,i.t$)(t),value:e,unit:t}}function o(e,t){return{type:(0,i.t$)(t),value:e,unit:t}}function a(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"arithmetic";return{type:(0,i.t$)(t),value:e,unit:t,rotationType:r}}function l(e,t){const r=c(e,t);return"angle"===e.type?a(r,t,e.rotationType):function(e,t){return{type:(0,i.t$)(t),value:e,unit:t}}(r,t)}function c(e,t){return(0,i.oU)(e.value,e.unit,t)}function u(e,t){return null==e?t:null==t||e.value>(0,i.oU)(t.value,t.unit,e.unit)?e:t}function h(e,t){return null==e?null:{...e,value:e.value*t}}function d(e,t,r){if(t===r)return e;switch(r){case"arithmetic":case"geographic":return 90-e}}const p=s(0,"meters"),f=o(0,"square-meters"),m=(a(0,"radians"),a(0,"degrees")),g=a(0,"degrees","geographic")},68134:(e,t,r)=>{"use strict";r.d(t,{C_:()=>f,LF:()=>_,OH:()=>b,Vh:()=>w,lZ:()=>v,on:()=>p,pc:()=>x,wB:()=>u,z7:()=>h});var i=r(98773),n=r(19276),s=r(79053),o=r(54901),a=r(30726),l=r(50346),c=r(68452);r(49281);function u(e,t){return d(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},g)}function h(e,t){return d(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},y)}function d(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,n=null;const s=r.once?(e,r)=>{i(e)&&((0,a.xt)(n),t(e,r))}:(e,r)=>{i(e)&&t(e,r)};if(n=(0,c.Cn)(e,s,r.sync,r.equals),r.initial){const t=e();s(t,t)}return n}function p(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=null,l=null,c=null;function h(){n&&l&&(l.remove(),i.onListenerRemove?.(n),n=null,l=null)}function d(e){i.once&&i.once&&(0,a.xt)(c),r(e)}const p=u(e,((e,r)=>{h(),(0,s.wb)(e)&&(n=e,l=(0,s.on)(e,t,d),i.onListenerAdd?.(e))}),{sync:i.sync,initial:!0});return c=(0,o.hA)((()=>{p.remove(),h()})),c}function f(e,t){return m(e,y,t)}function m(e,t,r){if((0,l.G4)(r))return Promise.reject((0,l.NK)());const i=e();if(t?.(i))return Promise.resolve(i);let n=null;function s(){n=(0,a.xt)(n)}return new Promise(((i,a)=>{n=(0,o.vE)([(0,l.u7)(r,(()=>{s(),a((0,l.NK)())})),d(e,(e=>{s(),i(e)}),{sync:!1,once:!0},t??g)])}))}function g(e){return!0}function y(e){return!!e}function _(e,t){const r=new n.A,i=p(e,"after-splice",(e=>{let{added:i,start:n,deleteCount:s}=e;const o=r.splice(n,s);for(const t of o)t.remove();if(i?.length){const e=i.map(t);r.addMany(e,n)}}),{sync:!0,onListenerRemove:()=>r.drain((e=>e.remove())),onListenerAdd:e=>r.addMany(e.items.map(t))});return r.addHandles(i),r}function v(e,t){const r=new n.A,s=_(e,(e=>(0,i.UT)((async r=>{const i=await t(e,r);if((0,l.G4)(r))throw i.remove(),(0,l.NK)();return i})))),a=()=>null,c=async e=>{const t=await e.promise,i=s.indexOf(e);i<0||r.splice(i,1,t)};r.addMany(s.items.map(a));for(const i of s)(0,l.QZ)(c(i));const u=s.on("after-splice",(e=>{let{added:t,start:i,deleteCount:n}=e;const s=r.splice(i,n);for(const r of s)r?.remove();if(t?.length){r.addMany(t.map(a),i);for(const e of t)(0,l.QZ)(c(e))}}));return r.addHandles([(0,o.DQ)(s),u]),r}const b={sync:!0},w={initial:!0},x={sync:!0,initial:!0}},52394:(e,t,r)=>{"use strict";r.d(t,{$m:()=>E,NO:()=>C,QL:()=>w,_:()=>_,md:()=>A,mg:()=>v});var i=r(77944),n=r(32634),s=r(30015),o=r(50346),a=r(91417);class l{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}}class c{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}}let u=0,h=0;const d={time:(0,a.l5)(0),deltaTime:(0,a.l5)(0),elapsedFrameTime:(0,a.l5)(0),frameDuration:(0,a.l5)(0)},p=["prepare","preRender","render","postRender","update","finish"],f=[],m=new s.A;class g{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const y={frameTasks:m,willDispatch:!1,clearFrameTasks:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];m.forAll((e=>{e.removed=!0})),e&&T()},dispatch:M,executeFrameTasks:function(e){const t=(0,a.l5)(e-u);u=e;const r=h>0?h:1e3/60,i=Math.max(0,t-r);d.time=e,d.frameDuration=(0,a.l5)(r-i);for(let n=0;n<p.length;n++){const r=performance.now(),i=p[n];m.forAll((r=>{r.paused||r.removed||(0===n&&r.ticks++,r.phases[i]&&(d.elapsedFrameTime=(0,a.l5)(performance.now()-e),d.deltaTime=0===r.ticks?(0,a.l5)(0):t,r.phases[i]?.call(r,d)))})),R[n].record(performance.now()-r)}T(),P.record(performance.now()-e)},reschedule:function(){null!=b&&(cancelAnimationFrame(b),b=requestAnimationFrame(x))}};function _(e){const t=new c(e);return f.push(t),y.willDispatch||(y.willDispatch=!0,(0,i.d)(M)),t}function v(e){const t=new l(e);return m.push(t),null==b&&(u=performance.now(),b=requestAnimationFrame(x)),new g(t)}let b=null;function w(e){h=Math.max(0,e)}function x(){const e=performance.now();b=null,b=m.length>0?requestAnimationFrame(x):null,y.executeFrameTasks(e)}const S=new s.A;function T(){m.forAll((e=>{e.removed&&S.push(e)})),m.removeUnorderedMany(S.data,S.length),S.clear()}function M(){for(;f.length;){const e=f.shift();e.isActive&&e.callback()}y.willDispatch=!1}function A(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;const r=(0,o.Tw)(),n=()=>{(0,o.G4)(t)?r.reject((0,o.NK)()):0===e?r():(--e,(0,i.d)((()=>n())))};return n(),r.promise}function C(e){return A(1,e)}async function E(){await C(),await new Promise((e=>requestAnimationFrame(e)))}const R=p.map((e=>new n.A(e))),P=new n.A("total")},76931:(e,t,r)=>{"use strict";r.d(t,{Lz:()=>o,PN:()=>a,PR:()=>m,QG:()=>h,WA:()=>g,cr:()=>l,gs:()=>u,rX:()=>p,r_:()=>d,sc:()=>f,tc:()=>c});const i=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,n="screenUtils.toPt: input not recognized!",s=96;function o(e){return e?e/72*s:0}function a(e){return e?72*e/s:0}function l(e){if("string"==typeof e){const t=e.match(i);if(t){const r=Number(t[1]),i=t[3]&&t[3].toLowerCase(),n="-"===e.charAt(0),s="px"===i?a(r):r;return n?-s:s}return console.warn(n),null}return e}function c(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}}function u(){return[arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0]}function h(){return[arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0]}function d(){return[arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0]}function p(e){return e}function f(e){return e}function m(e){return e}function g(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}},75540:(e,t,r)=>{"use strict";r.d(t,{v:()=>a});var i=r(53084),n=r(99486),s=r(99702);class o{constructor(e,t){this._observable=new s.I,this._value=e,this._equalityFunction=t}get value(){return(0,n.gc)(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.gh;return new o(e,t)}},34154:(e,t,r)=>{"use strict";async function i(e,t){const{WhereClause:i}=await Promise.all([r.e(7216),r.e(3620)]).then(r.bind(r,97216));return i.create(e,t)}function n(e,t){return"1=1"===e?t??e:"1=1"===t?e??t:null!=e&&""!==e?null!=t&&""!==t?`(${e}) AND (${t})`:e:t}r.d(t,{G:()=>i,m:()=>n})},64920:(e,t,r)=>{"use strict";r.d(t,{GB:()=>n,Qo:()=>o,Y4:()=>s});var i=r(24241);class n{}function s(e){return e instanceof i.bo?e===n.instance:"unknown"===e?.toString().toLowerCase()}function o(e){return s(e)?n.instance:e}n.instance=new i.oh("Etc/UTC")},88685:(e,t,r)=>{"use strict";r.d(t,{Cj:()=>a,HC:()=>o,ML:()=>d,Wm:()=>l,_e:()=>u,mk:()=>h});var i=r(48611);const n=/\{([^}]+)\}/g;function s(e){return e??""}function o(e,t){return t?e.replaceAll(n,"object"==typeof t?(e,r)=>s((0,i.wc)(r,t)):(e,r)=>s(t(r))):e}function a(e,t){return e.replaceAll(/([.$?*|{}()[\]\\/+\-^])/g,(e=>t?.includes(e)?e:`\\${e}`))}function l(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}let c;function u(e){return c??=new DOMParser,c.parseFromString(e||"","text/html").body.innerText||""}function h(e,t){return new RegExp(`{${t}}`,"ig").test(e)}function d(e){let t=e[0];for(let r=0;r<(arguments.length<=1?0:arguments.length-1);++r)t+=(r+1<1||arguments.length<=r+1?void 0:arguments[r+1])+e[r+1];return t}},5364:(e,t,r)=>{"use strict";r.d(t,{C:()=>c,X:()=>l});var i=r(35143),n=r(19276),s=r(3975),o=(r(81806),r(76460),r(46053)),a=(r(47249),r(85842));let l=class extends n.A{constructor(e){super(e),this.addHandles([this.on("before-add",(e=>{null==e.item&&e.preventDefault()})),this.on("after-add",(e=>this._own(e.item))),this.on("after-remove",(e=>this._release(e.item)))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(n.A.ofType(this.itemType.Type))(e):new n.A(e)}};function c(e,t){return{type:e,cast:s.H,set(r){const i=(0,s.V)(r,this._get(t),e);i.owner=this,this._set(t,i)}}}(0,i._)([(0,o.MZ)()],l.prototype,"owner",null),l=(0,i._)([(0,a.$)("esri.core.support.OwningCollection")],l)},19451:(e,t,r)=>{"use strict";r.d(t,{U:()=>u});var i=r(35143),n=r(91967),s=r(54901),o=r(68134),a=r(52394),l=r(46053),c=r(85842);let u=class extends n.A{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,r,o.wB)}addWhen(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,r,o.z7)}addOnCollectionChange(e,t){let{initial:r=!1,final:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=++this._handleId;return this.addHandles([(0,o.on)(e,"after-changes",this._createSyncUpdatingCallback(),o.OH),(0,o.on)(e,"change",t,{onListenerAdd:r?e=>t({added:e.toArray(),removed:[]}):void 0,onListenerRemove:i?e=>t({added:[],removed:e.toArray()}):void 0})],n),(0,s.hA)((()=>this.removeHandles(n)))}addPromise(e){if(null==e)return e;const t=++this._handleId;this.addHandles((0,s.hA)((()=>{this._pendingPromises.delete(e)&&(0!==this._pendingPromises.size||this.hasHandles(h)||this._set("updating",!1))})),t),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(t);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const n=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,n);const o=i(e,t,r);return this.addHandles(o,n),(0,s.hA)((()=>this.removeHandles(n)))}_installSyncUpdatingWatch(e,t){const r=this._createSyncUpdatingCallback(),i=(0,o.wB)(e,r,{sync:!0,equals:()=>!1});return this.addHandles(i,t),i}_createSyncUpdatingCallback(){return()=>{this.removeHandles(h),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles((0,a._)((()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(h))})),h)}}};(0,i._)([(0,l.MZ)({readOnly:!0})],u.prototype,"updating",void 0),u=(0,i._)([(0,c.$)("esri.core.support.UpdatingHandles")],u);const h=-42},91417:(e,t,r)=>{"use strict";function i(e){return e}function n(e){return 1e3*e}function s(e){return e}function o(e){return.001*e}r.d(t,{Kp:()=>s,gr:()=>n,l5:()=>i,y:()=>o})},18288:(e,t,r)=>{"use strict";r.d(t,{S1:()=>a,lL:()=>c,mi:()=>l,pJ:()=>h,t:()=>u,vf:()=>o});var i=r(65256),n=r(67478),s=r(24241);const o={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function a(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.qU;const a=new s.oh((0,i.wj)(o)),l=s.c9.fromJSDate(e,{zone:a}),c="decades"===r||"centuries"===r?"year":d(r);return"decades"===r&&(t*=10),"centuries"===r&&(t*=100),l.plus({[c]:t}).toJSDate()}function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"milliseconds";const i=e.getTime(),n=u(t,r,"milliseconds");return new Date(i+n)}function c(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.qU;const o=new s.oh((0,i.wj)(r)),a=s.c9.fromJSDate(e,{zone:o});if("decades"===t||"centuries"===t){const e=a.startOf("year"),{year:r}=e,i=r-r%("decades"===t?10:100);return e.set({year:i}).toJSDate()}const l=d(t);return a.startOf(l).toJSDate()}function u(e,t,r){return 0===e?0:e*o[t]/o[r]}function h(e,t){return e&&t?e.intersection(t):e||t}function d(e){switch(e){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}},78393:(e,t,r)=>{"use strict";r.d(t,{Ek:()=>m,IY:()=>l,JI:()=>_,UR:()=>a,XJ:()=>h,_G:()=>u,a3:()=>b,aI:()=>p,cy:()=>f,dk:()=>v,dz:()=>s,jq:()=>c,mg:()=>o,mw:()=>n,vZ:()=>d,y9:()=>y,zQ:()=>g});var i=r(21499);r(81806);function n(e){return e instanceof ArrayBuffer}function s(e){return"Int8Array"===e?.constructor?.name}function o(e){return"Uint8Array"===e?.constructor?.name}function a(e){return"Uint8ClampedArray"===e?.constructor?.name}function l(e){return"Int16Array"===e?.constructor?.name}function c(e){return"Uint16Array"===e?.constructor?.name}function u(e){return"Int32Array"===e?.constructor?.name}function h(e){return"Uint32Array"===e?.constructor?.name}function d(e){return"Float32Array"===e?.constructor?.name}function p(e){return"Float64Array"===e?.constructor?.name}function f(e){return!("buffer"in e)}function m(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(((e,t)=>e+(t?f(t)?(0,i.zd)(t,(0,i.f3)()):t.byteLength+g:0)),0)}const g=145,y=1024;function _(e){return p(e)||d(e)||u(e)||l(e)||s(e)}function v(e){return p(e)||d(e)}function b(e){return p(e)?179769e303:d(e)?3402823e32:h(e)?4294967295:c(e)?65535:o(e)||a(e)?255:u(e)?2147483647:l(e)?32767:s(e)?127:256}},90632:(e,t,r)=>{"use strict";r.d(t,{M:()=>n,c:()=>s});let i=0;const n=0;function s(){return++i}},31633:(e,t,r)=>{"use strict";r.d(t,{Ao:()=>V,B5:()=>q,G9:()=>k,GA:()=>U,Ij:()=>G,KX:()=>B,LA:()=>F,OU:()=>O,Sk:()=>Q,TL:()=>N,Vs:()=>C,_H:()=>Z,b$:()=>ee,dk:()=>K,dy:()=>l,jE:()=>E,jM:()=>J,k1:()=>z,m5:()=>M,mq:()=>$,oU:()=>S,t$:()=>w,tW:()=>A,vl:()=>D,wL:()=>T,wv:()=>L,x$:()=>P,x0:()=>R,x1:()=>Y,y7:()=>I});r(81806);var i=r(45802),n=r(34111),s=r(14556),o=r(80963),a=r(85996);const l=39.37,c=s.$O.radius*Math.PI/200,u=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,h=a.A,d=/UNIT\[([^\]]+)]/i,p=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),f=(0,i.O)()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),m=e=>e*e,g=e=>e*e*e,y={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:m(.001)},"square-centimeters":{inBaseUnits:m(.01)},"square-decimeters":{inBaseUnits:m(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:m(1e3)},"square-inches":{inBaseUnits:m(.0254)},"square-feet":{inBaseUnits:m(.3048)},"square-yards":{inBaseUnits:m(.9144)},"square-miles":{inBaseUnits:m(1609.344)},"square-us-feet":{inBaseUnits:m(1200/3937)},acres:{inBaseUnits:.0015625*m(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*g(.001)},"cubic-centimeters":{inBaseUnits:1e3*g(.01)},"cubic-decimeters":{inBaseUnits:1e3*g(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*g(1e3)},"cubic-inches":{inBaseUnits:1e3*g(.0254)},"cubic-feet":{inBaseUnits:1e3*g(.3048)},"cubic-yards":{inBaseUnits:1e3*g(.9144)},"cubic-miles":{inBaseUnits:1e3*g(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},_=(()=>{const e={};for(const t in y)for(const r in y[t].units)e[r]=t;return e})();const v=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],b=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function w(e){const t=_[e];if(!t)throw new Error("unknown type");return t}function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t=t||w(e),y[t].baseUnit===e}function S(e,t,r){if(t===r)return e;const i=w(t);if(i!==w(r))throw new Error("incompatible units");const n=x(t,i)?e:function(e,t,r){return e*y[r].units[t].inBaseUnits}(e,t,i);return x(r,i)?n:function(e,t,r){return e/y[r].units[t].inBaseUnits}(n,r,i)}function T(e){switch(e){case"metric":return"meters";case"imperial":return"feet";default:return e}}function M(e){return T(e)}function A(e){switch(e){case"metric":return"square-meters";case"imperial":return"square-feet";default:return e}}function C(e,t,r){switch(r){case"metric":return R(e,t);case"imperial":return O(e,t);default:return r}}function E(e,t,r){switch(r){case"metric":return P(e,t);case"imperial":return I(e,t);default:return r}}function R(e,t){const r=S(e,t,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function P(e,t){const r=S(e,t,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function O(e,t){const r=S(e,t,"feet");return Math.abs(r)<1e3?"feet":"miles"}function I(e,t){const r=S(e,t,"feet");return Math.abs(r)<1e5?"feet":"miles"}function L(e,t){const r=S(e,t,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function N(e,t){const r=S(e,t,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function D(e,t,r){return S(e,t,"meters")/(r*Math.PI/180)}function F(e){return f.fromJSON(e.toLowerCase())||null}function k(e){if(null!=e&&!(0,o.B3)(e))return 1;const t=U(e);return t>1e5?1:t}function z(e){return U(e)>=(0,n.tO)(e).metersPerDegree?"meters":G(e)}function U(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.$O.metersPerDegree;return V(e,!0)??t}function V(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=e?.wkid??null,i=e?.wkt2??e?.wkt??null;let n=null;if(r){if((0,o.tl)(r))return s.sH.metersPerDegree;if((0,o.ZL)(r))return s.Sw.metersPerDegree;n=h.values[h[r]],!n&&t&&p.has(r)&&(n=c)}else i&&(Y(i)?n=j(u.exec(i),n):W(i)&&(n=j(d.exec(i),n)));return n}function B(e){return(0,o.EA)(e)?1:U(e)}function j(e,t){return e?.[1]?H(e[1]):t}function H(e){return parseFloat(e.split(",")[1])}function G(e){const t=e?.wkid??null,r=e?.wkt2??e?.wkt??null;let i=null;if(t)i=h.units[h[t]];else if(r){const e=Y(r)?u:W(r)?d:null;if(e){const t=e.exec(r);t?.[1]&&(i=function(e){const t=/[\\"']{1}([^\\"']+)/.exec(e);let r=t?.[1];if(!r||!h.units.includes(r)){const t=H(e);r=null;const i=h.values;for(let e=0;e<i.length;++e)if(Math.abs(t-i[e])<X){r=h.units[e];break}}return r}(t[1]))}}return null!=i?F(i):null}function Z(e){const t=G(e);return null!=t&&v.includes(t)?t:null}function $(e){const t=z(e);return null!=t&&v.includes(t)?t:null}function q(e){const t=G(e);return null==t?null:b.get(t)}function W(e){return/^GEOCCS/i.test(e)}function Y(e){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(e)}const X=1e-7;function J(e){const t=G(e);if(null==t)return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const K=(0,i.O)()({esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"}),Q=(0,i.O)()({esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"}),ee=(0,i.O)()({esriDUDecimalDegrees:"degrees",esriDURadians:"radians"})},90534:(e,t,r)=>{"use strict";r.d(t,{$1:()=>te,$z:()=>X,An:()=>R,BQ:()=>ae,DB:()=>Q,FL:()=>G,FX:()=>H,Hg:()=>ne,Il:()=>me,N9:()=>oe,S8:()=>W,T1:()=>ye,UC:()=>ge,V1:()=>q,XJ:()=>ve,Xq:()=>C,Zo:()=>Se,_0:()=>Me,a6:()=>xe,b8:()=>U,e7:()=>fe,fj:()=>Y,gd:()=>E,lJ:()=>ee,lM:()=>ue,m3:()=>ce,nM:()=>pe,oP:()=>J,oy:()=>k,r$:()=>ie,rs:()=>we,s0:()=>w,s2:()=>$,sC:()=>j,s_:()=>I,tk:()=>se,ut:()=>V,w8:()=>K,x0:()=>O,xw:()=>Te,yM:()=>L,zf:()=>P,zi:()=>be,zs:()=>z});var i=r(86560),n=r(18690),s=r(50076),o=r(42553),a=r(76460),l=r(47437),c=r(59056);const u=()=>a.A.getLogger("esri.core.urlUtils"),h=i.A.request,d="esri/config: esriConfig.request.proxyUrl is not set.",p=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,f=/^\s*http:/i,m=/^\s*https:/i,g=/^\s*file:/i,y=/:\d+$/,_=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,v=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),b=new RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$");class w{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let t=this.uri.match(v);this.scheme=t[2]||(t[1]?"":null),this.authority=t[4]||(t[3]?"":null),this.path=t[5],this.query=t[7]||(t[6]?"":null),this.fragment=t[9]||(t[8]?"":null),null!=this.authority&&(t=this.authority.match(b),this.user=t[3]||null,this.password=t[4]||null,this.host=t[6]||t[7],this.port=t[9]||null)}toString(){return this.uri}}const x={},S=new w(i.A.applicationUrl);let T=S;const M=function(){const e=T.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${T.scheme}://${T.host}${null!=T.port?`:${T.port}`:""}${t}`}();let A=M;const C=()=>T,E=()=>A;function R(e){if(!e)return null;const t={path:null,query:null},r=new w(e),i=e.indexOf("?");return null===r.query?t.path=e:(t.path=e.substring(0,i),t.query=P(r.query)),r.fragment&&(t.hash=r.fragment,null===r.query&&(t.path=t.path.substring(0,t.path.length-(r.fragment.length+1)))),t}function P(e){const t=e.split("&"),r={};for(const i of t){if(!i)continue;const e=i.indexOf("=");let t,n;e<0?(t=decodeURIComponent(i),n=""):(t=decodeURIComponent(i.slice(0,e)),n=decodeURIComponent(i.slice(e+1)));let s=r[t];"string"==typeof s&&(s=r[t]=[s]),Array.isArray(s)?s.push(n):r[t]=n}return r}function O(e,t){return e?t&&"function"==typeof t?Object.keys(e).map((r=>encodeURIComponent(r)+"="+encodeURIComponent(t(r,e[r])))).join("&"):Object.keys(e).map((r=>{const i=e[r];if(null==i)return"";const n=encodeURIComponent(r)+"=",s=t?.[r];return s?n+encodeURIComponent(s(i)):Array.isArray(i)?i.map((e=>(0,o.Wj)(e)?n+encodeURIComponent(JSON.stringify(e)):n+encodeURIComponent(e))).join("&"):(0,o.Wj)(i)?n+encodeURIComponent(JSON.stringify(i)):n+encodeURIComponent(i)})).filter((e=>e)).join("&"):""}function I(){let e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=h.proxyUrl;if("string"==typeof t){e=ce(t);const i=z(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw u().warn(d),new s.A("urlUtils:proxy-not-set",d);return e&&he()&&(r=ue(r)),R(r)}function L(e){const t=z(e);let r,i;if(t){const e=D(t.proxyUrl);r=e.path,i=e.query?P(e.query):null}if(r){const t=R(e);e=r+"?"+t.path;const n=O({...i,...t.query});n&&(e=`${e}?${n}`)}return e}const N={path:"",query:""};function D(e){const t=e.indexOf("?");return-1!==t?(N.path=e.slice(0,t),N.query=e.slice(t+1)):(N.path=e,N.query=null),N}function F(e){return(e=de(e=me(e=D(e).path),!0)).toLowerCase()}function k(e){const t={proxyUrl:e.proxyUrl,urlPrefix:F(e.urlPrefix)},r=h.proxyRules,i=t.urlPrefix;let n=r.length;for(let s=0;s<r.length;s++){const e=r[s].urlPrefix;if(0===i.indexOf(e)){if(i.length===e.length)return-1;n=s;break}0===e.indexOf(i)&&(n=s+1)}return r.splice(n,0,t),n}function z(e){const t=h.proxyRules,r=F(e);for(let i=0;i<t.length;i++)if(0===r.indexOf(t[i].urlPrefix))return t[i]}function U(e,t){if(!e||!t)return!1;e=B(e),t=B(t);const r=(0,l.py)(e),i=(0,l.py)(t);return null!=r&&null!=i?r.portalHostname===i.portalHostname:null==r&&null==i&&H(e,t,!0)}function V(e,t){return e=B(e),t=B(t),de(e)===de(t)}function B(e){const t=(e=W(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.interceptors;const r=t=>null==t||t instanceof RegExp&&t.test(e)||"string"==typeof t&&e.startsWith(t);if(t)for(const i of t)if(Array.isArray(i.urls)){if(i.urls.some(r))return i}else if(r(i.urls))return i;return null}function H(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||!t)return!1;const i=_e(e),n=_e(t);return!(!r&&i.scheme!==n.scheme)&&null!=i.host&&null!=n.host&&i.host.toLowerCase()===n.host.toLowerCase()&&i.port===n.port}function G(e){if("string"==typeof e){if(!J(e))return!0;e=_e(e)}if(H(e,T))return!0;const t=h.trustedServers||[];for(let r=0;r<t.length;r++){const i=Z(t[r]);for(let t=0;t<i.length;t++)if(H(e,i[t]))return!0}return!1}function Z(e){return x[e]||(le(e)||ae(e)?x[e]=[new w($(e))]:x[e]=[new w(`http://${e}`),new w(`https://${e}`)]),x[e]}function $(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A,r=arguments.length>2?arguments[2]:void 0;return ae(e)?r?.preserveProtocolRelative?e:"http"===T.scheme&&T.authority===X(e).slice(2)?`http:${e}`:`https:${e}`:le(e)?e:Y("/"===e[0]?function(e){const t=e.indexOf("//"),r=e.indexOf("/",t+2);return-1===r?e:e.slice(0,r)}(t):t,e)}function q(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A,r=arguments.length>2?arguments[2]:void 0;if(null==e||!J(e))return e;const i=W(e),n=i.toLowerCase(),s=W(t).toLowerCase().replace(/\/+$/,""),o=r?W(r).toLowerCase().replace(/\/+$/,""):null;if(o&&0!==s.indexOf(o))return e;const a=(e,t,r)=>-1===(r=e.indexOf(t,r))?e.length:r;let l=a(n,"/",n.indexOf("//")+2),c=-1;for(;n.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==n.length);)l=a(n,"/",l+1);if(-1===c)return e;if(o&&c<o.length)return e;e=i.slice(c);const u=s.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let h=0;h<u;h++)e=`../${e}`;else e=`./${e}`;return e}function W(e){return function(e){const t=h.httpsDomains;if(!function(e){return null!=e&&f.test(e)||"http"===T.scheme&&ae(e)}(e))return e;const r=e.indexOf("/",7);let i;if(i=-1===r?e:e.slice(0,r),i=i.toLowerCase().slice(7),y.test(i)){if(!i.endsWith(":80"))return e;i=i.slice(0,-3),e=e.replace(":80","")}return"http"===T.scheme&&i===T.authority&&!_.test(e)||(he()&&i===T.authority||t&&t.some((e=>i===e||i.endsWith(`.${e}`)))||he()&&!z(e))&&(e=ue(e)),e}(e=function(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}(e=function(e){if(/^https?:\/\//i.test(e)){const t=D(e);e=(e=t.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}(e=$(e=e.trim()))))}function Y(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const i=t.filter(n.Ru);if(!i?.length)return;const s=[];if(J(i[0])){const e=i[0],t=e.indexOf("//");-1!==t&&(s.push(e.slice(0,t+1)),function(e){return null!=e&&g.test(e)}(i[0])&&(s[0]+="/"),i[0]=e.slice(t+2))}else"/"===i[0][0]&&s.push("");const o=i.reduce(((e,t)=>t?e.concat(t.split("/")):e),[]);for(let n=0;n<o.length;n++){const e=o[n];".."===e&&s.length>0&&".."!==s[s.length-1]?s.pop():(!e&&n===o.length-1||e&&("."!==e||0===s.length))&&s.push(e)}return s.join("/")}function X(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==e||K(e)||Q(e))return null;let r=e.indexOf("://");if(-1===r&&ae(e))r=2;else{if(-1===r)return null;r+=3}const i=e.indexOf("/",r);return-1!==i&&(e=e.slice(0,i)),t&&(e=de(e,!0)),e}function J(e){return ae(e)||le(e)}function K(e){return null!=e&&"blob:"===e.slice(0,5)}function Q(e){return null!=e&&"data:"===e.slice(0,5)}function ee(e){const t=ie(e);return t?.isBase64?(0,c.M)(t.data):null}function te(e){return(0,c.Y)(e).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const re=/^data:(.*?)(;base64)?,(.*)$/;function ie(e){const t=e.match(re);if(!t)return null;const[,r,i,n]=t;return{mediaType:r,isBase64:!!i,data:n}}function ne(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}async function se(e){return(await fetch(e)).blob()}function oe(e){const t=ee(e);if(!t)return null;const r=ie(e);return new Blob([t],{type:r.mediaType})}function ae(e){return null!=e&&"/"===e[0]&&"/"===e[1]}function le(e){return null!=e&&p.test(e)}function ce(e){return null!=e&&m.test(e)||"https"===T.scheme&&ae(e)}function ue(e){return ae(e)?`https:${e}`:e.replace(f,"https:")}function he(){return"https"===T.scheme}function de(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return ae(e)?e.slice(2):(e=e.replace(p,""),t&&e.length>1&&"/"===e[0]&&"/"===e[1]&&(e=e.slice(2)),e)}function pe(e){let t=0;if(J(e)){const r=e.indexOf("//");-1!==r&&(t=r+2)}const r=e.lastIndexOf("/");return r<t?e:e.slice(0,r+1)}function fe(e,t){if(!e)return"";const r=R(e).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!t?.length)return i;const n=new RegExp(`\\.(${t.join("|")})$`,"i");return i.replace(n,"")}function me(e){return e.endsWith("/")?e:`${e}/`}function ge(e){return e.replace(/\/+$/,"")}function ye(e,t,r){if(!(t&&r&&e&&J(e)))return e;const i=e.indexOf("//"),n=e.indexOf("/",i+2),s=e.indexOf(":",i+2),o=Math.min(n<0?e.length:n,s<0?e.length:s);return e.slice(i+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,i+2)}${r}${e.slice(o)}`}function _e(e){return"string"==typeof e?new w($(e)):(e.scheme||(e.scheme=T.scheme),e)}function ve(e){return Ce.test(e)}function be(e,t){const r=R(e),i=Object.keys(r.query||{});return i.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function we(e,t,r){const i=R(e),n=i.query||{};return n[t]=String(r),`${i.path}?${O(n)}`}function xe(e,t){if(!t)return e;const r=R(e),i=r.query||{};for(const[s,o]of Object.entries(t))null!=o&&(i[s]=o);const n=O(i);return n?`${r.path}?${n}`:r.path}function Se(e){if(null==e)return null;const t=e.match(Ae);return t?t[2]:null}function Te(e){if(null==e)return null;const t=e.match(Ae);return t?{path:t[1],extension:t[2]}:{path:e,extension:null}}async function Me(e){return"string"==typeof e?ie(e)??{data:e}:new Promise(((t,r)=>{const i=new FileReader;i.readAsDataURL(e),i.onload=()=>t(ie(i.result)),i.onerror=e=>r(e)}))}const Ae=/([^.]*)\.([^/]*)$/,Ce=/(^data:image\/svg|\.svg$)/i},49723:(e,t,r)=>{"use strict";r.d(t,{lk:()=>n,vD:()=>o,yS:()=>s});const i="randomUUID"in crypto;function n(){if(i)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=t=>e[t].toString(16).padStart(4,"0");return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}function s(){return`{${n().toUpperCase()}}`}function o(){return`{${n()}}`}},45012:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i=r(54901),n=(r(81806),r(50346)),s=r(59649),o=r(15303),a=r(28786),l=r(59989);class c{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new s.A}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,t){return new Promise(((r,i)=>{let s=!0;const o=e=>{(0,n.Te)(t.signal),s&&(s=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const s=e[a];(0,n.$X)(s)?this._clientPromises[a]=s.then((e=>(this._clients[a]=new l.A(e,t,this._ongoingJobsQueue),o(r),this._clients[a])),(()=>(o(i),null))):(this._clients[a]=new l.A(s,t,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}}))}broadcast(e,t,r){const i=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const s=this._clientPromises[n];i[n]=s.then((i=>i?.invoke(e,t,r)))}return i}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject((0,n.NK)(`Worker closing, aborting job calling '${e.methodName}'`));for(const t of this._clientPromises)t.then((e=>e?.close()));this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,(0,o.h)(this)}invoke(e,t,r){return this.apply(e,[t],r)}apply(e,t,r){const i=(0,n.Tw)();this._ongoingJobsQueue.push({methodName:e,data:t,invokeOptions:r,resolver:i});for(let n=0;n<this._clientPromises.length;n++){const e=this._clients[n];e?e.jobAdded():this._clientPromises[n].then((e=>e?.jobAdded()))}return i.promise}createInvokeProxy(e){return(0,a.L)(this,e)}on(e,t){return Promise.all(this._clientPromises).then((()=>(0,i.vE)(this._clients.map((r=>r.on(e,t))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let r=t.length;for(let i=0;i<this._clientPromises.length;++i)this._clientPromises[i].then((n=>{n&&(t[i]=n.openPort()),0==--r&&e(t)}))}))}get test(){}}},28786:(e,t,r)=>{"use strict";function i(e,t){return new Proxy({},{get:(r,i,n)=>function(){let r,n;for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];const l=o[o.length-1];return function(e){return"object"==typeof e&&!Array.isArray(e)&&null!=e&&("signal"in e||"transferList"in e||0===Object.keys(e).length)}(l)&&(r=l.signal,n=l.transferList,o.pop()),e.apply(t?`${t}.${i.toString()}`:i.toString(),o,{transferList:n,signal:r})}})}r.d(t,{L:()=>i})},59989:(e,t,r)=>{"use strict";r.d(t,{A:()=>b});var i=r(55171),n=r(50076),s=r(79053),o=r(54901),a=r(30726),l=r(50346),c=r(28786);const u={statsWorker:()=>Promise.all([r.e(2003),r.e(1835)]).then(r.bind(r,81835)),geometryEngineWorker:()=>Promise.all([r.e(2612),r.e(9729)]).then(r.bind(r,49729)),CSVSourceWorker:()=>Promise.all([r.e(7216),r.e(3620),r.e(2003),r.e(1047),r.e(2914)]).then(r.bind(r,12914)),EdgeProcessingWorker:()=>r.e(698).then(r.bind(r,50698)),ElevationSamplerWorker:()=>r.e(8357).then(r.bind(r,98357)),FeatureServiceSnappingSourceWorker:()=>Promise.all([r.e(7216),r.e(3620),r.e(9122),r.e(2003),r.e(1047),r.e(3337)]).then(r.bind(r,13337)),GeoJSONSourceWorker:()=>Promise.all([r.e(7216),r.e(3620),r.e(2003),r.e(1047),r.e(9184)]).then(r.bind(r,29184)),LercWorker:()=>r.e(1533).then(r.bind(r,31533)),MemorySourceWorker:()=>Promise.all([r.e(7216),r.e(3620),r.e(2003),r.e(1047),r.e(5454)]).then(r.bind(r,35454)),PBFDecoderWorker:()=>Promise.all([r.e(9122),r.e(904)]).then(r.bind(r,20904)),FeaturePipelineWorker:()=>Promise.all([r.e(7216),r.e(3620),r.e(9122),r.e(2003),r.e(1047),r.e(6799),r.e(5995),r.e(6280)]).then(r.bind(r,96280)),PointCloudWorker:()=>Promise.all([r.e(1869),r.e(9983)]).then(r.bind(r,94063)),RasterWorker:()=>Promise.all([r.e(6333),r.e(9844),r.e(9571),r.e(5294)]).then(r.bind(r,5294)),SceneLayerSnappingSourceWorker:()=>r.e(1264).then(r.bind(r,51264)),SceneLayerWorker:()=>Promise.all([r.e(4279),r.e(1734)]).then(r.bind(r,21734)),WFSSourceWorker:()=>Promise.all([r.e(7216),r.e(3620),r.e(2003),r.e(1047),r.e(1316),r.e(2665)]).then(r.bind(r,22665)),WorkerTileHandler:()=>Promise.all([r.e(8376),r.e(5955)]).then(r.bind(r,85955)),Lyr3DWorker:()=>r.e(1014).then(r.bind(r,1014))};var h=r(88943),d=r(80483);const{CLOSE:p,ABORT:f,INVOKE:m,RESPONSE:g,OPEN_PORT:y,ON:_}=h.Go;class v{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===h.Go.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class b{static connect(e,t){const r=new MessageChannel;let i;i="function"==typeof e?new e:"default"in e&&"function"==typeof e.default?new e.default:e;const n=new b(r.port1,{channel:r,client:i,schedule:t});return"object"==typeof i&&"remoteClient"in i&&(i.remoteClient=n),b.clients.set(n,i),r.port2}static loadWorker(e){const t=u[e];return t?t():Promise.resolve(null)}constructor(e,t,r){this._port=e,this._jobQueue=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new v((e=>this._onInvokeMessage(e))),this._client=t.client,this._onMessage=this._onMessage.bind(this),this._channel=t.channel,this._schedule=t.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:p}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,t,r){return this.apply(e,[t],r)}apply(e,t,r){const i=r?.signal,s=r?.transferList;if(!this._port)return Promise.reject(new n.A(h.T,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:t}));const o=(0,h.Jc)();return new Promise(((r,n)=>{if((0,l.G4)(i))return this._processWork(),void n((0,l.NK)());const c=(0,l.u7)(i,(()=>{const e=this._outJobs.get(o);e&&(this._outJobs.delete(o),this._processWork(),(0,a.xt)(e.abortHandle),this._post({type:f,jobId:o}),n((0,l.NK)()))})),u={resolve:r,reject:n,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:m,jobId:o,methodName:e,abortable:null!=i},t,s)}))}createInvokeProxy(e){return(0,c.L)(this,e)}on(e,t){const r=new MessageChannel;function i(e){t(e.data)}return this._port.postMessage({type:h.Go.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",i),r.port1.start(),(0,o.hA)((()=>{r.port1.postMessage({type:h.Go.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",i)}))}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:y,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=2)return;const e=this._jobQueue?.pop();if(!e)return;const{methodName:t,data:r,invokeOptions:i,resolver:n}=e;this.apply(t,r,i).then((e=>n.resolve(e))).catch((e=>n.reject(e)))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((e=>{(0,a.xt)(e.abortHandle),e.reject((0,l.NK)(`Worker closing, aborting job calling '${e.debugInfo}'`))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){null!=this._schedule?this._schedule((()=>this._processMessage(e,!0))):this._processMessage(e,!1)}_processMessage(e,t){const r=(0,h.VI)(e);if(r)switch(r.type){case g:this._onResponseMessage(r);break;case m:t?this._onInvokeMessage(r):this._invokeQueue.push(r);break;case f:this._onAbortMessage(r);break;case p:this._onCloseMessage();break;case y:this._onOpenPortMessage(r);break;case _:this._onOnMessage(r)}}_onAbortMessage(e){const t=this._inJobs,r=e.jobId,i=t.get(r);this._invokeQueue.push(e),i&&(i.controller&&i.controller.abort(),t.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&b.clients.get(this)===e&&e.destroy(),b.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:t,jobId:r,data:i=[],abortable:n}=e,s=n?new AbortController:null,o=this._inJobs;let a,c=this._client,u=c[t];try{if(!u&&t&&t.includes(".")){const e=t.split(".");for(let t=0;t<e.length-1;t++)c=c[e[t]],u=c[e[t+1]]}if("function"!=typeof u)throw new TypeError(`${t} is not a function`);i.push({client:this,signal:s?s.signal:null}),a=u.apply(c,i)}catch(d){return void this._post({type:g,jobId:r,error:(0,h.mF)(d)})}(0,l.$X)(a)?(o.set(r,{controller:s,promise:a}),a.then((e=>{o.has(r)&&(o.delete(r),this._post({type:g,jobId:r},e))}),(e=>{o.has(r)&&(o.delete(r),(0,l.zf)(e)||this._post({type:g,jobId:r,error:(0,h.mF)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:g,jobId:r},a)}_onOpenPortMessage(e){new b(e.port,{client:this._client})}_onOnMessage(e){const{port:t}=e,r=this._client.on(e.eventType,(e=>{t.postMessage(e)})),i=(0,s.on)(e.port,"message",(e=>{const n=(0,h.VI)(e);n?.type===h.Go.CLOSE&&(i.remove(),r.remove(),t.close())}))}_onResponseMessage(e){const{jobId:t,error:r,data:i}=e,s=this._outJobs;if(!s.has(t))return;const o=s.get(t);s.delete(t),this._processWork(),(0,a.xt)(o.abortHandle),r?o.reject(n.A.fromJSON(JSON.parse(r))):o.resolve(i)}_post(e,t,r){return(0,h.u1)(this._port,e,t,r)}}b.kernelInfo={buildDate:d.$,fullVersion:i.ol,revision:d.u},b.clients=new Map},15303:(e,t,r)=>{"use strict";r.d(t,{h:()=>s,k:()=>n});const i=new FinalizationRegistry((e=>{e.close()}));function n(e,t){i.register(e,t,t)}function s(e){i.unregister(e)}},88943:(e,t,r)=>{"use strict";r.d(t,{Go:()=>o,Jc:()=>l,T:()=>s,VI:()=>h,mF:()=>c,oV:()=>p,u1:()=>u});var i=r(81806),n=r(50346);const s="worker:port-closed";var o;!function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"}(o||(o={}));let a=0;function l(){return a++}function c(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function u(e,t,r,n){if(t.type===o.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==o.INVOKE&&t.type!==o.RESPONSE)return void e.postMessage(t);let s;if(function(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}(r)?(s=d(r.transferList),t.data=r.result):(s=d(n),t.data=r),s){if((0,i.A)("ff"))for(const r of s)if("byteLength"in r&&r.byteLength>267386880){const r="Worker call with large ArrayBuffer would crash Firefox";switch(t.type){case o.INVOKE:throw r;case o.RESPONSE:return void u(e,{type:o.RESPONSE,jobId:t.jobId,error:c(r)})}}e.postMessage(t,s)}else e.postMessage(t)}function h(e){if(!e)return null;const t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}function d(e){if(!e?.length)return null;if((0,i.A)("esri-workers-arraybuffer-transfer"))return e;const t=e.filter((e=>!function(e){return e instanceof ArrayBuffer||"ArrayBuffer"===e?.constructor?.name}(e)));return t.length?t:null}async function p(e){try{return await e}catch(a){const t=a?.name===s;if(!(0,n.zf)(a)&&!t)throw a;return}}},16783:(e,t,r)=>{"use strict";r.d(t,{n_:()=>j,ho:()=>G});var i=r(50076),n=r(81806),s=r(50346),o=r(45012),a=r(15303),l=r(59989),c=r(76460),u=r(30726),h=r(3825),d=r(90534);const p={async request(e,t){const r=e.options,i=r.responseType;r.signal=t?.signal,r.responseType="native"===i||"native-request-init"===i?"native-request-init":i&&["blob","json","text"].includes(i)&&(0,d.sC)(e.url)?.after?i:"array-buffer";const n=await(0,h.A)(e.url,r),s={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch(n.requestOptions?.responseType){case"native-request-init":return delete s.data.signal,s;case"blob":s.data=await s.data.arrayBuffer();break;case"json":s.data=(new TextEncoder).encode(JSON.stringify(s.data)).buffer;break;case"text":s.data=(new TextEncoder).encode(s.data).buffer}return{result:s,transferList:[s.data]}}};var f=r(88943),m=r(28899),g=r(86560),y=(r(11265),r(55171));const _={};var v=r(77944);class b{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=function(){return e[t](...arguments)}}))}}class w{constructor(){this._dispatcher=new b,this._workerPostMessage({type:f.Go.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){(0,v.d)((()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,r){this._dispatcher.addEventListener(e,t,r)}removeEventListener(e,t,r){this._dispatcher.removeEventListener(e,t,r)}_workerPostMessage(e){(0,v.d)((()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))}))}async _workerMessageHandler(e){const t=(0,f.VI)(e);if(t&&t.type===f.Go.OPEN){const{modulePath:e,jobId:r}=t;let i=await l.A.loadWorker(e);i||(i=await import(e));const n=l.A.connect(i);this._workerPostMessage({type:f.Go.OPENED,jobId:r,data:n})}}}var x=r(38042),S=r(80483);const T=()=>c.A.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:M}=f.Go;let A,C;const E="Failed to create Worker. Fallback to execute module in main thread";async function R(){if(!(0,n.A)("esri-workers"))return P(new w);if(!A&&!C)try{const e='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.split("{CONFIGURATION}").join(function(){let e;if(null!=g.A.default){const t={...g.A};delete t.default,e=JSON.parse(JSON.stringify(t))}else e=JSON.parse(JSON.stringify(g.A));e.assetsPath=(0,d.s2)(e.assetsPath),e.defaultAssetsPath=e.defaultAssetsPath?(0,d.s2)(e.defaultAssetsPath):void 0,e.request.interceptors=[],e.log.interceptors=[],e.locale=(0,x.JK)(),e.has={"esri-csp-restrictions":(0,n.A)("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":(0,n.A)("esri-2d-update-debug"),"esri-2d-log-updating":(0,n.A)("esri-2d-log-updating"),"featurelayer-pbf":(0,n.A)("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":(0,n.A)("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":(0,n.A)("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":(0,n.A)("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":(0,n.A)("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":(0,n.A)("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":(0,n.A)("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":(0,n.A)("featurelayer-snapshot-enabled"),"esri-atomics":(0,n.A)("esri-atomics"),"esri-shared-array-buffer":(0,n.A)("esri-shared-array-buffer"),"esri-tiles-debug":(0,n.A)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":(0,n.A)("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":(0,n.A)("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=(0,d.s2)(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=(0,d.s2)(e.workers.workerPath):e.workers.workerPath=(0,d.s2)((0,m.s)("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=g.A.workers.loaderConfig,r=function(e){const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages?.concat()||[],paths:{..._.paths,...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=_.baseUrl),t}({baseUrl:t?.baseUrl,locale:(0,x.JK)(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t?.has},map:{...t?.map},paths:{...t?.paths},packages:t?.packages||[]}),i={buildDate:S.$,fullVersion:y.ol,revision:S.u};return JSON.stringify({esriConfig:e,loaderConfig:r,kernelInfo:i})}());A=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(t){C=t||{}}let e;if(A)try{e=new Worker(A,{name:"esri-worker-"+O++})}catch(t){T().warn(E,C),e=new w}else T().warn(E,C),e=new w;return P(e)}async function P(e){return new Promise((t=>{function r(n){const s=(0,f.VI)(n);s&&s.type===M&&(e.removeEventListener("message",r),e.removeEventListener("error",i),t(e))}function i(t){t.preventDefault(),e.removeEventListener("message",r),e.removeEventListener("error",i),T().warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new w).addEventListener("message",r),e.addEventListener("error",i)}e.addEventListener("message",r),e.addEventListener("error",i)}))}let O=0;const{ABORT:I,INVOKE:L,OPEN:N,OPENED:D,RESPONSE:F}=f.Go;class k{static async create(e){const t=await R();return new k(t,e)}constructor(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(e=>{e.preventDefault(),c.A.getLogger("esri.core.workers.WorkerOwner").error(e)}))}terminate(){this.worker.terminate()}async open(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{signal:r}=t,i=(0,f.Jc)();return new Promise(((t,n)=>{const o={resolve:t,reject:n,abortHandle:(0,s.NY)(r,(()=>{this._outJobs.delete(i),this._post({type:I,jobId:i})}))};this._outJobs.set(i,o),this._post({type:N,jobId:i,modulePath:e})}))}_onMessage(e){const t=(0,f.VI)(e);if(t)switch(t.type){case D:this._onOpenedMessage(t);break;case F:this._onResponseMessage(t);break;case I:this._onAbortMessage(t);break;case L:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,r=e.jobId,i=t.get(r);i&&(i.controller&&i.controller.abort(),t.delete(r))}_onInvokeMessage(e){const{methodName:t,jobId:r,data:i,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=p[t];let c;try{if("function"!=typeof l)throw new TypeError(`${t} is not a function`);c=l.call(null,i,{signal:o?o.signal:null})}catch(u){return void this._post({type:F,jobId:r,error:(0,f.mF)(u)})}(0,s.$X)(c)?(a.set(r,{controller:o,promise:c}),c.then((e=>{a.has(r)&&(a.delete(r),this._post({type:F,jobId:r},e))}),(e=>{a.has(r)&&(a.delete(r),e||(e={message:"Error encountered at method"+t}),(0,s.zf)(e)||this._post({type:F,jobId:r,error:(0,f.mF)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:F,jobId:r},c)}_onOpenedMessage(e){const{jobId:t,data:r}=e,i=this._outJobs.get(t);i&&(this._outJobs.delete(t),(0,u.xt)(i.abortHandle),i.resolve(r))}_onResponseMessage(e){const{jobId:t,error:r,data:n}=e,s=this._outJobs.get(t);s&&(this._outJobs.delete(t),(0,u.xt)(s.abortHandle),r?s.reject(i.A.fromJSON(JSON.parse(r))):s.resolve(n))}_post(e,t,r){return(0,f.u1)(this.worker,e,t,r)}}const z=(0,n.A)("host-browser")?Math.min(navigator.hardwareConcurrency-1,(0,n.A)("workers-pool-size")):0;let U=(0,n.A)("esri-mobile")?Math.min(z,3):z;U||(U=(0,n.A)("safari")&&(0,n.A)("mac")?7:2);let V=0;const B=[];function j(){q()}async function H(e,t){const r=new o.A,{registryTarget:i,...n}=t;return await r.open(e,n),i&&(0,a.k)(i,r),r}async function G(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof e)throw new i.A("workers:undefined-module","modulePath is missing");let r=t.strategy||"distributed";if((0,n.A)("host-webworker")&&!(0,n.A)("esri-workers")&&(r="local"),"local"===r){let r=await l.A.loadWorker(e);r||(r=await import(e)),(0,s.Te)(t.signal);const i=t.client||r;return H([l.A.connect(r,t.schedule)],{...t,client:i})}if(await q(),(0,s.Te)(t.signal),"dedicated"===r){const r=V++%U;return H([await B[r].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const r=Math.min(t.maxNumWorkers,U);if(r<U){const i=new Array(r);for(let n=0;n<r;++n){const r=V++%U;i[n]=B[r].open(e,t)}return H(i,t)}}return H(B.map((r=>r.open(e,t))),t)}let Z,$=null;async function q(){if($)return $;Z=new AbortController;const e=[];for(let t=0;t<U;t++){const r=k.create(t).then((e=>(B[t]=e,e)));e.push(r)}return $=Promise.all(e),$}},44527:(e,t,r)=>{"use strict";r.d(t,{A:()=>Be});var i,n=r(35143),s=r(42553),o=r(53084),a=r(41289),l=r(46053),c=r(21403),u=r(28379),h=r(85842),d=r(17707);r(81806),r(76460),r(47249);let p=i=class extends s.oY{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new i({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],p.prototype,"expression",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],p.prototype,"name",void 0),(0,n._)([(0,l.MZ)({type:["boolean","date","number","string"],json:{write:!0}})],p.prototype,"returnType",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],p.prototype,"title",void 0),p=i=(0,n._)([(0,h.$)("esri.form.ExpressionInfo")],p);const f=p;let m=class extends s.oY{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],m.prototype,"description",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],m.prototype,"label",void 0),(0,n._)([(0,l.MZ)()],m.prototype,"type",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],m.prototype,"visibilityExpression",void 0),m=(0,n._)([(0,h.$)("esri.form.elements.Element")],m);const g=m;var y,_=r(40565);let v=y=class extends s.oY{constructor(e){super(e),this.type=null}clone(){return new y({type:this.type})}};(0,n._)([(0,l.MZ)({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],v.prototype,"type",void 0),v=y=(0,n._)([(0,h.$)("esri.form.elements.inputs.AttachmentInput")],v);const b=v;var w;let x=w=class extends g{constructor(e){super(e),this.attachmentKeyword=null,this.editableExpression=null,this.input=null,this.type="attachment"}clone(){return new w({attachmentKeyword:this.attachmentKeyword,description:this.description,editableExpression:this.editableExpression,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],x.prototype,"attachmentKeyword",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],x.prototype,"editableExpression",void 0),(0,n._)([(0,l.MZ)({type:b,json:{read:{source:"inputType"},write:{target:"inputType"}}})],x.prototype,"input",void 0),(0,n._)([(0,l.MZ)({type:["attachment"],json:{read:!1,write:!0}})],x.prototype,"type",void 0),x=w=(0,n._)([(0,h.$)("esri.form.elements.AttachmentElement")],x);const S=x;let T=class extends s.oY{constructor(e){super(e),this.type=null}};(0,n._)([(0,l.MZ)()],T.prototype,"type",void 0),T=(0,n._)([(0,h.$)("esri.form.elements.inputs.Input")],T);const M=T;let A=class extends M{constructor(e){super(e),this.maxLength=null,this.minLength=0}};(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],A.prototype,"maxLength",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],A.prototype,"minLength",void 0),A=(0,n._)([(0,h.$)("esri.form.elements.inputs.TextInput")],A);const C=A;var E;let R=E=class extends C{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new E({maxLength:this.maxLength,minLength:this.minLength})}};(0,n._)([(0,l.MZ)({type:["barcode-scanner"],json:{read:!1,write:!0}})],R.prototype,"type",void 0),R=E=(0,n._)([(0,h.$)("esri.form.elements.inputs.BarcodeScannerInput")],R);const P=R;var O;let I=O=class extends M{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new O({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],I.prototype,"noValueOptionLabel",void 0),(0,n._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],I.prototype,"showNoValueOption",void 0),(0,n._)([(0,l.MZ)({type:["combo-box"],json:{read:!1,write:!0}})],I.prototype,"type",void 0),I=O=(0,n._)([(0,h.$)("esri.form.elements.inputs.ComboBoxInput")],I);const L=I;var N;function D(e){return null!=e?e:null}function F(e){return null!=e?e:null}let k=N=class extends M{constructor(e){super(e),this.max=null,this.min=null,this.type="date-picker"}readMax(e,t){return D(t.max)}writeMax(e,t){t.max=F(e)}readMin(e,t){return D(t.min)}writeMin(e,t){t.min=F(e)}clone(){return new N({max:this.max,min:this.min})}};(0,n._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],k.prototype,"max",void 0),(0,n._)([(0,u.w)("max")],k.prototype,"readMax",null),(0,n._)([(0,d.K)("max")],k.prototype,"writeMax",null),(0,n._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],k.prototype,"min",void 0),(0,n._)([(0,u.w)("min")],k.prototype,"readMin",null),(0,n._)([(0,d.K)("min")],k.prototype,"writeMin",null),(0,n._)([(0,l.MZ)({type:["date-picker"],json:{read:!1,write:!0}})],k.prototype,"type",void 0),k=N=(0,n._)([(0,h.$)("esri.form.elements.inputs.DatePickerInput")],k);const z=k;var U;function V(e){return null!=e?e:null}function B(e){return null!=e?e:null}let j=U=class extends M{constructor(e){super(e),this.includeTimeOffset=!0,this.max=null,this.min=null,this.timeResolution="minutes",this.type="datetimeoffset-picker"}readMax(e,t){return V(t.max)}writeMax(e,t){t.max=B(e)}readMin(e,t){return V(t.min)}writeMin(e,t){t.min=B(e)}readTimeResolution(e,t){return V(t.timeResolution)}writeTimeResolution(e,t){t.timeResolution=B(e)}clone(){return new U({includeTimeOffset:this.includeTimeOffset,max:this.max,min:this.min,timeResolution:this.timeResolution})}};(0,n._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],j.prototype,"includeTimeOffset",void 0),(0,n._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],j.prototype,"max",void 0),(0,n._)([(0,u.w)("max")],j.prototype,"readMax",null),(0,n._)([(0,d.K)("max")],j.prototype,"writeMax",null),(0,n._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],j.prototype,"min",void 0),(0,n._)([(0,u.w)("min")],j.prototype,"readMin",null),(0,n._)([(0,d.K)("min")],j.prototype,"writeMin",null),(0,n._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],j.prototype,"timeResolution",void 0),(0,n._)([(0,u.w)("timeResolution")],j.prototype,"readTimeResolution",null),(0,n._)([(0,d.K)("timeResolution")],j.prototype,"writeTimeResolution",null),(0,n._)([(0,l.MZ)({type:["datetimeoffset-picker"],json:{read:!1,write:!0}})],j.prototype,"type",void 0),j=U=(0,n._)([(0,h.$)("esri.form.elements.inputs.DateTimeOffsetPickerInput")],j);const H=j;var G;function Z(e){return null!=e?new Date(e):null}function $(e){return e?e.getTime():null}let q=G=class extends M{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return Z(t.max)}writeMax(e,t){t.max=$(e)}readMin(e,t){return Z(t.min)}writeMin(e,t){t.min=$(e)}clone(){return new G({includeTime:this.includeTime,max:this.max,min:this.min})}};(0,n._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],q.prototype,"includeTime",void 0),(0,n._)([(0,l.MZ)({type:Date,json:{type:Number,write:!0}})],q.prototype,"max",void 0),(0,n._)([(0,u.w)("max")],q.prototype,"readMax",null),(0,n._)([(0,d.K)("max")],q.prototype,"writeMax",null),(0,n._)([(0,l.MZ)({type:Date,json:{type:Number,write:!0}})],q.prototype,"min",void 0),(0,n._)([(0,u.w)("min")],q.prototype,"readMin",null),(0,n._)([(0,d.K)("min")],q.prototype,"writeMin",null),(0,n._)([(0,l.MZ)({type:["datetime-picker"],json:{read:!1,write:!0}})],q.prototype,"type",void 0),q=G=(0,n._)([(0,h.$)("esri.form.elements.inputs.DateTimePickerInput")],q);const W=q;var Y;let X=Y=class extends M{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new Y({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],X.prototype,"noValueOptionLabel",void 0),(0,n._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],X.prototype,"showNoValueOption",void 0),(0,n._)([(0,l.MZ)({type:["radio-buttons"],json:{read:!1,write:!0}})],X.prototype,"type",void 0),X=Y=(0,n._)([(0,h.$)("esri.form.elements.inputs.RadioButtonsInput")],X);const J=X;var K;let Q=K=class extends M{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new K({offValue:this.offValue,onValue:this.onValue})}};(0,n._)([(0,l.MZ)({type:[String,Number],json:{write:!0}})],Q.prototype,"offValue",void 0),(0,n._)([(0,l.MZ)({type:[String,Number],json:{write:!0}})],Q.prototype,"onValue",void 0),(0,n._)([(0,l.MZ)({type:["switch"],json:{read:!1,write:!0}})],Q.prototype,"type",void 0),Q=K=(0,n._)([(0,h.$)("esri.form.elements.inputs.SwitchInput")],Q);const ee=Q;var te;let re=te=class extends C{constructor(e){super(e),this.type="text-area"}clone(){return new te({maxLength:this.maxLength,minLength:this.minLength})}};(0,n._)([(0,l.MZ)({type:["text-area"],json:{read:!1,write:!0}})],re.prototype,"type",void 0),re=te=(0,n._)([(0,h.$)("esri.form.elements.inputs.TextAreaInput")],re);const ie=re;var ne;let se=ne=class extends C{constructor(e){super(e),this.type="text-box"}clone(){return new ne({maxLength:this.maxLength,minLength:this.minLength})}};(0,n._)([(0,l.MZ)({type:["text-box"],json:{read:!1,write:!0}})],se.prototype,"type",void 0),se=ne=(0,n._)([(0,h.$)("esri.form.elements.inputs.TextBoxInput")],se);const oe=se;var ae;function le(e){return null!=e?e:null}function ce(e){return null!=e?e:null}let ue=ae=class extends M{constructor(e){super(e),this.max=null,this.min=null,this.timeResolution="minutes",this.type="time-picker"}readMax(e,t){return le(t.max)}writeMax(e,t){t.max=ce(e)}readMin(e,t){return le(t.min)}writeMin(e,t){t.min=ce(e)}readTimeResolution(e,t){return le(t.timeResolution)}writeTimeResolution(e,t){t.timeResolution=ce(e)}clone(){return new ae({max:this.max,min:this.min,timeResolution:this.timeResolution})}};(0,n._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],ue.prototype,"max",void 0),(0,n._)([(0,u.w)("max")],ue.prototype,"readMax",null),(0,n._)([(0,d.K)("max")],ue.prototype,"writeMax",null),(0,n._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],ue.prototype,"min",void 0),(0,n._)([(0,u.w)("min")],ue.prototype,"readMin",null),(0,n._)([(0,d.K)("min")],ue.prototype,"writeMin",null),(0,n._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],ue.prototype,"timeResolution",void 0),(0,n._)([(0,u.w)("timeResolution")],ue.prototype,"readTimeResolution",null),(0,n._)([(0,d.K)("timeResolution")],ue.prototype,"writeTimeResolution",null),(0,n._)([(0,l.MZ)({type:["time-picker"],json:{read:!1,write:!0}})],ue.prototype,"type",void 0),ue=ae=(0,n._)([(0,h.$)("esri.form.elements.inputs.TimePickerInput")],ue);const he={base:M,key:"type",typeMap:{"barcode-scanner":P,"combo-box":L,"date-picker":z,"datetime-picker":W,"datetimeoffset-picker":H,"radio-buttons":J,switch:ee,"text-area":ie,"text-box":oe,"time-picker":ue}};var de,pe=r(76866);let fe=de=class extends g{constructor(e){super(e),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return this._get("editable")??!0}set editable(e){this._set("editable",e)}clone(){return new de({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};(0,n._)([(0,l.MZ)({types:pe.gK,json:{read:{reader:pe.rS},write:!0}})],fe.prototype,"domain",void 0),(0,n._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],fe.prototype,"editable",null),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],fe.prototype,"editableExpression",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],fe.prototype,"fieldName",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],fe.prototype,"hint",void 0),(0,n._)([(0,l.MZ)({types:he,json:{read:{source:"inputType"},write:{target:"inputType"}}})],fe.prototype,"input",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],fe.prototype,"requiredExpression",void 0),(0,n._)([(0,l.MZ)({type:String,json:{read:!1,write:!0}})],fe.prototype,"type",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],fe.prototype,"valueExpression",void 0),fe=de=(0,n._)([(0,h.$)("esri.form.elements.FieldElement")],fe);const me=fe;var ge,ye=r(64362);let _e=ge=class extends g{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new ge({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:(0,o.o8)(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],_e.prototype,"displayCount",void 0),(0,n._)([(0,l.MZ)({type:["list"],json:{write:!0}})],_e.prototype,"displayType",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],_e.prototype,"editableExpression",void 0),(0,n._)([(0,l.MZ)({type:[ye.A],json:{write:!0}})],_e.prototype,"orderByFields",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],_e.prototype,"relationshipId",void 0),(0,n._)([(0,l.MZ)({type:["relationship"],json:{read:!1,write:!0}})],_e.prototype,"type",void 0),_e=ge=(0,n._)([(0,h.$)("esri.form.elements.RelationshipElement")],_e);const ve=_e;var be;let we=be=class extends g{constructor(e){super(e),this.text=null,this.textFormat="plain-text",this.type="text"}clone(){return new be({text:this.text,textFormat:this.textFormat,visibilityExpression:this.visibilityExpression})}};(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],we.prototype,"text",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],we.prototype,"textFormat",void 0),(0,n._)([(0,l.MZ)({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],we.prototype,"type",void 0),we=be=(0,n._)([(0,h.$)("esri.form.elements.TextElement")],we);const xe=we;function Se(e){return{typesWithGroup:{base:g,key:"type",typeMap:{attachment:S,field:me,group:e,relationship:ve,text:xe}},typesWithoutGroup:{base:g,key:"type",typeMap:{attachment:S,field:me,relationship:ve,text:xe}}}}function Te(e,t){if(!e)return null;const r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>r[e.type])).map((e=>r[e.type].fromJSON(e)))}function Me(e,t){if(!e)return null;const r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>r[e.type])).map((e=>e.toJSON()))}function Ae(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e?e.map((e=>(0,_.aq)(r?t.typesWithGroup:t.typesWithoutGroup,e))):null}var Ce;let Ee=Ce=class extends g{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return Ae(e,Re,!1)}readElements(e,t){return Te(t.formElements,Re,!1)}writeElements(e,t){t.formElements=Me(e,Re,!1)}clone(){return new Ce({description:this.description,elements:(0,o.o8)(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};(0,n._)([(0,l.MZ)({json:{write:!0}})],Ee.prototype,"elements",void 0),(0,n._)([(0,c.w)("elements")],Ee.prototype,"castElements",null),(0,n._)([(0,u.w)("elements",["formElements"])],Ee.prototype,"readElements",null),(0,n._)([(0,d.K)("elements")],Ee.prototype,"writeElements",null),(0,n._)([(0,l.MZ)({type:["collapsed","expanded"],json:{write:!0}})],Ee.prototype,"initialState",void 0),(0,n._)([(0,l.MZ)({type:String,json:{read:!1,write:!0}})],Ee.prototype,"type",void 0),Ee=Ce=(0,n._)([(0,h.$)("esri.form.elements.GroupElement")],Ee);const Re=Se(Ee),Pe=Ee,Oe=e=>"field"===e.type,Ie=e=>"group"===e.type,Le=e=>"text"===e.type;var Ne,De=r(53430);const Fe=Se(Pe);let ke=Ne=class extends s.oY{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(e){return Ae(e,Fe)}readElements(e,t){return Te(t.formElements,Fe)}writeElements(e,t){t.formElements=Me(e,Fe)}clone(){return new Ne({description:this.description,expressionInfos:(0,o.o8)(this.expressionInfos),elements:(0,o.o8)(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}async getFieldsUsed(e,t){const r=new Set,{description:i,elements:n,expressionInfos:s,title:o}=this;if(Ve(r,e,i),Ve(r,e,o),!n)return[];const a=function(e,t){if(!t||0===t.length)return[];const r=Ue(e),i=[];for(const n of t)r.has(n.name)&&i.push(n.expression);return i}(n,s).map((t=>(0,De.Dx)(r,e,t)));await Promise.all(a);for(const l of n)ze(r,{fieldsIndex:e,relationships:t},l);return Array.from(r).sort()}};function ze(e,t,r){const{fieldsIndex:i}=t;if(!i||i.fields.length!==e.size)switch(Ve(e,i,r.label),Ve(e,i,r.description),r.type){case"field":(0,De.rq)(e,i,r.fieldName);break;case"group":r.elements.forEach((r=>ze(e,t,r)));break;case"relationship":if(t.relationships){const n=t.relationships.find((e=>e.id===r.relationshipId));n&&(0,De.rq)(e,i,n.keyField)}(0,De._w)(e,i,r.orderByFields?.map((e=>e.field)));break;case"text":Ve(e,i,r.text)}}function Ue(e){const t=new Set;for(const r of e)if((0,a.kb)(t,r.visibilityExpression),!Le(r))if(Ie(r))(0,a.FB)(t,Ue(r.elements));else if((0,a.kb)(t,r.editableExpression),Oe(r)){const{requiredExpression:e,valueExpression:i}=r;(0,a.FB)(t,[e,i])}return t}function Ve(e,t,r){(0,De._w)(e,t,(0,De.nw)(r))}(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],ke.prototype,"description",void 0),(0,n._)([(0,l.MZ)({json:{write:!0}})],ke.prototype,"elements",void 0),(0,n._)([(0,c.w)("elements")],ke.prototype,"castElements",null),(0,n._)([(0,u.w)("elements",["formElements"])],ke.prototype,"readElements",null),(0,n._)([(0,d.K)("elements")],ke.prototype,"writeElements",null),(0,n._)([(0,l.MZ)({type:[f],json:{write:!0}})],ke.prototype,"expressionInfos",void 0),(0,n._)([(0,l.MZ)({type:Boolean,json:{default:!1,write:!0}})],ke.prototype,"preserveFieldValuesWhenHidden",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],ke.prototype,"title",void 0),ke=Ne=(0,n._)([(0,h.$)("esri.form.FormTemplate")],ke);const Be=ke},35238:(e,t,r)=>{"use strict";r.d(t,{yR:()=>u});var i=r(40565),n=r(76797),s=r(89189),o=r(66388),a=r(19247),l=r(65215),c=r(23701);r(13312),r(31608),r(19902);const u={base:s.A,key:"type",typeMap:{extent:n.A,multipoint:o.A,point:a.A,polyline:c.A,polygon:l.A}};(0,i.aq)(u)},76797:(e,t,r)=>{"use strict";r.d(t,{A:()=>_});var i,n=r(35143),s=r(88685),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842)),l=r(89189),c=r(19247),u=r(13312),h=r(11352),d=r(65658),p=r(80963),f=r(45417);function m(e,t,r){return null==t?r:null==r?t:e(t,r)}let g=i=class extends l.A{constructor(){super(...arguments),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,r,i,n){return function(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:"object"==typeof e?(e.spatialReference=null==e.spatialReference?u.A.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:r,ymax:i,spatialReference:n??u.A.WGS84}}static fromBounds(e,t){return new i({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new i({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new c.A({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return null!=this.mmin&&null!=this.mmax}get hasZ(){return null!=this.zmin&&null!=this.zmax}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return null!=e.z&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new i;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,null!=this.zmin&&(e.zmin=this.zmin,e.zmax=this.zmax),null!=this.mmin&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&(0,f.y7)(t,r)&&(e=t.isWebMercator?(0,f.Gh)(e):(0,f.ci)(e,!0)),"point"===e.type?(0,h.qz)(this,e):"extent"===e.type&&(0,h.gH)(this,e)}equals(e){if(this===e)return!0;if(null==e)return!1;const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&(0,f.y7)(t,r)&&(e=t.isWebMercator?(0,f.Gh)(e):(0,f.ci)(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),r=this.width*t,i=this.height*t;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const e=(this.zmax-this.zmin)*t;this.zmin+=e,this.zmax-=e}if(this.hasM){const e=(this.mmax-this.mmin)*t;this.mmin+=e,this.mmax-=e}return this}intersects(e){if(null==e)return!1;"mesh"===e.type&&(e=e.extent);const t=this.spatialReference,r=e.spatialReference;return t&&r&&!(0,p.aI)(t,r)&&(0,f.y7)(t,r)&&(e=t.isWebMercator?(0,f.Gh)(e):(0,f.ci)(e,!0)),(0,d.xK)(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,r){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,null!=r&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=m(Math.min,this.zmin,e.zmin),this.zmax=m(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=m(Math.min,this.mmin,e.mmin),this.mmax=m(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:null!=e&&this.intersects(e)?(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=m(Math.max,this.zmin,e.zmin),this.zmax=m(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=m(Math.max,this.mmin,e.mmin),this.mmax=m(Math.min,this.mmax,e.mmax)),this):null}toJSON(e){return this.write({},e)}_shiftCM(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,p.Vp)(this.spatialReference);if(!e||!this.spatialReference)return this;const t=this.spatialReference,r=this._getCM(e);if(r){const i=t.isWebMercator?(0,f.ci)(r):r;this.xmin-=r.x,this.xmax-=r.x,t.isWebMercator||(i.x=y(i.x,e).x),this.spatialReference=new u.A((0,s.HC)((t.isWGS84?e.altTemplate:null)??e.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(e){let t=null;const[r,i]=e.valid,n=this.xmin,s=this.xmax;return n>=r&&n<=i&&s>=r&&s<=i||(t=this.center),t}_normalize(e,t,r){const i=this.spatialReference;if(!i)return this;const n=r??(0,p.Vp)(i);if(null==n)return this;const s=this._getParts(n).map((e=>e.extent));if(s.length<2)return s[0]||this;if(s.length>2)return e?this._shiftCM(n):this.set({xmin:n.valid[0],xmax:n.valid[1]});if(e)return this._shiftCM(n);if(t)return s;let o=!0,a=!0;return s.forEach((e=>{e.hasZ||(o=!1),e.hasM||(a=!1)})),{rings:s.map((e=>{const t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(o){const r=(e.zmax-e.zmin)/2;for(let e=0;e<t.length;e++)t[e].push(r)}if(a){const r=(e.mmax-e.mmin)/2;for(let e=0;e<t.length;e++)t[e].push(r)}return t})),hasZ:o,hasM:a,spatialReference:i}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:r,ymax:n,spatialReference:s}=this,o=this.width,a=this.xmin,l=this.xmax;let c;e=e||(0,p.Vp)(s);const[u,h]=e.valid;c=y(this.xmin,e);const d=c.x,f=c.frameId;c=y(this.xmax,e);const m=c.x,g=c.frameId,_=d===m&&o>0;if(o>2*h){const e=new i(a<l?d:m,r,h,n,s),o=new i(u,r,a<l?m:d,n,s),c=new i(0,r,h,n,s),p=new i(u,r,0,n,s),y=[],_=[];e.contains(c)&&y.push(f),e.contains(p)&&_.push(f),o.contains(c)&&y.push(g),o.contains(p)&&_.push(g);for(let t=f+1;t<g;t++)y.push(t),_.push(t);t.push({extent:e,frameIds:[f]},{extent:o,frameIds:[g]},{extent:c,frameIds:y},{extent:p,frameIds:_})}else d>m||_?t.push({extent:new i(d,r,h,n,s),frameIds:[f]},{extent:new i(u,r,m,n,s),frameIds:[g]}):t.push({extent:new i(d,r,m,n,s),frameIds:[f]});this.cache._parts=t}const r=this.hasZ,n=this.hasM;if(r||n){const e={};r&&(e.zmin=this.zmin,e.zmax=this.zmax),n&&(e.mmin=this.mmin,e.mmax=this.mmax);for(let r=0;r<t.length;r++)t[r].extent.set(e)}return t}};function y(e,t){const[r,i]=t.valid,n=2*i;let s,o=0;return e>i?(s=Math.ceil(Math.abs(e-i)/n),e-=s*n,o=s):e<r&&(s=Math.ceil(Math.abs(e-r)/n),e+=s*n,o=-s),{x:e,frameId:o}}(0,n._)([(0,o.MZ)({readOnly:!0})],g.prototype,"cache",null),(0,n._)([(0,o.MZ)({readOnly:!0})],g.prototype,"center",null),(0,n._)([(0,o.MZ)({readOnly:!0})],g.prototype,"extent",null),(0,n._)([(0,o.MZ)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],g.prototype,"hasM",null),(0,n._)([(0,o.MZ)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],g.prototype,"hasZ",null),(0,n._)([(0,o.MZ)({readOnly:!0})],g.prototype,"height",null),(0,n._)([(0,o.MZ)({readOnly:!0})],g.prototype,"width",null),(0,n._)([(0,o.MZ)({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],g.prototype,"xmin",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],g.prototype,"ymin",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],g.prototype,"mmin",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],g.prototype,"zmin",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],g.prototype,"xmax",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],g.prototype,"ymax",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],g.prototype,"mmax",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],g.prototype,"zmax",void 0),g=i=(0,n._)([(0,a.$)("esri.geometry.Extent")],g),g.prototype.toJSON.isDefaultToJSON=!0;const _=g},89189:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i=r(35143),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(28379)),a=r(85842),l=r(13312);let c=class extends n.oY{constructor(){super(...arguments),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=l.A.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof l.A)return e;if(null!=e){const r=new l.A;return r.read(e,t),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};(0,i._)([(0,s.MZ)()],c.prototype,"type",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],c.prototype,"cache",null),(0,i._)([(0,s.MZ)({readOnly:!0})],c.prototype,"extent",null),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],c.prototype,"hasM",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],c.prototype,"hasZ",void 0),(0,i._)([(0,s.MZ)({type:l.A,json:{write:!0},value:l.A.WGS84})],c.prototype,"spatialReference",void 0),(0,i._)([(0,o.w)("spatialReference")],c.prototype,"readSpatialReference",null),c=(0,i._)([(0,a.$)("esri.geometry.Geometry")],c);const u=c},84735:(e,t,r)=>{"use strict";r.d(t,{z:()=>a});var i=r(53084),n=r(16108),s=r(19902),o=r(1484);class a{static fromOptimized(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return(new l).initialize(e,t,r,i,n)}static fromJSON(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const[i,n]=u(e);return(new h).initialize(i,n,t,r,1)}static fromOptimizedCIM(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return(new d).initialize(e,t,r,i,n)}static fromJSONCIM(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const[n,s]=u(e);return(new p).initialize(n,s,t,r,i)}static fromFeatureSetReader(e){const t=e.readGeometryForDisplay(),r=e.geometryType;return t&&r?this.fromOptimized(t,r):null}static fromFeatureSetReaderCIM(e){const t=e.readGeometryForDisplay(),r=e.geometryType;return t&&r?this.fromOptimizedCIM(t,r):null}static createEmptyOptimized(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return(new l).initialize(new o.A,e,t,r,i)}static createEmptyJSON(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(new h).initialize([],e,t,r,1)}static createEmptyOptimizedCIM(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return(new d).initialize(new o.A,e,t,r,i)}static createEmptyJSONCIM(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return(new p).initialize([],e,t,r,i)}asJSON(){const e=(0,n.x)(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:e.flat()}:"esriGeometryPoint"===this.geometryType?{x:e[0][0][0],y:e[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,t,r=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,t=this.y;const i=e,n=t;for(;this.nextPoint();)r+=(e-this.x)*(t+this.y),e=this.x,t=this.y;return r+=(e-i)*(t+n),-.5*r}invertY(){this.yFactor*=-1}}class l extends a{constructor(){super(...arguments),this._end=-1}initialize(e,t,r,i,n){return this.hasZ=r,this.hasM=i,this.geometryType=t,this._stride=2+Number(r)+Number(i),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=n,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){const t=this._pathOffset+e*this._stride;return t>=0&&t<this._end&&(this._pointOffset=t,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1)&&(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,!0)}prevPath(){return!(this.pathIndex<=0)&&(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,!0)}pathLength(){const e=this._end,t=this._stride,r=this._geometry.coords;let i=0;for(let n=this._pathOffset+t;n<e;n+=t){const e=r[n-t],s=r[n-t+1],o=r[n]-e,a=r[n+1]-s;i+=Math.sqrt(o*o+a*a)}return i}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let t=0;t<this._stride;++t)this._geometry.coords.push(e[t]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,t){this._geometry.coords.push(e,t),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const t of e)for(let e=0;e<this._stride;++e)this._geometry.coords.push(t[e]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){const t=e.asOptimized();this._geometry.coords.push(...t.coords),this._geometry.lengths.push(...t.lengths)}asOptimized(){const e=this._geometry.clone();if(1!==this.yFactor)for(let t=1;t<e.coords.length;t+=this._stride)e.coords[t]*=this.yFactor;return"esriGeometryPoint"===this.geometryType&&(e.lengths.length=0),e}isClosed(){const e=this._geometry.coords,t=this._pathOffset,r=this._end-this._stride;for(let i=0;i<this._stride;i++)if(e[t+i]!==e[r+i])return!1;return!0}clone(){return(new l).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce(((e,t)=>e+t))}get pathSize(){const{lengths:e}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>e.length-1?0:e[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){const e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}function c(e){const t=[e.x,e.y];return e.z&&t.push(e.z),e.m&&t.push(e.m),t}function u(e){return(0,s.Bi)(e)?[e.rings,"esriGeometryPolygon"]:(0,s.Rg)(e)?[e.paths,"esriGeometryPolyline"]:(0,s.U9)(e)?[[e.points],"esriGeometryMultipoint"]:(0,s.ZC)(e)?[[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],"esriGeometryEnvelope"]:(0,s.fT)(e)?[[[c(e)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}class h extends a{initialize(e,t,r,i,n){return this._paths=e,this.geometryType=t,this.hasZ=r,this.hasM=i,this._pathIndex=this._pointIndex=-1,this.yFactor=n,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const e=this._currentPath.length,t=this._currentPath;let r=0;for(let i=1;i<e;i++){const e=t[i-1],n=t[i],s=e[0],o=e[1],a=n[0]-s,l=n[1]-o;r+=Math.sqrt(a*a+l*l)}return r}startPath(){this._paths.push([])}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,t){this._paths[this.totalSize-1].push([e,t])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){const t=(0,n.x)(e);for(const r of t)this.pushPath(r)}asOptimized(){const e=new o.A;if("esriGeometryPoint"===this.geometryType)e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const t of this._paths){for(const r of t)e.coords.push(r[0]),e.coords.push(r[1]*this.yFactor),this.hasZ&&e.coords.push(r[2]),this.hasM&&e.coords.push(r[this._mIndex]);e.lengths.push(t.length)}return e}isClosed(){const e=this._currentPath[0],t=this._currentPath[this._currentPath.length-1];for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}clone(){return(new h).initialize((0,i.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map((e=>e.length)).reduce(((e,t)=>e+t))}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}}class d extends l{initialize(e,t,r,i,n){return super.initialize(e,t,r,i,n),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map((e=>new Set))),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const e=(new d).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return e._controlPoints=this._controlPoints,e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}}class p extends h{initialize(e,t,r,i,n){return super.initialize(e,t,r,i,n)}clone(){return(new p).initialize((0,i.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(e){this._paths[this.pathIndex][e][4]=1}getControlPointAt(e){return 1===this._paths[this.pathIndex][e][4]}}},91605:(e,t,r)=>{"use strict";r.d(t,{A:()=>v});var i,n=r(35143),s=r(18690),o=r(45802),a=r(42553),l=r(31633),c=r(62754),u=r(46053),h=(r(81806),r(76460),r(28379)),d=r(85842),p=r(17707);const f=(0,o.O)()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),m=f.jsonValues.slice();(0,s.Xy)(m,"orthometric");const g=(0,o.O)()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let y=i=class extends a.oY{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,r){return f.write(e,t,r)}readHeightModel(e,t,r){return f.read(e)||(r?.messages&&r.messages.push(function(e,t){return new c.A("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}(e,{context:r})),null)}readHeightUnit(e,t,r){return g.read(e)||(r?.messages&&r.messages.push(_(e,{context:r})),null)}readHeightUnitService(e,t,r){return(0,l.LA)(e)||g.read(e)||(r?.messages&&r.messages.push(_(e,{context:r})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new i({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const r=(0,l.k1)(t);return new i({heightModel:e.heightModel,heightUnit:r??void 0,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new i;return t.read(e,{origin:"web-scene"}),t}};function _(e,t){return new c.A("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}(0,n._)([(0,u.MZ)({type:f.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:m,default:"ellipsoidal"}}}})],y.prototype,"heightModel",void 0),(0,n._)([(0,p.K)("web-scene","heightModel")],y.prototype,"writeHeightModel",null),(0,n._)([(0,h.w)(["web-scene","service"],"heightModel")],y.prototype,"readHeightModel",null),(0,n._)([(0,u.MZ)({type:g.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:g.jsonValues,write:g.write}}}})],y.prototype,"heightUnit",void 0),(0,n._)([(0,h.w)("web-scene","heightUnit")],y.prototype,"readHeightUnit",null),(0,n._)([(0,h.w)("service","heightUnit")],y.prototype,"readHeightUnitService",null),(0,n._)([(0,u.MZ)({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],y.prototype,"vertCRS",void 0),(0,n._)([(0,h.w)("service","vertCRS",["vertCRS","ellipsoid","geoid"])],y.prototype,"readVertCRS",null),y=i=(0,n._)([(0,d.$)("esri.geometry.HeightModelInfo")],y);const v=y},66388:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var i,n=r(35143),s=r(53084),o=r(46053),a=(r(81806),r(76460),r(85842)),l=r(17707),c=r(76797),u=r(89189),h=r(19247),d=r(64867);function p(e){return(t,r)=>null==t?r:null==r?t:e(t,r)}let f=i=class extends u.A{constructor(){super(...arguments),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return{};const r={};Array.isArray(e)?(r.points=e,r.spatialReference=t):function(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}(e)?r.spatialReference=e:(e.points&&(r.points=e.points),e.spatialReference&&(r.spatialReference=e.spatialReference),e.hasZ&&(r.hasZ=e.hasZ),e.hasM&&(r.hasM=e.hasM));const i=r.points?.[0];return i&&(void 0===r.hasZ&&void 0===r.hasM?(r.hasZ=i.length>2,r.hasM=!1):void 0===r.hasZ?r.hasZ=i.length>3:void 0===r.hasM&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new c.A,r=this.hasZ,i=this.hasM,n=r?3:2,s=e[0],o=p(Math.min),a=p(Math.max);let l,u,h,d,[f,m]=s,[g,y]=s;for(let c=0,p=e.length;c<p;c++){const t=e[c],[s,p]=t;if(f=o(f,s),m=o(m,p),g=a(g,s),y=a(y,p),r&&t.length>2){const e=t[2];l=o(l,e),h=a(h,e)}if(i&&t.length>n){const e=t[n];u=o(u,e),d=a(d,e)}}return t.xmin=f,t.ymin=m,t.xmax=g,t.ymax=y,t.spatialReference=this.spatialReference,r?(t.zmin=l,t.zmax=h):(t.zmin=void 0,t.zmax=void 0),i?(t.mmin=u,t.mmax=d):(t.mmin=void 0,t.mmax=void 0),t}writePoints(e,t){t.points=(0,s.o8)(this.points)}addPoint(e){return(0,d.h)(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:(0,s.o8)(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new i(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],r={x:t[0],y:t[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=t[2],i=3),this.hasM&&(r.m=t[i]),new h.A(r)}removePoint(e){if(!this._validateInputs(e))return null;const t=new h.A(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?((0,d.h)(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return null!=e&&e>=0&&e<this.points.length}};(0,n._)([(0,o.MZ)({readOnly:!0})],f.prototype,"cache",null),(0,n._)([(0,o.MZ)()],f.prototype,"extent",null),(0,n._)([(0,o.MZ)({type:[[Number]],json:{write:{isRequired:!0}}})],f.prototype,"points",void 0),(0,n._)([(0,l.K)("points")],f.prototype,"writePoints",null),f=i=(0,n._)([(0,a.$)("esri.geometry.Multipoint")],f),f.prototype.toJSON.isDefaultToJSON=!0;const m=f},19247:(e,t,r)=>{"use strict";r.d(t,{A:()=>b});var i,n=r(35143),s=r(76460),o=r(46053),a=r(21403),l=(r(47249),r(81806),r(28379)),c=r(85842),u=r(17707),h=r(40565),d=r(89189),p=r(13312),f=r(12294),m=r(80963),g=r(45417);const y=[0,0];function _(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}let v=i=class extends d.A{static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const r=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(){super(...arguments),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(e,t,r,i,n){let o;if(Array.isArray(e))o=e,n=t,e=o[0],t=o[1],r=o[2],i=o[3];else if(e&&"object"==typeof e){if(o=e,e=null!=o.x?o.x:o.longitude,t=null!=o.y?o.y:o.latitude,r=o.z,i=o.m,(n=o.spatialReference)&&"esri.geometry.SpatialReference"!==n.declaredClass&&(n=new p.A(n)),null!=o.longitude||null!=o.latitude)if(null==o.longitude)s.A.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(null==o.latitude)s.A.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!o.declaredClass&&n?.isWebMercator){const r=(0,g.je)(o.longitude,o.latitude,y);e=r[0],t=r[1]}}else _(r)?(n=r,r=null):_(i)&&(n=i,i=null);const a={x:e,y:t};return null==a.x&&null!=a.y?s.A.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):null==a.y&&null!=a.x&&s.A.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),null!=n&&(a.spatialReference=n),null!=r&&(a.z=r),null!=i&&(a.m=i),a}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return void 0!==this.m}set hasM(e){e!==(void 0!==this._get("m"))&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return void 0!==this.z}set hasZ(e){e!==(void 0!==this._get("z"))&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){return(0,f.T0)(this)}set latitude(e){const{spatialReference:t,x:r}=this;null!=e&&t&&(t.isWebMercator?this._set("y",(0,g.je)(r,e,y)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){return(0,f.EZ)(this)}set longitude(e){const{y:t,spatialReference:r}=this;null!=e&&r&&(r.isWebMercator?this._set("x",(0,g.je)(e,t,y)[0]):r.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,r){t[r]=isNaN(e)?"NaN":e}readX(e){return"string"==typeof e?NaN:e}clone(){const e=new i;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return i.copy(e,this),this}equals(e){if(null==e)return!1;const{x:t,y:r,z:i,m:n,spatialReference:s}=this,{z:o,m:a}=e;let{x:l,y:c,spatialReference:u}=e;if(!s.equals(u))if(s.isWebMercator&&u.isWGS84)[l,c]=(0,g.je)(l,c),u=s;else{if(!s.isWGS84||!u.isWebMercator)return!1;[l,c]=(0,g.tD)(l,c),u=s}return t===l&&r===c&&i===o&&n===a&&s.wkid===u.wkid}offset(e,t,r){return this.x+=e,this.y+=t,null!=r&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const e=(0,m.Vp)(this.spatialReference);if(!e)return this;let t=this.x;const[r,i]=e.valid,n=2*i;let s;return t>i?(s=Math.ceil(Math.abs(t-i)/n),t-=s*n):t<r&&(s=Math.ceil(Math.abs(t-r)/n),t+=s*n),this._set("x",t),this}distance(e){return(0,f.Io)(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};(0,n._)([(0,o.MZ)({readOnly:!0})],v.prototype,"cache",null),(0,n._)([(0,o.MZ)({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],v.prototype,"hasM",null),(0,n._)([(0,o.MZ)({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],v.prototype,"hasZ",null),(0,n._)([(0,o.MZ)({type:Number})],v.prototype,"latitude",null),(0,n._)([(0,o.MZ)({type:Number})],v.prototype,"longitude",null),(0,n._)([(0,o.MZ)({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),(0,a.w)((e=>isNaN(e)?e:(0,h.GB)(e)))],v.prototype,"x",void 0),(0,n._)([(0,u.K)("x")],v.prototype,"writeX",null),(0,n._)([(0,l.w)("x")],v.prototype,"readX",null),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],v.prototype,"y",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],v.prototype,"z",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],v.prototype,"m",void 0),v=i=(0,n._)([(0,c.$)("esri.geometry.Point")],v),v.prototype.toJSON.isDefaultToJSON=!0;const b=v},65215:(e,t,r)=>{"use strict";r.d(t,{A:()=>S});var i,n=r(35143),s=r(18690),o=r(53084),a=r(46053),l=(r(81806),r(76460),r(85842)),c=r(17707),u=r(76797),h=r(89189),d=r(19247),p=r(13312),f=r(205),m=r(11352),g=r(5262),y=r(27084),_=r(65658),v=r(45417),b=r(64867);function w(e){return!Array.isArray(e[0])}let x=i=class extends h.A{static fromExtent(e){const t=e.clone().normalize(),r=e.spatialReference;let n=!1,s=!1;for(const i of t)i.hasZ&&(n=!0),i.hasM&&(s=!0);const o={rings:t.map((e=>{const t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(n&&e.hasZ){const r=e.zmin+.5*(e.zmax-e.zmin);for(let e=0;e<t.length;e++)t[e].push(r)}if(s&&e.hasM){const r=e.mmin+.5*(e.mmax-e.mmin);for(let e=0;e<t.length;e++)t[e].push(r)}return t})),spatialReference:r};return n&&(o.hasZ=!0),s&&(o.hasM=!0),new i(o)}constructor(){super(...arguments),this.rings=[],this.type="polygon"}normalizeCtorArgs(e,t){let r,i,n=null,s=null;return e&&!Array.isArray(e)?(n=e.rings??null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),r=e.hasZ,i=e.hasM):n=e,n=n||[],t=t||p.A.WGS84,n.length&&null!=n[0]?.[0]&&"number"==typeof n[0][0]&&(n=[n]),s=n[0]?.[0],s&&(void 0===r&&void 0===i?(r=s.length>2,i=s.length>3):void 0===r?r=i?s.length>3:s.length>2:void 0===i&&(i=r?s.length>3:s.length>2)),{rings:n,spatialReference:t,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=(0,f.l8)(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new d.A;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=(0,y.v)(this);if(!t)return null;const r=new u.A(t);return r.spatialReference=e,r}get isSelfIntersecting(){return(0,_.A3)(this.rings)}writeRings(e,t){t.rings=(0,o.o8)(this.rings)}addRing(e){if(!e)return;const t=this.rings,r=t.length;if(w(e)){const i=[];for(let t=0,r=e.length;t<r;t++)i[t]=e[t].toArray();t[r]=i}else t[r]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new i;return e.spatialReference=this.spatialReference,e.rings=(0,o.o8)(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(null==e)return!1;const t=this.spatialReference,r=e.spatialReference;if(null!=t!=(null!=r))return!1;if(null!=t&&null!=r&&!t.equals(r))return!1;if(this.rings.length!==e.rings.length)return!1;const i=(e,t)=>{let[r,i,n,s]=e,[o,a,l,c]=t;return r===o&&i===a&&(null==n&&null==l||n===l)&&(null==s&&null==c||s===c)};for(let n=0;n<this.rings.length;n++){const t=this.rings[n],r=e.rings[n];if(!(0,s.aI)(t,r,i))return!1}return!0}contains(e){if(!e)return!1;const t=(0,v.Cv)(e,this.spatialReference);return(0,m.m3)(this,null!=t?t:e)}isClockwise(e){const t=w(e)?e.map((e=>this.hasZ?this.hasM?[e.x,e.y,e.z,e.m]:[e.x,e.y,e.z]:[e.x,e.y])):e;return(0,g.$3)(t)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const r=this.rings[e][t],i=this.hasZ,n=this.hasM;return i&&!n?new d.A(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new d.A(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new d.A(r[0],r[1],r[2],r[3],this.spatialReference):new d.A(r[0],r[1],this.spatialReference)}insertPoint(e,t,r){return this._validateInputs(e,t,!0)?((0,b.h)(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e].splice(t,0,r),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const r=new d.A(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],r=this.spatialReference,i=t.map((e=>new d.A(e,r)));return this.notifyChange("rings"),i}setPoint(e,t,r){return this._validateInputs(e,t)?((0,b.h)(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e][t]=r,this.notifyChange("rings"),this):this}_validateInputs(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||e<0||e>=this.rings.length)return!1;if(null!=t){const i=this.rings[e];if(r&&(t<0||t>i.length))return!1;if(!r&&(t<0||t>=i.length))return!1}return!0}toJSON(e){return this.write({},e)}};(0,n._)([(0,a.MZ)({readOnly:!0})],x.prototype,"cache",null),(0,n._)([(0,a.MZ)({readOnly:!0})],x.prototype,"centroid",null),(0,n._)([(0,a.MZ)({readOnly:!0})],x.prototype,"extent",null),(0,n._)([(0,a.MZ)({readOnly:!0})],x.prototype,"isSelfIntersecting",null),(0,n._)([(0,a.MZ)({type:[[[Number]]],json:{write:{isRequired:!0}}})],x.prototype,"rings",void 0),(0,n._)([(0,c.K)("rings")],x.prototype,"writeRings",null),x=i=(0,n._)([(0,l.$)("esri.geometry.Polygon")],x),x.prototype.toJSON.isDefaultToJSON=!0;const S=x},23701:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var i,n=r(35143),s=r(53084),o=r(46053),a=(r(81806),r(76460),r(85842)),l=r(17707),c=r(76797),u=r(89189),h=r(19247),d=r(13312),p=r(27084),f=r(64867);let m=i=class extends u.A{constructor(){super(...arguments),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let r,i,n=null,s=null;return e&&!Array.isArray(e)?(n=e.paths??null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),r=e.hasZ,i=e.hasM):n=e,n=n||[],t=t||d.A.WGS84,n.length&&null!=n[0]?.[0]&&"number"==typeof n[0][0]&&(n=[n]),s=n[0]?.[0],s&&(void 0===r&&void 0===i?(r=s.length>2,i=!1):void 0===r?r=!i&&s.length>3:void 0===i&&(i=!r&&s.length>3)),{paths:n,spatialReference:t,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=(0,p.Z3)(this);if(!t)return null;const r=new c.A(t);return r.spatialReference=e,r}writePaths(e,t){t.paths=(0,s.o8)(this.paths)}addPath(e){if(!e)return;const t=this.paths,r=t.length;if(function(e){return!Array.isArray(e[0])}(e)){const i=[];for(let t=0,r=e.length;t<r;t++)i[t]=e[t].toArray();t[r]=i}else t[r]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new i;return e.spatialReference=this.spatialReference,e.paths=(0,s.o8)(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const r=this.paths[e][t],i=this.hasZ,n=this.hasM;return i&&!n?new h.A(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new h.A(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new h.A(r[0],r[1],r[2],r[3],this.spatialReference):new h.A(r[0],r[1],this.spatialReference)}insertPoint(e,t,r){return this._validateInputs(e,t,!0)?((0,f.h)(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e].splice(t,0,r),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],r=this.spatialReference,i=t.map((e=>new h.A(e,r)));return this.notifyChange("paths"),i}removePoint(e,t){if(!this._validateInputs(e,t))return null;const r=new h.A(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(e,t,r){return this._validateInputs(e,t)?((0,f.h)(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e][t]=r,this.notifyChange("paths"),this):this}_validateInputs(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||e<0||e>=this.paths.length)return!1;if(null!=t){const i=this.paths[e];if(r&&(t<0||t>i.length))return!1;if(!r&&(t<0||t>=i.length))return!1}return!0}toJSON(e){return this.write({},e)}};(0,n._)([(0,o.MZ)({readOnly:!0})],m.prototype,"cache",null),(0,n._)([(0,o.MZ)({readOnly:!0})],m.prototype,"extent",null),(0,n._)([(0,o.MZ)({type:[[[Number]]],json:{write:{isRequired:!0}}})],m.prototype,"paths",void 0),(0,n._)([(0,l.K)("paths")],m.prototype,"writePaths",null),m=i=(0,n._)([(0,a.$)("esri.geometry.Polyline")],m),m.prototype.toJSON.isDefaultToJSON=!0;const g=m},13312:(e,t,r)=>{"use strict";r.d(t,{A:()=>f});var i,n=r(35143),s=r(42553),o=r(53084),a=r(31633),l=r(40565),c=r(46053),u=r(85842),h=r(17707),d=r(80963);let p=i=class extends s.oY{static fromJSON(e){if(!e)return null;if(e.wkid){if(102100===e.wkid)return i.WebMercator;if(4326===e.wkid)return i.WGS84}const t=new i;return t.read(e),t}constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(e){if(e&&"object"==typeof e)return e;const t="string"==typeof e?"wkt":"wkid";return{[t]:e}}get isWGS84(){return(0,d.oT)(this)}get isWebMercator(){return(0,d.K8)(this)}get isGeographic(){return(0,d.EA)(this)}get isWrappable(){return(0,d.d9)(this)}get metersPerUnit(){return(0,a.GA)(this)}get unit(){return(0,a.Ij)(this)||(this.isGeographic?"degrees":null)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===i.WGS84)return new i(d.KK);if(this===i.WebMercator)return new i(d.ch);const e=new i;return null!=this.wkid?(e.wkid=this.wkid,null!=this.latestWkid&&(e.latestWkid=this.latestWkid),null!=this.vcsWkid&&(e.vcsWkid=this.vcsWkid),null!=this.latestVcsWkid&&(e.latestVcsWkid=this.latestVcsWkid)):(null!=this.wkt&&(e.wkt=this.wkt),null!=this.wkt2&&(e.wkt2=this.wkt2)),this.imageCoordinateSystem&&(e.imageCoordinateSystem=(0,o.o8)(this.imageCoordinateSystem)),e}equals(e){if(null==e)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(null==this.imageCoordinateSystem||null==e.imageCoordinateSystem)return!1;const{id:t,referenceServiceName:r}=e.imageCoordinateSystem,{geodataXform:i}=e.imageCoordinateSystem,n=this.imageCoordinateSystem;return null==t||i?JSON.stringify(n)===JSON.stringify(e.imageCoordinateSystem):r?n.id===t&&n.referenceServiceName===r:n.id===t}return(0,d.aI)(this,e)}toJSON(e){return this.write(void 0,e)}};p.GCS_NAD_1927=null,p.WGS84=null,p.WebMercator=null,p.PlateCarree=null,(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"isWGS84",null),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"isWebMercator",null),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"isGeographic",null),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"isWrappable",null),(0,n._)([(0,c.MZ)({type:l.jz,json:{write:!0}})],p.prototype,"latestWkid",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"metersPerUnit",null),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"unit",null),(0,n._)([(0,c.MZ)({type:l.jz,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null==this.wkt}}}}}}})],p.prototype,"wkid",void 0),(0,n._)([(0,c.MZ)({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null==this.wkid}}}}}}})],p.prototype,"wkt",void 0),(0,n._)([(0,h.K)("wkt"),(0,h.K)("web-scene","wkt")],p.prototype,"writeWkt",null),(0,n._)([(0,c.MZ)({type:String,json:{write:!1}})],p.prototype,"wkt2",void 0),(0,n._)([(0,c.MZ)({type:l.jz,json:{write:!0}})],p.prototype,"vcsWkid",void 0),(0,n._)([(0,c.MZ)({type:l.jz,json:{write:!0}})],p.prototype,"latestVcsWkid",void 0),(0,n._)([(0,c.MZ)()],p.prototype,"imageCoordinateSystem",void 0),p=i=(0,n._)([(0,u.$)("esri.geometry.SpatialReference")],p),p.prototype.toJSON.isDefaultToJSON=!0,p.GCS_NAD_1927=new p({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),p.WGS84=new p(d.KK),p.WebMercator=new p(d.ch),p.PlateCarree=new p(d.tQ),Object.freeze&&(Object.freeze(p.GCS_NAD_1927),Object.freeze(p.WGS84),Object.freeze(p.WebMercator),Object.freeze(p.PlateCarree));const f=p},34111:(e,t,r)=>{"use strict";r.d(t,{FY:()=>a,LJ:()=>l,Ro:()=>c,fv:()=>o,jA:()=>f,tO:()=>d,xP:()=>m,y7:()=>p});var i=r(14556),n=r(80963);function s(e){return{wkt:`GEOCCS["Spherical geocentric",\n    DATUM["Not specified",\n      SPHEROID["Sphere",${e.radius},0]],\n    PRIMEM["Greenwich",0.0,\n      AUTHORITY["EPSG","8901"]],\n    UNIT["m",1.0],\n    AXIS["Geocentric X",OTHER],\n    AXIS["Geocentric Y",EAST],\n    AXIS["Geocentric Z",NORTH]\n  ]`}}const o=s(i.$O),a=s(i.sH),l=s(i.Sw),c={wkt:`GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",${i.$O.radius},298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]`},u=a.wkt.toUpperCase(),h=l.wkt.toUpperCase();function d(e){if(null!=e&&(0,n.fn)(e)){const t=e.wkid,r=e.wkt2??e.wkt;if((0,n.tl)(t))return i.sH;const s=r?.toUpperCase();if(r&&s===u)return i.sH;if((0,n.ZL)(t)||s&&s===h)return i.Sw}return i.$O}function p(e){return(0,n.tl)(e)?i.sH:(0,n.ZL)(e)?i.Sw:i.$O}function f(e){return(0,n.aI)(e,o)}function m(e){return f(e)||(0,n.aI)(e,a)||(0,n.aI)(e,l)}},16108:(e,t,r)=>{"use strict";function i(e){const t=[];for(e.reset();e.nextPath();){const r=[];for(;e.nextPoint();)r.push([e.x,e.y]);t.push(r)}return e.reset(),t}function n(e){const t=[];for(;e.nextPoint();)t.push([e.x,e.y]);return e.seekPathStart(),t}r.d(t,{A:()=>n,x:()=>i})},9624:(e,t,r)=>{"use strict";r.r(t),r.d(t,{canProjectWithoutEngine:()=>H,getTransformation:()=>F,getTransformations:()=>k,initializeProjection:()=>Z,isEqualBaseGCS:()=>G,isLoaded:()=>C,isLoadedOrLoad:()=>E,isLoadedOrLoadFor:()=>R,load:()=>O,project:()=>I,projectExtent:()=>te,projectMany:()=>L,projectMultipoint:()=>Y,projectOrLoad:()=>N,projectOrLoadMany:()=>D,projectPoint:()=>q,projectPolygon:()=>Q,projectPolyline:()=>J,projectWithZConversion:()=>j,projectWithoutEngine:()=>$,requiresLoad:()=>P,test:()=>V,tryProjectWithZConversion:()=>B,unload:()=>U});var i=r(50076),n=r(50346),s=r(99486),o=r(99702),a=r(9392),l=r(34111),c=r(76797),u=r(66388),h=r(7724),d=r(19247),p=r(65215),f=r(23701),m=r(13312),g=r(45308),y=r(482),_=r(91789),v=r(64681),b=r(80963),w=r(86729);let x=null,S=null,T=null,M={};const A=new o.I;function C(){return!!x&&(0,h.i)()}function E(){return!!C()||((0,s.gc)(A),O(),!1)}function R(e,t){return!e||!t||H(e,t)||E()}function P(e,t){return!H(e,t)&&!C()}function O(e){return null==T&&(T=Promise.all([(0,h.l)(),r.e(2612).then(r.bind(r,52612)).then((e=>e.g)),r.e(5617).then(r.bind(r,35617))])),T.then((t=>{let[,r,{hydratedAdapter:i}]=t;(0,n.Te)(e),S=i,x=r.default,x._enableProjection(h.p),A.notify()}))}function I(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Array.isArray(e)?0===e.length?[]:L(S,e,e[0].spatialReference,t,r,i):L(S,[e],e.spatialReference,t,r,i)[0]}function L(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(null==r||null==i)return t;if(H(r,i,n))return t.map((e=>$(e,r,i)));if(null==n&&(0,l.jA)(r))return t.map((e=>$(e,r,m.A.WGS84))).map((e=>B(e,i)));if(null==n&&(0,l.jA)(i))return t.map((e=>B(e,m.A.WGS84))).map((e=>$(e,m.A.WGS84,i)));if(null==n){const e=v.A.cacheKey(r,i);void 0!==M[e]?n=M[e]:(null==(n=F(r,i,void 0))&&(n=new v.A),M[e]=n)}if(null==x||null==e)throw new z;return null!=s?x._project(e,t,r,i,n,s):x._project(e,t,r,i,n)}function N(e,t){const r=D([e],t);return null!=r.pending?{pending:r.pending,geometry:null}:null!=r.geometries?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function D(e,t){if(!C())for(const r of e)if(null!=r&&!(0,b.aI)(r.spatialReference,t)&&(0,b.fn)(r.spatialReference)&&(0,b.fn)(t)&&!H(r.spatialReference,t))return(0,s.gc)(A),{pending:O(),geometries:null};return{pending:null,geometries:e.map((e=>null==e?null:(0,b.aI)(e.spatialReference,t)?e:(0,b.fn)(e.spatialReference)&&(0,b.fn)(t)?B(e,t):null))}}function F(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==e||null==t)return null;if(null==x||null==S)throw new z;const i=x._getTransformation(S,e,t,r,r?.spatialReference);return null!==i?v.A.fromGE(i):null}function k(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==x||null==S)throw new z;const i=x._getTransformationBySuitability(S,e,t,r,r?.spatialReference);if(null!==i){const e=[];for(const t of i)e.push(v.A.fromGE(t));return e}return[]}class z extends i.A{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}function U(){x=null,S=null,T=null,M={}}const V={get loadPromise(){return T}};function B(e,t){try{const r=I(e,t);if(null==r)return null;"xmin"in e&&"xmin"in r&&(r.zmin=e.zmin,r.zmax=e.zmax);const i=(0,w.N)(r.type,e.spatialReference,t);return null!=i&&i(r),r}catch(r){if(!(r instanceof z))throw r;return null}}async function j(e,t,r){const i=e.spatialReference;return null!=i&&null!=t&&await Z(i,t,null,r),B(e,t)}function H(e,t,r){return!r&&(!!(0,b.aI)(e,t)||(0,b.fn)(e)&&(0,b.fn)(t)&&!!(0,y.jd)(e,t,y.N9))}function G(e,t){if((0,b.aI)(e,t))return!0;if(!(0,b.fn)(e)||!(0,b.fn)(t))return!1;const r=(0,b.oT)(e)||(0,b.K8)(e)||(0,b.x1)(e),i=(0,b.oT)(t)||(0,b.K8)(t)||(0,b.x1)(t);return r&&i}async function Z(e,t,r,i){if(C())return(0,n.NO)(i);if(Array.isArray(e)){for(const{source:n,dest:s,geographicTransformation:o}of e)if(n&&s&&!H(n,s,o))return O(i)}else if(e&&t&&!H(e,t,r))return O(i);return(0,n.NO)(i)}function $(e,t,r){return e?"x"in e?W(e,t,new d.A,r,0):"xmin"in e?re(e,t,new c.A,r,0):"rings"in e?ee(e,t,new p.A,r,0):"paths"in e?K(e,t,new f.A,r,0):"points"in e?X(e,t,new u.A,r,0):null:null}function q(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.spatialReference,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return null!=r&&null!=e.spatialReference&&null!=W(e,e.spatialReference,t,r,i)}function W(e,t,r,i,n){ne[0]=e.x,ne[1]=e.y;const s=e.z;return ne[2]=void 0!==s?s:n,(0,g.projectBuffer)(ne,t,0,ne,i,0,1)?(r.x=ne[0],r.y=ne[1],r.spatialReference=i,void 0!==s||(0,l.xP)(i)?(r.z=ne[2],r.hasZ=!0):(r.z=void 0,r.hasZ=!1),void 0===e.m?(r.m=void 0,r.hasM=!1):(r.m=e.m,r.hasM=!0),r):null}function Y(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.spatialReference,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return null!=e.spatialReference&&null!=r&&null!=X(e,e.spatialReference,t,r,i)}function X(e,t,r,i,n){const{points:s,hasZ:o,hasM:a}=e,c=[],u=s.length,h=[];for(const l of s)h.push(l[0],l[1],o?l[2]:n);if(!(0,g.projectBuffer)(h,t,0,h,i,0,u))return null;const d=o||(0,l.xP)(i);for(let l=0;l<u;++l){const e=3*l,t=h[e],r=h[e+1];d&&a?c.push([t,r,h[e+2],s[l][3]]):d?c.push([t,r,h[e+2]]):a?c.push([t,r,s[l][2]]):c.push([t,r])}return r.points=c,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function J(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.spatialReference,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return null!=e.spatialReference&&null!=r&&null!=K(e,e.spatialReference,t,r,i)}function K(e,t,r,i,n){const{paths:s,hasZ:o,hasM:a}=e,c=[];if(!ie(s,o??!1,a??!1,t,c,i,n))return null;const u=o||(0,l.xP)(i);return r.paths=c,r.spatialReference=i,r.hasZ=u,r.hasM=a,r}function Q(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.spatialReference,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return null!=e.spatialReference&&null!=r&&null!=ee(e,e.spatialReference,t,r,i)}function ee(e,t,r,i,n){const{rings:s,hasZ:o,hasM:a}=e,c=[];if(!ie(s,o??!1,a??!1,t,c,i,n))return null;const u=o||(0,l.xP)(i);return r.rings=c,r.spatialReference=i,r.hasZ=u,r.hasM=a,r}function te(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.spatialReference,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return null!=e.spatialReference&&null!=r&&null!=re(e,e.spatialReference,t,r,i)}function re(e,t,r,i,n){const{xmin:s,ymin:o,xmax:a,ymax:c,hasZ:u,hasM:h}=e,d=u?e.zmin:n;if(!(0,_.L)(s,o,d,t,ne,i))return null;const p=u||(0,l.xP)(i);r.xmin=ne[0],r.ymin=ne[1],p&&(r.zmin=ne[2]);const f=u?e.zmax:n;return(0,_.L)(a,c,f,t,ne,i)?(r.xmax=ne[0],r.ymax=ne[1],p&&(r.zmax=ne[2]),h&&(r.mmin=e.mmin,r.mmax=e.mmax),r.spatialReference=i,r):null}function ie(e,t,r,i,n,s){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const a=new Array;for(const l of e)for(const e of l)a.push(e[0],e[1],t?e[2]:o);if(!(0,g.projectBuffer)(a,i,0,a,s,0,a.length/3))return!1;let c=0;n.length=0;const u=t||(0,l.xP)(s);for(const l of e){const e=new Array;for(const t of l)u&&r?e.push([a[c++],a[c++],a[c++],t[3]]):u?e.push([a[c++],a[c++],a[c++]]):r?(e.push([a[c++],a[c++],t[2]]),c++):(e.push([a[c++],a[c++]]),c++);n.push(e)}return!0}const ne=(0,a.vt)()},5809:(e,t,r)=>{"use strict";r.d(t,{l:()=>c});var i=r(15941),n=r(34761),s=r(9392),o=r(4437),a=r(482),l=r(80963);function c(e,t,r,i){if(null==e||null==i)return!1;const s=(0,a.Qk)(e,a.Wv),c=(0,a.Qk)(i,a.zp);if(s===c&&!u(c)&&(s!==a.rz.UNKNOWN||(0,l.aI)(e,i)))return(0,n.kN)(r,t),!0;if(u(c)){const e=a.w5[s][a.rz.LON_LAT],i=a.w5[a.rz.LON_LAT][c];return null!=e&&null!=i&&(e(t,0,d,0),i(d,0,p,0),(0,o.y)(h*d[0],h*d[1],r),r[12]=p[0],r[13]=p[1],r[14]=p[2],!0)}if(!(c!==a.rz.WEB_MERCATOR&&c!==a.rz.PLATE_CARREE&&c!==a.rz.WGS84&&c!==a.rz.CGCS2000||s!==a.rz.WGS84&&s!==a.rz.SPHERICAL_ECEF&&s!==a.rz.WEB_MERCATOR&&s!==a.rz.CGCS2000)){const e=a.w5[s][a.rz.LON_LAT],i=a.w5[a.rz.LON_LAT][c];return null!=e&&null!=i&&(e(t,0,d,0),i(d,0,p,0),s===a.rz.SPHERICAL_ECEF?(0,o.C)(h*d[0],h*d[1],r):(0,n.D_)(r),r[12]=p[0],r[13]=p[1],r[14]=p[2],!0)}return!1}function u(e){return e===a.rz.SPHERICAL_ECEF||e===a.rz.SPHERICAL_MARS_PCPF||e===a.rz.SPHERICAL_MOON_PCPF}const h=(0,i.kU)(1),d=(0,s.vt)(),p=(0,s.vt)()},4437:(e,t,r)=>{"use strict";r.d(t,{C:()=>s,y:()=>n});var i=r(34761);function n(e,t,r){const i=Math.sin(e),n=Math.cos(e),s=Math.sin(t),o=Math.cos(t),a=r;return a[0]=-i,a[4]=-s*n,a[8]=o*n,a[12]=0,a[1]=n,a[5]=-s*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function s(e,t,r){return n(e,t,r),(0,i.mg)(r,r),r}},50840:(e,t,r)=>{"use strict";r.d(t,{S:()=>a});var i=r(9392),n=r(45308),s=r(2413),o=r(80963);function a(e,t,r,i){return null!=e&&((0,o.aI)(t,i)?((0,s.C)(r,e),!0):(l[0]=e[0],l[1]=e[1],l[2]=0,!!(0,n.projectBuffer)(l,t,0,l,i,0,1)&&(r[0]=l[0],r[1]=l[1],l[0]=e[2],l[1]=e[3],l[2]=0,!!(0,n.projectBuffer)(l,t,0,l,i,0,1)&&(r[2]=l[0],r[3]=l[1],!0))))}const l=(0,i.vt)()},45308:(e,t,r)=>{"use strict";r.r(t),r.d(t,{projectBuffer:()=>n});var i=r(482);function n(e,t,r,n,s,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;const l=(0,i.jd)(t,s,i.N9);if(null==l)return!1;if(l===i.pO){if(e===n&&r===o)return!0;const t=r+3*a;for(let i=r,s=o;i<t;i++,s++)n[s]=e[i];return!0}const c=r+3*a;for(let i=r,u=o;i<c;i+=3,u+=3)l(e,i,n,u);return!0}},64232:(e,t,r)=>{"use strict";r.d(t,{W:()=>a,g:()=>o});var i=r(9392),n=r(9624),s=r(45308);function o(e,t,r,i){if((0,n.canProjectWithoutEngine)(e.spatialReference,r)){l[0]=e.x,l[1]=e.y;const n=e.z;return l[2]=n??i??0,(0,s.projectBuffer)(l,e.spatialReference,0,t,r,0,1)}const o=(0,n.tryProjectWithZConversion)(e,r);return!!o&&(t[0]=o?.x,t[1]=o?.y,t[2]=o?.z??i??0,!0)}async function a(e,t,r,i,s){return await(0,n.initializeProjection)(e.spatialReference,r,null,s),o(e,t,r,i)}const l=(0,i.vt)()},60216:(e,t,r)=>{"use strict";r.d(t,{C:()=>a,E:()=>o});var i=r(9392),n=r(9624),s=r(14487);function o(e,t,r){return!!(0,s.F)(e,t,l,r.spatialReference)&&(r.x=l[0],r.y=l[1],r.z=l[2],!0)}async function a(e,t,r,i){return await(0,n.initializeProjection)(t,r.spatialReference,null,i),o(e,t,r)}const l=(0,i.vt)()},14487:(e,t,r)=>{"use strict";r.d(t,{F:()=>s});r(9624);var i=r(13312),n=r(64232);function s(e,t,r,i,s){return!(null==t||null==i||e.length<2)&&(o.x=e[0],o.y=e[1],o.z=e[2],o.spatialReference=t,(0,n.g)(o,r,i,s))}const o=(0,r(18117).T)(0,0,0,i.A.WGS84)},91789:(e,t,r)=>{"use strict";r.d(t,{L:()=>s});var i=r(9392),n=r(45308);function s(e,t,r,i,s,a){return o[0]=e,o[1]=t,o[2]=r,(0,n.projectBuffer)(o,i,0,s,a,0,1)}const o=(0,i.vt)()},482:(e,t,r)=>{"use strict";r.d(t,{N9:()=>j,Qk:()=>f,RC:()=>v,Ur:()=>U,Wv:()=>V,iE:()=>Y,jd:()=>d,n4:()=>E,pO:()=>m,rz:()=>i,s7:()=>b,t_:()=>z,w5:()=>h,wy:()=>p,zp:()=>B});var i,n=r(15941),s=r(31633),o=r(34111),a=r(14556),l=r(63885),c=r(80963),u=r(34038);!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.SPHERICAL_MARS_PCPF=6]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=7]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=8]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=9]="GCSMOON2000",e[e.LON_LAT=10]="LON_LAT",e[e.PLATE_CARREE=11]="PLATE_CARREE"}(i||(i={}));const h={[i.WGS84]:{[i.CGCS2000]:m,[i.GCSMARS2000]:null,[i.GCSMOON2000]:null,[i.LON_LAT]:m,[i.SPHERICAL_ECEF]:C,[i.SPHERICAL_MARS_PCPF]:null,[i.SPHERICAL_MOON_PCPF]:null,[i.UNKNOWN]:null,[i.WEB_MERCATOR]:b,[i.PLATE_CARREE]:w,[i.WGS84]:m,[i.WGS84_ECEF]:N},[i.CGCS2000]:{[i.CGCS2000]:m,[i.GCSMARS2000]:null,[i.GCSMOON2000]:null,[i.LON_LAT]:m,[i.SPHERICAL_ECEF]:C,[i.SPHERICAL_MARS_PCPF]:null,[i.SPHERICAL_MOON_PCPF]:null,[i.UNKNOWN]:null,[i.WEB_MERCATOR]:b,[i.PLATE_CARREE]:w,[i.WGS84]:m,[i.WGS84_ECEF]:N},[i.GCSMARS2000]:{[i.CGCS2000]:null,[i.GCSMARS2000]:m,[i.GCSMOON2000]:null,[i.LON_LAT]:m,[i.SPHERICAL_ECEF]:null,[i.SPHERICAL_MARS_PCPF]:A,[i.SPHERICAL_MOON_PCPF]:null,[i.UNKNOWN]:null,[i.WEB_MERCATOR]:null,[i.PLATE_CARREE]:null,[i.WGS84]:null,[i.WGS84_ECEF]:null},[i.GCSMOON2000]:{[i.CGCS2000]:null,[i.GCSMARS2000]:null,[i.GCSMOON2000]:m,[i.LON_LAT]:m,[i.SPHERICAL_ECEF]:null,[i.SPHERICAL_MARS_PCPF]:null,[i.SPHERICAL_MOON_PCPF]:M,[i.UNKNOWN]:null,[i.WEB_MERCATOR]:null,[i.PLATE_CARREE]:null,[i.WGS84]:null,[i.WGS84_ECEF]:null},[i.WEB_MERCATOR]:{[i.CGCS2000]:g,[i.GCSMARS2000]:null,[i.GCSMOON2000]:null,[i.LON_LAT]:g,[i.SPHERICAL_ECEF]:y,[i.SPHERICAL_MARS_PCPF]:null,[i.SPHERICAL_MOON_PCPF]:null,[i.UNKNOWN]:null,[i.WEB_MERCATOR]:m,[i.PLATE_CARREE]:S,[i.WGS84]:g,[i.WGS84_ECEF]:_},[i.WGS84_ECEF]:{[i.CGCS2000]:D,[i.GCSMARS2000]:null,[i.GCSMOON2000]:null,[i.LON_LAT]:D,[i.SPHERICAL_ECEF]:F,[i.SPHERICAL_MARS_PCPF]:null,[i.SPHERICAL_MOON_PCPF]:null,[i.UNKNOWN]:null,[i.WEB_MERCATOR]:k,[i.PLATE_CARREE]:function(e,t,r,i){D(e,t,r,i),w(r,i,r,i)},[i.WGS84]:D,[i.WGS84_ECEF]:m},[i.SPHERICAL_ECEF]:{[i.CGCS2000]:O,[i.GCSMARS2000]:null,[i.GCSMOON2000]:null,[i.LON_LAT]:O,[i.SPHERICAL_ECEF]:m,[i.SPHERICAL_MARS_PCPF]:null,[i.SPHERICAL_MOON_PCPF]:null,[i.UNKNOWN]:null,[i.WEB_MERCATOR]:I,[i.PLATE_CARREE]:function(e,t,r,i){O(e,t,r,i),w(r,i,r,i)},[i.WGS84]:O,[i.WGS84_ECEF]:L},[i.SPHERICAL_MARS_PCPF]:{[i.CGCS2000]:null,[i.GCSMARS2000]:P,[i.GCSMOON2000]:null,[i.LON_LAT]:P,[i.SPHERICAL_ECEF]:null,[i.SPHERICAL_MARS_PCPF]:m,[i.SPHERICAL_MOON_PCPF]:null,[i.UNKNOWN]:null,[i.WEB_MERCATOR]:null,[i.PLATE_CARREE]:null,[i.WGS84]:null,[i.WGS84_ECEF]:null},[i.SPHERICAL_MOON_PCPF]:{[i.CGCS2000]:null,[i.GCSMARS2000]:null,[i.GCSMOON2000]:R,[i.LON_LAT]:R,[i.SPHERICAL_ECEF]:null,[i.SPHERICAL_MARS_PCPF]:null,[i.SPHERICAL_MOON_PCPF]:m,[i.UNKNOWN]:null,[i.WEB_MERCATOR]:null,[i.PLATE_CARREE]:null,[i.WGS84]:null,[i.WGS84_ECEF]:null},[i.UNKNOWN]:{[i.CGCS2000]:null,[i.GCSMARS2000]:null,[i.GCSMOON2000]:null,[i.LON_LAT]:null,[i.SPHERICAL_ECEF]:null,[i.SPHERICAL_MARS_PCPF]:null,[i.SPHERICAL_MOON_PCPF]:null,[i.UNKNOWN]:m,[i.WEB_MERCATOR]:null,[i.PLATE_CARREE]:null,[i.WGS84]:null,[i.WGS84_ECEF]:null},[i.LON_LAT]:{[i.CGCS2000]:m,[i.GCSMARS2000]:m,[i.GCSMOON2000]:m,[i.LON_LAT]:m,[i.SPHERICAL_ECEF]:C,[i.SPHERICAL_MARS_PCPF]:A,[i.SPHERICAL_MOON_PCPF]:M,[i.UNKNOWN]:null,[i.WEB_MERCATOR]:b,[i.PLATE_CARREE]:w,[i.WGS84]:m,[i.WGS84_ECEF]:N},[i.PLATE_CARREE]:{[i.CGCS2000]:x,[i.GCSMARS2000]:null,[i.GCSMOON2000]:null,[i.LON_LAT]:x,[i.SPHERICAL_ECEF]:function(e,t,r,i){x(e,t,r,i),C(r,i,r,i)},[i.SPHERICAL_MARS_PCPF]:null,[i.SPHERICAL_MOON_PCPF]:null,[i.UNKNOWN]:null,[i.WEB_MERCATOR]:function(e,t,r,i){x(e,t,r,i),b(r,i,r,i)},[i.PLATE_CARREE]:m,[i.WGS84]:x,[i.WGS84_ECEF]:function(e,t,r,i){x(e,t,r,i),N(r,i,r,i)}}};function d(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U();return null==e||null==t?null:z(e,t,r).projector}function p(e,t){switch(d(e,t,j)){case m:return"copy3";case C:return"wgs84ToSphericalECEF";case b:return"wgs84ToWebMercator";case w:return"wgs84ToPlateCarree";case N:return"wgs84ToWGS84ECEF";case g:return"webMercatorToWGS84";case y:return"webMercatorToSphericalECEF";case _:return"webMercatorToWGS84ECEF";case S:return"webMercatorToPlateCarree";case D:return"wgs84ECEFToWGS84";case F:return"wgs84ECEFToSphericalECEF";case k:return"wgs84ECEFToWebMercator";case O:return"sphericalECEFToWGS84";case I:return"sphericalECEFToWebMercator";case P:return"sphericalMarsPCPFToMars2000";case R:return"sphericalMoonPCPFToMoon2000";case L:return"sphericalECEFToWGS84ECEF";case A:return"mars2000ToSphericalPCPF";case M:return"moon2000ToSphericalPCPF";default:return null}}function f(e,t){return e?t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=(0,s.GA)(e,1)),(0,o.jA)(e)?t.spatialReferenceId=i.SPHERICAL_ECEF:(0,c.oT)(e)?t.spatialReferenceId=i.WGS84:(0,c.K8)(e)?t.spatialReferenceId=i.WEB_MERCATOR:(0,c.r1)(e)?t.spatialReferenceId=i.PLATE_CARREE:e.wkt===o.Ro.wkt?t.spatialReferenceId=i.WGS84_ECEF:e.wkid===u.Y.CGCS2000?t.spatialReferenceId=i.CGCS2000:e.wkt===o.FY.wkt?t.spatialReferenceId=i.SPHERICAL_MARS_PCPF:e.wkt===o.LJ.wkt?t.spatialReferenceId=i.SPHERICAL_MOON_PCPF:(0,c.q8)(e)?t.spatialReferenceId=i.GCSMARS2000:(0,c.KQ)(e)?t.spatialReferenceId=i.GCSMOON2000:t.spatialReferenceId=i.UNKNOWN):i.UNKNOWN}function m(e,t,r,i){e!==r&&(r[i++]=e[t++],r[i++]=e[t++],r[i]=e[t])}function g(e,t,r,i){r[i]=G*(e[t]/q),r[i+1]=G*($-2*Math.atan(Math.exp(-e[t+1]/q))),r[i+2]=e[t+2]}function y(e,t,r,i){const n=e[t]/q,s=$-2*Math.atan(Math.exp(-e[t+1]/q)),o=q+e[t+2],a=Math.cos(s)*o;r[i]=Math.cos(n)*a,r[i+1]=Math.sin(n)*a,r[i+2]=Math.sin(s)*o}function _(e,t,r,i){g(e,t,r,i),N(r,i,r,i)}function v(e,t,r,i,s){const o=.4999999*Z,a=(0,n.qE)(H*e[t+1],-o,o),l=Math.sin(a);r[i++]=H*e[t]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+l)/(1-l)),r[i]=e[t+2]}function b(e,t,r,i){v(e,t,r,i,a.$O)}function w(e,t,r,i){r[i]=e[t]*W,r[i+1]=e[t+1]*W,r[i+2]=e[t+2]}function x(e,t,r,i){r[i]=e[t]*Y,r[i+1]=e[t+1]*Y,r[i+2]=e[t+2]}function S(e,t,r,i){g(e,t,r,i),w(r,i,r,i)}function T(e,t,r,i,n){const s=n+e[t+2],o=H*e[t+1],a=H*e[t],l=Math.cos(o)*s;r[i]=Math.cos(a)*l,r[i+1]=Math.sin(a)*l,r[i+2]=Math.sin(o)*s}function M(e,t,r,i){T(e,t,r,i,a.Sw.radius)}function A(e,t,r,i){T(e,t,r,i,a.sH.radius)}function C(e,t,r,i){T(e,t,r,i,a.$O.radius)}function E(e,t,r,i,s){const o=e[t],a=e[t+1],l=e[t+2],c=Math.sqrt(o*o+a*a+l*l),u=(0,n.YN)(l/(0===c?1:c)),h=Math.atan2(a,o);r[i++]=G*h,r[i++]=G*u,r[i]=c-s}function R(e,t,r,i){E(e,t,r,i,a.Sw.radius)}function P(e,t,r,i){E(e,t,r,i,a.sH.radius)}function O(e,t,r,i){E(e,t,r,i,a.$O.radius)}function I(e,t,r,i){O(e,t,r,i),b(r,i,r,i)}function L(e,t,r,i){O(e,t,r,i),N(r,i,r,i)}function N(e,t,r,i){!function(e,t,r,i,n){const s=H*e[t],o=H*e[t+1],a=e[t+2],l=Math.sin(o),c=Math.cos(o),u=n.radius/Math.sqrt(1-n.eccentricitySquared*l*l);r[i++]=(u+a)*c*Math.cos(s),r[i++]=(u+a)*c*Math.sin(s),r[i++]=(u*(1-n.eccentricitySquared)+a)*l}(e,t,r,i,a.$O)}function D(e,t,r,i){const n=l.TP,s=e[t],o=e[t+1],c=e[t+2];let u,h,d,p,f,m,g,y,_,v,b,w,x,S,T,M,A,C,E,R,P;u=Math.abs(c),h=s*s+o*o,d=Math.sqrt(h),p=h+c*c,f=Math.sqrt(p),R=Math.atan2(o,s),m=c*c/p,g=h/p,S=n.a2/f,T=n.a3-n.a4/f,g>.3?(y=u/f*(1+g*(n.a1+S+m*T)/f),E=Math.asin(y),v=y*y,_=Math.sqrt(1-v)):(_=d/f*(1-m*(n.a5-S-g*T)/f),E=Math.acos(_),v=1-_*_,y=Math.sqrt(v)),b=1-a.$O.eccentricitySquared*v,w=a.$O.radius/Math.sqrt(b),x=n.a6*w,S=d-w*_,T=u-x*y,A=_*S+y*T,M=_*T-y*S,C=M/(x/b+A),E+=C,P=A+M*C/2,c<0&&(E=-E),r[i++]=G*R,r[i++]=G*E,r[i]=P}function F(e,t,r,i){D(e,t,r,i),C(r,i,r,i)}function k(e,t,r,i){D(e,t,r,i),b(r,i,r,i)}function z(e,t,r){if(null==e||null==t||r.source.spatialReference===e&&r.dest.spatialReference===t)return r;const n=f(e,r.source),s=f(t,r.dest);return n===i.UNKNOWN&&s===i.UNKNOWN?(0,c.aI)(e,t)?r.projector=m:r.projector=null:r.projector=h[n][s],r}function U(){return{source:{spatialReference:null,spatialReferenceId:i.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:i.UNKNOWN,metersPerUnit:1},projector:m}}const V={spatialReference:null,spatialReferenceId:i.UNKNOWN},B={spatialReference:null,spatialReferenceId:i.UNKNOWN},j=U(),H=(0,n.kU)(1),G=(0,n.KJ)(1),Z=Math.PI,$=.5*Z,q=a.$O.radius,W=q*Z/180,Y=180/(q*Z)},98510:(e,t,r)=>{"use strict";r.d(t,{AI:()=>a,WR:()=>l,Y0:()=>c,lO:()=>u});var i=r(34111),n=r(13312),s=r(80963);const o=new n.A(i.fv),a=new n.A(i.FY),l=new n.A(i.LJ),c=new n.A(i.Ro);function u(e){const t=h.get(e);if(t)return t;let r=o;if(e)if(e===a)r=a;else if(e===l)r=l;else{const t=e.wkid,i=e.latestWkid;if(null!=t||null!=i)(0,s.tl)(t)||(0,s.tl)(i)?r=a:((0,s.ZL)(t)||(0,s.ZL)(i))&&(r=l);else{const t=e.wkt2??e.wkt;if(t){const e=t.toUpperCase();e===d?r=a:e===p&&(r=l)}}}return h.set(e,r),r}const h=new Map,d=a.wkt.toUpperCase(),p=l.wkt.toUpperCase()},5568:(e,t,r)=>{"use strict";var i;r.d(t,{_:()=>i}),function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(i||(i={}))},44815:(e,t,r)=>{"use strict";r.d(t,{Ns:()=>l,jh:()=>n,l5:()=>o,s:()=>a,xm:()=>s});var i=r(78393);function n(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e<=i.y9?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function s(e){return((0,i.cy)(e)?e.length:e.byteLength/8)<=i.y9?Array.from(e):new Float64Array(e)}function o(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)}function a(e,t){for(let r=0;r<t.length;++r)e[r]=t[r];return e}function l(e){return Array.isArray(e)?new Float64Array(e):e}},14556:(e,t,r)=>{"use strict";r.d(t,{$O:()=>n,Sw:()=>o,sH:()=>s});class i{constructor(e,t,r,i){this.semiMajorAxis=e,this.flattening=t,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=i||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const n=new i(6378137,1/298.257223563,3e5,.006694379990137799),s=new i(3396190,1/169.8944472236118,23e4),o=new i(1737400,0,0)},75002:(e,t,r)=>{"use strict";r.d(t,{AK:()=>a,Wz:()=>o,oe:()=>n,p_:()=>s});var i=r(78393);function n(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e<=i.y9?t?new Array(e).fill(0):new Array(e):new Float32Array(e)}function s(e){return(0,i.cy)(e)?e.length<i.y9?e:new Float32Array(e):e.length<i.y9?Array.from(e):e}function o(e){return((0,i.cy)(e)?e.length:e.byteLength/8)<=i.y9?Array.from(e):new Float32Array(e)}function a(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)}},64681:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let i=0;class n{static fromGE(e){const t=new n;return t._wkt=e.wkt,t._wkid=e.wkid,t._isInverse=e.isInverse,t}constructor(e){this.uid=i++,e?(this._wkt=null!=e.wkt?e.wkt:null,this._wkid=null!=e.wkid?e.wkid:-1,this._isInverse=null!=e.isInverse&&!0===e.isInverse):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=i++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=i++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=i++}getInverse(){const e=new n;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}}class s{static cacheKey(e,t){return[e.wkid?.toString()??"-1",e.wkt?.toString()??"",e.wkt2?.toString()??"",t.wkid?.toString()??"-1",t.wkt?.toString()??"",t.wkt2?.toString()??""].join()}static fromGE(e){const t=new s;let r="";for(const i of e.steps){const e=n.fromGE(i);t.steps.push(e),r+=e.uid.toString()+","}return t._cachedProjection={},t._gtlistentry=null,t._chain=r,t}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e?.steps)for(const t of e.steps)t instanceof n?this.steps.push(t):this.steps.push(new n({wkid:t.wkid,wkt:t.wkt,isInverse:t.isInverse}))}getInverse(){const e=new s;e.steps=[];for(let t=this.steps.length-1;t>=0;t--){const r=this.steps[t];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const t of this.steps)e+=t.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,t,r){this._cachedProjection[s.cacheKey(e,t)]=r}getCachedGeTransformation(e,t){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const i=this._cachedProjection[s.cacheKey(e,t)];return void 0===i?null:i}}},38496:(e,t,r)=>{"use strict";r.d(t,{Dg:()=>n,EH:()=>d,JH:()=>o,my:()=>s,tM:()=>u});var i=r(78393);function n(e){if((0,i.cy)(e)){if(e.length<i.y9)return e}else if(e.length<i.y9)return Array.from(e);let t=!0,r=!0;return e.some(((e,i)=>(t=t&&0===e,r=r&&e===i,!t&&!r))),t?d(e.length):r?u(e.length):(0,i.cy)(e)||e.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?function(e){let t=!0;for(const r of e){if(r>=65536)return(0,i.cy)(e)?new Uint32Array(e):e;r>=256&&(t=!1)}return t?new Uint8Array(e):new Uint16Array(e)}(e):e}function s(e){return e<=i.y9?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)}function o(e){return e<=i.y9?new Array(e):new Uint32Array(e)}let a=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const l=[0],c=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function u(e){if(1===e)return l;if(e<i.y9)return Array.from(new Uint16Array(c.buffer,0,e));if(e<c.length)return new Uint16Array(c.buffer,0,e);if(e>a.length){const t=Math.max(2*a.length,e);a=new Uint32Array(t);for(let e=0;e<a.length;e++)a[e]=e}return new Uint32Array(a.buffer,0,e)}let h=new Uint8Array(65536);function d(e){if(1===e)return l;if(e<i.y9)return new Array(e).fill(0);if(e>h.length){const t=Math.max(2*h.length,e);h=new Uint8Array(t)}return new Uint8Array(h.buffer,0,e)}},79629:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var i,n=r(35143),s=r(42553),o=r(53084),a=r(76460),l=r(46053),c=r(21403),u=r(85842),h=r(40565),d=r(33905),p=r(44032),f=r(56623);let m=i=class extends s.oY{static from(e){return(0,h.PZ)(i,e)}constructor(e){super(e),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(e){return(0,f.b)(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},a.A.getLogger(this))}castMaterial(e){return(0,h.PZ)(e&&"object"==typeof e&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?p.A:d.A,e)}clone(){return new i({faces:(0,o.o8)(this.faces),shading:this.shading,material:(0,o.o8)(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(e,t){const r={faces:(0,o.o8)(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new i(r)}get memoryUsage(){let e=0;return null!=this.faces&&(e+=this.faces.byteLength),null!=this.material&&(e+=this.material.memoryUsage),e}};(0,n._)([(0,l.MZ)({json:{write:!0}})],m.prototype,"faces",void 0),(0,n._)([(0,c.w)("faces")],m.prototype,"castFaces",null),(0,n._)([(0,l.MZ)({type:d.A,json:{write:!0}})],m.prototype,"material",void 0),(0,n._)([(0,c.w)("material")],m.prototype,"castMaterial",null),(0,n._)([(0,l.MZ)()],m.prototype,"name",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],m.prototype,"shading",void 0),(0,n._)([(0,l.MZ)({type:Boolean})],m.prototype,"trustSourceNormals",void 0),m=i=(0,n._)([(0,u.$)("esri.geometry.support.MeshComponent")],m);const g=m},14894:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i=r(35143),n=r(69098),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(6409)),l=r(85842);let c=class extends((0,n.O)(s.oY)){constructor(e){super(e),this.type="georeferenced",this.origin=null}};(0,i._)([(0,a.e)({georeferenced:"georeferenced"},{readOnly:!0})],c.prototype,"type",void 0),(0,i._)([(0,o.MZ)({type:[Number],nonNullable:!1,json:{write:!0}})],c.prototype,"origin",void 0),c=(0,i._)([(0,l.$)("esri.geometry.support.MeshGeoreferencedVertexSpace")],c);const u=c},5845:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var i=r(35143),n=r(69098),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(6409)),l=r(85842),c=r(9392);let u=class extends((0,n.O)(s.oY)){constructor(e){super(e),this.type="local",this.origin=(0,c.vt)()}};(0,i._)([(0,a.e)({local:"local"},{readOnly:!0})],u.prototype,"type",void 0),(0,i._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],u.prototype,"origin",void 0),u=(0,i._)([(0,l.$)("esri.geometry.support.MeshLocalVertexSpace")],u);const h=u},33905:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i,n=r(35143),s=r(69539),o=r(42553),a=r(46053),l=(r(81806),r(76460),r(47249),r(85842)),c=r(75257),u=r(63713);let h=i=class extends o.oY{constructor(e){super(e),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=null!=e?e.get(this):null;if(r)return r;const n=new i(this.clonePropertiesWithDeduplication(t));return null!=e&&e.set(this,n),n}clonePropertiesWithDeduplication(e){return{color:null!=this.color?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(e),normalTexture:this.normalTexture?.cloneWithDeduplication(e),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let e=0;return e+=null!=this.color?16:0,null!=this.colorTexture&&(e+=this.colorTexture.memoryUsage),e+=null!=this.colorTextureTransform?20:0,null!=this.normalTexture&&(e+=this.normalTexture.memoryUsage),e+=null!=this.normalTextureTransform?20:0,e}};(0,n._)([(0,a.MZ)({type:s.A,json:{write:!0}})],h.prototype,"color",void 0),(0,n._)([(0,a.MZ)({type:c.A,json:{write:!0}})],h.prototype,"colorTexture",void 0),(0,n._)([(0,a.MZ)({type:u.A,json:{write:!0}})],h.prototype,"colorTextureTransform",void 0),(0,n._)([(0,a.MZ)({type:c.A,json:{write:!0}})],h.prototype,"normalTexture",void 0),(0,n._)([(0,a.MZ)({type:u.A,json:{write:!0}})],h.prototype,"normalTextureTransform",void 0),(0,n._)([(0,a.MZ)({nonNullable:!0,json:{write:!0}})],h.prototype,"alphaMode",void 0),(0,n._)([(0,a.MZ)({nonNullable:!0,json:{write:!0}})],h.prototype,"alphaCutoff",void 0),(0,n._)([(0,a.MZ)({nonNullable:!0,json:{write:!0}})],h.prototype,"doubleSided",void 0),h=i=(0,n._)([(0,l.$)("esri.geometry.support.MeshMaterial")],h);const d=h},44032:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i,n=r(35143),s=r(69539),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842)),l=r(33905),c=r(75257),u=r(63713);let h=i=class extends l.A{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=null!=e?e.get(this):null;if(r)return r;const n=new i(this.clonePropertiesWithDeduplication(t));return null!=e&&e.set(this,n),n}getMemoryUsage(){let e=super.getMemoryUsage();return e+=null!=this.emissiveColor?16:0,null!=this.emissiveTexture&&(e+=this.emissiveTexture.memoryUsage),e+=null!=this.emissiveTextureTransform?20:0,null!=this.occlusionTexture&&(e+=this.occlusionTexture.memoryUsage),e+=null!=this.occlusionTextureTransform?20:0,null!=this.metallicRoughnessTexture&&(e+=this.metallicRoughnessTexture.memoryUsage),e+=null!=this.metallicRoughnessTextureTransform?20:0,e}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(e),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(e),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(e),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};(0,n._)([(0,o.MZ)({type:s.A,json:{write:!0}})],h.prototype,"emissiveColor",void 0),(0,n._)([(0,o.MZ)({type:c.A,json:{write:!0}})],h.prototype,"emissiveTexture",void 0),(0,n._)([(0,o.MZ)({type:u.A,json:{write:!0}})],h.prototype,"emissiveTextureTransform",void 0),(0,n._)([(0,o.MZ)({type:c.A,json:{write:!0}})],h.prototype,"occlusionTexture",void 0),(0,n._)([(0,o.MZ)({type:u.A,json:{write:!0}})],h.prototype,"occlusionTextureTransform",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],h.prototype,"metallic",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],h.prototype,"roughness",void 0),(0,n._)([(0,o.MZ)({type:c.A,json:{write:!0}})],h.prototype,"metallicRoughnessTexture",void 0),(0,n._)([(0,o.MZ)({type:u.A,json:{write:!0}})],h.prototype,"metallicRoughnessTextureTransform",void 0),h=i=(0,n._)([(0,a.$)("esri.geometry.support.MeshMaterialMetallicRoughness")],h);const d=h},75257:(e,t,r)=>{"use strict";r.d(t,{A:()=>v});var i,n=r(35143),s=(r(81806),r(16770)),o=r(42553),a=r(46053),l=r(40565),c=(r(47249),r(28379)),u=r(85842),h=r(17707),d=r(79453);const p=new WeakMap;let f=0,m=i=class extends o.oY{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,r,i){if(e instanceof HTMLImageElement){const n={type:"image-element",src:(0,d.t)(e.src,i),crossOrigin:e.crossOrigin};t[r]=n}else if(e instanceof HTMLCanvasElement){const i={type:"canvas-element",imageData:g(e.getContext("2d").getImageData(0,0,e.width,e.height))};t[r]=i}else if(e instanceof HTMLVideoElement){const n={type:"video-element",src:(0,d.t)(e.src,i),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=n}else if(e instanceof ImageData){const i={type:"image-data",imageData:g(e)};t[r]=i}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=y(e.imageData),r=document.createElement("canvas");return r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(t,0,0),r}case"image-data":return y(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return _(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return _(e);if(t){const e=t.substr(t.length-4,4).toLowerCase(),r=t.substr(0,15).toLocaleLowerCase();if(".png"===e||"data:image/png;"===r)return!0}return!1}set transparent(e){this._overrideIfSome("transparent",e)}get contentHash(){var e=this;const t="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",r=function(){return`d:${arguments.length>0&&void 0!==arguments[0]?arguments[0]:""},t:${e.transparent},w:${t}`};return null!=this.url?r(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?r(this.data.src):(p.has(this.data)||p.set(this.data,++f),r(p.get(this.data))):r()}get memoryUsage(){let e=0;if(e+=null!=this.url?this.url.length:0,null!=this.data){const t=this.data;"data"in t?e+=t.data.byteLength:t instanceof HTMLImageElement?e+=t.naturalWidth*t.naturalHeight*3:t instanceof HTMLCanvasElement&&(e+=t.width*t.height*3)}return e}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new i(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const r=this.clone();return e.set(this,r),r}_cloneWrap(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}static from(e){return"string"==typeof e?new i({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new i({data:e}):(0,l.PZ)(i,e)}};function g(e){let t="";for(let r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}function y(e){const t=atob(e.data),r=new Uint8ClampedArray(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return(0,s.eV)(r,e.width,e.height)}function _(e){for(let t=3;t<e.data.length;t+=4)if(255!==e.data[t])return!0;return!1}(0,n._)([(0,a.MZ)({type:String,json:{write:d.w}})],m.prototype,"url",null),(0,n._)([(0,a.MZ)({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),(0,a.MZ)()],m.prototype,"data",null),(0,n._)([(0,h.K)("data")],m.prototype,"writeData",null),(0,n._)([(0,c.w)("data")],m.prototype,"readData",null),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],m.prototype,"transparent",null),(0,n._)([(0,a.MZ)({json:{write:!0}})],m.prototype,"wrap",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],m.prototype,"contentHash",null),m=i=(0,n._)([(0,u.$)("esri.geometry.support.MeshTexture")],m);const v=m},63713:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i=r(35143),n=r(69098),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842));let l=class extends((0,n.O)(s.oY)){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};(0,i._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],l.prototype,"offset",void 0),(0,i._)([(0,o.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],l.prototype,"rotation",void 0),(0,i._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],l.prototype,"scale",void 0),l=(0,i._)([(0,a.$)("esri.geometry.support.MeshTextureTransform")],l);const c=l},56623:(e,t,r)=>{"use strict";r.d(t,{H:()=>h,b:()=>p});var i,n=r(35143),s=r(42553),o=r(53084),a=r(76460),l=r(46053),c=r(21403),u=r(85842);let h=i=class extends s.oY{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return p(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},a.A.getLogger(this))}castPosition(e){return e&&e instanceof Float32Array&&a.A.getLogger(this).warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),p(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},a.A.getLogger(this))}castUv(e){return p(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},a.A.getLogger(this))}castNormal(e){return p(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},a.A.getLogger(this))}castTangent(e){return p(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},a.A.getLogger(this))}clone(){const e={position:(0,o.o8)(this.position),uv:(0,o.o8)(this.uv),normal:(0,o.o8)(this.normal),tangent:(0,o.o8)(this.tangent),color:(0,o.o8)(this.color)};return new i(e)}clonePositional(){const e={position:(0,o.o8)(this.position),normal:(0,o.o8)(this.normal),tangent:(0,o.o8)(this.tangent),uv:this.uv,color:this.color};return new i(e)}get memoryUsage(){let e=0;return e+=this.position.byteLength,null!=this.uv&&(e+=this.uv.byteLength),null!=this.normal&&(e+=this.normal.byteLength),null!=this.tangent&&(e+=this.tangent.byteLength),null!=this.color&&(e+=this.color.byteLength),e}};function d(e,t,r,i){const{loggerTag:n,stride:s}=t;return e.length%s!=0?(i.error(n,`Invalid array length, expected a multiple of ${s}`),new r([])):e}function p(e,t,r,i,n){if(!e)return e;if(e instanceof t)return d(e,i,t,n);for(const s of r)if(e instanceof s)return d(new t(e),i,t,n);if(Array.isArray(e))return d(new t(e),i,t,n);{const i=r.map((e=>`'${e.name}'`));return n.error(`Failed to set property, expected one of ${i}, but got ${e.constructor.name}`),new t([])}}function f(e,t,r){t[r]=function(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}(e)}(0,n._)([(0,l.MZ)({json:{write:f}})],h.prototype,"color",void 0),(0,n._)([(0,c.w)("color")],h.prototype,"castColor",null),(0,n._)([(0,l.MZ)({nonNullable:!0,json:{write:f}})],h.prototype,"position",void 0),(0,n._)([(0,c.w)("position")],h.prototype,"castPosition",null),(0,n._)([(0,l.MZ)({json:{write:f}})],h.prototype,"uv",void 0),(0,n._)([(0,c.w)("uv")],h.prototype,"castUv",null),(0,n._)([(0,l.MZ)({json:{write:f}})],h.prototype,"normal",void 0),(0,n._)([(0,c.w)("normal")],h.prototype,"castNormal",null),(0,n._)([(0,l.MZ)({json:{write:f}})],h.prototype,"tangent",void 0),(0,n._)([(0,c.w)("tangent")],h.prototype,"castTangent",null),h=i=(0,n._)([(0,u.$)("esri.geometry.support.MeshVertexAttributes")],h)},34038:(e,t,r)=>{"use strict";var i;r.d(t,{Y:()=>i}),function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"}(i||(i={}))},62032:(e,t,r)=>{"use strict";r.d(t,{O3:()=>a,Ox:()=>l,bR:()=>s,dC:()=>i});var i,n;!function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon"}(i||(i={}));class s{constructor(e,t){this.x=e,this.y=t}clone(){return new s(this.x,this.y)}equals(e,t){return e===this.x&&t===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,t){return this.x=e,this.y=t,this}normalize(){const e=this.x,t=this.y,r=Math.sqrt(e*e+t*t);return this.x/=r,this.y/=r,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,t){return this.x+=e,this.y+=t,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}assignSub(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}rotate(e,t){const r=this.x,i=this.y;return this.x=r*e-i*t,this.y=r*t+i*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,t){const r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}static add(e,t){return new s(e.x+t.x,e.y+t.y)}static sub(e,t){return new s(e.x-t.x,e.y-t.y)}}class o{constructor(e,t,r){this.ratio=e,this.x=t,this.y=r}}class a{constructor(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=i,this._pixelMargin=n,this._tileSize=512*i,this._dz=e,this._yPos=t,this._xPos=r}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let t=this._pixelRatio*this._pixelMargin;t/=this._finalRatio;const r=e>>this._dz;t>r&&(t=r),this._margin=t,this._xmin=r*this._xPos-t,this._ymin=r*this._yPos-t,this._xmax=this._xmin+r+2*t,this._ymax=this._ymin+r+2*t}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,t){this._pushLine(),this._prevIsIn=this._isIn(e,t),this._moveTo(e,t,this._prevIsIn),this._prevPt=new s(e,t),this._firstPt=new s(e,t),this._dist=0}lineTo(e,t){const r=this._isIn(e,t),i=new s(e,t),n=s.distance(this._prevPt,i);let a,l,c,u,h,d,p,f;if(r)this._prevIsIn?this._lineTo(e,t,!0):(a=this._prevPt,l=i,c=this._intersect(l,a),this._start=this._dist+n*(1-this._r),this._lineTo(c.x,c.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,a=i,c=this._intersect(l,a),this._lineTo(c.x,c.y,!0),this._lineTo(a.x,a.y,!1);else{const e=this._prevPt,t=i;if(e.x<=this._xmin&&t.x<=this._xmin||e.x>=this._xmax&&t.x>=this._xmax||e.y<=this._ymin&&t.y<=this._ymin||e.y>=this._ymax&&t.y>=this._ymax)this._lineTo(t.x,t.y,!1);else{const r=[];if((e.x<this._xmin&&t.x>this._xmin||e.x>this._xmin&&t.x<this._xmin)&&(u=(this._xmin-e.x)/(t.x-e.x),f=e.y+u*(t.y-e.y),f<=this._ymin?d=!1:f>=this._ymax?d=!0:r.push(new o(u,this._xmin,f))),(e.x<this._xmax&&t.x>this._xmax||e.x>this._xmax&&t.x<this._xmax)&&(u=(this._xmax-e.x)/(t.x-e.x),f=e.y+u*(t.y-e.y),f<=this._ymin?d=!1:f>=this._ymax?d=!0:r.push(new o(u,this._xmax,f))),(e.y<this._ymin&&t.y>this._ymin||e.y>this._ymin&&t.y<this._ymin)&&(u=(this._ymin-e.y)/(t.y-e.y),p=e.x+u*(t.x-e.x),p<=this._xmin?h=!1:p>=this._xmax?h=!0:r.push(new o(u,p,this._ymin))),(e.y<this._ymax&&t.y>this._ymax||e.y>this._ymax&&t.y<this._ymax)&&(u=(this._ymax-e.y)/(t.y-e.y),p=e.x+u*(t.x-e.x),p<=this._xmin?h=!1:p>=this._xmax?h=!0:r.push(new o(u,p,this._ymax))),0===r.length)h?d?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):d?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(r.length>1&&r[0].ratio>r[1].ratio)this._start=this._dist+n*r[1].ratio,this._lineTo(r[1].x,r[1].y,!0),this._lineTo(r[0].x,r[0].y,!0);else{this._start=this._dist+n*r[0].ratio;for(let e=0;e<r.length;e++)this._lineTo(r[e].x,r[e].y,!0)}this._lineTo(t.x,t.y,!1)}}this._dist+=n,this._prevIsIn=r,this._prevPt=i}close(){if(this._line.length>2){const e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);const r=this._line;let i=r.length;for(;i>=4&&(r[0].x===r[1].x&&r[0].x===r[i-2].x||r[0].y===r[1].y&&r[0].y===r[i-2].y);)r.pop(),r[0].x=r[i-2].x,r[0].y=r[i-2].y,--i}}result(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._pushLine(),0===this._lines.length?null:(this._type===i.Polygon&&e&&c.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==i.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,t=e.length;if(0===t)return null;const r=[];for(let i=0;i<t;i++)r.push({line:e[i],start:this._starts[i]||0});return r}_isIn(e,t){return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}_intersect(e,t){let r,i,n;if(t.x>=this._xmin&&t.x<=this._xmax)i=t.y<=this._ymin?this._ymin:this._ymax,n=(i-e.y)/(t.y-e.y),r=e.x+n*(t.x-e.x);else if(t.y>=this._ymin&&t.y<=this._ymax)r=t.x<=this._xmin?this._xmin:this._xmax,n=(r-e.x)/(t.x-e.x),i=e.y+n*(t.y-e.y);else{i=t.y<=this._ymin?this._ymin:this._ymax,r=t.x<=this._xmin?this._xmin:this._xmax;const s=(r-e.x)/(t.x-e.x),o=(i-e.y)/(t.y-e.y);s<o?(n=s,i=e.y+s*(t.y-e.y)):(n=o,r=e.x+o*(t.x-e.x))}return this._r=n,new s(r,i)}_pushLine(){this._line&&(this._type===i.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===i.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===i.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,t,r){this._type!==i.Polygon?r&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new s(e,t))):(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new s(e,t)),this._isH=!1,this._isV=!1)}_lineTo(e,t,r){let n,o;if(this._type!==i.Polygon)if(r){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(n=this._line[this._line.length-1],n.equals(e,t)))return;this._line.push(new s(e,t))}else this._line&&this._line.length>0&&this._pushLine();else if(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){n=this._line[this._line.length-1];const r=n.x===e,i=n.y===t;if(r&&i)return;this._isH&&r||this._isV&&i?(n.x=e,n.y=t,o=this._line[this._line.length-2],o.x===e&&o.y===t?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(o=this._line[this._line.length-2],this._isH=o.x===e,this._isV=o.y===t)):(this._isH=o.x===e,this._isV=o.y===t)):(this._line.push(new s(e,t)),this._isH=r,this._isV=i)}else this._line.push(new s(e,t))}}class l{setExtent(e){this._ratio=4096===e?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,t){this._line&&this._lines.push(this._line),this._line=[];const r=this._ratio;this._line.push(new s(e*r,t*r))}lineTo(e,t){const r=this._ratio;this._line.push(new s(e*r,t*r))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}}!function(e){e[e.sideLeft=0]="sideLeft",e[e.sideRight=1]="sideRight",e[e.sideTop=2]="sideTop",e[e.sideBottom=3]="sideBottom"}(n||(n={}));class c{static simplify(e,t,r){if(!r)return;const i=-t,s=e+t,o=-t,a=e+t,l=[],u=[],h=r.length;for(let c=0;c<h;++c){const e=r[c];if(!e||e.length<2)continue;let t,h=e[0];const d=e.length;for(let r=1;r<d;++r)t=e[r],h.x===t.x&&(h.x<=i&&(h.y>t.y?(l.push(c),l.push(r),l.push(n.sideLeft),l.push(-1)):(u.push(c),u.push(r),u.push(n.sideLeft),u.push(-1))),h.x>=s&&(h.y<t.y?(l.push(c),l.push(r),l.push(n.sideRight),l.push(-1)):(u.push(c),u.push(r),u.push(n.sideRight),u.push(-1)))),h.y===t.y&&(h.y<=o&&(h.x<t.x?(l.push(c),l.push(r),l.push(n.sideTop),l.push(-1)):(u.push(c),u.push(r),u.push(n.sideTop),u.push(-1))),h.y>=a&&(h.x>t.x?(l.push(c),l.push(r),l.push(n.sideBottom),l.push(-1)):(u.push(c),u.push(r),u.push(n.sideBottom),u.push(-1)))),h=t}if(0===l.length||0===u.length)return;c.fillParent(r,u,l),c.fillParent(r,l,u);const d=[];c.calcDeltas(d,u,l),c.calcDeltas(d,l,u),c.addDeltas(d,r)}static fillParent(e,t,r){const i=r.length,s=t.length;for(let o=0;o<s;o+=4){const s=t[o],a=t[o+1],l=t[o+2],c=e[s][a-1],h=e[s][a];let d=8092,p=-1;for(let t=0;t<i;t+=4){if(r[t+2]!==l)continue;const i=r[t],s=r[t+1],o=e[i][s-1],a=e[i][s];switch(l){case n.sideLeft:case n.sideRight:if(u(c.y,o.y,a.y)&&u(h.y,o.y,a.y)){const e=Math.abs(a.y-o.y);e<d&&(d=e,p=t)}break;case n.sideTop:case n.sideBottom:if(u(c.x,o.x,a.x)&&u(h.x,o.x,a.x)){const e=Math.abs(a.x-o.x);e<d&&(d=e,p=t)}}}t[o+3]=p}}static calcDeltas(e,t,r){const i=t.length;for(let n=0;n<i;n+=4){const i=[],s=c.calcDelta(n,t,r,i);e.push(t[n]),e.push(t[n+1]),e.push(t[n+2]),e.push(s)}}static calcDelta(e,t,r,i){const n=t[e+3];if(-1===n)return 0;const s=i.length;return s>1&&i[s-2]===n?0:(i.push(n),c.calcDelta(n,r,t,i)+1)}static addDeltas(e,t){const r=e.length;let i=0;for(let n=0;n<r;n+=4){const t=e[n+3];t>i&&(i=t)}for(let s=0;s<r;s+=4){const r=t[e[s]],o=e[s+1],a=i-e[s+3];switch(e[s+2]){case n.sideLeft:r[o-1].x-=a,r[o].x-=a,1===o&&(r[r.length-1].x-=a),o===r.length-1&&(r[0].x-=a);break;case n.sideRight:r[o-1].x+=a,r[o].x+=a,1===o&&(r[r.length-1].x+=a),o===r.length-1&&(r[0].x+=a);break;case n.sideTop:r[o-1].y-=a,r[o].y-=a,1===o&&(r[r.length-1].y-=a),o===r.length-1&&(r[0].y-=a);break;case n.sideBottom:r[o-1].y+=a,r[o].y+=a,1===o&&(r[r.length-1].y+=a),o===r.length-1&&(r[0].y+=a)}}}}const u=(e,t,r)=>e>=t&&e<=r||e>=r&&e<=t},85996:(e,t,r)=>{"use strict";let i;r.d(t,{A:()=>n});const n={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,10477:0,10481:2,10516:2,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(i=2e3;i<=2045;i++)n[i]=0;for(i=2056;i<=2065;i++)n[i]=0;for(i=2067;i<=2135;i++)n[i]=0;for(i=2137;i<=2154;i++)n[i]=0;for(i=2161;i<=2170;i++)n[i]=0;for(i=2172;i<=2193;i++)n[i]=0;for(i=2195;i<=2198;i++)n[i]=0;for(i=2200;i<=2203;i++)n[i]=0;for(i=2205;i<=2217;i++)n[i]=0;for(i=2222;i<=2224;i++)n[i]=1;for(i=2225;i<=2250;i++)n[i]=2;for(i=2251;i<=2253;i++)n[i]=1;for(i=2257;i<=2264;i++)n[i]=2;for(i=2274;i<=2279;i++)n[i]=2;for(i=2280;i<=2282;i++)n[i]=1;for(i=2283;i<=2289;i++)n[i]=2;for(i=2290;i<=2292;i++)n[i]=0;for(i=2308;i<=2313;i++)n[i]=0;for(i=2315;i<=2491;i++)n[i]=0;for(i=2494;i<=2866;i++)n[i]=0;for(i=2867;i<=2869;i++)n[i]=1;for(i=2870;i<=2888;i++)n[i]=2;for(i=2891;i<=2895;i++)n[i]=2;for(i=2896;i<=2898;i++)n[i]=1;for(i=2902;i<=2908;i++)n[i]=2;for(i=2915;i<=2920;i++)n[i]=2;for(i=2921;i<=2923;i++)n[i]=1;for(i=2924;i<=2930;i++)n[i]=2;for(i=2931;i<=2962;i++)n[i]=0;for(i=2964;i<=2968;i++)n[i]=2;for(i=2969;i<=2973;i++)n[i]=0;for(i=2975;i<=2991;i++)n[i]=0;for(i=2995;i<=3051;i++)n[i]=0;for(i=3054;i<=3079;i++)n[i]=0;for(i=3081;i<=3088;i++)n[i]=0;for(i=3092;i<=3101;i++)n[i]=0;for(i=3106;i<=3138;i++)n[i]=0;for(i=3146;i<=3151;i++)n[i]=0;for(i=3153;i<=3166;i++)n[i]=0;for(i=3168;i<=3172;i++)n[i]=0;for(i=3174;i<=3203;i++)n[i]=0;for(i=3294;i<=3358;i++)n[i]=0;for(i=3367;i<=3403;i++)n[i]=0;for(i=3408;i<=3416;i++)n[i]=0;for(i=3417;i<=3438;i++)n[i]=2;for(i=3441;i<=3446;i++)n[i]=2;for(i=3447;i<=3450;i++)n[i]=0;for(i=3451;i<=3459;i++)n[i]=2;for(i=3460;i<=3478;i++)n[i]=0;for(i=3554;i<=3559;i++)n[i]=0;for(i=3560;i<=3570;i++)n[i]=2;for(i=3571;i<=3581;i++)n[i]=0;for(i=3594;i<=3597;i++)n[i]=0;for(i=3601;i<=3604;i++)n[i]=0;for(i=3637;i<=3639;i++)n[i]=0;for(i=3665;i<=3667;i++)n[i]=0;for(i=3693;i<=3695;i++)n[i]=0;for(i=3701;i<=3727;i++)n[i]=0;for(i=3728;i<=3739;i++)n[i]=2;for(i=3740;i<=3751;i++)n[i]=0;for(i=3753;i<=3760;i++)n[i]=2;for(i=3761;i<=3773;i++)n[i]=0;for(i=3775;i<=3777;i++)n[i]=0;for(i=3779;i<=3781;i++)n[i]=0;for(i=3783;i<=3785;i++)n[i]=0;for(i=3788;i<=3791;i++)n[i]=0;for(i=3797;i<=3802;i++)n[i]=0;for(i=3814;i<=3816;i++)n[i]=0;for(i=3825;i<=3829;i++)n[i]=0;for(i=3832;i<=3841;i++)n[i]=0;for(i=3844;i<=3852;i++)n[i]=0;for(i=3873;i<=3885;i++)n[i]=0;for(i=3890;i<=3893;i++)n[i]=0;for(i=3907;i<=3912;i++)n[i]=0;for(i=3942;i<=3950;i++)n[i]=0;for(i=3968;i<=3970;i++)n[i]=0;for(i=3973;i<=3976;i++)n[i]=0;for(i=3986;i<=3989;i++)n[i]=0;for(i=3994;i<=3997;i++)n[i]=0;for(i=4048;i<=4051;i++)n[i]=0;for(i=4056;i<=4063;i++)n[i]=0;for(i=4093;i<=4096;i++)n[i]=0;for(i=4390;i<=4398;i++)n[i]=0;for(i=4399;i<=4413;i++)n[i]=2;for(i=4418;i<=4433;i++)n[i]=2;for(i=4455;i<=4457;i++)n[i]=2;for(i=4484;i<=4489;i++)n[i]=0;for(i=4491;i<=4554;i++)n[i]=0;for(i=4568;i<=4589;i++)n[i]=0;for(i=4652;i<=4656;i++)n[i]=0;for(i=4766;i<=4800;i++)n[i]=0;for(i=5014;i<=5016;i++)n[i]=0;for(i=5069;i<=5072;i++)n[i]=0;for(i=5105;i<=5130;i++)n[i]=0;for(i=5167;i<=5188;i++)n[i]=0;for(i=5253;i<=5259;i++)n[i]=0;for(i=5269;i<=5275;i++)n[i]=0;for(i=5292;i<=5311;i++)n[i]=0;for(i=5329;i<=5331;i++)n[i]=0;for(i=5343;i<=5349;i++)n[i]=0;for(i=5355;i<=5357;i++)n[i]=0;for(i=5387;i<=5389;i++)n[i]=0;for(i=5459;i<=5463;i++)n[i]=0;for(i=5479;i<=5482;i++)n[i]=0;for(i=5518;i<=5520;i++)n[i]=0;for(i=5530;i<=5539;i++)n[i]=0;for(i=5550;i<=5552;i++)n[i]=0;for(i=5562;i<=5583;i++)n[i]=0;for(i=5623;i<=5625;i++)n[i]=2;for(i=5631;i<=5639;i++)n[i]=0;for(i=5649;i<=5653;i++)n[i]=0;for(i=5663;i<=5680;i++)n[i]=0;for(i=5682;i<=5685;i++)n[i]=0;for(i=5875;i<=5877;i++)n[i]=0;for(i=5896;i<=5899;i++)n[i]=0;for(i=5921;i<=5940;i++)n[i]=0;for(i=6050;i<=6125;i++)n[i]=0;for(i=6244;i<=6275;i++)n[i]=0;for(i=6328;i<=6348;i++)n[i]=0;for(i=6350;i<=6356;i++)n[i]=0;for(i=6366;i<=6372;i++)n[i]=0;for(i=6381;i<=6387;i++)n[i]=0;for(i=6393;i<=6404;i++)n[i]=0;for(i=6480;i<=6483;i++)n[i]=0;for(i=6511;i<=6514;i++)n[i]=0;for(i=6579;i<=6581;i++)n[i]=0;for(i=6619;i<=6624;i++)n[i]=0;for(i=6625;i<=6627;i++)n[i]=2;for(i=6628;i<=6632;i++)n[i]=0;for(i=6634;i<=6637;i++)n[i]=0;for(i=6669;i<=6692;i++)n[i]=0;for(i=6707;i<=6709;i++)n[i]=0;for(i=6720;i<=6723;i++)n[i]=0;for(i=6732;i<=6738;i++)n[i]=0;for(i=6931;i<=6933;i++)n[i]=0;for(i=6956;i<=6959;i++)n[i]=0;for(i=7005;i<=7007;i++)n[i]=0;for(i=7057;i<=7070;i++)n[i]=2;for(i=7074;i<=7082;i++)n[i]=0;for(i=7109;i<=7118;i++)n[i]=0;for(i=7119;i<=7127;i++)n[i]=1;for(i=7374;i<=7376;i++)n[i]=0;for(i=7528;i<=7586;i++)n[i]=0;for(i=7587;i<=7645;i++)n[i]=2;for(i=7692;i<=7696;i++)n[i]=0;for(i=7755;i<=7787;i++)n[i]=0;for(i=7791;i<=7795;i++)n[i]=0;for(i=7799;i<=7801;i++)n[i]=0;for(i=7803;i<=7805;i++)n[i]=0;for(i=7825;i<=7831;i++)n[i]=0;for(i=7845;i<=7859;i++)n[i]=0;for(i=8013;i<=8032;i++)n[i]=0;for(i=8065;i<=8068;i++)n[i]=1;for(i=8518;i<=8529;i++)n[i]=2;for(i=8533;i<=8536;i++)n[i]=2;for(i=8538;i<=8540;i++)n[i]=2;for(i=8677;i<=8679;i++)n[i]=0;for(i=8836;i<=8840;i++)n[i]=0;for(i=8857;i<=8859;i++)n[i]=0;for(i=8908;i<=8910;i++)n[i]=0;for(i=9154;i<=9159;i++)n[i]=0;for(i=9205;i<=9218;i++)n[i]=0;for(i=9271;i<=9273;i++)n[i]=0;for(i=9295;i<=9297;i++)n[i]=0;for(i=9356;i<=9360;i++)n[i]=0;for(i=9404;i<=9407;i++)n[i]=0;for(i=9476;i<=9482;i++)n[i]=0;for(i=9487;i<=9494;i++)n[i]=0;for(i=9697;i<=9699;i++)n[i]=0;for(i=9821;i<=9865;i++)n[i]=0;for(i=10285;i<=10291;i++)n[i]=0;for(i=10314;i<=10317;i++)n[i]=0;for(i=10448;i<=10465;i++)n[i]=0;for(i=10731;i<=10733;i++)n[i]=0;for(i=11114;i<=11118;i++)n[i]=0;for(i=20004;i<=20032;i++)n[i]=0;for(i=20047;i<=20049;i++)n[i]=0;for(i=20062;i<=20092;i++)n[i]=0;for(i=20135;i<=20138;i++)n[i]=0;for(i=20248;i<=20258;i++)n[i]=0;for(i=20348;i<=20358;i++)n[i]=0;for(i=20436;i<=20440;i++)n[i]=0;for(i=20822;i<=20824;i++)n[i]=0;for(i=20904;i<=20932;i++)n[i]=0;for(i=20934;i<=20936;i++)n[i]=0;for(i=21004;i<=21032;i++)n[i]=0;for(i=21035;i<=21037;i++)n[i]=0;for(i=21095;i<=21097;i++)n[i]=0;for(i=21148;i<=21150;i++)n[i]=0;for(i=21207;i<=21264;i++)n[i]=0;for(i=21307;i<=21364;i++)n[i]=0;for(i=21413;i<=21423;i++)n[i]=0;for(i=21453;i<=21463;i++)n[i]=0;for(i=21473;i<=21483;i++)n[i]=0;for(i=21780;i<=21782;i++)n[i]=0;for(i=21891;i<=21894;i++)n[i]=0;for(i=21896;i<=21899;i++)n[i]=0;for(i=22171;i<=22177;i++)n[i]=0;for(i=22181;i<=22187;i++)n[i]=0;for(i=22191;i<=22197;i++)n[i]=0;for(i=22207;i<=22222;i++)n[i]=0;for(i=22229;i<=22232;i++)n[i]=0;for(i=22234;i<=22236;i++)n[i]=0;for(i=22243;i<=22250;i++)n[i]=0;for(i=22262;i<=22265;i++)n[i]=0;for(i=22307;i<=22322;i++)n[i]=0;for(i=22348;i<=22357;i++)n[i]=0;for(i=22407;i<=22422;i++)n[i]=0;for(i=22462;i<=22465;i++)n[i]=0;for(i=22521;i<=22525;i++)n[i]=0;for(i=22607;i<=22622;i++)n[i]=0;for(i=22641;i<=22646;i++)n[i]=0;for(i=22648;i<=22657;i++)n[i]=0;for(i=22707;i<=22722;i++)n[i]=0;for(i=22762;i<=22765;i++)n[i]=0;for(i=22807;i<=22822;i++)n[i]=0;for(i=22991;i<=22994;i++)n[i]=0;for(i=23028;i<=23038;i++)n[i]=0;for(i=23301;i<=23333;i++)n[i]=2;for(i=23830;i<=23853;i++)n[i]=0;for(i=23866;i<=23872;i++)n[i]=0;for(i=23877;i<=23884;i++)n[i]=0;for(i=23886;i<=23894;i++)n[i]=0;for(i=23946;i<=23948;i++)n[i]=0;for(i=24311;i<=24313;i++)n[i]=0;for(i=24342;i<=24347;i++)n[i]=0;for(i=24370;i<=24374;i++)n[i]=10;for(i=24375;i<=24381;i++)n[i]=0;for(i=24718;i<=24721;i++)n[i]=0;for(i=24817;i<=24821;i++)n[i]=0;for(i=24877;i<=24882;i++)n[i]=0;for(i=24891;i<=24893;i++)n[i]=0;for(i=25391;i<=25395;i++)n[i]=0;for(i=25828;i<=25838;i++)n[i]=0;for(i=26191;i<=26195;i++)n[i]=0;for(i=26391;i<=26393;i++)n[i]=0;for(i=26701;i<=26722;i++)n[i]=0;for(i=26729;i<=26799;i++)n[i]=2;for(i=26801;i<=26803;i++)n[i]=2;for(i=26811;i<=26813;i++)n[i]=2;for(i=26847;i<=26870;i++)n[i]=2;for(i=26891;i<=26899;i++)n[i]=0;for(i=26901;i<=26923;i++)n[i]=0;for(i=26929;i<=26946;i++)n[i]=0;for(i=26948;i<=26998;i++)n[i]=0;for(i=27037;i<=27040;i++)n[i]=0;for(i=27205;i<=27232;i++)n[i]=0;for(i=27258;i<=27260;i++)n[i]=0;for(i=27391;i<=27398;i++)n[i]=0;for(i=27561;i<=27564;i++)n[i]=0;for(i=27571;i<=27574;i++)n[i]=0;for(i=27581;i<=27584;i++)n[i]=0;for(i=27591;i<=27594;i++)n[i]=0;for(i=27700;i<=27707;i++)n[i]=0;for(i=28191;i<=28193;i++)n[i]=0;for(i=28348;i<=28358;i++)n[i]=0;for(i=28402;i<=28432;i++)n[i]=0;for(i=28462;i<=28492;i++)n[i]=0;for(i=29118;i<=29122;i++)n[i]=0;for(i=29168;i<=29172;i++)n[i]=0;for(i=29177;i<=29185;i++)n[i]=0;for(i=29187;i<=29195;i++)n[i]=0;for(i=29900;i<=29903;i++)n[i]=0;for(i=30161;i<=30179;i++)n[i]=0;for(i=30491;i<=30494;i++)n[i]=0;for(i=30729;i<=30732;i++)n[i]=0;for(i=31251;i<=31259;i++)n[i]=0;for(i=31265;i<=31268;i++)n[i]=0;for(i=31275;i<=31279;i++)n[i]=0;for(i=31281;i<=31297;i++)n[i]=0;for(i=31461;i<=31469;i++)n[i]=0;for(i=31491;i<=31495;i++)n[i]=0;for(i=31917;i<=31922;i++)n[i]=0;for(i=31965;i<=32e3;i++)n[i]=0;for(i=32001;i<=32003;i++)n[i]=2;for(i=32005;i<=32031;i++)n[i]=2;for(i=32033;i<=32060;i++)n[i]=2;for(i=32064;i<=32067;i++)n[i]=2;for(i=32074;i<=32077;i++)n[i]=2;for(i=32081;i<=32086;i++)n[i]=0;for(i=32107;i<=32130;i++)n[i]=0;for(i=32133;i<=32159;i++)n[i]=0;for(i=32164;i<=32167;i++)n[i]=2;for(i=32180;i<=32199;i++)n[i]=0;for(i=32201;i<=32260;i++)n[i]=0;for(i=32301;i<=32360;i++)n[i]=0;for(i=32401;i<=32460;i++)n[i]=0;for(i=32501;i<=32560;i++)n[i]=0;for(i=32601;i<=32662;i++)n[i]=0;for(i=32664;i<=32667;i++)n[i]=2;for(i=32701;i<=32761;i++)n[i]=0;for(i=53001;i<=53004;i++)n[i]=0;for(i=53008;i<=53019;i++)n[i]=0;for(i=53021;i<=53032;i++)n[i]=0;for(i=53034;i<=53037;i++)n[i]=0;for(i=53042;i<=53046;i++)n[i]=0;for(i=53074;i<=53080;i++)n[i]=0;for(i=54001;i<=54004;i++)n[i]=0;for(i=54008;i<=54019;i++)n[i]=0;for(i=54021;i<=54032;i++)n[i]=0;for(i=54034;i<=54037;i++)n[i]=0;for(i=54042;i<=54046;i++)n[i]=0;for(i=54048;i<=54053;i++)n[i]=0;for(i=54074;i<=54080;i++)n[i]=0;for(i=54098;i<=54101;i++)n[i]=0;for(i=102001;i<=102040;i++)n[i]=0;for(i=102042;i<=102063;i++)n[i]=0;for(i=102065;i<=102067;i++)n[i]=0;for(i=102070;i<=102117;i++)n[i]=0;for(i=102122;i<=102216;i++)n[i]=0;for(i=102221;i<=102377;i++)n[i]=0;for(i=102382;i<=102388;i++)n[i]=0;for(i=102389;i<=102398;i++)n[i]=2;for(i=102399;i<=102444;i++)n[i]=0;for(i=102445;i<=102447;i++)n[i]=2;for(i=102448;i<=102458;i++)n[i]=0;for(i=102459;i<=102468;i++)n[i]=2;for(i=102469;i<=102499;i++)n[i]=0;for(i=102500;i<=102519;i++)n[i]=1;for(i=102520;i<=102524;i++)n[i]=0;for(i=102525;i<=102529;i++)n[i]=2;for(i=102530;i<=102588;i++)n[i]=0;for(i=102590;i<=102598;i++)n[i]=0;for(i=102601;i<=102603;i++)n[i]=0;for(i=102605;i<=102628;i++)n[i]=0;for(i=102629;i<=102646;i++)n[i]=2;for(i=102648;i<=102700;i++)n[i]=2;for(i=102701;i<=102703;i++)n[i]=0;for(i=102707;i<=102730;i++)n[i]=2;for(i=102733;i<=102758;i++)n[i]=2;for(i=102767;i<=102900;i++)n[i]=0;for(i=102901;i<=102933;i++)n[i]=2;for(i=102934;i<=102950;i++)n[i]=13;for(i=102951;i<=102963;i++)n[i]=0;for(i=102965;i<=102969;i++)n[i]=0;for(i=102971;i<=102973;i++)n[i]=0;for(i=102975;i<=102989;i++)n[i]=0;for(i=102990;i<=102992;i++)n[i]=1;for(i=102997;i<=103002;i++)n[i]=0;for(i=103003;i<=103008;i++)n[i]=2;for(i=103009;i<=103011;i++)n[i]=0;for(i=103012;i<=103014;i++)n[i]=2;for(i=103019;i<=103021;i++)n[i]=0;for(i=103022;i<=103024;i++)n[i]=2;for(i=103029;i<=103031;i++)n[i]=0;for(i=103032;i<=103034;i++)n[i]=2;for(i=103065;i<=103068;i++)n[i]=0;for(i=103074;i<=103076;i++)n[i]=0;for(i=103077;i<=103079;i++)n[i]=1;for(i=103080;i<=103082;i++)n[i]=0;for(i=103083;i<=103085;i++)n[i]=2;for(i=103090;i<=103093;i++)n[i]=0;for(i=103097;i<=103099;i++)n[i]=0;for(i=103100;i<=103102;i++)n[i]=2;for(i=103107;i<=103109;i++)n[i]=0;for(i=103110;i<=103112;i++)n[i]=2;for(i=103113;i<=103116;i++)n[i]=0;for(i=103117;i<=103120;i++)n[i]=2;for(i=103153;i<=103157;i++)n[i]=0;for(i=103158;i<=103162;i++)n[i]=2;for(i=103163;i<=103165;i++)n[i]=0;for(i=103166;i<=103168;i++)n[i]=1;for(i=103169;i<=103171;i++)n[i]=2;for(i=103186;i<=103188;i++)n[i]=0;for(i=103189;i<=103191;i++)n[i]=2;for(i=103192;i<=103195;i++)n[i]=0;for(i=103196;i<=103199;i++)n[i]=2;for(i=103200;i<=103224;i++)n[i]=0;for(i=103225;i<=103227;i++)n[i]=1;for(i=103232;i<=103237;i++)n[i]=0;for(i=103238;i<=103243;i++)n[i]=2;for(i=103244;i<=103246;i++)n[i]=0;for(i=103247;i<=103249;i++)n[i]=2;for(i=103254;i<=103256;i++)n[i]=0;for(i=103257;i<=103259;i++)n[i]=2;for(i=103264;i<=103266;i++)n[i]=0;for(i=103267;i<=103269;i++)n[i]=2;for(i=103300;i<=103375;i++)n[i]=0;for(i=103381;i<=103383;i++)n[i]=0;for(i=103384;i<=103386;i++)n[i]=1;for(i=103387;i<=103389;i++)n[i]=0;for(i=103390;i<=103392;i++)n[i]=2;for(i=103397;i<=103399;i++)n[i]=0;for(i=103400;i<=103471;i++)n[i]=2;for(i=103476;i<=103478;i++)n[i]=0;for(i=103479;i<=103481;i++)n[i]=2;for(i=103486;i<=103488;i++)n[i]=0;for(i=103489;i<=103491;i++)n[i]=2;for(i=103492;i<=103495;i++)n[i]=0;for(i=103496;i<=103499;i++)n[i]=2;for(i=103528;i<=103543;i++)n[i]=0;for(i=103544;i<=103548;i++)n[i]=2;for(i=103549;i<=103551;i++)n[i]=0;for(i=103552;i<=103554;i++)n[i]=1;for(i=103555;i<=103557;i++)n[i]=2;for(i=103558;i<=103560;i++)n[i]=0;for(i=103571;i<=103573;i++)n[i]=0;for(i=103574;i<=103576;i++)n[i]=2;for(i=103577;i<=103580;i++)n[i]=0;for(i=103581;i<=103583;i++)n[i]=2;for(i=103595;i<=103694;i++)n[i]=0;for(i=103696;i<=103699;i++)n[i]=0;for(i=103700;i<=103793;i++)n[i]=2;for(i=103794;i<=103890;i++)n[i]=0;for(i=103891;i<=103896;i++)n[i]=2;for(i=103900;i<=103971;i++)n[i]=2;for(i=103972;i<=103977;i++)n[i]=0;for(i=112e3;i<=112101;i++)n[i]=0},42294:(e,t,r)=>{"use strict";r.d(t,{BI:()=>L,DC:()=>c,ES:()=>O,Ej:()=>v,HY:()=>x,Hq:()=>h,Ie:()=>P,Jf:()=>d,Jt:()=>I,KG:()=>S,LV:()=>k,Ne:()=>C,RF:()=>l,Uc:()=>b,VL:()=>f,_F:()=>y,aI:()=>F,cY:()=>T,fA:()=>o,fT:()=>D,gR:()=>w,gX:()=>_,hZ:()=>R,hs:()=>M,iT:()=>u,is:()=>N,pg:()=>A,qv:()=>U,sI:()=>z,uJ:()=>g,vI:()=>E,vQ:()=>p,v_:()=>V,vt:()=>s,w1:()=>a,yr:()=>m});var i=r(76797),n=r(2413);function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V;return[e[0],e[1],e[2],e[3],e[4],e[5]]}function o(e,t,r,i,n,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:s();return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a[4]=n,a[5]=o,a}function a(e,t){const r=isFinite(e[2])||isFinite(e[5]);return new i.A(r?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function l(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function c(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function u(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function h(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length/3,n=e[0],s=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let u=0;u<i;u++)n=Math.min(n,t[r+3*u]),s=Math.min(s,t[r+3*u+1]),o=Math.min(o,t[r+3*u+2]),a=Math.max(a,t[r+3*u]),l=Math.max(l,t[r+3*u+1]),c=Math.max(c,t[r+3*u+2]);e[0]=n,e[1]=s,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function d(e,t,r){const i=t.length;let n=e[0],s=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(r)for(let u=0;u<i;u++){const e=t[u];n=Math.min(n,e[0]),s=Math.min(s,e[1]),o=Math.min(o,e[2]),a=Math.max(a,e[0]),l=Math.max(l,e[1]),c=Math.max(c,e[2])}else for(let u=0;u<i;u++){const e=t[u];n=Math.min(n,e[0]),s=Math.min(s,e[1]),a=Math.max(a,e[0]),l=Math.max(l,e[1])}e[0]=n,e[1]=s,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function p(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function f(e){return e[0]>=e[3]?0:e[3]-e[0]}function m(e){return e[1]>=e[4]?0:e[4]-e[1]}function g(e){return e[2]>=e[5]?0:e[5]-e[2]}function y(e){const t=f(e),r=g(e),i=m(e);return Math.sqrt(t*t+r*r+i*i)}function _(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return t[0]=e[0]+f(e)/2,t[1]=e[1]+m(e)/2,t[2]=e[2]+g(e)/2,t}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return t[0]=f(e),t[1]=m(e),t[2]=g(e),t}function b(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function w(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function x(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function S(e,t){return null==t||x(e,t)}function T(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e;return n[0]=e[0]+t,n[1]=e[1]+r,n[2]=e[2]+i,n[3]=e[3]+t,n[4]=e[4]+r,n[5]=e[5]+i,n}function M(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;const i=e[0]+f(e)/2,n=e[1]+m(e)/2,s=e[2]+g(e)/2;return r[0]=i+(e[0]-i)*t,r[1]=n+(e[1]-n)*t,r[2]=s+(e[2]-s)*t,r[3]=i+(e[3]-i)*t,r[4]=n+(e[4]-n)*t,r[5]=s+(e[5]-s)*t,r}function A(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function C(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r}function E(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e}function R(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function P(e){return e?R(e,U):s(U)}function O(e,t){return t||(t=(0,n.vt)()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function I(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function L(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=Number.NEGATIVE_INFINITY,e[3]=i,e[4]=n,e[5]=Number.POSITIVE_INFINITY,e}function N(e){return 6===e.length}function D(e){return 0===f(e)&&0===m(e)&&0===g(e)}function F(e,t,r){if(null==e||null==t)return e===t;if(!N(e)||!N(t))return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function k(e,t,r,i,n,s){return o(e,t,r,i,n,s,B)}const z=[-1/0,-1/0,-1/0,1/0,1/0,1/0],U=[1/0,1/0,1/0,-1/0,-1/0,-1/0],V=[0,0,0,0,0,0],B=s()},2413:(e,t,r)=>{"use strict";r.d(t,{C:()=>a,E$:()=>E,HY:()=>A,Ie:()=>O,Io:()=>R,Jf:()=>p,Mx:()=>x,Rj:()=>T,Uc:()=>b,VL:()=>m,VY:()=>c,Wc:()=>y,aI:()=>N,cY:()=>P,fA:()=>l,fT:()=>d,gR:()=>C,gX:()=>v,k$:()=>M,m7:()=>w,o8:()=>o,pT:()=>_,qv:()=>F,sI:()=>D,tK:()=>h,uJ:()=>g,vQ:()=>f,vR:()=>S,vt:()=>s,w1:()=>u,ye:()=>L});r(81806);var i=r(15941),n=r(76797);function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k;return[e[0],e[1],e[2],e[3]]}function o(e){return[e[0],e[1],e[2],e[3]]}function a(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function l(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:s();return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s();return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function u(e,t){return new n.A({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function h(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function d(e,t,r){if(null!=t)if("length"in t)I(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3])):2!==t.length&&3!==t.length||(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[0]),r[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":r[0]=Math.min(e[0],t.xmin),r[1]=Math.min(e[1],t.ymin),r[2]=Math.max(e[2],t.xmax),r[3]=Math.max(e[3],t.ymax);break;case"point":r[0]=Math.min(e[0],t.x),r[1]=Math.min(e[1],t.y),r[2]=Math.max(e[2],t.x),r[3]=Math.max(e[3],t.y)}else a(r,e)}function p(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;const i=t.length;let n=e[0],s=e[1],o=e[2],a=e[3];for(let l=0;l<i;l++){const e=t[l];n=Math.min(n,e[0]),s=Math.min(s,e[1]),o=Math.max(o,e[0]),a=Math.max(a,e[1])}return r[0]=n,r[1]=s,r[2]=o,r[3]=a,r}function f(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function m(e){return null==e||e[0]>=e[2]?0:e[2]-e[0]}function g(e){return null==e||e[1]>=e[3]?0:e[3]-e[1]}function y(e){return m(e)*g(e)}function _(e){return m(e)>0&&g(e)>0}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function b(e,t){return T(e,t[0],t[1])}function w(e,t){const r=t[3],i=.5*(e[0]+e[2]),n=Math.abs(t[0]-i),s=.5*(e[2]-e[0]);if(n>r+s)return!1;const o=.5*(e[1]+e[3]),a=.5*(e[3]-e[1]),l=Math.abs(t[1]-o);if(l>r+a)return!1;if(n<s||l<a)return!0;const c=n-s,u=l-a;return c*c+u*u<=r*r}function x(e,t,r){const i=e[0],n=e[1],s=e[2],o=e[3],{x:a,y:l}=t,{x:c,y:u}=r,h=(e,t)=>(u-l)*e+(a-c)*t+(c*l-a*u)<0,d=h(i,o),p=h(s,o),f=h(s,n),m=h(i,n);return!(d===p&&p===f&&f===m&&m===d||a<i&&c<i||a>s&&c>s||l>o&&u>o||l<n&&u<n)}function S(e,t){return T(e,t.x,t.y)}function T(e,t,r){return t>=e[0]&&r>=e[1]&&t<=e[2]&&r<=e[3]}function M(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[0]<=e[2]+r&&t[1]<=e[3]+r}function A(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function C(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function E(e,t,r){if(null==t)return a(r,e);const n=t[0],s=t[1],o=t[2],l=t[3];return r[0]=(0,i.qE)(e[0],n,o),r[1]=(0,i.qE)(e[1],s,l),r[2]=(0,i.qE)(e[2],n,o),r[3]=(0,i.qE)(e[3],s,l),r}function R(e,t){const r=(e[0]+e[2])/2,i=(e[1]+e[3])/2,n=Math.max(Math.abs(t[0]-r)-m(e)/2,0),s=Math.max(Math.abs(t[1]-i)-g(e)/2,0);return Math.sqrt(n*n+s*s)}function P(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e;return i[0]=e[0]+t,i[1]=e[1]+r,i[2]=e[2]+t,i[3]=e[3]+r,i}function O(e){return e?a(e,F):s(F)}function I(e){return null!=e&&4===e.length}function L(e){return!(0!==m(e)&&isFinite(e[0])||0!==g(e)&&isFinite(e[1]))}function N(e,t){return I(e)&&I(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const D=[-1/0,-1/0,1/0,1/0],F=[1/0,1/0,-1/0,-1/0],k=[0,0,0,0]},52896:(e,t,r)=>{"use strict";r.d(t,{$I:()=>_,AU:()=>m,Cr:()=>d,g7:()=>y,i4:()=>h,ui:()=>p,up:()=>b,vt:()=>u,yo:()=>g});var i=r(15941),n=r(34761),s=r(60008),o=r(4336),a=r(20664),l=r(9392),c=r(55855);function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b;return[e[0],e[1],e[2],e[3]]}function h(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u();return(0,a.c)(r,e),r[3]=t,r}function d(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,c.vt)();return(0,a.b)(r,e,t),(0,a.n)(r,r),r[3]=-(0,a.d)(e,t),r}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u();const r=(0,n.l)(w,e);return v(t,(0,i.KJ)((0,s.Xd)(t,r))),t}function f(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u();return(0,s.x8)(w,e,_(e)),(0,s.x8)(x,t,_(t)),(0,s.lw)(w,x,w),v(r,(0,i.KJ)((0,s.Xd)(r,w)))}function m(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u();return h(l.Cw,e,S),h(l.JP,t,T),h(l.Cb,r,M),f(S,T,S),f(S,M,i),i}function g(e){return e}function y(e){return e[3]}function _(e){return(0,i.kU)(e[3])}function v(e,t){return e[3]=t,e}const b=[0,0,1,0],w=(0,o.vt)(),x=(0,o.vt)(),S=(u(),u()),T=u(),M=u()},65391:(e,t,r)=>{"use strict";r.d(t,{B$:()=>f,LJ:()=>m,Pj:()=>_,Rg:()=>d,Yz:()=>g,z8:()=>p});var i=r(2413);function n(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}function s(e){return void 0!==e.points}function o(e){return void 0!==e.x&&void 0!==e.y}function a(e){return void 0!==e.paths}function l(e){return void 0!==e.rings}function c(e){return function(t,r){return null==t?r:null==r?t:e(t,r)}}const u=c(Math.min),h=c(Math.max);function d(e,t){return a(t)?g(e,t.paths,!1,!1):l(t)?g(e,t.rings,!1,!1):s(t)?_(e,t.points,!1,!1,!1,!1):n(t)?y(e,t):(o(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function p(e){let t,r,n,s;for(e.reset(),t=n=1/0,r=s=-1/0;e.nextPath();){const i=f(e);t=Math.min(i[0],t),n=Math.min(i[1],n),r=Math.max(i[2],r),s=Math.max(i[3],s)}return(0,i.vt)([t,n,r,s])}function f(e){let t,r,n,s;for(t=n=1/0,r=s=-1/0;e.nextPoint();)t=Math.min(e.x,t),n=Math.min(e.y,n),r=Math.max(e.x,r),s=Math.max(e.y,s);return(0,i.vt)([t,n,r,s])}function m(e,t){return a(t)?g(e,t.paths,!0,!1):l(t)?g(e,t.rings,!0,!1):s(t)?_(e,t.points,!0,!1,!0,!1):n(t)?y(e,t,!0,!1,!0,!1):(o(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function g(e,t,r,i){const n=r?3:2;if(!t.length||!t[0].length)return null;let s,o,a,l,[c,d]=t[0][0],[p,f]=t[0][0];for(let m=0;m<t.length;m++){const e=t[m];for(let t=0;t<e.length;t++){const m=e[t],[g,y]=m;if(c=u(c,g),d=u(d,y),p=h(p,g),f=h(f,y),r&&m.length>2){const e=m[2];s=u(s,e),o=h(o,e)}if(i&&m.length>n){const e=m[n];a=u(s,e),l=h(o,e)}}}return r?i?(e[0]=c,e[1]=d,e[2]=s,e[3]=a,e[4]=p,e[5]=f,e[6]=o,e[7]=l,e.length=8,e):(e[0]=c,e[1]=d,e[2]=s,e[3]=p,e[4]=f,e[5]=o,e.length=6,e):i?(e[0]=c,e[1]=d,e[2]=a,e[3]=p,e[4]=f,e[5]=l,e.length=6,e):(e[0]=c,e[1]=d,e[2]=p,e[3]=f,e.length=4,e)}function y(e,t,r,i,n,s){const o=t.xmin,a=t.xmax,l=t.ymin,c=t.ymax;let u=t.zmin,h=t.zmax,d=t.mmin,p=t.mmax;return n?(u=u||0,h=h||0,s?(d=d||0,p=p||0,e[0]=o,e[1]=l,e[2]=u,e[3]=d,e[4]=a,e[5]=c,e[6]=h,e[7]=p,e):(e[0]=o,e[1]=l,e[2]=u,e[3]=a,e[4]=c,e[5]=h,e)):s?(d=d||0,p=p||0,e[0]=o,e[1]=l,e[2]=d,e[3]=a,e[4]=c,e[5]=p,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=c,e)}function _(e,t,r,i,n,s){const o=r?3:2,a=i&&s,l=r&&n;if(!t.length||!t[0].length)return null;let c,d,p,f,[m,g]=t[0],[y,_]=t[0];for(let v=0;v<t.length;v++){const e=t[v],[r,i]=e;if(m=u(m,r),g=u(g,i),y=h(y,r),_=h(_,i),l&&e.length>2){const t=e[2];c=u(c,t),d=h(d,t)}if(a&&e.length>o){const t=e[o];p=u(c,t),f=h(d,t)}}return n?(c=c||0,d=d||0,s?(p=p||0,f=f||0,e[0]=m,e[1]=g,e[2]=c,e[3]=p,e[4]=y,e[5]=_,e[6]=d,e[7]=f,e):(e[0]=m,e[1]=g,e[2]=c,e[3]=y,e[4]=_,e[5]=d,e)):s?(p=p||0,f=f||0,e[0]=m,e[1]=g,e[2]=p,e[3]=y,e[4]=_,e[5]=f,e):(e[0]=m,e[1]=g,e[2]=y,e[3]=_,e)}},88105:(e,t,r)=>{"use strict";r.d(t,{Y$:()=>d,qB:()=>b,Qt:()=>V,My:()=>G,bf:()=>F,jZ:()=>g,j0:()=>y,Sx:()=>_,E$:()=>v,h:()=>E,P:()=>I,SL:()=>T,gH:()=>p,si:()=>w,mJ:()=>B,UL:()=>Z,D6:()=>k,Yi:()=>R,An:()=>L,LC:()=>M,xs:()=>f,Xm:()=>x,Vp:()=>j,zD:()=>$,m8:()=>z,nS:()=>P,H$:()=>N,eI:()=>A,Eq:()=>m,Aj:()=>S,E7:()=>H,Y4:()=>q,TX:()=>U,Uz:()=>O,ml:()=>D,XP:()=>C});class i{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;this.TypedArrayConstructor=e,this.elementCount=9;const s=this.TypedArrayConstructor;void 0===i&&(i=9*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.count-t;const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getMat(e,t){let r=e*this.typedBufferStride;for(let i=0;i<9;i++)t[i]=this.typedBuffer[r++];return t}setMat(e,t){let r=e*this.typedBufferStride;for(let i=0;i<9;i++)this.typedBuffer[r++]=t[i]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,o=r*t.typedBufferStride;for(let a=0;a<9;++a)i[s++]=n[o++]}get buffer(){return this.typedBuffer.buffer}}i.ElementCount=9;class n{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;this.TypedArrayConstructor=e,this.elementCount=16;const s=this.TypedArrayConstructor;void 0===i&&(i=16*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.count-t;const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getMat(e,t){let r=e*this.typedBufferStride;for(let i=0;i<16;i++)t[i]=this.typedBuffer[r++];return t}setMat(e,t){let r=e*this.typedBufferStride;for(let i=0;i<16;i++)this.typedBuffer[r++]=t[i]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,o=r*t.typedBufferStride;for(let a=0;a<16;++a)i[s++]=n[o++]}get buffer(){return this.typedBuffer.buffer}}n.ElementCount=16;class s{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;this.TypedArrayConstructor=e,this.elementCount=1;const s=this.TypedArrayConstructor;void 0===i&&(i=s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-r)/s.BYTES_PER_ELEMENT),this.stride=i,this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.count-t;const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,t){this.typedBuffer[e*this.typedBufferStride]=t}get buffer(){return this.typedBuffer.buffer}}s.ElementCount=1;var o=r(19555);class a{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;this.TypedArrayConstructor=e,this.elementCount=2;const s=this.TypedArrayConstructor;void 0===i&&(i=2*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.count-t;const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,o.hZ)(t,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e]=t[1]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e]=r}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,o=r*t.typedBufferStride;i[s++]=n[o++],i[s]=n[o]}get buffer(){return this.typedBuffer.buffer}}a.ElementCount=2;var l=r(20664);class c{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;this.TypedArrayConstructor=e,this.elementCount=3;const s=this.TypedArrayConstructor;void 0===i&&(i=3*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.count-t;const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,l.s)(t,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e]=t[2]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,o=r*t.typedBufferStride;i[s++]=n[o++],i[s++]=n[o++],i[s]=n[o]}get buffer(){return this.typedBuffer.buffer}}c.ElementCount=3;var u=r(43047);class h{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const s=this.TypedArrayConstructor;void 0===i&&(i=4*s.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:r;this.typedBuffer=null==n?new s(t,o):new s(t,o,(n-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.count-t;const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,u.s)(t,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e++]=t[2],this.typedBuffer[e]=t[3]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r,i,n){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=n}copyFrom(e,t,r){const i=this.typedBuffer,n=t.typedBuffer;let s=e*this.typedBufferStride,o=r*t.typedBufferStride;i[s++]=n[o++],i[s++]=n[o++],i[s++]=n[o++],i[s]=n[o]}get buffer(){return this.typedBuffer.buffer}}h.ElementCount=4;class d extends s{constructor(e){super(Float32Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="f32"}static fromTypedArray(e,t){return new d(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}d.ElementType="f32";class p extends a{constructor(e){super(Float32Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="f32"}slice(e,t){return this.sliceBuffer(p,e,t)}static fromTypedArray(e,t){return new p(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}p.ElementType="f32";class f extends c{constructor(e){super(Float32Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="f32"}slice(e,t){return this.sliceBuffer(f,e,t)}static fromTypedArray(e,t){return new f(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}f.ElementType="f32";class m extends h{constructor(e){super(Float32Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="f32"}slice(e,t){return this.sliceBuffer(m,e,t)}static fromTypedArray(e,t){return new m(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}m.ElementType="f32";class g extends i{constructor(e){super(Float32Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="f32"}slice(e,t){return this.sliceBuffer(g,e,t)}static fromTypedArray(e,t){return new g(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}g.ElementType="f32";class y extends i{constructor(e){super(Float64Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="f64"}slice(e,t){return this.sliceBuffer(y,e,t)}static fromTypedArray(e,t){return new y(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}y.ElementType="f64";class _ extends n{constructor(e){super(Float32Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="f32"}slice(e,t){return this.sliceBuffer(_,e,t)}static fromTypedArray(e,t){return new _(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}_.ElementType="f32";class v extends n{constructor(e){super(Float64Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="f64"}slice(e,t){return this.sliceBuffer(v,e,t)}static fromTypedArray(e,t){return new v(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}v.ElementType="f64";class b extends s{constructor(e){super(Float64Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="f64"}slice(e,t){return this.sliceBuffer(b,e,t)}static fromTypedArray(e,t){return new b(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}b.ElementType="f64";class w extends a{constructor(e){super(Float64Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="f64"}slice(e,t){return this.sliceBuffer(w,e,t)}static fromTypedArray(e,t){return new w(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}w.ElementType="f64";class x extends c{constructor(e){super(Float64Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="f64"}slice(e,t){return this.sliceBuffer(x,e,t)}static fromTypedArray(e,t){return new x(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}x.ElementType="f64";class S extends h{constructor(e){super(Float64Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="f64"}slice(e,t){return this.sliceBuffer(S,e,t)}static fromTypedArray(e,t){return new S(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}S.ElementType="f64";class T extends s{constructor(e){super(Uint8Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="u8"}slice(e,t){return this.sliceBuffer(T,e,t)}static fromTypedArray(e,t){return new T(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}T.ElementType="u8";class M extends a{constructor(e){super(Uint8Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="u8"}slice(e,t){return this.sliceBuffer(M,e,t)}static fromTypedArray(e,t){return new M(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}M.ElementType="u8";class A extends c{constructor(e){super(Uint8Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="u8"}slice(e,t){return this.sliceBuffer(A,e,t)}static fromTypedArray(e,t){return new A(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}A.ElementType="u8";class C extends h{constructor(e){super(Uint8Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="u8"}slice(e,t){return this.sliceBuffer(C,e,t)}static fromTypedArray(e,t){return new C(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}C.ElementType="u8";class E extends s{constructor(e){super(Uint16Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="u16"}slice(e,t){return this.sliceBuffer(E,e,t)}static fromTypedArray(e,t){return new E(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}E.ElementType="u16";class R extends a{constructor(e){super(Uint16Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="u16"}slice(e,t){return this.sliceBuffer(R,e,t)}static fromTypedArray(e,t){return new R(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}R.ElementType="u16";class P extends c{constructor(e){super(Uint16Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="u16"}slice(e,t){return this.sliceBuffer(P,e,t)}static fromTypedArray(e,t){return new P(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}P.ElementType="u16";class O extends h{constructor(e){super(Uint16Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="u16"}slice(e,t){return this.sliceBuffer(O,e,t)}static fromTypedArray(e,t){return new O(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}O.ElementType="u16";class I extends s{constructor(e){super(Uint32Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="u32"}slice(e,t){return this.sliceBuffer(I,e,t)}static fromTypedArray(e,t){return new I(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}I.ElementType="u32";class L extends a{constructor(e){super(Uint32Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="u32"}slice(e,t){return this.sliceBuffer(L,e,t)}static fromTypedArray(e,t){return new L(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}L.ElementType="u32";class N extends c{constructor(e){super(Uint32Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="u32"}slice(e,t){return this.sliceBuffer(N,e,t)}static fromTypedArray(e,t){return new N(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}N.ElementType="u32";class D extends h{constructor(e){super(Uint32Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="u32"}slice(e,t){return this.sliceBuffer(D,e,t)}static fromTypedArray(e,t){return new D(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}D.ElementType="u32";class F extends s{constructor(e){super(Int8Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="i8"}slice(e,t){return this.sliceBuffer(F,e,t)}static fromTypedArray(e,t){return new F(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}F.ElementType="i8";class k extends a{constructor(e){super(Int8Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="i8"}slice(e,t){return this.sliceBuffer(k,e,t)}static fromTypedArray(e,t){return new k(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}k.ElementType="i8";class z extends c{constructor(e){super(Int8Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="i8"}slice(e,t){return this.sliceBuffer(z,e,t)}static fromTypedArray(e,t){return new z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}z.ElementType="i8";class U extends h{constructor(e){super(Int8Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="i8"}slice(e,t){return this.sliceBuffer(U,e,t)}static fromTypedArray(e,t){return new U(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}U.ElementType="i8";class V extends s{constructor(e){super(Int16Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="i16"}slice(e,t){return this.sliceBuffer(V,e,t)}static fromTypedArray(e,t){return new V(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}V.ElementType="i16";class B extends a{constructor(e){super(Int16Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="i16"}slice(e,t){return this.sliceBuffer(B,e,t)}static fromTypedArray(e,t){return new B(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}B.ElementType="i16";class j extends c{constructor(e){super(Int16Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="i16"}slice(e,t){return this.sliceBuffer(j,e,t)}static fromTypedArray(e,t){return new j(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}j.ElementType="i16";class H extends h{constructor(e){super(Int16Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="i16"}slice(e,t){return this.sliceBuffer(H,e,t)}static fromTypedArray(e,t){return new H(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}H.ElementType="i16";class G extends s{constructor(e){super(Int32Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="i32"}slice(e,t){return this.sliceBuffer(G,e,t)}static fromTypedArray(e,t){return new G(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}G.ElementType="i32";class Z extends a{constructor(e){super(Int32Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="i32"}slice(e,t){return this.sliceBuffer(Z,e,t)}static fromTypedArray(e,t){return new Z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Z.ElementType="i32";class $ extends c{constructor(e){super(Int32Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="i32"}slice(e,t){return this.sliceBuffer($,e,t)}static fromTypedArray(e,t){return new $(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}$.ElementType="i32";class q extends h{constructor(e){super(Int32Array,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0),this.elementType="i32"}slice(e,t){return this.sliceBuffer(q,e,t)}static fromTypedArray(e,t){return new q(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}q.ElementType="i32"},6381:(e,t,r)=>{"use strict";function i(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}r.d(t,{GJ:()=>i})},205:(e,t,r)=>{"use strict";r.d(t,{S8:()=>a,TP:()=>d,Z4:()=>s,l8:()=>o,w2:()=>c});var i=r(16108),n=r(5262);function s(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function o(e){return e?a(e.rings,e.hasZ??!1):null}function a(e,t){if(!e?.length)return null;const r=[],i=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=e.length;n<o;n++){const r=l(e[n],t,s);r&&i.push(r)}if(i.sort(((e,r)=>{let i=e[2]-r[2];return 0===i&&t&&(i=e[4]-r[4]),i})),i.length&&(r[0]=i[0][0],r[1]=i[0][1],t&&(r[2]=i[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||t&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){const i=e[0]&&e[0].length?function(e,t){const r=t?[0,0,0]:[0,0],i=t?[0,0,0]:[0,0];let s=0,o=0,a=0,l=0;for(let c=0,u=e.length;c<u-1;c++){const u=e[c],h=e[c+1];if(u&&h){r[0]=u[0],r[1]=u[1],i[0]=h[0],i[1]=h[1],t&&u.length>2&&h.length>2&&(r[2]=u[2],i[2]=h[2]);const e=(0,n.R3)(r,i);if(e){s+=e;const r=(0,n.t9)(u,h);o+=e*r[0],a+=e*r[1],t&&r.length>2&&(l+=e*r[2])}}}return s>0?t?[o/s,a/s,l/s]:[o/s,a/s]:e.length?e[0]:null}(e[0],t):null;if(!i)return null;r[0]=i[0],r[1]=i[1],t&&i.length>2&&(r[2]=i[2])}return r}function l(e,t,r){let i=0,n=0,s=0,o=0,a=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,u=e.length&&t?e[0][2]:0;for(let d=0;d<e.length;d++){const h=e[d],p=e[(d+1)%e.length],[f,m,g]=h,y=f-l,_=m-c,[v,b,w]=p,x=v-l,S=b-c,T=y*S-x*_;if(o+=T,i+=(y+x)*T,n+=(_+S)*T,t&&h.length>2&&p.length>2){const e=g-u,t=w-u,r=y*t-x*e;s+=(e+t)*r,a+=r}f<r[0]&&(r[0]=f),f>r[1]&&(r[1]=f),m<r[2]&&(r[2]=m),m>r[3]&&(r[3]=m),t&&(g<r[4]&&(r[4]=g),g>r[5]&&(r[5]=g))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const h=[i/(6*o)+l,n/(6*o)+c,o];return t&&(r[4]===r[5]||0===a?(h[3]=(r[4]+r[5])/2,h[4]=0):(h[3]=s/(6*a)+u,h[4]=a)),h}function c(e,t){let r=0,i=0,n=0;e.nextPoint();const s=e.pathSize?e.x:0,o=e.pathSize?e.y:0;for(let a=0;a<e.pathSize;a++){e.seekInPath(a);const l=[e.x,e.y];e.seekInPath((a+1)%e.pathSize);const c=[e.x,e.y],[u,h]=l,d=u-s,p=h-o,[f,m]=c,g=f-s,y=m-o,_=d*y-g*p;n+=_,r+=(d+g)*_,i+=(p+y)*_,u<t[0]&&(t[0]=u),u>t[1]&&(t[1]=u),h<t[2]&&(t[2]=h),h>t[3]&&(t[3]=h)}return n>0&&(n*=-1),n?(n*=.5,[r/(6*n)+s,i/(6*n)+o,n]):null}function u(e){const{hasZ:t,totalSize:r}=e;if(0===r)return null;const s=[],o=[],a=t?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(e.reset();e.nextPath();){const t=l((0,i.A)(e),e.hasZ,a);t&&o.push(t)}if(o.sort(((e,r)=>{let i=e[2]-r[2];return 0===i&&t&&(i=e[4]-r[4]),i})),o.length&&(s[0]=o[0][0],s[1]=o[0][1],t&&(s[2]=o[0][3]),(s[0]<a[0]||s[0]>a[1]||s[1]<a[2]||s[1]>a[3]||t&&(s[2]<a[4]||s[2]>a[5]))&&(s.length=0)),!s.length){e.reset(),e.nextPath();const r=e.pathSize?function(e){const{hasZ:t}=e,r=t?[0,0,0]:[0,0],i=t?[0,0,0]:[0,0];let s=0,o=0,a=0,l=0;if(e.nextPoint()){let c=e.x,u=e.y,h=e.z;for(;e.nextPoint();){const d=e.x,p=e.y,f=e.z;r[0]=c,r[1]=u,i[0]=d,i[1]=p,t&&(r[2]=h,i[2]=f);const m=(0,n.R3)(r,i);if(m){s+=m;const e=(0,n.t9)(r,i);o+=m*e[0],a+=m*e[1],t&&e.length>2&&(l+=m*e[2])}c=d,u=p,h=f}}return s>0?t?[o/s,a/s,l/s]:[o/s,a/s]:e.pathSize?(e.seekPathStart(),e.nextPoint(),[e.x,e.y]):null}(e):null;if(!r)return null;s[0]=r[0],s[1]=r[1],t&&r.length>2&&(s[2]=r[2])}return s}const h=1e-6;function d(e){let t=0;for(e.reset();e.nextPath();)t+=e.getCurrentRingArea();if(t<h){const t=u(e);return t?[t[0],t[1]]:null}const r=[0,0];if(e.reset(),!e.nextPath()||!e.nextPoint())return null;const i=[e.x,e.y];for(e.reset();e.nextPath();)f(r,i,e);return r[0]*=1/t,r[1]*=1/t,r[0]+=i[0],r[1]+=i[1],r}const p=1/3;function f(e,t,r){if(!e||!r||r.pathSize<3)return null;r.nextPoint();const i=r.x,n=r.y;r.nextPoint();let s,o=r.x-i,a=r.y-n,l=0,c=0;for(;r.nextPoint();)l=r.x-i,c=r.y-n,s=.5*p*(l*a-c*o),e[0]+=s*(o+l),e[1]+=s*(a+c),o=l,a=c;const u=r.getCurrentRingArea(),h=[i,n];return h[0]-=t[0],h[1]-=t[1],h[0]*=u,h[1]*=u,e[0]+=h[0],e[1]+=h[1],e}},49595:(e,t,r)=>{"use strict";r.d(t,{$e:()=>a,Eo:()=>l,j1:()=>c,mO:()=>u,vt:()=>o});var i=r(97467),n=r(20664),s=r(95925);function o(e){return e?{ray:(0,s.vt)(e.ray),c0:e.c0,c1:e.c1}:{ray:(0,s.vt)(),c0:0,c1:Number.MAX_VALUE}}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o();return(0,s.C)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o();const i=(0,n.l)(e.vector);return(0,s.fA)(e.origin,t,r.ray),r.c0=0,r.c1=i,r}function c(e,t){return h(e,e.c0,t)}function u(e,t){return h(e,e.c1,t)}function h(e,t,r){return(0,n.g)(r,e.ray.origin,(0,n.j)(r,e.ray.direction,t))}new i.I((()=>o()))},11352:(e,t,r)=>{"use strict";r.d(t,{CW:()=>a,F8:()=>l,gH:()=>o,lB:()=>c,m3:()=>u,qz:()=>n,rL:()=>s,t1:()=>h});const i=[0,0];function n(e,t){return null!=t&&c(e,t.x,t.y,t.z)}function s(e,t){if(!t.points||t.points.length)return!1;for(const r of t.points)if(!a(e,r))return!1;return!0}function o(e,t){const{xmin:r,ymin:i,zmin:n,xmax:s,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?c(e,r,i,n)&&c(e,r,o,n)&&c(e,s,o,n)&&c(e,s,i,n)&&c(e,r,i,a)&&c(e,r,o,a)&&c(e,s,o,a)&&c(e,s,i,a):c(e,r,i)&&c(e,r,o)&&c(e,s,o)&&c(e,s,i)}function a(e,t){return c(e,t[0],t[1])}function l(e,t){return c(e,t[0],t[1],t[2])}function c(e,t,r,i){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax&&(null==i||!e.hasZ||i>=e.zmin&&i<=e.zmax)}function u(e,t){return i[1]=t.y,i[0]=t.x,function(e,t){return h(e.rings,t)}(e,i)}function h(e,t){if(!e)return!1;if(function(e){return!Array.isArray(e[0][0])}(e))return d(!1,e,t);let r=!1;for(let i=0,n=e.length;i<n;i++)r=d(r,e[i],t);return r}function d(e,t,r){const[i,n]=r;let s=e,o=0;for(let a=0,l=t.length;a<l;a++){o++,o===l&&(o=0);const[e,r]=t[a],[c,u]=t[o];(r<n&&u>=n||u<n&&r>=n)&&e+(n-r)/(u-r)*(c-e)<i&&(s=!s)}return s}},88954:(e,t,r)=>{"use strict";r.d(t,{E$:()=>S,Gs:()=>R,Jq:()=>T,PX:()=>C,Sj:()=>m,U9:()=>E,US:()=>x,Ui:()=>b,b:()=>p,jI:()=>_,lt:()=>w,oJ:()=>y,vf:()=>v,vt:()=>d,xW:()=>M});var i=r(34761),n=r(20664),s=r(9392),o=r(34111),a=r(13312),l=r(98510),c=r(5568),u=r(79650),h=r(93582);function d(e){const{value:t,operations:r}=e;return{operations:r,value:r.create(t)}}function p(e,t,r){return e.operations.setExtent(e.value,t,r.value),r}function f(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return{operations:e,value:e.create()}}(e);return r.operations=e,e.copy(t,r.value),r}function m(e){return f(h.s,(0,h.f)(0,0,0,(0,o.tO)(e).radius))}const g=2**50;function y(){return f(u.b,(0,u.f)([0,0,0],[g,0,0],[0,g,0]))}function _(e,t,r){return e.operations.axisAt(e.value,t,c._.Z,r)}function v(e,t,r,i){return e.operations.axisAt(e.value,t,r,i)}function b(e,t,r){return e.operations.intersectRay(e.value,t,r)}function w(e,t,r){return e.operations.intersectRayClosestSilhouette(e.value,t,r)}function x(e,t){return e.operations.altitudeAt(e.value,t)}function S(e,t,r,i){return e.operations.setAltitudeAt(e.value,t,r,i)}function T(e,t,r,s){return t!==s&&(0,i.C)(s,t),(0,n.s)(A,s[12],s[13],s[14]),S(e,A,r,A),s[12]=A[0],s[13]=A[1],s[14]=A[2],s}function M(e,t,r){return e.operations.elevate(e.value,t,r.value)}const A=(0,s.vt)();function C(e,t,r,i,s){return s[0]=(0,n.m)(e,t),s[1]=(0,n.m)(e,r),s[2]=(0,n.m)(e,i),s}function E(e,t,r,i,s){(0,n.c)(r,e),(0,n.c)(P,t),(0,n.n)(P,P),(0,n.b)(i,P,r),(0,n.b)(s,i,r)}function R(e,t){return e?(0,l.lO)(t):t.isGeographic?a.A.PlateCarree:t}const P=(0,s.vt)()},5262:(e,t,r)=>{"use strict";r.d(t,{$3:()=>p,$H:()=>d,It:()=>v,JM:()=>y,Ng:()=>c,R3:()=>o,Yl:()=>h,_7:()=>g,gR:()=>l,m3:()=>m,t9:()=>u});var i=r(18690),n=r(5568),s=r(80963);function o(e,t){const r=t[0]-e[0],i=t[1]-e[1];if(e.length>2&&t.length>2){const n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}return Math.sqrt(r*r+i*i)}function a(e,t,r){const i=e[0]+r*(t[0]-e[0]),n=e[1]+r*(t[1]-e[1]);return e.length>2&&t.length>2?[i,n,e[2]+r*(t[2]-e[2])]:[i,n]}function l(e,t,r,i){const[n,s]=t,[o,a]=r,[l,c]=i,u=l-o,h=c-a,d=u*u+h*h,p=(n-o)*u+(s-a)*h,f=Math.min(1,Math.max(0,p/d));return e[0]=o+u*f,e[1]=a+h*f,e}function c(e,t,r,i,n,s){let o=r,a=i,l=n-o,c=s-a;if(0!==l||0!==c){const r=((e-o)*l+(t-a)*c)/(l*l+c*c);r>1?(o=n,a=s):r>0&&(o+=l*r,a+=c*r)}return l=e-o,c=t-a,l*l+c*c}function u(e,t){return a(e,t,.5)}function h(e){const t=e.length;let r=0;for(let i=0;i<t-1;++i)r+=o(e[i],e[i+1]);return r}function d(e,t){if(t<=0)return e[0];const r=e.length;let i=0;for(let n=0;n<r-1;++n){const r=o(e[n],e[n+1]);if(t-i<r){const s=(t-i)/r;return a(e[n],e[n+1],s)}i+=r}return e[r-1]}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n._.X,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n._.Y,i=0;const s=e.length;let o=e[0];for(let n=1;n<s;n++){const s=e[n];i+=(s[t]-o[t])*(s[r]+o[r]),o=s}if(!f(e)){const n=e[0];i+=(n[t]-o[t])*(n[r]+o[r])}return i>=0}function f(e){const t=e.length;return t<3||(0,i.aI)(e[0],e[t-1])}function m(e){if(!("rings"in e))return!1;let t=!1;for(const r of e.rings)f(r)||(r.push(r[0].slice()),t=!0);return t}function g(e){return"polygon"!==e.type&&"polyline"!==e.type||y("polygon"===e.type?e.rings:e.paths,e.spatialReference),e}function y(e,t){const r=(0,s.Vp)(t);if(!r)return;const i=r.valid[0],n=r.valid[1],o=n-i;for(const s of e){let e=1/0,t=-1/0;for(const o of s){const r=_(o[0],i,n);e=Math.min(e,r),t=Math.max(t,r),o[0]=r}const r=t-e;o-r<r&&s.forEach((e=>{e[0]<0&&(e[0]+=o)}))}}function _(e,t,r){const i=r-t;return e<t?r-(t-e)%i:e>r?t+(e-t)%i:e}function v(e,t){if(e===t)return!0;if(e.type!==t.type)return!1;if("point"===e.type||"mesh"===e.type||"extent"===e.type)return!0;if("multipoint"===e.type)return e.points.length===t.points.length;const[r,i]="polyline"===e.type?[e.paths,t.paths]:[e.rings,t.rings];return r.length===i.length&&r.every(((e,t)=>e.length===i[t].length))}},27084:(e,t,r)=>{"use strict";r.d(t,{HA:()=>u,Z3:()=>d,v:()=>h});var i=r(65391);const n=[];function s(e,t,r,i){return{xmin:e,ymin:t,xmax:r,ymax:i}}function o(e,t,r,i,n,s){return{xmin:e,ymin:t,zmin:r,xmax:i,ymax:n,zmax:s}}function a(e,t,r,i,n,s){return{xmin:e,ymin:t,mmin:r,xmax:i,ymax:n,mmax:s}}function l(e,t,r,i,n,s,o,a){return{xmin:e,ymin:t,zmin:r,mmin:i,xmax:n,ymax:s,zmax:o,mmax:a}}function c(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?t?l(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):o(e[0],e[1],e[2],e[3],e[4],e[5]):t?a(e[0],e[1],e[2],e[3],e[4],e[5]):s(e[0],e[1],e[2],e[3])}function u(e){return e?function(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}(e)?e:function(e){return void 0!==e.x&&void 0!==e.y}(e)?function(e){const{x:t,y:r,z:i,m:n}=e,c=null!=n;return null!=i?c?l(t,r,i,n,t,r,i,n):o(t,r,i,t,r,i):c?a(t,r,n,t,r,n):s(t,r,t,r)}(e):function(e){return void 0!==e.rings}(e)?h(e):function(e){return void 0!==e.paths}(e)?d(e):function(e){return void 0!==e.points}(e)?function(e){const{hasZ:t,hasM:r,points:s}=e;return c((0,i.Pj)(n,s,t??!1,r??!1),t,r)}(e):null:null}function h(e){const{hasZ:t,hasM:r,rings:s}=e,o=(0,i.Yz)(n,s,t??!1,r??!1);return o?c(o,t,r):null}function d(e){const{hasZ:t,hasM:r,paths:s}=e,o=(0,i.Yz)(n,s,t??!1,r??!1);return o?c(o,t,r):null}},4763:(e,t,r)=>{"use strict";r.d(t,{C:()=>y,DV:()=>v,FB:()=>i,J7:()=>n,Qy:()=>g,ST:()=>S,YH:()=>C,bU:()=>T,c8:()=>A,ig:()=>x,m7:()=>b,pw:()=>w,ui:()=>_,vt:()=>m});var i,n,s,o=r(97467),a=r(34761),l=r(20664),c=r(9392),u=r(43047),h=r(55855),d=r(49595),p=r(13927),f=r(75762);function m(e){return e?[(0,p.vt)(e[0]),(0,p.vt)(e[1]),(0,p.vt)(e[2]),(0,p.vt)(e[3]),(0,p.vt)(e[4]),(0,p.vt)(e[5])]:[(0,p.vt)(),(0,p.vt)(),(0,p.vt)(),(0,p.vt)(),(0,p.vt)(),(0,p.vt)()]}function g(){return[(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)()]}function y(e,t){for(let r=0;r<C;r++)(0,p.C)(e[r],t[r]);return e}function _(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O;const n=(0,a.lw)(f.Rc.get(),t,e);(0,a.B8)(n,n);for(let s=0;s<E;++s){const e=(0,u.t)(f.Km.get(),R[s],n);(0,l.s)(i[s],e[0]/e[3],e[1]/e[3],e[2]/e[3])}v(r,i)}function v(e,t){(0,p.Cr)(t[n.FAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_TOP_LEFT],e[i.LEFT]),(0,p.Cr)(t[n.NEAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_RIGHT],t[n.FAR_TOP_RIGHT],e[i.RIGHT]),(0,p.Cr)(t[n.FAR_BOTTOM_LEFT],t[n.FAR_BOTTOM_RIGHT],t[n.NEAR_BOTTOM_RIGHT],e[i.BOTTOM]),(0,p.Cr)(t[n.NEAR_TOP_LEFT],t[n.NEAR_TOP_RIGHT],t[n.FAR_TOP_RIGHT],e[i.TOP]),(0,p.Cr)(t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_RIGHT],t[n.NEAR_TOP_RIGHT],e[i.NEAR]),(0,p.Cr)(t[n.FAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_LEFT],t[n.FAR_TOP_LEFT],e[i.FAR])}function b(e,t){for(let r=0;r<C;r++){const i=e[r];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}function w(e,t){return M(e,(0,d.$e)(t,P.get()))}function x(e,t){for(let r=0;r<C;r++){const i=e[r];if(!(0,p.b6)(i,t))return!1}return!0}function S(e,t,r){return M(e,(0,d.Eo)(t,r,P.get()))}function T(e,t){for(let r=0;r<C;r++)if((0,p.mN)(e[r],t)>0)return!1;return!0}function M(e,t){for(let r=0;r<C;r++)if(!(0,p.$Q)(e[r],t))return!1;return!0}(s=i||(i={}))[s.LEFT=0]="LEFT",s[s.RIGHT=1]="RIGHT",s[s.BOTTOM=2]="BOTTOM",s[s.TOP=3]="TOP",s[s.NEAR=4]="NEAR",s[s.FAR=5]="FAR",function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(n||(n={}));const A={bottom:[n.FAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_LEFT,n.FAR_BOTTOM_LEFT],near:[n.NEAR_BOTTOM_LEFT,n.NEAR_BOTTOM_RIGHT,n.NEAR_TOP_RIGHT,n.NEAR_TOP_LEFT],far:[n.FAR_BOTTOM_RIGHT,n.FAR_BOTTOM_LEFT,n.FAR_TOP_LEFT,n.FAR_TOP_RIGHT],right:[n.NEAR_BOTTOM_RIGHT,n.FAR_BOTTOM_RIGHT,n.FAR_TOP_RIGHT,n.NEAR_TOP_RIGHT],left:[n.FAR_BOTTOM_LEFT,n.NEAR_BOTTOM_LEFT,n.NEAR_TOP_LEFT,n.FAR_TOP_LEFT],top:[n.FAR_TOP_LEFT,n.NEAR_TOP_LEFT,n.NEAR_TOP_RIGHT,n.FAR_TOP_RIGHT]},C=6,E=8,R=[(0,h.fA)(-1,-1,-1,1),(0,h.fA)(1,-1,-1,1),(0,h.fA)(1,1,-1,1),(0,h.fA)(-1,1,-1,1),(0,h.fA)(-1,-1,1,1),(0,h.fA)(1,-1,1,1),(0,h.fA)(1,1,1,1),(0,h.fA)(-1,1,1,1)],P=new o.I(d.vt),O=g()},63885:(e,t,r)=>{"use strict";r.d(t,{TP:()=>l,_f:()=>s,eh:()=>n,uw:()=>c});var i=r(14556);const n=Math.PI/180,s=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,o=i.$O.radius,a=i.$O.eccentricitySquared,l={a1:o*a,a2:o*a*o*a,a3:o*a*a/2,a4:o*a*o*a*2.5,a5:o*a+o*a*a/2,a6:1-a},c={4267:{a:6378206.4,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:i.$O.radius,f:i.$O.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:i.Sw.radius,f:i.Sw.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:i.sH.radius,f:i.sH.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:i.sH.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}}},86100:(e,t,r)=>{"use strict";r.d(t,{DN:()=>a,Sv:()=>o,ZY:()=>l,z8:()=>s});r(35238);var i=r(68002),n=r(76797);function s(e){switch(e?.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return null}}async function o(e,t){if(e.hasZ||"2d"===t.type)return e;const r=t.map?.ground;if(!r?.layers.length)return e;const{geometry:i}=await r.queryElevation(e,{cache:t.basemapTerrain?.elevationQueryCache});return i}function a(e,t,r){return c(e.center,t,r)}function l(e,t,r){switch(e?.type){case"extent":return e;case"multipoint":case"polygon":case"polyline":return e.extent;case"point":return c(e,t,r);default:return null}}function c(e,t,r){const s=e.hasZ?e.z:void 0;if(t?.map)return(null!=r?(0,i.eU)(t,r):t.extent).clone().centerAt(e).set({zmax:s,zmin:s});const{x:o,y:a,spatialReference:l}=e;return new n.A({xmin:o-.25,ymin:a-.25,xmax:o+.25,ymax:a+.25,spatialReference:l,zmin:s,zmax:s})}},47700:(e,t,r)=>{"use strict";r.d(t,{Hu:()=>a,jI:()=>f,zy:()=>u});r(81806);var i,n=r(50076),s=r(91605),o=r(13096);function a(e,t,r){const o=u(e),a=t,c=l(o,a,r);if(o){const t=s.A.deriveUnitFromSR(o,e.spatialReference).heightUnit;if(!r&&t!==o.heightUnit){const e=new n.A("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${t})`,{horizontalUnit:t});return new n.A("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:o,error:e})}}if(!function(e){return"heightModelInfo"in e&&null!=e.heightModelInfo||null!=e.spatialReference||!p(e)}(e)||c===i.Unsupported)return new n.A("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:o});switch(c){case i.Units:{const e=o?.heightUnit||"unknown",t=a?.heightUnit||"unknown",r=new n.A("layerview:incompatible-height-unit",`The vertical units of the layer (${e}) must match the vertical units of the scene (${t})`,{layerUnit:e,sceneUnit:t});return new n.A("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:o,sceneHeightModelInfo:a,error:r})}case i.HeightModel:{const e=o?.heightModel||"unknown",t=a?.heightModel||"unknown",r=new n.A("layerview:incompatible-height-model",`The height model of the layer (${e}) must match the height model of the scene (${t})`,{layerHeightModel:e,sceneHeightModel:t});return new n.A("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:o,sceneHeightModelInfo:a,error:r})}case i.CRS:{const e=o?.vertCRS||"unknown",t=a?.vertCRS||"unknown",r=new n.A("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${e}) must match the vertical datum of the scene (${t})`,{layerDatum:e,sceneDatum:t});return new n.A("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:o,sceneHeightModelInfo:a,error:r})}}return null}function l(e,t,r){if(!c(e)||!c(t))return i.Unsupported;if(null==e||null==t)return i.Ok;if(!r&&e.heightUnit!==t.heightUnit)return i.Units;if(e.heightModel!==t.heightModel)return i.HeightModel;switch(e.heightModel){case"gravity-related-height":return i.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?i.Ok:i.CRS;default:return i.Unsupported}}function c(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function u(e){if("integrated-mesh-3dtiles"===e.type)return null;const t=e.url?(0,o.qg)(e.url):void 0,r=e.spatialReference?.vcsWkid;return(null!=r||null==t||"ImageServer"!==t.serverType)&&h(e)&&e.heightModelInfo?e.heightModelInfo:p(e)?s.A.deriveUnitFromSR(g,e.spatialReference):null}function h(e){return"heightModelInfo"in e}function d(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function p(e){return d(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):m(e)}function f(e){return null!=e.layers||m(e)||d(e)||h(e)}function m(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}!function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"}(i||(i={}));const g=new s.A({heightModel:"gravity-related-height"})},65658:(e,t,r)=>{"use strict";r.d(t,{A3:()=>g,Ql:()=>_,fA:()=>p,xB:()=>s,xK:()=>v});var i=r(11352);function n(e,t){return(0,i.qz)(e,t)}function s(e,t){const r=e.hasZ&&t.hasZ;let i,n,s;if(e.xmin<=t.xmin){if(i=t.xmin,e.xmax<i)return!1}else if(i=e.xmin,t.xmax<i)return!1;if(e.ymin<=t.ymin){if(n=t.ymin,e.ymax<n)return!1}else if(n=e.ymin,t.ymax<n)return!1;if(r&&t.hasZ)if(e.zmin<=t.zmin){if(s=t.zmin,e.zmax<s)return!1}else if(s=e.zmin,t.zmax<s)return!1;return!0}function o(e,t){const{points:r,hasZ:n}=t,s=n?i.F8:i.CW;for(const i of r)if(s(e,i))return!0;return!1}const a=[0,0],l=[0,0],c=[0,0],u=[0,0],h=[a,l,c,u],d=[[c,a],[a,l],[l,u],[u,c]];function p(e,t){return function(e,t){a[0]=e.xmin,a[1]=e.ymax,l[0]=e.xmax,l[1]=e.ymax,c[0]=e.xmin,c[1]=e.ymin,u[0]=e.xmax,u[1]=e.ymin;for(const r of h)if((0,i.t1)(t,r))return!0;for(const r of t){if(!r.length)continue;let t=r[0];if((0,i.CW)(e,t))return!0;for(let n=1;n<r.length;n++){const s=r[n];if((0,i.CW)(e,s)||y(t,s,d))return!0;t=s}}return!1}(e,t.rings)}function f(e,t){a[0]=e.xmin,a[1]=e.ymax,l[0]=e.xmax,l[1]=e.ymax,c[0]=e.xmin,c[1]=e.ymin,u[0]=e.xmax,u[1]=e.ymin;const r=t.paths;for(const n of r){if(!r.length)continue;let t=n[0];if((0,i.CW)(e,t))return!0;for(let r=1;r<n.length;r++){const s=n[r];if((0,i.CW)(e,s)||y(t,s,d))return!0;t=s}}return!1}const m=[0,0];function g(e){for(let t=0;t<e.length;t++){const r=e[t];for(let n=0;n<r.length-1;n++){const i=r[n],s=r[n+1];for(let r=t+1;r<e.length;r++)for(let t=0;t<e[r].length-1;t++){const n=e[r][t],o=e[r][t+1];if(_(i,s,n,o,m)&&!(m[0]===i[0]&&m[1]===i[1]||m[0]===n[0]&&m[1]===n[1]||m[0]===s[0]&&m[1]===s[1]||m[0]===o[0]&&m[1]===o[1]))return!0}}const i=r.length;if(!(i<=4))for(let e=0;e<i-3;e++){let t=i-1;0===e&&(t=i-2);const n=r[e],s=r[e+1];for(let i=e+2;i<t;i++){const e=r[i],t=r[i+1];if(_(n,s,e,t,m)&&!(m[0]===n[0]&&m[1]===n[1]||m[0]===e[0]&&m[1]===e[1]||m[0]===s[0]&&m[1]===s[1]||m[0]===t[0]&&m[1]===t[1]))return!0}}}return!1}function y(e,t,r){for(let i=0;i<r.length;i++)if(_(e,t,r[i][0],r[i][1]))return!0;return!1}function _(e,t,r,i,n){const[s,o]=e,[a,l]=t,[c,u]=r,[h,d]=i,p=h-c,f=s-c,m=a-s,g=d-u,y=o-u,_=l-o,v=g*m-p*_;if(0===v)return!1;const b=(p*y-g*f)/v,w=(m*y-_*f)/v;return b>=0&&b<=1&&w>=0&&w<=1&&(n&&(n[0]=s+b*(a-s),n[1]=o+b*(l-o)),!0)}function v(e){switch(e){case"esriGeometryEnvelope":case"extent":return s;case"esriGeometryMultipoint":case"multipoint":return o;case"esriGeometryPoint":case"point":return n;case"esriGeometryPolygon":case"polygon":return p;case"esriGeometryPolyline":case"polyline":return f}}},19902:(e,t,r)=>{"use strict";r.d(t,{$B:()=>m,Bi:()=>p,Rg:()=>d,U9:()=>u,ZC:()=>c,fT:()=>h,rS:()=>f,xD:()=>y});var i=r(76797),n=r(89189),s=r(66388),o=r(19247),a=r(65215),l=r(23701);function c(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}function u(e){return void 0!==e.points}function h(e){return void 0!==e.x&&void 0!==e.y}function d(e){return void 0!==e.paths}function p(e){return void 0!==e.rings}function f(e){return null==e?null:e instanceof n.A?e:h(e)?o.A.fromJSON(e):d(e)?l.A.fromJSON(e):p(e)?a.A.fromJSON(e):u(e)?s.A.fromJSON(e):c(e)?i.A.fromJSON(e):null}function m(e){return e?h(e)?"esriGeometryPoint":d(e)?"esriGeometryPolyline":p(e)?"esriGeometryPolygon":c(e)?"esriGeometryEnvelope":u(e)?"esriGeometryMultipoint":null:null}const g={esriGeometryPoint:o.A,esriGeometryPolyline:l.A,esriGeometryPolygon:a.A,esriGeometryEnvelope:i.A,esriGeometryMultipoint:s.A};function y(e){return e&&g[e]||null}},88501:(e,t,r)=>{"use strict";r.d(t,{d:()=>c});var i=r(2413),n=r(65391),s=r(205),o=r(5262),a=r(65658);const l=222045e-19;function c(e){if(0===e.totalSize)return null;const t=(0,n.z8)(e);if(!t)return null;const r=4*(Math.abs(t[0])+Math.abs(t[2])+Math.abs(t[1])+Math.abs(t[3])+1)*l;let o=0,a=0;e.reset();for(let i=0;e.nextPath();i++){const t=e.getCurrentRingArea();t>a&&(a=t,o=i)}if(e.seekPath(o),0===e.pathSize)return null;e.seekPathStart();const c=(0,n.B$)(e);if(Math.abs(a)<=2*r*r)return[(c[0]+c[2])/2,(c[1]+c[3])/2];e.seekPathStart();const p=(0,s.w2)(e,(0,i.vt)());if(null===p)return null;if(e.totalPoints<4)return p;const f=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],m=[NaN,NaN,NaN,NaN],g=[NaN,NaN,NaN,NaN];let y=!1,_=h(p,e,!0);0===_.distance&&(y=!0,f[0][0]=p[0],f[0][1]=p[1],_=h(p,e,!1)),m[0]=_.distance,g[0]=0;const v=[NaN,NaN];let S=!1,T=.25,M=-1,A=NaN;do{if(A=NaN,f[1]=d(e,b(c[0],c[2],T),r,t),isNaN(f[1][0])||isNaN(f[1][1])||(_=h(f[1],e,!1),A=_.distance),!isNaN(A)&&A>r&&u(f[1],e))S=!0,m[1]=A,g[1]=w(f[1],p);else if(!isNaN(A)&&A>M&&(M=A,v[0]=f[1][0],v[1]=f[1][1]),T-=.01,T<.1){if(!(M>=0))break;S=!0,m[1]=M,f[1][0]=v[0],f[1][1]=v[1],g[1]=w(f[1],p)}}while(!S);S=!1,T=.5,M=-1;let C=.01,E=1;do{if(A=NaN,f[2]=d(e,b(c[0],c[2],T),r,t),isNaN(f[2][0])||isNaN(f[2][1])||(_=h(f[2],e,!1),A=_.distance),!isNaN(A)&&A>r&&u(f[2],e))S=!0,m[2]=A,g[2]=w(f[2],p);else if(!isNaN(A)&&A>M)M=A,v[0]=f[2][0],v[1]=f[2][1];else if(A>M&&(M=A,v[0]=f[2][0],v[1]=f[2][1]),T=.5+C*E,C+=.01,E*=-1,T<.3||T>.7){if(!(M>=0))break;S=!0,m[2]=M,f[2][0]=v[0],f[2][1]=v[1],g[2]=w(f[2],p)}}while(!S);S=!1,T=.75,M=-1;do{if(A=NaN,f[3]=d(e,b(c[0],c[2],T),r,t),isNaN(f[3][0])||isNaN(f[3][1])||(_=h(f[3],e,!1),A=_.distance),!isNaN(A)&&A>r&&u(f[3],e))S=!0,m[3]=A,g[3]=w(f[3],p);else if(A>M&&(M=A,v[0]=f[3][0],v[1]=f[3][1]),T+=.01,T>.9){if(!(M>=0))break;S=!0,m[3]=M,f[3][0]=v[0],f[3][1]=v[1],g[3]=w(f[3],p)}}while(!S);const R=[0,1,2,3],P=y?0:1;let O;for(let i=P;i<4;i++)for(let e=P;e<3;e++){const t=g[e],r=g[e+1];x(t,r)>0&&(O=R[e],R[e]=R[e+1],R[e+1]=O,g[e]=r,g[e+1]=t)}let I=P,L=0,N=0;for(let i=P;i<4;i++){switch(i){case 0:N=2*m[R[i]];break;case 1:N=1.66666666*m[R[i]];break;case 2:N=1.33333333*m[R[i]];break;case 3:N=m[R[i]]}N>L&&(L=N,I=R[i])}return f[I]}function u(e,t){let r,i,n,s,o=0;for(t.reset();t.nextPath()&&t.nextPoint();)for(r=t.x,i=t.y;t.nextPoint();r=n,i=s)n=t.x,s=t.y,i>e[1]!=s>e[1]&&((n-r)*(e[1]-i)-(s-i)*(e[0]-r)>0?o++:o--);return 0!==o}function h(e,t,r){if(r&&u(e,t))return{coord:e,distance:0};let i=1/0,n=0,s=0,a=[0,0],l=[0,0];const c=[0,0];for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(a[0]=t.x,a[1]=t.y;t.nextPoint();a=l){l=[t.x,t.y],(0,o.gR)(c,e,a,l);const r=w(e,c);r<i&&(i=r,n=c[0],s=c[1])}return{coord:[n,s],distance:Math.sqrt(i)}}function d(e,t,r,n){const s=[t,0];let o=1/0,l=1/0,c=!1,u=!1;const h=[[t,n[1]-1],[t,n[3]+1]],d=[0,0],f=[0,0],m=[0,0],g=[[0,0],[0,0]],y=(0,i.vt)();for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(g[0][0]=e.x,g[0][1]=e.y;e.nextPoint();g[0][0]=g[1][0],g[0][1]=g[1][1]){if(g[1][0]=e.x,g[1][1]=e.y,null===p(y,g))continue;if(f[0]=h[0][0],f[1]=h[0][1],m[0]=h[1][0],m[1]=h[1][1],0===_(y,f,m))continue;if(!(0,a.Ql)(h[0],h[1],g[0],g[1],d))continue;const t=d[1];o>l?t<o&&(o=t,c=!0):t<l&&(l=t,u=!0)}return c&&u?s[1]=(o+l)/2:s[0]=s[1]=NaN,s}function p(e,t){if(t.length<2)return null;e||(e=(0,i.vt)());const[r,n]=t[0],[s,o]=t[1];return e[0]=Math.min(r,s),e[1]=Math.min(n,o),e[2]=Math.max(r,s),e[3]=Math.max(n,o),e}const f=1,m=4,g=3,y=12;function _(e,t,r){let i=v(t,e),n=v(r,e);const s=e[0],o=e[1],a=e[2],l=e[3];if(i&n)return 0;if(!(i|n))return 4;const c=(i?1:0)|(n?2:0);do{const c=r[0]-t[0],u=r[1]-t[1];if(c>u)i&g?(i&f?(t[1]+=u*(s-t[0])/c,t[0]=s):(t[1]+=u*(a-t[0])/c,t[0]=a),i=v(t,e)):n&g?(n&f?(r[1]+=u*(s-r[0])/c,r[0]=s):(r[1]+=u*(a-r[0])/c,r[0]=a),n=v(r,e)):i?(i&m?(t[0]+=c*(o-t[1])/u,t[1]=o):(t[0]+=c*(l-t[1])/u,t[1]=l),i=v(t,e)):(n&m?(r[0]+=c*(o-r[1])/u,r[1]=o):(r[0]+=c*(l-r[1])/u,r[1]=l),n=v(r,e));else if(i&y?(i&m?(t[0]+=c*(o-t[1])/u,t[1]=o):(t[0]+=c*(l-t[1])/u,t[1]=l),i=v(t,e)):n&y?(n&m?(r[0]+=c*(o-r[1])/u,r[1]=o):(r[0]+=c*(l-r[1])/u,r[1]=l),n=v(r,e)):i?(i&f?(t[1]+=u*(s-t[0])/c,t[0]=s):(t[1]+=u*(a-t[0])/c,t[0]=a),i=v(t,e)):(n&f?(r[1]+=u*(s-r[0])/c,r[0]=s):(r[1]+=u*(a-r[0])/c,r[0]=a),n=v(r,e)),i&n)return 0}while(i|n);return c}function v(e,t){return(e[0]<t[0]?1:0)|(e[0]>t[2]?1:0)<<1|(e[1]<t[1]?1:0)<<2|(e[1]>t[3]?1:0)<<3}function b(e,t,r){return e+(t-e)*r}function w(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function x(e,t){if(e<t)return-1;if(e>t)return 1;if(e===t)return 0;const r=isNaN(e),i=isNaN(t);return r<i?-1:r>i?1:0}},44230:(e,t,r)=>{"use strict";r.d(t,{C:()=>c,Cr:()=>h,H6:()=>m,_I:()=>p,dz:()=>g,fA:()=>u,kb:()=>d,ld:()=>y,sd:()=>f,vt:()=>l});var i=r(15941),n=r(97467),s=r(20664),o=r(9392),a=r(75762);function l(e){return e?{origin:(0,o.o8)(e.origin),vector:(0,o.o8)(e.vector)}:{origin:(0,o.vt)(),vector:(0,o.vt)()}}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l();return u(e.origin,e.vector,t)}function u(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();return(0,s.c)(r.origin,e),(0,s.c)(r.vector,t),r}function h(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();return(0,s.c)(r.origin,e),(0,s.f)(r.vector,t,e),r}function d(e,t){const r=(0,s.f)(a.rq.get(),t,e.origin),n=(0,s.m)(e.vector,r),o=(0,s.m)(e.vector,e.vector),l=(0,i.qE)(n/o,0,1),c=(0,s.f)(a.rq.get(),(0,s.j)(a.rq.get(),e.vector,l),r);return(0,s.m)(c,c)}function p(e,t,r){return m(e,t,0,1,r)}function f(e,t,r){return(0,s.g)(r,e.origin,(0,s.j)(r,e.vector,t))}function m(e,t,r,n,o){const{vector:l,origin:c}=e,u=(0,s.f)(a.rq.get(),t,c),h=(0,s.m)(l,u)/(0,s.q)(l);return(0,s.j)(o,l,(0,i.qE)(h,r,n)),(0,s.g)(o,o,e.origin)}function g(e,t){if(_(e,function(e,t){const r=b.get();return r.origin=e,r.vector=t,r}(t.origin,t.direction),!1,v)){const{tA:t,pB:r,distance2:i}=v;if(t>=0&&t<=1)return i;if(t<0)return(0,s.a)(e.origin,r);if(t>1)return(0,s.a)((0,s.g)(a.rq.get(),e.origin,e.vector),r)}return null}function y(e,t,r){return!!_(e,t,!0,v)&&((0,s.c)(r,v.pA),!0)}function _(e,t,r,n){const o=1e-6,l=e.origin,c=(0,s.g)(a.rq.get(),l,e.vector),u=t.origin,h=(0,s.g)(a.rq.get(),u,t.vector),d=a.rq.get(),p=a.rq.get();if(d[0]=l[0]-u[0],d[1]=l[1]-u[1],d[2]=l[2]-u[2],p[0]=h[0]-u[0],p[1]=h[1]-u[1],p[2]=h[2]-u[2],Math.abs(p[0])<o&&Math.abs(p[1])<o&&Math.abs(p[2])<o)return!1;const f=a.rq.get();if(f[0]=c[0]-l[0],f[1]=c[1]-l[1],f[2]=c[2]-l[2],Math.abs(f[0])<o&&Math.abs(f[1])<o&&Math.abs(f[2])<o)return!1;const m=d[0]*p[0]+d[1]*p[1]+d[2]*p[2],g=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],y=d[0]*f[0]+d[1]*f[1]+d[2]*f[2],_=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],v=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*_-g*g;if(Math.abs(v)<o)return!1;let b=(m*g-y*_)/v,w=(m+g*b)/_;r&&(b=(0,i.qE)(b,0,1),w=(0,i.qE)(w,0,1));const x=a.rq.get(),S=a.rq.get();return x[0]=l[0]+b*f[0],x[1]=l[1]+b*f[1],x[2]=l[2]+b*f[2],S[0]=u[0]+w*p[0],S[1]=u[1]+w*p[1],S[2]=u[2]+w*p[2],n.tA=b,n.tB=w,n.pA=x,n.pB=S,n.distance2=(0,s.a)(x,S),!0}const v={tA:0,tB:0,pA:(0,o.vt)(),pB:(0,o.vt)(),distance2:0},b=new n.I((()=>l()))},77176:(e,t,r)=>{"use strict";r.d(t,{b:()=>s});var i=r(15941),n=r(38496);function s(e,t,r){const s=Array.isArray(e),u=s?e.length/t:e.byteLength/(4*t),h=s?e:new Uint32Array(e,0,u*t),d=r?.minReduction??0,p=r?.originalIndices||null,f=p?p.length:0,m=r?.componentOffsets||null;let g=0;if(m)for(let i=0;i<m.length-1;i++){const e=m[i+1]-m[i];e>g&&(g=e)}else g=u;const y=Math.floor(1.1*g)+1;(null==c||c.length<2*y)&&(c=new Uint32Array((0,i.cU)(2*y)));for(let i=0;i<2*y;i++)c[i]=0;let _=0;const v=!!m&&!!p,b=v?f:u;let w=(0,n.my)(u);const x=new Uint32Array(f),S=1.96;let T=0!==d?Math.ceil(4*S*S/(d*d)*d*(1-d)):b,M=1,A=m?m[1]:b;for(let i=0;i<b;i++){if(i===T){const e=1-_/i;if(e+S*Math.sqrt(e*(1-e)/i)<d)return null;T*=2}if(i===A){for(let e=0;e<2*y;e++)c[e]=0;if(p)for(let e=m[M-1];e<m[M];e++)x[e]=w[p[e]];A=m[++M]}const e=v?p[i]:i,r=e*t,n=l(h,r,t);let s=n%y,a=_;for(;0!==c[2*s+1];){if(c[2*s]===n){const e=c[2*s+1]-1;if(o(h,r,e*t,t)){a=w[e];break}}s++,s>=y&&(s-=y)}a===_&&(c[2*s]=n,c[2*s+1]=e+1,_++),w[e]=a}if(0!==d&&1-_/u<d)return null;if(v){for(let e=m[M-1];e<x.length;e++)x[e]=w[p[e]];w=(0,n.Dg)(x)}const C=s?new Array(_):new Uint32Array(_*t);_=0;for(let i=0;i<b;i++)w[i]===_&&(a(h,(v?p[i]:i)*t,C,_*t,t),_++);if(p&&!v){const e=new Uint32Array(f);for(let t=0;t<e.length;t++)e[t]=w[p[t]];w=(0,n.Dg)(e)}return{buffer:Array.isArray(C)?C:C.buffer,indices:w,uniqueCount:_}}function o(e,t,r,i){for(let n=0;n<i;n++)if(e[t+n]!==e[r+n])return!1;return!0}function a(e,t,r,i,n){for(let s=0;s<n;s++)r[i+s]=e[t+s]}function l(e,t,r){let i=0;for(let n=0;n<r;n++)i=e[t+n]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let c=null},26375:(e,t,r)=>{"use strict";r.d(t,{$5:()=>A,CN:()=>x,GN:()=>P,JP:()=>w,KM:()=>E,Mv:()=>L,OD:()=>N,X4:()=>S,gZ:()=>R,gr:()=>M,project:()=>z,qs:()=>C,si:()=>T,xA:()=>I});var i=r(15941),n=r(63919),s=r(44680),o=r(34761),a=r(13191),l=r(20664),c=r(9392),u=r(9624),h=r(98510),d=r(5809),p=r(45308),f=r(44815),m=r(14556),g=r(80963),y=r(45417),_=r(88105),v=r(45136),b=r(33328);const w="Projection may be possible after calling projection.load().";function x(e,t,r,i){e.error(`Failed to project from (wkid:${t.wkid}) to (wkid:${r.wkid}).${i?" ":""}${i}`)}function S(e,t,r,i,n){return k(D.TO_PCPF,_.xs.fromTypedArray(e),N.NORMAL,_.Xm.fromTypedArray(t),_.Xm.fromTypedArray(r),i,_.xs.fromTypedArray(n))?n:null}function T(e,t,r,i,n){return k(D.FROM_PCPF,_.xs.fromTypedArray(e),N.NORMAL,_.Xm.fromTypedArray(t),_.Xm.fromTypedArray(r),i,_.xs.fromTypedArray(n))?n:null}function M(e,t,r){return(0,p.projectBuffer)(e,t,0,r,(0,h.lO)(t),0,e.length/3)?r:null}function A(e,t,r){return(0,p.projectBuffer)(e,(0,h.lO)(r),0,t,r,0,e.length/3)?t:null}function C(e,t,r){return(0,n.Ge)(j,r),(0,v.t)(t,e,j),(0,i.or)(j)&&(0,v.n)(t,t),t}function E(e,t,r){return(0,n.z0)(j,r),(0,b.t)(t,e,j),(0,i.or)(j)&&(0,v.n)(t,t,4),t}function R(e,t,r,n){const s=t===N.NORMAL;return O(e,t,r,((e,t)=>{const r=Math.cos((0,i.kU)(e));t[0]=s?r:1/r,t[1]=1}),n)}function P(e,t,r,i){const n=t===N.NORMAL;return O(e,t,r,((e,t)=>{const r=Math.cosh(-e/m.$O.radius);t[0]=1,t[1]=n?r:1/r}),i)}function O(e,t,r,i,n){const s=t===N.NORMAL?3:4,o=[0,0];for(let a=0,l=1;a<e.length;a+=s,l+=3){i(r[l],o);const t=e[a]*o[0],c=e[a+1]*o[1],u=e[a+2],h=1/Math.sqrt(t*t+c*c+u*u);n[a]=t*h,n[a+1]=c*h,n[a+2]=u*h,4===s&&(n[a+3]=e[a+3])}return n}function I(e,t,r,i,n){if(!k(D.TO_PCPF,_.xs.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),N.TANGENT,_.Xm.fromTypedArray(t),_.Xm.fromTypedArray(r),i,_.xs.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let s=3;s<e.length;s+=4)n[s]=e[s];return n}function L(e,t,r,i,n){if(!k(D.FROM_PCPF,_.xs.fromTypedArray(e,16),N.TANGENT,_.Xm.fromTypedArray(t),_.Xm.fromTypedArray(r),i,_.xs.fromTypedArray(n,16)))return null;for(let s=3;s<e.length;s+=4)n[s]=e[s];return n}var N,D;function F(e,t,r,i,s){switch((0,d.l)(i,r,B,i),e===D.FROM_PCPF&&(0,o.B8)(B,B),t){case N.NORMAL:return(0,n.Ge)(s,B);case N.TANGENT:return(0,n.z0)(s,B)}}function k(e,t,r,i,n,s,o){if(!t)return;const a=i.count,c=(0,h.lO)(s);if(function(e){return e.isWGS84||(0,g.x1)(e)||(0,g.q8)(e)||(0,g.KQ)(e)}(s))for(let u=0;u<a;u++)n.getVec(u,U),t.getVec(u,V),(0,l.t)(V,V,F(e,r,U,c,j)),o.setVec(u,V);else for(let u=0;u<a;u++){n.getVec(u,U),t.getVec(u,V);const s=(0,y.jg)(i.get(u,1));let a=Math.cos(s);r===N.TANGENT!=(e===D.TO_PCPF)&&(a=1/a),F(e,r,U,c,j),e===D.TO_PCPF?(j[0]*=a,j[1]*=a,j[2]*=a,j[3]*=a,j[4]*=a,j[5]*=a):(j[0]*=a,j[3]*=a,j[6]*=a,j[1]*=a,j[4]*=a,j[7]*=a),(0,l.t)(V,V,j),(0,l.n)(V,V),o.setVec(u,V)}return o}function z(e){return"local"===e.vertexSpace.type?function(e){let{vertexSpace:t,transform:r,inSpatialReference:i,outSpatialReference:n,localMode:s,outPositions:l,positions:m}=e;const g=t.origin??c.uY,y=null!=t.origin?r?.localMatrix??a.zK:a.zK,_=(0,h.lO)(i),b=n.isWebMercator&&s||!(0,u.canProjectWithoutEngine)(i,_)?i:_;(0,d.l)(i,g,B,b),(0,o.lw)(B,B,y);const w=l??(0,f.jh)(m.length);return(0,v.a)(w,m,B),(0,p.projectBuffer)(w,b,0,w,n,0,w.length/3),w}(e):function(e){let{vertexSpace:t,transform:r,outPositions:i,positions:n,inSpatialReference:s,outSpatialReference:u}=e;const h=null!=t.origin?r?.localMatrix??a.zK:a.zK,d=i??(0,f.jh)(n.length);(0,o.aI)(h,a.zK)?(0,f.s)(d,n):(0,v.a)(d,n,h);const m=t.origin??c.uY;if(!(0,l.e)(m,c.uY)){const[e,t,r]=m;for(let i=0;i<d.length;i+=3)d[i]+=e,d[i+1]+=t,d[i+2]+=r}return(0,p.projectBuffer)(d,s,0,d,u,0,d.length/3)?d:null}(e)}!function(e){e[e.NORMAL=0]="NORMAL",e[e.TANGENT=1]="TANGENT"}(N||(N={})),function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"}(D||(D={}));const U=(0,c.vt)(),V=(0,c.vt)(),B=(0,a.vt)(),j=(0,s.vt)()},99773:(e,t,r)=>{"use strict";r.d(t,{CK:()=>d,E9:()=>u,Hq:()=>h,MW:()=>p,TE:()=>f,yJ:()=>m});var i=r(63241),n=r(76460),s=r(20664),o=r(19247),a=r(14894),l=r(5845);function c(){return n.A.getLogger("esri.geometry.Mesh")}function u(e){return!h(e)}function h(e){return null!=e.origin}function d(e){return h(e.vertexSpace)}function p(e,t){if(!h(e))return null;const[r,i,n]=e.origin;return new o.A({x:r,y:i,z:n,spatialReference:t})}function f(e,t){const{x:r,y:n,z:s,spatialReference:o}=e,u=[r,n,s??0];return void 0!==t?.geographic&&((0,i.io)(c(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),t.vertexSpace&&c().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),"local"===(t?.vertexSpace??function(e){return null==e?void 0:e?"local":"georeferenced"}(t?.geographic)??function(e){return e.isGeographic||e.isWebMercator?"local":"georeferenced"}(o))?new l.A({origin:u}):new a.A({origin:u})}function m(e,t){return e.type===t.type&&(e.origin===t.origin||null!=e.origin&&null!=t.origin&&(0,s.e)(e.origin,t.origin))}},13927:(e,t,r)=>{"use strict";r.d(t,{$Q:()=>L,C:()=>h,Cr:()=>g,Io:()=>z,LV:()=>u,O_:()=>m,Qj:()=>d,T7:()=>P,Tj:()=>I,U5:()=>E,UB:()=>f,Ui:()=>R,Z1:()=>F,_I:()=>D,b6:()=>N,ci:()=>_,fA:()=>p,gv:()=>O,jb:()=>k,lU:()=>y,mN:()=>U,mP:()=>M,mR:()=>C,vt:()=>c,ze:()=>A});var i=r(15941),n=r(20664),s=r(9392),o=(r(43047),r(96190)),a=r(75762),l=r(94966);function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B;return[e[0],e[1],e[2],e[3]]}function u(){return p(arguments.length>0&&void 0!==arguments[0]?arguments[0]:B[0],arguments.length>1&&void 0!==arguments[1]?arguments[1]:B[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:B[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:B[3],a.Km.get())}function h(e,t){return p(t[0],t[1],t[2],t[3],e)}function d(e){return e}function p(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:c();return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function f(e,t,r){return(0,n.c)(r,e),r[3]=t,r}function m(e,t,r){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function g(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c();const n=r[0]-t[0],s=r[1]-t[1],o=r[2]-t[2],a=e[0]-t[0],l=e[1]-t[1],u=e[2]-t[2],h=s*u-o*l,d=o*a-n*u,p=n*l-s*a,f=h*h+d*d+p*p,m=Math.abs(f-1)>1e-5&&f>1e-12?1/Math.sqrt(f):1;return i[0]=h*m,i[1]=d*m,i[2]=p*m,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function y(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Math.floor(r*(1/3)),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Math.floor(r*(2/3));if(r<3)return!1;t(b,i);let a=s,l=!1;for(;a<r-1&&!l;)t(w,a),a++,l=!(0,n.e)(b,w);if(!l)return!1;for(a=Math.max(a,o),l=!1;a<r&&!l;)t(x,a),a++,(0,n.f)(S,b,w),(0,n.n)(S,S),(0,n.f)(T,w,x),(0,n.n)(T,T),l=!(0,n.e)(b,x)&&!(0,n.e)(w,x)&&Math.abs((0,n.m)(S,T))<v;return l?(g(b,w,x,e),!0):(0!==i||1!==s||2!==o)&&y(e,t,r,0,1,2)}function _(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=t.length/3;return y(e,((e,r)=>(0,n.s)(e,t[3*r+0],t[3*r+1],t[3*r+2])),r?i-1:i)}const v=.99619469809,b=(0,s.vt)(),w=(0,s.vt)(),x=(0,s.vt)(),S=(0,s.vt)(),T=(0,s.vt)();function M(e,t,r){return t!==e&&h(e,t),e[3]=-(0,n.m)(e,r),e}function A(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function C(e,t,r,i){return(0,n.b)(x,t,e),m(r,x,i)}function E(e,t,r,i){return V(e,t,(0,n.f)(a.rq.get(),r,t),H,i)}function R(e,t,r){return null!=t&&V(e,t.origin,t.direction,G,r)}function P(e,t,r){return V(e,t.origin,t.vector,j.NONE,r)}function O(e,t,r){return V(e,t.origin,t.vector,j.CLAMP,r)}function I(e,t){return U(e,t)>=0}function L(e,t){const r=(0,n.m)(e,t.ray.direction),i=-U(e,t.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const s=i/r;return r>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function N(e,t){const r=(0,n.m)(e,t.ray.direction),i=-U(e,t.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const s=i/r;return r>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function D(e,t,r){const i=(0,n.j)(a.rq.get(),e,-e[3]),s=k(e,(0,n.f)(a.rq.get(),t,i),a.rq.get());return(0,n.g)(r,s,i),r}function F(e,t,r,i){const s=e,c=a.rq.get(),u=a.rq.get();(0,l.VV)(s,c,u);const h=(0,n.f)(a.rq.get(),r,t),d=(0,o.gr)(c,h),p=(0,o.gr)(u,h),f=(0,o.gr)(s,h);return(0,n.s)(i,d,p,f)}function k(e,t,r){const i=(0,n.j)(a.rq.get(),e,(0,n.m)(e,t));return(0,n.f)(r,t,i),r}function z(e,t){return Math.abs(U(e,t))}function U(e,t){return(0,n.m)(e,t)+e[3]}function V(e,t,r,s,o){const a=(0,n.m)(e,r);if(0===a)return!1;let l=-((0,n.m)(e,t)+e[3])/a;return s&j.CLAMP&&(l=(0,i.qE)(l,0,1)),!(!(s&j.INFINITE_MIN)&&l<0||!(s&j.INFINITE_MAX)&&l>1)&&((0,n.g)(o,t,(0,n.j)(o,r,l)),!0)}const B=[0,0,1,0];var j;!function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"}(j||(j={}));const H=j.INFINITE_MIN|j.INFINITE_MAX,G=j.INFINITE_MAX},12294:(e,t,r)=>{"use strict";r.d(t,{EZ:()=>o,Io:()=>s,QP:()=>l,T0:()=>a});var i=r(80963),n=r(45417);function s(e,t){const r=e.x-t.x,i=e.y-t.y,n=null!=e.z&&null!=t.z?e.z-t.z:0;return Math.sqrt(r*r+i*i+n*n)}function o(e){return l(e,c)?.[0]??null}function a(e){return l(e,c)?.[1]??null}function l(e){let{x:t,y:r,spatialReference:s}=e,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];if(s){if((0,i.K8)(s))return(0,n.tD)(t,r,o);if((0,i.EA)(s))return o[0]=t,o[1]=r,o}return null}const c=[0,0]},10294:(e,t,r)=>{"use strict";r.d(t,{S:()=>l});var i=r(15941),n=r(31633),s=r(20664),o=r(5568),a=r(13927);function l(e,t,r){const l=function(e,t,r,i){const o=(e=>!Array.isArray(e[0]))(t)?(e,r)=>t[3*e+r]:(e,r)=>t[e][r],l=i?(0,n.GA)(i)/(0,n.G9)(i):1;return(0,a.lU)(e,((e,t)=>(0,s.s)(e,o(t,0)*l,o(t,1)*l,o(t,2))),r)}(c,e,t,r)?(0,a.Qj)(c):[0,0,1];return Math.abs(l[2])>Math.cos((0,i.kU)(80))?o._.Z:Math.abs(l[1])>Math.abs(l[0])?o._.Y:o._.X}const c=(0,a.vt)()},76279:(e,t,r)=>{"use strict";r.d(t,{$X:()=>x,Gy:()=>v,P5:()=>S,SW:()=>b,Tr:()=>w,VV:()=>i});r(19902);function i(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null}function n(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:r,translate:i}=e,n=r[0]??1,s=r[1]??1;return{originPosition:"lowerLeft",scale:[n,"lowerLeft"===t?s:-s,r[2]??1,r[3]??1],translate:[i[0]??0,i[1]??0,i[2]??0,i[3]??0]}}function s(e,t){let{scale:r,translate:i}=e;return Math.round((t-i[0])/r[0])}function o(e,t){let{scale:r,translate:i}=e;return Math.round((t-i[1])/r[1])}function a(e,t){let{scale:r,translate:i}=e;return Math.round(((t??0)-i[2])/r[2])}function l(e,t){let{scale:r,translate:i}=e;return t?Math.round((t-i[3])/r[3]):0}function c(e,t){let{scale:r,translate:i}=e;return t*r[0]+i[0]}function u(e,t){let{scale:r,translate:i}=e;return t*r[1]+i[1]}function h(e,t){let{scale:r,translate:i}=e;return(t??0)*r[2]+i[2]}function d(e,t){let{scale:r,translate:i}=e;return t?t*r[3]+i[3]:0}function p(e,t){return e&&t?y:e&&!t?m:!e&&t?g:f}const f=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let n=c(e,i[0]),s=u(e,i[1]);r[0]=[n,s];const{scale:o,originPosition:a}=e,l=o[0],h="lowerLeft"===a?o[1]:-o[1];for(let c=1;c<t.length;c++){const[e,i]=t[c];n+=l*e,s+=h*i,r[c]=[n,s]}return r},m=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let n=c(e,i[0]),s=u(e,i[1]);r[0]=[n,s,h(e,i[2])];const{scale:o,originPosition:a}=e,l=o[0],d="lowerLeft"===a?o[1]:-o[1];for(let c=1;c<t.length;c++){const[i,o,a]=t[c];n+=l*i,s+=d*o,r[c]=[n,s,h(e,a)]}return r},g=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let n=c(e,i[0]),s=u(e,i[1]);r[0]=[n,s,d(e,i[2])];const{scale:o,originPosition:a}=e,l=o[0],h="lowerLeft"===a?o[1]:-o[1];for(let c=1;c<t.length;c++){const[i,o,a]=t[c];n+=l*i,s+=h*o,r[c]=[n,s,d(e,a)]}return r},y=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let n=c(e,i[0]),s=u(e,i[1]);r[0]=[n,s,h(e,i[2]),d(e,i[3])];const{scale:o,originPosition:a}=e,l=o[0],p="lowerLeft"===a?o[1]:-o[1];for(let c=1;c<t.length;c++){const[i,o,a,u]=t[c];n+=l*i,s+=p*o,r[c]=[n,s,h(e,a),d(e,u)]}return r};function _(e,t,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=t(e,r[n]);return i}function v(e,t,r){const i=n(e);return t.x=s(i,r.x),t.y=o(i,r.y),null!=r.z&&(t.z=a(i,r.z)),null!=r.m&&(t.m=l(i,r.m)),t}function b(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r?.hasZ??!1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r?.hasM??!1;if(null!=r){const o=n(e);t.points=p(i,s)(o,r.points),t.hasZ=i,t.hasM=s}return t}function w(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null!=r?.z,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null!=r?.m;if(null==r)return t;const o=n(e);return t.x=c(o,r.x),t.y=u(o,r.y),i&&(t.z=h(o,r.z)),s&&(t.m=d(o,r.m)),t}function x(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r?.hasZ??!1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r?.hasM??!1;if(null!=r){const o=n(e);t.rings=_(o,p(i,s),r.rings),t.hasZ=i,t.hasM=s}return t}function S(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r?.hasZ??!1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r?.hasM??!1;if(null!=r){const o=n(e);t.paths=_(o,p(i,s),r.paths),t.hasZ=i,t.hasM=s}return t}},95925:(e,t,r)=>{"use strict";r.d(t,{C:()=>d,Cr:()=>p,LV:()=>h,Zb:()=>y,aI:()=>u,fA:()=>f,kb:()=>m,oC:()=>g,vt:()=>l});var i=r(18690),n=r(97467),s=r(20664),o=r(9392),a=r(75762);function l(e){return e?c((0,o.o8)(e.origin),(0,o.o8)(e.direction)):c((0,o.vt)(),(0,o.vt)())}function c(e,t){return{origin:e,direction:t}}function u(e,t){return(0,i.aI)(e.origin,t.origin)&&(0,i.aI)(e.direction,t.direction)}function h(e,t){const r=_.get();return r.origin=e,r.direction=t,r}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l();return f(e.origin,e.direction,t)}function p(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();return(0,s.c)(r.origin,e),(0,s.f)(r.direction,t,e),r}function f(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();return(0,s.c)(r.origin,e),(0,s.c)(r.direction,t),r}function m(e,t){const r=(0,s.b)(a.rq.get(),(0,s.n)(a.rq.get(),e.direction),(0,s.f)(a.rq.get(),t,e.origin));return(0,s.m)(r,r)}function g(e,t,r){const i=(0,s.m)(e.direction,(0,s.f)(r,t,e.origin));return(0,s.g)(r,e.origin,(0,s.j)(r,e.direction,i)),r}function y(e,t,r,i){const n=e.direction,o=t.direction,a=(0,s.z)(v,t.origin,e.origin),l=(0,s.m)(n,o),c=(0,s.m)(o,a),u=(0,s.m)(n,a),h=(0,s.m)(n,n),d=(0,s.m)(o,o),p=(l*c+u*d)/(h*d-l*l),f=(l*u-c*h)/(h*d-l*l);return(0,s.g)(r,e.origin,(0,s.j)(v,n,p)),(0,s.g)(i,t.origin,(0,s.j)(v,o,f)),[r,i]}const _=new n.I((()=>l())),v=(0,o.vt)()},68002:(e,t,r)=>{"use strict";r.d(t,{X_:()=>o,eU:()=>c,i1:()=>a,j8:()=>l,zx:()=>u});var i=r(15941),n=r(31633);const s=96;function o(e,t){const r=t||e.extent,i=e.width,o=(0,n.GA)(r?.spatialReference);return r&&i?r.width/i*o*n.dy*s:0}function a(e,t){return e/((0,n.GA)(t)*n.dy*s)}function l(e){return e/(n.dy*s)}function c(e,t){const r=e.extent,i=e.width-(e.padding?e.padding.left+e.padding.right:0),n=a(t,r.spatialReference);return r.clone().expand(n*i/r.width)}function u(e,t,r){return function(e,t){return 0===t||(0,i.Sp)(e,t)||e<t}(e,t)&&function(e,t){return 0===t||(0,i.Sp)(e,t)||e>t}(e,r)}},80963:(e,t,r)=>{"use strict";r.d(t,{B3:()=>g,EA:()=>m,K8:()=>b,KK:()=>E,KQ:()=>M,Vp:()=>p,YX:()=>f,ZL:()=>T,aI:()=>d,ch:()=>R,d9:()=>A,fn:()=>C,jp:()=>_,oT:()=>y,q8:()=>S,r1:()=>w,tQ:()=>P,tl:()=>x,x1:()=>v});var i=r(88685),n=(r(7724),r(34038)),s=r(85996);const o=[102100,102113,3857,3785],a=[4326,...o,104905,104971],l='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',c=[-20037508.342788905,20037508.342788905],u=[-20037508.342787,20037508.342787],h={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:c,origin:u,dx:1e-5},102100:{wkTemplate:l,valid:c,origin:u,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:c,origin:u,dx:1e-5},3857:{wkTemplate:l,valid:c,origin:u,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function d(e,t){if(e===t)return!0;if(null==e||null==t)return!1;const r=e.wkid,i=t.wkid;if(null!=r||null!=i){if(r===i)return!0;if(b(e)&&b(t))return!0;const n=e.latestWkid;if(null!=n&&i===n)return!0;const s=t.latestWkid;return null!=s&&r===s}let n,s;return e.wkt2&&t.wkt2?(n=e.wkt2,s=t.wkt2):e.wkt&&t.wkt&&(n=e.wkt,s=t.wkt),!(!n||!s)&&n.toUpperCase()===s.toUpperCase()}function p(e){const t=e?.wkid;return null!=t&&t>=2e3&&h[t]||null}function f(e){if(!e)return;const{wkid:t,vcsWkid:r}=e;if(t)return r?JSON.stringify({wkid:t,vcsWkid:r}):String(t);const i=e.wkt||e.wkt2;return JSON.stringify(i?r?{wkt:i,vcsWkid:r}:{wkt:i}:{})}function m(e){if(!C(e))return!1;const{wkid:t}=e;if(t)return null==s.A[t];const r=e.wkt2||e.wkt;return!!r&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(r)}function g(e){return!(S(e)||M(e))}function y(e){return 4326===e?.wkid}function _(e){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(e)}function v(e){return e?.wkid===n.Y.CGCS2000}function b(e){const t=e?.wkid;return null!=t&&t>=2e3&&o.includes(t)}function w(e){return 32662===e?.wkid}function x(e){return e===n.Y.GCSMARS2000||e===n.Y.GCSMARS2000_SPHERE}function S(e){return x(e?.wkid)}function T(e){return e===n.Y.GCSMOON2000}function M(e){return T(e?.wkid)}function A(e){const t=e?.wkid;return null!=t&&t>=2e3&&a.includes(t)}function C(e){if(null==e)return!1;const t=e.wkid;return null!=t&&t>=2e3||null!=e.wkt2||null!=e.wkt}const E={wkid:4326,wkt:(0,i.HC)(h[4326].wkTemplate,{Central_Meridian:"0.0"})},R={wkid:102100,latestWkid:3857},P={wkid:32662}},45097:(e,t,r)=>{"use strict";r.d(t,{Fm:()=>l,Q7:()=>c});var i=r(97467),n=r(20664),s=r(9392),o=r(44230);r(75762);function a(e){return e?{p0:(0,s.o8)(e.p0),p1:(0,s.o8)(e.p1),p2:(0,s.o8)(e.p2)}:{p0:(0,s.vt)(),p1:(0,s.vt)(),p2:(0,s.vt)()}}function l(e,t,r){const i=t[0]-e[0],n=t[1]-e[1],s=r[0]-e[0],o=r[1]-e[1];return.5*Math.abs(i*o-n*s)}function c(e,t,r){return(0,n.f)(u,t,e),(0,n.f)(h,r,e),.5*(0,n.l)((0,n.b)(u,u,h))}new i.I(o.vt),new i.I((()=>a()));const u=(0,s.vt)(),h=(0,s.vt)()},99785:(e,t,r)=>{"use strict";r.d(t,{Wq:()=>i,lO:()=>h,oR:()=>d});var i,n=r(38983),s=r(5568),o=r(5262),a=r(44815),l=r(38496),c=r(10294),u=r(77176);function h(e){const t=d(e.rings,e.hasZ,i.CCW_IS_HOLE,e.spatialReference),r=new Array;let s=0,o=0;for(const i of t.polygons){const e=i.count,c=i.index,u=(0,a.l5)(t.position,3*c,3*e),h=i.holeIndices.map((e=>e-c)),d=(0,l.Dg)((0,n.e)(u,h,3));r.push({position:u,faces:d}),s+=u.length,o+=d.length}const c=function(e,t,r){if(1===e.length)return e[0];const i=(0,a.jh)(t),n=new Array(r);let s=0,o=0,c=0;for(const a of e){for(let e=0;e<a.position.length;e++)i[s++]=a.position[e];for(const e of a.faces)n[o++]=e+c;c=s/3}return{position:i,faces:(0,l.Dg)(n)}}(r,s,o),h=Array.isArray(c.position)?(0,u.b)(c.position,3,{originalIndices:c.faces}):(0,u.b)(c.position.buffer,6,{originalIndices:c.faces});return c.position=(0,a.xm)(new Float64Array(h.buffer)),c.faces=h.indices,c}function d(e,t,r,n){const s=e.length,o=new Array(s),l=new Array(s),c=new Array(s);let u=0;for(let i=0;i<s;++i)u+=e[i].length;let h=0,d=0,m=0;const g=(0,a.jh)(3*u);let y=0;for(let a=s-1;a>=0;a--){const u=e[a],_=r===i.CCW_IS_HOLE&&f(u,t,n);if(_&&1!==s)o[h++]=u;else{let e=u.length;for(let t=0;t<h;++t)e+=o[t].length;const r={index:y,pathLengths:new Array(h+1),count:e,holeIndices:new Array(h)};r.pathLengths[0]=u.length,u.length>0&&(c[m++]={index:y,count:u.length}),y=_?p(u,u.length-1,-1,g,y,u.length,t):p(u,0,1,g,y,u.length,t);for(let i=0;i<h;++i){const e=o[i];r.holeIndices[i]=y,r.pathLengths[i+1]=e.length,e.length>0&&(c[m++]={index:y,count:e.length}),y=p(e,0,1,g,y,e.length,t)}h=0,r.count>0&&(l[d++]=r)}}for(let i=0;i<h;++i){const e=o[i];e.length>0&&(c[m++]={index:y,count:e.length}),y=p(e,0,1,g,y,e.length,t)}return l.length=d,c.length=m,{position:g,polygons:l,outlines:c}}function p(e,t,r,i,n,s,o){n*=3;for(let a=0;a<s;++a){const s=e[t];i[n++]=s[0],i[n++]=s[1],i[n++]=o?s[2]:0,t+=r}return n/3}function f(e,t,r){if(!t)return!(0,o.$3)(e);const i=e.length-1;switch((0,c.S)(e,i,r)){case s._.X:return!(0,o.$3)(e,s._.Y,s._.Z);case s._.Y:return!(0,o.$3)(e,s._.X,s._.Z);case s._.Z:return!(0,o.$3)(e,s._.X,s._.Y)}}!function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"}(i||(i={}))},31608:(e,t,r)=>{"use strict";r.d(t,{Y:()=>s,g:()=>n});var i=r(45802);const n=(0,i.O)()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),s=(0,i.O)()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"})},96190:(e,t,r)=>{"use strict";r.d(t,{EJ:()=>c,_I:()=>o,g7:()=>l,gr:()=>a});var i=r(15941),n=r(20664),s=r(9392);function o(e,t,r){const i=(0,n.m)(e,t)/(0,n.m)(e,e);return(0,n.j)(r,e,i)}function a(e,t){return(0,n.m)(e,t)/(0,n.l)(e)}function l(e,t){const r=(0,n.m)(e,t)/((0,n.l)(e)*(0,n.l)(t));return-(0,i.XM)(r)}function c(e,t,r){(0,n.n)(u,e),(0,n.n)(h,t);const s=(0,n.m)(u,h),o=(0,i.XM)(s),a=(0,n.b)(u,u,h);return(0,n.m)(a,r)<0?2*Math.PI-o:o}const u=(0,s.vt)(),h=(0,s.vt)()},75762:(e,t,r)=>{"use strict";r.d(t,{Rc:()=>f,J8:()=>m,oG:()=>h,rq:()=>d,Km:()=>p});r(81806);var i=r(77944),n=r(44680),s=r(13191),o=r(4336),a=r(72745),l=r(9392),c=r(55855);class u{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return 0===this._itemsPtr&&(0,i.d)((()=>this._reset())),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new u(a.vt)}static createVec3f64(){return new u(l.vt)}static createVec4f64(){return new u(c.vt)}static createMat3f64(){return new u(n.vt)}static createMat4f64(){return new u(s.vt)}static createQuatf64(){return new u(o.vt)}get test(){}}const h=u.createVec2f64(),d=u.createVec3f64(),p=u.createVec4f64(),f=(u.createMat3f64(),u.createMat4f64()),m=u.createQuatf64()},45417:(e,t,r)=>{"use strict";r.d(t,{Cv:()=>y,Gh:()=>b,ci:()=>w,je:()=>_,jg:()=>d,tD:()=>v,y7:()=>g,yw:()=>h});var i=r(53084),n=r(13312),s=r(14556),o=r(80963);const a=57.29577951308232,l=.017453292519943;function c(e){return e*a}function u(e){return e*l}function h(e){return e/s.$O.radius}function d(e){return Math.PI/2-2*Math.atan(Math.exp(-e/s.$O.radius))}function p(e){return null!=e.wkid||null!=e.wkt}const f=[0,0];function m(e,t,r,i,n){const s=e,o=n;if(o.spatialReference=r,"x"in s&&"x"in o)[o.x,o.y]=t(s.x,s.y,f,i);else if("xmin"in s&&"xmin"in o)[o.xmin,o.ymin]=t(s.xmin,s.ymin,f,i),[o.xmax,o.ymax]=t(s.xmax,s.ymax,f,i);else if("paths"in s&&"paths"in o||"rings"in s&&"rings"in o){const e="paths"in s?s.paths:s.rings,r=[];let n;for(let s=0;s<e.length;s++){const o=e[s];n=[],r.push(n);for(let e=0;e<o.length;e++)n.push(t(o[e][0],o[e][1],[0,0],i)),o[e].length>2&&n[e].push(o[e][2]),o[e].length>3&&n[e].push(o[e][3])}"paths"in o?o.paths=r:o.rings=r}else if("points"in s&&"points"in o){const e=s.points,r=[];for(let n=0;n<e.length;n++)r[n]=t(e[n][0],e[n][1],[0,0],i),e[n].length>2&&r[n].push(e[n][2]),e[n].length>3&&r[n].push(e[n][3]);o.points=r}return n}function g(e,t){const r=e&&(p(e)?e:e.spatialReference),i=t&&(p(t)?t:t.spatialReference);return!(e&&"type"in e&&"mesh"===e.type||t&&"type"in t&&"mesh"===t.type||!r||!i)&&(!!(0,o.aI)(i,r)||(0,o.K8)(i)&&(0,o.oT)(r)||(0,o.K8)(r)&&(0,o.oT)(i))}function y(e,t){if(null==e)return null;const r=e.spatialReference,s=t&&(p(t)?t:t.spatialReference);return g(r,s)?(0,o.aI)(r,s)?(0,i.o8)(e):(0,o.K8)(s)?m(e,_,n.A.WebMercator,!1,(0,i.o8)(e)):(0,o.oT)(s)?m(e,v,n.A.WGS84,!1,(0,i.o8)(e)):null:null}function _(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0];t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const i=u(t);return r[0]=u(e)*s.$O.radius,r[1]=s.$O.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function v(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=c(e/s.$O.radius);return r[0]=i?n:n-360*Math.floor((n+180)/360),r[1]=c(Math.PI/2-2*Math.atan(Math.exp(-t/s.$O.radius))),r}function b(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,i.o8)(e);return m(e,_,n.A.WebMercator,t,r)}function w(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,i.o8)(e);return m(e,v,n.A.WGS84,t,r)}},64867:(e,t,r)=>{"use strict";function i(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{hasM:i,hasZ:n}=e;Array.isArray(t)?4!==t.length||i||n?3===t.length&&r&&!i?(n=!0,i=!1):3===t.length&&i&&n&&(i=!1,n=!1):(i=!0,n=!0):(n=!n&&t.hasZ&&(!i||t.hasM),i=!i&&t.hasM&&(!n||t.hasZ)),e.hasZ=n,e.hasM=i}r.d(t,{h:()=>i})},86729:(e,t,r)=>{"use strict";r.d(t,{N:()=>o});var i=r(31633),n=r(34111),s=r(80963);function o(e,t,r){if(null==t||null==r||r.vcsWkid||(0,s.aI)(t,r)||(0,n.xP)(t)||(0,n.xP)(r))return null;const o=(0,i.G9)(t)/(0,i.G9)(r);if(1===o)return null;switch(e){case"point":case"esriGeometryPoint":return e=>function(e,t){null!=e?.z&&(e.z*=t)}(e,o);case"polyline":case"esriGeometryPolyline":return e=>function(e,t){if(e)for(const r of e.paths)for(const e of r)e.length>2&&(e[2]*=t)}(e,o);case"polygon":case"esriGeometryPolygon":return e=>function(e,t){if(e)for(const r of e.rings)for(const e of r)e.length>2&&(e[2]*=t)}(e,o);case"multipoint":case"esriGeometryMultipoint":return e=>function(e,t){if(e)for(const r of e.points)r.length>2&&(r[2]*=t)}(e,o);case"extent":case"esriGeometryEnvelope":return e=>function(e,t){e&&null!=e.zmin&&null!=e.zmax&&(e.zmin*=t,e.zmax*=t)}(e,o);default:return null}}},11265:(e,t,r)=>{"use strict";r(65256),r(50265),r(39348),r(38042);var i=r(63860),n=r(3825),s=r(50076);async function o(e){if(null!=l.fetchBundleAsset)return l.fetchBundleAsset(e);const t=await(0,n.A)(e,{responseType:"text"});return JSON.parse(t.data)}class a{constructor(e){let t,{base:r="",pattern:i,location:n=new URL(window.location.href)}=e;t="string"==typeof n?e=>new URL(e,new URL(n,window.location.href)).href:n instanceof URL?e=>new URL(e,n).href:n,this.pattern="string"==typeof i?new RegExp(`^${i}`):i,this.getAssetUrl=t,r=r?r.endsWith("/")?r:r+"/":"",this.matcher=new RegExp(`^${r}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,t){return async function(e,t,r,n){const a=t.exec(r);if(!a)throw new s.A("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${t}"`);const l=a[1]?`${a[1]}/`:"",c=a[2],u=(0,i.xO)(n),h=`${l}${c}.json`,d=u?`${l}${c}_${u}.json`:h;let p;try{p=await o(e(d))}catch(f){if(d===h)throw new s.A("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:f});try{p=await o(e(h))}catch(f){throw new s.A("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:f})}}return p}(this.getAssetUrl,this.matcher,e,t)}}const l={};var c=r(28899);(0,i.ao)(function(e){return new a(e)}({pattern:"esri/",location:c.s}))},65256:(e,t,r)=>{"use strict";r.d(t,{Ey:()=>E,F8:()=>C,J2:()=>T,Yq:()=>M,_v:()=>b,iS:()=>A,wj:()=>R});var i=r(45802),n=r(38042),s=r(67478),o=r(24241);const a={year:void 0,month:void 0,day:void 0,weekday:void 0},l={hour:void 0,minute:void 0,second:void 0},c={timeZone:s.n$},u={year:"numeric",month:"numeric",day:"numeric"},h={year:"numeric",month:"long",day:"numeric"},d={year:"numeric",month:"short",day:"numeric"},p={year:"numeric",month:"long",weekday:"long",day:"numeric"},f={hour:"numeric",minute:"numeric"},m={...f,second:"numeric"},g={hourCycle:"h23"},y={...f,...g},_={...m,...g},v={"short-date":u,"short-date-short-time":{...u,...f},"short-date-short-time-24":{...u,...y},"short-date-long-time":{...u,...m},"short-date-long-time-24":{...u,..._},"short-date-le":u,"short-date-le-short-time":{...u,...f},"short-date-le-short-time-24":{...u,...y},"short-date-le-long-time":{...u,...m},"short-date-le-long-time-24":{...u,..._},"long-month-day-year":h,"long-month-day-year-short-time":{...h,...f},"long-month-day-year-short-time-24":{...h,...y},"long-month-day-year-long-time":{...h,...m},"long-month-day-year-long-time-24":{...h,..._},"day-short-month-year":d,"day-short-month-year-short-time":{...d,...f},"day-short-month-year-short-time-24":{...d,...y},"day-short-month-year-long-time":{...d,...m},"day-short-month-year-long-time-24":{...d,..._},"long-date":p,"long-date-short-time":{...p,...f},"long-date-short-time-24":{...p,...y},"long-date-long-time":{...p,...m},"long-date-long-time-24":{...p,..._},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":f,"long-time":m},b=(0,i.O)()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),w={ar:"ar-u-nu-latn-ca-gregory"};let x=new WeakMap;const S=v["short-date-short-time"];function T(e){return v[e]}function M(e){return function(e){let t=x.get(e);if(!t){const r=(0,n.JK)(),i=w[r]||r,o=R(e.timeZone??s.qU),a={...e,timeZone:o};t=new Intl.DateTimeFormat(i,a),x.set(e,t)}return t}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:S).format(e)}function A(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S;return M(new Date(e),{...t,...c,...l})}function C(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S;return M(new Date(`1970-01-01T${e}Z`),{...t,...c,...a})}function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S;if(t.timeZone)return M(new Date(e),t);const r=o.c9.fromISO(e,{setZone:!0}),i=(0,n.JK)(),a=w[i]??i,l=0===r.offset?s.n$:t.timeZone,c={...t,timeZone:l};return r.toLocaleString(c,{locale:a})}function R(e){switch(e){case s.qU:return s.N5;case s.L5:return s.n$;default:return e}}(0,n.Ml)((()=>{x=new WeakMap}))},38042:(e,t,r)=>{"use strict";r.d(t,{JK:()=>l,Ml:()=>p,Z0:()=>c,oQ:()=>h});var i=r(54901);let n,s;const o=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale;function a(){return o??globalThis.navigator?.language??"en"}function l(){return void 0===s&&(s=a()),s}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l();const t=/^([a-zA-Z]{2,3})(?:[_-]\w+)*$/.exec(e);return t?.[1].toLowerCase()}const u=[];function h(e){return u.push(e),(0,i.hA)((()=>u.splice(u.indexOf(e),1)))}const d=[];function p(e){return d.push(e),(0,i.hA)((()=>d.splice(d.indexOf(e),1)))}function f(){const e=n??a();s!==e&&([...d].forEach((t=>t(e))),s=e,[...u].forEach((t=>t(e))))}globalThis.addEventListener?.("languagechange",f)},63860:(e,t,r)=>{"use strict";r.d(t,{ao:()=>p,ud:()=>f,xO:()=>m});var i=r(50076),n=r(54901),s=r(50346),o=r(38042);const a=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,l={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function c(e){return e in l}const u=[],h=new Map;function d(e){for(const t of h.keys())g(e.pattern,t)&&h.delete(t)}function p(e){return u.includes(e)||(d(e),u.unshift(e)),(0,n.hA)((()=>{const t=u.indexOf(e);t>-1&&(u.splice(t,1),d(e))}))}async function f(e){const t=(0,o.JK)();h.has(e)||h.set(e,async function(e,t){const r=[];for(const i of u)if(g(i.pattern,e))try{return await i.fetchMessageBundle(e,t)}catch(n){r.push(n)}if(r.length)throw new i.A("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:r});throw new i.A("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}(e,t));const r=h.get(e);return r&&await y.add(r),r}function m(e){if(!a.test(e))return null;const t=a.exec(e);if(null===t)return null;const[,r,i]=t,n=r+(i?"-"+i.toUpperCase():"");return c(n)?n:c(r)?r:null}function g(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}(0,o.Ml)((()=>{h.clear()}));const y=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then((()=>this._decrease()),(()=>this._decrease())),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=(0,s.Tw)())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}}},50265:(e,t,r)=>{"use strict";r.d(t,{$J:()=>u,ZV:()=>c,yx:()=>l});var i=r(38042);const n={ar:"ar-u-nu-latn"};let s=new WeakMap,o={};function a(e){const t=e||o;if(!s.has(t)){const r=(0,i.JK)(),o=n[(0,i.JK)()]||r;s.set(t,new Intl.NumberFormat(o,e))}return s.get(t)}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={};return null!=e.digitSeparator&&(t.useGrouping=e.digitSeparator),null!=e.places&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function c(e,t){return Object.is(e,-0)&&(e=0),a(t).format(e)}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,i.JK)();if(!e)return null;let r=h.get(t);if(!r){const e=a().formatToParts(12345.6),i=[...a({useGrouping:!1}).format(9876543210)].reverse(),n=new Map(i.map(((e,t)=>[e,t]))),s=new RegExp(`[${e.find((e=>"group"===e.type))?.value}]`,"g"),o=new RegExp(`[${e.find((e=>"decimal"===e.type))?.value}]`),l=new RegExp(`[${i.join("")}]`,"g"),c=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,u=/[-\u2212\u2013\u2014\u2015]/g;r=e=>{if(""===(e=e.trim().replaceAll(s,"").replace(o,".").replace(l,(e=>String(n.get(e)))).replaceAll(c,"").replaceAll(u,"-")))return null;const t=Number(e);return isNaN(t)?null:t},h.set(t,r)}return r(e)}(0,i.Ml)((()=>{s=new WeakMap,o={}}));const h=new Map},39348:(e,t,r)=>{"use strict";r.d(t,{V:()=>c});var i=r(76460),n=r(48611),s=r(88685),o=r(65256),a=r(50265);const l=()=>i.A.getLogger("esri.intl.substitute");function c(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{format:i={}}=r;return(0,s.HC)(e,(e=>function(e,t,r){let i,s;const o=e.indexOf(":");if(-1===o?i=e.trim():(i=e.slice(0,o).trim(),s=e.slice(o+1).trim()),!i)return"";const a=(0,n.wc)(i,t);if(null==a)return"";const l=(s?r?.[s]:null)??r?.[i];return l?u(a,l):s?h(a,s):d(a)}(e,t,i)))}function u(e,t){switch(t.type){case"date":return(0,o.Yq)(e,t.intlOptions);case"number":return(0,a.ZV)(e,t.intlOptions);default:return l().warn("missing format descriptor for key {key}"),d(e)}}function h(e,t){switch(t.toLowerCase()){case"dateformat":return(0,o.Yq)(e);case"numberformat":return(0,a.ZV)(e);default:return l().warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?(0,o.Yq)(e):/^numberformat/i.test(t)?(0,a.ZV)(e):d(e)}}function d(e){switch(typeof e){case"string":return e;case"number":return(0,a.ZV)(e);case"boolean":return""+e;default:return e instanceof Date?(0,o.Yq)(e):""}}},55171:(e,t,r)=>{"use strict";r.d(t,{Aq:()=>l,Y3:()=>c,id:()=>o,ol:()=>a,rE:()=>s});var i=r(81806),n=r(90534);Symbol.dispose??=Symbol("Symbol.dispose"),Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");const s="4.30";let o,a=s;function l(e){o=e}function c(e){const t=o?.findCredential(e);return t?.token?(0,n.rs)(e,"token",t.token):e}a="4.30.9",(0,i.A)("host-webworker")},38451:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Le});var i=r(35143),n=r(16868),s=(r(63844),r(14873),r(47662),r(72690),r(86946),r(71832),r(5766),r(35039),r(86616)),o=r(31382),a=r(3825),l=r(95444),c=r(69098),u=r(19276),h=r(50076),d=r(53084),p=r(76460),f=r(77717),m=r(48611),g=r(50346),y=r(34154),_=r(90534),v=r(46053),b=r(21403),w=r(28379),x=r(85842),S=r(17707),T=r(80979),M=r(44527),A=r(13312),C=r(25515),E=(r(35238),r(39356)),R=r(81806),P=r(49304),O=r(91291),I=r(16783),L=r(40565),N=(r(47249),r(29101)),D=r(10290),F=r(57831),k=r(77725),z=r(76797),U=r(65215),V=r(31608);let B=0,j=class extends(P.A.LoadableMixin((0,O.g)(u.A))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}get _workerGeometryType(){const e=this.layer?.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then((()=>this._applyEdits(e)))}openPorts(){return this.load().then((()=>this._connection.openPorts()))}async queryFeatures(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);(0,F.q)(e,this.layer.spatialReference,r);const i=k.A.fromJSON(r);if(!this._requiresClientGraphicMapping())return i;const n=this.layer.objectIdField;for(const s of i.features){const e=s.attributes[n],t=this._idToClientGraphic.get(e);t&&(s.geometry=t.geometry)}return i.geometryType=this.layer.geometryType,i}async queryFeaturesJSON(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._requiresClientGraphicMapping())throw new h.A("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return(0,F.q)(e,this.layer.spatialReference,r),r}queryFeatureCount(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.load(t).then((()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t)))}queryObjectIds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.load(t).then((()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t)))}queryExtent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.load(t).then((()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t))).then((e=>({count:e.count,extent:z.A.fromJSON(e.extent)})))}querySnapping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.load(t).then((()=>this._connection.invoke("querySnapping",e,t)))}async _applyEdits(e){if(!this._connection)throw new h.A("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let r=null;const i=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const s=e=>"objectId"in e&&null!=e.objectId?e.objectId:"attributes"in e&&null!=e.attributes[t]?e.attributes[t]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const c of e.deleteFeatures){const e=s(c);null!=e&&i.push(e)}const o=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures)for(const c of e.updateFeatures)if(n.push(this._serializeFeature(c)),o){const e=s(c);null!=e&&o.set(e,c)}(0,D.u)(r?r.features:null,n,this.layer.spatialReference);const{fullExtent:a,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:n,deletes:i});return this.fullExtent=a,r&&r.finish(l.uidToObjectId),this._updateClientGraphicIds(o,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if("mesh"!==this._layerOrSourceGeometryType||null==e)return;const r=[];for(const{geometry:i}of e)null==i||"mesh"!==i.type||i.hasExtent||i.loaded||r.push(i.load({signal:t}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const r of t.updateResults){if(!r.success)continue;const t=e.get(r.objectId);null!=t&&this._addIdToClientGraphic(t)}for(const e of t.deleteResults)e.success&&this._idToClientGraphic.delete(e.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new h.A("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,r=new Array(e.length);let i=null;for(let s=0;s<e.length;s++){const n=e[s],o=this._serializeFeature(n);i||null==n.geometry||(i=n.geometry.type),r[s]=o,t.set(`${o.uid}`,n)}const n=this;return{features:r,inferredGeometryType:i,finish(e){const r=n.sourceJSON.objectIdField;for(const i in e){const s=e[i],o=t.get(i);o&&(o.attributes||(o.attributes={}),-1===s?delete o.attributes[r]:o.attributes[r]=s,n._addIdToClientGraphic(o))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,r=e.attributes?.[t];null!=r&&this._idToClientGraphic.set(r,e)}get _layerOrSourceGeometryType(){return this.layer?.geometryType??this.sourceJSON?.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return"mesh"===e||"multipatch"===e||"extent"===e}_serializeFeature(e){const{attributes:t}=e,r=this._geometryForSerialization(e),i=(B++).toString();return r?{uid:i,geometry:r.toJSON(),attributes:t}:{uid:i,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return null==t?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?U.A.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await(0,I.ho)("MemorySourceWorker",{strategy:(0,R.A)("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{fields:t,spatialReference:r,objectIdField:i,hasM:n,hasZ:s,timeInfo:o,dateFieldsTimeZone:a}=this.layer,l="defaults"===this.layer.originOf("spatialReference");await this._prepareClientMapping(this.items,e);const c=this._prepareAddFeatures(this.items);this.addHandles(this.on("before-changes",(e=>{p.A.getLogger(this).error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),e.preventDefault()})));const u={features:c.features,fields:t?.map((e=>e.toJSON())),geometryType:V.Y.toJSON(this._workerGeometryType),hasM:"mesh"!==this._layerOrSourceGeometryType&&n,hasZ:"mesh"===this._layerOrSourceGeometryType||s,objectIdField:i,spatialReference:l?null:r&&r.toJSON(),timeInfo:o?.toJSON()??null,dateFieldsTimeZone:a},h=await this._connection.invoke("load",u,{signal:e});for(const f of h.warnings)p.A.getLogger(this.layer).warn("#load()",`${f.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:f});h.featureErrors.length&&p.A.getLogger(this.layer).warn("#load()",`Encountered ${h.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:h.featureErrors});const d=h.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(c.inferredGeometryType)&&(d.geometryType=V.Y.toJSON(c.inferredGeometryType)),this.sourceJSON=d,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),c.finish(h.assignedObjectIds)}};(0,i._)([(0,N.u)({Type:E.A,ensureType:(0,L.dp)(E.A)})],j.prototype,"itemType",void 0),(0,i._)([(0,v.MZ)()],j.prototype,"type",void 0),(0,i._)([(0,v.MZ)({constructOnly:!0})],j.prototype,"layer",void 0),(0,i._)([(0,v.MZ)({readOnly:!0})],j.prototype,"_workerGeometryType",null),(0,i._)([(0,v.MZ)()],j.prototype,"sourceJSON",void 0),j=(0,i._)([(0,x.$)("esri.layers.graphics.sources.MemorySource")],j);var H=r(12406),G=r(19502),Z=r(65624),$=r(31362),q=r(61979),W=r(74440),Y=r(67187),X=r(52908),J=r(11270),K=r(37534),Q=r(94729),ee=r(91967);let te=class extends ee.A{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};(0,i._)([(0,v.MZ)()],te.prototype,"updating",void 0),(0,i._)([(0,v.MZ)()],te.prototype,"status",void 0),te=(0,i._)([(0,x.$)("esri.layers.support.PublishingInfo")],te);const re=te,ie=Symbol();const ne=e=>{var t;let r=class extends e{constructor(){super(...arguments),this[t]=!0}get publishingInfo(){if(this.destroyed)return null;const e=this._get("publishingInfo");if(e)return e;const t=new re;return this._checkPublishingStatus(t),t}_checkPublishingStatus(e){let t=0;const i=async s=>{let o;e.updating=!0;try{o=await this.fetchPublishingStatus()}catch(r){o="unavailable"}"published"!==o&&"unavailable"!==o||("publishing"===e.status&&this.refresh(),n.remove()),e.status=o,e.updating=!1,n.removed||(t=setTimeout(i,s,s+125))},n={removed:!1,remove(){this.removed=!0,clearTimeout(t)}};this.when().catch((()=>n.remove())),i(250),this.addHandles(n)}};return t=ie,(0,i._)([(0,v.MZ)({readOnly:!0,clonable:!1})],r.prototype,"publishingInfo",null),r=(0,i._)([(0,x.$)("esri.layers.mixins.PublishableLayer")],r),r};var se=r(21617),oe=r(5682),ae=r(78817),le=r(13096),ce=r(95363),ue=r(91447),he=r(15427),de=r(91485),pe=r(76350),fe=r(53430),me=r(71401),ge=r(27937),ye=r(44141),_e=r(83982),ve=r(38278),be=r(89551),we=r(81589),xe=r(68295),Se=r(58672),Te=r(30973),Me=r(61701),Ae=r(2183);const Ce="FeatureLayer";function Ee(e,t){return new h.A("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function Re(e){return e&&e instanceof u.A}const Pe=(0,pe.p)();function Oe(e,t,r){const i=!!r?.writeLayerSchema;return{enabled:i,ignoreOrigin:i}}let Ie=class extends((0,Y.j)((0,X.J)((0,W.F)(ne((0,q.w6)((0,Z.dM)((0,K.f)((0,ae.e)((0,oe.j)((0,se.J)((0,G.b)((0,J.q)((0,Q.A)((0,f.P)((0,$.d)((0,H.p)((0,c.O)(C.A)))))))))))))))))){constructor(){super(...arguments),this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.resourceInfo=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=A.A.WGS84,this.subtypeCode=null,this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0,this._debouncedSaveOperations=(0,g.sg)((async(e,t,i)=>{const{save:n,saveAs:s}=await r.e(765).then(r.bind(r,10765));switch(e){case Me.X.SAVE:return n(this,t);case Me.X.SAVE_AS:return s(this,i,t)}}))}destroy(){this.source?.destroy()}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=null!=e?e.signal:null;if(this.portalItem?.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(t).then((e=>this.initLayerProperties(e)))),Promise.resolve(this);const r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},e).catch(g.QP).then((async()=>{if(this.url&&null==this.layerId&&/FeatureServer|MapServer\/*$/i.test(this.url)){const e=await this._fetchFirstValidLayerId(t);null!=e&&(this.layerId=e)}if(!this.url&&!this._hasMemorySource())throw new h.A("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(t))})).then((()=>(0,ue.VA)(this,"load",e)));return this.addResolvingPromise(r),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,(0,ye.S)(t,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities?.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,r){return this._readEditingEnabled(t,!0,r)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,r,i){this._writeEditingEnabled(e,t,!0,i)}get effectiveEditingEnabled(){return(0,ue.C$)(this)}readIsTable(e,t){return"Table"===(t=t?.layerDefinition??t).type||!t.geometryType}writeIsTable(e,t,r,i){i?.writeLayerSchema&&(0,m.sM)(r,e?"Table":"Feature Layer",t)}readGlobalIdField(e,t){return(0,ue.jD)(t.layerDefinition||t)}readObjectIdField(e,t){return(0,ue.Zm)(t.layerDefinition||t)}get parsedUrl(){const e=(0,_.An)(this.url);return null!=e&&(null!=this.dynamicDataSource?e.path=(0,_.fj)(e.path,"dynamicLayer"):null!=this.layerId&&(e.path=(0,_.fj)(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){(0,fe.yp)(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,r){t=t.layerDefinition||t;const i=t.drawingInfo?.renderer;if(i){const e=(0,s.L)(i,t,r)??void 0;return e||p.A.getLogger(this).error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:r}),e}return(0,ue.PD)(t,r)}set source(e){const t=this._get("source");t!==e&&(Re(t)&&this._resetMemorySource(t),Re(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof u.A?new j({layer:this,items:e}):e:null}readSource(e,t){const r=k.A.fromJSON(t.featureSet);return new j({layer:this,items:r?.features??[]})}readTemplates(e,t){const r=t.editFieldsInfo,i=r?.creatorField,n=r?.editorField;return e=e?.map((e=>he.A.fromJSON(e))),this._fixTemplates(e,i),this._fixTemplates(e,n),e}readTitle(e,t){const r=t.layerDefinition?.name??t.name,i=t.title||t.layerDefinition?.title;if(r){const e=this.portalItem?.title;if("item-title"===this.sublayerTitleMode)return this.url?(0,le.yG)(this.url,r):r;let t=r;if(!t&&this.url){const e=(0,le.qg)(this.url);null!=e&&(t=e.title)}if(!t)return;return"item-title-and-service-name"===this.sublayerTitleMode&&e&&e!==t&&(t=e+" - "+t),(0,le.cr)(t)}if("item-title"===this.sublayerTitleMode&&i)return i}readTitleFromWebMap(e,t){return t.title||t.layerDefinition?.name}readTypeIdField(e,t){let r=(t=t.layerDefinition||t).typeIdField;if(r&&t.fields){r=r.toLowerCase();const e=t.fields.find((e=>e.name.toLowerCase()===r));e&&(r=e.name)}return r}readTypes(e,t){e=(t=t.layerDefinition||t).types;const r=t.editFieldsInfo,i=r?.creatorField,n=r?.editorField;return e?.map((e=>(e=de.A.fromJSON(e),this._fixTemplates(e.templates,i),this._fixTemplates(e.templates,n),e)))}readVisible(e,t){return null!=t.layerDefinition?.defaultVisibility?!!t.layerDefinition.defaultVisibility:null!=t.visibility?!!t.visibility:void 0}async addAttachment(e,t){return(0,ue.Xl)(this,e,t,Ce)}async updateAttachment(e,t,r){return(0,ue.bt)(this,e,t,r,Ce)}async applyEdits(e,t){return(0,ue.ct)(this,e,t)}async uploadAssets(e,t){return(0,ue.rn)(this,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return(0,Te.tn)(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:t}=await(0,g.qr)(Promise.all([r.e(9122),r.e(982),r.e(9078)]).then(r.bind(r,89078)),e);return new t({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:e})}createQuery(){const e=(0,ue.VZ)(this);e.dynamicDataSource=this.dynamicDataSource;const t=null!=this.subtypeCode?`${this.subtypeField} = ${this.subtypeCode}`:null,r=(0,y.m)(this.definitionExpression,t);return e.where=r||"1=1",e}async deleteAttachments(e,t){return(0,ue.mm)(this,e,t,Ce)}async fetchRecomputedExtents(e){return(0,ue.WP)(this,e,Ce)}getFeatureType(e){return(0,ue.xd)(this.types,this.typeIdField,e)}getFieldDomain(e,t){const r=t?.feature,i=(0,ue.Nv)(this,r);if(i){const t=i.domains?.[e];return"inherited"===t?.type?this._getLayerDomain(e):t}const n=this.getFeatureType(r);if(n){const t=n.domains&&n.domains[e];if(t&&"inherited"!==t.type)return t}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,t){return(0,ue.lV)(this,e,t,Ce)}async queryFeatures(e,t){const r=await this.load(),i=await r.source.queryFeatures(xe.A.from(e)??r.createQuery(),t);if(i?.features)for(const n of i.features)n.layer=n.sourceLayer=r;return i}async queryObjectIds(e,t){return(0,ue.sg)(this,e,t,Ce)}async queryFeatureCount(e,t){return(0,ue.Ye)(this,e,t,Ce)}async queryExtent(e,t){return(0,ue.B5)(this,e,t,Ce)}async queryRelatedFeatures(e,t){return(0,ue.hM)(this,e,t,Ce)}async queryRelatedFeaturesCount(e,t){return(0,ue.S2)(this,e,t,Ce)}async queryTopFeatures(e,t){const{source:r,capabilities:i}=await this.load();if(!r.queryTopFeatures||!i?.query?.supportsTopFeaturesQuery)throw new h.A(Ce,"Layer source does not support queryTopFeatures capability");const n=await r.queryTopFeatures(Se.A.from(e),t);if(n?.features)for(const s of n.features)s.layer=s.sourceLayer=this;return n}async queryTopObjectIds(e,t){const{source:r,capabilities:i}=await this.load();if(!r.queryTopObjectIds||!i?.query.supportsTopFeaturesQuery)throw new h.A(Ce,"Layer source does not support queryTopObjectIds capability");return r.queryTopObjectIds(Se.A.from(e),t)}async queryTopFeaturesExtent(e,t){const{source:r,capabilities:i}=await this.load();if(!r.queryTopExtents||!i?.query?.supportsTopFeaturesQuery)throw new h.A(Ce,"Layer source does not support queryTopExtents capability");return r.queryTopExtents(Se.A.from(e),t)}async queryTopFeatureCount(e,t){const{source:r,capabilities:i}=await this.load();if(!r.queryTopCount||!i?.query?.supportsTopFeaturesQuery)throw new h.A(Ce,"Layer source does not support queryFeatureCount capability");return r.queryTopCount(Se.A.from(e),t)}read(e,t){const r=e.featureCollection;if((r||"Feature Collection"===e.type)&&(this.resourceInfo=e),r){const e=r.layers;e&&1===e.length&&(super.read(e[0],t),null!=r.showLegend&&super.read({showLegend:r.showLegend},t))}super.read(e,t),t&&"service"===t.origin&&(this.revert(["objectIdField","fields","timeInfo","dateFieldsTimeZone"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,t){t={...t,origin:t?.origin??void 0,writeLayerSchema:t?.writeLayerSchema??this._hasMemorySource()};const{origin:r,layerContainerType:i,messages:n}=t;if(this.dynamicDataSource)return n?.push(Ee(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(("web-map"===r||"web-scene"===r)&&"tables"!==i)return n?.push(Ee(this,`a table source can only be written to tables, not ${i}`)),null;if(this._hasMemorySource())return n?.push(Ee(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&("web-map"===r||"web-scene"===r)&&"tables"===i)return n?.push(Ee(this,"using a non-table source cannot be written to tables in web maps or web scenes")),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new h.A(Ce,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&("memory"===this.source?.type||(0,ve.D)(this,e))}async save(e){return this._debouncedSaveOperations(Me.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(Me.X.SAVE_AS,t,e)}_readEditingEnabled(e,t,r){let i=e.layerDefinition?.capabilities;return i?this._hasEditingCapability(i):(i=e.capabilities,t&&"web-map"===r?.origin&&!this._hasMemorySource()&&i?this._hasEditingCapability(i):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map((e=>e.trim())).includes("editing")}_writeEditingEnabled(e,t,r,i){if(!e){const e=this.capabilities?.operations?.supportsSync?"Query,Sync":"Query";(0,m.sM)("layerDefinition.capabilities",e,t),r&&!i?.writeLayerSchema&&(t.capabilities=e)}}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstValidLayerId(e){return(0,a.A)(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then((e=>{const t=e.data;if(t)return this.findFirstValidLayerId(t)}))}async initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),(0,fe.yp)(this.renderer,this.fieldsIndex),(0,fe.sv)(this.timeInfo,this.fieldsIndex),(0,we.L)(this,{origin:"service"})}async hasDataChanged(){return(0,ue.jp)(this)}async fetchPublishingStatus(){const e=this.source;return e?.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){const e=this.parsedUrl?.path??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||-1!==e.search(/\/FeatureServer\//i)||this.fields?.some((e=>"geometry"===e.type))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach((e=>{const r=e.prototype?.attributes;r&&t&&delete r[t]}))}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new h.A("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new h.A("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach((e=>{e.layer=this,e.sourceLayer=this})),this.addHandles([e.on("after-add",(e=>{e.item.layer=this,e.item.sourceLayer=this})),e.on("after-remove",(e=>{e.item.layer=null,e.item.sourceLayer=null}))],"fl-source")}_resetMemorySource(e){e.forEach((e=>{e.layer=null,e.sourceLayer=null})),this.removeHandles("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}findFirstValidLayerId(e){return Array.isArray(e.layers)&&e.layers.length>0?e.layers[0].id:Array.isArray(e.tables)&&e.tables.length>0?e.tables[0].id:void 0}};(0,i._)([(0,w.w)("service","capabilities")],Ie.prototype,"readCapabilities",null),(0,i._)([(0,v.MZ)({json:{origins:{"web-scene":{write:!1}},write:!0}})],Ie.prototype,"charts",void 0),(0,i._)([(0,v.MZ)({readOnly:!0})],Ie.prototype,"createQueryVersion",null),(0,i._)([(0,v.MZ)({json:{read:{source:"layerDefinition.copyrightText"}}})],Ie.prototype,"copyright",void 0),(0,i._)([(0,v.MZ)({json:{read:{source:"layerDefinition.displayField"}}})],Ie.prototype,"displayField",void 0),(0,i._)([(0,v.MZ)({types:l.Es,readOnly:!0})],Ie.prototype,"defaultSymbol",void 0),(0,i._)([(0,v.MZ)({type:be.L})],Ie.prototype,"dynamicDataSource",void 0),(0,i._)([(0,v.MZ)({type:Boolean})],Ie.prototype,"editingEnabled",null),(0,i._)([(0,w.w)(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Ie.prototype,"readEditingEnabled",null),(0,i._)([(0,w.w)("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Ie.prototype,"readEditingEnabledFromWebMap",null),(0,i._)([(0,S.K)(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Ie.prototype,"writeEditingEnabled",null),(0,i._)([(0,S.K)("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Ie.prototype,"writeEditingEnabledToWebMap",null),(0,i._)([(0,v.MZ)({readOnly:!0})],Ie.prototype,"effectiveEditingEnabled",null),(0,i._)([(0,v.MZ)({...Pe.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:Oe}}}}})],Ie.prototype,"fields",void 0),(0,i._)([(0,v.MZ)(Pe.fieldsIndex)],Ie.prototype,"fieldsIndex",void 0),(0,i._)([(0,v.MZ)({type:M.A,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Ie.prototype,"formTemplate",void 0),(0,i._)([(0,v.MZ)({json:{read:{source:"layerDefinition.extent"}}})],Ie.prototype,"fullExtent",void 0),(0,i._)([(0,v.MZ)({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:Oe,writer(e,t,r){const i=e?ue.iX.toJSON(e):null;i&&(0,m.sM)(r,i,t)}}}},read:{source:"layerDefinition.geometryType",reader:ue.iX.read}}})],Ie.prototype,"geometryType",void 0),(0,i._)([(0,v.MZ)({json:{read:{source:"layerDefinition.hasM"}}})],Ie.prototype,"hasM",void 0),(0,i._)([(0,v.MZ)({json:{read:{source:"layerDefinition.hasZ"}}})],Ie.prototype,"hasZ",void 0),(0,i._)([(0,v.MZ)(ce.id)],Ie.prototype,"id",void 0),(0,i._)([(0,v.MZ)({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Ie.prototype,"infoFor3D",void 0),(0,i._)([(0,v.MZ)({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Ie.prototype,"isTable",void 0),(0,i._)([(0,w.w)("service","isTable",["type","geometryType"]),(0,w.w)("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Ie.prototype,"readIsTable",null),(0,i._)([(0,S.K)("web-map","isTable")],Ie.prototype,"writeIsTable",null),(0,i._)([(0,v.MZ)(ce.kF)],Ie.prototype,"labelsVisible",void 0),(0,i._)([(0,v.MZ)({type:[me.A],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:ge.w,write:!1},"web-scene":{name:"layerDefinition.drawingInfo.labelingInfo",read:ge.w,write:{enabled:!0,layerContainerTypes:T.K}}},name:"layerDefinition.drawingInfo.labelingInfo",read:ge.w,write:!0}})],Ie.prototype,"labelingInfo",void 0),(0,i._)([(0,v.MZ)((()=>{const e=(0,d.o8)(ce.Ih);return e.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,t,r){(0,m.sM)(r,(0,Ae.p)(e),t)}}},e})())],Ie.prototype,"opacity",void 0),(0,i._)([(0,v.MZ)(ce.fV)],Ie.prototype,"legendEnabled",void 0),(0,i._)([(0,v.MZ)({type:["show","hide"],json:(()=>{const e=(0,d.o8)(ce.C1.json);return e.origins["portal-item"]={read:!1,write:!1},e})()})],Ie.prototype,"listMode",void 0),(0,i._)([(0,w.w)("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],Ie.prototype,"readGlobalIdField",null),(0,i._)([(0,v.MZ)({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:Oe}}}}})],Ie.prototype,"objectIdField",void 0),(0,i._)([(0,w.w)("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],Ie.prototype,"readObjectIdField",null),(0,i._)([(0,v.MZ)({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Ie.prototype,"operationalLayerType",void 0),(0,i._)([(0,v.MZ)(Pe.outFields)],Ie.prototype,"outFields",void 0),(0,i._)([(0,v.MZ)({readOnly:!0})],Ie.prototype,"parsedUrl",null),(0,i._)([(0,v.MZ)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Ie.prototype,"path",void 0),(0,i._)([(0,v.MZ)(ce.M6)],Ie.prototype,"popupEnabled",void 0),(0,i._)([(0,v.MZ)({type:n.A,json:{name:"popupInfo",write:!0}})],Ie.prototype,"popupTemplate",void 0),(0,i._)([(0,v.MZ)({readOnly:!0})],Ie.prototype,"defaultPopupTemplate",null),(0,i._)([(0,v.MZ)({types:o.H,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:o.X,name:"layerDefinition.drawingInfo.renderer",write:{layerContainerTypes:T.K,overridePolicy:(e,t,r)=>({ignoreOrigin:r?.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,r)=>({ignoreOrigin:r?.writeLayerSchema})}}})],Ie.prototype,"renderer",null),(0,i._)([(0,w.w)("service","renderer",["drawingInfo.renderer","defaultSymbol"]),(0,w.w)("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Ie.prototype,"readRenderer",null),(0,i._)([(0,v.MZ)()],Ie.prototype,"resourceInfo",void 0),(0,i._)([(0,v.MZ)((()=>{const e=(0,d.o8)(ce.PY);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],Ie.prototype,"screenSizePerspectiveEnabled",void 0),(0,i._)([(0,v.MZ)({clonable:!1})],Ie.prototype,"source",null),(0,i._)([(0,b.w)("source")],Ie.prototype,"castSource",null),(0,i._)([(0,w.w)("portal-item","source",["featureSet"]),(0,w.w)("web-map","source",["featureSet"])],Ie.prototype,"readSource",null),(0,i._)([(0,v.MZ)({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],Ie.prototype,"spatialReference",void 0),(0,i._)([(0,v.MZ)({type:Number})],Ie.prototype,"subtypeCode",void 0),(0,i._)([(0,v.MZ)({type:[he.A]})],Ie.prototype,"templates",void 0),(0,i._)([(0,w.w)("templates",["editFieldsInfo","creatorField","editorField","templates"])],Ie.prototype,"readTemplates",null),(0,i._)([(0,v.MZ)({type:_e.A})],Ie.prototype,"timeInfo",void 0),(0,i._)([(0,v.MZ)()],Ie.prototype,"title",void 0),(0,i._)([(0,w.w)("service","title",["name"]),(0,w.w)("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Ie.prototype,"readTitle",null),(0,i._)([(0,w.w)("web-map","title",["layerDefinition.name","title"])],Ie.prototype,"readTitleFromWebMap",null),(0,i._)([(0,v.MZ)({type:String})],Ie.prototype,"sublayerTitleMode",void 0),(0,i._)([(0,v.MZ)({json:{read:!1}})],Ie.prototype,"type",void 0),(0,i._)([(0,v.MZ)({type:String})],Ie.prototype,"typeIdField",void 0),(0,i._)([(0,w.w)("service","typeIdField"),(0,w.w)("typeIdField",["layerDefinition.typeIdField"])],Ie.prototype,"readTypeIdField",null),(0,i._)([(0,v.MZ)({type:[de.A]})],Ie.prototype,"types",void 0),(0,i._)([(0,w.w)("service","types",["types"]),(0,w.w)("types",["layerDefinition.types"])],Ie.prototype,"readTypes",null),(0,i._)([(0,v.MZ)({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Ie.prototype,"visible",void 0),(0,i._)([(0,w.w)("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Ie.prototype,"readVisible",null),Ie=(0,i._)([(0,x.$)("esri.layers.FeatureLayer")],Ie);const Le=Ie},25515:(e,t,r)=>{"use strict";r.d(t,{A:()=>b});var i=r(35143),n=(r(35238),r(3825)),s=r(82111),o=r(50076),a=r(54099),l=r(5632),c=r(49304),u=r(76460),h=r(50346),d=r(90534),p=r(46053),f=(r(81806),r(47249),r(85842)),m=r(86560);var g=r(76797),y=r(13312);let _=0,v=class extends(a.A.EventedMixin((0,l.sA)(c.A))){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new g.A(-180,-90,180,90,y.A.WGS84),this.id=Date.now().toString(16)+"-layer-"+_++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=y.A.WGS84,this.title=null,this.type=null,this.url=null,this.visibilityTimeExtent=null,this.visible=!0}static async fromArcGISServerUrl(e){const t="string"==typeof e?{url:e}:e;return(await r.e(2544).then(r.bind(r,62544))).fromUrl(t)}static fromPortalItem(e){return async function(e){const t="portalItem"in e?e:{portalItem:e},{fromItem:i}=await r.e(2487).then(r.bind(r,2487));try{return await i(t)}catch(n){const e=t?.portalItem,r=e?.id||"unset",i=e?.portal?.url||m.A.portalUrl;throw u.A.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+i+"', id: '"+r+"')",n),n}}(e)}initialize(){this.when().catch((e=>{(0,h.zf)(e)||u.A.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})}))}destroy(){const e=this.parent;if(e){const t=this;"layers"in e&&e.layers.includes(t)?e.layers.remove(t):"tables"in e&&e.tables.includes(t)?e.tables.remove(t):"baseLayers"in e&&e.baseLayers.includes(t)?e.baseLayers.remove(t):"referenceLayers"in e&&e.referenceLayers.includes(t)&&e.referenceLayers.remove(t),this._set("parent",null)}}get hasAttributionData(){return null!=this.attributionDataUrl}get parsedUrl(){return(0,d.An)(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await(0,n.A)(e,{query:{f:"json"},responseType:"json"})).data;throw new o.A("layer:no-attribution-data","Layer does not have attribution data")}};(0,i._)([(0,p.MZ)({type:String})],v.prototype,"attributionDataUrl",void 0),(0,i._)([(0,p.MZ)({type:g.A})],v.prototype,"fullExtent",void 0),(0,i._)([(0,p.MZ)({readOnly:!0})],v.prototype,"hasAttributionData",null),(0,i._)([(0,p.MZ)({type:String,clonable:!1})],v.prototype,"id",void 0),(0,i._)([(0,p.MZ)({type:Boolean,nonNullable:!0})],v.prototype,"legendEnabled",void 0),(0,i._)([(0,p.MZ)({type:["show","hide","hide-children"]})],v.prototype,"listMode",void 0),(0,i._)([(0,p.MZ)({type:Number,range:{min:0,max:1},nonNullable:!0})],v.prototype,"opacity",void 0),(0,i._)([(0,p.MZ)({clonable:!1})],v.prototype,"parent",void 0),(0,i._)([(0,p.MZ)({readOnly:!0})],v.prototype,"parsedUrl",null),(0,i._)([(0,p.MZ)({type:Boolean,readOnly:!0})],v.prototype,"persistenceEnabled",void 0),(0,i._)([(0,p.MZ)({type:Boolean})],v.prototype,"popupEnabled",void 0),(0,i._)([(0,p.MZ)({type:Boolean})],v.prototype,"attributionVisible",void 0),(0,i._)([(0,p.MZ)({type:y.A})],v.prototype,"spatialReference",void 0),(0,i._)([(0,p.MZ)({type:String})],v.prototype,"title",void 0),(0,i._)([(0,p.MZ)({readOnly:!0,json:{read:!1}})],v.prototype,"type",void 0),(0,i._)([(0,p.MZ)()],v.prototype,"url",void 0),(0,i._)([(0,p.MZ)({type:s.A})],v.prototype,"visibilityTimeExtent",void 0),(0,i._)([(0,p.MZ)({type:Boolean,nonNullable:!0})],v.prototype,"visible",void 0),v=(0,i._)([(0,f.$)("esri.layers.Layer")],v);const b=v},3569:(e,t,r)=>{"use strict";r.d(t,{r:()=>i});const i="OBJECTID"},93103:(e,t,r)=>{"use strict";r.d(t,{bv:()=>l,Fk:()=>c,yG:()=>u,$b:()=>h,Nd:()=>d,jm:()=>p,sK:()=>g});var i=r(99746),n=r(76931);function s(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}const o=s();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:function(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},create:s,createView:function(e,t){return new Float32Array(e,t,16)},fromValues:function(e,t,r,i,n,s,o,a,l,c,u,h,d,p,f,m){const g=new Float32Array(16);return g[0]=e,g[1]=t,g[2]=r,g[3]=i,g[4]=n,g[5]=s,g[6]=o,g[7]=a,g[8]=l,g[9]=c,g[10]=u,g[11]=h,g[12]=d,g[13]=p,g[14]=f,g[15]=m,g}},Symbol.toStringTag,{value:"Module"}));var a=r(34761);class l{constructor(e,t,r){this.strength=e,this.radius=t,this.threshold=r,this.type="bloom"}interpolate(e,t,r){this.strength=f(e.strength,t.strength,r),this.radius=f(e.radius,t.radius,r),this.threshold=f(e.threshold,t.threshold,r)}clone(){return new l(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:m(this.radius),strength:this.strength,threshold:this.threshold}}}class c{constructor(e){this.radius=e,this.type="blur"}interpolate(e,t,r){this.radius=Math.round(f(e.radius,t.radius,r))}clone(){return new c(this.radius)}toJSON(){return{type:"blur",radius:m(this.radius)}}}class u{constructor(e,t){this.type=e,this.amount=t,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,r){this.amount=f(e.amount,t.amount,r),this._updateMatrix()}clone(){return new u(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||s();switch(this.type){case"brightness":this._colorMatrix=((e,t)=>{const r=(0,a.hZ)(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return(0,a.mg)(r,r)})(e,this.amount);break;case"contrast":this._colorMatrix=((e,t)=>{const r=(0,a.hZ)(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return(0,a.mg)(r,r)})(e,this.amount);break;case"grayscale":this._colorMatrix=((e,t)=>{const r=1-t,i=(0,a.hZ)(e,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return(0,a.mg)(i,i)})(e,this.amount);break;case"invert":this._colorMatrix=((e,t)=>{const r=1-2*t,i=(0,a.hZ)(e,r,0,0,t,0,r,0,t,0,0,r,t,0,0,0,1);return(0,a.mg)(i,i)})(e,this.amount);break;case"saturate":this._colorMatrix=((e,t)=>{const r=(0,a.hZ)(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return(0,a.mg)(r,r)})(e,this.amount);break;case"sepia":this._colorMatrix=((e,t)=>{const r=1-t,i=(0,a.hZ)(e,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return(0,a.mg)(i,i)})(e,this.amount)}}}class h{constructor(e,t,r,i){this.offsetX=e,this.offsetY=t,this.blurRadius=r,this.color=i,this.type="drop-shadow"}interpolate(e,t,r){this.offsetX=f(e.offsetX,t.offsetX,r),this.offsetY=f(e.offsetY,t.offsetY,r),this.blurRadius=f(e.blurRadius,t.blurRadius,r),this.color[0]=Math.round(f(e.color[0],t.color[0],r)),this.color[1]=Math.round(f(e.color[1],t.color[1],r)),this.color[2]=Math.round(f(e.color[2],t.color[2],r)),this.color[3]=f(e.color[3],t.color[3],r)}clone(){return new h(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:m(this.offsetX),yoffset:m(this.offsetY),blurRadius:m(this.blurRadius),color:e}}}class d{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,r){this.angle=f(e.angle,t.angle,r),this._updateMatrix()}clone(){return new d(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||s();this._colorMatrix=((e,t)=>{const r=Math.sin(t*Math.PI/180),i=Math.cos(t*Math.PI/180),n=(0,a.hZ)(e,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return(0,a.mg)(n,n)})(e,this.angle)}}class p{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,t,r){this.amount=f(e.amount,t.amount,r)}clone(){return new p(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function f(e,t,r){return e+(t-e)*r}function m(e){return Math.round(1e3*(0,n.PN)(e))/1e3}function g(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new u(e.type,0);case"saturate":case"brightness":case"contrast":return new u(e.type,1);case"opacity":return new p(1);case"hue-rotate":return new d(0);case"blur":return new c(0);case"drop-shadow":return new h(0,0,0,[...(0,i.TS)("transparent")]);case"bloom":return new l(0,0,1)}}},66758:(e,t,r)=>{"use strict";r.d(t,{zu:()=>E,LF:()=>A,M9:()=>C});var i,n,s=r(50076),o=r(48611),a=r(99746),l=r(93103),c=(r(54787),r(58503)),u={exports:{}};n=function(){function e(t,r,i,n){var s=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(s,e.prototype),s.expected=r,s.found=i,s.location=n,s.name="SyntaxError",s}function t(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.prototype.format=function(e){var r="Error: "+this.message;if(this.location){var i,n=null;for(i=0;i<e.length;i++)if(e[i].source===this.location.source){n=e[i].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,o=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(s):s,a=this.location.source+":"+o.line+":"+o.column;if(n){var l=this.location.end,c=t("",o.line.toString().length," "),u=n[s.line-1],h=(s.line===l.line?l.column:u.length+1)-s.column||1;r+="\n --\x3e "+a+"\n"+c+" |\n"+o.line+" | "+u+"\n"+c+" | "+t("",s.column-1," ")+t("",h,"^")}else r+="\n at "+a}return r},e.buildMessage=function(e,t){var r={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?s(e[0])+"-"+s(e[1]):s(e)}));return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function o(e){return r[e.type](e)}return"Expected "+function(e){var t,r,i=e.map(o);if(i.sort(),i.length>0){for(t=1,r=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,r){var i,n={},s=(r=void 0!==r?r:{}).grammarSource,o={start:Ze},a=Ze,l="none",c=")",u=",",h="(",d="%",p="px",f="cm",m="mm",g="in",y="pt",_="pc",v="deg",b="rad",w="grad",x="turn",S="#",T=".",M="e",A=/^[ \t\n\r]/,C=/^[a-z\-]/,E=/^[0-9a-fA-F]/,R=/^[+\-]/,P=/^[0-9]/,O=Be("none"),I=Ue("none",!1),L=Ue(")",!1),N=Ue(",",!1),D=Be("whitespace"),F=Ve([" ","\t","\n","\r"],!1,!1),k=Be("function"),z=Ue("(",!1),U=Be("identifier"),V=Ve([["a","z"],"-"],!1,!1),B=Be("percentage"),j=Ue("%",!1),H=Be("length"),G=Ue("px",!1),Z=Ue("cm",!1),$=Ue("mm",!1),q=Ue("in",!1),W=Ue("pt",!1),Y=Ue("pc",!1),X=Be("angle"),J=Ue("deg",!1),K=Ue("rad",!1),Q=Ue("grad",!1),ee=Ue("turn",!1),te=Be("number"),re=Be("color"),ie=Ue("#",!1),ne=Ve([["0","9"],["a","f"],["A","F"]],!1,!1),se=Ve(["+","-"],!1,!1),oe=Ve([["0","9"]],!1,!1),ae=Ue(".",!1),le=Ue("e",!1),ce=function(){return[]},ue=function(e,t){return{type:"function",name:e,parameters:t||[]}},he=function(e,t){return t.length>0?function(e,t,r){return[e].concat(function(e,t){return e.map((function(e){return e[t]}))}(t,r))}(e,t,3):[e]},de=function(e){return{type:"quantity",value:e.value,unit:e.unit}},pe=function(e){return{type:"color",colorType:e.type,value:e.value}},fe=function(e){return e},me=function(){return ze()},ge=function(e){return{value:e,unit:"%"}},ye=function(e){return{value:e,unit:"px"}},_e=function(e){return{value:e,unit:"cm"}},ve=function(e){return{value:e,unit:"mm"}},be=function(e){return{value:e,unit:"in"}},we=function(e){return{value:e,unit:"pt"}},xe=function(e){return{value:e,unit:"pc"}},Se=function(e){return{value:e,unit:"deg"}},Te=function(e){return{value:e,unit:"rad"}},Me=function(e){return{value:e,unit:"grad"}},Ae=function(e){return{value:e,unit:"turn"}},Ce=function(e){return{value:e,unit:null}},Ee=function(){return{type:"hex",value:ze()}},Re=function(e){return{type:"function",value:e}},Pe=function(){return{type:"named",value:ze()}},Oe=function(){return parseFloat(ze())},Ie=0,Le=0,Ne=[{line:1,column:1}],De=0,Fe=[],ke=0;if("startRule"in r){if(!(r.startRule in o))throw new Error("Can't start parsing from rule \""+r.startRule+'".');a=o[r.startRule]}function ze(){return t.substring(Le,Ie)}function Ue(e,t){return{type:"literal",text:e,ignoreCase:t}}function Ve(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Be(e){return{type:"other",description:e}}function je(e){var r,i=Ne[e];if(i)return i;for(r=e-1;!Ne[r];)r--;for(i={line:(i=Ne[r]).line,column:i.column};r<e;)10===t.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return Ne[e]=i,i}function He(e,t,r){var i=je(e),n=je(t);return{source:s,start:{offset:e,line:i.line,column:i.column},end:{offset:t,line:n.line,column:n.column}}}function Ge(e){Ie<De||(Ie>De&&(De=Ie,Fe=[]),Fe.push(e))}function Ze(){var e;return(e=$e())===n&&(e=function(){var e,t;if(e=[],(t=qe())!==n)for(;t!==n;)e.push(t),t=qe();else e=n;return e}()),e}function $e(){var e,r;return ke++,e=Ie,Ye(),t.substr(Ie,4)===l?(r=l,Ie+=4):(r=n,0===ke&&Ge(I)),r!==n?(Ye(),Le=e,e=ce()):(Ie=e,e=n),ke--,e===n&&0===ke&&Ge(O),e}function qe(){var e,r,i,s;return e=Ie,Ye(),(r=function(){var e,r,i;return ke++,e=Ie,(r=Xe())!==n?(40===t.charCodeAt(Ie)?(i=h,Ie++):(i=n,0===ke&&Ge(z)),i!==n?(Le=e,e=fe(r)):(Ie=e,e=n)):(Ie=e,e=n),ke--,e===n&&(r=n,0===ke&&Ge(k)),e}())!==n?(Ye(),(i=function(){var e,r,i,s,o,a,l,c;if(e=Ie,(r=We())!==n){for(i=[],s=Ie,o=Ye(),44===t.charCodeAt(Ie)?(a=u,Ie++):(a=n,0===ke&&Ge(N)),a===n&&(a=null),l=Ye(),(c=We())!==n?s=o=[o,a,l,c]:(Ie=s,s=n);s!==n;)i.push(s),s=Ie,o=Ye(),44===t.charCodeAt(Ie)?(a=u,Ie++):(a=n,0===ke&&Ge(N)),a===n&&(a=null),l=Ye(),(c=We())!==n?s=o=[o,a,l,c]:(Ie=s,s=n);Le=e,e=he(r,i)}else Ie=e,e=n;return e}())===n&&(i=null),Ye(),41===t.charCodeAt(Ie)?(s=c,Ie++):(s=n,0===ke&&Ge(L)),s!==n?(Ye(),Le=e,e=ue(r,i)):(Ie=e,e=n)):(Ie=e,e=n),e}function We(){var e,t;return e=Ie,(t=Je())===n&&(t=Ke())===n&&(t=Qe())===n&&(t=function(){var e,t;return ke++,e=Ie,Ye(),(t=tt())!==n?(Le=e,e=Ce(t)):(Ie=e,e=n),ke--,e===n&&0===ke&&Ge(te),e}()),t!==n&&(Le=e,t=de(t)),(e=t)===n&&(e=Ie,(t=et())!==n&&(Le=e,t=pe(t)),e=t),e}function Ye(){var e,r;for(ke++,e=[],A.test(t.charAt(Ie))?(r=t.charAt(Ie),Ie++):(r=n,0===ke&&Ge(F));r!==n;)e.push(r),A.test(t.charAt(Ie))?(r=t.charAt(Ie),Ie++):(r=n,0===ke&&Ge(F));return ke--,r=n,0===ke&&Ge(D),e}function Xe(){var e,r,i;if(ke++,e=Ie,r=[],C.test(t.charAt(Ie))?(i=t.charAt(Ie),Ie++):(i=n,0===ke&&Ge(V)),i!==n)for(;i!==n;)r.push(i),C.test(t.charAt(Ie))?(i=t.charAt(Ie),Ie++):(i=n,0===ke&&Ge(V));else r=n;return r!==n&&(Le=e,r=me()),ke--,(e=r)===n&&(r=n,0===ke&&Ge(U)),e}function Je(){var e,r,i;return ke++,e=Ie,Ye(),(r=tt())!==n?(37===t.charCodeAt(Ie)?(i=d,Ie++):(i=n,0===ke&&Ge(j)),i!==n?(Le=e,e=ge(r)):(Ie=e,e=n)):(Ie=e,e=n),ke--,e===n&&0===ke&&Ge(B),e}function Ke(){var e,r,i;return ke++,e=Ie,Ye(),(r=tt())!==n?(t.substr(Ie,2)===p?(i=p,Ie+=2):(i=n,0===ke&&Ge(G)),i!==n?(Le=e,e=ye(r)):(Ie=e,e=n)):(Ie=e,e=n),e===n&&(e=Ie,Ye(),(r=tt())!==n?(t.substr(Ie,2)===f?(i=f,Ie+=2):(i=n,0===ke&&Ge(Z)),i!==n?(Le=e,e=_e(r)):(Ie=e,e=n)):(Ie=e,e=n),e===n&&(e=Ie,Ye(),(r=tt())!==n?(t.substr(Ie,2)===m?(i=m,Ie+=2):(i=n,0===ke&&Ge($)),i!==n?(Le=e,e=ve(r)):(Ie=e,e=n)):(Ie=e,e=n),e===n&&(e=Ie,Ye(),(r=tt())!==n?(t.substr(Ie,2)===g?(i=g,Ie+=2):(i=n,0===ke&&Ge(q)),i!==n?(Le=e,e=be(r)):(Ie=e,e=n)):(Ie=e,e=n),e===n&&(e=Ie,Ye(),(r=tt())!==n?(t.substr(Ie,2)===y?(i=y,Ie+=2):(i=n,0===ke&&Ge(W)),i!==n?(Le=e,e=we(r)):(Ie=e,e=n)):(Ie=e,e=n),e===n&&(e=Ie,Ye(),(r=tt())!==n?(t.substr(Ie,2)===_?(i=_,Ie+=2):(i=n,0===ke&&Ge(Y)),i!==n?(Le=e,e=xe(r)):(Ie=e,e=n)):(Ie=e,e=n)))))),ke--,e===n&&0===ke&&Ge(H),e}function Qe(){var e,r,i;return ke++,e=Ie,(r=tt())!==n?(t.substr(Ie,3)===v?(i=v,Ie+=3):(i=n,0===ke&&Ge(J)),i!==n?(Le=e,e=Se(r)):(Ie=e,e=n)):(Ie=e,e=n),e===n&&(e=Ie,(r=tt())!==n?(t.substr(Ie,3)===b?(i=b,Ie+=3):(i=n,0===ke&&Ge(K)),i!==n?(Le=e,e=Te(r)):(Ie=e,e=n)):(Ie=e,e=n),e===n&&(e=Ie,(r=tt())!==n?(t.substr(Ie,4)===w?(i=w,Ie+=4):(i=n,0===ke&&Ge(Q)),i!==n?(Le=e,e=Me(r)):(Ie=e,e=n)):(Ie=e,e=n),e===n&&(e=Ie,(r=tt())!==n?(t.substr(Ie,4)===x?(i=x,Ie+=4):(i=n,0===ke&&Ge(ee)),i!==n?(Le=e,e=Ae(r)):(Ie=e,e=n)):(Ie=e,e=n)))),ke--,e===n&&(r=n,0===ke&&Ge(X)),e}function et(){var e,r,i,s;if(ke++,e=Ie,35===t.charCodeAt(Ie)?(r=S,Ie++):(r=n,0===ke&&Ge(ie)),r!==n){if(i=[],E.test(t.charAt(Ie))?(s=t.charAt(Ie),Ie++):(s=n,0===ke&&Ge(ne)),s!==n)for(;s!==n;)i.push(s),E.test(t.charAt(Ie))?(s=t.charAt(Ie),Ie++):(s=n,0===ke&&Ge(ne));else i=n;i!==n?(Le=e,e=Ee()):(Ie=e,e=n)}else Ie=e,e=n;return e===n&&(e=Ie,(r=qe())!==n&&(Le=e,r=Re(r)),(e=r)===n&&(e=Ie,(r=Xe())!==n&&(Le=e,r=Pe()),e=r)),ke--,e===n&&(r=n,0===ke&&Ge(re)),e}function tt(){var e,r,i,s,o,a,l;for(e=Ie,R.test(t.charAt(Ie))?(t.charAt(Ie),Ie++):0===ke&&Ge(se),r=Ie,i=[],P.test(t.charAt(Ie))?(s=t.charAt(Ie),Ie++):(s=n,0===ke&&Ge(oe));s!==n;)i.push(s),P.test(t.charAt(Ie))?(s=t.charAt(Ie),Ie++):(s=n,0===ke&&Ge(oe));if(46===t.charCodeAt(Ie)?(s=T,Ie++):(s=n,0===ke&&Ge(ae)),s!==n){if(o=[],P.test(t.charAt(Ie))?(a=t.charAt(Ie),Ie++):(a=n,0===ke&&Ge(oe)),a!==n)for(;a!==n;)o.push(a),P.test(t.charAt(Ie))?(a=t.charAt(Ie),Ie++):(a=n,0===ke&&Ge(oe));else o=n;o!==n?r=i=[i,s,o]:(Ie=r,r=n)}else Ie=r,r=n;if(r===n)if(r=[],P.test(t.charAt(Ie))?(i=t.charAt(Ie),Ie++):(i=n,0===ke&&Ge(oe)),i!==n)for(;i!==n;)r.push(i),P.test(t.charAt(Ie))?(i=t.charAt(Ie),Ie++):(i=n,0===ke&&Ge(oe));else r=n;if(r!==n){if(i=Ie,101===t.charCodeAt(Ie)?(s=M,Ie++):(s=n,0===ke&&Ge(le)),s!==n){if(R.test(t.charAt(Ie))?(o=t.charAt(Ie),Ie++):(o=n,0===ke&&Ge(se)),o===n&&(o=null),a=[],P.test(t.charAt(Ie))?(l=t.charAt(Ie),Ie++):(l=n,0===ke&&Ge(oe)),l!==n)for(;l!==n;)a.push(l),P.test(t.charAt(Ie))?(l=t.charAt(Ie),Ie++):(l=n,0===ke&&Ge(oe));else a=n;a!==n?i=s=[s,o,a]:(Ie=i,i=n)}else Ie=i,i=n;i===n&&(i=null),Le=e,e=Oe()}else Ie=e,e=n;return e}if((i=a())!==n&&Ie===t.length)return i;throw i!==n&&Ie<t.length&&Ge({type:"end"}),function(t,r,i){return new e(e.buildMessage(t,r),t,r,i)}(Fe,De<t.length?t.charAt(De):null,De<t.length?He(De,De+1):He(De,De))}}},(i=u).exports&&(i.exports=n());var h=u.exports;function d(e){if(!e||0===e.length)return null;if("string"==typeof e){const t=p(e);return t&&0!==t.length?t:null}const t=e.map((e=>{if(!Number.isFinite(e.scale)||e.scale<=0)throw new s.A("effect:invalid-scale","scale must be finite and greater than 0",{stop:e});return{scale:e.scale,effects:p(e.value)}}));t.sort(((e,t)=>t.effects.length-e.effects.length));for(let r=0;r<t.length-1;r++){if(!(0,c.mj)(t[r].effects,t[r+1].effects))throw new s.A("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[r].effects,b:t[r+1].effects});(0,c.O9)(t[r].effects,t[r+1].effects)}return t.sort(((e,t)=>t.scale-e.scale)),t}function p(e){let t;if(!e)return[];try{t=h.parse(e)}catch(r){throw new s.A("effect:invalid-syntax","Invalid effect syntax",{value:e,error:r})}return t.map((e=>function(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(e){let t=1;return f(e.parameters,1),1===e.parameters.length&&(t=v(e.parameters[0])),new l.yG(e.name,t)}(e);case"opacity":return function(e){let t=1;return f(e.parameters,1),1===e.parameters.length&&(t=v(e.parameters[0])),new l.jm(t)}(e);case"hue-rotate":return function(e){let t=0;return f(e.parameters,1),1===e.parameters.length&&(t=function(e){return function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=y[e.unit]))throw new s.A("effect:type-error",`Expected <angle>, Actual: ${m(e)}`,{term:e})}(e),e.value*y[e.unit]||0}(e.parameters[0])),new l.Nd(t)}(e);case"blur":return function(e){let t=0;return f(e.parameters,1),1===e.parameters.length&&(t=w(e.parameters[0]),g(t,e.parameters[0])),new l.Fk(t)}(e);case"drop-shadow":return function(e){const t=[];let r=null;for(const i of e.parameters)if("color"===i.type){if(t.length&&Object.freeze(t),r)throw new s.A("effect:type-error","Accepts only one color",{});r=x(i)}else{const e=w(i);if(Object.isFrozen(t))throw new s.A("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(e),3===t.length&&g(e,i)}if(t.length<2||t.length>3)throw new s.A("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new l.$b(t[0],t[1],t[2]||0,r||S("black"))}(e);case"bloom":return function(e){let t=1,r=0,i=0;return f(e.parameters,3),e.parameters[0]&&(t=v(e.parameters[0])),e.parameters[1]&&(r=w(e.parameters[1]),g(r,e.parameters[1])),e.parameters[2]&&(i=v(e.parameters[2])),new l.bv(t,r,i)}(e)}}catch(t){throw t.details.filter=e,t}throw new s.A("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}(e)))}function f(e,t){if(e.length>t)throw new s.A("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function m(e){if("color"===e.type)return"<color>";if(e.unit){if(e.unit in _)return"<length>";if(e.unit in y)return"<angle>";if("%"===e.unit)return"<percentage>"}return"<double>"}function g(e,t){if(e<0)throw new s.A("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}const y={deg:1,grad:.9,rad:180/Math.PI,turn:360};const _={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function v(e){!function(e){if("quantity"!==e.type||null!==e.unit&&"%"!==e.unit)throw new s.A("effect:type-error",`Expected <double> or <percentage>, Actual: ${m(e)}`,{term:e})}(e);const t=e.value;return g(t,e),"%"===e.unit?.01*t:t}function b(e){return function(e){if("quantity"!==e.type||null!==e.unit)throw new s.A("effect:type-error",`Expected <double>, Actual: ${m(e)}`,{term:e})}(e),g(e.value,e),e.value}function w(e){return function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=_[e.unit]))throw new s.A("effect:type-error",`Expected <length>, Actual: ${m(e)}`,{term:e})}(e),e.value*_[e.unit]||0}function x(e){switch(e.colorType){case"hex":return(0,a.qh)(e.value);case"named":return S(e.value);case"function":return function(e){if(f(e.parameters,4),T.test(e.name))return[v(e.parameters[0]),v(e.parameters[1]),v(e.parameters[2]),e.parameters[3]?v(e.parameters[3]):1];if(M.test(e.name))return(0,a.z$)(b(e.parameters[0]),v(e.parameters[1]),v(e.parameters[2]),e.parameters[3]?v(e.parameters[3]):1);throw new s.A("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}(e.value)}}function S(e){if(!(0,a.V6)(e))throw new s.A("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return(0,a.c4)(e)}const T=/^rgba?/i,M=/^hsla?/i;function A(e,t,r){try{return function(e){if(!e||0===e.length)return null;if(function(e){const t=e[0];return!!t&&"scale"in t}(e)){const t=[];for(const r of e)t.push({scale:r.scale,value:E(r.value)});return t}return E(e)}(e)}catch(i){r?.messages?.push(i)}return null}function C(e,t,r,i){try{const i=function(e){const t=d(e);return t?(0,c.dw)(t)?t.map((e=>e.toJSON())):t.map((e=>{let{scale:t,effects:r}=e;return{scale:t,value:r.map((e=>e.toJSON()))}})):null}(e);(0,o.sM)(r,i,t)}catch(C){i.messages&&i.messages.push(C)}}function E(e){if(!e?.length)return"";const t=[];for(const r of e){let e=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":e=[R(r,"amount")];break;case"blur":e=[R(r,"radius","pt")];break;case"hue-rotate":e=[R(r,"angle","deg")];break;case"drop-shadow":e=[R(r,"xoffset","pt"),R(r,"yoffset","pt"),R(r,"blurRadius","pt"),P(r,"color")];break;case"bloom":e=[R(r,"strength"),R(r,"radius","pt"),R(r,"threshold")]}const i=`${r.type}(${e.filter(Boolean).join(" ")})`;d(i),t.push(i)}return t.join(" ")}function R(e,t,r){if(null==e[t])throw new s.A("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return r?e[t]+r:""+e[t]}function P(e,t){if(null==e[t])throw new s.A("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const r=e[t];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}},58503:(e,t,r)=>{"use strict";r.d(t,{O9:()=>s,dw:()=>o,mj:()=>n});var i=r(93103);function n(e,t){const r=e.length>t.length?e:t;return(e.length>t.length?t:e).every(((e,t)=>e.type===r[t].type))}function s(e,t){const r=e.length>t.length?e:t,n=e.length>t.length?t:e;for(let s=n.length;s<r.length;s++)n.push((0,i.sK)(r[s]))}function o(e){const t=e[0];return!!t&&"type"in t}},20176:(e,t,r)=>{"use strict";r.d(t,{N3:()=>s,Om:()=>n});var i=r(1484);class n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;this.geometry=e,this.attributes=t,this.centroid=r,this.objectId=i,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(e,t){const r=e.geometry?i.A.fromJSON(e.geometry):null,s=e.centroid?i.A.fromJSON(e.centroid):null,o=e.attributes[t];return new n(r,e.attributes,s,o)}weakClone(){const e=new n(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){const e=this.geometry?.clone(),t=new n(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function s(e){return!!e.geometry?.coords?.length}},75146:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});class i{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new i;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},1484:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});class i{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.lengths=e??[],this.coords=t??[],this.hasIndeterminateRingOrder=r}static fromJSON(e){return new i(e.lengths,e.coords,e.hasIndeterminateRingOrder)}static fromRect(e){const[t,r,n,s]=e,o=n-t,a=s-r;return new i([5],[t,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const i=this.lengths[r];for(let r=0;r<i;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=i}}deltaDecode(){const e=this.clone(),{coords:t,lengths:r}=e;let i=0;for(const n of r){for(let e=1;e<n;e++)t[2*(i+e)]+=t[2*(i+e)-2],t[2*(i+e)+1]+=t[2*(i+e)-1];i+=n}return e}clone(e){if(0===this.lengths.length)return new i([],[this.coords[0],this.coords[1]]);const t=2*(0===this.lengths.length?1:this.lengths.reduce(((e,t)=>e+t))),r=this.coords.slice(0,t);return e?(e.set(r),new i(this.lengths,e,this.hasIndeterminateRingOrder)):new i(Array.from(this.lengths),Array.from(r),this.hasIndeterminateRingOrder)}}},59883:(e,t,r)=>{"use strict";function i(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}}function n(e,t,r,i,n){return{objectId:e,target:t,distance:r,type:"edge",start:i,end:n,draped:arguments.length>5&&void 0!==arguments[5]&&arguments[5]}}r.d(t,{P:()=>n,k:()=>i})},74e3:(e,t,r)=>{"use strict";r.d(t,{CI:()=>a,aI:()=>u,fk:()=>l});r(81806);var i=r(15941),n=r(80963);function s(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){const i=e[r],n=t[r];if(i.length!==n.length)return!1;for(let e=0;e<i.length;e++)if(i[e]!==n[e])return!1}return!0}function o(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!s(e[r],t[r]))return!1;return!0}function a(e,t){return e===t||null!=e&&null!=t&&(0,n.aI)(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function l(e,t,r){return e===t||null!=e&&null!=t&&(0,n.aI)(e.spatialReference,t.spatialReference)&&(0,i.Sp)(e.x,t.x,r)&&(0,i.Sp)(e.y,t.y,r)&&(0,i.Sp)(e.z??0,t.z??0,r)&&(0,i.Sp)(e.m??0,t.m??0,r)}function c(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return a(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,n.aI)(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,n.aI)(e.spatialReference,t.spatialReference)&&o(e.paths,t.paths)}(e,t);case"polygon":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,n.aI)(e.spatialReference,t.spatialReference)&&o(e.rings,t.rings)}(e,t);case"multipoint":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,n.aI)(e.spatialReference,t.spatialReference)&&s(e.points,t.points)}(e,t);case"mesh":return!1;default:return}}function u(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!c(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;const r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(const n of r)if(e[n]!==t[n])return!1;return!0}(e.attributes,t.attributes)}},81284:(e,t,r)=>{"use strict";function i(e){return"point"===e.type}r.d(t,{v:()=>i})},99784:(e,t,r)=>{"use strict";r.d(t,{Ek:()=>y,HP:()=>d,JS:()=>m,Kq:()=>_,N3:()=>p,RW:()=>x,Uz:()=>S,ao:()=>v,iQ:()=>w,jy:()=>f,w9:()=>b});var i=r(21499),n=(r(81806),r(78393)),s=r(90632),o=r(13312),a=r(42294),l=r(2413),c=r(76279),u=r(31608),h=r(44135);r(74e3);class d{constructor(e,t,r){this.uid=e,this.geometry=t,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function p(e){return null!=e.geometry}class f{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function m(e,t){const r=u.g.fromJSON(e.geometryType),i=o.A.fromJSON(e.spatialReference),n=e.transform,a=e.objectIdFieldName,l=t?.maxStringAttributeLength,d=t?.maxStringAttributeFields;let p;const f=e.features.map((t=>{const o=function(e,t,r,i){return{uid:(0,s.c)(),objectId:i&&e.attributes?e.attributes[i]:null,attributes:e.attributes,geometry:g(e.geometry,t,r),visible:!0}}(t,r,i,e.objectIdFieldName),u=o.geometry;if(S(o.attributes,d,l,(e=>{p??=[];const t=x(o,a);null!=t&&p.push({objectId:t,attribute:e})})),null!=u&&n)switch(u.type){case"point":o.geometry=(0,c.Tr)(n,u,u);break;case"multipoint":o.geometry=(0,c.SW)(n,u,u);break;case"polygon":o.geometry=(0,c.$X)(n,u,u);break;case"polyline":o.geometry=(0,c.P5)(n,u,u);break;case"extent":case"mesh":o.geometry=u}return o}));return{geometryType:r,features:f,spatialReference:i,fields:e.fields?.map((e=>h.A.fromJSON(e)))??[],objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null,missingAttributes:p}}function g(e,t,r){if(null==e)return null;switch(t){case"point":{const t=e;return{x:t.x,y:t.y,z:t.z,m:t.m,hasZ:null!=t.z,hasM:null!=t.m,type:"point",spatialReference:r}}case"polyline":{const t=e;return{paths:t.paths,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polyline",spatialReference:r}}case"polygon":{const t=e;return{rings:t.rings,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const t=e;return{points:t.points,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"multipoint",spatialReference:r}}}}function y(e){let t=32;return t+=(0,i.eY)(e.attributes),t+=3,t+=8+function(e){if(null==e)return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(e.hasZ?1:0)+(e.hasM?1:0),n="polyline"===e.type?e.paths:e.rings;for(const e of n)r+=e.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32*(n.length+1);break}case"multipoint":{const r=2+(e.hasZ?1:0)+(e.hasM?1:0),i=e.points.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=(0,n.Ek)(e.vertexAttributes.position,e.vertexAttributes.normal,e.vertexAttributes.uv,e.vertexAttributes.tangent)}return t}(e.geometry),t}function _(e){if(null==e)return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const r of e.paths)t+=r.length;return t}case"polygon":{let t=0;for(const r of e.rings)t+=r.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function v(e){if(null==e)return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function b(e,t){switch((0,a.Ie)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let r=0;r<e.paths.length;r++)(0,a.Jf)(t,e.paths[r],!!e.hasZ);break;case"polygon":for(let r=0;r<e.rings.length;r++)(0,a.Jf)(t,e.rings[r],!!e.hasZ);break;case"multipoint":(0,a.Jf)(t,e.points,!!e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function w(e,t){switch((0,l.Ie)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let r=0;r<e.paths.length;r++)(0,l.Jf)(t,e.paths[r]);break;case"polygon":for(let r=0;r<e.rings.length;r++)(0,l.Jf)(t,e.rings[r]);break;case"multipoint":(0,l.Jf)(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function x(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}function S(e,t,r,i){if(t?.size&&null!=r&&e)for(const n in e){if(!t.has(n))continue;const s=e[n];"string"==typeof s&&s.length>r&&(i(n),e[n]="")}}},18117:(e,t,r)=>{"use strict";function i(e,t,r,i){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:i,type:"point"}}function n(e,t,r,i,n){e.x=t,e.y=r,e.z=i,e.hasZ=null!=i,e.spatialReference=n}r.d(t,{J:()=>n,T:()=>i})},98618:(e,t,r)=>{"use strict";r.d(t,{B2:()=>w,BW:()=>F,Ch:()=>ie,DF:()=>S,Di:()=>H,E2:()=>j,IE:()=>b,Nl:()=>K,Q4:()=>ne,Rk:()=>oe,Ux:()=>Z,Ye:()=>U,ZF:()=>W,eY:()=>X,jH:()=>J,jQ:()=>re,kz:()=>Q,oN:()=>G,q3:()=>Y,qK:()=>N,qN:()=>L,z5:()=>z,zv:()=>$});var i=r(50076),n=r(76460),s=r(30726),o=r(42294),a=r(2413),l=r(19902),c=r(20176),u=r(75146),h=r(1484);function d(e,t){return e?t?4:3:t?3:2}const p=()=>n.A.getLogger("esri.layers.graphics.featureConversionUtils"),f={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},m=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s},g=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+2]},y=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+3]},_=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+2],e[r+3]=t[i+3]};function v(e,t,r,i){if(e){if(r)return t&&i?_:g;if(t&&i)return y}else if(t&&i)return g;return m}function b(e,t){let{scale:r,translate:i}=e;return Math.round((t-i[0])/r[0])}function w(e,t){let{scale:r,translate:i}=e;return Math.round((i[1]-t)/r[1])}function x(e,t,r){let{scale:i,translate:n}=e;return t*i[r]+n[r]}function S(e,t,r){return e?t?r?P(e):A(e):r?E(e):T(e):null}function T(e){const t=e.coords;return{x:t[0],y:t[1]}}function M(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function A(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function C(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function E(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function R(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function P(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function O(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function I(e,t){return e&&t?O:e?C:t?R:M}function L(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:I(null!=t.z,null!=t.m))(e,t)}function N(e,t,r){if(null==e)return null;const i=d(t,r),n=[];for(let s=0;s<e.coords.length;s+=i){const t=[];for(let r=0;r<i;r++)t.push(e.coords[s+r]);n.push(t)}return t?r?{points:n,hasZ:t,hasM:r}:{points:n,hasZ:t}:r?{points:n,hasM:r}:{points:n}}function D(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d(t.hasZ,t.hasM);e.lengths[0]=t.points.length;const i=e.coords;let n=0;for(const s of t.points)for(let e=0;e<r;e++)i[n++]=s[e];return e}function F(e,t,r){if(!e)return null;const i=d(t,r),{coords:n,lengths:s}=e,o=[];let a=0;for(const l of s){const e=[];for(let t=0;t<l;t++){const t=[];for(let e=0;e<i;e++)t.push(n[a++]);e.push(t)}o.push(e)}return t?r?{paths:o,hasZ:t,hasM:r}:{paths:o,hasZ:t}:r?{paths:o,hasM:r}:{paths:o}}function k(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d(t.hasZ,t.hasM);const{lengths:i,coords:n}=e;let s=0;for(const o of t.paths){for(const e of o)for(let t=0;t<r;t++)n[s++]=e[t];i.push(o.length)}return e}function z(e,t,r){if(!e)return null;const i=d(t,r),{coords:n,lengths:s}=e,o=[];let a=0;for(const l of s){const e=[];for(let t=0;t<l;t++){const t=[];for(let e=0;e<i;e++)t.push(n[a++]);e.push(t)}o.push(e)}return t?r?{rings:o,hasZ:t,hasM:r}:{rings:o,hasZ:t}:r?{rings:o,hasM:r}:{rings:o}}function U(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.hasZ,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.hasM;return function(e,t,r,i){const n=d(r,i),{lengths:s,coords:o}=e;let a=0;ae(e);for(const l of t){for(const e of l)for(let t=0;t<n;t++)o[a++]=e[t];s.push(l.length)}return e}(e,t.rings,r,i)}const V=[],B=[];function j(e,t,r,i,n){V[0]=e;const[s]=H(B,V,t,r,i,n);return le(V),le(B),s}function H(e,t,r,n,s,o){if(le(e),!r){for(const r of t){const t=o?r.attributes[o]:void 0;e.push(new c.Om(null,r.attributes,null,t))}return e}switch(r){case"esriGeometryPoint":return function(e,t,r,i,n){const s=I(r,i);for(const{geometry:o,attributes:a}of t){const t=null!=o?s(new h.A,o):null;e.push(new c.Om(t,a,null,n?a[n]:void 0))}return e}(e,t,n,s,o);case"esriGeometryMultipoint":return function(e,t,r,i,n){const s=d(r,i);for(const{geometry:o,attributes:a}of t){const t=null!=o?D(new h.A,o,s):null;e.push(new c.Om(t,a,null,n?a[n]:void 0))}return e}(e,t,n,s,o);case"esriGeometryPolyline":return function(e,t,r,i,n){const s=d(r,i);for(const{geometry:o,attributes:a,centroid:l}of t){const t=null!=o?k(new h.A,o,s):null,r=null!=l?L(new h.A,l):null;e.push(new c.Om(t,a,r,n?a[n]:void 0))}return e}(e,t,n,s,o);case"esriGeometryPolygon":return function(e,t,r,i,n){for(const{geometry:s,centroid:o,attributes:a}of t){const t=null!=s?U(new h.A,s,r,i):null,l=n?a[n]:void 0;null!=o?e.push(new c.Om(t,a,M(new h.A,o),l)):e.push(new c.Om(t,a,null,l))}return e}(e,t,n,s,o);default:p().error("convertToFeatureSet:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${r}'`)),le(e)}return e}function G(e,t,r,i){B[0]=e,q(V,B,t,r,i);const n=V[0];return le(V),le(B),n}function Z(e,t,r){if(null==e)return null;const n=new h.A;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==r&&(r=e.hasM),(0,l.fT)(e)?I(null!=t?t:null!=e.z,null!=r?r:null!=e.m)(n,e):(0,l.Bi)(e)?U(n,e,t,r):(0,l.Rg)(e)?k(n,e,d(t,r)):(0,l.U9)(e)?D(n,e,d(t,r)):void p().error("convertFromGeometry:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${e}'`))}function $(e,t,r,n){const s=e&&("coords"in e?e:e.geometry);if(null==s)return null;switch(t){case"esriGeometryPoint":{let e=T;return r&&n?e=P:r?e=A:n&&(e=E),e(s)}case"esriGeometryMultipoint":return N(s,r,n);case"esriGeometryPolyline":return F(s,r,n);case"esriGeometryPolygon":return z(s,r,n);default:return p().error("convertToGeometry:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${t}'`)),null}}function q(e,t,r,n,s){if(le(e),null==r)return function(e,t){for(const r of t)e.push({attributes:r.attributes});return e}(e,t);switch(r){case"esriGeometryPoint":return function(e,t,r,i){let n=T;r&&i?n=P:r?n=A:i&&(n=E);for(const s of t){const{geometry:t,attributes:r}=s,i=null!=t?n(t):null;e.push({attributes:r,geometry:i})}return e}(e,t,n,s);case"esriGeometryMultipoint":return function(e,t,r,i){for(const{geometry:n,attributes:s}of t)e.push({attributes:s,geometry:null!=n?N(n,r,i):null});return e}(e,t,n,s);case"esriGeometryPolyline":return function(e,t,r,i){for(const{geometry:n,attributes:s}of t)e.push({attributes:s,geometry:null!=n?F(n,r,i):null});return e}(e,t,n,s);case"esriGeometryPolygon":return function(e,t,r,i){for(const{geometry:n,attributes:s,centroid:o}of t){const t=null!=n?z(n,r,i):null;if(null!=o){const r=T(o);e.push({attributes:s,centroid:r,geometry:t})}else e.push({attributes:s,geometry:t})}return e}(e,t,n,s);default:p().error("convertToFeatureSet:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${r}'`))}return e}function W(e){const{objectIdFieldName:t,spatialReference:r,transform:i,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:d}=e,p={features:q([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:t,spatialReference:r,uniqueIdField:u,queryGeometry:$(h,d,!1,!1)};return i&&(p.transform=i),c&&(p.exceededTransferLimit=c),s&&(p.hasM=s),o&&(p.hasZ=o),p}function Y(e,t){const r=new u.A,{hasM:n,hasZ:s,features:o,objectIdFieldName:a,spatialReference:l,geometryType:c,exceededTransferLimit:h,transform:d,fields:f}=e;return f&&(r.fields=f),r.geometryType=c??null,r.objectIdFieldName=a??t??null,r.spatialReference=l??null,r.objectIdFieldName?(o&&H(r.features,o,c,s,n,r.objectIdFieldName),h&&(r.exceededTransferLimit=h),n&&(r.hasM=n),s&&(r.hasZ=s),d&&(r.transform=d),r):(p().error(new i.A("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function X(e){const{transform:t,features:r,hasM:i,hasZ:n}=e;if(!t)return e;for(const s of r)null!=s.geometry&&ie(s.geometry,s.geometry,i,n,t),null!=s.centroid&&ie(s.centroid,s.centroid,i,n,t);return e.transform=null,e}function J(e,t){const{geometryType:r,features:i,hasM:n,hasZ:s}=t;if(!e)return t;for(let o=0;o<i.length;o++){const t=i[o],a=t.weakClone();a.geometry=new h.A,K(a.geometry,t.geometry,n,s,r,e),t.centroid&&(a.centroid=new h.A,K(a.centroid,t.centroid,n,s,"esriGeometryPoint",e)),i[o]=a}return t.transform=e,t}function K(e,t,r,i,n,s){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:r,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:i;if(ae(e),!t?.coords.length)return null;const l=f[n],{coords:c,lengths:u}=t,h=d(r,i),p=d(r&&o,i&&a),m=v(r,i,o,a);if(!u.length)return m(e.coords,c,0,0,b(s,c[0]),w(s,c[1])),ae(e,h,0),e;let g,y,_,x,S=0,T=0,M=T;for(const d of u){if(d<l)continue;let t=0;T=M,_=g=b(s,c[S]),x=y=w(s,c[S+1]),m(e.coords,c,T,S,_,x),t++,S+=h,T+=p;for(let r=1;r<d;r++,S+=h)_=b(s,c[S]),x=w(s,c[S+1]),_===g&&x===y||(m(e.coords,c,T,S,_-g,x-y),T+=p,t++,g=_,y=x);t>=l&&(e.lengths.push(t),M=T)}return le(e.coords,M),e.coords.length?e:null}function Q(e,t,r,i,n,s){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:r,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:i;if(ae(e),!t?.coords.length)return null;const l=f[n],{coords:c,lengths:u}=t,h=d(r,i),p=d(r&&o,i&&a),m=v(r,i,o,a);if(!u.length)return m(e.coords,c,0,0,c[0],c[1]),ae(e,h,0),e;let g=0;const y=s*s;for(const d of u){if(d<l){g+=d*h;continue}const t=e.coords.length/p,r=g,i=g+(d-1)*h;m(e.coords,c,e.coords.length,r,c[r],c[r+1]),te(e.coords,c,h,y,m,r,i),m(e.coords,c,e.coords.length,i,c[i],c[i+1]);const n=e.coords.length/p-t;n>=l?e.lengths.push(n):le(e.coords,t*p),g+=d*h}return e.coords.length?e:null}function ee(e,t,r,i){const n=e[t],s=e[t+1],o=e[r],a=e[r+1],l=e[i],c=e[i+1];let u=o,h=a,d=l-u,p=c-h;if(0!==d||0!==p){const e=((n-u)*d+(s-h)*p)/(d*d+p*p);e>1?(u=l,h=c):e>0&&(u+=d*e,h+=p*e)}return d=n-u,p=s-h,d*d+p*p}function te(e,t,r,i,n,s,o){let a,l=i,c=0;for(let u=s+r;u<o;u+=r)a=ee(t,u,s,o),a>l&&(c=u,l=a);l>i&&(c-s>r&&te(e,t,r,i,n,s,c),n(e,t,e.length,c,t[c],t[c+1]),o-c>r&&te(e,t,r,i,n,c,o))}function re(e,t,r,i){if(!t?.coords?.length)return null;const n=d(r,i);let s=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=n){const r=e[t],i=e[t+1];s=Math.min(s,r),c=Math.max(c,r),l=Math.min(l,i),u=Math.max(u,i)}}return(0,o.is)(e)?(0,o.BI)(e,s,l,c,u):(0,a.fA)(s,l,c,u,e),e}function ie(e,t,r,i,n){const{coords:o,lengths:a}=t,l=d(r,i);if(!o.length)return e!==t&&ae(e),e;(0,s.Lw)(n);const{originPosition:c,scale:u,translate:h}=n,p=ce;p.originPosition=c;const f=p.scale;f[0]=u[0]??1,f[1]=-(u[1]??1),f[2]=u[2]??1,f[3]=u[3]??1;const m=p.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!a.length){for(let t=0;t<l;++t)e.coords[t]=x(p,o[t],t);return e!==t&&ae(e,l,0),e}let g=0;for(let s=0;s<a.length;s++){const t=a[s];e.lengths[s]=t;for(let n=0;n<l;++n)e.coords[g+n]=x(p,o[g+n],n);let r=e.coords[g],i=e.coords[g+1];g+=l;for(let n=1;n<t;n++,g+=l){r+=o[g]*f[0],i+=o[g+1]*f[1],e.coords[g]=r,e.coords[g+1]=i;for(let t=2;t<l;++t)e.coords[g+t]=x(p,o[g+t],t)}}return e!==t&&ae(e,o.length,a.length),e}function ne(e,t,r,i,n,s){if(ae(e),e.lengths.push(...t.lengths),r===n&&i===s)for(let o=0;o<t.coords.length;o++)e.coords.push(t.coords[o]);else{const o=d(r,i),a=v(r,i,n,s),l=t.coords;for(let t=0;t<l.length;t+=o)a(e.coords,l,e.coords.length,t,l[t],l[t+1])}return e}function se(e,t,r,i){let n=0,s=e[i*t],o=e[i*(t+1)];for(let a=1;a<r;a++){const r=s+e[i*(t+a)],l=o+e[i*(t+a)+1],c=(r-s)*(l+o);s=r,o=l,n+=c}return.5*n}function oe(e,t){const{coords:r,lengths:i}=e;let n=0,s=0;for(let o=0;o<i.length;o++){const e=i[o];s+=se(r,n,e,t),n+=e}return Math.abs(s)}function ae(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;le(e.lengths,r),le(e.coords,t)}function le(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e.length!==t&&(e.length=t)}const ce={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},32535:(e,t,r)=>{"use strict";r.d(t,{EL:()=>g,RS:()=>y,gr:()=>c,wP:()=>h,wZ:()=>d});r(35238);var i=r(39356),n=(r(81806),r(53084)),s=r(78393),o=r(19902),a=r(18117),l=r(13312);function c(e){return"declaredClass"in e}function u(e){return"declaredClass"in e}function h(e,t){return e?function(e){return"declaredClass"in e}(e)?e:new i.A({layer:t,sourceLayer:t,visible:e.visible,symbol:(0,n.o8)(e.symbol),attributes:(0,n.o8)(e.attributes),geometry:d(e.geometry)}):null}function d(e){return null==e?null:c(e)?e:(0,o.rS)(function(e){const{wkid:t,wkt:r,wkt2:i,latestWkid:n}=e.spatialReference,s={wkid:t,wkt:r,wkt2:i,latestWkid:n};switch(e.type){case"point":{const{x:t,y:r,z:i,m:n}=e;return{x:t,y:r,z:i,m:n,spatialReference:s}}case"polygon":{const{rings:t,hasZ:r,hasM:i}=e;return{rings:p(t),hasZ:r,hasM:i,spatialReference:s}}case"polyline":{const{paths:t,hasZ:r,hasM:i}=e;return{paths:p(t),hasZ:r,hasM:i,spatialReference:s}}case"extent":{const{xmin:t,xmax:r,ymin:i,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:h}=e;return{xmin:t,xmax:r,ymin:i,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:h,spatialReference:s}}case"multipoint":{const{points:t,hasZ:r,hasM:i}=e;return{points:m(t)?f(t):t,hasZ:r,hasM:i,spatialReference:s}}default:return}}(e))}function p(e){return function(e){for(const t of e)if(0!==t.length)return m(t);return!1}(e)?e.map((e=>f(e))):e}function f(e){return e.map((e=>Array.from(e)))}function m(e){return e.length>0&&((0,s.vZ)(e[0])||(0,s.aI)(e[0]))}function g(e,t){if(!e)return null;let r;if(u(e)){if(null==t)return e.clone();if(u(t))return t.copy(e)}return null!=t?(r=t,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=void 0,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=(0,a.T)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}function y(e){const{wkid:t,wkt:r,wkt2:i,latestWkid:n}=e,s={wkid:t,wkt:r,wkt2:i,latestWkid:n};return l.A.fromJSON(s)}},82062:(e,t,r)=>{"use strict";var i;r.d(t,{$:()=>i}),function(e){e[e.EnableFastUpdates=0]="EnableFastUpdates",e[e.DisableFastUpdates=1]="DisableFastUpdates",e[e.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"}(i||(i={}))},12406:(e,t,r)=>{"use strict";r.d(t,{p:()=>o});var i=r(35143),n=r(46053),s=(r(81806),r(76460),r(47249),r(85842));const o=e=>{let t=class extends e{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):function(e){return"portalItem"in e}(this)?this.portalItem?.apiKey:null}set apiKey(e){null!=e?this._override("apiKey",e):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,i._)([(0,n.MZ)({type:String})],t.prototype,"apiKey",null),t=(0,i._)([(0,s.$)("esri.layers.mixins.APIKeyMixin")],t),t}},19502:(e,t,r)=>{"use strict";r.d(t,{b:()=>l});var i=r(35143),n=r(76460),s=r(46053),o=(r(81806),r(47249),r(85842)),a=r(13096);const l=e=>{let t=class extends e{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const e=(0,a.qg)(this.url);if(null!=e&&e.title)return e.title}return this._get("title")||""}set title(e){this._set("title",e)}set url(e){this._set("url",(0,a.Jf)(e,n.A.getLogger(this)))}};return(0,i._)([(0,s.MZ)()],t.prototype,"title",null),(0,i._)([(0,s.MZ)({type:String})],t.prototype,"url",null),t=(0,i._)([(0,o.$)("esri.layers.mixins.ArcGISService")],t),t}},65624:(e,t,r)=>{"use strict";r.d(t,{LF:()=>c,dM:()=>u,sU:()=>a});var i=r(35143),n=r(46053),s=(r(81806),r(76460),r(47249),r(85842)),o=r(66758);const a={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}},l={read:{reader:o.LF},write:{allowNull:!0,writer:o.M9}},c={json:{read:!1,write:!1,origins:{"web-map":l,"portal-item":l}}},u=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return(0,i._)([(0,n.MZ)(a)],t.prototype,"blendMode",void 0),(0,i._)([(0,n.MZ)(c)],t.prototype,"effect",void 0),t=(0,i._)([(0,s.$)("esri.layers.mixins.BlendLayer")],t),t}},31362:(e,t,r)=>{"use strict";r.d(t,{d:()=>o});var i=r(35143),n=r(46053),s=(r(81806),r(76460),r(47249),r(85842));const o=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return(0,i._)([(0,n.MZ)({type:Object,json:{write:{overridePolicy:e=>({enabled:!!(e&&Object.keys(e).length>0)})}}})],t.prototype,"customParameters",void 0),t=(0,i._)([(0,s.$)("esri.layers.mixins.CustomParametersMixin")],t),t}},61979:(e,t,r)=>{"use strict";r.d(t,{Jz:()=>h,Mk:()=>m,Zk:()=>p,dP:()=>d,gz:()=>y,w6:()=>_});var i=r(35143),n=r(54099),s=r(53084),o=r(50346),a=r(46053),l=(r(81806),r(76460),r(85842)),c=r(35298);const u=new n.A.EventEmitter;function h(e){return u.on("apply-edits",new WeakRef(e))}function d(e){return u.on("update-moment",new WeakRef(e))}function p(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=(0,o.Tw)();return i=null==t||i,u.emit("apply-edits",{serviceUrl:e,layerId:t,gdbVersion:r,mayReceiveServiceEdits:i,result:n.promise}),n}const f=Symbol();function m(e){return null!=e&&"object"==typeof e&&f in e}function g(e){return null!=e&&"object"==typeof e&&"gdbVersion"in e}function y(e,t,r){const i=new URL(e).host,n=c.Z3.get(i),s=e=>!e||e===n;return s(t)&&s(r)||t===r}const _=e=>{var t;let r=class extends e{constructor(){super(...arguments),this[t]=!0,this._applyEditsHandler=e=>{const{serviceUrl:t,layerId:r,gdbVersion:i,mayReceiveServiceEdits:n,result:o}=e,a=t===this.url,l=null!=r&&null!=this.layerId&&r===this.layerId,c=g(this),u=g(this)&&y(t,i,this.gdbVersion);if(!a||c&&!u||!l&&!n)return;const h=o.then((e=>{if(this.lastEditsEventDate=new Date,l&&(e.addedFeatures.length||e.updatedFeatures.length||e.deletedFeatures.length||e.addedAttachments.length||e.updatedAttachments.length||e.deletedAttachments.length))return this.emit("edits",(0,s.o8)(e)),e;const r=e.editedFeatures?.find((e=>{let{layerId:t}=e;return t===this.layerId}));if(r){const{adds:t,updates:i,deletes:n}=r.editedFeatures,o={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:t?t.map((e=>{let{attributes:t}=e;return{objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]}})):[],deletedFeatures:n?n.map((e=>{let{attributes:t}=e;return{objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]}})):[],updatedFeatures:i?i.map((e=>{let{current:{attributes:t}}=e;return{objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]}})):[],editedFeatures:(0,s.o8)(e.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,s.o8)(e.historicMoment)};return this.emit("edits",o),o}const n={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,s.o8)(e.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,s.o8)(e.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(t,i,n.historicMoment)&&this.emit("edits",n),n})).then((e=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(t,i,e.historicMoment)&&(this.historicMoment=e.historicMoment),e)));this.emit("apply-edits",{result:h})},this._updateMomentHandler=e=>{const{serviceUrl:t,gdbVersion:r,moment:i}=e,n=t===this.url,s=g(this),o=g(this)&&y(t,r,this.gdbVersion),a=g(this)&&!y(t,this.gdbVersion,null);n&&s&&o&&a&&"historicMoment"in this&&this.historicMoment!==i&&(this.historicMoment=i)},this.when().then((()=>{this.addHandles(h(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(d(this._updateMomentHandler))}),(()=>{}))}_shouldUpdateHistoricMoment(e,t,r){return"historicMoment"in this&&this.historicMoment!==r&&(0,c.w5)(e,t)}};return t=f,(0,i._)([(0,a.MZ)()],r.prototype,"lastEditsEventDate",void 0),r=(0,i._)([(0,l.$)("esri.layers.mixins.EditBusLayer")],r),r}},74440:(e,t,r)=>{"use strict";r.d(t,{F:()=>l,Y:()=>a});var i=r(35143),n=r(46053),s=(r(81806),r(76460),r(47249),r(85842));const o={write:{allowNull:!0}},a={type:r(10252).A,json:{origins:{"web-map":o,"portal-item":o}}},l=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return(0,i._)([(0,n.MZ)(a)],t.prototype,"featureEffect",void 0),t=(0,i._)([(0,s.$)("esri.layers.mixins.FeatureEffectLayer")],t),t}},67187:(e,t,r)=>{"use strict";r.d(t,{j:()=>L});var i=r(35143),n=r(19276),s=r(53084),o=r(76460),a=r(46053),l=(r(81806),r(28379)),c=r(85842),u=r(17707),h=r(80979),d=r(76797),p=r(91605),f=r(13312),m=r(13096),g=r(95363),y=r(69098),_=r(42553),v=(r(47249),r(67478));let b=class extends((0,y.O)(_.oY)){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};(0,i._)([(0,a.MZ)()],b.prototype,"creatorField",void 0),(0,i._)([(0,a.MZ)()],b.prototype,"creationDateField",void 0),(0,i._)([(0,a.MZ)()],b.prototype,"editorField",void 0),(0,i._)([(0,a.MZ)()],b.prototype,"editDateField",void 0),(0,i._)([(0,a.MZ)()],b.prototype,"realm",void 0),(0,i._)([(0,a.MZ)((0,v.P6)("dateFieldsTimeReference",!0))],b.prototype,"timeZone",void 0),b=(0,i._)([(0,c.$)("esri.layers.support.EditFieldsInfo")],b);const w=b;let x=class extends((0,y.O)(_.oY)){constructor(e){super(e)}};(0,i._)([(0,a.MZ)({constructOnly:!0,json:{write:!0}})],x.prototype,"name",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0,json:{write:!0}})],x.prototype,"fields",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0,json:{write:!0}})],x.prototype,"isAscending",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0,json:{write:!0}})],x.prototype,"indexType",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0,json:{write:!0}})],x.prototype,"isUnique",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0,json:{write:!0}})],x.prototype,"description",void 0),x=(0,i._)([(0,c.$)("esri.layers.support.FeatureIndex")],x);var S=r(91447),T=r(31633);let M=class extends((0,y.O)(_.oY)){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};(0,i._)([(0,a.MZ)({type:String,json:{read:{source:"shapeAreaFieldName"}}})],M.prototype,"shapeAreaField",void 0),(0,i._)([(0,a.MZ)({type:String,json:{read:{source:"shapeLengthFieldName"}}})],M.prototype,"shapeLengthField",void 0),(0,i._)([(0,a.MZ)({type:String,json:{read:e=>T.dk.read(e)||T.Sk.read(e)}})],M.prototype,"units",void 0),M=(0,i._)([(0,c.$)("esri.layers.support.GeometryFieldsInfo")],M);const A=M;var C=r(5618),E=r(23965),R=r(44141),P=r(76866);let O=class extends((0,y.O)(_.oY)){constructor(e){super(e),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(e){if(!e)return null;const t={};for(const r of Object.keys(e))t[r]=(0,P.rS)(e[r]);return t}writeDomains(e,t){if(!e)return;const r={};for(const i of Object.keys(e))e[i]&&(r[i]=e[i]?.toJSON());t.domains=r}};(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],O.prototype,"code",void 0),(0,i._)([(0,a.MZ)({type:Object,json:{write:!0}})],O.prototype,"defaultValues",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],O.prototype,"domains",void 0),(0,i._)([(0,l.w)("domains")],O.prototype,"readDomains",null),(0,i._)([(0,u.K)("domains")],O.prototype,"writeDomains",null),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],O.prototype,"name",void 0),O=(0,i._)([(0,c.$)("esri.layers.support.Subtype")],O);const I=O,L=e=>{let t=class extends e{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(n.A.ofType(x)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=f.A.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.version=void 0}get authenticationTriggerEvent(){if(!this.url)return null;const{capabilities:e}=this;if(e){const{query:t,operations:r,editing:i}=e;if(!t.supportsQueryByOthers||!t.supportsQueryByAnonymous)return"load";if(r.supportsEditing&&!(i.supportsUpdateByOthers&&i.supportsUpdateByAnonymous&&i.supportsDeleteByOthers&&i.supportsDeleteByAnonymous))return"load"}if(this.userHasUpdateItemPrivileges){if((0,S.tG)(this))return"load";if(this.hasUpdateItemRestrictions)return e.operations.supportsQuery?"editing":"load"}if(this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions)return"editing";const t=this.editFieldsInfo;return(t?.creatorField||t?.editorField)&&e?.operations.supportsEditing?"editing":null}readCapabilitiesFromService(e,t){return(0,R.S)(t,this.url)}readEditingInfo(e,t){const{editingInfo:r}=t;return r?{lastEditDate:null!=r.lastEditDate?new Date(r.lastEditDate):null}:null}get effectiveCapabilities(){const e=this.capabilities;if(!e)return null;const t=(0,s.o8)(e),{operations:r,editing:i}=t;return(0,S.Pt)(this)?(this.userHasUpdateItemPrivileges&&(r.supportsQuery=!0),t):this.userHasUpdateItemPrivileges?(r.supportsAdd=r.supportsDelete=r.supportsEditing=r.supportsQuery=r.supportsUpdate=i.supportsDeleteByOthers=i.supportsGeometryUpdate=i.supportsUpdateByOthers=!0,t):(this.userHasFullEditingPrivileges&&r.supportsEditing&&(r.supportsAdd=r.supportsDelete=r.supportsUpdate=i.supportsGeometryUpdate=!0),t)}readGlobalIdFieldFromService(e,t){return(0,S.jD)(t)}get hasFullEditingRestrictions(){const e=this.capabilities;if(!e||(0,S.Pt)(this))return!1;const{operations:t,editing:r}=e;return t.supportsEditing&&!(t.supportsAdd&&t.supportsDelete&&t.supportsUpdate&&r.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const e=this.capabilities;if(!e)return!1;const{operations:t,editing:r}=e;return(0,S.Pt)(this)?!t.supportsQuery:!(t.supportsAdd&&t.supportsDelete&&t.supportsEditing&&t.supportsQuery&&t.supportsUpdate&&r.supportsDeleteByOthers&&r.supportsGeometryUpdate&&r.supportsUpdateByOthers)}readIsTableFromService(e,t){return"Table"===t.type}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readMinScale(e,t){return t.effectiveMinScale||e||0}readObjectIdFieldFromService(e,t){return(0,S.Zm)(t)}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}set url(e){if(null==e)return void this._set("url",e);const t=(0,m.HZ)({layer:this,url:e,nonStandardUrlAllowed:!0,logger:o.A.getLogger(this)});this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)}writeUrl(e,t,r,i){(0,m.LS)(this,e,null,t,i)}readVersion(e,t){return(0,S.$4)(t)}};return(0,i._)([(0,a.MZ)({readOnly:!0})],t.prototype,"authenticationTriggerEvent",null),(0,i._)([(0,a.MZ)({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),(0,i._)([(0,a.MZ)({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],t.prototype,"capabilities",void 0),(0,i._)([(0,l.w)("service","capabilities")],t.prototype,"readCapabilitiesFromService",null),(0,i._)([(0,a.MZ)((0,v.P6)("dateFieldsTimeReference"))],t.prototype,"dateFieldsTimeZone",void 0),(0,i._)([(0,a.MZ)({type:Boolean})],t.prototype,"datesInUnknownTimezone",void 0),(0,i._)([(0,a.MZ)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],t.prototype,"definitionExpression",void 0),(0,i._)([(0,a.MZ)({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],t.prototype,"displayField",void 0),(0,i._)([(0,a.MZ)({readOnly:!0,type:w})],t.prototype,"editFieldsInfo",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],t.prototype,"editingInfo",void 0),(0,i._)([(0,l.w)("editingInfo")],t.prototype,"readEditingInfo",null),(0,i._)([(0,a.MZ)({readOnly:!0})],t.prototype,"effectiveCapabilities",null),(0,i._)([(0,a.MZ)((()=>{const e=(0,s.o8)(g.Yj),t=e.json.origins;return t["web-map"]={read:!1,write:!1},t["portal-item"]={read:!1,write:!1},e})())],t.prototype,"elevationInfo",void 0),(0,i._)([(0,a.MZ)({type:C.A,json:{name:"layerDefinition.floorInfo",write:!0,origins:{"web-scene":{name:"layerDefinition.floorInfo",write:{enabled:!0,layerContainerTypes:h.K}}}}})],t.prototype,"floorInfo",void 0),(0,i._)([(0,a.MZ)({type:d.A,json:{origins:{service:{read:{source:"extent"}}}}})],t.prototype,"fullExtent",void 0),(0,i._)([(0,a.MZ)()],t.prototype,"gdbVersion",void 0),(0,i._)([(0,a.MZ)({readOnly:!0,type:A,json:{read:{source:"geometryProperties"}}})],t.prototype,"geometryFieldsInfo",void 0),(0,i._)([(0,a.MZ)({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:S.iX.read}}}})],t.prototype,"geometryType",void 0),(0,i._)([(0,a.MZ)({type:String})],t.prototype,"globalIdField",void 0),(0,i._)([(0,l.w)("service","globalIdField",["globalIdField","fields"])],t.prototype,"readGlobalIdFieldFromService",null),(0,i._)([(0,a.MZ)({readOnly:!0})],t.prototype,"hasFullEditingRestrictions",null),(0,i._)([(0,a.MZ)({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasM",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],t.prototype,"hasUpdateItemRestrictions",null),(0,i._)([(0,a.MZ)({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasZ",void 0),(0,i._)([(0,a.MZ)({readOnly:!0,type:p.A})],t.prototype,"heightModelInfo",void 0),(0,i._)([(0,a.MZ)({type:Date})],t.prototype,"historicMoment",void 0),(0,i._)([(0,a.MZ)({type:n.A.ofType(x),readOnly:!0})],t.prototype,"indexes",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],t.prototype,"isTable",void 0),(0,i._)([(0,l.w)("service","isTable",["type"])],t.prototype,"readIsTableFromService",null),(0,i._)([(0,a.MZ)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],t.prototype,"layerId",void 0),(0,i._)([(0,a.MZ)(g.hG)],t.prototype,"maxScale",void 0),(0,i._)([(0,l.w)("service","maxScale",["maxScale","effectiveMaxScale"])],t.prototype,"readMaxScale",null),(0,i._)([(0,a.MZ)(g.hn)],t.prototype,"minScale",void 0),(0,i._)([(0,l.w)("service","minScale",["minScale","effectiveMinScale"])],t.prototype,"readMinScale",null),(0,i._)([(0,a.MZ)({type:String})],t.prototype,"objectIdField",void 0),(0,i._)([(0,l.w)("service","objectIdField",["objectIdField","fields"])],t.prototype,"readObjectIdFieldFromService",null),(0,i._)([(0,a.MZ)((0,v.P6)("preferredTimeReference"))],t.prototype,"preferredTimeZone",void 0),(0,i._)([(0,a.MZ)({type:[E.A],readOnly:!0})],t.prototype,"relationships",void 0),(0,i._)([(0,a.MZ)({type:Boolean})],t.prototype,"returnM",void 0),(0,i._)([(0,a.MZ)({type:Boolean})],t.prototype,"returnZ",void 0),(0,i._)([(0,a.MZ)({readOnly:!0,json:{write:!1}})],t.prototype,"serverGens",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],t.prototype,"serviceDefinitionExpression",void 0),(0,i._)([(0,l.w)("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],t.prototype,"readServiceDefinitionExpression",null),(0,i._)([(0,a.MZ)({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],t.prototype,"serviceItemId",void 0),(0,i._)([(0,a.MZ)()],t.prototype,"sourceJSON",void 0),(0,i._)([(0,a.MZ)({type:f.A,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],t.prototype,"spatialReference",void 0),(0,i._)([(0,a.MZ)({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],t.prototype,"subtypeField",void 0),(0,i._)([(0,a.MZ)({type:[I],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],t.prototype,"subtypes",void 0),(0,i._)([(0,a.MZ)({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],t.prototype,"trackIdField",void 0),(0,i._)([(0,a.MZ)(g.OZ)],t.prototype,"url",null),(0,i._)([(0,u.K)("url")],t.prototype,"writeUrl",null),(0,i._)([(0,a.MZ)({json:{origins:{service:{read:!0}},read:!1}})],t.prototype,"version",void 0),(0,i._)([(0,l.w)("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],t.prototype,"readVersion",null),t=(0,i._)([(0,c.$)("esri.layers.mixins.FeatureLayerBase")],t),t}},52908:(e,t,r)=>{"use strict";r.d(t,{J:()=>M});var i=r(35143),n=(r(63844),r(14873),r(47662),r(72690),r(86946),r(71832),r(5766)),s=(r(35039),r(86616),r(76460)),o=r(68134),a=r(46053),l=r(81806),c=(r(47249),r(85842)),u=r(3522),h=r(54490),d=r(77638),p=r(63040),f=(r(95444),r(50076)),m=r(53514),g=r(22993),y=r(33285),_=r(76940);l.A.add("esri-cluster-arcade-enabled",!0);const v=(0,l.A)("esri-cluster-arcade-enabled"),b=new Set(["simple-line","simple-fill","picture-fill"]);function w(e,t){let r=t.clone();if(!x(r))return r;if(t.getSymbols().some((e=>b.has(e.type)))&&(r=new n.A({symbol:new _.A})),r.authoringInfo||(r.authoringInfo=new y.A),r.authoringInfo.isAutoGenerated=!0,"visualVariables"in r){const t=(r.visualVariables||[]).filter((e=>"$view.scale"!==e.valueExpression));t.forEach((t=>{"rotation"===t.type?t.field?t.field=T(e,t.field,"avg_angle","number"):t.valueExpression&&(t.field=S(e,t.valueExpression,"avg_angle","number"),t.valueExpression=null):t.normalizationField?(t.field=T(e,t.field,"avg_norm","number",t.normalizationField),t.normalizationField=null):t.field?t.field=T(e,t.field,"avg","number"):t.valueExpression&&(t.field=S(e,t.valueExpression,"avg","number"),t.valueExpression=null)})),r.visualVariables=t}switch(r.type){case"simple":break;case"pie-chart":for(const t of r.attributes)t.field?t.field=T(e,t.field,"sum","number"):t.valueExpression&&(t.field=S(e,t.valueExpression,"sum","number"),t.valueExpression=null);break;case"unique-value":r.field?r.field=T(e,r.field,"mode","string"):r.valueExpression&&(r.field=S(e,r.valueExpression,"mode","string"),r.valueExpression=null);break;case"class-breaks":r.normalizationField?(r.field=T(e,r.field,"avg_norm","number",r.normalizationField),r.normalizationField=null):r.field?r.field=T(e,r.field,"avg","number"):r.valueExpression&&(r.field=S(e,r.valueExpression,"avg","number"),r.valueExpression=null)}return r}const x=e=>{const t=t=>s.A.getLogger("esri.views.2d.layers.support.clusterUtils").error(new f.A("Unsupported-renderer",t,{renderer:e}));if(!e)return!1;switch(e.type){case"unique-value":if(e.field2||e.field3)return t("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(e.normalizationField){const r=e.normalizationType;if("field"!==r)return t(`FeatureReductionCluster does not support a normalizationType of ${r}`),!1}break;case"simple":case"pie-chart":break;default:return t(`FeatureReductionCluster does not support renderers of type ${e.type}`),!1}if(!v){if("valueExpression"in e&&e.valueExpression)return t("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in e&&e.visualVariables||[]).some((e=>!(!("valueExpression"in e)||!e.valueExpression))))return t("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function S(e,t,r,i){const n=(0,m.d)(t),s="mode"===r?`cluster_type_${n}`:"sum"===r?`cluster_sum_${n}`:`cluster_avg_${n}`;return e.some((e=>e.name===s))||e.push(new u.A({name:s,isAutoGenerated:!0,onStatisticExpression:new g.A({expression:t,returnType:i}),statisticType:r})),s}function T(e,t,r,i,n){if("cluster_count"===t||e.some((e=>e.name===t)))return t;const s=function(e,t,r){switch(e){case"sum":return`cluster_sum_${t}`;case"avg":case"avg_angle":return`cluster_avg_${t}`;case"mode":return`cluster_type_${t}`;case"avg_norm":{const e=r,i="field",n=t.toLowerCase()+",norm:"+i+","+e.toLowerCase();return"cluster_avg_"+(0,m.d)(n)}}}(r,t,n);return e.some((e=>e.name===s))||("avg_norm"===r?e.push(new u.A({name:s,isAutoGenerated:!0,onStatisticExpression:new g.A({expression:`$feature.${t} / $feature.${n}`,returnType:i}),statisticType:"avg"})):e.push(new u.A({name:s,isAutoGenerated:!0,onStatisticField:t,statisticType:r}))),s}const M=e=>{let t=class extends e{constructor(){super(...arguments),this.addHandles((0,o.wB)((()=>this.renderer),(()=>{if(this.featureReduction){const e=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",e)}}),o.OH))}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}set renderer(e){}_withClusterVariable(e,t,r){const i=e.clone();return"visualVariables"in i&&(i.visualVariables||(i.visualVariables=[]),i.visualVariables.some((e=>"size"===e.type))||i.visualVariables.push(new d.A({field:"cluster_count",stops:[new p.A({value:1}),new p.A({useMinValue:!0,size:t}),new p.A({useMaxValue:!0,size:r})]}))),i}_normalizeFeatureReduction(e){if("cluster"!==e?.type)return e;const t=e.clone(),r=[new u.A({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],i=(t.fields??[]).filter((e=>!e.isAutoGenerated)),s=e.renderer&&!e.renderer.authoringInfo?.isAutoGenerated,{clusterMinSize:o,clusterMaxSize:a}=t;if(s){t.fields=[...r,...i];const e=this._withClusterVariable(t.renderer,o,a);return t.effectiveFeatureRenderer=e,t.effectiveClusterRenderer=e,t}if(e.symbol){if(t.fields=[...r,...i],t.renderer=null,!this.renderer)return t.effectiveFeatureRenderer=null,t.effectiveClusterRenderer=null,t;const s=w(r,this.renderer),l=this._withClusterVariable(s,o,a),c="visualVariables"in l&&l.visualVariables?l.visualVariables:[],u=new n.A({symbol:e.symbol,visualVariables:c});return t.fields=[...r,...i],t.effectiveFeatureRenderer=l,t.effectiveClusterRenderer=u,t}if(!this.renderer)return e;const l=w(r,this.renderer);t.fields=[...r,...i],t.renderer=l;const c=this._withClusterVariable(l,o,a);return t.effectiveFeatureRenderer=c,t.effectiveClusterRenderer=c,t}};return(0,i._)([(0,a.MZ)(h.d)],t.prototype,"featureReduction",null),t=(0,i._)([(0,c.$)("esri.layers.mixins.FeatureReductionLayer")],t),t}},11270:(e,t,r)=>{"use strict";r.d(t,{q:()=>b});var i=r(35143),n=r(82111),s=r(50076),o=r(90534),a=r(46053),l=r(40565),c=(r(47249),r(81806),r(28379)),u=r(85842),h=r(17707),d=r(80979),p=r(6527),f=r(29584);const m={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},g={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},y={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},_={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,Voxel:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":m,"web-map/basemap":g,"web-map/tables":y,"link-chart/operational-layers":{...m,LinkChartLayer:!0},"link-chart/basemap":g,"link-chart/tables":y,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0}};var v=r(95363);const b=e=>{let t=class extends e{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(e,t,r){return"Group Layer"===r?.portalItem?.type?void 0:e}writeListMode(e,t,r,i){(i&&"ground"===i.layerContainerType||e&&(0,f.R)(this,r,{},i))&&(t[r]=e)}writeOperationalLayerType(e,t,r,i){e&&"tables"!==i?.layerContainerType&&(t.layerType=e)}writeTitle(e,t){t.title=e??"Layer"}readTimeExtent(e){return e?n.A.fromArray(e):null}writeTimeExtent(e,t,r,i){e&&"tables"!==i.layerContainerType&&(e.isEmpty?i?.messages&&i.messages.push(new s.A("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):t[r]=e.toArray())}read(e,t){t&&(t.layer=this),(0,p.t)(this,e,(t=>super.read(e,t)),t)}write(e,t){if(!this.persistenceEnabled&&!t?.ignorePersistenceEnabled)return null;if(t?.origin){const e=`${t.origin}/${t.layerContainerType||"operational-layers"}`,r=_[e];let i=!!r?.[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===e&&(i=!1),"ArcGISDimensionLayer"===this.operationalLayerType&&"web-map/operational-layers"===e&&(i=!1),!i)return t.messages?.push(new s.A("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${e}'`,{layer:this})),null}const r=super.write(e,{...t,layer:this}),i=!!t&&!!t.messages&&!!t.messages.filter((e=>e instanceof s.A&&"web-document-write:property-required"===e.name)).length;return(0,o.w8)(r?.url)?(t?.messages?.push(new s.A("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&i?null:r}beforeSave(){}};return(0,i._)([(0,a.MZ)({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),(0,i._)([(0,c.w)("id",["id"])],t.prototype,"readId",null),(0,i._)([(0,a.MZ)(v.C1)],t.prototype,"listMode",void 0),(0,i._)([(0,h.K)("listMode")],t.prototype,"writeListMode",null),(0,i._)([(0,a.MZ)({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:d.K}}}}})],t.prototype,"operationalLayerType",void 0),(0,i._)([(0,h.K)("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),(0,i._)([(0,a.MZ)(v.ke)],t.prototype,"opacity",void 0),(0,i._)([(0,a.MZ)({type:Boolean,readOnly:!1})],t.prototype,"persistenceEnabled",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),(0,i._)([(0,h.K)("title"),(0,h.K)(["web-scene"],"title")],t.prototype,"writeTitle",null),(0,i._)([(0,a.MZ)({type:n.A,json:{origins:{"web-scene":{write:{layerContainerTypes:d.K}}}}})],t.prototype,"visibilityTimeExtent",void 0),(0,i._)([(0,c.w)("visibilityTimeExtent")],t.prototype,"readTimeExtent",null),(0,i._)([(0,h.K)(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[l.jz,l.Uv]]}})],t.prototype,"writeTimeExtent",null),(0,i._)([(0,a.MZ)({type:Boolean,json:{origins:{"web-scene":{name:"visibility",write:{enabled:!0,layerContainerTypes:d.K}}},name:"visibility",write:!0}})],t.prototype,"visible",void 0),t=(0,i._)([(0,u.$)("esri.layers.mixins.OperationalLayer")],t),t}},37534:(e,t,r)=>{"use strict";r.d(t,{f:()=>c,n:()=>l});var i=r(35143),n=r(48611),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(51162);const l={type:[a.A],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:function(e,t,r){if(!e)return null;const i=e.find((e=>!!e.field));if(!i)return null;const n=new a.A;return n.read(i,r),[n]}},write:{writer:function(e,t,r,i){const s=e.find((e=>!!e.field));s&&(0,n.sM)(r,[s.toJSON()],t)}}}},c=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return(0,i._)([(0,s.MZ)(l)],t.prototype,"orderBy",void 0),t=(0,i._)([(0,o.$)("esri.layers.mixins.OrderedLayer")],t),t}},94729:(e,t,r)=>{"use strict";r.d(t,{A:()=>x});var i=r(35143),n=r(86560),s=r(55171),o=r(3825),a=r(98773),l=r(50076),c=r(76460),u=r(30726),h=r(50346),d=r(90534),p=r(46053),f=(r(81806),r(47249),r(28379)),m=r(85842),g=r(17707),y=r(31933),_=r(65308),v=r(70652),b=r(38665),w=r(72945);const x=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,u.pR)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}readPortalItem(e,t,r){if(t.itemId)return new v.default({id:t.itemId,portal:r?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}async loadFromPortal(e,t){if(this.portalItem?.id)try{const{load:i}=await r.e(3814).then(r.bind(r,73814));return(0,h.Te)(t),await i({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData,layerModuleTypeMap:e.layerModuleTypeMap},t)}catch(i){throw(0,h.zf)(i)||c.A.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${i}`),i}}async finishLoadEditablePortalLayer(e){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(e).catch((e=>((0,h.QP)(e),!0))))}async setUserPrivileges(e,t){if(!n.A.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(t);if(this.url)try{const{features:{edit:r,fullEdit:i},content:{updateItem:n}}=await this._fetchUserPrivileges(e,t);this._set("userHasEditingPrivileges",r),this._set("userHasFullEditingPrivileges",i),this._set("userHasUpdateItemPrivileges",n)}catch(r){(0,h.QP)(r)}}async _fetchUserPrivileges(e,t){let r=this.portalItem;if(!e||!r||!r.loaded||r.sourceUrl)return this._fetchFallbackUserPrivileges(t);const i=e===r.id;if(i&&r.portal.user)return(0,w.It)(r);let n,o;if(i)n=r.portal.url;else try{n=await(0,y.wI)(this.url,t)}catch(u){(0,h.QP)(u)}if(!n||!(0,d.b8)(n,r.portal.url))return this._fetchFallbackUserPrivileges(t);try{const e=null!=t?t.signal:null;o=await(s.id?.getCredential(`${n}/sharing`,{prompt:!1,signal:e}))}catch(u){(0,h.QP)(u)}const a=!0,l=!1,c=!1;if(!o)return{features:{edit:a,fullEdit:l},content:{updateItem:c}};try{if(i?await r.reload():(r=new v.default({id:e,portal:{url:n}}),await r.load(t)),r.portal.user)return(0,w.It)(r)}catch(u){(0,h.QP)(u)}return{features:{edit:a,fullEdit:l},content:{updateItem:c}}}async _fetchFallbackUserPrivileges(e){let t=!0;try{t=await this._fetchUserHasEditingPrivileges(e)}catch(r){(0,h.QP)(r)}return{features:{edit:t,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(e){const t=this.url?s.id?.findCredential(this.url):null;if(!t)return!0;const r=S.credential===t?S.user:await this._fetchEditingUser(e);return S.credential=t,S.user=r,null==r?.privileges||r.privileges.includes("features:user:edit")}async _fetchEditingUser(e){const t=this.portalItem?.portal?.user;if(t)return t;const r=s.id?.findServerInfo(this.url??"");if(!r?.owningSystemUrl)return null;const i=`${r.owningSystemUrl}/sharing/rest`,n=_.A.getDefault();if(n&&n.loaded&&(0,d.S8)(n.restUrl)===(0,d.S8)(i))return n.user;const l=`${i}/community/self`,c=null!=e?e.signal:null,u=await(0,a.Ke)((0,o.A)(l,{authMode:"no-prompt",query:{f:"json"},signal:c}));return u.ok?b.A.fromJSON(u.value.data):null}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){const r=t?.portal,i=this.portalItem?.id&&(this.portalItem.portal||_.A.getDefault());return r&&i&&!(0,d.ut)(i.restUrl,r.restUrl)?(t.messages&&t.messages.push(new l.A("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,{...t,layer:this})}};return(0,i._)([(0,p.MZ)({type:v.default})],t.prototype,"portalItem",null),(0,i._)([(0,f.w)("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),(0,i._)([(0,g.K)("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),(0,i._)([(0,p.MZ)({clonable:!1})],t.prototype,"resourceReferences",void 0),(0,i._)([(0,p.MZ)({type:Boolean,readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),(0,i._)([(0,p.MZ)({type:Boolean,readOnly:!0})],t.prototype,"userHasFullEditingPrivileges",void 0),(0,i._)([(0,p.MZ)({type:Boolean,readOnly:!0})],t.prototype,"userHasUpdateItemPrivileges",void 0),t=(0,i._)([(0,m.$)("esri.layers.mixins.PortalLayer")],t),t},S={credential:null,user:null}},21617:(e,t,r)=>{"use strict";r.d(t,{J:()=>w,p:()=>b});var i=r(35143),n=(r(81806),r(76460)),s=r(50346),o=r(46053),a=r(21403),l=(r(47249),r(85842)),c=r(80979),u=r(19276),h=(r(98773),r(50076),r(68452),r(49281));const d=new u.A,p=new WeakMap;function f(e){m(e)&&d.push(new WeakRef(e))}function m(e){return null!=e&&"object"==typeof e&&"refreshInterval"in e&&"refresh"in e}function g(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:g(t,e%t):0}let y=0,_=0;function v(){const e=Date.now();let t=!1;for(const r of d){const i=r.deref();i?i.refreshInterval&&e-(p.get(i)??0)+5>=6e4*i.refreshInterval&&(p.set(i,e),i.refresh(e)):t=!0}if(t)for(let r=d.length-1;r>=0;r--)d.at(r).deref()||d.removeAt(r)}(0,h.fm)((()=>{const e=Date.now();let t=0;for(const r of d){const i=r.deref();i&&(t=g(Math.round(6e4*i.refreshInterval),t),i.refreshInterval?p.get(i)||p.set(i,e):p.delete(i))}if(t!==_){if(_=t,clearInterval(y),0===_)return void(y=0);y=setInterval(v,_)}}));function b(e){return null!=e&&"object"==typeof e&&"refreshTimestamp"in e&&"refresh"in e}const w=e=>{let t=class extends e{constructor(){super(...arguments),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=(0,s.sg)((()=>this.hasDataChanged())),this.when().then((()=>{this.destroyed||f(this)}),(()=>{}))}destroy(){!function(e){const t=d.find((t=>t.deref()===e));t&&d.remove(t)}(this)}castRefreshInterval(e){return e>=.1?e:e<=0?0:.1}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();(0,s.QZ)(this._debounceHasDataChanged()).then((t=>{t&&this._set("refreshTimestamp",e),this.emit("refresh",{dataChanged:t})}),(e=>{n.A.getLogger(this).error(e),this.emit("refresh",{dataChanged:!1,error:e})}))}async hasDataChanged(){return!0}get test(){}};return(0,i._)([(0,o.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:c.K}}}}})],t.prototype,"refreshInterval",void 0),(0,i._)([(0,a.w)("refreshInterval")],t.prototype,"castRefreshInterval",null),(0,i._)([(0,o.MZ)({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],t.prototype,"refreshParameters",null),t=(0,i._)([(0,l.$)("esri.layers.mixins.RefreshableLayer")],t),t}},5682:(e,t,r)=>{"use strict";r.d(t,{j:()=>o});var i=r(35143),n=r(46053),s=(r(81806),r(76460),r(47249),r(85842));const o=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const e={minScale:this.minScale,maxScale:this.maxScale},t=this.parent;t&&"effectiveScaleRange"in t&&function(e,t){e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale}(e,t.effectiveScaleRange);const r=this._get("effectiveScaleRange");return r&&r.minScale===e.minScale&&r.maxScale===e.maxScale?r:e}};return(0,i._)([(0,n.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),(0,i._)([(0,n.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),(0,i._)([(0,n.MZ)({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=(0,i._)([(0,s.$)("esri.layers.mixins.ScaleRangeLayer")],t),t}},78817:(e,t,r)=>{"use strict";r.d(t,{B:()=>p,e:()=>f});var i=r(35143),n=r(82111),s=r(53666),o=r(46053),a=(r(81806),r(76460),r(47249),r(28379)),l=r(85842),c=r(80979),u=r(53430),h=r(83982),d=r(90115);const p={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:c.K}}},f=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(e,t){const r=t.timeInfo.exportOptions;if(!r)return null;const i=r.timeOffset,n=d.j.fromJSON(r.timeOffsetUnits);return i&&n?new s.A({value:i,unit:n}):null}set timeInfo(e){(0,u.sv)(e,this.fieldsIndex),this._set("timeInfo",e)}};return(0,i._)([(0,o.MZ)({type:n.A,json:{write:!1}})],t.prototype,"timeExtent",void 0),(0,i._)([(0,o.MZ)({type:s.A})],t.prototype,"timeOffset",void 0),(0,i._)([(0,a.w)("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),(0,i._)([(0,o.MZ)({value:null,type:h.A,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),(0,i._)([(0,o.MZ)(p)],t.prototype,"useViewTime",void 0),t=(0,i._)([(0,l.$)("esri.layers.mixins.TemporalLayer")],t),t}},3522:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var i,n=r(35143),s=r(42553),o=r(53084),a=r(46053),l=(r(81806),r(76460),r(85842)),c=r(22993);let u=i=class extends s.oY{constructor(e){super(e),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new i({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:(0,o.o8)(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};(0,n._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],u.prototype,"isAutoGenerated",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"name",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"alias",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"onStatisticField",void 0),(0,n._)([(0,a.MZ)({type:c.A,json:{write:!0}})],u.prototype,"onStatisticExpression",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"statisticType",void 0),u=i=(0,n._)([(0,l.$)("esri.layers.support.AggregateField")],u);const h=u},92115:(e,t,r)=>{"use strict";r.d(t,{H:()=>l});var i,n=r(35143),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842));let l=i=class extends s.oY{constructor(e){super(e),this.name=null,this.code=null}clone(){return new i({name:this.name,code:this.code})}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"name",void 0),(0,n._)([(0,o.MZ)({type:[String,Number],json:{write:!0}})],l.prototype,"code",void 0),l=i=(0,n._)([(0,a.$)("esri.layers.support.CodedValue")],l)},72599:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i,n=r(35143),s=r(53084),o=r(46053),a=(r(81806),r(76460),r(6409)),l=r(85842),c=r(92115),u=r(44631);let h=i=class extends u.A{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const r=String(e);this.codedValues.some((e=>(String(e.code)===r&&(t=e.name),!!t)))}return t}clone(){return new i({codedValues:(0,s.o8)(this.codedValues),name:this.name})}};(0,n._)([(0,o.MZ)({type:[c.H],json:{write:!0}})],h.prototype,"codedValues",void 0),(0,n._)([(0,a.e)({codedValue:"coded-value"})],h.prototype,"type",void 0),h=i=(0,n._)([(0,l.$)("esri.layers.support.CodedValueDomain")],h);const d=h},44631:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var i=r(35143),n=r(45802),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(6409)),l=r(85842);const c=new n.J({inherited:"inherited",codedValue:"coded-value",range:"range"});let u=class extends s.oY{constructor(e){super(e),this.name=null,this.type=null}};(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],u.prototype,"name",void 0),(0,i._)([(0,a.e)(c)],u.prototype,"type",void 0),u=(0,i._)([(0,l.$)("esri.layers.support.Domain")],u);const h=u},96138:(e,t,r)=>{"use strict";r.d(t,{VR:()=>p,hX:()=>d});r(35238),r(81806);var i=r(54901),n=r(76460),s=r(31633),o=r(2413),a=r(45417),l=r(19247);const c=()=>n.A.getLogger("esri.layers.support.ElevationSampler");class u{queryElevation(e){return p(e.clone(),this)}on(){return(0,i.hA)()}projectIfRequired(e,t){return f(e,t)}}class h extends u{get spatialReference(){return this.extent.spatialReference}constructor(e,t,r){super(),this.tile=e,this.noDataValue=r;const i=e.tile.extent;this.extent=(0,o.w1)(i,t.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=i;const n=(0,s.GA)(t.spatialReference),a=t.lodAt(e.tile.level).resolution*n;this.demResolution={min:a,max:a}}contains(e){const t=this.projectIfRequired(e,this.spatialReference);return null!=t&&this.containsAt(t.x,t.y)}containsAt(e,t){return(0,o.Rj)(this._aaExtent,e,t)}elevationAt(e,t){if(!this.containsAt(e,t)){const r=this.extent,i=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return c().warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${i})`),this.noDataValue}return this.tile.sample(e,t)??this.noDataValue}}class d extends u{get spatialReference(){return this.extent.spatialReference}constructor(e,t,r){let i;super(),"number"==typeof t?(this.noDataValue=t,i=null):(i=t,this.noDataValue=r),this.samplers=i?e.map((e=>new h(e,i,this.noDataValue))):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:e,max:t}=n.demResolution;this.demResolution={min:e,max:t};for(let r=1;r<this.samplers.length;r++){const e=this.samplers[r];this.extent.union(e.extent),this.demResolution.min=Math.min(this.demResolution.min,e.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,e.demResolution.max)}}else this.extent=(0,o.w1)((0,o.vt)(),i.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,t){let r,i=!1;for(const n of this.samplers)if(n.containsAt(e,t)&&(i=!0,r=n.elevationAt(e,t),r!==n.noDataValue))return r;return null!=r?r:(i||c().warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler`),this.noDataValue)}}function p(e,t){const r=f(e,t.spatialReference);if(!r)return null;switch(e.type){case"point":!function(e,t,r){e.z=r.elevationAt(t.x,t.y)}(e,r,t);break;case"polyline":!function(e,t,r){m.spatialReference=t.spatialReference;const i=e.hasM&&!e.hasZ;for(let n=0;n<e.paths.length;n++){const s=e.paths[n],o=t.paths[n];for(let e=0;e<s.length;e++){const t=s[e],n=o[e];m.x=n[0],m.y=n[1],i&&(t[3]=t[2]),t[2]=r.elevationAt(m.x,m.y)}}e.hasZ=!0}(e,r,t);break;case"multipoint":!function(e,t,r){m.spatialReference=t.spatialReference;const i=e.hasM&&!e.hasZ;for(let n=0;n<e.points.length;n++){const s=e.points[n],o=t.points[n];m.x=o[0],m.y=o[1],i&&(s[3]=s[2]),s[2]=r.elevationAt(m.x,m.y)}e.hasZ=!0}(e,r,t)}return e}function f(e,t){if(null==e)return null;const r=e.spatialReference;if(r.equals(t))return e;const i=(0,a.Cv)(e,t);return i||c().error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),i}const m=new l.A},38205:(e,t,r)=>{"use strict";r.d(t,{Q:()=>i});class i{constructor(e,t){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(t[2]-t[0]),this.dy=(e.width-1)/(t[3]-t[1]),this.x0=t[0],this.y1=t[3]}}},22993:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i=r(35143),n=r(69098),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842));let l=class extends((0,n.O)(s.oY)){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"expression",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"title",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"returnType",void 0),l=(0,i._)([(0,a.$)("esri.layers.support.ExpressionInfo")],l);const c=l},10252:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var i,n=r(35143),s=r(50076),o=r(42553),a=r(48611),l=r(46053),c=(r(81806),r(76460),r(47249),r(85842)),u=r(66758),h=r(8203);const d={read:{reader:u.LF},write:{writer:u.M9,overridePolicy(){return{allowNull:null!=this.excludedEffect,isRequired:null==this.excludedEffect}}}},p={read:{reader:u.LF},write:{writer:u.M9,overridePolicy(){return{allowNull:null!=this.includedEffect,isRequired:null==this.includedEffect}}}},f={name:"showExcludedLabels",default:!0};let m=i=class extends o.oY{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){const r=super.write(e,t);if(t?.origin){if(r.filter){const e=Object.keys(r.filter);if(e.length>1||"where"!==e[0])return t.messages?.push(new s.A("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in r)return t.messages?.push(new s.A("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return r}clone(){return new i({filter:null!=this.filter?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};(0,n._)([(0,l.MZ)({type:h.A,json:{write:{allowNull:!0,writer(e,t,r,i){const n=e?.write({},i);n&&0!==Object.keys(n).length?(0,a.sM)(r,n,t):(0,a.sM)(r,null,t)}}}})],m.prototype,"filter",void 0),(0,n._)([(0,l.MZ)({json:{read:u.LF,write:{writer:u.M9,allowNull:!0},origins:{"web-map":d,"portal-item":d}}})],m.prototype,"includedEffect",void 0),(0,n._)([(0,l.MZ)({json:{read:u.LF,write:{writer:u.M9,allowNull:!0},origins:{"web-map":p,"portal-item":p}}})],m.prototype,"excludedEffect",void 0),(0,n._)([(0,l.MZ)({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":f,"portal-item":f}}})],m.prototype,"excludedLabelsVisible",void 0),m=i=(0,n._)([(0,c.$)("esri.layers.support.FeatureEffect")],m);const g=m},8203:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var i,n=r(35143),s=r(35238),o=r(82111),a=r(45802),l=r(42553),c=r(53084),u=r(46053),h=(r(81806),r(76460),r(85842)),d=r(68295);const p=new a.J({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),f=new a.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let m=i=class extends l.oY{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{where:t,geometry:r,spatialRelationship:i,timeExtent:n,objectIds:s,units:o,distance:a}=this;return new d.A({geometry:(0,c.o8)(r),objectIds:(0,c.o8)(s),spatialRelationship:i,timeExtent:(0,c.o8)(n),where:t,units:o,distance:a,...e})}clone(){const{where:e,geometry:t,spatialRelationship:r,timeExtent:n,objectIds:s,units:o,distance:a}=this;return new i({geometry:(0,c.o8)(t),objectIds:(0,c.o8)(s),spatialRelationship:r,timeExtent:(0,c.o8)(n),where:e,units:o,distance:a})}};(0,n._)([(0,u.MZ)({type:String,json:{write:!0}})],m.prototype,"where",void 0),(0,n._)([(0,u.MZ)({types:s.yR,json:{write:!0}})],m.prototype,"geometry",void 0),(0,n._)([(0,u.MZ)({type:p.apiValues,json:{name:"spatialRel",read:{reader:p.read},write:{allowNull:!1,writer:p.write,overridePolicy(){return{enabled:null!=this.geometry}}}}})],m.prototype,"spatialRelationship",void 0),(0,n._)([(0,u.MZ)({type:Number,json:{write:{overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],m.prototype,"distance",void 0),(0,n._)([(0,u.MZ)({type:[Number],json:{write:!0}})],m.prototype,"objectIds",void 0),(0,n._)([(0,u.MZ)({type:f.apiValues,json:{read:f.read,write:{writer:f.write,overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],m.prototype,"units",void 0),(0,n._)([(0,u.MZ)({type:o.A,json:{write:!0}})],m.prototype,"timeExtent",void 0),m=i=(0,n._)([(0,h.$)("esri.layers.support.FeatureFilter")],m);const g=m},80524:(e,t,r)=>{"use strict";r.d(t,{c:()=>a});var i=r(35143),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842));let a=class extends n.oY{constructor(){super(...arguments),this.type=null}};(0,i._)([(0,s.MZ)({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,i._)([(0,o.$)("esri.layers.support.FeatureReduction")],a)},89672:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(80524);let l=i=class extends a.c{constructor(e){super(e),this.type="selection"}clone(){return new i}};(0,n._)([(0,s.MZ)({type:["selection"]})],l.prototype,"type",void 0),l=i=(0,n._)([(0,o.$)("esri.layers.support.FeatureReductionSelection")],l);const c=l},15427:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var i=r(35143),n=r(69098),s=r(45802),o=r(42553),a=r(46053),l=(r(81806),r(76460),r(47249),r(85842));const c=new s.J({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let u=class extends((0,n.O)(o.oY)){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};(0,i._)([(0,a.MZ)({json:{write:!0}})],u.prototype,"name",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],u.prototype,"description",void 0),(0,i._)([(0,a.MZ)({json:{read:c.read,write:c.write}})],u.prototype,"drawingTool",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],u.prototype,"prototype",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],u.prototype,"thumbnail",void 0),u=(0,i._)([(0,l.$)("esri.layers.support.FeatureTemplate")],u);const h=u},91485:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var i=r(35143),n=r(69098),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(28379)),l=r(85842),c=r(17707),u=r(76866),h=r(15427);let d=class extends((0,n.O)(s.oY)){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const r of Object.keys(e))t[r]=(0,u.rS)(e[r]);return t}writeDomains(e,t){const r={};for(const i of Object.keys(e))e[i]&&(r[i]=e[i]?.toJSON());t.domains=r}};(0,i._)([(0,o.MZ)({json:{write:!0}})],d.prototype,"id",void 0),(0,i._)([(0,o.MZ)({json:{write:!0}})],d.prototype,"name",void 0),(0,i._)([(0,o.MZ)({json:{write:!0}})],d.prototype,"domains",void 0),(0,i._)([(0,a.w)("domains")],d.prototype,"readDomains",null),(0,i._)([(0,c.K)("domains")],d.prototype,"writeDomains",null),(0,i._)([(0,o.MZ)({type:[h.A],json:{write:!0}})],d.prototype,"templates",void 0),d=(0,i._)([(0,l.$)("esri.layers.support.FeatureType")],d);const p=d},44135:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var i,n=r(35143),s=r(45802),o=r(42553),a=r(46053),l=r(40565),c=(r(47249),r(81806),r(6409)),u=r(28379),h=r(85842),d=r(76866),p=r(6127);const f=new s.J({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let m=i=class extends o.oY{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(e,t){let{description:r}=t,i=null;try{i=r?JSON.parse(r):null}catch(n){}return i?.value??null}readValueType(e,t){let{description:r}=t,i=null;try{i=r?JSON.parse(r):null}catch(n){}return i?f.fromJSON(i.fieldValueType):null}clone(){return new i({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain?.clone()??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],m.prototype,"alias",void 0),(0,n._)([(0,a.MZ)({type:[String,Number],json:{write:{allowNull:!0}}})],m.prototype,"defaultValue",void 0),(0,n._)([(0,a.MZ)()],m.prototype,"description",void 0),(0,n._)([(0,u.w)("description")],m.prototype,"readDescription",null),(0,n._)([(0,a.MZ)({types:d.gK,json:{read:{reader:d.rS},write:!0}})],m.prototype,"domain",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],m.prototype,"editable",void 0),(0,n._)([(0,a.MZ)({type:l.jz,json:{write:{overridePolicy:e=>({enabled:Number.isFinite(e)})}}})],m.prototype,"length",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],m.prototype,"name",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],m.prototype,"nullable",void 0),(0,n._)([(0,c.e)(p.m)],m.prototype,"type",void 0),(0,n._)([(0,a.MZ)()],m.prototype,"valueType",void 0),(0,n._)([(0,u.w)("valueType",["description"])],m.prototype,"readValueType",null),(0,n._)([(0,a.MZ)({type:Boolean,json:{read:!1}})],m.prototype,"visible",void 0),m=i=(0,n._)([(0,h.$)("esri.layers.support.Field")],m);const g=m},1900:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i=r(50076),n=r(42553),s=r(76460),o=r(87663),a=r(64920),l=r(53430),c=r(67478),u=r(24241);const h=new Map;class d{static fromJSON(e){return new d(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new d(e.fields??[],g(e))}static fromLayerJSON(e){return new d(e.fields??[],g(e))}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=t?new Map(t):null;const r=[];for(const i of this.fields){const e=i?.name,t=f(e);if(e&&t){const n=p(e);this._fieldsMap.set(e,i),this._fieldsMap.set(n,i),this._normalizedFieldsMap.set(t,i),r.push(`${n}:${i.type}:${this._timeZoneByFieldName?.get(e)}`),(0,l.vE)(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):(0,l.WA)(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),(0,l.te)(i)||(0,l.Xz)(i)||(i.editable=null==i.editable||!!i.editable,i.nullable=null==i.nullable||!!i.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)(0,l.te)(e)||(0,l.Xz)(e)||e.nullable||void 0!==(0,l.lD)(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let t=this._fieldsMap.get(e);return t||(t=this._fieldsMap.get(p(e))??this._normalizedFieldsMap.get(f(e)),t&&this._fieldsMap.set(e,t),t)}getTimeZone(e){const t=this.get(e&&"string"!=typeof e?e.name:e);return t?this._timeZoneByFieldName?this._timeZoneByFieldName.get(t.name):"date"===t.type||"esriFieldTypeDate"===t.type?(s.A.getLogger("esri.layers.support.FieldsIndex").error(new i.A("getTimeZone:no-timezone-information",`no time zone information for field '${t.name}'`)),c.n$):m.has(t.type)?c.L5:null:null}getLuxonTimeZone(e){const t=this.getTimeZone(e);return t?t===c.L5?a.GB.instance:t===c.n$?u.mQ.utcInstance:(0,o.tE)(h,t,(()=>u.oh.create(t))):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return(0,l.OH)(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map((e=>(0,n.Wj)(e)?e.toJSON():e)),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function p(e){return e.trim().toLowerCase()}function f(e){return(0,l.rS)(e)?.toLowerCase()??""}const m=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function g(e){const t=new Map;if(!e.fields)return t;const r=!0===e.datesInUnknownTimezone,{timeInfo:i,editFieldsInfo:n}=e,s=(i?"startField"in i?i.startField:i.startTimeField:"")??"",o=(i?"endField"in i?i.endField:i.endTimeField:"")??"",a=function(e){return"dateFieldsTimeZone"in e}(e)?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?(0,c.ZS)(e.dateFieldsTimeReference):null,l=n?function(e){return"timeZone"in e}(n)?n.timeZone??a:n.dateFieldsTimeReference?(0,c.ZS)(n.dateFieldsTimeReference):a??c.n$:null,u=i?function(e){return"timeZone"in e}(i)?i.timeZone??a:i.timeReference?(0,c.ZS)(i.timeReference):a:null,h=new Map([[p(n?.creationDateField??""),l],[p(n?.editDateField??""),l],[p(s),u],[p(o),u]]);for(const{name:d,type:f}of e.fields)if(m.has(f))t.set(d,c.L5);else if("date"!==f&&"esriFieldTypeDate"!==f)t.set(d,null);else if(r)t.set(d,c.L5);else{const e=h.get(p(d??""))??a;t.set(d,e)}return t}},32173:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i,n=r(35143),s=(r(76460),r(81806),r(47249),r(50076),r(6409)),o=r(85842),a=r(44631);let l=i=class extends a.A{constructor(e){super(e),this.type="inherited"}clone(){return new i}};(0,n._)([(0,s.e)({inherited:"inherited"})],l.prototype,"type",void 0),l=i=(0,n._)([(0,o.$)("esri.layers.support.InheritedDomain")],l);const c=l},22848:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(42553),o=r(46053),a=r(40565),l=(r(47249),r(81806),r(85842));let c=i=class extends s.oY{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new i({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};(0,n._)([(0,o.MZ)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"cols",void 0),(0,n._)([(0,o.MZ)({type:a.jz,json:{write:!0}})],c.prototype,"level",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0),(0,n._)([(0,o.MZ)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"origin",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0),(0,n._)([(0,o.MZ)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"rows",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"scale",void 0),c=i=(0,n._)([(0,l.$)("esri.layers.support.LOD")],c);const u=c},71401:(e,t,r)=>{"use strict";r.d(t,{A:()=>A});var i,n=r(35143),s=r(95444),o=(r(81806),r(45802)),a=r(42553),l=r(53084),c=r(76931),u=r(46053),h=(r(76460),r(28379)),d=r(85842),p=r(17707),f=(r(47249),r(65460));let m=i=class extends a.oY{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?(0,f.mX)(t.value):e}writeExpression(e,t,r){null!=this.value&&(e=(0,f.mX)(this.value)),null!=e&&(t[r]=e)}clone(){return new i({expression:this.expression,title:this.title,value:this.value})}};(0,n._)([(0,u.MZ)({type:String,json:{write:{writerEnsuresNonNull:!0}}})],m.prototype,"expression",void 0),(0,n._)([(0,h.w)("expression",["expression","value"])],m.prototype,"readExpression",null),(0,n._)([(0,p.K)("expression")],m.prototype,"writeExpression",null),(0,n._)([(0,u.MZ)({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],m.prototype,"title",void 0),(0,n._)([(0,u.MZ)({json:{read:!1,write:!1}})],m.prototype,"value",void 0),m=i=(0,n._)([(0,d.$)("esri.layers.support.LabelExpressionInfo")],m);const g=m;var y,_=r(31933),v=r(84202),b=r(10609);const w=new o.J({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function x(e,t,r){return{enabled:!(0,_.TU)(r?.layer)}}function S(e){return!e||"service"!==e.origin&&!("map-image"===e.layer?.type)}function T(e){return!!function(e){return"map-image"===e?.type}(e)&&!!e.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}let M=y=class extends a.oY{static evaluateWhere(e,t){const r=(e,t,r)=>{switch(t){case"=":return e==r;case"<>":return e!=r;case">":return e>r;case">=":return e>=r;case"<":return e<r;case"<=":return e<=r}return!1};try{if(null==e)return!0;const i=e.split(" ");if(3===i.length)return r(t[i[0]],i[1],i[2]);if(7===i.length){const e=r(t[i[0]],i[1],i[2]),n=i[3],s=r(t[i[4]],i[5],i[6]);switch(n){case"AND":return e&&s;case"OR":return e||s}}return!1}catch(i){}}constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=v.Hk,this.useCodedValues=void 0,this.where=null}readLabelExpression(e,t){const r=t.labelExpressionInfo;if(!r||!r.value&&!r.expression)return e}writeLabelExpression(e,t,r){if(this.labelExpressionInfo)if(null!=this.labelExpressionInfo.value)e=(0,f.D3)(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){const t=(0,f.tH)(this.labelExpressionInfo.expression);t&&(e="["+t+"]")}null!=e&&(t[r]=e)}writeLabelExpressionInfo(e,t,r,i){if(null==e&&null!=this.labelExpression&&S(i))e=new g({expression:this.getLabelExpressionArcade()});else if(!e)return;const n=e.toJSON(i);n.expression&&(t[r]=n)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return(0,f.XJ)(this)}getLabelExpressionArcade(){return(0,f.BI)(this)}getLabelExpressionSingleField(){return(0,f.rU)(this)}hash(){return JSON.stringify(this)}clone(){return new y({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:(0,l.o8)(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:(0,l.o8)(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};(0,n._)([(0,u.MZ)({type:String,json:{write:!0}})],M.prototype,"name",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:x}}}}})],M.prototype,"allowOverrun",void 0),(0,n._)([(0,u.MZ)({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:x}}}}})],M.prototype,"deconflictionStrategy",void 0),(0,n._)([(0,u.MZ)({type:String,json:{write:{overridePolicy(e,t,r){return this.labelExpressionInfo&&"service"===r?.origin&&T(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],M.prototype,"labelExpression",void 0),(0,n._)([(0,h.w)("labelExpression")],M.prototype,"readLabelExpression",null),(0,n._)([(0,p.K)("labelExpression")],M.prototype,"writeLabelExpression",null),(0,n._)([(0,u.MZ)({type:g,json:{write:{overridePolicy:(e,t,r)=>function(e){return S(e)||T(e?.layer)}(r)?{allowNull:!0}:{enabled:!1}}}})],M.prototype,"labelExpressionInfo",void 0),(0,n._)([(0,p.K)("labelExpressionInfo")],M.prototype,"writeLabelExpressionInfo",null),(0,n._)([(0,u.MZ)({type:w.apiValues,json:{type:w.jsonValues,read:w.read,write:w.write}})],M.prototype,"labelPlacement",void 0),(0,n._)([(0,u.MZ)({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],M.prototype,"labelPosition",void 0),(0,n._)([(0,u.MZ)({type:Number})],M.prototype,"maxScale",void 0),(0,n._)([(0,p.K)("maxScale")],M.prototype,"writeMaxScale",null),(0,n._)([(0,u.MZ)({type:Number})],M.prototype,"minScale",void 0),(0,n._)([(0,p.K)("minScale")],M.prototype,"writeMinScale",null),(0,n._)([(0,u.MZ)({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:x}}}}})],M.prototype,"repeatLabel",void 0),(0,n._)([(0,u.MZ)({type:Number,cast:c.cr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:x}}}}})],M.prototype,"repeatLabelDistance",void 0),(0,n._)([(0,u.MZ)({types:s.em,json:{origins:{"web-scene":{types:s.Rv,write:b.oO,default:null}},write:b.oO,default:null}})],M.prototype,"symbol",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{write:!0}})],M.prototype,"useCodedValues",void 0),(0,n._)([(0,u.MZ)({type:String,json:{write:!0}})],M.prototype,"where",void 0),M=y=(0,n._)([(0,d.$)("esri.layers.support.LabelClass")],M);const A=M},5618:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(19276),o=r(42553),a=r(46053),l=(r(81806),r(76460),r(47249),r(85842));let c=i=class extends o.oY{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new s.A}clone(){return new i({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"floorField",void 0),(0,n._)([(0,a.MZ)({json:{read:!1,write:!1}})],c.prototype,"viewAllMode",void 0),(0,n._)([(0,a.MZ)({json:{read:!1,write:!1}})],c.prototype,"viewAllLevelIds",void 0),c=i=(0,n._)([(0,l.$)("esri.layers.support.LayerFloorInfo")],c);const u=c},51162:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var i,n=r(35143),s=r(45802),o=r(42553),a=r(46053),l=(r(81806),r(76460),r(47249),r(85842));const c=new s.J({asc:"ascending",desc:"descending"});let u=i=class extends o.oY{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new i({field:this.field,valueExpression:this.valueExpression,order:this.order})}};(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"field",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],u.prototype,"valueExpression",void 0),(0,n._)([(0,a.MZ)({type:c.apiValues,json:{type:c.jsonValues,read:c.read,write:c.write}})],u.prototype,"order",void 0),u=i=(0,n._)([(0,l.$)("esri.layers.support.OrderByInfo")],u);const h=u},84031:(e,t,r)=>{"use strict";r.d(t,{T:()=>o});var i=r(50346),n=r(75540),s=r(22856);class o{constructor(){this._tasks=new Array,this._runningTasks=(0,n.v)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return s.G;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return++this._runningTasks.value,new Promise(((i,n)=>this._tasks.push(new a(i,n,e,t,r)))).finally((()=>--this._runningTasks.value))}unshift(e,t,r){return++this._runningTasks.value,new Promise(((i,n)=>this._tasks.unshift(new a(i,n,e,t,r)))).finally((()=>--this._runningTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const r=(0,i.G4)(t.signal);if(r&&!t.abortCallback)t.reject((0,i.NK)());else{const n=r?t.abortCallback?.((0,i.NK)()):t.callback(e);(0,i.$X)(n)?n.then(t.resolve,t.reject):t.resolve(n)}}catch(o){t.reject(o)}return!0}cancelAll(){const e=(0,i.NK)();for(const t of this._tasks)if(t.abortCallback){const r=t.abortCallback(e);t.resolve(r)}else t.reject(e);this._tasks.length=0}}class a{constructor(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;this.resolve=e,this.reject=t,this.callback=r,this.signal=i,this.abortCallback=n}}},50654:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(6409)),a=r(85842),l=r(44631);let c=i=class extends l.A{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new i({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};(0,n._)([(0,s.MZ)({json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range?.[1]},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(e,t,r){t[r]=[this.minValue||0,e]}}}})],c.prototype,"maxValue",void 0),(0,n._)([(0,s.MZ)({json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range?.[0]},write:{target:"range",writer(e,t,r){t[r]=[e,this.maxValue||0]}}}})],c.prototype,"minValue",void 0),(0,n._)([(0,o.e)({range:"range"})],c.prototype,"type",void 0),c=i=(0,n._)([(0,a.$)("esri.layers.support.RangeDomain")],c);const u=c},23965:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i=r(35143),n=r(69098),s=r(45802),o=r(42553),a=r(46053),l=(r(81806),r(76460),r(47249),r(85842));const c=new s.J({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),u=new s.J({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let h=class extends((0,n.O)(o.oY)){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};(0,i._)([(0,a.MZ)({json:{read:c.read,write:c.write}})],h.prototype,"cardinality",void 0),(0,i._)([(0,a.MZ)({json:{read:!0,write:!0}})],h.prototype,"composite",void 0),(0,i._)([(0,a.MZ)({json:{read:!0,write:!0}})],h.prototype,"id",void 0),(0,i._)([(0,a.MZ)({json:{read:!0,write:!0}})],h.prototype,"keyField",void 0),(0,i._)([(0,a.MZ)({json:{read:!0,write:!0}})],h.prototype,"keyFieldInRelationshipTable",void 0),(0,i._)([(0,a.MZ)({json:{read:!0,write:!0}})],h.prototype,"name",void 0),(0,i._)([(0,a.MZ)({json:{read:!0,write:!0}})],h.prototype,"relatedTableId",void 0),(0,i._)([(0,a.MZ)({json:{read:!0,write:!0}})],h.prototype,"relationshipTableId",void 0),(0,i._)([(0,a.MZ)({json:{read:u.read,write:u.write}})],h.prototype,"role",void 0),h=(0,i._)([(0,l.$)("esri.layers.support.Relationship")],h);const d=h},88235:(e,t,r)=>{"use strict";r.d(t,{A:()=>x});var i,n=r(35143),s=r(45802),o=r(42553),a=r(31633),l=r(46053),c=r(40565),u=(r(47249),r(81806),r(28379)),h=r(85842),d=r(17707),p=r(19247),f=r(13312),m=r(2413),g=r(80963),y=r(45417),_=r(22848),v=r(11164);const b=new s.J({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let w=i=class extends o.oY{static create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{resolutionFactor:t=1,scales:r,size:n=256,spatialReference:s=f.A.WebMercator,numLODs:o=24}=e;if(!(0,g.fn)(s)){const e=[];if(r)for(let t=0;t<r.length;t++){const i=r[t];e.push(new _.A({level:t,scale:i,resolution:i}))}else{let t=5e-4;for(let r=o-1;r>=0;r--)e.unshift(new _.A({level:r,scale:t,resolution:t})),t*=2}return new i({dpi:96,lods:e,origin:new p.A(0,0,s),size:[n,n],spatialReference:s})}const l=(0,g.Vp)(s),c=e.origin?new p.A({x:e.origin.x,y:e.origin.y,spatialReference:s}):new p.A(l?{x:l.origin[0],y:l.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),u=1/(39.37*(0,a.GA)(s)*96),h=[];if(r)for(let i=0;i<r.length;i++){const e=r[i],t=e*u;h.push(new _.A({level:i,scale:e,resolution:t}))}else{let e=(0,g.EA)(s)?512/n*591657527.5917094:256/n*591657527.591555;const r=Math.ceil(o/t);h.push(new _.A({level:0,scale:e,resolution:e*u}));for(let i=1;i<r;i++){const r=e/2**t,n=r*u;h.push(new _.A({level:i,scale:r,resolution:n})),e=r}}return new i({dpi:96,lods:h,origin:c,size:[n,n],spatialReference:s})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const r=(0,g.Vp)(e);return e.isWrappable&&!!r&&Math.abs(r.origin[0]-t.x)<=r.dx}return!1}readOrigin(e,t){return p.A.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,r=0;const i=[],n=this._levelToLOD={};e&&(t=-1/0,r=1/0,e.forEach((e=>{i.push(e.scale),t=e.scale>t?e.scale:t,r=e.scale<r?e.scale:r,n[e.level]=e}))),this._set("scales",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];const r=Math.floor(e),i=r+1;return t[r]/(t[r]/t[i])**(e-r)}scaleToZoom(e){const t=this.scales,r=t.length-1;let i=0;for(;i<r;i++){const r=t[i],n=t[i+1];if(r<=e)return i;if(n===e)return i+1;if(r>e&&n<e)return i+Math.log(r/e)/Math.log(r/n)}return i}tileAt(e,t,r,i){const n=this.lodAt(e);if(!n)return null;let s,o;if("number"==typeof t)s=t,o=r;else if((0,g.aI)(t.spatialReference,this.spatialReference))s=t.x,o=t.y,i=r;else{const e=(0,y.Cv)(t,this.spatialReference);if(null==e)return null;s=e.x,o=e.y,i=r}const a=n.resolution*this.size[0],l=n.resolution*this.size[1];return i||(i=new v.U(null,0,0,0,(0,m.vt)())),i.level=e,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((s-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.ExtrapolateOptions.NONE,r=this.lodAt(e.level);if(!r&&t===i.ExtrapolateOptions.POWER_OF_TWO){const t=this.lods[this.lods.length-1];t.level<e.level&&(r=t)}if(!r)return;const n=e.level-r.level,s=r.resolution*this.size[0]/2**n,o=r.resolution*this.size[1]/2**n;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=(0,m.vt)()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*o,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+o}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const r=this.lodAt(t.level);if(null==r)return null;const{resolution:i}=r,n=i*this.size[0],s=i*this.size[1];return e[0]=this.origin.x+t.col*n,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+n,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD?.[e]??null}clone(){return i.fromJSON(this.write({}))}getCompatibleForVTL(e){if(this.size[0]!==this.size[1]||256===this.size[0]&&512===e)return null;const t=(512===this.size[0]&&256===e?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===e&&0===t)return this;const r=[],n=this.lods.length-t;for(let i=0;i<n;i++){const e=i+t,{scale:n,resolution:s}=e>=0?this.lods[e]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};r.push(new _.A({level:i,scale:n,resolution:s}))}return new i({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let r=0;r<e.length;r++){const i=e[r];this._upsampleLevels[i.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/i.resolution:0},t=i}}};(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],w.prototype,"compressionQuality",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],w.prototype,"dpi",void 0),(0,n._)([(0,l.MZ)({type:String,json:{read:b.read,write:b.write,origins:{"web-scene":{read:!1,write:!1}}}})],w.prototype,"format",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],w.prototype,"isWrappable",null),(0,n._)([(0,l.MZ)({type:p.A,json:{write:!0}})],w.prototype,"origin",void 0),(0,n._)([(0,u.w)("origin")],w.prototype,"readOrigin",null),(0,n._)([(0,l.MZ)({type:[_.A],value:null,json:{write:!0}})],w.prototype,"lods",null),(0,n._)([(0,l.MZ)({readOnly:!0})],w.prototype,"scales",void 0),(0,n._)([(0,l.MZ)({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],w.prototype,"size",void 0),(0,n._)([(0,u.w)("size",["rows","cols"])],w.prototype,"readSize",null),(0,n._)([(0,d.K)("size",{cols:{type:c.jz},rows:{type:c.jz}})],w.prototype,"writeSize",null),(0,n._)([(0,l.MZ)({type:f.A,json:{write:!0}})],w.prototype,"spatialReference",void 0),w=i=(0,n._)([(0,h.$)("esri.layers.support.TileInfo")],w),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(w||(w={}));const x=w},11164:(e,t,r)=>{"use strict";r.d(t,{U:()=>i});class i{constructor(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;this.id=e,this.level=t,this.row=r,this.col=i,this.extent=n}}},83982:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var i=r(35143),n=r(82111),s=r(53666),o=r(69098),a=r(42553),l=r(46053),c=(r(81806),r(76460),r(47249),r(28379)),u=r(85842),h=r(17707),d=r(67478);function p(e,t){return s.A.fromJSON({value:e,unit:t})}let f=class extends((0,o.O)(a.oY)){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(e,t){return t.timeExtent&&Array.isArray(t.timeExtent)&&2===t.timeExtent.length?n.A.fromArray(t.timeExtent):null}writeFullTimeExtent(e,t){null!=e?.start&&null!=e.end?t.timeExtent=e.toArray():t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?p(t.timeInterval,t.timeIntervalUnits):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?p(t.defaultTimeInterval,t.defaultTimeIntervalUnits):null}writeInterval(e,t){t.timeInterval=e?.toJSON().value??null,t.timeIntervalUnits=e?.toJSON().unit??null}};(0,i._)([(0,l.MZ)({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],f.prototype,"cumulative",void 0),(0,i._)([(0,l.MZ)({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],f.prototype,"endField",void 0),(0,i._)([(0,l.MZ)({type:n.A,json:{write:{enabled:!0,allowNull:!0}}})],f.prototype,"fullTimeExtent",void 0),(0,i._)([(0,c.w)("fullTimeExtent",["timeExtent"])],f.prototype,"readFullTimeExtent",null),(0,i._)([(0,h.K)("fullTimeExtent")],f.prototype,"writeFullTimeExtent",null),(0,i._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],f.prototype,"hasLiveData",void 0),(0,i._)([(0,l.MZ)({type:s.A,json:{write:{enabled:!0,allowNull:!0}}})],f.prototype,"interval",void 0),(0,i._)([(0,c.w)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],f.prototype,"readInterval",null),(0,i._)([(0,h.K)("interval")],f.prototype,"writeInterval",null),(0,i._)([(0,l.MZ)({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],f.prototype,"startField",void 0),(0,i._)([(0,l.MZ)((0,d.P6)("timeReference",!0))],f.prototype,"timeZone",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],f.prototype,"trackIdField",void 0),(0,i._)([(0,l.MZ)({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],f.prototype,"useTime",void 0),(0,i._)([(0,l.MZ)({type:[Date],json:{read:!1}})],f.prototype,"stops",void 0),f=(0,i._)([(0,u.$)("esri.layers.support.TimeInfo")],f);const m=f},13096:(e,t,r)=>{"use strict";r.d(t,{Fi:()=>u,HZ:()=>y,Jf:()=>g,LS:()=>_,Wo:()=>m,bd:()=>v,cr:()=>p,iz:()=>d,qg:()=>h,tK:()=>b,yG:()=>f});var i=r(90534),n=r(79453);const s={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},o=Object.values(s),a=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${o.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),l=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${o.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),c=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function u(e){return a.test(e)}function h(e){if(null==e)return null;const t=(0,i.An)(e),r=t?.path.match(a)||t?.path.match(l);if(!r)return null;const[,n,o,c,u]=r,h=o.indexOf("/");return{title:p(-1!==h?o.slice(h+1):o),serverType:s[c.toLowerCase()],sublayer:null!=u&&""!==u?parseInt(u,10):null,url:{path:n}}}function d(e){const t=(0,i.An)(e).path.match(c);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function p(e){return(e=e.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function f(e,t){const r=[];if(e){const t=h(e);null!=t&&t.title&&r.push(t.title)}if(t){const e=p(t);r.push(e)}if(2===r.length){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function m(e){let t=(0,i.$z)(e,!0);return!!t&&(t=t.toLowerCase(),t.endsWith(".arcgis.com")&&(t.startsWith("services")||t.startsWith("tiles")||t.startsWith("features")))}function g(e,t){return e?(0,i.UC)((0,i.zi)(e,t)):e}function y(e){let{url:t}=e;if(!t)return{url:t};t=(0,i.zi)(t,e.logger);const r=(0,i.An)(t),n=h(r.path);let s;if(null!=n)null!=n.sublayer&&null==e.layer.layerId&&(s=n.sublayer),t=n.url.path;else if(e.nonStandardUrlAllowed){const e=d(r.path);null!=e&&(t=e.serviceUrl,s=e.sublayerId)}return{url:(0,i.UC)(t),layerId:s}}function _(e,t,r,s,o){(0,n.w)(t,s,"url",o),s.url&&null!=e.layerId&&(s.url=(0,i.fj)(s.url,r,e.layerId.toString()))}function v(e){if(!e)return!1;const t=e.toLowerCase(),r=t.includes("/services/"),i=t.includes("/mapserver/wmsserver"),n=t.includes("/imageserver/wmsserver"),s=t.includes("/wmsserver");return r&&(i||n||s)}function b(e){if(!e)return!1;const t=new i.s0((0,i.s2)(e)),r=t.authority?.toLowerCase();return"server.arcgisonline.com"===r||"services.arcgisonline.com"===r}},95363:(e,t,r)=>{"use strict";r.d(t,{C1:()=>S,Fm:()=>v,Ih:()=>_,M6:()=>u,OZ:()=>d,PY:()=>c,Qo:()=>m,Yj:()=>f,fV:()=>p,hG:()=>x,hn:()=>w,id:()=>b,kF:()=>h,ke:()=>y});var i=r(80979),n=r(76797),s=r(13312),o=r(79453),a=r(731),l=r(2183);const c={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:i.K}}},u={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,r){t[r]=!e}}}},h={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:i.K}}},d={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:o.w}}},p={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:i.K}}},f={value:null,type:a.A,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:i.K}}};function m(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const g={write:{enabled:!0,layerContainerTypes:i.K},read:!0},y={type:Number,json:{origins:{"web-document":g,"portal-item":{write:!0}}}},_={...y,json:{...y.json,origins:{"web-document":{...g,write:{enabled:!0,layerContainerTypes:i.K,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,r)=>r&&"service"!==r.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition?.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?(0,l.D)(t.layerDefinition.drawingInfo.transparency):void 0:(0,l.D)(t.drawingInfo.transparency)}}},v={type:n.A,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const r=n.A.fromJSON(e);return null!=t.spatialReference&&"object"==typeof t.spatialReference&&(r.spatialReference=s.A.fromJSON(t.spatialReference)),r}}}},read:!1}},b={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},w={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:i.K}}},name:"layerDefinition.minScale",write:!0}},x={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:i.K}}},name:"layerDefinition.maxScale",write:!0}},S={json:{write:{ignoreOrigin:!0,layerContainerTypes:i.K},origins:{"web-map":{read:!1,write:!1}}}}},15142:(e,t,r)=>{"use strict";r.d(t,{A5:()=>h,Mh:()=>i,wb:()=>u});var i,n=r(20639);!function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"}(i||(i={}));const s=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function o(e){return null!=e&&s.has(e.type)}function a(e){return null!=e&&("date-only"===e.type||"esriFieldTypeDateOnly"===e.type)}function l(e){return null!=e&&("timestamp-offset"===e.type||"esriFieldTypeTimestampOffset"===e.type)}function c(e){return null!=e&&("time-only"===e.type||"esriFieldTypeTimeOnly"===e.type)}function u(e,t,r){const n=r??e?.domain;if(!n)return null;switch(n.type){case"range":{const{min:n,max:s}=h(e,r);if(null!=n&&+t<n||null!=s&&+t>s)return i.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(null==n.codedValues||n.codedValues.every((e=>null==e||e.code!==t)))return i.INVALID_CODED_VALUE}return null}function h(e,t){const r=t??e?.domain;if(!r||"range"!==r.type)return;const i="range"in r?r.range[0]:r.minValue,n="range"in r?r.range[1]:r.maxValue,s=o(e);return a(e)||c(e)||l(e)?{...d(e,n,i),isInteger:s}:{min:null!=i&&"number"==typeof i?i:null,max:null!=n&&"number"==typeof n?n:null,rawMin:i,rawMax:n,isInteger:s}}function d(e,t,r){return a(e)?{min:(0,n.Xi)(r)?.toMillis(),max:(0,n.Xi)(t)?.toMillis(),rawMin:r,rawMax:t}:c(e)?{min:(0,n.UE)(r)?.toMillis(),max:(0,n.UE)(t)?.toMillis(),rawMin:r,rawMax:t}:l(e)?{min:(0,n.gz)(r)?.toMillis(),max:(0,n.gz)(t)?.toMillis(),rawMin:r,rawMax:t}:{max:null,min:null}}},76866:(e,t,r)=>{"use strict";r.d(t,{gK:()=>a,rS:()=>l});r(81806);var i=r(72599),n=r(44631),s=r(32173),o=r(50654);const a={key:"type",base:n.A,typeMap:{range:o.A,"coded-value":i.A,inherited:s.A}};function l(e){if(!e?.type)return null;switch(e.type){case"range":return o.A.fromJSON(e);case"codedValue":return i.A.fromJSON(e);case"inherited":return s.A.fromJSON(e)}return null}},91447:(e,t,r)=>{"use strict";r.d(t,{$4:()=>D,B5:()=>E,C$:()=>U,GA:()=>H,Nv:()=>F,PD:()=>B,Pt:()=>Z,S2:()=>P,VA:()=>z,VZ:()=>I,WP:()=>T,Xl:()=>_,Ye:()=>C,Zm:()=>N,bt:()=>b,ct:()=>w,hM:()=>R,iX:()=>y,jD:()=>L,jp:()=>O,lV:()=>M,mm:()=>S,rn:()=>x,sg:()=>A,tG:()=>j,xd:()=>G});var i=r(55171),n=r(95444),s=r(98773),o=r(50076),a=r(45802),l=r(34154),c=r(7982),u=r(74438),h=r(31933),d=r(5766),p=r(35039),f=r(9708),m=r(68295),g=r(58289);const y=new a.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function _(e,t,r,i){const n=await k(e);if(await v(e,t,i),!n.addAttachment)throw new o.A(i,"Layer source does not support addAttachment capability");return n.addAttachment(t,r)}function v(e,t,r){const{attributes:i}=t,{objectIdField:n}=e;return e.capabilities?.data?.supportsAttachment?t?i?n&&i[n]?Promise.resolve():Promise.reject(new o.A(r,`feature is missing the identifying attribute ${n}`)):Promise.reject(new o.A(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new o.A(r,"A feature is required to add/delete/update attachments")):Promise.reject(new o.A(r,"this layer doesn't support attachments"))}async function b(e,t,r,i,n){const s=await k(e);if(await v(e,t,n),!s.updateAttachment)throw new o.A(n,"Layer source does not support updateAttachment capability");return s.updateAttachment(t,r,i)}async function w(e,t,i){const{applyEdits:n}=await r.e(4610).then(r.bind(r,54610)),s=await e.load();let o=i;return"feature"===s.type&&s.infoFor3D&&null!=t.deleteFeatures&&null!=s.globalIdField&&(o={...o,globalIdToObjectId:await H(s,t.deleteFeatures,s.globalIdField)}),n(s,s.source,t,i)}async function x(e,t,i){const{uploadAssets:n}=await r.e(4610).then(r.bind(r,54610)),s=await e.load();return n(s,s.source,t,i)}async function S(e,t,r,i){const n=await k(e);if(await v(e,t,i),!n.deleteAttachments)throw new o.A(i,"Layer source does not support deleteAttachments capability");return n.deleteAttachments(t,r)}async function T(e,t,r){const i=(await e.load({signal:t?.signal})).source;if(!i.fetchRecomputedExtents)throw new o.A(r,"Layer source does not support fetchUpdates capability");return i.fetchRecomputedExtents(t)}async function M(e,t,r,i){t=f.A.from(t),await e.load();const n=e.source,s=e.capabilities;if(!s?.data?.supportsAttachment)throw new o.A(i,"this layer doesn't support attachments");const{attachmentTypes:a,objectIds:l,globalIds:c,num:u,size:h,start:d,where:p}=t;if(!s?.operations?.supportsQueryAttachments&&(a?.length>0||c?.length>0||h?.length>0||u||d||p))throw new o.A(i,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",t);if(!(l?.length||c?.length||p))throw new o.A(i,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",t);if(!n.queryAttachments)throw new o.A(i,"Layer source does not support queryAttachments capability",t);return n.queryAttachments(t)}async function A(e,t,r,i){const n=await k(e);if(!n.queryObjectIds)throw new o.A(i,"Layer source does not support queryObjectIds capability");return n.queryObjectIds(m.A.from(t)??e.createQuery(),r)}async function C(e,t,r,i){const n=await k(e);if(!n.queryFeatureCount)throw new o.A(i,"Layer source does not support queryFeatureCount capability");return n.queryFeatureCount(m.A.from(t)??e.createQuery(),r)}async function E(e,t,r,i){const n=await k(e);if(!n.queryExtent)throw new o.A(i,"Layer source does not support queryExtent capability");return n.queryExtent(m.A.from(t)??e.createQuery(),r)}async function R(e,t,r,i){const n=await k(e);if(!n.queryRelatedFeatures)throw new o.A(i,"Layer source does not support queryRelatedFeatures capability");return n.queryRelatedFeatures(g.default.from(t),r)}async function P(e,t,r,i){const n=await k(e);if(!n.queryRelatedFeaturesCount)throw new o.A(i,"Layer source does not support queryRelatedFeaturesCount capability");return n.queryRelatedFeaturesCount(g.default.from(t),r)}async function O(e){const t=e.source;if(t?.refresh)try{const{dataChanged:r,updates:i}=await t.refresh();if(null!=i&&(e.sourceJSON={...e.sourceJSON,...i},e.read(i,{origin:"service",url:e.parsedUrl})),r)return!0}catch{}if(e.definitionExpression)try{return(await(0,l.G)(e.definitionExpression,e.fieldsIndex)).hasDateFunctions}catch{}return!1}function I(e){const t=new m.A,r=e.capabilities?.data,i=e.capabilities?.query;t.historicMoment=e.historicMoment,t.gdbVersion=e.gdbVersion,t.returnGeometry=!0,i&&(t.compactGeometryEnabled=i.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),r&&(r.supportsZ&&null!=e.returnZ&&(t.returnZ=e.returnZ),r.supportsM&&null!=e.returnM&&(t.returnM=e.returnM)),t.outFields=["*"];const{timeOffset:n,timeExtent:s}=e;return t.timeExtent=null!=n&&null!=s?s.offset(-n.value,n.unit):s||null,t.multipatchOption="multipatch"===e.geometryType?"xyFootprint":null,t}function L(e){const{globalIdField:t,fields:r}=e;if(t)return t;if(r)for(const i of r)if("esriFieldTypeGlobalID"===i.type)return i.name}function N(e){const{objectIdField:t,fields:r}=e;if(t)return t;if(r)for(const i of r)if("esriFieldTypeOID"===i.type)return i.name}function D(e){return e.currentVersion?e.currentVersion:e.hasOwnProperty("capabilities")||e.hasOwnProperty("drawingInfo")||e.hasOwnProperty("hasAttachments")||e.hasOwnProperty("htmlPopupType")||e.hasOwnProperty("relationships")||e.hasOwnProperty("timeInfo")||e.hasOwnProperty("typeIdField")||e.hasOwnProperty("types")?10:9.3}function F(e,t){const{subtypes:r,subtypeField:i}=e;if(!t||!r?.length||!i)return null;const n=t.attributes[i];return null==n?null:r.find((e=>e.code===n))}async function k(e){return(await e.load()).source}async function z(e,t,r){const n=e.parsedUrl?.path;n&&e.authenticationTriggerEvent===t&&await async function(e,t){if(!i.id)return;if(i.id.findCredential(e))return;let r;try{const n=await(0,h.wI)(e,t);n&&(r=await i.id.checkSignInStatus(`${n}/sharing`))}catch(n){}if(r)try{const r=null!=t?t.signal:null;await i.id.getCredential(e,{signal:r})}catch(n){}}(n,r)}function U(e){return!Z(e)&&(e.userHasUpdateItemPrivileges||e.editingEnabled)}const V=(0,c.C)({types:n.xK});function B(e,t){if(e.defaultSymbol)return e.types?.length?new p.A({defaultSymbol:V(e.defaultSymbol,e,t),field:e.typeIdField,uniqueValueInfos:e.types.map((e=>({id:e.id,symbol:V(e.symbol,e,t)})))}):new d.A({symbol:V(e.defaultSymbol,e,t)})}function j(e){let t=e.sourceJSON?.cacheMaxAge;if(!t)return!1;const r=e.editingInfo?.lastEditDate?.getTime();return null==r||(t*=1e3,Date.now()-r<t)}async function H(e,t,r){if(null==t)return null;const i=[],{objectIdField:n}=e;if(t.forEach((e=>{let t=null;if("attributes"in e){const{attributes:i}=e;t={globalId:i[r],objectId:null!=i[n]&&-1!==i[n]?i[n]:null}}else t={globalId:e.globalId,objectId:null!=e.objectId&&-1!==e.objectId?e.objectId:null};null!=t.globalId&&(null!=t.objectId&&-1!==t.objectId||i.push(t.globalId))})),0===i.length)return null;const o=e.createQuery();o.where=i.map((e=>`${r}='${e}'`)).join(" OR "),o.returnGeometry=!1,o.outFields=[n,r],o.cacheHint=!1;const a=await(0,s.DZ)((0,u.SE)(e,o));if(!a.ok)return null;const l=new Map,c=a.value.features;for(const s of c){const e=s.attributes[r],t=s.attributes[n];null!=e&&null!=t&&-1!==t&&l.set(e,t)}return l}function G(e,t,r){if(!t||!r||!e)return null;const i=r.getAttribute(t);return null==i?null:e.find((e=>{const{id:t}=e;return null!=t&&t.toString()===i.toString()}))??null}function Z(e){return e.sourceJSON?.isMultiServicesView||function(e){return!!e.sourceJSON?.capabilities?.toLowerCase().split(",").map((e=>e.trim())).includes("map")}(e)}},74438:(e,t,r)=>{"use strict";r.d(t,{SE:()=>n,qM:()=>s});var i=r(68295);async function n(e,t,r){t=t.clone(),e.capabilities.query.supportsMaxRecordCountFactor&&(t.maxRecordCountFactor=o(e));const i=s(e),n=e.capabilities.query.supportsPagination;t.start=0,t.num=i;let a=null;for(;;){const s=await e.source.queryFeaturesJSON(t,r);if(null==a?a=s:a.features=a.features.concat(s.features),a.exceededTransferLimit=s.exceededTransferLimit,!n||!s.exceededTransferLimit)break;t.start+=i}return a}function s(e){return o(e)*function(e){return e.capabilities.query.maxRecordCount||2e3}(e)}function o(e){return e.capabilities.query.supportsMaxRecordCountFactor?i.A.MAX_MAX_RECORD_COUNT_FACTOR:1}},54490:(e,t,r)=>{"use strict";r.d(t,{d:()=>L});var i,n=r(80979),s=r(80524),o=r(35143),a=r(16868),l=(r(63844),r(14873),r(47662),r(72690),r(86946),r(71832),r(5766)),c=(r(35039),r(86616)),u=r(31382),h=r(53084),d=r(48611),p=r(76931),f=r(46053),m=(r(81806),r(76460),r(6409)),g=r(28379),y=r(85842),_=r(17707),v=r(3522),b=r(95363),w=r(91447),x=r(71401);let S=i=class extends s.c{constructor(e){super(e),this.type="binning",this.binType="geohash",this.fixedBinLevel=null,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.size=(0,p.cr)("12px"),this.fields=[],this.renderer=null}writeFields(e,t,r){const i=e.filter((e=>"avg_angle"!==e.statisticType)).map((e=>e.toJSON()));(0,d.sM)(r,i,t)}readRenderer(e,t,r){const i=t.drawingInfo?.renderer;return i?(0,c.L)(i,t,r)??void 0:(0,w.PD)(t,r)}clone(){return new i({fields:(0,h.o8)(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:(0,h.o8)(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:(0,h.o8)(this.popupTemplate),renderer:(0,h.o8)(this.renderer),binType:(0,h.o8)(this.binType),size:this.size})}};(0,o._)([(0,m.e)({binning:"binning"})],S.prototype,"type",void 0),(0,o._)([(0,m.e)({geohash:"geohash",square:"square"}),(0,f.MZ)({type:["geohash","square"]})],S.prototype,"binType",void 0),(0,o._)([(0,f.MZ)({type:Number,json:{write:!0}})],S.prototype,"fixedBinLevel",void 0),(0,o._)([(0,f.MZ)({type:[x.A],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],S.prototype,"labelingInfo",void 0),(0,o._)([(0,f.MZ)(b.kF)],S.prototype,"labelsVisible",void 0),(0,o._)([(0,f.MZ)({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],S.prototype,"maxScale",void 0),(0,o._)([(0,f.MZ)(b.M6)],S.prototype,"popupEnabled",void 0),(0,o._)([(0,f.MZ)({type:a.A,json:{name:"popupInfo",write:!0}})],S.prototype,"popupTemplate",void 0),(0,o._)([(0,f.MZ)({type:Number,cast:e=>"auto"===e?e:(0,p.cr)(e)})],S.prototype,"size",void 0),(0,o._)([(0,f.MZ)({type:[v.A],json:{write:!0}})],S.prototype,"fields",void 0),(0,o._)([(0,_.K)("fields")],S.prototype,"writeFields",null),(0,o._)([(0,f.MZ)({types:u.H,json:{write:{target:"drawingInfo.renderer"}}})],S.prototype,"renderer",void 0),(0,o._)([(0,g.w)("renderer",["drawingInfo.renderer"])],S.prototype,"readRenderer",null),S=i=(0,o._)([(0,y.$)("esri.layers.support.FeatureReductionBinning")],S);const T=S;var M,A=r(95444),C=r(42553);function E(e){return"simple"===e.type&&!e.visualVariables?.length}let R=M=class extends C.oY{constructor(e){super(e),this.type="cluster",this.clusterRadius=(0,p.cr)("80px"),this.clusterMinSize=(0,p.cr)("12px"),this.clusterMaxSize=(0,p.cr)("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=[]}readRenderer(e,t,r){const i=t.drawingInfo?.renderer;return i?.authoringInfo?.isAutoGenerated?null:i?E(i)?null:(0,c.L)(i,t,r)??void 0:(0,w.PD)(t,r)}readSymbol(e,t,r){const i=t.drawingInfo?.renderer;if(i?.authoringInfo?.isAutoGenerated)return null;if(i&&E(i)){const e=(0,c.L)(i,t,r);return e?.symbol}return null}writeSymbol(e,t,r,i){const n=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||n){const r=new l.A({symbol:e});t.drawingInfo={renderer:r.write({},i)}}}writeFields(e,t,r){const i=e.filter((e=>"avg_angle"!==e.statisticType)).map((e=>e.toJSON()));(0,d.sM)(r,i,t)}readFields(e,t,r){return e.filter((e=>!e.isAutoGenerated)).map((e=>v.A.fromJSON(e)))}clone(){return new M({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:(0,h.o8)(this.labelingInfo),labelsVisible:this.labelsVisible,fields:(0,h.o8)(this.fields),maxScale:this.maxScale,renderer:(0,h.o8)(this.renderer),symbol:(0,h.o8)(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:(0,h.o8)(this.popupTemplate)})}};(0,o._)([(0,f.MZ)({type:["cluster"],readOnly:!0,json:{write:!0}})],R.prototype,"type",void 0),(0,o._)([(0,f.MZ)({type:Number,cast:e=>"auto"===e?e:(0,p.cr)(e),json:{write:!0}})],R.prototype,"clusterRadius",void 0),(0,o._)([(0,f.MZ)({type:Number,cast:p.cr,json:{write:!0}})],R.prototype,"clusterMinSize",void 0),(0,o._)([(0,f.MZ)({type:Number,cast:p.cr,json:{write:!0}})],R.prototype,"clusterMaxSize",void 0),(0,o._)([(0,f.MZ)({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],R.prototype,"maxScale",void 0),(0,o._)([(0,f.MZ)(b.M6)],R.prototype,"popupEnabled",void 0),(0,o._)([(0,f.MZ)({type:a.A,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],R.prototype,"popupTemplate",void 0),(0,o._)([(0,f.MZ)({types:u.H,json:{write:{target:"drawingInfo.renderer"}}})],R.prototype,"renderer",void 0),(0,o._)([(0,g.w)("renderer",["drawingInfo.renderer"])],R.prototype,"readRenderer",null),(0,o._)([(0,f.MZ)({types:A.q8})],R.prototype,"symbol",void 0),(0,o._)([(0,g.w)("symbol",["drawingInfo.renderer"])],R.prototype,"readSymbol",null),(0,o._)([(0,_.K)("symbol")],R.prototype,"writeSymbol",null),(0,o._)([(0,f.MZ)({type:[x.A],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],R.prototype,"labelingInfo",void 0),(0,o._)([(0,f.MZ)(b.kF)],R.prototype,"labelsVisible",void 0),(0,o._)([(0,f.MZ)({type:[v.A],json:{write:!0}})],R.prototype,"fields",void 0),(0,o._)([(0,_.K)("fields")],R.prototype,"writeFields",null),(0,o._)([(0,g.w)("fields")],R.prototype,"readFields",null),R=M=(0,o._)([(0,y.$)("esri.layers.support.FeatureReductionCluster")],R);const P=R;var O=r(89672);const I={key:"type",base:s.c,typeMap:{cluster:P,binning:T}},L={types:{key:"type",base:s.c,typeMap:{selection:O.A,cluster:P,binning:T}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:I},"portal-item":{types:I},"web-scene":{types:{key:"type",base:s.c,typeMap:{selection:O.A}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:n.K}}}}}},76350:(e,t,r)=>{"use strict";r.d(t,{p:()=>l});var i=r(81806),n=r(76460),s=r(44135),o=r(1900),a=r(53430);function l(){return{fields:{type:[s.A],value:null,set:function(e){if(e&&(0,i.A)("big-integer-warning-enabled")){const t=e.filter((e=>"big-integer"===e.type||"oid"===e.type&&(e.length||0)>=8));if(t.length){const e=t.map((e=>`'${e.name}'`)).join(", ");n.A.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${e}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",e)}},fieldsIndex:{readOnly:!0,get(){return o.A.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e?.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e){const r=this.fieldsIndex?.has(t);r||n.A.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e})}return(0,a.DB)(this.fieldsIndex,e)}}}}},6127:(e,t,r)=>{"use strict";r.d(t,{m:()=>i});const i=new(r(45802).J)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"})},53430:(e,t,r)=>{"use strict";r.d(t,{Ah:()=>ne,Bz:()=>z,CJ:()=>de,DB:()=>_,Dx:()=>x,Im:()=>U,JL:()=>xe,Kl:()=>be,NO:()=>A,OG:()=>le,OH:()=>se,Q1:()=>we,R$:()=>k,RP:()=>C,WA:()=>ee,WX:()=>he,Xz:()=>ae,_b:()=>B,_w:()=>v,eX:()=>P,f:()=>R,hL:()=>w,lD:()=>V,mB:()=>T,nw:()=>Se,o:()=>E,rS:()=>h,rq:()=>b,sv:()=>g,te:()=>oe,uo:()=>ve,vE:()=>re,yM:()=>te,yp:()=>f,zD:()=>ie});var i=r(50076),n=r(48611),s=r(41289),o=r(34154),a=r(15142),l=r(98976);const c=/^([0-9_])/,u=/[^a-z0-9_\u0080-\uffff]+/gi;function h(e){return null==e?null:e.trim().replaceAll(u,"_").replace(c,"F$1")||null}const d=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],p=["field","normalizationField"];function f(e,t){if(null!=e&&null!=t)for(const r of Array.isArray(e)?e:[e])if(m(d,r,t),"visualVariables"in r&&r.visualVariables)for(const e of r.visualVariables)m(p,e,t)}function m(e,t,r){if(e)for(const i of e){const e=(0,n.wc)(i,t),s=e&&"function"!=typeof e&&r.get(e);s&&(0,n.sM)(i,s.name,t)}}function g(e,t){if(null!=e&&t?.fields?.length)if("startField"in e){const r=t.get(e.startField),i=t.get(e.endField);e.startField=r?.name??null,e.endField=i?.name??null}else{const r=t.get(e.startTimeField),i=t.get(e.endTimeField);e.startTimeField=r?.name??null,e.endTimeField=i?.name??null}}const y=new Set;function _(e,t){return e&&t?(y.clear(),v(y,e,t),Array.from(y).sort()):[]}function v(e,t,r){if(r)if(t?.fields?.length)if(r.includes("*"))for(const{name:i}of t.fields)e.add(i);else for(const i of r)b(e,t,i);else{if(r.includes("*"))return e.clear(),void e.add("*");for(const t of r)null!=t&&e.add(t)}}function b(e,t,r){if("string"==typeof r)if(t){const i=t.get(r);i&&e.add(i.name)}else e.add(r)}function w(e,t){return null==t||null==e?[]:t.includes("*")?(e.fields??[]).map((e=>e.name)):t}async function x(e,t,r){if(!r)return;const{arcadeUtils:i}=await(0,l.lw)(),n=i.extractFieldNames(r,t?.fields?.map((e=>e.name)));for(const s of n)b(e,t,s)}async function S(e,t,r){if(r&&"1=1"!==r){const n=await(0,o.G)(r,t);if(!n.isStandardized)throw new i.A("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});v(e,t,n.fieldNames)}}function T(e){let{displayField:t,fields:r}=e;return t||(r?.length?M(r,"name-or-title")||M(r,"unique-identifier")||M(r,"type-or-category")||function(e){for(const t of e){if(!t?.name)continue;const e=t.name.toLowerCase();if(e.includes("name")||e.includes("title"))return t.name}return null}(r):null)}function M(e,t){for(const r of e)if(r?.valueType&&r.valueType===t)return r.name;return null}async function A(e,t){if(!t)return;const r=t.elevationInfo?.featureExpressionInfo;return r?r.collectRequiredFields(e,t.fieldsIndex):void 0}async function C(e,t,r){if(!t||!r||!("fields"in r))return;const i=[],n=r.popupTemplate;i.push(async function(e,t,r){const i=[];r?.expressionInfos&&i.push(...r.expressionInfos.map((r=>x(e,t.fieldsIndex,r.expression))));const n=r?.content;if(Array.isArray(n))for(const s of n)"expression"===s.type&&s.expressionInfo&&i.push(x(e,t.fieldsIndex,s.expressionInfo.expression));await Promise.all(i)}(e,t,n)),r.fields&&i.push(...r.fields.map((async r=>function(e,t,r){r.onStatisticExpression?x(e,t,r.onStatisticExpression.expression):e.add(r.onStatisticField)}(e,t.fieldsIndex,r)))),await Promise.all(i)}async function E(e,t,r){t&&(t.timeInfo&&r?.timeExtent&&v(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&v(e,t.fieldsIndex,[t.floorInfo.floorField]),null!=r?.where&&await S(e,t.fieldsIndex,r.where))}async function R(e,t,r){t&&r&&await Promise.all(r.map((r=>async function(e,t,r){t&&r&&(r.valueExpression?await x(e,t.fieldsIndex,r.valueExpression):r.field&&b(e,t.fieldsIndex,r.field))}(e,t,r))))}function P(e){return e?_(e.fieldsIndex,D(e)):[]}const O=new Set(["oid","global-id","guid"]),I=new Set(["oid","global-id"]),L=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function N(e){const t=new Set;F(e).forEach((e=>t.add(e))),function(e){if(!e)return[];const t=e.geometryFieldsInfo;return t?_(e.fieldsIndex,[t.shapeAreaField,t.shapeLengthField]):[]}(e).forEach((e=>t.add(e.toLowerCase())));const r=e&&"infoFor3D"in e?e.infoFor3D:void 0;return r&&(Object.values(r.assetMapFieldRoles).forEach((e=>t.add(e.toLowerCase()))),Object.values(r.transformFieldRoles).forEach((e=>t.add(e.toLowerCase())))),Array.from(t)}function D(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;if(!t)return[];const{creationDateField:r,creatorField:i,editDateField:n,editorField:s}=t;return[r,i,n,s].filter(Boolean)}function F(e){return D(e).map((e=>e.toLowerCase()))}function k(e,t){return e.editable&&!O.has(e.type)&&!F(t).includes(e.name?.toLowerCase()??"")}function z(e,t){const r=e.name?.toLowerCase()??"";return!(null!=t?.objectIdField&&r===t.objectIdField.toLowerCase()||null!=t?.globalIdField&&r===t.globalIdField.toLowerCase()||N(t).includes(r)||I.has(e.type)||L.some((e=>e.test(r))))}async function U(e,t){const{labelingInfo:r,fieldsIndex:i}=t;r?.length&&await Promise.all(r.map((t=>async function(e,t,r){if(!r)return;const i=r.getLabelExpression(),n=r.where;if("arcade"===i.type)await x(e,t,i.expression);else{const r=i.expression.match(/{[^}]*}/g);r&&r.forEach((r=>{b(e,t,r.slice(1,-1))}))}await S(e,t,n)}(e,i,t))))}function V(e){const t=e.defaultValue;return void 0!==t&&W(e,t)?t:e.nullable?null:void 0}function B(e){const t="string"==typeof e?{type:e}:e;return te(t)?255:"esriFieldTypeDate"===t.type||"date"===t.type?8:void 0}function j(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}function H(e){return null===e||j(e)}function G(e){return null===e||Number.isInteger(e)}function Z(e){return null!=e&&"string"==typeof e}function $(e){return null===e||Z(e)}function q(){return!0}function W(e,t){let r;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":r=e.nullable?G:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=e.nullable?H:j;break;case"string":case"esriFieldTypeString":r=e.nullable?$:Z;break;default:r=q}return 1===arguments.length?r:r(t)}const Y=["integer","small-integer","big-integer"],X=["single","double"],J=new Set([...Y,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]),K=new Set([...X,"esriFieldTypeSingle","esriFieldTypeDouble"]),Q=(0,s.KC)(J,K);function ee(e){return null!=e&&Q.has(e.type)}function te(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}function re(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)}function ie(e){return null!=e&&("date-only"===e.type||"esriFieldTypeDateOnly"===e.type)}function ne(e){return null!=e&&("timestamp-offset"===e.type||"esriFieldTypeTimestampOffset"===e.type)}function se(e){return null!=e&&("time-only"===e.type||"esriFieldTypeTimeOnly"===e.type)}function oe(e){return null!=e&&("oid"===e.type||"esriFieldTypeOID"===e.type)}function ae(e){return null!=e&&("global-id"===e.type||"esriFieldTypeGlobalID"===e.type)}function le(e,t){return null===de(e,t)}var ce,ue;function he(e){return null==e||"number"==typeof e&&isNaN(e)?null:e}function de(e,t){return null==e||e.nullable&&null===t?null:ee(e)&&!function(e,t){const r="string"==typeof e?pe(e):e;if(!r)return!1;const i=r.min,n=r.max;return r.isInteger?Number.isInteger(t)&&t>=i&&t<=n:t>=i&&t<=n}(e.type,Number(t))?ce.OUT_OF_RANGE:W(e,t)?e.domain?(0,a.wb)(e,t):null:ue.INVALID_TYPE}function pe(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return fe;case"esriFieldTypeInteger":case"integer":return me;case"esriFieldTypeBigInteger":case"big-integer":return ge;case"esriFieldTypeSingle":case"single":return ye;case"esriFieldTypeDouble":case"double":return _e}}!function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"}(ce||(ce={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(ue||(ue={}));const fe={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},me={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},ge={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},ye={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},_e={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function ve(e,t,r){switch(e){case a.Mh.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case a.Mh.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case ue.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case ce.OUT_OF_RANGE:{const{min:e,max:i}=pe(t.type);return`Value ${r} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${e} to ${i}`}}}function be(e,t){return!we(e,t,null)}function we(e,t,r){if(!t?.attributes||!e){if(null!=r)for(const t of e??[])r.add(t);return!0}const i=new Set(Object.keys(t.attributes));let n=!1;for(const s of e)if(!i.has(s)){if(n=!0,null==r)break;r.add(s)}return n}function xe(e){return!!e&&["raster.itempixelvalue","raster.servicepixelvalue"].some((t=>e.toLowerCase().startsWith(t)))}function Se(e){const t=e?.match(/{[^}]+}/g);return t?t.map((e=>e.slice(1,-1).split(":")[0].trim())):[]}},79701:(e,t,r)=>{"use strict";r.d(t,{W:()=>g,l:()=>m});var i=r(50076),n=r(76460),s=r(34154),o=r(65256),a=r(50265),l=r(15142),c=r(53430),u=r(65460),h=r(98976);const d=()=>n.A.getLogger("esri.layers.support.labelFormatUtils"),p={type:"simple",evaluate:()=>null},f={getAttribute:(e,t)=>e.field(t)};async function m(e,t,r){if(!e||!e.symbol||!t)return p;const n=e.where,o=(0,u.XJ)(e);let a;if("arcade"===o.type){const e=await(0,h.$I)(o.expression,r,t);if(null==e)return p;a={type:"arcade",evaluate(t,n){try{const r="attributes"in t?e.repurposeFeature(t):t;r.contextTimeZone=n??null;const i=e.evaluate({$view:{timeZone:n},$feature:r},e.services);if(null!=i)return i.toString()}catch(r){d().error(new i.A("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:r,feature:t,expression:o}))}return null},needsHydrationToEvaluate:()=>null==(0,u.tH)(o.expression)}}else a={type:"simple",evaluate:e=>o.expression.replaceAll(/{[^}]*}/g,(r=>{const i=r.slice(1,-1),n=t.get(i);if(!n)return r;let s=null;return"attributes"in e?e&&e.attributes&&(s=e.attributes[n.name]):s=e.field(n.name),null==s?"":g(s,n)}))};if(n){let e;try{e=await(0,s.G)(n,t)}catch(l){return d().error(new i.A("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:n,error:l})),p}const r=a.evaluate;a.evaluate=(t,s)=>{const o="attributes"in t?void 0:f;try{if(e.testFeature(t,o))return r(t,s)}catch(l){d().error(new i.A("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:n,feature:t,error:l}))}return null}}return a}function g(e,t){if(null==e)return"";const r=t.domain;if(r)if("codedValue"===r.type||"coded-value"===r.type){const t=e;for(const e of r.codedValues)if(e.code===t)return e.name}else if("range"===r.type){const{max:i,min:n}=(0,l.A5)(t),s=+e;if(null!=n&&null!=i&&n<=s&&s<=i)return r.name}let i=e;return(0,c.vE)(t)?i=(0,o.Yq)(i,(0,o.J2)("short-date")):(0,c.WA)(t)&&(i=(0,a.ZV)(+i)),i||""}},65460:(e,t,r)=>{"use strict";r.d(t,{BI:()=>g,D3:()=>f,XJ:()=>m,lc:()=>p,mX:()=>_,rU:()=>y,tH:()=>S});var i=r(88685);const n="__begin__",s="__end__",o=new RegExp(n,"ig"),a=new RegExp(s,"ig"),l=new RegExp("^"+n,"i"),c=new RegExp(s+"$","i"),u='"',h=u+" + ",d=" + "+u;function p(e){return e.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function f(e){return e.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function m(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):null!=e.labelExpression&&(t.expression=p(e.labelExpression),t.type="conventional"),t}function g(e){const t=m(e);if(!t)return null;switch(t.type){case"conventional":return _(t.expression);case"arcade":return t.expression}return null}function y(e){const t=m(e);if(!t)return null;switch(t.type){case"conventional":return function(e){const t=e?.match(v);return t?.[1].trim()||null}(t.expression);case"arcade":return S(t.expression)}return null}function _(e){let t;return e?(t=(0,i.HC)(e,(e=>n+'$feature["'+e+'"]'+s)),t=l.test(t)?t.replace(l,""):u+t,t=c.test(t)?t.replace(c,""):t+u,t=t.replaceAll(o,h).replaceAll(a,d)):t='""',t}const v=/^\s*\{([^}]+)\}\s*$/i;const b=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,w=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,x=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function S(e){if(!e)return null;let t=b.exec(e)||w.exec(e);return t?t[1]||t[3]:(t=x.exec(e),t?t[2]:null)}},27937:(e,t,r)=>{"use strict";r.d(t,{w:()=>l,z:()=>u});var i=r(50076),n=r(76460),s=r(71401);const o=()=>n.A.getLogger("esri.layers.support.labelingInfo"),a=/\[([^[\]]+)\]/gi;function l(e,t,r){return e?e.map((e=>{const i=new s.A;if(i.read(e,r),i.labelExpression){const e=t.fields||t.layerDefinition?.fields||this.fields;i.labelExpression=i.labelExpression.replaceAll(a,((t,r)=>`[${function(e,t){if(!t)return e;const r=e.toLowerCase();for(let i=0;i<t.length;i++){const e=t[i].name;if(e.toLowerCase()===r)return e}return e}(r,e)}]`))}return i})):null}const c={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along","above-along","below-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};function u(e,t){const r=[];for(const n of e){const e=n.labelPlacement,s=c[t];if(!n.symbol)return o().warn("No ILabelClass symbol specified."),[];if(!s)return o().error(new i.A("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${t}' is not supported`)),[];if(s.includes(e))r.push(n);else{const i=s[0];e&&o().warn(`Found invalid label placement type ${e} for ${t}. Defaulting to ${i}`);const a=n.clone();a.labelPlacement=i,r.push(a)}}return r}},31933:(e,t,r)=>{"use strict";r.d(t,{BR:()=>w,Eq:()=>p,F2:()=>o,If:()=>d,Ov:()=>y,Sv:()=>a,TU:()=>h,W_:()=>_,XX:()=>u,jZ:()=>c,qC:()=>m,qK:()=>l,qe:()=>f,r0:()=>v,rz:()=>g,tk:()=>x,wI:()=>b,yZ:()=>s});var i=r(55171),n=r(3825);function s(e){return null!=e&&"object"==typeof e&&"type"in e&&"feature"===e.type}function o(e){return null!=e&&"object"==typeof e&&"type"in e&&"subtype-group"===e.type&&"sublayers"in e}function a(e){return"subtype-sublayer"===e?.type}function l(e){const t=e?.type;return"base-tile"===t||"tile"===t||"elevation"===t||"imagery-tile"===t||"base-elevation"===t||"open-street-map"===t||"wcs"===t||"web-tile"===t||"wmts"===t||"vector-tile"===t}function c(e){return null!=e&&"type"in e&&"group"===e.type}const u={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function h(e){const t=e?.type;return"building-scene"===t||"integrated-mesh"===t||"point-cloud"===t||"scene"===t}function d(e){return"IntegratedMeshLayer"===e||"IntegratedMesh3DTilesLayer"===e}function p(e){return"integrated-mesh"===e||"integrated-mesh-3dtiles"===e}function f(e){return"voxel"===e?.type}function m(e){return"imagery-tile"===e?.type}function g(e){return null!=e?.parent&&"declaredClass"in e.parent&&"esri.Basemap"===e.parent.declaredClass&&e.parent.baseLayers.includes(e)}function y(e){return"feature"===e?.type&&!e.url&&"memory"===e.source?.type}function _(e){return("feature"===e?.type||"subtype-group"===e?.type)&&"feature-layer"===e.source?.type}function v(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const r=e.activeLayer.tileMatrixSets;if(r)return r}return null}async function b(e,t){const r=i.id?.findServerInfo(e);if(null!=r?.currentVersion)return r.owningSystemUrl||null;const s=e.toLowerCase().indexOf("/rest/services");if(-1===s)return null;const o=`${e.substring(0,s)}/rest/info`,a=null!=t?t.signal:null,{data:l}=await(0,n.A)(o,{query:{f:"json"},responseType:"json",signal:a});return l?.owningSystemUrl||null}function w(e){return function(e){if(!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}(e)?"effectiveCapabilities"in e?e.effectiveCapabilities:e.capabilities:null}function x(e){return!!function(e){if(!("editingEnabled"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}(e)&&("effectiveEditingEnabled"in e?e.effectiveEditingEnabled:e.editingEnabled)}},44141:(e,t,r)=>{"use strict";r.d(t,{S:()=>h,d:()=>w});var i=r(81806),n=r(13096);function s(e,t,r){return!!a(e,t,r)}function o(e,t,r){return a(e,t,r)}function a(e,t,r){return e&&e.hasOwnProperty(t)?e[t]:r}const l={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function c(e){const t=e?.supportedSpatialAggregationStatistics?.map((e=>e.toLowerCase()));return{envelope:!!t?.includes("envelopeaggregate"),centroid:!!t?.includes("centroidaggregate"),convexHull:!!t?.includes("convexhullaggregate")}}function u(e,t){const r=e?.supportedOperationsWithCacheHint?.map((e=>e.toLowerCase()));return!!r?.includes(t.toLowerCase())}function h(e,t){return{analytics:d(e),attachment:p(e),data:f(e),metadata:m(e),operations:g(e.capabilities,e,t),query:y(e,t),queryRelated:_(e),queryTopFeatures:v(e),editing:b(e)}}function d(e){return{supportsCacheHint:u(e.advancedQueryCapabilities,"queryAnalytics")}}function p(e){const t=e.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:u(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:s(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach((e=>{const t=l[e.name];t&&(r[t]=!!e.isEnabled)})),r}function f(e){return{isVersioned:s(e,"isDataVersioned",!1),supportsAttachment:s(e,"hasAttachments",!1),supportsM:s(e,"hasM",!1),supportsZ:s(e,"hasZ",!1)}}function m(e){return{supportsAdvancedFieldProperties:s(e,"supportsFieldDescriptionProperty",!1)}}function g(e,t,r){const i=e?e.toLowerCase().split(",").map((e=>e.trim())):[],o=r?(0,n.qg)(r):null,a=i.includes(null!=o&&"MapServer"===o.serverType?"data":"query"),l=i.includes("editing")&&!t.datesInUnknownTimezone;let c=l&&i.includes("create"),u=l&&i.includes("delete"),h=l&&i.includes("update");const d=i.includes("changetracking"),p=t.advancedQueryCapabilities;return l&&!(c||u||h)&&(c=u=h=!0),{supportsCalculate:s(t,"supportsCalculate",!1),supportsTruncate:s(t,"supportsTruncate",!1),supportsValidateSql:s(t,"supportsValidateSql",!1),supportsAdd:c,supportsDelete:u,supportsEditing:l,supportsChangeTracking:d,supportsQuery:a,supportsQueryAnalytics:s(p,"supportsQueryAnalytic",!1),supportsQueryAttachments:s(p,"supportsQueryAttachments",!1),supportsQueryTopFeatures:s(p,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:s(t,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:h,supportsExceedsLimitStatistics:s(t,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:s(t,"supportsAsyncConvert3D",!1)}}function y(e,t){const r=e.advancedQueryCapabilities,a=e.ownershipBasedAccessControlForFeatures,l=e.archivingInfo,h=e.currentVersion,d=t?.includes("MapServer"),p=!d||h>=(0,i.A)("mapserver-pbf-version-support"),f=(0,n.Wo)(t),m=new Set((e.supportedQueryFormats??"").split(",").map((e=>e.toLowerCase().trim())));return{maxRecordCount:o(e,"maxRecordCount",void 0),maxRecordCountFactor:o(e,"maxRecordCountFactor",void 0),standardMaxRecordCount:o(e,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:c(r),supportsCacheHint:s(r,"supportsQueryWithCacheHint",!1)||u(r,"query"),supportsCentroid:s(r,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:f,supportsDefaultSpatialReference:s(r,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:s(r,"supportsDisjointSpatialRel",!1),supportsDistance:s(r,"supportsQueryWithDistance",!1),supportsDistinct:s(r,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:s(r,"supportsReturningQueryExtent",!1),supportsFormatPBF:p&&m.has("pbf"),supportsFullTextSearch:s(r,"supportsFullTextSearch",!1),supportsGeometryProperties:s(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:s(r,"supportsHavingClause",!1),supportsHistoricMoment:s(l,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:s(r,"supportsMaxRecordCountFactor",!1),supportsOrderBy:s(r,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:s(r,"supportsPagination",!1),supportsPercentileStatistics:s(r,"supportsPercentileStatistics",!1),supportsQuantization:s(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:s(e,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:s(a,"allowAnonymousToQuery",!0),supportsQueryByOthers:s(a,"allowOthersToQuery",!0),supportsQueryGeometry:s(e,"supportsReturningQueryGeometry",!1),supportsResultType:s(r,"supportsQueryWithResultType",!1),supportsSpatialAggregationStatistics:s(r,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:s(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:s(e,"useStandardizedQueries",!1),supportsStatistics:s(r,"supportsStatistics",e.supportsStatistics),supportsTopFeaturesQuery:s(r,"supportsTopFeaturesQuery",!1),tileMaxRecordCount:o(e,"tileMaxRecordCount",void 0)}}function _(e){const t=e.advancedQueryCapabilities,r=s(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:s(t,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:u(t,"queryRelated")}}function v(e){return{supportsCacheHint:u(e.advancedQueryCapabilities,"queryTopFilter")}}function b(e){const t=e.ownershipBasedAccessControlForFeatures,r=e?e.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:s(e,"allowGeometryUpdates",!0),supportsGlobalId:s(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:s(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:s(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:s(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:s(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:s(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:s(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:s(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:s(t,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:s(r,"supportsAsyncApplyEdits",!1),zDefault:o(e,"zDefault",void 0)}}function w(e){return{operations:{supportsAppend:s(e,"supportsAppend",!1),supportsExportClip:s(e,"supportsExportClip",!1),supportsExportFrameset:s(e,"supportsExportFrameset",!1),supportsMensuration:s(e,"supportsMensuration",!1),supportsUpdate:s(e,"supportsUpdate",!1)},query:{supportsCoverageQuery:e?.playbackInfo?.klv["0601"]??!1}}}},89551:(e,t,r)=>{"use strict";r.d(t,{L:()=>I});var i,n=r(35143),s=r(45802),o=r(42553),a=r(46053),l=r(21403),c=r(6409),u=r(28379),h=r(85842),d=r(40565),p=r(7982),f=r(44135),m=r(99603),g=(r(35238),r(81806),r(76460),r(47249),r(13312)),y=r(31608);let _=i=class extends o.oY{constructor(e){super(e),this.type="query-table"}clone(){const{workspaceId:e,query:t,oidFields:r,spatialReference:n,geometryType:s}=this,o={workspaceId:e,query:t,oidFields:r,spatialReference:n?.clone()??void 0,geometryType:s};return new i(o)}};var v;(0,n._)([(0,c.e)({queryTable:"query-table"})],_.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],_.prototype,"workspaceId",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],_.prototype,"query",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],_.prototype,"oidFields",void 0),(0,n._)([(0,a.MZ)({type:g.A,json:{write:!0}})],_.prototype,"spatialReference",void 0),(0,n._)([(0,c.e)(y.g)],_.prototype,"geometryType",void 0),_=i=(0,n._)([(0,h.$)("esri.layers.support.source.QueryTableDataSource")],_);let b=v=class extends o.oY{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new v({workspaceId:e,dataSourceName:t})}};var w;(0,n._)([(0,c.e)({raster:"raster"})],b.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],b.prototype,"dataSourceName",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],b.prototype,"workspaceId",void 0),b=v=(0,n._)([(0,h.$)("esri.layers.support.source.RasterDataSource")],b);let x=w=class extends o.oY{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:r}=this;return new w({workspaceId:e,gdbVersion:t,dataSourceName:r})}};var S,T;(0,n._)([(0,c.e)({table:"table"})],x.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],x.prototype,"workspaceId",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],x.prototype,"gdbVersion",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],x.prototype,"dataSourceName",void 0),x=w=(0,n._)([(0,h.$)("esri.layers.support.source.TableDataSource")],x);const M=(0,s.O)()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let A=S=class extends o.oY{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,r){return E()(e,t,r)}castLeftTableSource(e){return(0,d.aq)(P(),e)}readRightTableSource(e,t,r){return E()(e,t,r)}castRightTableSource(e){return(0,d.aq)(P(),e)}clone(){const{leftTableKey:e,rightTableKey:t,leftTableSource:r,rightTableSource:i,joinType:n}=this,s={leftTableKey:e,rightTableKey:t,leftTableSource:r?.clone()??void 0,rightTableSource:i?.clone()??void 0,joinType:n};return new S(s)}};(0,n._)([(0,c.e)({joinTable:"join-table"})],A.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],A.prototype,"leftTableKey",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],A.prototype,"rightTableKey",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],A.prototype,"leftTableSource",void 0),(0,n._)([(0,u.w)("leftTableSource")],A.prototype,"readLeftTableSource",null),(0,n._)([(0,l.w)("leftTableSource")],A.prototype,"castLeftTableSource",null),(0,n._)([(0,a.MZ)({json:{write:!0}})],A.prototype,"rightTableSource",void 0),(0,n._)([(0,u.w)("rightTableSource")],A.prototype,"readRightTableSource",null),(0,n._)([(0,l.w)("rightTableSource")],A.prototype,"castRightTableSource",null),(0,n._)([(0,c.e)(M)],A.prototype,"joinType",void 0),A=S=(0,n._)([(0,h.$)("esri.layers.support.source.JoinTableDataSource")],A);let C=null;function E(){return C||(C=(0,p.C)({types:P()})),C}let R=null;function P(){return R||(R={key:"type",base:null,typeMap:{"data-layer":I,"map-layer":m.f}}),R}const O={key:"type",base:null,typeMap:{"join-table":A,"query-table":_,raster:b,table:x}};let I=T=class extends o.oY{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new T({fields:e,dataSource:t})}};(0,n._)([(0,c.e)({dataLayer:"data-layer"})],I.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:[f.A],json:{write:!0}})],I.prototype,"fields",void 0),(0,n._)([(0,a.MZ)({types:O,json:{write:!0}})],I.prototype,"dataSource",void 0),I=T=(0,n._)([(0,h.$)("esri.layers.support.source.DataLayerSource")],I),I.from=(0,d.dp)(I)},99603:(e,t,r)=>{"use strict";r.d(t,{f:()=>u});var i,n=r(35143),s=r(42553),o=r(46053),a=r(40565),l=(r(47249),r(81806),r(6409)),c=r(85842);let u=i=class extends s.oY{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new i({mapLayerId:e,gdbVersion:t})}};(0,n._)([(0,l.e)({mapLayer:"map-layer"})],u.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:a.jz,json:{write:!0}})],u.prototype,"mapLayerId",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],u.prototype,"gdbVersion",void 0),u=i=(0,n._)([(0,c.$)("esri.layers.support.source.MapLayerSource")],u)},38278:(e,t,r)=>{"use strict";r.d(t,{D:()=>s});var i=r(13096);const n=[];function s(e,t){if((0,i.Wo)(e.url??""))return!0;const{wkid:r}=t;for(const i of n){if((e.version??0)>=i[0])return!0;if("function"==typeof i[1]&&(i[1]=i[1]()),i[1].has(r))return!1}return!0}n.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=23301;t<=23333;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102934;t<=102955;t++)e.add(t);return e}]),n.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),n.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),n.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),n.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=22619;t<=22621;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);return e}])},26452:(e,t,r)=>{"use strict";r.d(t,{R:()=>s,t:()=>o});var i=r(27347);const n={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{"-"===t.charAt(0)?e.style.setProperty(t,r):e.style[t]=r}};let s=e=>(0,i.X$)(n,e),o={create:(e,t)=>(t=s(t),(0,i.dj)(e,document.createElement("div"),void 0,t),(0,i.Av)(e,t)),append:(e,t,r)=>(r=s(r),(0,i.dj)(t,e,void 0,r),(0,i.Av)(t,r)),insertBefore:(e,t,r)=>(r=s(r),(0,i.dj)(t,e.parentNode,e,r),(0,i.Av)(t,r)),merge:(e,t,r)=>(r=s(r),t.domNode=e,(0,i.OM)(e,t,r),(0,i.Av)(t,r)),replace:(e,t,r)=>(r=s(r),(0,i.dj)(t,e.parentNode,e,r),e.parentNode.removeChild(e),(0,i.Av)(t,r))}},27347:(e,t,r)=>{"use strict";r.d(t,{Av:()=>E,OM:()=>S,X$:()=>l,dj:()=>T});var i=r(76099);const n="http://www.w3.org/",s=`${n}2000/svg`,o=`${n}1999/xlink`;let a=[],l=(e,t)=>{let r={};return Object.keys(e).forEach((t=>{r[t]=e[t]})),t&&Object.keys(t).forEach((e=>{r[e]=t[e]})),r},c=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),u=e=>{if("string"!=typeof e)throw new Error("Style values must be strings")},h=(e,t,r)=>{if(""!==t.vnodeSelector)for(let i=r;i<e.length;i++)if(c(e[i],t))return i;return-1},d=(e,t,r,i)=>{let n=e[t];if(""===n.vnodeSelector)return;let s=n.properties;if(!(s?void 0===s.key?s.bind:s.key:void 0))for(let o=0;o<e.length;o++)if(o!==t){let t=e[o];if(c(t,n))throw new Error(`${r.vnodeSelector} had a ${n.vnodeSelector} child ${"added"===i?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}},p=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},f=[],m=!1,g=e=>{(e.children||[]).forEach(g),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},y=()=>{m=!1,f.forEach(g),f.length=0},_=e=>{f.push(e),m||(m=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(y,{timeout:16}):setTimeout(y,16))},v=e=>{let t=e.domNode;if(e.properties){let r=e.properties.exitAnimation;if(r){t.style.pointerEvents="none";let i=()=>{t.parentNode&&(t.parentNode.removeChild(t),_(e))};return void r(t,i,e.properties)}}t.parentNode&&(t.parentNode.removeChild(t),_(e))},b=(e,t,r)=>{if(!t)return;let n=r.eventHandlerInterceptor,a=Object.keys(t),l=a.length;for(let c=0;c<l;c++){let l=a[c],h=t[l];if("className"===l)throw new Error('Property "className" is not supported, use "class".');if("class"===l)M(e,h,!0);else if("classes"===l){let t=Object.keys(h),r=t.length;for(let i=0;i<r;i++){let r=t[i];h[r]&&e.classList.add(r)}}else if("styles"===l){let t=Object.keys(h),i=t.length;for(let n=0;n<i;n++){let i=t[n],s=h[i];s&&(u(s),r.styleApplyer(e,i,s))}}else if("key"!==l&&null!=h){let a=typeof h;"function"===a?(0===l.lastIndexOf("on",0)&&(n&&(h=n(l,h,e,t)),"oninput"===l&&function(){let e=h;h=function(t){e.apply(this,[t]),t.target["oninput-value"]=t.target.value}}()),e[l]=h):r.namespace===s?"href"===l?e.setAttributeNS(o,l,h):e.setAttribute(l,h):"string"===a&&"value"!==l?"innerHTML"===l?e[l]=i.W5.sanitize(h):w(e)&&l in e?e[l]=h:e.setAttribute(l,h):e[l]=h}}};function w(e){if(!(e instanceof Element&&e.tagName.includes("-")))return!1;const t=window.customElements.get(e.tagName.toLowerCase());return!!t&&e instanceof t}let x,S=(e,t,r)=>{((e,t,r)=>{if(t)for(let i of t)T(i,e,void 0,r)})(e,t.children,r),t.text&&(e.textContent=t.text),b(e,t.properties,r),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,r,t.vnodeSelector,t.properties,t.children])},T=(e,t,r,i)=>{let n,o=0,a=e.vnodeSelector,c=t.ownerDocument;if(""===a)n=e.domNode=c.createTextNode(e.text),void 0!==r?t.insertBefore(n,r):t.appendChild(n);else{for(let u=0;u<=a.length;++u){let h=a.charAt(u);if(u===a.length||"."===h||"#"===h){let h=a.charAt(o-1),d=a.slice(o,u);"."===h?n.classList.add(d):"#"===h?n.id=d:("svg"===d&&(i=l(i,{namespace:s})),void 0!==i.namespace?n=e.domNode=c.createElementNS(i.namespace,d):(n=e.domNode=e.domNode||c.createElement(d),"input"===d&&e.properties&&void 0!==e.properties.type&&n.setAttribute("type",e.properties.type)),void 0!==r?t.insertBefore(n,r):n.parentNode!==t&&t.appendChild(n)),o=u+1}}S(n,e,i)}},M=(e,t,r)=>{t&&t.split(" ").forEach((t=>{t&&e.classList.toggle(t,r)}))},A=(e,t,r,n)=>{if(!r)return;let a=!1,l=Object.keys(r),c=l.length;for(let h=0;h<c;h++){let c=l[h],d=r[c],p=t[c];if("class"===c)p!==d&&(M(e,p,!1),M(e,d,!0));else if("classes"===c){let t=e.classList,r=Object.keys(d),i=r.length;for(let e=0;e<i;e++){let i=r[e],n=!!d[i];n!==!!p[i]&&(a=!0,n?t.add(i):t.remove(i))}}else if("styles"===c){let t=Object.keys(d),r=t.length;for(let i=0;i<r;i++){let r=t[i],s=d[r];s!==p[r]&&(a=!0,s?(u(s),n.styleApplyer(e,r,s)):n.styleApplyer(e,r,""))}}else if(d||"string"!=typeof p||(d=""),"value"!==c||w(e)){if(d!==p){let t=typeof d;"function"===t&&n.eventHandlerInterceptor||(n.namespace===s?"href"===c?e.setAttributeNS(o,c,d):e.setAttribute(c,d):"string"===t?"innerHTML"===c?e[c]=i.W5.sanitize(d):"role"===c&&""===d?e.removeAttribute(c):w(e)&&c in e?e[c]=d:e.setAttribute(c,d):e[c]!==d&&(e[c]=d),a=!0)}}else{let t=e[c];t!==d&&(e["oninput-value"]?t===e["oninput-value"]:d!==p)&&(e[c]=d,e["oninput-value"]=void 0),d!==p&&(a=!0)}}return a},C=(e,t,r,i,n)=>{if(r===i)return!1;i=i||a;let s,o=(r=r||a).length,l=i.length,u=0,f=0,m=!1;for(;f<l;){let a=u<o?r[u]:void 0,l=i[f];if(void 0!==a&&c(a,l))m=x(a,l,n)||m,u++;else{let a=h(r,l,u+1);if(a>=0){for(s=u;s<a;s++)v(r[s]),d(r,s,e,"removed");m=x(r[a],l,n)||m,u=a+1}else T(l,t,u<o?r[u].domNode:void 0,n),p(l),d(i,f,e,"added")}f++}if(o>u)for(s=u;s<o;s++)v(r[s]),d(r,s,e,"removed");return m};x=(e,t,r)=>{let i=e.domNode,n=!1;if(e===t)return!1;let o=!1;if(""===t.vnodeSelector){if(t.text!==e.text){let e=i.ownerDocument.createTextNode(t.text);return i.parentNode.replaceChild(e,i),t.domNode=e,n=!0,n}t.domNode=i}else 0===t.vnodeSelector.lastIndexOf("svg",0)&&(r=l(r,{namespace:s})),e.text!==t.text&&(o=!0,void 0===t.text?i.removeChild(i.firstChild):i.textContent=t.text),t.domNode=i,o=C(t,i,e.children,t.children,r)||o,o=A(i,e.properties,t.properties,r)||o,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[i,r,t.vnodeSelector,t.properties,t.children]);return o&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(i,t.properties,e.properties),n};let E=(e,t)=>({getLastRender:()=>e,update:r=>{if(e.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=e;e=r,x(i,r,t)},domNode:e.domNode})},48396:(e,t,r)=>{"use strict";r.d(t,{F:()=>a});var i=r(26452);let n;n=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let s=(e,t)=>{let r=e;return t.forEach((e=>{r=r&&r.children?n(r.children,(t=>t.domNode===e)):void 0})),r},o=(e,t,r)=>{let i=function(i){r("domEvent",i);let n=t(),o=((e,t)=>{let r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r})(i.currentTarget,n.domNode);o.reverse();let a,l=s(n.getLastRender(),o);return e.scheduleRender(),l&&(a=l.properties[`on${i.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",i),a};return(e,t,r,n)=>i},a=e=>{let t,r,n=(0,i.R)(e),s=n.performanceLogger,a=!0,l=!1,c=[],u=[],h=(e,r,i)=>{let a;n.eventHandlerInterceptor=o(t,(()=>a),s),a=e(r,i(),n),c.push(a),u.push(i)},d=()=>{if(r=void 0,a){a=!1,s("renderStart",void 0);for(let e=0;e<c.length;e++){let t=u[e]();s("rendered",void 0),c[e].update(t),s("patched",void 0)}s("renderDone",void 0),a=!0}};return t={renderNow:d,scheduleRender:()=>{r||l||(r=requestAnimationFrame(d))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),l=!0},resume:()=>{l=!1,a=!0,t.scheduleRender()},append:(e,t)=>{h(i.t.append,e,t)},insertBefore:(e,t)=>{h(i.t.insertBefore,e,t)},merge:(e,t)=>{h(i.t.merge,e,t)},replace:(e,t)=>{h(i.t.replace,e,t)},detach:e=>{for(let t=0;t<u.length;t++)if(u[t]===e)return u.splice(t,1),c.splice(t,1)[0];throw new Error("renderFunction was not found")}},t}},83475:(e,t,r)=>{"use strict";r.d(t,{default:()=>K});var i=r(35143),n=r(39356),s=r(46053),o=(r(81806),r(76460)),a=(r(47249),r(85842)),l=r(38451),c=r(74438),u=(r(35238),r(3825)),h=r(50076),d=r(49304),p=r(77717),f=r(50346),m=r(90534),g=r(76797),y=r(19902),_=r(61979),v=r(13096),b=r(45802),w=r(6409),x=r(11187);const S=(0,b.O)()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let T=class extends x.A{constructor(e){super(e),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const t={...e,query:{f:"json"}},{data:r}=await(0,u.A)(this.statusUrl,t);return this.read(r),this.editsResolver&&this.editsResolver.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0,historicMoment:null}),this}async waitForJobCompletion(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{interval:t=1e3,statusCallback:r}=e;return new Promise(((e,i)=>{this._clearTimer();const n=setInterval((()=>{this._timer||i((0,f.NK)()),this.checkJobStatus().then((t=>{const{status:i}=t;switch(this.status=i,i){case"job-succeeded":this._clearTimer(),e(this);break;case"job-waiting":case"job-executing":r&&r(this)}}),(e=>{this._clearTimer(),i(e)}))}),t);this._timer=n}))}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};(0,i._)([(0,s.MZ)()],T.prototype,"editsResolver",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],T.prototype,"statusUrl",void 0),(0,i._)([(0,w.e)(S)],T.prototype,"status",void 0),(0,i._)([(0,s.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.submissionTime=e?e.getTime():null}}}})],T.prototype,"submissionTime",void 0),(0,i._)([(0,s.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.lastUpdatedTime=e?e.getTime():null}}}})],T.prototype,"lastUpdatedTime",void 0),T=(0,i._)([(0,a.$)("esri.networks.support.TopologyValidationJobInfo")],T);const M=T;var A=r(70652);r(77725);async function C(e,t){if("Utility Network Layer"===e){const{default:e}=await Promise.resolve().then(r.bind(r,83475));return new e({layerUrl:t})}return null}var E=r(35298),R=r(13312);let P=class extends((0,p.P)(d.A)){static fromPortalItem(e){return async function(e){let t="portalItem"in e?e:{portalItem:e};!t.portalItem||t.portalItem instanceof A.default||(t={...t,portalItem:new A.default(t.portalItem)});const r=t.portalItem;if(await r.load(),"Feature Service"!==r.type)throw new h.A("portal:unknown-item-type","Unknown item type '${type}'",{type:r.type});const i=r.url,n=await(0,u.A)(i,{responseType:"json",query:{f:"json"}}),s="Network Layer";if(n.data.type?.includes(s))return C(n.data.type,i);if(n.data.layers){const e=n.data.layers.find((e=>e.type.includes(s)));if(e){const t=`${i}/${e.id}`;return C(e.type,t)}}return null}(e)}constructor(e){super(e),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null,this.sourceJSON=null,this.gdbVersion=null,this.historicMoment=null,this._applyEditsHandler=e=>{const{serviceUrl:t,gdbVersion:r,result:i}=e,n=t===this.featureServiceUrl,s=(0,_.gz)(t,r,this.gdbVersion);n&&s&&i.then((e=>{(0,E.w5)(t,r)&&(this.historicMoment=e.historicMoment)}))},this._updateMomentHandler=e=>{const{serviceUrl:t,gdbVersion:r,moment:i}=e,n=t===this.featureServiceUrl,s=(0,_.gz)(t,r,this.gdbVersion);n&&s&&(this.historicMoment=i)},this.when().then((()=>{this.addHandles([(0,_.Jz)(this._applyEditsHandler),(0,_.dP)(this._updateMomentHandler)])}),(()=>{}))}initialize(){this.when().catch((e=>{(0,f.zf)(e)||o.A.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})}))}get datasetName(){return this.dataElement?.name??null}get owner(){return this.dataElement?.userIdentity??null}get schemaGeneration(){return this.dataElement?.schemaGeneration??null}get parsedUrl(){return(0,m.An)(this.layerUrl)}get featureServiceUrl(){return(0,v.qg)(this.parsedUrl.path).url.path}get networkServiceUrl(){return this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer")}get layerId(){return(0,v.qg)(this.parsedUrl.path).sublayer}get networkSystemLayers(){return null}async load(e){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),e)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,e)),this}getLayerIdBySourceId(e){if(this.dataElement){const t=this.dataElement.domainNetworks;for(const r of t){for(const t of r.edgeSources??[])if(t.sourceId===e)return t.layerId;for(const t of r.junctionSources??[])if(t.sourceId===e)return t.layerId}return null}return null}async queryNamedTraceConfigurations(e,t){const[{queryNamedTraceConfigurations:i},{default:n}]=await Promise.all([r.e(8341).then(r.bind(r,8341)),r.e(7194).then(r.bind(r,77194))]),s=this.networkServiceUrl,o=n.from(e);return(await i(s,o,{...t}))?.namedTraceConfigurations}async validateTopology(e,t){if(!e.validateArea)throw new h.A("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");const[{validateNetworkTopology:i},{default:n}]=await Promise.all([r.e(7814).then(r.bind(r,77814)),r.e(8266).then(r.bind(r,28266))]),s=n.from(e);(0,E.w5)(this.featureServiceUrl,this.gdbVersion||null)?(s.sessionID=E.TA,await(0,E.ZJ)(this.featureServiceUrl,this.gdbVersion,!0)):s.sessionID=null,s.gdbVersion=this.gdbVersion;const o=this.networkServiceUrl,a=this.featureServiceUrl,l=(0,_.Zk)(a,null,this.gdbVersion,!0),c=await i(o,s,{...t});if(c?.serviceEdits){const e=[];for(const t of c.serviceEdits){const{editedFeatures:r}=t,i=r?.spatialReference?new R.A(r.spatialReference):null;e.push({layerId:t.layerId,editedFeatures:{adds:r?.adds?.map((e=>O(e,i)))||[],updates:r?.updates?.map((e=>({original:O(e[0],i),current:O(e[1],i)})))||[],deletes:r?.deletes?.map((e=>O(e,i)))||[],spatialReference:i}})}l.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],editedFeatures:e,exceededTransferLimit:!1,historicMoment:c.moment})}return c}async submitTopologyValidationJob(e,t){let i=null;if(!e.validateArea)throw new h.A("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");if(!this.gdbVersion){const e=this.layerUrl.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");i=(await(0,u.A)(e,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}const[{submitValidateNetworkTopologyJob:n},{default:s}]=await Promise.all([r.e(7814).then(r.bind(r,77814)),r.e(8266).then(r.bind(r,28266))]),o=s.from(e);(0,E.w5)(this.featureServiceUrl,this.gdbVersion||null)?(o.sessionID=E.TA,await(0,E.ZJ)(this.featureServiceUrl,this.gdbVersion,!0)):o.sessionID=null,o.gdbVersion=this.gdbVersion||i;const a=this.networkServiceUrl,l=this.featureServiceUrl?(0,_.Zk)(this.featureServiceUrl,null,this.gdbVersion,!0):void 0,c=await n(a,o,{...t});return new M({statusUrl:c,editsResolver:l})}async _fetchLayerMetaData(e,t){const r=await(0,u.A)(e,{responseType:"json",query:{f:"json"},...t});this.sourceJSON=r.data,this.read(r.data,{origin:"service"})}async _fetchDataElement(e,t,r){if(this.dataElement)return;const i=await(0,u.A)(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...r}).then((e=>e.data.layerDataElements?.[0]));i&&this.read(i,{origin:"service"})}};function O(e,t){return new n.A({attributes:e.attributes,geometry:(0,y.rS)({...e.geometry,spatialReference:t})})}(0,i._)([(0,s.MZ)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:!0}},read:!1}})],P.prototype,"id",void 0),(0,i._)([(0,s.MZ)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],P.prototype,"title",void 0),(0,i._)([(0,s.MZ)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],P.prototype,"layerUrl",void 0),(0,i._)([(0,s.MZ)({type:Object,json:{origins:{service:{read:!0}},read:!1}})],P.prototype,"dataElement",void 0),(0,i._)([(0,s.MZ)({type:g.A,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],P.prototype,"fullExtent",void 0),(0,i._)([(0,s.MZ)({type:R.A,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],P.prototype,"spatialReference",void 0),(0,i._)([(0,s.MZ)({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],P.prototype,"type",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],P.prototype,"datasetName",null),(0,i._)([(0,s.MZ)({readOnly:!0})],P.prototype,"owner",null),(0,i._)([(0,s.MZ)({readOnly:!0})],P.prototype,"schemaGeneration",null),(0,i._)([(0,s.MZ)({readOnly:!0})],P.prototype,"parsedUrl",null),(0,i._)([(0,s.MZ)({readOnly:!0})],P.prototype,"featureServiceUrl",null),(0,i._)([(0,s.MZ)({readOnly:!0})],P.prototype,"networkServiceUrl",null),(0,i._)([(0,s.MZ)({readOnly:!0})],P.prototype,"layerId",null),(0,i._)([(0,s.MZ)()],P.prototype,"sourceJSON",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],P.prototype,"networkSystemLayers",null),(0,i._)([(0,s.MZ)()],P.prototype,"gdbVersion",void 0),(0,i._)([(0,s.MZ)({type:Date})],P.prototype,"historicMoment",void 0),P=(0,i._)([(0,a.$)("esri.networks.Network")],P);const I=P;var L=r(42553),N=r(12899);let D=class extends((0,L.Te)(d.A)){constructor(e){super(e),this.rulesCategorized={attachment:[],containment:[],connectivity:[]},this.request=u.A}initialize(){}async load(e){const t=this.layer.load(e).then((()=>this._initializeRulesTable()));return this.addResolvingPromise(t),this}getFeatureSQL(e,t){const r=e.layerId.toString(),i=e.fieldsIndex?.normalizeFieldName("assetGroup"),n=e.fieldsIndex?.normalizeFieldName("assetType"),s=i?t.attributes[i]:null,o=n?t.attributes[n]:null,a=this.rulesHash[r];if(a){const e=a.assetGroupHash[s];if(e)return e.assetTypeHash[o]||null}return null}async _initializeRulesTable(){const e={};let t;!function(e){e[e.from=0]="from",e[e.to=1]="to",e[e.via=2]="via"}(t||(t={}));const r=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];this.rulesCategorized={attachment:[],containment:[],connectivity:[]};for(const i of this.rules){if(i.ruleType===N.D2.RTAttachment){this.rulesCategorized.attachment.push(i);continue}if(i.ruleType===N.D2.RTContainment){this.rulesCategorized.containment.push(i);continue}if(i.ruleType===N.D2.RTJunctionJunctionConnectivity){this.rulesCategorized.connectivity.push(i);continue}this.rulesCategorized.connectivity.push(i);let n=[[t.from,t.to],[t.to,t.from]];i.ruleType===N.D2.RTEdgeJunctionEdgeConnectivity&&(n=[[t.from,t.via],[t.via,t.from],[t.to,t.via],[t.via,t.to]]);for(const s of n){const n=s.shift(),o=s.shift();let a=!1;switch(i.ruleType){case N.D2.RTEdgeJunctionEdgeConnectivity:a=n===t.from||n===t.to;break;case N.D2.RTJunctionEdgeConnectivity:a=n===t.to}const l=r[n],c=i[l.networkSourceId]?.layerId.toString()??"",u=i[l.assetGroupId]?.assetGroupCode?.toString(),h=i[l.assetTypeId],d=h?.assetTypeCode?.toString(),p=r[o],f=i[p.networkSourceId]?.layerId.toString()??"",m=i[p.assetGroupId]?.assetGroupCode?.toString(),g=i[p.assetTypeId],y=g?.assetTypeCode?.toString(),_=e[c]??{assetGroupHash:{}};if(!(u&&d&&m&&y))continue;const v=_.assetGroupHash[u]??{assetTypeHash:{}},b=v.assetTypeHash[d]??{};if(b[f]=b[f]??{},a){b[c]=b[c]??{};const e=`(assetgroup = ${u} AND assettype = ${d})`;b[c].anyVertex=b[c].anyVertex?`${b[c].anyVertex}`:`${e}`,"esriNECPEndVertex"===g?.connectivityPolicy&&(b[c].endVertex=b[c]?.endVertex?`${b[c].endVertex}`:`${e}`)}const w=`(assetgroup = ${m} AND assettype = ${y})`;b[f].anyVertex=b[f]?.anyVertex?`${b[f].anyVertex} OR ${w}`:`${w}`,"esriNECPEndVertex"===g?.connectivityPolicy&&(b[f].endVertex=b[f]?.endVertex?`${b[f].endVertex} OR ${w}`:`${w}`),v.assetTypeHash[d]=b,_.assetGroupHash[u]=v,e[c]=_}}this.rulesHash=e}};(0,i._)([(0,s.MZ)({constructOnly:!0})],D.prototype,"layer",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],D.prototype,"rules",void 0),(0,i._)([(0,s.MZ)()],D.prototype,"rulesHash",void 0),(0,i._)([(0,s.MZ)()],D.prototype,"rulesCategorized",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],D.prototype,"request",void 0),D=(0,i._)([(0,a.$)("esri.networks.RulesTable")],D);const F=D;var k=r(99666),z=r(91967);let U=class extends z.A{constructor(e){super(e),this.rulesTableId=null,this.rulesTableUrl=null,this.subnetworksTableId=null,this.subnetworksTableUrl=null,this.dirtyAreasLayerId=null,this.dirtyAreasLayerUrl=null,this.associationsTableId=null,this.associationsTableUrl=null}};(0,i._)([(0,s.MZ)({constructOnly:!0})],U.prototype,"rulesTableId",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],U.prototype,"rulesTableUrl",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],U.prototype,"subnetworksTableId",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],U.prototype,"subnetworksTableUrl",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],U.prototype,"dirtyAreasLayerId",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],U.prototype,"dirtyAreasLayerUrl",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],U.prototype,"associationsTableId",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],U.prototype,"associationsTableUrl",void 0),U=(0,i._)([(0,a.$)("esri.networks.support.NetworkSystemLayers")],U);const V=U;let B=class extends L.oY{constructor(e){super(e),this.id=null,this.name=null}};(0,i._)([(0,s.MZ)({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],B.prototype,"id",void 0),(0,i._)([(0,s.MZ)({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],B.prototype,"name",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],B.prototype,"isUpstreamTerminal",void 0),B=(0,i._)([(0,a.$)("esri.networks.support.Terminal")],B);const j=B,H=new b.J({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"});let G=class extends L.oY{constructor(e){super(e),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null}};(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],G.prototype,"defaultConfiguration",void 0),(0,i._)([(0,s.MZ)({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],G.prototype,"id",void 0),(0,i._)([(0,s.MZ)({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],G.prototype,"name",void 0),(0,i._)([(0,s.MZ)({type:[j],json:{write:!0}})],G.prototype,"terminals",void 0),(0,i._)([(0,s.MZ)({type:H.apiValues,json:{type:H.jsonValues,read:H.read,write:H.write}})],G.prototype,"traversabilityModel",void 0),G=(0,i._)([(0,a.$)("esri.networks.support.TerminalConfiguration")],G);const Z=G;var $=r(57778);const q=(0,b.O)()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let W=class extends $.A{constructor(e){super(e),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const t={...e,query:{f:"json"}},{data:r}=await(0,u.A)(this.statusUrl,t),i=r.traceResults?{...r.traceResults,...r}:r;return this.read(i),this}async waitForJobCompletion(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{interval:t=1e3,statusCallback:r}=e;return new Promise(((e,i)=>{this._clearTimer();const n=setInterval((()=>{this._timer||i((0,f.NK)()),this.checkJobStatus().then((t=>{const{status:i}=t;switch(this.status=i,i){case"job-succeeded":this._clearTimer(),e(this);break;case"job-waiting":case"job-executing":r&&r(this)}}),(e=>{this._clearTimer(),i(e)}))}),t);this._timer=n}))}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],W.prototype,"statusUrl",void 0),(0,i._)([(0,w.e)(q)],W.prototype,"status",void 0),(0,i._)([(0,s.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.submissionTime=e?e.getTime():null}}}})],W.prototype,"submissionTime",void 0),(0,i._)([(0,s.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.lastUpdatedTime=e?e.getTime():null}}}})],W.prototype,"lastUpdatedTime",void 0),W=(0,i._)([(0,a.$)("esri.networks.support.TraceJobInfo")],W);const Y=W;var X=r(68295);let J=class extends I{constructor(e){super(e),this.sharedNamedTraceConfigurations=[],this.type="utility"}get serviceTerritoryFeatureLayerId(){return this.dataElement?.serviceTerritoryFeatureLayerId??null}get networkSystemLayers(){return new V({rulesTableId:this.sourceJSON?.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.rulesTableId}`:null,subnetworksTableId:this.sourceJSON?.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:this.sourceJSON?.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.dirtyAreasLayerId}`:null,associationsTableId:this.sourceJSON?.systemLayers.associationsTableId,associationsTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.associationsTableId}`:null})}get terminalConfigurations(){return this.dataElement?.terminalConfigurations.map((e=>Z.fromJSON(e)))||[]}get domainNetworkNames(){return this.dataElement?.domainNetworks.map((e=>e.domainNetworkName))||[]}get _utilityLayerList(){const e=new Set;return this.dataElement?.domainNetworks?.map((t=>{t.edgeSources.map((t=>{e.add(t.layerId)})),t.junctionSources.map((t=>{e.add(t.layerId)}))})),e}async load(e){return this.addResolvingPromise(super.load(e)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(e)),this}getTerminalConfiguration(e){let t=null,r=null;const i=e.layer;let n=null;if("feature"===i?.type){if(n=i.layerId,null===n)return null}else{if("subtype-sublayer"!==i?.type)return null;if(n=i?.parent?.layerId??null,null===n)return null}const s=e.attributes;if(null==s)return null;for(const l of Object.keys(s))"ASSETGROUP"===l.toUpperCase()&&(t=e.getAttribute(l)),"ASSETTYPE"===l.toUpperCase()&&(r=e.getAttribute(l));if(!this.dataElement)return null;let o=null;const a=this.dataElement.domainNetworks;for(const l of a){const e=l.junctionSources?.find((e=>e.layerId===n));if(e){const i=e.assetGroups?.find((e=>e.assetGroupCode===t));if(i){const e=i.assetTypes?.find((e=>e.assetTypeCode===r));if(e){o=e.terminalConfigurationId;break}}}}if(null!=o){const e=this.dataElement.terminalConfigurations,t=e?.find((e=>e.terminalConfigurationId===o));return t?Z.fromJSON(t):null}return null}getTierNames(e){const t=this.dataElement?.domainNetworks.find((t=>t.domainNetworkName===e));return t?.tiers.map((e=>e.name))||[]}async getRulesTable(){return this._sharedRulesTable||(this._sharedRulesTable=this._createRulesTable()),await this._sharedRulesTable}isUtilityLayer(e){return this._utilityLayerList.has(e.layerId)&&(e.url?.startsWith(this.featureServiceUrl)??!1)}async queryAssociations(e){const[{queryAssociations:t},{default:i}]=await Promise.all([r.e(4176).then(r.bind(r,34176)),r.e(2623).then(r.bind(r,2623))]),n=i.from(e);return n.gdbVersion=this.gdbVersion,n.moment=this.historicMoment,(await t(this.networkServiceUrl,n)).associations}async synthesizeAssociationGeometries(e){const[{synthesizeAssociationGeometries:t},{default:i}]=await Promise.all([r.e(440).then(r.bind(r,70440)),r.e(5624).then(r.bind(r,75624))]),n=i.from(e);return n.gdbVersion=this.gdbVersion,n.moment=this.historicMoment,t(this.networkServiceUrl,n)}async trace(e){const[{trace:t},{default:i}]=await Promise.all([r.e(998).then(r.bind(r,40998)),r.e(4515).then(r.bind(r,54515))]),n=i.from(e);return n.gdbVersion=this.gdbVersion,n.moment=this.historicMoment,t(this.networkServiceUrl,n)}async submitTraceJob(e){const[{submitTraceJob:t},{default:i}]=await Promise.all([r.e(998).then(r.bind(r,40998)),r.e(4515).then(r.bind(r,54515))]),n=i.from(e);n.gdbVersion=this.gdbVersion,n.moment=this.historicMoment;const s=await t(this.networkServiceUrl,n);return new Y({statusUrl:s})}async canAddAssociation(e){const t=await this.getRulesTable();if(!t)return!1;await t.load();const r=(e,t)=>e?1===e.terminalId?!t?.terminalId||t?.terminalId===e.terminalId:e.terminalId===t?.terminalId:!t?.terminalId,i=(e,t)=>e.fromNetworkSource?.sourceId===t.fromNetworkElement?.networkSourceId&&e.toNetworkSource?.sourceId===t.toNetworkElement?.networkSourceId&&e.fromAssetGroup?.assetGroupCode===t.fromNetworkElement?.assetGroupCode&&e.fromAssetType?.assetTypeCode===t.fromNetworkElement?.assetTypeCode&&e.toAssetGroup?.assetGroupCode===t.toNetworkElement?.assetGroupCode&&e.toAssetType?.assetTypeCode===t.toNetworkElement?.assetTypeCode&&r(e.fromTerminal,t.fromNetworkElement)&&r(e.toTerminal,t.toNetworkElement);return"containment"===e.associationType?t.rulesCategorized.containment.some((t=>i(t,e))):"attachment"===e.associationType?t.rulesCategorized.attachment.some((t=>i(t,e))):t.rulesCategorized.connectivity.some((t=>t.viaNetworkSource?t.fromNetworkSource?.sourceId===e.fromNetworkElement?.networkSourceId&&t.viaNetworkSource?.sourceId===e.toNetworkElement?.networkSourceId&&t.fromAssetGroup?.assetGroupCode===e.fromNetworkElement?.assetGroupCode&&t.fromAssetType?.assetTypeCode===e.fromNetworkElement?.assetTypeCode&&t.viaAssetGroup?.assetGroupCode===e.toNetworkElement?.assetGroupCode&&t.viaAssetType?.assetTypeCode===e.toNetworkElement?.assetTypeCode&&r(t.fromTerminal,e.fromNetworkElement)&&r(t.viaTerminal,e.toNetworkElement)||t.viaNetworkSource?.sourceId===e.fromNetworkElement?.networkSourceId&&t.toNetworkSource?.sourceId===e.toNetworkElement?.networkSourceId&&t.viaAssetGroup?.assetGroupCode===e.fromNetworkElement?.assetGroupCode&&t.viaAssetType?.assetTypeCode===e.fromNetworkElement?.assetTypeCode&&t.toAssetGroup?.assetGroupCode===e.toNetworkElement?.assetGroupCode&&t.toAssetType?.assetTypeCode===e.toNetworkElement?.assetTypeCode&&r(t.viaTerminal,e.fromNetworkElement)&&r(t.toTerminal,e.toNetworkElement):i(t,e)))}generateAddAssociations(e){return{addFeatures:e.map((e=>new n.A({attributes:{fromnetworksourceid:e.fromNetworkElement?.networkSourceId,fromglobalid:e.fromNetworkElement?.globalId,fromterminalid:e.fromNetworkElement?.terminalId,tonetworksourceid:e.toNetworkElement?.networkSourceId,toglobalid:e.toNetworkElement?.globalId,toterminalid:e.toNetworkElement?.terminalId,associationtype:N.v9[e.associationType],iscontentvisible:e.isContentVisible?1:0,percentalong:e.percentAlong,globalid:e.globalId}}))),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:"globalid",objectIdField:"objectid"}}}generateDeleteAssociations(e){return{deleteFeatures:e.map((e=>({globalId:e.globalId}))),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:"globalid",objectIdField:"objectid"}}}async _loadNamedTraceConfigurationsFromNetwork(e){if(0===this.sharedNamedTraceConfigurations?.length)return;const t=this.sharedNamedTraceConfigurations.map((e=>e.globalId)),r=await this.queryNamedTraceConfigurations({globalIds:t},e);for(const i of this.sharedNamedTraceConfigurations){const e=r?.find((e=>e.globalId===i.globalId));if(e){const t=e.write({},{origin:"service"});i.read(t,{origin:"service"})}}}async _createRulesTable(){const e=this.networkSystemLayers.rulesTableUrl,t=new l.default({url:e});await t.load();const r=this.dataElement?.domainNetworks;if(!r)return null;const i=r.flatMap((e=>[...e.edgeSources||[],...e.junctionSources||[]])),n=(await async function(e){const t=new X.A({where:"1=1",outFields:["*"]});return(await(0,c.SE)(e,t)).features}(t)).map((e=>this._hydrateRuleInfo(t,i,e)));return new F({layer:t,rules:n})}_hydrateRuleInfo(e,t,r){const i=e.fieldsIndex,n=i.get("RULETYPE"),s=i.get("CREATIONDATE"),o=i.get("FROMNETWORKSOURCEID"),a=i.get("FROMASSETGROUP"),l=i.get("FROMASSETTYPE"),c=i.get("FROMTERMINALID"),u=i.get("TONETWORKSOURCEID"),h=i.get("TOASSETGROUP"),d=i.get("TOASSETTYPE"),p=i.get("TOTERMINALID"),f=i.get("VIANETWORKSOURCEID"),m=i.get("VIAASSETGROUP"),g=i.get("VIAASSETTYPE"),y=i.get("VIATERMINALID"),_=r.attributes[n.name],v=new Date(r.attributes[s.name]),b=[{networkSourceId:r.attributes[o.name],assetGroupId:r.attributes[a.name],assetTypeId:r.attributes[l.name],terminalId:r.attributes[c.name]},{networkSourceId:r.attributes[u.name],assetGroupId:r.attributes[h.name],assetTypeId:r.attributes[d.name],terminalId:r.attributes[p.name]},{networkSourceId:r.attributes[f.name],assetGroupId:r.attributes[m.name],assetTypeId:r.attributes[g.name],terminalId:r.attributes[y.name]}];let w;!function(e){e[e.from=0]="from",e[e.to=1]="to",e[e.via=2]="via"}(w||(w={}));const x={ruleType:_,creationDate:v};for(const S of[w.from,w.to,w.via]){if(_!==N.D2.RTEdgeJunctionEdgeConnectivity&&S===w.via)continue;const e=b[S],r=t.find((t=>t.sourceId===e.networkSourceId)),i=r?.assetGroups.find((t=>t.assetGroupCode===e.assetGroupId)),n=i?.assetTypes.find((t=>t.assetTypeCode===e.assetTypeId)),s=this._getTerminal(n,e);let o="";switch(S){case w.from:o="from";break;case w.to:o="to";break;case w.via:o="via"}x[`${o}NetworkSource`]=r,x[`${o}AssetGroup`]=i,x[`${o}AssetType`]=n,x[`${o}Terminal`]=s?.toJSON()}return x}_getTerminal(e,t){const r=e?.terminalConfigurationId,i=this.terminalConfigurations?.find((e=>e.id===r));return i?.terminals?.find((e=>e.id===t.terminalId))??null}};(0,i._)([(0,s.MZ)({type:[k.A],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],J.prototype,"sharedNamedTraceConfigurations",void 0),(0,i._)([(0,s.MZ)({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],J.prototype,"type",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],J.prototype,"serviceTerritoryFeatureLayerId",null),(0,i._)([(0,s.MZ)({readOnly:!0})],J.prototype,"networkSystemLayers",null),(0,i._)([(0,s.MZ)({readOnly:!0})],J.prototype,"terminalConfigurations",null),(0,i._)([(0,s.MZ)({readOnly:!0})],J.prototype,"domainNetworkNames",null),J=(0,i._)([(0,a.$)("esri.networks.UtilityNetwork")],J);const K=J},99666:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i=r(35143),n=r(77717),s=r(46053),o=(r(81806),r(76460),r(47249),r(28379)),a=r(85842),l=r(79685),c=r(12899),u=r(64154);let h=class extends n.L{constructor(e){super(e),this.globalId=null,this.title=null,this.traceConfiguration=null,this.creationDate=null,this.creator=null,this.description=null,this.minStartingPoints=null,this.resultTypes=[],this.tags=[],this.traceType=null}readTraceConfiguration(e,t){return void 0!==e.tierName?u.A.fromJSON(e):l.A.fromJSON(e)}};(0,i._)([(0,s.MZ)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"},write:{target:"globalId",isRequired:!0}}},read:!1}})],h.prototype,"globalId",void 0),(0,i._)([(0,s.MZ)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"},write:{target:"name",isRequired:!0}}},read:!1}})],h.prototype,"title",void 0),(0,i._)([(0,s.MZ)({type:l.A,json:{origins:{service:{read:!0,write:!0}},read:!1}})],h.prototype,"traceConfiguration",void 0),(0,i._)([(0,o.w)("service","traceConfiguration")],h.prototype,"readTraceConfiguration",null),(0,i._)([(0,s.MZ)({type:Date,json:{origins:{service:{read:!0,write:!0}},read:!1}})],h.prototype,"creationDate",void 0),(0,i._)([(0,s.MZ)({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],h.prototype,"creator",void 0),(0,i._)([(0,s.MZ)({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],h.prototype,"description",void 0),(0,i._)([(0,s.MZ)({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"},write:{target:"minNumStartingPoints"}}},read:!1}})],h.prototype,"minStartingPoints",void 0),(0,i._)([(0,s.MZ)({json:{origins:{service:{read:!0,write:!0}},read:!1}})],h.prototype,"resultTypes",void 0),(0,i._)([(0,s.MZ)({type:[String],json:{origins:{service:{read:!0,write:!0}},read:!1}})],h.prototype,"tags",void 0),(0,i._)([(0,s.MZ)({type:c.fO.apiValues,json:{type:c.fO.jsonValues,origins:{service:{read:c.fO.read,write:c.fO.write}},read:!1}})],h.prototype,"traceType",void 0),h=(0,i._)([(0,a.$)("esri.networks.support.NamedTraceConfiguration")],h);const d=h},79685:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var i=r(35143),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842));let a=class extends n.oY{constructor(e){super(e),this.conditionBarriers=[],this.outputConditions=[],this.functions=[],this.functionBarriers=[],this.traversabilityScope=null,this.shortestPathNetworkAttributeName=null,this.includeBarriers=null,this.validateConsistency=null,this.ignoreBarriersAtStartingPoints=null}};(0,i._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"conditionBarriers",void 0),(0,i._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"outputConditions",void 0),(0,i._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"functions",void 0),(0,i._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"functionBarriers",void 0),(0,i._)([(0,s.MZ)({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],a.prototype,"traversabilityScope",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],a.prototype,"shortestPathNetworkAttributeName",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeBarriers",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"validateConsistency",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"ignoreBarriersAtStartingPoints",void 0),a=(0,i._)([(0,o.$)("esri.networks.support.TraceConfiguration")],a);const l=a},64154:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var i=r(35143),n=r(46053),s=(r(81806),r(76460),r(47249),r(85842)),o=r(79685);let a=class extends o.A{constructor(e){super(e),this.filterBarriers=[],this.arcadeExpressionBarrier=null,this.domainNetworkName=null,this.filterBitsetNetworkAttributeName=null,this.filterFunctionBarriers=[],this.filterScope=null,this.includeContainers=null,this.includeContent=null,this.includeIsolated=null,this.includeStructures=null,this.allowIndeterminateFlow=null,this.includeUpToFirstSpatialContainer=null,this.nearestNeighbor=null,this.outputFilterCategories=[],this.outputFilters=[],this.propagators=[],this.subnetworkName=null,this.targetTierName=null,this.diagramTemplateName=null,this.tierName=null,this.validateLocatability=null}};(0,i._)([(0,n.MZ)({type:[Object],json:{write:!0}})],a.prototype,"filterBarriers",void 0),(0,i._)([(0,n.MZ)({type:String,json:{write:!0}})],a.prototype,"arcadeExpressionBarrier",void 0),(0,i._)([(0,n.MZ)({type:String,json:{write:!0}})],a.prototype,"domainNetworkName",void 0),(0,i._)([(0,n.MZ)({type:String,json:{write:!0}})],a.prototype,"filterBitsetNetworkAttributeName",void 0),(0,i._)([(0,n.MZ)({type:[Object],json:{write:!0}})],a.prototype,"filterFunctionBarriers",void 0),(0,i._)([(0,n.MZ)({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],a.prototype,"filterScope",void 0),(0,i._)([(0,n.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeContainers",void 0),(0,i._)([(0,n.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeContent",void 0),(0,i._)([(0,n.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeIsolated",void 0),(0,i._)([(0,n.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeStructures",void 0),(0,i._)([(0,n.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"allowIndeterminateFlow",void 0),(0,i._)([(0,n.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeUpToFirstSpatialContainer",void 0),(0,i._)([(0,n.MZ)({type:Object,json:{write:!0}})],a.prototype,"nearestNeighbor",void 0),(0,i._)([(0,n.MZ)({type:[Object],json:{write:!0}})],a.prototype,"outputFilterCategories",void 0),(0,i._)([(0,n.MZ)({type:[Object],json:{write:!0}})],a.prototype,"outputFilters",void 0),(0,i._)([(0,n.MZ)({type:[Object],json:{write:!0}})],a.prototype,"propagators",void 0),(0,i._)([(0,n.MZ)({type:String,json:{write:!0}})],a.prototype,"subnetworkName",void 0),(0,i._)([(0,n.MZ)({type:String,json:{write:!0}})],a.prototype,"targetTierName",void 0),(0,i._)([(0,n.MZ)({type:String,json:{write:!0}})],a.prototype,"diagramTemplateName",void 0),(0,i._)([(0,n.MZ)({type:String,json:{write:!0}})],a.prototype,"tierName",void 0),(0,i._)([(0,n.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"validateLocatability",void 0),a=(0,i._)([(0,s.$)("esri.networks.support.UNTraceConfiguration")],a);const l=a},12899:(e,t,r)=>{"use strict";r.d(t,{BD:()=>l,D2:()=>i,XZ:()=>o,fO:()=>s,v9:()=>a});var i,n=r(45802);!function(e){e[e.RTJunctionJunctionConnectivity=1]="RTJunctionJunctionConnectivity",e[e.RTAttachment=2]="RTAttachment",e[e.RTContainment=3]="RTContainment",e[e.RTJunctionEdgeConnectivity=4]="RTJunctionEdgeConnectivity",e[e.RTEdgeJunctionEdgeConnectivity=5]="RTEdgeJunctionEdgeConnectivity"}(i||(i={}));const s=new n.J({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork",subnetworkController:"subnetwork-controller",loops:"loops",isolation:"isolation"}),o=new n.J({junctionJunctionConnectivity:"junction-junction-connectivity",connectivity:"connectivity",attachment:"attachment",containment:"containment",junctionEdgeFromConnectivity:"junction-edge-from-connectivity",junctionMidspanConnectivity:"junction-midspan-connectivity",junctionEdgeToConnectivity:"junction-edge-to-connectivity"}),a={connectivity:1,"junction-junction-connectivity":1,attachment:2,containment:3,"junction-edge-from-connectivity":4,"junction-midspan-connectivity":5,"junction-edge-to-connectivity":6},l=new n.J({normal:"normal",rebuild:"rebuild",forceRebuild:"force-rebuild"})},66267:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i,n=r(35143),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842));let l=i=class extends s.oY{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new i({title:this.title,expression:this.expression})}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"title",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"expression",void 0),(0,n._)([(0,o.MZ)({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],l.prototype,"returnType",void 0),l=i=(0,n._)([(0,a.$)("esri.popup.ElementExpressionInfo")],l);const c=l},81779:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i,n=r(35143),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842));let l=i=class extends s.oY{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new i({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"name",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"title",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"expression",void 0),(0,n._)([(0,o.MZ)({type:["string","number"],json:{write:!0}})],l.prototype,"returnType",void 0),l=i=(0,n._)([(0,a.$)("esri.popup.ExpressionInfo")],l);const c=l},40585:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i,n=r(35143),s=r(45802),o=r(42553),a=r(46053),l=(r(81806),r(76460),r(47249),r(6409)),c=r(85842),u=r(17542);let h=i=class extends o.oY{constructor(e){super(e),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new i({fieldName:this.fieldName,format:this.format?.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],h.prototype,"fieldName",void 0),(0,n._)([(0,a.MZ)({type:u.A,json:{write:!0}})],h.prototype,"format",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],h.prototype,"isEditable",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],h.prototype,"label",void 0),(0,n._)([(0,l.e)(new s.J({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],h.prototype,"stringFieldOption",void 0),(0,n._)([(0,a.MZ)({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],h.prototype,"statisticType",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],h.prototype,"tooltip",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],h.prototype,"visible",void 0),h=i=(0,n._)([(0,c.$)("esri.popup.FieldInfo")],h);const d=h},75900:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(56362);let l=i=class extends a.A{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new i({description:this.description,displayType:this.displayType,title:this.title})}};(0,n._)([(0,s.MZ)({type:String,json:{write:!0}})],l.prototype,"description",void 0),(0,n._)([(0,s.MZ)({type:["auto","preview","list"],json:{write:!0}})],l.prototype,"displayType",void 0),(0,n._)([(0,s.MZ)({type:String,json:{write:!0}})],l.prototype,"title",void 0),(0,n._)([(0,s.MZ)({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],l.prototype,"type",void 0),l=i=(0,n._)([(0,o.$)("esri.popup.content.AttachmentsContent")],l);const c=l},8034:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(82052),l=r(48746);let c=i=class extends a.A{constructor(e){super(e),this.type="bar-chart"}clone(){return new i({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};(0,n._)([(0,s.MZ)({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:l.U.write}})],c.prototype,"type",void 0),c=i=(0,n._)([(0,o.$)("esri.popup.content.BarChartMediaInfo")],c);const u=c},12061:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(82052),l=r(48746);let c=i=class extends a.A{constructor(e){super(e),this.type="column-chart"}clone(){return new i({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};(0,n._)([(0,s.MZ)({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:l.U.write}})],c.prototype,"type",void 0),c=i=(0,n._)([(0,o.$)("esri.popup.content.ColumnChartMediaInfo")],c);const u=c},56362:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var i=r(35143),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842));let a=class extends n.oY{constructor(e){super(e),this.type=null}};(0,i._)([(0,s.MZ)({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,i._)([(0,o.$)("esri.popup.content.Content")],a);const l=a},87015:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(53084),o=r(46053),a=(r(81806),r(76460),r(85842)),l=r(56362);let c=i=class extends l.A{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new i({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?(0,s.o8)(this.outFields):null})}};(0,n._)([(0,o.MZ)()],c.prototype,"creator",void 0),(0,n._)([(0,o.MZ)()],c.prototype,"destroyer",void 0),(0,n._)([(0,o.MZ)()],c.prototype,"outFields",void 0),(0,n._)([(0,o.MZ)({type:["custom"],readOnly:!0})],c.prototype,"type",void 0),c=i=(0,n._)([(0,a.$)("esri.popup.content.CustomContent")],c);const u=c},81940:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(66267),l=r(56362);let c=i=class extends l.A{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){return new i({expressionInfo:this.expressionInfo?.clone()})}};(0,n._)([(0,s.MZ)({type:a.A,json:{write:!0}})],c.prototype,"expressionInfo",void 0),(0,n._)([(0,s.MZ)({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],c.prototype,"type",void 0),c=i=(0,n._)([(0,o.$)("esri.popup.content.ExpressionContent")],c);const u=c},6929:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i,n=r(35143),s=r(53084),o=r(46053),a=(r(81806),r(76460),r(85842)),l=r(17707),c=r(40585),u=r(56362);let h=i=class extends u.A{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map((e=>e.toJSON()))}clone(){return new i((0,s.o8)({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};(0,n._)([(0,o.MZ)({type:Object,json:{write:!0}})],h.prototype,"attributes",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],h.prototype,"description",void 0),(0,n._)([(0,o.MZ)({type:[c.A]})],h.prototype,"fieldInfos",void 0),(0,n._)([(0,l.K)("fieldInfos")],h.prototype,"writeFieldInfos",null),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],h.prototype,"title",void 0),(0,n._)([(0,o.MZ)({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],h.prototype,"type",void 0),h=i=(0,n._)([(0,a.$)("esri.popup.content.FieldsContent")],h);const d=h},52022:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(41210),l=r(42553);let c=i=class extends l.oY{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new i({linkURL:this.linkURL,sourceURL:this.sourceURL})}};(0,n._)([(0,s.MZ)({type:String,json:{write:!0}})],c.prototype,"linkURL",void 0),(0,n._)([(0,s.MZ)({type:String,json:{write:!0}})],c.prototype,"sourceURL",void 0),c=i=(0,n._)([(0,o.$)("esri.popup.content.support.ImageMediaInfoValue")],c);const u=c;var h;let d=h=class extends a.A{constructor(e){super(e),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){return new h({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?.clone()})}};(0,n._)([(0,s.MZ)({type:Number,json:{write:!0}})],d.prototype,"refreshInterval",void 0),(0,n._)([(0,s.MZ)({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],d.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:u,json:{write:!0}})],d.prototype,"value",void 0),d=h=(0,n._)([(0,o.$)("esri.popup.content.ImageMediaInfo")],d);const p=d},36381:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(82052),l=r(48746);let c=i=class extends a.A{constructor(e){super(e),this.type="line-chart"}clone(){return new i({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};(0,n._)([(0,s.MZ)({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:l.U.write}})],c.prototype,"type",void 0),c=i=(0,n._)([(0,o.$)("esri.popup.content.LineChartMediaInfo")],c);const u=c},7198:(e,t,r)=>{"use strict";r.d(t,{A:()=>_});var i,n=r(35143),s=r(53084),o=r(46053),a=(r(81806),r(76460),r(28379)),l=r(85842),c=r(17707),u=r(8034),h=r(12061),d=r(56362),p=r(52022),f=r(36381),m=r(79181),g=r(11662);let y=i=class extends d.A{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map((e=>"image"===e.type?p.A.fromJSON(e):"barchart"===e.type?u.A.fromJSON(e):"columnchart"===e.type?h.A.fromJSON(e):"linechart"===e.type?f.A.fromJSON(e):"piechart"===e.type?m.A.fromJSON(e):void 0)).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map((e=>e.toJSON()))}clone(){return new i((0,s.o8)({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};(0,n._)([(0,o.MZ)()],y.prototype,"activeMediaInfoIndex",void 0),(0,n._)([(0,o.MZ)({type:Object,json:{write:!0}})],y.prototype,"attributes",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],y.prototype,"description",void 0),(0,n._)([(0,o.MZ)({types:[g.g]})],y.prototype,"mediaInfos",void 0),(0,n._)([(0,a.w)("mediaInfos")],y.prototype,"readMediaInfos",null),(0,n._)([(0,c.K)("mediaInfos")],y.prototype,"writeMediaInfos",null),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],y.prototype,"title",void 0),(0,n._)([(0,o.MZ)({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],y.prototype,"type",void 0),y=i=(0,n._)([(0,l.$)("esri.popup.content.MediaContent")],y);const _=y},79181:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(82052),l=r(48746);let c=i=class extends a.A{constructor(e){super(e),this.type="pie-chart"}clone(){return new i({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};(0,n._)([(0,s.MZ)({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:l.U.write}})],c.prototype,"type",void 0),c=i=(0,n._)([(0,o.$)("esri.popup.content.PieChartMediaInfo")],c);const u=c},93616:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var i=r(35143),n=r(69098),s=r(46053),o=r(40565),a=(r(47249),r(81806),r(85842)),l=r(56362),c=r(64362);let u=class extends((0,n.O)(l.A)){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],u.prototype,"description",void 0),(0,i._)([(0,s.MZ)({type:Number,json:{type:o.jz,write:!0}})],u.prototype,"displayCount",void 0),(0,i._)([(0,s.MZ)({type:["list"],json:{write:!0}})],u.prototype,"displayType",void 0),(0,i._)([(0,s.MZ)({type:[c.A],json:{write:!0}})],u.prototype,"orderByFields",void 0),(0,i._)([(0,s.MZ)({type:Number,json:{type:o.jz,write:!0}})],u.prototype,"relationshipId",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],u.prototype,"title",void 0),(0,i._)([(0,s.MZ)({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],u.prototype,"type",void 0),u=(0,i._)([(0,a.$)("esri.popup.content.RelationshipContent")],u);const h=u},53539:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(56362);let l=i=class extends a.A{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new i({text:this.text})}};(0,n._)([(0,s.MZ)({type:String,json:{write:!0}})],l.prototype,"text",void 0),(0,n._)([(0,s.MZ)({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],l.prototype,"type",void 0),l=i=(0,n._)([(0,o.$)("esri.popup.content.TextContent")],l);const c=l},82052:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(41210),l=r(69539),c=r(42553),u=r(53084),h=r(40565),d=r(22431);let p=i=class extends c.oY{constructor(e){super(e),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new i({colors:(0,u.o8)(this.colors),fields:(0,u.o8)(this.fields),normalizeField:this.normalizeField,series:(0,u.o8)(this.series),tooltipField:this.tooltipField})}};(0,n._)([(0,s.MZ)({type:[l.A],json:{type:[[h.jz]],write:!0}})],p.prototype,"colors",void 0),(0,n._)([(0,s.MZ)({type:[String],json:{write:!0}})],p.prototype,"fields",void 0),(0,n._)([(0,s.MZ)({type:String,json:{write:!0}})],p.prototype,"normalizeField",void 0),(0,n._)([(0,s.MZ)({type:[d.A],json:{read:!1}})],p.prototype,"series",void 0),(0,n._)([(0,s.MZ)({type:String,json:{write:!0}})],p.prototype,"tooltipField",void 0),p=i=(0,n._)([(0,o.$)("esri.popup.content.support.ChartMediaInfoValue")],p);const f=p;let m=class extends a.A{constructor(e){super(e),this.type=null,this.value=void 0}};(0,n._)([(0,s.MZ)({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],m.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:f,json:{write:!0}})],m.prototype,"value",void 0),m=(0,n._)([(0,o.$)("esri.popup.content.mixins.ChartMediaInfo")],m);const g=m},41210:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var i=r(35143),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842));let a=class extends n.oY{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],a.prototype,"altText",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],a.prototype,"caption",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],a.prototype,"title",void 0),(0,i._)([(0,s.MZ)({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,i._)([(0,o.$)("esri.popup.content.mixins.MediaInfo")],a);const l=a},22431:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i,n=r(35143),s=r(91967),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842));let l=i=class extends s.A{constructor(e){super(e),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new i({color:this.color?.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};(0,n._)([(0,o.MZ)()],l.prototype,"color",void 0),(0,n._)([(0,o.MZ)()],l.prototype,"fieldName",void 0),(0,n._)([(0,o.MZ)()],l.prototype,"tooltip",void 0),(0,n._)([(0,o.MZ)()],l.prototype,"value",void 0),l=i=(0,n._)([(0,a.$)("esri.popup.content.support.ChartMediaInfoValueSeries")],l);const c=l},48746:(e,t,r)=>{"use strict";r.d(t,{U:()=>i});const i=(0,r(45802).O)()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"})},11662:(e,t,r)=>{"use strict";r.d(t,{g:()=>l});var i=r(8034),n=r(12061),s=r(52022),o=r(36381),a=r(79181);const l={base:r(41210).A,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":i.A,"column-chart":n.A,"line-chart":o.A,"pie-chart":a.A,image:s.A}}},17542:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i=r(35143),n=r(69098),s=r(42553),o=r(46053),a=r(40565),l=(r(47249),r(81806),r(6409)),c=r(85842),u=r(65256);let h=class extends((0,n.O)(s.oY)){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};(0,i._)([(0,l.e)(u._v)],h.prototype,"dateFormat",void 0),(0,i._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],h.prototype,"digitSeparator",void 0),(0,i._)([(0,o.MZ)({type:a.jz,json:{write:!0}})],h.prototype,"places",void 0),h=(0,i._)([(0,c.$)("esri.popup.support.FieldInfoFormat")],h);const d=h},64362:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i,n=r(35143),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842));let l=i=class extends s.oY{constructor(e){super(e),this.field=null,this.order=null}clone(){return new i({field:this.field,order:this.order})}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"field",void 0),(0,n._)([(0,o.MZ)({type:["asc","desc"],json:{write:!0}})],l.prototype,"order",void 0),l=i=(0,n._)([(0,a.$)("esri.popup.support.RelatedRecordsInfoFieldOrder")],l);const c=l},65308:(e,t,r)=>{"use strict";r.d(t,{A:()=>P});var i=r(35143),n=r(86560),s=r(55171),o=r(3825),a=r(50076),l=r(42553),c=r(49304),u=r(30726),h=r(50346),d=r(46053),p=r(40565),f=(r(47249),r(81806),r(28379)),m=r(85842),g=r(76797),y=r(38042);let _;var v=r(20650),b=r(36351),w=r(91967);r(76460);let x=class extends w.A{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};(0,i._)([(0,d.MZ)()],x.prototype,"nextQueryParams",void 0),(0,i._)([(0,d.MZ)()],x.prototype,"queryParams",void 0),(0,i._)([(0,d.MZ)()],x.prototype,"results",void 0),(0,i._)([(0,d.MZ)()],x.prototype,"total",void 0),x=(0,i._)([(0,m.$)("esri.portal.PortalQueryResult")],x);const S=x;var T,M=r(38665),A=r(90924);let C;const E={PortalGroup:()=>Promise.resolve({default:v.A}),PortalItem:()=>Promise.resolve().then(r.bind(r,70652)),PortalUser:()=>Promise.resolve({default:M.A})};let R=T=class extends((0,l.Te)(c.A)){constructor(e){super(e),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=n.A.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return"string"==typeof e?{url:e}:e}destroy(){O.unregister(this),this.defaultBasemap=(0,u.pR)(this.defaultBasemap),this.defaultDevBasemap=(0,u.pR)(this.defaultDevBasemap),this.defaultVectorBasemap=(0,u.pR)(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=(0,u.xt)(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)n.A.request.trustedServers.includes(t)||n.A.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=this.user?.orgId,t=!e||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e?e.toLowerCase():e}readUser(e){let t=null;return e&&(t=M.A.fromJSON(e),t.portal=this),t}load(e){const t=Promise.resolve().then(r.bind(r,194)).then((t=>{let{default:r}=t;(0,h.Te)(e),C=r})).then((()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,e))).then((e=>{if(s.id){const e=s.id;this.credential=e.findCredential(this.restUrl),this.credential||this.authMode!==T.AUTH_MODE_AUTO&&this.authMode!==T.AUTH_MODE_NO_PROMPT||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=e.on("credential-create",function(e){const t=s.id;return()=>{const r=e.deref();r&&t.findCredential(r.restUrl)&&r.signIn().catch((()=>{}))}}(new WeakRef(this))),O.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await r.e(3875).then(r.bind(r,23875))).default;return e?e.map((e=>new t({id:e.id,url:e.url}))):[]}async fetchBasemaps(e,t){const r=await this._fetchBasemaps(e,t);if(!0===t?.include3d&&!1!==this.use3dBasemaps){const i=await this._fetchBasemaps3D(e,t);r.unshift(...i)}return r}fetchCategorySchema(e){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",e).then((e=>e.categorySchema)):(0,h.G4)(e)?Promise.reject((0,h.NK)()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,r=new b.A({num:100,sortField:"title"});if(t?.length){const i=[];for(const e of t)i.push(`(title:"${e.title}" AND owner:${e.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,e).then((e=>e.results))}return(0,h.G4)(e)?Promise.reject((0,h.NK)()):Promise.resolve([])}fetchRegions(e){const t=this.user?.culture||this.culture||(0,y.JK)();return this.request(this.restUrl+"/portals/regions",{...e,query:{culture:t}})}fetchSettings(e){const t=this.user?.culture||this.culture||(0,y.JK)();return this.request(this.restUrl+"/portals/self/settings",{...e,query:{culture:t}})}static getDefault(){return function(e){return _&&!_.destroyed||(_=e()),_}((()=>new T))}queryGroups(e,t){return this.queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this.queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this.queryPortal("/community/users",e,"PortalUser",t)}fetchSelf(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.authMode,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;const i=this.restUrl+"/portals/self",n={authMode:e,query:{culture:(0,y.JK)().toLowerCase()},withCredentials:!0,...r};return"auto"===n.authMode&&(n.authMode="no-prompt"),t&&(n.query.default=!0),this.request(i,n)}queryPortal(e,t,r,i){const n=(0,p.dp)(b.A,t),s=t=>this.request(this.restUrl+e,{...n.toRequestOptions(this),...i}).then((e=>{const r=n.clone();return r.start=e.nextStart,new S({nextQueryParams:r,queryParams:n,total:e.total,results:T._resultsToTypedArray(t,{portal:this},e,i)})})).then((e=>Promise.all(e.results.map((t=>"function"==typeof t.when?t.when():e))).then((()=>e),(t=>((0,h.QP)(t),e)))));return r&&E[r]?E[r]().then((e=>{let{default:t}=e;return(0,h.Te)(i),s(t)})):s()}signIn(){if(this.authMode===T.AUTH_MODE_ANONYMOUS||this.authMode===T.AUTH_MODE_NO_PROMPT&&!s.id)return Promise.reject(new a.A("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if("failed"===this.loadStatus)return Promise.reject(this.loadError);const e=e=>Promise.resolve().then((()=>"not-loaded"===this.loadStatus?(e||(this.authMode="immediate"),this.load().then((()=>null))):"loading"===this.loadStatus?this.load().then((()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate")))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate")))).then((e=>{e&&(this.sourceJSON=e,this.read(e))}));return s.id?s.id.getCredential(this.restUrl,{prompt:this.authMode!==T.AUTH_MODE_NO_PROMPT}).then((t=>e(t))):e(this.credential)}normalizeUrl(e){const t=this.credential?.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}requestToTypedArray(e,t,r){return this.request(e,t).then((e=>{const t=T._resultsToTypedArray(r,{portal:this},e);return Promise.all(t.map((t=>"function"==typeof t.when?t.when():e))).then((()=>t),(()=>t))}))}request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={f:"json",...t.query},{authMode:i=(this.authMode===T.AUTH_MODE_ANONYMOUS||this.authMode===T.AUTH_MODE_NO_PROMPT?this.authMode:"auto"),body:n=null,cacheBust:s=!1,method:a="auto",responseType:l="json",signal:c}=t,u={authMode:i,body:n,cacheBust:s,method:a,query:r,responseType:l,timeout:0,signal:c};return t.withCredentials&&(u.withCredentials=!0),(0,o.A)(this._normalizeSSL(e),u).then((e=>e.data))}toJSON(){throw new a.A("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new T({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new a.A("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}async _fetchBasemaps(e,t){const r=new b.A;r.query=e||(n.A.apiKey&&(0,A.Q)(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const i=await this.queryGroups(r,t);if(!i.total)return[];const s=i.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc";const o=await s.queryItems(r,t);return o.total?o.results.filter((e=>"Web Map"===e.type)).map((e=>new C({portalItem:e}))):[]}async _fetchBasemaps3D(e,t){const r=e||this.basemapGalleryGroupQuery3D;if(!r)return[];const i=new b.A({query:r,disableExtraQuery:!0}),n=await this.queryGroups(i,t);if(!n.total)return[];const s=n.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc";const o=await s.queryItems(i,t);return o.total?o.results.filter((e=>"Web Scene"===e.type)).map((e=>new C({portalItem:e}))):[]}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(e){if(e){const t=C.fromJSON(e);return t.portalItem={portal:this},t}return null}static _resultsToTypedArray(e,t,r,i){let n;if(r){const s=null!=i?i.signal:null;n=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(e||t)&&(n=n.map((r=>{const i=Object.assign(e?e.fromJSON(r):r,t);return"function"==typeof i.load&&i.load(s),i})))}else n=[];return n}};R.AUTH_MODE_ANONYMOUS="anonymous",R.AUTH_MODE_AUTO="auto",R.AUTH_MODE_IMMEDIATE="immediate",R.AUTH_MODE_NO_PROMPT="no-prompt",(0,i._)([(0,d.MZ)()],R.prototype,"access",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"allSSL",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"authMode",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"authorizedCrossOriginDomains",void 0),(0,i._)([(0,f.w)("authorizedCrossOriginDomains")],R.prototype,"readAuthorizedCrossOriginDomains",null),(0,i._)([(0,d.MZ)()],R.prototype,"basemapGalleryGroupQuery",void 0),(0,i._)([(0,d.MZ)({json:{name:"3DBasemapGalleryGroupQuery"}})],R.prototype,"basemapGalleryGroupQuery3D",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"bingKey",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"canListApps",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"canListData",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"canListPreProvisionedItems",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"canProvisionDirectPurchase",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"canSearchPublic",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"canShareBingPublic",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"canSharePublic",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"canSignInArcGIS",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"canSignInIDP",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"colorSetsGroupQuery",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"commentsEnabled",void 0),(0,i._)([(0,d.MZ)({type:Date})],R.prototype,"created",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"credential",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"culture",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"currentVersion",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"customBaseUrl",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"defaultBasemap",void 0),(0,i._)([(0,f.w)("defaultBasemap")],R.prototype,"readDefaultBasemap",null),(0,i._)([(0,d.MZ)()],R.prototype,"defaultDevBasemap",void 0),(0,i._)([(0,f.w)("defaultDevBasemap")],R.prototype,"readDefaultDevBasemap",null),(0,i._)([(0,d.MZ)({type:g.A})],R.prototype,"defaultExtent",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"defaultVectorBasemap",void 0),(0,i._)([(0,f.w)("defaultVectorBasemap")],R.prototype,"readDefaultVectorBasemap",null),(0,i._)([(0,d.MZ)()],R.prototype,"description",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"devBasemapGalleryGroupQuery",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"eueiEnabled",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],R.prototype,"extraQuery",null),(0,i._)([(0,d.MZ)()],R.prototype,"featuredGroups",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"featuredItemsGroupQuery",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"galleryTemplatesGroupQuery",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"layoutGroupQuery",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"livingAtlasGroupQuery",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"hasCategorySchema",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"helpBase",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"helperServices",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"helpMap",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"homePageFeaturedContent",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"homePageFeaturedContentCount",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"httpPort",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"httpsPort",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"id",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"ipCntryCode",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],R.prototype,"isOrganization",null),(0,i._)([(0,d.MZ)()],R.prototype,"isPortal",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"isReadOnly",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],R.prototype,"itemPageUrl",null),(0,i._)([(0,d.MZ)()],R.prototype,"layerTemplatesGroupQuery",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"maxTokenExpirationMinutes",void 0),(0,i._)([(0,d.MZ)({type:Date})],R.prototype,"modified",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"name",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"portalHostname",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"portalMode",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"portalProperties",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"region",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"recycleBinEnabled",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],R.prototype,"restUrl",null),(0,i._)([(0,d.MZ)()],R.prototype,"rotatorPanels",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"showHomePageDescription",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"sourceJSON",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"staticImagesUrl",void 0),(0,i._)([(0,d.MZ)({json:{name:"2DStylesGroupQuery"}})],R.prototype,"stylesGroupQuery2d",void 0),(0,i._)([(0,d.MZ)({json:{name:"stylesGroupQuery"}})],R.prototype,"stylesGroupQuery3d",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"supportsHostedServices",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"symbolSetsGroupQuery",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"templatesGroupQuery",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"thumbnail",void 0),(0,i._)([(0,d.MZ)({readOnly:!0})],R.prototype,"thumbnailUrl",null),(0,i._)([(0,d.MZ)()],R.prototype,"units",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"url",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"urlKey",void 0),(0,i._)([(0,f.w)("urlKey")],R.prototype,"readUrlKey",null),(0,i._)([(0,d.MZ)()],R.prototype,"user",void 0),(0,i._)([(0,f.w)("user")],R.prototype,"readUser",null),(0,i._)([(0,d.MZ)()],R.prototype,"use3dBasemaps",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"useStandardizedQuery",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"useVectorBasemaps",void 0),(0,i._)([(0,d.MZ)()],R.prototype,"vectorBasemapGalleryGroupQuery",void 0),R=T=(0,i._)([(0,m.$)("esri.portal.Portal")],R);const P=R,O=new FinalizationRegistry((e=>{e.remove()}))},20650:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i,n=r(35143),s=r(50076),o=r(42553),a=r(46053),l=r(40565),c=(r(47249),r(81806),r(85842)),u=r(36351);let h=i=class extends o.oY{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t&&this.portal?this.portal?.normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.portal?.restUrl;return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal.request(this.url+"/categorySchema",e).then((t=>{const r=t.categorySchema||[];return r.some((e=>"contentCategorySetsGroupQuery.LivingAtlas"===e.source))?this._fetchCategorySchemaSet("LivingAtlas",e):r}))}fetchMembers(e){return this.portal.request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new s.A("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new i({sourceJSON:e});return t.read(e),t}queryItems(e,t){let r=(0,l.dp)(u.A,e);const i=this.portal;return parseFloat(i.currentVersion)>5?(r=r||new u.A,i.queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",t)):(r=r?r.clone():new u.A,r.query="group:"+this.id+(r.query?" "+r.query:""),i.queryItems(r,t))}_fetchCategorySchemaSet(e,t){const r=this.portal;return r.fetchSelf(r.authMode,!0,t).then((e=>{const i=e.contentCategorySetsGroupQuery;if(i){const e=new u.A({disableExtraQuery:!0,num:1,query:i});return r.queryGroups(e,t)}throw new s.A("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")})).then((r=>{if(r.total){const i=r.results[0],n=new u.A({num:1,query:`typekeywords:"${e}"`});return i.queryItems(n,t)}throw new s.A("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")})).then((e=>e.total?e.results[0].fetchData("json",t).then((e=>{const t=e?.categorySchema;return t?.length?t:[]})):[]))}};(0,n._)([(0,a.MZ)()],h.prototype,"access",void 0),(0,n._)([(0,a.MZ)({type:Date})],h.prototype,"created",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"description",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"id",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"isInvitationOnly",void 0),(0,n._)([(0,a.MZ)({type:Date})],h.prototype,"modified",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"owner",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"portal",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"snippet",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"sortField",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"sortOrder",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"sourceJSON",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"tags",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"thumbnail",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],h.prototype,"thumbnailUrl",null),(0,n._)([(0,a.MZ)()],h.prototype,"title",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],h.prototype,"url",null),h=i=(0,n._)([(0,c.$)("esri.portal.PortalGroup")],h);const d=h},70652:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>R});var i=r(35143),n=r(28899),s=r(50076),o=r(42553),a=r(53084),l=r(49304),c=r(90534),u=r(46053),h=r(40565),d=r(28379),p=r(85842),f=r(76797),m=r(65308),g=r(91967),y=r(76460),_=r(21403);r(47249),r(81806);let v=class extends g.A{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e?.portalItem&&e.path?{...e,path:b(e.path,e.portalItem)}:e}set path(e){null!=e&&(0,c.oP)(e)?y.A.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return b(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"json",t=arguments.length>1?arguments[1]:void 0;const r=this.cdnUrl;if(null==r)throw new s.A("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:t?.signal})}async update(e,t){const{addOrUpdateResources:i}=await r.e(3106).then(r.bind(r,33106));return await i(this.portalItem,[{resource:this,content:e,compress:t?.compress,access:t?.access}],"update",t),this}hasPath(){return null!=this.path}};function b(e,t){return null==e?e:(e=e.replace(/^\/+/,""),null!=t&&(0,c.oP)(e)&&(e=(0,c.V1)(e,t.itemUrl)),e?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}(0,i._)([(0,u.MZ)()],v.prototype,"portalItem",void 0),(0,i._)([(0,u.MZ)({type:String,value:null})],v.prototype,"path",null),(0,i._)([(0,_.w)("path")],v.prototype,"_castPath",null),(0,i._)([(0,u.MZ)({type:String,readOnly:!0})],v.prototype,"url",null),(0,i._)([(0,u.MZ)({type:String,readOnly:!0})],v.prototype,"cdnUrl",null),(0,i._)([(0,u.MZ)({type:String,readOnly:!0})],v.prototype,"itemRelativeUrl",null),v=(0,i._)([(0,p.$)("esri.portal.PortalItemResource")],v);const w=v;let x=class extends g.A{constructor(e){super(e),this.created=null,this.rating=null}};(0,i._)([(0,u.MZ)()],x.prototype,"created",void 0),(0,i._)([(0,u.MZ)()],x.prototype,"rating",void 0),x=(0,i._)([(0,p.$)("esri.portal.PortalRating")],x);const S=x;var T,M=r(79453);const A=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),C=new Set(["KML","GeoJson","CSV"]);let E=T=class extends((0,o.Te)(l.A)){static from(e){return(0,h.PZ)(T,e)}constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let r=e;return"Feature Service"===e||"Feature Collection"===e?r=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":"Image Service"===e?r=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===e?r="Scene Layer":"Video Service"===e?r="Video Layer":"Scene Package"===e?r="Scene Layer Package":"Stream Service"===e?r="Feature Layer":"Geoprocessing Service"===e?r=t.includes("Web Tool")?"Tool":"Geoprocessing Service":"Geoenrichment Service"===e?r="GeoEnrichment Service":"Geocoding Service"===e?r="Locator":"Microsoft Powerpoint"===e?r="Microsoft PowerPoint":"GeoJson"===e?r="GeoJSON":"Globe Service"===e?r="Globe Layer":"Vector Tile Service"===e?r="Tile Layer":"netCDF"===e?r="NetCDF":"Map Service"===e?r=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e?.toLowerCase().includes("add in")?r=e.replaceAll(/(add in)/gi,"Add-In"):"datastore catalog service"===e?r="Big Data File Share":"Compact Tile Package"===e?r="Tile Package (tpkx)":"Raster function template"===e?r="Raster Function Template":"OGCFeatureServer"===e?r="OGC Feature Layer":"web mapping application"===e&&t.includes("configurableApp")?r="Instant App":"Insights Page"===e?r="Insights Report":"Excalibur Imagery Project"===e?r="Excalibur Project":"3DTiles Service"===e?r="3D tiles layer":"3DTiles Package"===e&&(r="3D tiles package"),r}readExtent(e){return e&&e.length?new f.A(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type?.toLowerCase()||"",t=this.typeKeywords||[];let r,i=!1,s=!1,o=!1,a=!1,l=!1,c=!1,u=!1,h=!1;return e.indexOf("service")>0||"feature collection"===e||"kml"===e||"wms"===e||"wmts"===e||"wfs"===e?(i=t.includes("Hosted Service"),"feature service"===e||"feature collection"===e||"kml"===e||"wfs"===e?(s=t.includes("Table"),o=t.includes("Route Layer"),a=t.includes("Markup"),l=t.includes("Spatiotemporal"),c=t.includes("UtilityNetwork"),r=l&&s?"spatiotemporaltable":s?"table":o?"routelayer":a?"markup":l?"spatiotemporal":c?"utilitynetwork":i?"featureshosted":"features"):"map service"===e||"wms"===e||"wmts"===e?(l=t.includes("Spatiotemporal"),u=t.includes("Relational"),r=l||u?"mapimages":i||t.includes("Tiled")||"wmts"===e?"maptiles":"mapimages"):r="scene service"===e?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":"image service"===e?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===e?"streamlayer":"vector tile service"===e?"vectortile":"datastore catalog service"===e?"datastorecollection":"geocoding service"===e?"geocodeservice":"video service"===e?t.includes("Live Stream")?"livestreamvideolayer":"videolayer":"geoprocessing service"===e?t.includes("Web Tool")?"tool":"layers":"geodata service"===e?"geodataservice":"3dtiles service"===e?t.includes("3DObject")?"3dobjecttileslayer":t.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):"web map"===e||"cityengine web scene"===e?r="maps":"web scene"===e?r=t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===e&&t.includes("configurableApp")?r="instantapps":"web mapping application"===e||"mobile application"===e||"application"===e||"operation view"===e||"desktop application"===e?r="apps":"map document"===e||"map package"===e||"published map"===e||"scene document"===e||"globe document"===e||"basemap package"===e||"mobile basemap package"===e||"mobile map package"===e||"project package"===e||"project template"===e||"pro map"===e||"layout"===e||"layer"===e&&t.includes("ArcGIS Pro")||"explorer map"===e&&t.indexOf("Explorer Document")?r="mapsgray":"service definition"===e||"shapefile"===e||"cad drawing"===e||"geojson"===e||"netcdf"===e||"administrative report"===e?r="datafiles":"360 vr experience"===e?r="360vr":"explorer add in"===e||"desktop add in"===e||"windows viewer add in"===e||"windows viewer configuration"===e?r="appsgray":"arcgis pro add in"===e||"arcgis pro configuration"===e?r="addindesktop":"pdf"===e?r="pdf":"microsoft word"===e?r="word":"microsoft excel"===e?r="excel":"microsoft powerpoint"===e?r="ppt":"rule package"===e||"file geodatabase"===e||"sqlite geodatabase"===e||"csv collection"===e||"kml collection"===e||"windows mobile package"===e||"map template"===e||"desktop application template"===e||"gml"===e||"arcpad package"===e||"code sample"===e||"document link"===e||"earth configuration"===e||"operations dashboard add in"===e||"rules package"===e||"workflow manager package"===e||"explorer map"===e&&t.includes("Explorer Mapping Application")||t.includes("Document")?r="datafilesgray":"network analysis service"===e||"geoprocessing service"===e||"geodata service"===e||"geometry service"===e||"geoprocessing package"===e||"locator package"===e||"geoprocessing sample"===e||"workflow manager service"===e?r="toolsgray":"layer"===e||"layer package"===e||"explorer layer"===e?r="layersgray":"analysis model"===e?r="analysismodel":"scene package"===e?r="scenepackage":"3dtiles package"===e?r="3dtileslayerpackage":"3dtiles service"===e?r="3dtileslayer":"mobile scene package"===e?r="mobilescenepackage":"tile package"===e||"compact tile package"===e?r="tilepackage":"task file"===e?r="taskfile":"report template"===e?r="report-template":"statistical data collection"===e?r="statisticaldatacollection":"insights workbook"===e?r="workbook":"insights model"===e?r="insightsmodel":"insights page"===e?r="insightspage":"insights theme"===e?r="insightstheme":"hub initiative"===e?r="hubinitiative":"hub page"===e?r="hubpage":"hub site application"===e?r="hubsite":"hub event"===e?r="hubevent":"hub project"===e?r="hubproject":"relational database connection"===e?r="relationaldatabaseconnection":"big data file share"===e?r="datastorecollection":"image collection"===e?r="imagecollection":"desktop style"===e?r="desktopstyle":"style"===e?r=t.includes("Dictionary")?"dictionarystyle":"style":"dashboard"===e?r="dashboard":"raster function template"===e?r="rasterprocessingtemplate":"vector tile package"===e?r="vectortilepackage":"ortho mapping project"===e?r="orthomappingproject":"ortho mapping template"===e?r="orthomappingtemplate":"solution"===e?r="solutions":"geopackage"===e?r="geopackage":"deep learning package"===e?r="deeplearningpackage":"real time analytic"===e?r="realtimeanalytics":"big data analytic"===e?r="bigdataanalytics":"feed"===e?r="feed":"excalibur imagery project"===e?r="excaliburimageryproject":"notebook"===e?r="notebook":"storymap"===e?r="storymap":"survey123 add in"===e?r="survey123addin":"mission"===e?r="mission":"mission report"===e?r="missionreport":"mission template"===e?r="missiontemplate":"quickcapture project"===e?r="quickcaptureproject":"pro report"===e?r="proreport":"pro report template"===e?r="proreporttemplate":"urban model"===e?r="urbanmodel":"web experience"===e?r="experiencebuilder":"web experience template"===e?r="webexperiencetemplate":"experience builder widget"===e?r="experiencebuilderwidget":"experience builder widget package"===e?r="experiencebuilderwidgetpackage":"workflow"===e?r="workflow":"kernel gateway connection"===e?r="kernelgatewayconnection":"insights script"===e?r="insightsscript":"hub initiative template"===e?r="hubinitiativetemplate":"storymap theme"===e?r="storymaptheme":"knowledge graph"===e?r="knowledgegraph":"knowledge graph layer"===e?r="knowledgegraphlayer":"knowledge studio project"===e?r="knowledgestudio":"native application"===e?r="nativeapp":"native application installer"===e?r="nativeappinstaller":"web link chart"===e?r="linkchart":"knowledge graph web investigation"===e?r="investigation":"ogcfeatureserver"===e?r="features":"pro project"===e?r="proproject":"insights workbook package"===e?r="insightsworkbookpackage":"apache parquet"===e?r="apacheparquet":"notebook code snippet library"===e?r="notebookcodesnippets":"suitability model"===e?r="suitabilitymodel":"esri classifier definition"===e?r="classifierdefinition":"esri classification schema"===e?r="classificationschema":"insights data engineering workbook"===e?r="dataengineeringworkbook":"insights data engineering model"===e?r="dataengineeringmodel":"deep learning studio project"===e?r="deeplearningproject":"discussion"===e?r="discussion":"allsource project"===e?r="allsourceproject":"api key"===e?r="apikey":"data pipeline"===e?r="datapipelines":"group layer"===e?(h=t.includes("Map"),r=h?"layergroup2d":"layergroup"):r="media layer"===e?"onlinemedialayer":"form"===e?t.includes("Survey123")?"survey":"datafilesgray":"csv"===e?"csv":"image"===e?"image":"maps",r?(0,n.s)("esri/images/portal/"+r+"16.png"):null}get isLayer(){return null!=this.type&&A.has(this.type)}get itemCdnUrl(){return(0,M.a)(this.itemUrl)}get itemPageUrl(){const e=this.portal?.itemPageUrl;return e&&this.id?`${e}?id=${this.id}`:null}get itemUrl(){const e=this.portal?.restUrl;return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal?.normalizeUrl(`${e}/info/${t}?f=json`)??null:null}get userItemUrl(){const e=this.portal?.restUrl;if(!e)return null;const t=this.owner||this.portal?.user?.username;return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){const t=this.portal??(this.portal=m.A.getDefault()),r=t.load(e).then((()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?t.request(this.itemUrl,{signal:null!=e?e.signal:null,query:{token:this.apiKey}}):{})).then((e=>{this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(e){const t={method:"post",query:{}};return e instanceof S&&(e=e.rating),null==e||isNaN(e)||"number"!=typeof e||(t.query.rating=e),this.portal?(await this.portal.request(this.itemUrl+"/addRating",t),new S({rating:e,created:new Date})):null}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:(0,a.o8)(this.applicationProxies),avgRating:this.avgRating,categories:(0,a.o8)(this.categories),created:(0,a.o8)(this.created),culture:this.culture,description:this.description,extent:(0,a.o8)(this.extent),groupCategories:(0,a.o8)(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:(0,a.o8)(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:(0,a.o8)(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:(0,a.o8)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,a.o8)(this.typeKeywords),url:this.url};this.loaded&&(e.loadStatus="loaded");const t=new T({sourceJSON:this.sourceJSON}).set(e);return t._set("isOrgItem",this.isOrgItem),t}createPostQuery(){const e=this.toJSON();for(const r of["tags","typeKeywords","categories"])e[r]=e[r]?.join(", ");const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"json",t=arguments.length>1?arguments[1]:void 0;return this.portal.request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}async fetchRating(e){const t=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e});return null!=t.rating?(t.created=new Date(t.created),new S(t)):null}fetchRelatedItems(e,t){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},T)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then((e=>(this.sourceJSON=e,this.read(e),this)))}update(e){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const t=e?.data,r={method:"post"};r.query=this.createPostQuery();for(const e in r.query)null===r.query[e]&&(r.query[e]="");return r.query.clearEmptyFields=!0,null!=t&&("string"==typeof t?r.query.text=t:"object"==typeof t&&(r.query.text=JSON.stringify(t))),this.portal.request(`${this.userItemUrl}/update`,r).then((()=>this.reload()))})):Promise.reject(new s.A("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(e){if(!this.id)throw new s.A("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:t,itemUrl:r}=this;await t.signIn();const{copyResources:i,folder:n,tags:o,title:a}=e||{},l={method:"post",query:{copyPrivateResources:"all"===i,folder:"string"==typeof n?n:n?.id,includeResources:!!i,tags:o?.join(","),title:a}},{itemId:c}=await t.request(`${r}/copy`,l);return new T({id:c,portal:t})}updateThumbnail(e){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const t=e.thumbnail,r=e.filename,i={method:"post"};if("string"==typeof t)(0,c.DB)(t)?i.query={data:t}:i.query={url:(0,c.s2)(t)},null!=r&&(i.query.filename=r);else{const e=new FormData;null!=r?e.append("file",t,r):e.append("file",t),i.body=e}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then((()=>this.reload()))})):Promise.reject(new s.A("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;const{fetchResources:i}=await r.e(3106).then(r.bind(r,33106));return i(this,e,t)}async addResource(e,t,i){const{addOrUpdateResources:n}=await r.e(3106).then(r.bind(r,33106));return e.portalItem=this,await n(this,[{resource:e,content:t,compress:i?.compress,access:i?.access}],"add",i),e}async removeResource(e,t){const{removeResource:i}=await r.e(3106).then(r.bind(r,33106));if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new s.A("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,e,t)}async removeAllResources(e){const{removeAllResources:t}=await r.e(3106).then(r.bind(r,33106));return t(this,e)}resourceFromPath(e){return new w({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:(0,a.o8)(this.categories),created:this.created?.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:(0,a.o8)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,a.o8)(this.typeKeywords),url:this.url};return(0,a.oy)(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new T({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)"tags"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"typeKeywords"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"extent"===t&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};(0,i._)([(0,u.MZ)({type:["private","shared","org","public"]})],E.prototype,"access",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"accessInformation",void 0),(0,i._)([(0,u.MZ)({type:String})],E.prototype,"apiKey",void 0),(0,i._)([(0,u.MZ)({json:{read:{source:"appProxies"}}})],E.prototype,"applicationProxies",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"avgRating",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"categories",void 0),(0,i._)([(0,u.MZ)({type:Date})],E.prototype,"created",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"culture",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"description",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],E.prototype,"displayName",null),(0,i._)([(0,u.MZ)({type:f.A})],E.prototype,"extent",void 0),(0,i._)([(0,d.w)("extent")],E.prototype,"readExtent",null),(0,i._)([(0,u.MZ)()],E.prototype,"groupCategories",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],E.prototype,"iconUrl",null),(0,i._)([(0,u.MZ)()],E.prototype,"id",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],E.prototype,"isLayer",null),(0,i._)([(0,u.MZ)({type:Boolean,readOnly:!0})],E.prototype,"isOrgItem",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"itemControl",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],E.prototype,"itemPageUrl",null),(0,i._)([(0,u.MZ)({readOnly:!0})],E.prototype,"itemUrl",null),(0,i._)([(0,u.MZ)()],E.prototype,"licenseInfo",void 0),(0,i._)([(0,u.MZ)({type:Date})],E.prototype,"modified",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"name",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"numComments",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"numRatings",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"numViews",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"owner",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"ownerFolder",void 0),(0,i._)([(0,u.MZ)({type:m.A})],E.prototype,"portal",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"screenshots",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"size",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"snippet",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"sourceJSON",void 0),(0,i._)([(0,u.MZ)({type:String})],E.prototype,"sourceUrl",void 0),(0,i._)([(0,u.MZ)({type:String})],E.prototype,"spatialReference",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"tags",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"thumbnail",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],E.prototype,"thumbnailUrl",null),(0,i._)([(0,u.MZ)()],E.prototype,"title",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"type",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"typeKeywords",void 0),(0,i._)([(0,u.MZ)({type:String,json:{read(e,t){if(C.has(t.type)){const t=this.portal?.restUrl;e||=t&&this.id?`${t}/content/items/${this.id}/data`:null}return e}}})],E.prototype,"url",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],E.prototype,"userItemUrl",null),E=T=(0,i._)([(0,p.$)("esri.portal.PortalItem")],E);const R=E},36351:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var i,n=r(35143),s=r(91967),o=r(45802),a=r(53084),l=r(46053),c=(r(81806),r(76460),r(85842)),u=r(76797),h=r(13312),d=r(45417);const p=new o.J({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let f=i=class extends s.A{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){"asc"!==e&&"desc"!==e||this._set("sortOrder",e)}clone(){return new i({categories:this.categories?(0,a.o8)(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let r=[];this.categories&&(r=this.categories.map((e=>Array.isArray(e)?JSON.stringify(e):e)));let i="";if(this.extent){const e=(0,d.Cv)(this.extent,h.A.WGS84);null!=e&&(i=`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`)}let n=this.query;!this.disableExtraQuery&&e.extraQuery&&(n="("+n+")"+e.extraQuery);const s={categories:r,bbox:i,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map((e=>p.toJSON(e.trim()))).join(","),s.sortOrder=this.sortOrder),{query:{...t,...s}}}};(0,n._)([(0,l.MZ)()],f.prototype,"categories",void 0),(0,n._)([(0,l.MZ)()],f.prototype,"disableExtraQuery",void 0),(0,n._)([(0,l.MZ)({type:u.A})],f.prototype,"extent",void 0),(0,n._)([(0,l.MZ)()],f.prototype,"filter",void 0),(0,n._)([(0,l.MZ)()],f.prototype,"num",void 0),(0,n._)([(0,l.MZ)()],f.prototype,"query",void 0),(0,n._)([(0,l.MZ)()],f.prototype,"sortField",void 0),(0,n._)([(0,l.MZ)()],f.prototype,"sortOrder",null),(0,n._)([(0,l.MZ)()],f.prototype,"start",void 0),f=i=(0,n._)([(0,c.$)("esri.portal.PortalQueryParams")],f);const m=f},38665:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var i=r(35143),n=r(50076),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842));let l=class extends s.oY{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new n.A("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};(0,i._)([(0,o.MZ)({type:Date})],l.prototype,"created",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"id",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"portal",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"title",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],l.prototype,"url",null),(0,i._)([(0,o.MZ)()],l.prototype,"username",void 0),l=(0,i._)([(0,a.$)("esri.portal.PortalFolder")],l);const c=l;var u,h=r(20650);let d=u=class extends s.oY{constructor(e){super(e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal.normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.portal?.restUrl;return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,r=e?.data,i=e?.folder,n={method:"post"};t&&(n.query=t.createPostQuery(),null!=r&&("string"==typeof r?n.query.text=r:"object"==typeof r&&(n.query.text=JSON.stringify(r))));let s=this.userContentUrl;return i&&(s+="/"+("string"==typeof i?i:i.id)),this.portal.request(s+"/addItem",n).then((e=>(t.id=e.id,t.portal=this.portal,t.loaded?t.reload():t.load())))}async deleteItem(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.userContentUrl;e.ownerFolder&&(r+="/"+e.ownerFolder);const i=t?{permanentDelete:!0}:{};await this.portal.request(r+`/items/${e.id}/delete`,{method:"post",query:i}),e.id=null,e.portal=null}async deleteItems(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=e.concat();const r=this.userContentUrl+"/deleteItems",i=[],s=e.map((e=>e.id));if(s.length){const o={method:"post",query:{items:s.join(","),permanentDelete:t}},a=await this.portal.request(r,o);for(const t of a.results){const r=e.find((e=>t.itemId===e.id)),s=t.success;let o=null;s?(r.id=null,r.portal=null):t.error&&(o=new n.A("portal:delete-item-failed",t.error.message,t.error)),i.push({item:r,success:s,error:o})}}return i}fetchFolders(){return this.portal.request(this.userContentUrl??"",{query:{num:1}}).then((e=>{let t;return t=e&&e.folders?e.folders.map((e=>{const t=c.fromJSON(e);return t.portal=this.portal,t})):[],t}))}fetchGroups(){return this.portal.request(this.url??"").then((e=>{let t;return t=e&&e.groups?e.groups.map((e=>{const t=h.A.fromJSON(e);return t.portal=this.portal,t})):[],t}))}async fetchItems(e){e??={};let t=this.userContentUrl??"";e.folder&&(t+="/"+e.folder.id);const{default:i}=await Promise.resolve().then(r.bind(r,70652)),n={folders:!1,inRecycleBin:!!e.inRecycleBin||null,foldersContent:!(e.folder||!e.includeSubfolderItems)||null,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"},s=await this.portal.request(t,{query:n});let o;return s?.items?(o=s.items.map((e=>{const t=i.fromJSON(e);return t.portal=this.portal,t})),await Promise.all(o.map((e=>e.load()))),{items:o,nextStart:s.nextStart,total:s.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then((e=>e.tags))}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new h.A({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new n.A("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(e,t){const r=this.userContentUrl,i=t?{folderID:"string"==typeof t?t:t.id}:null;await this.portal.request(r+`/items/${e.id}/restore`,{method:"post",query:i})}toJSON(){throw new n.A("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new u({sourceJSON:e});return t.read(e),t}};(0,i._)([(0,o.MZ)()],d.prototype,"access",void 0),(0,i._)([(0,o.MZ)({type:Date})],d.prototype,"created",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"culture",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"description",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"email",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"favGroupId",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"fullName",void 0),(0,i._)([(0,o.MZ)({type:Date})],d.prototype,"modified",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"orgId",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"portal",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"preferredView",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"privileges",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"region",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"role",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"roleId",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"sourceJSON",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"thumbnail",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],d.prototype,"thumbnailUrl",null),(0,i._)([(0,o.MZ)()],d.prototype,"units",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],d.prototype,"userContentUrl",null),(0,i._)([(0,o.MZ)({readOnly:!0})],d.prototype,"url",null),(0,i._)([(0,o.MZ)()],d.prototype,"username",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"userLicenseTypeId",void 0),(0,i._)([(0,o.MZ)()],d.prototype,"userType",void 0),d=u=(0,i._)([(0,a.$)("esri.portal.PortalUser")],d);const p=d},39483:(e,t,r)=>{"use strict";r.r(t),r.d(t,{getGeometryServiceURL:()=>l,projectGeometry:()=>c});var i=r(86560),n=r(50076),s=r(65308),o=r(71334),a=r(70414);async function l(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1?arguments[1]:void 0;if(i.A.geometryServiceUrl)return i.A.geometryServiceUrl;if(!t)throw new n.A("internal:geometry-service-url-not-configured");e="portal"in t?t.portal||s.A.getDefault():t,await e.load({signal:r});const o=e.helperServices?.geometry?.url;if(!o)throw new n.A("internal:geometry-service-url-not-configured");return o}async function c(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3?arguments[3]:void 0;const s=await l(r,i),c=new a.A({geometries:[e],outSpatialReference:t}),u=await(0,o.C)(s,c,{signal:i});if(u&&Array.isArray(u)&&1===u.length)return u[0];throw new n.A("internal:geometry-service-projection-failed")}},79942:(e,t,r)=>{"use strict";r.d(t,{m:()=>o,v:()=>s});var i=r(90534),n=r(65308);function s(e,t){return{...a(e,t),readResourcePaths:[]}}function o(e,t,r){const n=(0,i.An)(e.itemUrl);return{...a(e,t),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:n?{rootPath:n.path,writtenUrls:[]}:null,resources:r?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function a(e,t){return{origin:t,url:(0,i.An)(e.itemUrl),portal:e.portal||n.A.getDefault(),portalItem:e}}},72945:(e,t,r)=>{"use strict";r.d(t,{It:()=>d,LG:()=>o,OM:()=>c,Y:()=>a,bK:()=>l,mm:()=>h,sQ:()=>u});var i=r(9624),n=r(13312),s=r(45417);function o(e,t){if(!a(e,t)){const r=e.typeKeywords;r?r.push(t):e.typeKeywords=[t]}}function a(e,t){return!!e.typeKeywords?.includes(t)}function l(e){return a(e,h.HOSTED_SERVICE)}function c(e,t){const r=e.typeKeywords;if(r){const e=r.indexOf(t);e>-1&&r.splice(e,1)}}async function u(e){const t=e.clone().normalize();let r;if(t.length>1)for(const i of t)r?i.width>r.width&&(r=i):r=i;else r=t[0];return async function(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return(0,s.ci)(e);const r=n.A.WGS84;return await(0,i.initializeProjection)(t,r),(0,i.project)(e,r)}(r)}const h={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function d(e){const{portal:t,isOrgItem:r,itemControl:i}=e,n=t.user?.privileges;let s=!n||n.includes("features:user:edit"),o=!!r&&!!n?.includes("features:user:fullEdit");const a="update"===i||"admin"===i;return a?o=s=!0:o&&(s=!0),{features:{edit:s,fullEdit:o},content:{updateItem:a}}}},47437:(e,t,r)=>{"use strict";r.d(t,{$E:()=>o,py:()=>s,qG:()=>a});const i=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,n={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function s(e){const t=e?.match(i);if(!t)return null;const[,r,s,o]=t;if(!r)return null;let a=null,l=null,c=null;const{devext:u,qaext:h,www:d}=n;if(s)if(a=r,o)switch(o.toLowerCase()){case"devext":({customBaseUrl:l,portalHostname:c}=u);break;case"qa":({customBaseUrl:l,portalHostname:c}=h);break;default:return null}else({customBaseUrl:l,portalHostname:c}=d);else switch(r.toLowerCase()){case"devext":({customBaseUrl:l,portalHostname:c}=u);break;case"qaext":({customBaseUrl:l,portalHostname:c}=h);break;case"www":({customBaseUrl:l,portalHostname:c}=d);break;default:return null}return{customBaseUrl:l,isPortal:!1,portalHostname:c,urlKey:a}}function o(e){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(e)}function a(e){const t=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,r=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,i=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return t.test(e)?e=e.replace(t,"https://www.arcgis.com"):r.test(e)?e=e.replace(r,"https://devext.arcgis.com"):i.test(e)&&(e=e.replace(i,"https://qaext.arcgis.com")),e}},90115:(e,t,r)=>{"use strict";r.d(t,{j:()=>i});const i=(0,r(45802).O)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0})},63844:(e,t,r)=>{"use strict";r.d(t,{A:()=>E});var i,n=r(35143),s=r(95444),o=r(45802),a=r(53084),l=r(76460),c=r(46053),u=r(21403),h=r(6409),d=r(28379),p=r(85842),f=r(17707),m=r(40565),g=r(53430),y=r(71832),_=r(23860),v=r(29380),b=r(23243),w=r(71006),x=r(98976);const S="percent-of-total",T="field",M=new o.J({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:S,esriNormalizeByField:T}),A=(0,m.dp)(v.A);let C=i=class extends((0,_.h)(y.A)){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,r){if(!Array.isArray(e))return;let i=t.minValue;return e.map((e=>{const t=new v.A;return t.read(e,r),null==t.minValue&&(t.minValue=i),null==t.maxValue&&(t.maxValue=t.minValue),i=t.maxValue,t}))}writeClassBreakInfos(e,t,r,i){const n=e.map((e=>e.write({},i)));this._areClassBreaksConsecutive()&&n.forEach((e=>delete e.classMinValue)),t[r]=n}castField(e){return null==e?e:"function"==typeof e?(l.A.getLogger(this).error(".field: field must be a string value"),null):(0,m.GX)(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,r=null!=this.normalizationTotal;return t||r?(e=t&&T||r&&S||null,t&&r&&l.A.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==T&&e!==S||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,r){let i=null;i="number"==typeof e?new v.A({minValue:e,maxValue:t,symbol:(0,s.dp)(r)}):A((0,a.o8)(e)),this.classBreakInfos.push(i),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]===e&&r[1]===t){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(e,t){return this.valueExpression&&null==t?.arcade&&l.A.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let r=t;this.valueExpression&&null==t?.arcade&&(r={...r,arcade:await(0,x.lw)()});const i=this.getBreakIndex(e,r);return-1!==i?this.classBreakInfos[i]:null}getSymbol(e,t){if(this.valueExpression&&null==t?.arcade)return void l.A.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(e,t);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&null==t?.arcade){const e=await(0,x.lw)(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),r={...r,arcade:e}}const i=this.getBreakIndex(e,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach((t=>{t.symbol&&e.push(t.symbol)})),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new i({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol?.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol?.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:(0,a.o8)(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:(0,a.o8)(this.visualVariables),legendOptions:(0,a.o8)(this.legendOptions),authoringInfo:(0,a.o8)(this.authoringInfo)})}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map((r=>r.collectRequiredFields(e,t))),(0,g.Dx)(e,t,this.valueExpression)];(0,g.rq)(e,t,this.field),(0,g.rq)(e,t,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:n,arcade:s,timeZone:o}=t??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const c=s.arcadeUtils;if(!l){const e=c.createSyntaxTree(a);l=c.createFunction(e),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const u=c.executeFunction(l,c.createExecContext(e,c.getViewInfo({viewingMode:r,scale:i,spatialReference:n}),o));return this._getBreakIndexfromInfos(u)}_getBreakIndexForField(e){const t=this.field,r=e.attributes,i=this.normalizationType;let n=parseFloat(r[t]);if(i){const e=this.normalizationTotal,t=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if("log"===i)n=Math.log(n)*Math.LOG10E;else if(i!==S||null==e||isNaN(e)){if(i===T&&!isNaN(t)){if(isNaN(n)||isNaN(t))return-1;n/=t}}else n=n/e*100}return this._getBreakIndexfromInfos(n)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(null!=e&&"number"==typeof e&&!isNaN(e))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=e&&(t?e<=i[1]:e<i[1]))return r}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let r=1;r<t;r++)if(e[r-1].maxValue!==e[r].minValue)return!1;return!0}};(0,n._)([(0,c.MZ)(b.As)],C.prototype,"backgroundFillSymbol",void 0),(0,n._)([(0,c.MZ)({type:[v.A]})],C.prototype,"classBreakInfos",void 0),(0,n._)([(0,d.w)("classBreakInfos")],C.prototype,"readClassBreakInfos",null),(0,n._)([(0,f.K)("classBreakInfos")],C.prototype,"writeClassBreakInfos",null),(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],C.prototype,"defaultLabel",void 0),(0,n._)([(0,c.MZ)(b.z4)],C.prototype,"defaultSymbol",void 0),(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],C.prototype,"field",void 0),(0,n._)([(0,u.w)("field")],C.prototype,"castField",null),(0,n._)([(0,c.MZ)({type:Boolean})],C.prototype,"isMaxInclusive",void 0),(0,n._)([(0,c.MZ)({type:w.q,json:{write:!0}})],C.prototype,"legendOptions",void 0),(0,n._)([(0,c.MZ)({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],C.prototype,"minValue",null),(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],C.prototype,"normalizationField",void 0),(0,n._)([(0,c.MZ)({type:Number,cast:e=>(0,m.GB)(e),json:{write:!0}})],C.prototype,"normalizationTotal",void 0),(0,n._)([(0,c.MZ)({type:M.apiValues,value:null,json:{type:M.jsonValues,read:M.read,write:M.write}})],C.prototype,"normalizationType",null),(0,n._)([(0,h.e)({classBreaks:"class-breaks"})],C.prototype,"type",void 0),(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],C.prototype,"valueExpression",void 0),(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],C.prototype,"valueExpressionTitle",void 0),C=i=(0,n._)([(0,p.$)("esri.renderers.ClassBreaksRenderer")],C);const E=C},14873:(e,t,r)=>{"use strict";r.d(t,{A:()=>R});var i=r(35143),n=r(53084),s=r(46053),o=(r(81806),r(76460)),a=r(85842),l=r(17707),c=r(53430),u=r(71832),h=r(23860),d=r(69539),p=r(3825),f=r(50076),m=r(53521),g=r(50346),y=r(19898),_=r(1900),v=r(98976),b=r(89465),w=r(48988),x=r(97763);const S="esri.renderers.support.DictionaryLoader",T={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class M{constructor(e,t,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new m.q(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=t,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,t){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(t));try{r=await this._dictionaryPromise}catch(u){if((0,g.zf)(u))return this._dictionaryPromise=null,null}const i=this._dictionaryVersion?.since(4,0),n={};if(this.fieldMap)for(const d of this._symbolFields){const t=(0,x.MO)(this.fieldMap[d],this._fieldIndex);if(t){const r=e.attributes[t];n[d]=i?r:null!=r?""+e.attributes[t]:""}else n[d]=""}let s=null;try{s=r?.(n,t)}catch(h){return null}if(!s||"string"!=typeof s||"invalid"===s)return null;const o=s.split(";"),a=[],l=[];for(const p of o)if(p)if(p.includes("po:")){const e=p.substr(3).split("|");if(3===e.length){const t=e[0],r=e[1];let i=e[2];if("DashTemplate"===r)i=i.split(" ").map((e=>Number(e)));else if("Color"===r){const e=new d.A(i).toRgba();i=[e[0],e[1],e[2],255*e[3]]}else i=Number(i);l.push({primitiveName:t,propertyName:r,value:i,defaultValue:null})}}else if(p.includes("|")){for(const e of p.split("|"))if(this._itemNames.has(e)){a.push(e);break}}else this._itemNames.has(p)&&a.push(p);const c=null==e.geometry||!e.geometry.hasZ&&"point"===e.geometry.type;return this._cimPartsToCIMSymbol(e,a,l,c,t)}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void o.A.getLogger(S).error("no valid URL!");const t=(0,p.A)(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:null!=e?e.signal:null}),[{data:r}]=await Promise.all([t,(0,v.lw)()]);if(!r)throw this._dictionaryPromise=null,new f.A("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:i,dictionary_version:n,expression:s,itemsNames:a}=r,l=s;let c=!1;n&&(this._dictionaryVersion=y.R.parse(n),c=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=i.symbol;const u={};if(this.config){const e=this.config;for(const t in e)u[t]=e[t]}if(i.configuration)for(const o of i.configuration)u.hasOwnProperty(o.name)||(u[o.name]=o.value);const h=[];if(e?.fields&&this.fieldMap)for(const o in this.fieldMap){const t=this.fieldMap[o],r=e.fields.filter((e=>e.name.toLowerCase()===t?.toLowerCase()));r.length>0&&h.push({...r[0],type:c?r[0].type:"esriFieldTypeString"})}h.length>0&&(this._fieldIndex=new _.A(h));const d=(0,v.xR)(l,null!=e?e.spatialReference:null,h,u).then((e=>{const t={scale:0};return(r,i)=>{if(null==e)return null;const n=e.repurposeFeature({geometry:null,attributes:r});return t.scale=null!=i?i.scale??void 0:void 0,e.evaluate({$feature:n,$view:t},e.services)}})).catch((e=>(o.A.getLogger(S).error("Creating dictionary expression failed:",e),null)));return this._dictionaryPromise=d,d}async _cimPartsToCIMSymbol(e,t,r,i,s){const o=new Array(t.length);for(let n=0;n<t.length;n++)o[n]=this._getSymbolPart(t[n],s);let a=await Promise.all(o);const l=this.fieldMap;if(l){a=(0,n.o8)(a);for(const t of a)w.$.applyDictionaryTextOverrides(t,e,l,this._fieldIndex,(0,x.bs)(t))}return new b.A({data:A(a,r,i)})}async _getSymbolPart(e,t){const r=this._symbolCache.get(e);if(r)return r;if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const i=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),n=(0,p.A)(i,{responseType:"json",query:{f:"json"},...t});this._ongoingRequests.set(e,n),n.finally((()=>this._ongoingRequests.delete(e)));try{const t=await n;return this._symbolCache.put(e,t.data),t.data}catch(s){throw s}}}function A(e,t,r){if(!e||0===e.length)return null;const i={...e[0]};if(e.length>1){i.symbolLayers=[];for(const t of e){const e=t;i.symbolLayers.unshift(...e.symbolLayers)}}return r&&(i.callout=T),{type:"CIMSymbolReference",symbol:i,primitiveOverrides:t}}var C;let E=C=class extends((0,h.h)(u.A)){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new M(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,r,i){i?.origin||super.writeVisualVariables(e,t,r,i)}clone(){return new C({config:(0,n.o8)(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:(0,n.o8)(this.fieldMap),url:(0,n.o8)(this.url),visualVariables:(0,n.o8)(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await(0,c.Dx)(e,t,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];t.has(i)&&e.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};(0,i._)([(0,s.MZ)({type:M})],E.prototype,"_loader",null),(0,i._)([(0,s.MZ)({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],E.prototype,"config",void 0),(0,i._)([(0,s.MZ)({type:Object,json:{write:!0}})],E.prototype,"fieldMap",void 0),(0,i._)([(0,s.MZ)({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],E.prototype,"scaleExpression",void 0),(0,i._)([(0,l.K)("scaleExpression")],E.prototype,"writeData",null),(0,i._)([(0,s.MZ)({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],E.prototype,"scaleExpressionTitle",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],E.prototype,"url",void 0),(0,i._)([(0,l.K)("visualVariables")],E.prototype,"writeVisualVariables",null),E=C=(0,i._)([(0,a.$)("esri.renderers.DictionaryRenderer")],E);const R=E},47662:(e,t,r)=>{"use strict";r.d(t,{A:()=>w});var i,n=r(35143),s=r(69539),o=r(53084),a=r(46053),l=(r(81806),r(76460),r(6409)),c=r(85842),u=r(53430),h=r(71832),d=r(23860),p=r(79364),f=r(42553);r(47249);let m=i=class extends f.oY{constructor(){super(...arguments),this.unit=null}clone(){return new i({unit:this.unit})}};(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],m.prototype,"unit",void 0),m=i=(0,n._)([(0,c.$)("esri.renderers.support.DotDensityLegendOptions")],m);const g=m;var y,_=r(86875),v=r(7246);let b=y=class extends((0,d.h)(h.A)){constructor(e){super(e),this.attributes=null,this.backgroundColor=new s.A([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new v.A,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(null==this.referenceScale)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new _.A({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new y({attributes:(0,o.o8)(this.attributes),backgroundColor:(0,o.o8)(this.backgroundColor),dotBlendingEnabled:(0,o.o8)(this.dotBlendingEnabled),dotShape:(0,o.o8)(this.dotShape),dotSize:(0,o.o8)(this.dotSize),dotValue:(0,o.o8)(this.dotValue),legendOptions:(0,o.o8)(this.legendOptions),outline:(0,o.o8)(this.outline),referenceScale:(0,o.o8)(this.referenceScale),seed:(0,o.o8)(this.seed),visualVariables:(0,o.o8)(this.visualVariables),authoringInfo:(0,o.o8)(this.authoringInfo)})}getControllerHash(){const e=this.attributes?.map((e=>e.field||e.valueExpression||""));return`${e}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes??[])r.valueExpression&&await(0,u.Dx)(e,t,r.valueExpression),r.field&&e.add(r.field)}};(0,n._)([(0,a.MZ)({type:[p.A],json:{write:!0}})],b.prototype,"attributes",void 0),(0,n._)([(0,a.MZ)({type:s.A,json:{write:!0}})],b.prototype,"backgroundColor",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],b.prototype,"dotBlendingEnabled",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!1}})],b.prototype,"dotShape",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],b.prototype,"dotSize",void 0),(0,n._)([(0,a.MZ)({type:g,json:{write:!0}})],b.prototype,"legendOptions",void 0),(0,n._)([(0,a.MZ)({type:v.A,json:{default:null,write:!0}})],b.prototype,"outline",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],b.prototype,"dotValue",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],b.prototype,"referenceScale",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],b.prototype,"seed",void 0),(0,n._)([(0,l.e)({dotDensity:"dot-density"})],b.prototype,"type",void 0),b=y=(0,n._)([(0,c.$)("esri.renderers.DotDensityRenderer")],b);const w=b},72690:(e,t,r)=>{"use strict";r.d(t,{A:()=>A});var i=r(35143),n=r(69539),s=(r(95444),r(63241)),o=r(53084),a=r(76460),l=r(52394),c=r(76931),u=r(46053),h=(r(81806),r(39314)),d=r(6409),p=r(85842),f=r(53430),m=r(71832),g=r(33285),y=r(83804),_=r(69098),v=r(42553);r(47249);let b=class extends((0,_.O)(v.oY)){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],b.prototype,"minLabel",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],b.prototype,"maxLabel",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],b.prototype,"title",void 0),b=(0,i._)([(0,p.$)("esri.renderers.support.HeatmapLegendOptions")],b);var w,x=r(4414),S=r(76940);function T(e){if(null!=e){const{maxDensity:t,minDensity:r,radius:i}=e;if(null!=t||null!=r||null!=i){const{blurRadius:t,maxPixelIntensity:r,minPixelIntensity:i,...n}=e;return n}}return e}let M=w=class extends m.A{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new y.A({ratio:0,color:new n.A("rgba(255, 140, 0, 0)")}),new y.A({ratio:.75,color:new n.A("rgba(255, 140, 0, 1)")}),new y.A({ratio:.9,color:new n.A("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return T(e)}get blurRadius(){return(0,x.PU)(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",(0,x.zp)(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(x.ex**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||"user"===(0,h.oY)(this).getDefaultOrigin()&&(this._warnedProps[e]=!0,(0,l._)((()=>{(0,s.Lx)(a.A.getLogger(this),e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})})))}read(e,t){e=T(e),super.read(e,t)}getSymbol(){return new S.A}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const r=this.field,i=this.valueExpression;r&&"string"==typeof r&&(0,f.rq)(e,t,r),i&&"string"==typeof i&&await(0,f.Dx)(e,t,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new w({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:(0,o.o8)(this.colorStops),field:this.field,legendOptions:(0,o.o8)(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,i._)([(0,u.MZ)({type:g.A,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],M.prototype,"authoringInfo",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],M.prototype,"blurRadius",null),(0,i._)([(0,u.MZ)({type:[y.A],json:{write:!0}})],M.prototype,"colorStops",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],M.prototype,"field",void 0),(0,i._)([(0,u.MZ)({type:b,json:{write:!0}})],M.prototype,"legendOptions",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{write:!0}})],M.prototype,"maxDensity",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],M.prototype,"maxPixelIntensity",null),(0,i._)([(0,u.MZ)({type:Number,json:{write:!0}})],M.prototype,"minDensity",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],M.prototype,"minPixelIntensity",null),(0,i._)([(0,u.MZ)({type:Number,cast:c.cr,json:{write:!0}})],M.prototype,"radius",void 0),(0,i._)([(0,u.MZ)({type:Number,range:{min:0},json:{default:0,write:!0}})],M.prototype,"referenceScale",void 0),(0,i._)([(0,d.e)({heatmap:"heatmap"})],M.prototype,"type",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],M.prototype,"valueExpression",void 0),(0,i._)([(0,u.MZ)({type:String})],M.prototype,"valueExpressionTitle",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],M.prototype,"_pixelIntensityToDensity",null),M=w=(0,i._)([(0,p.$)("esri.renderers.HeatmapRenderer")],M);const A=M},86946:(e,t,r)=>{"use strict";r.d(t,{A:()=>x});var i=r(35143),n=r(69539),s=(r(95444),r(18690)),o=r(69098),a=r(76931),l=r(46053),c=(r(81806),r(76460),r(6409)),u=r(85842),h=r(53430),d=r(71832),p=r(23860),f=r(79364),m=r(42553);r(47249);let g=class extends((0,o.O)(m.oY)){constructor(){super(...arguments),this.color=new n.A([0,0,0,0]),this.label=null,this.threshold=0}};(0,i._)([(0,l.MZ)({type:n.A,json:{write:!0}})],g.prototype,"color",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],g.prototype,"label",void 0),(0,i._)([(0,l.MZ)({type:Number,range:{min:0,max:1},json:{write:!0}})],g.prototype,"threshold",void 0),g=(0,i._)([(0,u.$)("esri.renderers.support.OthersCategory")],g);let y=class extends((0,o.O)(m.oY)){constructor(){super(...arguments),this.title=null}};(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],y.prototype,"title",void 0),y=(0,i._)([(0,u.$)("esri.renderers.support.PieChartLegendOptions")],y);var _=r(76940),v=r(86875),b=r(7246);let w=class extends((0,p.h)((0,o.O)(d.A))){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new n.A([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new g,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){return new _.A({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(s.Ru)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return this.getSymbols().reduce(((e,t)=>e+JSON.stringify(t)),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes)r.valueExpression&&await(0,h.Dx)(e,t,r.valueExpression),r.field&&e.add(r.field)}};(0,i._)([(0,l.MZ)({type:[f.A],json:{write:!0}})],w.prototype,"attributes",void 0),(0,i._)([(0,l.MZ)({type:v.A,json:{default:null,write:!0}})],w.prototype,"backgroundFillSymbol",void 0),(0,i._)([(0,l.MZ)({type:n.A,json:{write:!0}})],w.prototype,"defaultColor",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],w.prototype,"defaultLabel",void 0),(0,i._)([(0,l.MZ)({type:Number,range:{min:0,max:1},json:{write:!0}})],w.prototype,"holePercentage",void 0),(0,i._)([(0,l.MZ)({type:g,json:{write:!0}})],w.prototype,"othersCategory",void 0),(0,i._)([(0,l.MZ)({type:y,json:{write:!0}})],w.prototype,"legendOptions",void 0),(0,i._)([(0,l.MZ)({type:b.A,json:{default:null,write:!0}})],w.prototype,"outline",void 0),(0,i._)([(0,l.MZ)({type:Number,cast:a.cr,json:{write:!0}})],w.prototype,"size",void 0),(0,i._)([(0,c.e)({pieChart:"pie-chart"})],w.prototype,"type",void 0),w=(0,i._)([(0,u.$)("esri.renderers.PieChartRenderer")],w);const x=w},71832:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var i=r(35143),n=r(45802),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842)),l=r(33285);const c=new n.J({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let u=class extends s.oY{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};(0,i._)([(0,o.MZ)({type:l.A,json:{write:!0}})],u.prototype,"authoringInfo",void 0),(0,i._)([(0,o.MZ)({type:c.apiValues,readOnly:!0,json:{type:c.jsonValues,read:!1,write:{writer:c.write,ignoreOrigin:!0}}})],u.prototype,"type",void 0),u=(0,i._)([(0,a.$)("esri.renderers.Renderer")],u);const h=u},5766:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var i,n=r(35143),s=r(53084),o=r(46053),a=(r(81806),r(76460),r(6409)),l=r(85842),c=r(71832),u=r(23860),h=r(23243);let d=i=class extends((0,u.h)(c.A)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map((r=>r.collectRequiredFields(e,t))))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return this.getSymbols().reduce(((e,t)=>e+JSON.stringify(t)),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new i({description:this.description,label:this.label,symbol:(0,s.o8)(this.symbol),visualVariables:(0,s.o8)(this.visualVariables),authoringInfo:(0,s.o8)(this.authoringInfo)})}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],d.prototype,"description",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],d.prototype,"label",void 0),(0,n._)([(0,o.MZ)(h.Wp)],d.prototype,"symbol",void 0),(0,n._)([(0,a.e)({simple:"simple"})],d.prototype,"type",void 0),d=i=(0,n._)([(0,l.$)("esri.renderers.SimpleRenderer")],d);const p=d},35039:(e,t,r)=>{"use strict";r.d(t,{A:()=>Z});var i=r(35143),n=r(95444),s=r(50076),o=r(53084),a=r(76460),l=r(48611),c=r(68134),u=r(46053),h=r(21403),d=r(6409),p=r(28379),f=r(85842),m=r(17707),g=r(15011),y=r(40565),_=r(53430),v=r(65308),b=r(71832),w=r(23860),x=r(23243),S=r(71006),T=r(69098),M=r(42553);r(81806),r(47249);let A=class extends((0,T.O)(M.oY)){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};(0,i._)([(0,u.MZ)(x.Ug)],A.prototype,"value",void 0),(0,i._)([(0,u.MZ)(x.Ug)],A.prototype,"value2",void 0),(0,i._)([(0,u.MZ)(x.Ug)],A.prototype,"value3",void 0),A=(0,i._)([(0,f.$)("esri.renderers.support.UniqueValue")],A);const C=A;var E=r(18690);let R=class extends((0,T.O)(M.oY)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(null==e)return null;const t=typeof(e=Array.isArray(e)?e:[e])[0];return"string"===t||"number"===t?e.map((e=>new C({value:e}))):"object"===t?e[0]instanceof C?e:e.map((e=>new C(e))):null}};(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],R.prototype,"description",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],R.prototype,"label",void 0),(0,i._)([(0,u.MZ)(x.z4)],R.prototype,"symbol",void 0),(0,i._)([(0,u.MZ)({type:[C],json:{type:[[String]],read:{reader:e=>e?e.map((e=>new C({value:e[0],value2:e[1],value3:e[2]}))):null},write:{writer:(e,t)=>{const r=[];for(const i of e){const e=[i.value,i.value2,i.value3].filter(E.Ru).map((e=>e.toString()));r.push(e)}t.values=r}}}})],R.prototype,"values",void 0),(0,i._)([(0,h.w)("values")],R.prototype,"castValues",null),R=(0,i._)([(0,f.$)("esri.renderers.support.UniqueValueClass")],R);const P=R;let O=class extends((0,T.O)(M.oY)){constructor(e){super(e),this.heading=null,this.classes=null}};(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],O.prototype,"heading",void 0),(0,i._)([(0,u.MZ)({type:[P],json:{write:!0}})],O.prototype,"classes",void 0),O=(0,i._)([(0,f.$)("esri.renderers.support.UniqueValueGroup")],O);const I=O;var L,N=r(28731),D=r(98976),F=r(79453),k=r(8446),z=r(89579);const U="esri.renderers.UniqueValueRenderer",V=()=>a.A.getLogger(U),B="uvInfos-watcher",j="uvGroups-watcher",H=(0,y.dp)(N.A);let G=L=class extends((0,w.h)(b.A)){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,t){if(!e&&!t)return;if(!e||!t)return{type:"complete",oldValue:e,newValue:t};let r=!1;const i={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<t.length;n++){const s=e.find((e=>e.value===t[n].value));s?(0,g.Ui)(s,t[n])?(i.changed.push({type:"complete",oldValue:s,newValue:t[n]}),r=!0):i.unchanged.push({oldValue:s,newValue:t[n]}):(i.added.push(t[n]),r=!0)}for(let n=0;n<e.length;n++)t.find((t=>t.value===e[n].value))||(i.removed.push(e[n]),r=!0);return r?i:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(e){this._set("field",e),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(e){return null==e||"function"==typeof e?e:(0,y.GX)(e)}writeField(e,t,r,i){"string"==typeof e?t[r]=e:i?.messages?i.messages.push(new s.A("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):V().error(".field: cannot write field to JSON since it's not a string value")}set field2(e){this._set("field2",e),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(e){this._set("field3",e),this._updateUniqueValues()}set valueExpression(e){this._set("valueExpression",e),this._updateUniqueValues()}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}set fieldDelimiter(e){this._set("fieldDelimiter",e),this._updateUniqueValues()}readPortal(e,t,r){return r.portal||v.A.getDefault()}readStyleOrigin(e,t,r){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const e=(0,F.f)(t.styleUrl,r);return Object.freeze({styleUrl:e})}}writeStyleOrigin(e,t,r,i){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=(0,F.t)(e.styleUrl,i))}set uniqueValueGroups(e){this.styleOrigin?V().error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",e),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(e){this.styleOrigin?V().error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void V().error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r="object"==typeof e?H(e):new N.A({value:e,symbol:(0,n.dp)(t)}),this.uniqueValueInfos?.push(r),this._valueInfoMap[r.value]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(e){if(this.styleOrigin)return void V().error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const t=this.uniqueValueInfos;if(t)for(let r=0;r<t.length;r++){const i=t[r];if(String(i.value)===String(e)){delete this._valueInfoMap[e],t.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(e,t){let r=t;return this.valueExpression&&null==t?.arcade&&(r={...r,arcade:await(0,D.lw)()}),this._getUniqueValueInfo(e,r)}getSymbol(e,t){if(this.valueExpression&&null==t?.arcade)return void V().error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(e,t);return r?.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&null==r?.arcade){const e=await(0,D.lw)(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),r={...r,arcade:e}}const i=this._getUniqueValueInfo(e,r);return i?.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos??[])t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=this.uniqueValueInfos?.reduce(((e,t)=>e+t.getMeshHash()),"");return`${e}.${t}.${r}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const e=new L({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:(0,o.o8)(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:(0,o.o8)(this.visualVariables),legendOptions:(0,o.o8)(this.legendOptions),authoringInfo:(0,o.o8)(this.authoringInfo),backgroundFillSymbol:(0,o.o8)(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=(0,o.o8)(this.uniqueValueInfos),r=(0,o.o8)(this.uniqueValueGroups);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze((0,o.o8)(this.styleOrigin))),Object.freeze(t),Object.freeze(r)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e._set("uniqueValueGroups",r),e._isInfosSource=this._isInfosSource,e._watchUniqueValueInfosAndGroups(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map((r=>r.collectRequiredFields(e,t))),(0,_.Dx)(e,t,this.valueExpression)];(0,_.rq)(e,t,this.field),(0,_.rq)(e,t,this.field2),(0,_.rq)(e,t,this.field3),await Promise.all(r)}populateFromStyle(){return(0,k.cF)(this.styleOrigin,{portal:this.portal}).then((e=>{const t=[];return this._valueInfoMap={},e?.data&&Array.isArray(e.data.items)&&e.data.items.forEach((r=>{const i=new z.A({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==e.data.defaultItem||(this.defaultSymbol=i,this._isDefaultSymbolDerived=!0);const n=new N.A({value:r.name,symbol:i});t.push(n),this._valueInfoMap[r.name]=n})),this._set("uniqueValueInfos",Object.freeze(t)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this}))}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",",")}_updateUniqueValues(){null!=this._isInfosSource&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:e}=this;if(e)for(const t of e)this._valueInfoMap[t.value+""]=t}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(B);const{uniqueValueInfos:e}=this;if(e){const t=[];for(const r of e)t.push((0,c.wB)((()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description})),((e,t)=>{e!==t&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)}),{sync:!0}));this.addHandles(t,B)}}_watchUniqueValueGroups(){this.removeHandles(j);const{uniqueValueGroups:e}=this;if(e){const t=[];for(const r of e){t.push((0,c.wB)((()=>({classes:r.classes})),((e,t)=>{e!==t&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}));for(const e of r.classes??[])t.push((0,c.wB)((()=>({symbol:e.symbol,values:e.values,label:e.label,description:e.description})),((e,t)=>{e!==t&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}))}this.addHandles(t,j)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const e=[],{field:t,field2:r,field3:i,fieldDelimiter:n,uniqueValueGroups:s,valueExpression:o}=this;if(!t&&!o)return this._set("uniqueValueInfos",e),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!t||!r);for(const l of s)for(const t of l.classes??[]){const{symbol:s,label:o,values:l,description:c}=t;for(const t of l??[]){const{value:l,value2:u,value3:h}=t,d=[l];r&&d.push(u),i&&d.push(h);const p=a?d.join(n||""):d[0]??void 0;e.push(new N.A({symbol:s,label:o,value:p,description:c}))}}this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:t,field2:r,valueExpression:i,fieldDelimiter:n,uniqueValueInfos:s}=this;if(!t&&!i||!s.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!t||!r),a=s.map((e=>{const{symbol:t,label:r,value:i,description:s}=e,[a,l,c]=o?i?.toString()?.split(n||"")||[]:[i];return new P({symbol:t,label:r,description:s,values:[new C({value:a,value2:l,value3:c})]})})),l=[new I({classes:a})];e&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:n,arcade:s,timeZone:o}=t??{};let a=this._cache.compiledFunc;const l=s.arcadeUtils;if(!a){const e=l.createSyntaxTree(this.valueExpression);a=l.createFunction(e),this._cache.compiledFunc=a}const c=l.executeFunction(a,l.createExecContext(e,l.getViewInfo({viewingMode:r,scale:i,spatialReference:n}),o));return this._valueInfoMap[c+""]}_getUnqiueValueInfoForFields(e){const t=this.field,r=e.attributes;let i;if(this.field2){const e=this.field2,n=this.field3,s=[];t&&s.push(r[t]),e&&s.push(r[e]),n&&s.push(r[n]),i=s.join(this.fieldDelimiter||"")}else t&&(i=r[t]);return this._valueInfoMap[i+""]}static fromPortalStyle(e,t){const r=new L(t?.properties);r._set("styleOrigin",Object.freeze({styleName:e})),r._set("portal",t?.portal||v.A.getDefault());const i=r.populateFromStyle();return i.catch((t=>{V().error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",t)})),i}static fromStyleUrl(e,t){const r=new L(t?.properties);r._set("styleOrigin",Object.freeze({styleUrl:e}));const i=r.populateFromStyle();return i.catch((t=>{V().error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",t)})),i}};(0,i._)([(0,u.MZ)({readOnly:!0})],G.prototype,"_cache",null),(0,i._)([(0,d.e)({uniqueValue:"unique-value"})],G.prototype,"type",void 0),(0,i._)([(0,u.MZ)(x.As)],G.prototype,"backgroundFillSymbol",void 0),(0,i._)([(0,u.MZ)({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],G.prototype,"field",null),(0,i._)([(0,h.w)("field")],G.prototype,"castField",null),(0,i._)([(0,m.K)("field")],G.prototype,"writeField",null),(0,i._)([(0,u.MZ)({type:String,value:null,json:{write:!0}})],G.prototype,"field2",null),(0,i._)([(0,u.MZ)({type:String,value:null,json:{write:!0}})],G.prototype,"field3",null),(0,i._)([(0,u.MZ)({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],G.prototype,"orderByClassesEnabled",void 0),(0,i._)([(0,u.MZ)({type:String,value:null,json:{write:!0}})],G.prototype,"valueExpression",null),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],G.prototype,"valueExpressionTitle",void 0),(0,i._)([(0,u.MZ)({type:S.q,json:{write:!0}})],G.prototype,"legendOptions",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],G.prototype,"defaultLabel",void 0),(0,i._)([(0,u.MZ)((0,l.$N)({...x.z4},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],G.prototype,"defaultSymbol",null),(0,i._)([(0,u.MZ)({type:String,value:null,json:{write:!0}})],G.prototype,"fieldDelimiter",null),(0,i._)([(0,u.MZ)({type:v.A,readOnly:!0})],G.prototype,"portal",void 0),(0,i._)([(0,p.w)("portal",["styleName"])],G.prototype,"readPortal",null),(0,i._)([(0,u.MZ)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],G.prototype,"styleOrigin",void 0),(0,i._)([(0,p.w)("styleOrigin",["styleName","styleUrl"])],G.prototype,"readStyleOrigin",null),(0,i._)([(0,m.K)("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],G.prototype,"writeStyleOrigin",null),(0,i._)([(0,u.MZ)({type:[I],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(e,t,r)=>(t.uniqueValueGroups||function(e){const{field1:t,field2:r,field3:i,fieldDelimiter:n,uniqueValueInfos:s,valueExpression:o}=e,a=!(!t||!r);return[{classes:(s??[]).map((e=>{const{symbol:s,label:l,value:c,description:u}=e,[h,d,p]=a?c?.toString()?.split(n||"")||[]:[c],f=[];return(t||o)&&f.push(h),r&&f.push(d),i&&f.push(p),{symbol:s,label:l,values:[f],description:u}}))}]}(t)).map((e=>I.fromJSON(e,r)))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],G.prototype,"uniqueValueGroups",null),(0,i._)([(0,u.MZ)({type:[N.A],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],G.prototype,"uniqueValueInfos",null),G=L=(0,i._)([(0,f.$)(U)],G);const Z=G},23860:(e,t,r)=>{"use strict";r.d(t,{h:()=>L});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460)),a=(r(47249),r(28379)),l=r(85842),c=r(17707),u=r(53430),h=r(50008),d=r(64694),p=r(68357),f=r(42553),m=r(40565),g=r(2183);let y=i=class extends f.oY{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return(0,g.D)(t.transparency)}writeOpacity(e,t,r){t[r]=(0,g.p)(e)}clone(){return new i({label:this.label,opacity:this.opacity,value:this.value})}};(0,n._)([(0,s.MZ)({type:String,json:{write:!0}})],y.prototype,"label",void 0),(0,n._)([(0,s.MZ)({type:Number,json:{type:m.jz,write:{target:"transparency"}}})],y.prototype,"opacity",void 0),(0,n._)([(0,a.w)("opacity",["transparency"])],y.prototype,"readOpacity",null),(0,n._)([(0,c.K)("opacity")],y.prototype,"writeOpacity",null),(0,n._)([(0,s.MZ)({type:Number,json:{write:!0}})],y.prototype,"value",void 0),y=i=(0,n._)([(0,l.$)("esri.renderers.visualVariables.support.OpacityStop")],y);const _=y;var v;let b=v=class extends p.A{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new v({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};(0,n._)([(0,s.MZ)({readOnly:!0})],b.prototype,"cache",null),(0,n._)([(0,s.MZ)({type:["opacity"],json:{type:["transparencyInfo"]}})],b.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:String,json:{write:!0}})],b.prototype,"normalizationField",void 0),(0,n._)([(0,s.MZ)({type:[_],json:{write:!0}})],b.prototype,"stops",null),b=v=(0,n._)([(0,l.$)("esri.renderers.visualVariables.OpacityVariable")],b);const w=b;var x=r(89911),S=r(77638),T=r(91967),M=r(45802),A=r(62754);const C={color:d.A,size:S.A,opacity:w,rotation:x.A},E=new M.J({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),R=/^\[([^\]]+)\]$/i;let P=class extends T.A{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e&&e.filter((e=>!!e)),e?.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some((e=>!!e.target))&&e.sort(((e,t)=>{let r=null;return r=e.target===t.target?0:e.target?1:-1,r}));for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,r){const{rotationExpression:i,rotationType:n}=t,s=i?.match(R),a=s?.[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map((e=>{const t=E.read(e.type),i=C[t];i||(o.A.getLogger(this).warn(`Unknown variable type: ${t}`),r?.messages&&r.messages.push(new A.A("visual-variable:unsupported",`visualVariable of type '${t}' is not supported`,{definition:e,context:r})));const n=new i;return n.read(e,r),n}))}writeVariables(e,t){const r=[];for(const i of e){const e=i.toJSON(t);e&&r.push(e)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};(0,n._)([(0,s.MZ)()],P.prototype,"visualVariables",null),P=(0,n._)([(0,l.$)("esri.renderers.visualVariables.VisualVariableFactory")],P);const O=P,I={base:p.A,key:"type",typeMap:{opacity:w,color:d.A,rotation:x.A,size:S.A}},L=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new O}set visualVariables(e){this._vvFactory.visualVariables=e,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(e,t,r){return this._vvFactory.readVariables(e,t,r)}writeVisualVariables(e,t,r,i){t[r]=this._vvFactory.writeVariables(e,i)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const e of this.visualVariables)if(e.arcadeRequired)return!0;return!1}hasVisualVariables(e,t){return e?this.getVisualVariablesForType(e,t).length>0:this.getVisualVariablesForType("size",t).length>0||this.getVisualVariablesForType("color",t).length>0||this.getVisualVariablesForType("opacity",t).length>0||this.getVisualVariablesForType("rotation",t).length>0}getVisualVariablesForType(e,t){const r=this.visualVariables;return r?r.filter((r=>r.type===e&&("string"==typeof t?r.target===t:!1!==t||!r.target))):[]}async collectVVRequiredFields(e,t){let r=[];this.visualVariables&&(r=r.concat(this.visualVariables));for(const i of r)i&&(i.field&&(0,u.rq)(e,t,i.field),i.normalizationField&&(0,u.rq)(e,t,i.normalizationField),i.valueExpression&&(N(i.valueExpression,e,t)||await(0,u.Dx)(e,t,i.valueExpression)))}};return(0,n._)([(0,s.MZ)({types:[I],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),(0,n._)([(0,a.w)("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),(0,n._)([(0,c.K)("visualVariables")],t.prototype,"writeVisualVariables",null),t=(0,n._)([(0,l.$)("esri.renderers.mixins.VisualVariablesMixin")],t),t};function N(e,t,r){const i=(0,h.D)(e);return null!=i&&((0,u.rq)(t,r,i),!0)}},79364:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var i,n=r(35143),s=r(69539),o=r(42553),a=r(76460),l=r(46053),c=r(21403),u=(r(47249),r(81806),r(85842)),h=r(40565);let d=i=class extends o.oY{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return null==e?e:"function"==typeof e?(a.A.getLogger(this).error(".field: field must be a string value"),null):(0,h.GX)(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new i({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,n._)([(0,l.MZ)({type:s.A,json:{type:[Number],write:!0}})],d.prototype,"color",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"field",void 0),(0,n._)([(0,c.w)("field")],d.prototype,"castField",null),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"label",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"valueExpression",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"valueExpressionTitle",void 0),d=i=(0,n._)([(0,u.$)("esri.renderers.support.AttributeColorInfo")],d);const p=d},33285:(e,t,r)=>{"use strict";r.d(t,{A:()=>D});var i,n=r(35143),s=r(45802),o=r(42553),a=r(53084),l=r(46053),c=r(40565),u=r(28379),h=r(85842);r(81806),r(76460),r(47249);let d=i=class extends o.oY{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new i({minValue:this.minValue,maxValue:this.maxValue})}};var p;(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],d.prototype,"minValue",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],d.prototype,"maxValue",void 0),d=i=(0,n._)([(0,h.$)("esri.renderers.support.AuthoringInfoClassBreakInfo")],d);let f=p=class extends o.oY{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new p({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:(0,a.o8)(this.classBreakInfos)})}};(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],f.prototype,"field",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],f.prototype,"normalizationField",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],f.prototype,"label",void 0),(0,n._)([(0,l.MZ)({type:[d],json:{write:!0}})],f.prototype,"classBreakInfos",void 0),f=p=(0,n._)([(0,h.$)("esri.renderers.support.AuthoringInfoFieldInfo")],f);var m,g=r(21403);let y=m=class extends o.oY{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new m({label:this.label,value:this.value,size:this.size})}};(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],y.prototype,"label",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],y.prototype,"size",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],y.prototype,"value",void 0),y=m=(0,n._)([(0,h.$)("esri.renderers.support.AuthoringInfoSizeStop")],y);const _=y;var v;const b=new s.J({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),w=new s.J({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),x={key:e=>"number"==typeof e?"number":"string",typeMap:{number:Number,string:String},base:null},S=["high-to-low","above-and-below","centered-on","extremes"],T=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size"])],M=["seconds","minutes","hours","days","months","years"];let A=v=class extends o.oY{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return"string"==typeof e||"number"==typeof e?e:null}get normalizationField(){return"reference-size"===this.theme?this._get("normalizationField"):null}set normalizationField(e){this._set("normalizationField",e)}get referenceSizeScale(){return"reference-size"===this.theme?this._get("referenceSizeScale"):null}set referenceSizeScale(e){this._set("referenceSizeScale",e)}get referenceSizeSymbolStyle(){return"reference-size"===this.theme?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(e){this._set("referenceSizeSymbolStyle",e)}castStartTime(e){return"string"==typeof e||"number"==typeof e?e:null}get sizeStops(){return"reference-size"===this.theme?this._get("sizeStops"):null}set sizeStops(e){this._set("sizeStops",e)}get style(){return"color"===this.type?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return"color"===this.type||"size"===this.type?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new v({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,sizeStops:(0,a.o8)(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};(0,n._)([(0,l.MZ)({types:x,json:{write:!0}})],A.prototype,"endTime",void 0),(0,n._)([(0,g.w)("endTime")],A.prototype,"castEndTime",null),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],A.prototype,"field",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],A.prototype,"maxSliderValue",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],A.prototype,"minSliderValue",void 0),(0,n._)([(0,l.MZ)({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],A.prototype,"normalizationField",null),(0,n._)([(0,l.MZ)({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],A.prototype,"referenceSizeScale",null),(0,n._)([(0,l.MZ)({type:["circle","diamond","hexagon-flat","hexagon-pointy","square"],value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],A.prototype,"referenceSizeSymbolStyle",null),(0,n._)([(0,l.MZ)({types:x,json:{write:!0}})],A.prototype,"startTime",void 0),(0,n._)([(0,g.w)("startTime")],A.prototype,"castStartTime",null),(0,n._)([(0,l.MZ)({type:[_],json:{origins:{"web-scene":{write:!1}},write:!0}})],A.prototype,"sizeStops",null),(0,n._)([(0,l.MZ)({type:b.apiValues,value:null,json:{type:b.jsonValues,read:b.read,write:b.write}})],A.prototype,"style",null),(0,n._)([(0,l.MZ)({type:T,value:null,json:{type:T,origins:{"web-scene":{type:S,write:{writer:(e,t)=>{S.includes(e)&&(t.theme=e)}}}},write:!0}})],A.prototype,"theme",null),(0,n._)([(0,l.MZ)({type:w.apiValues,json:{type:w.jsonValues,read:w.read,write:w.write}})],A.prototype,"type",void 0),(0,n._)([(0,l.MZ)({type:M,json:{type:M,write:!0}})],A.prototype,"units",void 0),A=v=(0,n._)([(0,h.$)("esri.renderers.support.AuthoringInfoVisualVariable")],A);const C=A;var E,R=r(22471);const P=new s.J({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),O=new s.J({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),I=new s.J({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),L=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"];let N=E=class extends o.oY{constructor(e){super(e),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&"relationship"!==t?"class-breaks-size"===t||"class-breaks-color"===t?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){return e?(0,R.r)(e):void 0}get fields(){return this.type&&"predominance"!==this.type?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&"relationship"!==this.type?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&"relationship"!==this.type?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return"flow"===this.type?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&"relationship"!==this.type?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&"relationship"!==e&&"class-breaks-size"!==e&&"class-breaks-color"!==e||this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;"classed-size"===e?t="class-breaks-size":"classed-color"===e&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return"univariate-color-size"===this.type?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new E({classificationMethod:this.classificationMethod,colorRamp:(0,a.o8)(this.colorRamp),fadeRatio:(0,a.o8)(this.fadeRatio),fields:this.fields?.slice(0),field1:(0,a.o8)(this.field1),field2:(0,a.o8)(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map((e=>e.clone())),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};(0,n._)([(0,l.MZ)({type:P.apiValues,value:null,json:{type:P.jsonValues,read:P.read,write:P.write,origins:{"web-document":{default:"manual",type:P.jsonValues,read:P.read,write:P.write}}}})],N.prototype,"classificationMethod",null),(0,n._)([(0,l.MZ)({types:R.g,json:{write:!0}})],N.prototype,"colorRamp",void 0),(0,n._)([(0,u.w)("colorRamp")],N.prototype,"readColorRamp",null),(0,n._)([(0,l.MZ)({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],N.prototype,"fadeRatio",void 0),(0,n._)([(0,l.MZ)({type:[String],value:null,json:{write:!0}})],N.prototype,"fields",null),(0,n._)([(0,l.MZ)({type:f,value:null,json:{write:!0}})],N.prototype,"field1",null),(0,n._)([(0,l.MZ)({type:f,value:null,json:{write:!0}})],N.prototype,"field2",null),(0,n._)([(0,l.MZ)({type:["flow-line","wave-front"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],N.prototype,"flowTheme",null),(0,n._)([(0,l.MZ)({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],N.prototype,"focus",null),(0,n._)([(0,l.MZ)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],N.prototype,"isAutoGenerated",void 0),(0,n._)([(0,l.MZ)({type:Number,value:null,json:{type:c.jz,write:!0}})],N.prototype,"numClasses",null),(0,n._)([(0,l.MZ)({type:L,json:{type:L,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],N.prototype,"lengthUnit",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],N.prototype,"maxSliderValue",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],N.prototype,"minSliderValue",void 0),(0,n._)([(0,l.MZ)({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],N.prototype,"statistics",null),(0,n._)([(0,l.MZ)({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],N.prototype,"standardDeviationInterval",null),(0,n._)([(0,l.MZ)({type:O.apiValues,value:null,json:{type:O.jsonValues,read:O.read,write:O.write,origins:{"web-scene":{type:I.jsonValues,write:{writer:I.write,overridePolicy:e=>({enabled:"flow"!==e})}}}}})],N.prototype,"type",null),(0,n._)([(0,l.MZ)({type:[C],json:{write:!0}})],N.prototype,"visualVariables",void 0),(0,n._)([(0,l.MZ)({type:["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],N.prototype,"univariateSymbolStyle",null),(0,n._)([(0,l.MZ)({type:["high-to-low","above-and-below","above","below"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],N.prototype,"univariateTheme",null),N=E=(0,n._)([(0,h.$)("esri.renderers.support.AuthoringInfo")],N);const D=N},29380:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842)),l=r(23243);let c=i=class extends s.oY{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new i({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?.clone()??null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],c.prototype,"description",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],c.prototype,"label",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],c.prototype,"minValue",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],c.prototype,"maxValue",void 0),(0,n._)([(0,o.MZ)(l.Wp)],c.prototype,"symbol",void 0),c=i=(0,n._)([(0,a.$)("esri.renderers.support.ClassBreakInfo")],c);const u=c},83804:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var i,n=r(35143),s=r(69539),o=r(42553),a=r(46053),l=r(40565),c=(r(47249),r(81806),r(85842));let u=i=class extends o.oY{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new i({color:this.color&&this.color.clone(),ratio:this.ratio})}};(0,n._)([(0,a.MZ)({type:s.A,json:{type:[l.jz],default:null,write:!0}})],u.prototype,"color",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],u.prototype,"ratio",void 0),u=i=(0,n._)([(0,c.$)("esri.renderers.support.HeatmapColorStop")],u);const h=u},71006:(e,t,r)=>{"use strict";r.d(t,{q:()=>l});var i,n=r(35143),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842));let l=i=class extends s.oY{constructor(){super(...arguments),this.title=null}clone(){return new i({title:this.title})}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"title",void 0),l=i=(0,n._)([(0,a.$)("esri.renderers.support.LegendOptions")],l)},28731:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842)),l=r(23243);let c=i=class extends s.oY{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new i({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${e}`}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],c.prototype,"description",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],c.prototype,"label",void 0),(0,n._)([(0,o.MZ)(l.Wp)],c.prototype,"symbol",void 0),(0,n._)([(0,o.MZ)(l.Ug)],c.prototype,"value",void 0),c=i=(0,n._)([(0,a.$)("esri.renderers.support.UniqueValueInfo")],c);const u=c},23243:(e,t,r)=>{"use strict";r.d(t,{As:()=>h,Ug:()=>d,Wp:()=>u,z4:()=>c});var i=r(95444),n=r(48611),s=r(7982),o=r(10609),a=r(25900),l=r(74343);const c={types:i.xK,json:{write:{writer:o.M9},origins:{"web-scene":{types:i.On,write:{writer:o.M9},read:{reader:(0,s.C)({types:i.On})}}}}},u=(0,n.$N)({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},c),h={types:{base:a.A,key:"type",typeMap:{"simple-fill":i.Es.typeMap["simple-fill"],"picture-fill":i.Es.typeMap["picture-fill"],"polygon-3d":i.Es.typeMap["polygon-3d"]}},json:{write:{writer:o.M9},origins:{"web-scene":{type:l.A,write:{writer:o.M9}}}}},d={cast:e=>null==e||"string"==typeof e||"number"==typeof e?e:`${e}`,json:{type:String,write:{writer:(e,t)=>{t.value=e?.toString()}}}}},4414:(e,t,r)=>{"use strict";r.d(t,{O3:()=>h,PU:()=>c,YW:()=>p,ex:()=>a,hv:()=>d,zp:()=>l});var i=r(15941),n=r(76931),s=r(43047),o=r(55855);const a=2.4;function l(e){return(0,n.PN)(e*a)}function c(e){return(0,n.Lz)(e)/a}function u(e,t,r,n){let{color:o,ratio:a}=t,{color:l,ratio:c}=r;if(c===a){const e=1e-6;1===c?a-=e:c+=e}const u=(0,i.qE)((n-a)/(c-a),0,1);(0,s.l)(e,o.toArray(),l.toArray(),u)}function h(e){const t=new Uint8ClampedArray(2048);if(e=e.filter((e=>{let{ratio:t}=e;return t>=0&&t<=1})).sort(((e,t)=>e.ratio-t.ratio)).map((e=>{let{color:t,ratio:r}=e;return{color:t,ratio:Math.max(r,.001)}})),e.length<1)return t;let r=e[0],i=e[0],n=1;const s=(0,o.vt)();for(let o=0;o<512;o++){const a=(o+.5)/512;for(;a>i.ratio&&n<e.length;)r=i,i=e[n++];u(s,r,i,a),t.set(s,4*o)}return t}function d(e,t,r){const i=Math.sqrt(e**2+t**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function p(e){return"function"==typeof e?e:e?t=>+t[e]:()=>1}},86616:(e,t,r)=>{"use strict";r.d(t,{L:()=>l,r:()=>o});var i=r(62754),n=r(7982),s=r(31382);function o(e,t){return l(e,null,t)}const a=(0,n.C)({types:s.H});function l(e,t,r){return e?e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type?(r?.messages&&r.messages.push(new i.A("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:r})),null):a(e,t,r):null}},3454:(e,t,r)=>{"use strict";r.d(t,{j:()=>s});var i=r(31633),n=r(14556);const s={unknown:1,inches:(0,i.oU)(1,"meters","inches"),feet:(0,i.oU)(1,"meters","feet"),"us-feet":(0,i.oU)(1,"meters","us-feet"),yards:(0,i.oU)(1,"meters","yards"),miles:(0,i.oU)(1,"meters","miles"),"nautical-miles":(0,i.oU)(1,"meters","nautical-miles"),millimeters:(0,i.oU)(1,"meters","millimeters"),centimeters:(0,i.oU)(1,"meters","centimeters"),decimeters:(0,i.oU)(1,"meters","decimeters"),meters:(0,i.oU)(1,"meters","meters"),kilometers:(0,i.oU)(1,"meters","kilometers"),"decimal-degrees":1/(0,i.vl)(1,"meters",n.$O.radius)}},50008:(e,t,r)=>{"use strict";function i(e){return e.match(n)?.[1]?.replace(/\\'/g,"'")??null}r.d(t,{D:()=>i});const n=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/},86486:(e,t,r)=>{"use strict";r.d(t,{LO:()=>a,kg:()=>l,or:()=>c,vl:()=>o});var i=r(69539),n=r(15492);function s(e,t){if(!e||e.symbol)return null;const r=t?.renderer;return e&&null!=r&&r.getObservationRenderer?r.getObservationRenderer(e):r}function o(e,t){const r=s(e,t),i=function(e,t){if(null!=e.symbol)return e.symbol;const r=s(e,t);return null!=r&&"dot-density"!==r.type?r.getSymbol(e,t):null}(e,t);if(null==i)return null;const o={renderer:r,symbol:i};if(null==r||!("visualVariables"in r)||!r.visualVariables)return o;const a=(0,n.getVisualVariableValues)(r,e,t)??[],l=["proportional","proportional","proportional"];for(const{variable:n,value:s}of a)switch(n.type){case"color":o.color=s.toRgba();break;case"size":if("outline"===n.target)o.outlineSize=s;else{const e=n.axis,t=n.useSymbolValue?"symbol-value":s;switch(e){case"width":l[0]=t;break;case"depth":l[1]=t;break;case"height":l[2]=t;break;case"width-and-depth":l[0]=l[1]=t;break;default:l[0]=l[1]=l[2]=t}}break;case"opacity":o.opacity=s;break;case"rotation":switch(n.axis){case"tilt":o.tilt=s;break;case"roll":o.roll=s;break;default:o.heading=s}}return"proportional"===l[0]&&"proportional"===l[1]&&"proportional"===l[2]||(o.size=l),o}async function a(e,t){const r=s(e,t),o=await async function(e,t){if(null!=e.symbol)return e.symbol;const r=s(e,t);return null!=r?r.getSymbolAsync(e,t):null}(e,t);if(!o)return null;const a={renderer:r,symbol:o};if(!r||!("visualVariables"in r)||!r.visualVariables)return a;const l=(0,n.getVisualVariableValues)(r,e,t)??[],c=["proportional","proportional","proportional"];for(const{variable:n,value:s}of l)if("color"===n.type)a.color=i.A.toUnitRGBA(s);else if("size"===n.type)if("outline"===n.target)a.outlineSize=s;else{const e=n.axis,t=n.useSymbolValue?"symbol-value":s;"width"===e?c[0]=t:"depth"===e?c[1]=t:"height"===e?c[2]=t:c[0]=c[1]="width-and-depth"===e?t:c[2]=t}else"opacity"===n.type?a.opacity=s:"rotation"===n.type&&"tilt"===n.axis?a.tilt=s:"rotation"===n.type&&"roll"===n.axis?a.roll=s:"rotation"===n.type&&(a.heading=s);return(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))&&(a.size=c),a}function l(e){const t=e[arguments.length>1&&void 0!==arguments[1]?arguments[1]:0];return"number"==typeof t&&isFinite(t)?t:null}function c(e){for(let t=0;t<3;t++){const r=e[t];if("number"==typeof r)return isFinite(r)?r:0}return 0}},81589:(e,t,r)=>{"use strict";r.d(t,{L:()=>o});var i=r(98773),n=r(50346),s=r(62754);async function o(e,t,r){const o=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(o&&"unique-value"===o.type&&o.styleOrigin){const a=await(0,i.Ke)(o.populateFromStyle());if((0,n.Te)(r),!1===a.ok){const r=a.error;t?.messages&&t.messages.push(new s.A("renderer:style-reference",`Failed to create unique value renderer from style reference: ${r.message}`,{error:r,context:t})),e.clear("renderer",t?.origin)}}}},31382:(e,t,r)=>{"use strict";r.d(t,{H:()=>d,X:()=>p});var i=r(76460),n=r(63844),s=r(14873),o=r(47662),a=r(72690),l=r(86946),c=r(71832),u=r(5766),h=r(35039);const d={key:"type",base:c.A,typeMap:{heatmap:a.A,simple:u.A,"unique-value":h.A,"class-breaks":n.A,"dot-density":o.A,dictionary:s.A,"pie-chart":l.A},errorContext:"renderer"},p={key:"type",base:c.A,typeMap:{simple:u.A,"unique-value":h.A,"class-breaks":n.A,heatmap:a.A},errorContext:"renderer",validate:function(e){switch(e.type){case"simple":return function(e){if(e.symbol)return e;i.A.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}(e);case"unique-value":return function(e){const t=e.uniqueValueInfos,r=t?.filter(((e,t)=>{let{symbol:r,label:n}=e;return r||i.A.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${t}] ${n}) without a symbol from web scene.`),!!r}));return r?.length!==t?.length&&(e.uniqueValueInfos=r),e}(e);case"class-breaks":return function(e){const t=e.classBreakInfos,r=t?.filter(((e,t)=>{let{symbol:r,label:n}=e;return r||i.A.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${t}] ${n}) without a symbol from web scene.`),!!r}));return r?.length!==t?.length&&(e.classBreakInfos=r),e}(e);case"heatmap":return e}}}},64694:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(68357),l=r(77718);let c=i=class extends a.A{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new i({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};(0,n._)([(0,s.MZ)({readOnly:!0})],c.prototype,"cache",null),(0,n._)([(0,s.MZ)({type:["color"],json:{type:["colorInfo"]}})],c.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:String,json:{write:!0}})],c.prototype,"normalizationField",void 0),(0,n._)([(0,s.MZ)({type:[l.A],json:{write:!0}})],c.prototype,"stops",null),c=i=(0,n._)([(0,o.$)("esri.renderers.visualVariables.ColorVariable")],c);const u=c},89911:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var i,n=r(35143),s=r(50076),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842)),l=r(17707),c=r(68357);let u=i=class extends c.A{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,r,i){if(i?.messages){const e=`visualVariables[${this.index}]`;i.messages.push(new s.A("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:e+".valueExpressionTitle",context:i}))}}clone(){return new i({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions?.clone()})}};(0,n._)([(0,o.MZ)({readOnly:!0})],u.prototype,"cache",null),(0,n._)([(0,o.MZ)({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],u.prototype,"axis",void 0),(0,n._)([(0,o.MZ)({type:["rotation"],json:{type:["rotationInfo"]}})],u.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],u.prototype,"rotationType",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],u.prototype,"valueExpressionTitle",void 0),(0,n._)([(0,l.K)("web-scene","valueExpressionTitle")],u.prototype,"writeValueExpressionTitleWebScene",null),u=i=(0,n._)([(0,a.$)("esri.renderers.visualVariables.RotationVariable")],u);const h=u},77638:(e,t,r)=>{"use strict";r.d(t,{A:()=>C});var i=r(35143),n=r(50076),s=r(45802),o=r(76460),a=r(46053),l=r(21403),c=r(28379),u=r(85842),h=r(17707),d=r(68357),p=r(76931);var f,m=r(63040),g=(r(81806),r(47249),r(84332));let y=f=class extends g.A{constructor(){super(...arguments),this.customValues=null}clone(){return new f({title:this.title,showLegend:this.showLegend,customValues:this.customValues?.slice(0)})}};(0,i._)([(0,a.MZ)({type:[Number],json:{write:!0}})],y.prototype,"customValues",void 0),y=f=(0,i._)([(0,u.$)("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],y);const _=y;var v,b=r(4815),w=r(15492);const x=new s.J({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),S=new s.J({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function T(e){if(null!=e)return"string"==typeof e||"number"==typeof e?function(e){return(0,p.cr)(e)}(e):"size"===e.type?(0,b.of)(e)?e:(delete(e={...e}).type,new A(e)):void 0}function M(e,t,r){if("object"!=typeof e)return e;const i=new A;return i.read(e,r),i}let A=v=class extends d.A{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:null!=this.valueExpression&&w.viewScaleRE.test(this.valueExpression)}}set index(e){(0,b.of)(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),(0,b.of)(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return(0,b.eh)(this)}set maxDataValue(e){e&&this.stops&&(o.A.getLogger(this).warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(o.A.getLogger(this).warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return T(e)}readMaxSize(e,t,r){return M(e,0,r)}set minDataValue(e){e&&this.stops&&(o.A.getLogger(this).warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(o.A.getLogger(this).warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return T(e)}readMinSize(e,t,r){return M(e,0,r)}get arcadeRequired(){return!!this.valueExpression||null!=this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||null!=this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(e){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)):e&&(o.A.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return(0,b.KZ)(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,r,i){if("$view.scale"===e){if(i?.messages){const e=this.index,t="string"==typeof e?e:`visualVariables[${e}]`;i.messages.push(new n.A("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:t+".valueExpression",context:i}))}}else t[r]=e}readValueUnit(e){return e?S.read(e):null}clone(){return new v({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:(0,b.of)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:(0,b.of)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map((e=>e.clone())),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone()})}flipSizes(){if(this.transformationType===b._w.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===b._w.Stops){const e=this.stops;if(!e)return this;const t=e.map((e=>e.size)).reverse(),r=e.length;for(let i=0;i<r;i++)e[i].size=t[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops?.map((e=>e.value||0))}};(0,i._)([(0,a.MZ)({readOnly:!0})],A.prototype,"cache",null),(0,i._)([(0,a.MZ)({type:x.apiValues,json:{type:x.jsonValues,origins:{"web-map":{read:!1}},read:x.read,write:x.write}})],A.prototype,"axis",void 0),(0,i._)([(0,a.MZ)()],A.prototype,"index",null),(0,i._)([(0,a.MZ)({type:String,readOnly:!0})],A.prototype,"inputValueType",null),(0,i._)([(0,a.MZ)({type:_,json:{write:!0}})],A.prototype,"legendOptions",void 0),(0,i._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],A.prototype,"maxDataValue",null),(0,i._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],A.prototype,"maxSize",null),(0,i._)([(0,l.w)("maxSize")],A.prototype,"castMaxSize",null),(0,i._)([(0,c.w)("maxSize")],A.prototype,"readMaxSize",null),(0,i._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],A.prototype,"minDataValue",null),(0,i._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],A.prototype,"minSize",null),(0,i._)([(0,l.w)("minSize")],A.prototype,"castMinSize",null),(0,i._)([(0,c.w)("minSize")],A.prototype,"readMinSize",null),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],A.prototype,"normalizationField",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],A.prototype,"arcadeRequired",null),(0,i._)([(0,a.MZ)({type:String})],A.prototype,"scaleBy",void 0),(0,i._)([(0,a.MZ)({type:[m.A],value:null,json:{write:!0}})],A.prototype,"stops",null),(0,i._)([(0,a.MZ)({type:["outline"],json:{write:!0}})],A.prototype,"target",void 0),(0,i._)([(0,a.MZ)({type:String,readOnly:!0})],A.prototype,"transformationType",null),(0,i._)([(0,a.MZ)({type:["size"],json:{type:["sizeInfo"]}})],A.prototype,"type",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],A.prototype,"useSymbolValue",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],A.prototype,"valueExpression",void 0),(0,i._)([(0,c.w)("valueExpression",["valueExpression","expression"])],A.prototype,"readValueExpression",null),(0,i._)([(0,h.K)("web-scene","valueExpression")],A.prototype,"writeValueExpressionWebScene",null),(0,i._)([(0,a.MZ)({type:["radius","diameter","area","width","distance"],json:{write:!0}})],A.prototype,"valueRepresentation",void 0),(0,i._)([(0,a.MZ)({type:S.apiValues,json:{write:S.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],A.prototype,"valueUnit",void 0),(0,i._)([(0,c.w)("valueUnit")],A.prototype,"readValueUnit",null),A=v=(0,i._)([(0,u.$)("esri.renderers.visualVariables.SizeVariable")],A);const C=A},68357:(e,t,r)=>{"use strict";r.d(t,{A:()=>f});var i=r(35143),n=r(45802),s=r(42553),o=r(76460),a=r(46053),l=r(21403),c=r(85842),u=r(40565),h=r(84332);const d=new n.J({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let p=class extends s.oY{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return null==e?e:"function"==typeof e?(o.A.getLogger(this).error(".field: field must be a string value"),null):(0,u.GX)(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};(0,i._)([(0,a.MZ)()],p.prototype,"index",void 0),(0,i._)([(0,a.MZ)({type:d.apiValues,readOnly:!0,json:{read:d.read,write:d.write}})],p.prototype,"type",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],p.prototype,"field",void 0),(0,i._)([(0,l.w)("field")],p.prototype,"castField",null),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],p.prototype,"valueExpression",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],p.prototype,"valueExpressionTitle",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],p.prototype,"arcadeRequired",null),(0,i._)([(0,a.MZ)({type:h.A,json:{write:!0}})],p.prototype,"legendOptions",void 0),p=(0,i._)([(0,c.$)("esri.renderers.visualVariables.VisualVariable")],p);const f=p},77718:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i,n=r(35143),s=r(69539),o=r(42553),a=r(46053),l=r(40565),c=(r(47249),r(81806),r(85842)),u=r(17707);let h=i=class extends o.oY{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,r){t[r]=e??0}clone(){return new i({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};(0,n._)([(0,a.MZ)({type:s.A,json:{type:[l.jz],write:!0}})],h.prototype,"color",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],h.prototype,"label",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],h.prototype,"value",void 0),(0,n._)([(0,u.K)("value")],h.prototype,"writeValue",null),h=i=(0,n._)([(0,c.$)("esri.renderers.visualVariables.support.ColorStop")],h);const d=h},63040:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(42553),o=r(76931),a=r(46053),l=(r(81806),r(76460),r(47249),r(85842));let c=i=class extends s.oY{constructor(e){super(e),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new i({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"label",void 0),(0,n._)([(0,a.MZ)({type:Number,cast:o.cr,json:{write:!0}})],c.prototype,"size",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],c.prototype,"value",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:!1}})],c.prototype,"useMinValue",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:!1}})],c.prototype,"useMaxValue",void 0),c=i=(0,n._)([(0,l.$)("esri.renderers.visualVariables.support.SizeStop")],c);const u=c},84332:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(71006);let l=i=class extends a.q{constructor(){super(...arguments),this.showLegend=null}clone(){return new i({title:this.title,showLegend:this.showLegend})}};(0,n._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],l.prototype,"showLegend",void 0),l=i=(0,n._)([(0,o.$)("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],l);const c=l},4815:(e,t,r)=>{"use strict";var i,n;function s(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function o(e){return null!=e&&!isNaN(e)&&isFinite(e)}function a(e){return e.valueExpression?i.Expression:e.field&&"string"==typeof e.field?i.Field:i.Unknown}function l(e,t){const r=t||a(e),s=e.valueUnit||"unknown";return r===i.Unknown?n.Constant:e.stops?n.Stops:null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?n.ClampedLinear:"unknown"===s?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?n.Proportional:n.Additive:n.Identity:n.RealWorldSize}r.d(t,{KZ:()=>l,Yf:()=>i,_w:()=>n,eh:()=>a,gf:()=>o,of:()=>s}),function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"}(i||(i={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(n||(n={}))},15492:(e,t,r)=>{"use strict";r.r(t),r.d(t,{getAllSizes:()=>M,getColor:()=>m,getOpacity:()=>g,getRotationAngle:()=>y,getSize:()=>_,getSizeForValue:()=>w,getSizeFromNumberOrVariable:()=>v,getSizeRangeAtScale:()=>x,getVisualVariableValues:()=>S,viewScaleRE:()=>f});var i=r(69539),n=r(39356),s=r(4212),o=r(76460),a=r(3454),l=r(4815);const c=()=>o.A.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),u=e=>c().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),h=()=>c().error("Use of arcade expressions requires an arcade context"),d=new n.A,p=Math.PI,f=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function m(e,t,r){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"color"===e.type)):e;if(!n)return;if("esri.renderers.visualVariables.ColorVariable"!==n.declaredClass)return void u("ColorVariable");const s="number"==typeof t,o=s?null:t,a=o?.attributes;let l=s?t:null;const c=n.field,{ipData:d,hasExpression:p}=n.cache;let f=n.cache.compiledFunc;if(!c&&!p){const e=n.stops;return e&&e[0]&&e[0].color}if("number"!=typeof l)if(p){if(null==r?.arcade)return void h();const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,i=t.getViewInfo(e),s=t.createExecContext(o,i,r.timeZone);if(!f){const e=t.createSyntaxTree(n.valueExpression);f=t.createFunction(e),n.cache.compiledFunc=f}l=t.executeFunction(f,s)}else a&&(l=a[c]);const m=n.normalizationField,g=null!=a&&null!=m?parseFloat(a[m]):void 0;if(null!=l&&(!m||s||!isNaN(g)&&0!==g)){isNaN(g)||s||(l/=g);const e=T(l,d);if(e){const t=e[0],s=e[1],o=t===s?n.stops[t].color:i.A.blendColors(n.stops[t].color,n.stops[s].color,e[2],null!=r?r.color:void 0);return new i.A(o)}}}function g(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"opacity"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.OpacityVariable"!==i.declaredClass)return void u("OpacityVariable");const n="number"==typeof t,s=n?null:t,o=s?.attributes;let a=n?t:null;const l=i.field,{ipData:c,hasExpression:d}=i.cache;let p=i.cache.compiledFunc;if(!l&&!d){const e=i.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof a)if(d){if(null==r?.arcade)return void h();const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,n=t.getViewInfo(e),o=t.createExecContext(s,n,r.timeZone);if(!p){const e=t.createSyntaxTree(i.valueExpression);p=t.createFunction(e),i.cache.compiledFunc=p}a=t.executeFunction(p,o)}else o&&(a=o[l]);const f=i.normalizationField,m=null!=o&&null!=f?parseFloat(o[f]):void 0;if(null!=a&&(!f||n||!isNaN(m)&&0!==m)){isNaN(m)||n||(a/=m);const e=T(a,c);if(e){const t=e[0],r=e[1];if(t===r)return i.stops[t].opacity;{const n=i.stops[t].opacity;return n+(i.stops[r].opacity-n)*e[2]}}}}function y(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"rotation"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.RotationVariable"!==i.declaredClass)return void u("RotationVariable");const n=i.axis||"heading",s="heading"===n&&"arithmetic"===i.rotationType?90:0,o="heading"===n&&"arithmetic"===i.rotationType?-1:1,a="number"==typeof t?null:t,l=a?.attributes,c=i.field,{hasExpression:d}=i.cache;let p=i.cache.compiledFunc,f=0;if(!c&&!d)return f;if(d){if(null==r?.arcade)return void h();const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,n=t.getViewInfo(e),s=t.createExecContext(a,n,r.timeZone);if(!p){const e=t.createSyntaxTree(i.valueExpression);p=t.createFunction(e),i.cache.compiledFunc=p}f=t.executeFunction(p,s)}else l&&(f=l[c]||0);return f="number"!=typeof f||isNaN(f)?null:s+o*f,f}function _(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"size"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.SizeVariable"!==i.declaredClass)return void u("SizeVariable");const n=w(function(e,t,r){const i="number"==typeof t,n=i?null:t,s=n?.attributes;let o=i?t:null;const{isScaleDriven:a}=e.cache;let c=e.cache.compiledFunc;if(a){const t=null!=r?r.scale:void 0,i=null!=r?r.view:void 0;o=null==t||"3d"===i?function(e){let t=null,r=null;const i=e.stops;return i?(t=i[0].value,r=i[i.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}(e):t}else if(!i)switch(e.inputValueType){case l.Yf.Expression:{if(null==r?.arcade)return void h();const t={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},i=r.arcade.arcadeUtils,s=i.getViewInfo(t),a=i.createExecContext(n,s,r.timeZone);if(!c){const t=i.createSyntaxTree(e.valueExpression);c=i.createFunction(t),e.cache.compiledFunc=c}o=i.executeFunction(c,a);break}case l.Yf.Field:s&&(o=s[e.field]);break;case l.Yf.Unknown:o=null}if(!(0,l.gf)(o))return null;if(i||!e.normalizationField)return o;const u=s?parseFloat(s[e.normalizationField]):null;return(0,l.gf)(u)&&0!==u?o/u:null}(i,t,r),i,t,r,i.cache.ipData);return null==n||isNaN(n)?0:n}function v(e,t,r){return null==e?null:(0,l.of)(e)?_(e,t,r):(0,l.gf)(e)?e:null}function b(e,t,r){return(0,l.gf)(r)&&e>r?r:(0,l.gf)(t)&&e<t?t:e}function w(e,t,r,i,n){switch(t.transformationType){case l._w.Additive:return function(e,t,r,i){return e+((v(t.minSize,r,i)||t.minDataValue)??0)}(e,t,r,i);case l._w.Constant:return function(e,t,r){const i=e.stops;let n=i?.length&&i[0].size;return null==n&&(n=e.minSize),v(n,t,r)}(t,r,i);case l._w.ClampedLinear:return function(e,t,r,i){const n=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),s=v(t.minSize,r,i),o=v(t.maxSize,r,i),a=null!=i?i.shape:void 0;if(e<=t.minDataValue)return s;if(e>=t.maxDataValue)return o;if(null==s||null==o)return null;if("area"===t.scaleBy&&a){const e="circle"===a,t=e?p*(s/2)**2:s*s,r=t+n*((e?p*(o/2)**2:o*o)-t);return e?2*Math.sqrt(r/p):Math.sqrt(r)}return s+n*(o-s)}(e,t,r,i);case l._w.Proportional:return function(e,t,r,i){const n=null!=i?i.shape:void 0,s=e/t.minDataValue,o=v(t.minSize,r,i),a=v(t.maxSize,r,i);let l=null;return l="circle"===n?2*Math.sqrt(s*(o/2)**2):"square"===n||"diamond"===n||"image"===n?Math.sqrt(s*o**2):s*o,b(l,o,a)}(e,t,r,i);case l._w.Stops:return function(e,t,r,i,n){const[s,o,a]=T(e,n);if(s===o)return v(t.stops?.[s].size,r,i);{const e=v(t.stops?.[s].size,r,i);return e+(v(t.stops?.[o].size,r,i)-e)*a}}(e,t,r,i,n);case l._w.RealWorldSize:return function(e,t,r,i){const n=(i?.resolution??1)*a.j[t.valueUnit],s=v(t.minSize,r,i),o=v(t.maxSize,r,i),{valueRepresentation:l}=t;let c=null;return c="area"===l?2*Math.sqrt(e/p)/n:"radius"===l||"distance"===l?2*e/n:e/n,b(c,s,o)}(e,t,r,i);case l._w.Identity:return e;case l._w.Unknown:return null}}function x(e,t,r){const{isScaleDriven:i}=e.cache;if(!(i&&"3d"===r||t))return null;const n={scale:t,view:r};let s=v(e.minSize,d,n),o=v(e.maxSize,d,n);if(null!=s||null!=o){if(s>o){const e=o;o=s,s=e}return{minSize:s,maxSize:o}}}function S(e,t,r){if(!e.visualVariables)return;const i=[],n=[],s=[],o=[],a=[];for(const l of e.visualVariables)switch(l.type){case"color":n.push(l);break;case"opacity":s.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return n.forEach((e=>{const n=m(e,t,r);i.push({variable:e,value:n})})),s.forEach((e=>{const n=g(e,t,r);i.push({variable:e,value:n})})),a.forEach((e=>{const n=y(e,t,r);i.push({variable:e,value:n})})),o.forEach((e=>{const n=_(e,t,r);i.push({variable:e,value:n})})),i.filter((e=>null!=e.value))}function T(e,t){if(!t)return;let r=0,i=t.length-1;return t.some(((t,n)=>e<t?(i=n,!0):(r=n,!1))),[r,i,(e-t[r])/(t[i]-t[r])]}function M(e,t,r){const i=["proportional","proportional","proportional"];for(const n of e){const e=n.useSymbolValue?"symbol-value":_(n,t,r);switch(n.axis){case"width":i[0]=e;break;case"depth":i[1]=e;break;case"height":i[2]=e;break;case"width-and-depth":i[0]=e,i[1]=e;break;case"all":case void 0:case null:i[0]=e,i[1]=e,i[2]=e;break;default:(0,s.Xb)(n.axis)}}return i}},3825:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var i=r(86560),n=r(55171),s=r(50076),o=r(81806),a=r(53084),l=r(50346),c=r(90534),u=r(47437),h=r(90924),d=r(76312);async function p(e,t){e instanceof URL&&(e=e.toString()),t?.query instanceof URLSearchParams&&(t.query=(0,c.zf)(t.query.toString().replaceAll("+"," ")));const s=(0,c.DB)(e),a=(0,c.w8)(e);a||s||(e=(0,c.S8)(e));const u={url:e,requestOptions:{...t}},p=e=>({data:e,getAllHeaders:b,getHeader:b,httpStatus:200,requestOptions:u.requestOptions,url:u.url}),y=(0,c.sC)(e,m.internalInterceptors);if(y){const e=await C(y,u);if(null!=e)return p(e)}let _=(0,c.sC)(e);if(_){const e=await C(_,u);if(null!=e)return p(e);_.after||_.error||(_=null)}if(e=u.url,"image"===(t=u.requestOptions).responseType&&((0,o.A)("host-webworker")||(0,o.A)("host-node")))throw S("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),u);if("head"===t.method){if(t.body)throw S("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),u);if(s||a)throw S("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),u)}if(await async function(){(0,o.A)("host-webworker")&&!f&&(f=await r.e(623).then(r.bind(r,20623)))}(),f)return f.execute(e,t);const v=new AbortController,w=(0,l.u7)(t,(()=>v.abort())),x={controller:v,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:_,params:u,redoRequest:!1,useIdentity:m.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},E=await async function(e){let t,r;await async function(e){const t=e.params.url,r=e.params.requestOptions,s=e.controller.signal,o=r.body;let a=null,c=null;if(g&&"HTMLFormElement"in globalThis&&(o instanceof FormData?a=o:o instanceof HTMLFormElement&&(a=new FormData(o))),"string"==typeof o&&(c=o),e.fetchOptions={cache:r.cacheBust?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:"head"===r.method?"HEAD":"GET",mode:"cors",priority:m.priority,redirect:"follow",signal:s},(a||c)&&(e.fetchOptions.body=a||c),"anonymous"===r.authMode&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||r.query?.token||a?.get("token")),!e.hasToken&&i.A.apiKey&&(0,h.Q)(t)&&(r.query||(r.query={}),r.query.token=i.A.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!M(t)&&!(0,l.G4)(s)){let i;"immediate"===r.authMode?(await T(),i=await n.id.getCredential(t,{signal:s}),e.credential=i):"no-prompt"===r.authMode?(await T(),i=await n.id.getCredential(t,{prompt:!1,signal:s}).catch((()=>{})),e.credential=i):n.id&&(i=n.id.findCredential(t)),i&&(e.credentialToken=i.token,e.useSSL=!!i.ssl)}}(e);try{do{[t,r]=await A(e)}while(!await R(e,t,r))}catch(p){const i=S("request:server",p,e.params,t);throw i.details.ssl=e.useSSL,e.interceptor?.error&&e.interceptor.error(i),i}const s=e.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(s)){if(!e.hasToken&&!e.credentialToken&&r.user?.username&&!(0,c.FL)(s)){const e=(0,c.$z)(s,!0);e&&m.trustedServers.push(e)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&(0,d.tz)(r.authorizedCrossOriginNoCorsDomains)}const o=e.credential;if(o&&n.id){const e=n.id.findServerInfo(o.server);let t=e?.owningSystemUrl;if(t){t=t.replace(/\/?$/,"/sharing");const e=n.id.findCredential(t,o.userId);e&&-1===n.id._getIdenticalSvcIdx(t,e)&&e.resources.unshift(t)}}return{data:r,getAllHeaders:t?()=>Array.from(t.headers):b,getHeader:t?e=>t.headers.get(e):b,httpStatus:t?.status??200,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}(x).finally((()=>w?.remove()));return _?.after?.(E),E}let f;const m=i.A.request,g="FormData"in globalThis,y=new Set([499,498,403,401]),_=new Set(["COM_0056","COM_0057","SB_0008"]),v=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],b=()=>null,w=Symbol();function x(e){const t=(0,c.$z)(e);return!t||t.endsWith(".arcgis.com")||p._corsServers.includes(t)||(0,c.FL)(t)}function S(e,t,r,i){let n="Error";const o={url:r.url,requestOptions:r.requestOptions,getAllHeaders:b,getHeader:b,ssl:!1};if(t instanceof s.A)return t.details?(t.details=(0,a.o8)(t.details),t.details.url=r.url,t.details.requestOptions=r.requestOptions):t.details=o,t;if(t){const e=i&&(()=>Array.from(i.headers)),r=i&&(e=>i.headers.get(e)),s=i?.status,a=t.message;a&&(n=a),e&&r&&(o.getAllHeaders=e,o.getHeader=r),o.httpStatus=(null!=t.httpCode?t.httpCode:t.code)||s||0,o.subCode=t.subcode,o.messageCode=t.messageCode,"string"==typeof t.details?o.messages=[t.details]:o.messages=t.details,o.raw=w in t?t[w]:t}return(0,l.zf)(t)?(0,l.NK)():new s.A(e,n,o)}async function T(){n.id||await r.e(1145).then(r.bind(r,1145))}function M(e){return v.some((t=>t.test(e)))}async function A(e){let t=e.params.url;const r=e.params.requestOptions,i=e.fetchOptions??{},s=(0,c.w8)(t)||(0,c.DB)(t),a=r.responseType||"json",h=s?0:null!=r.timeout?r.timeout:m.timeout;let y=!1;if(!s){e.useSSL&&(t=(0,c.lM)(t));let s={...r.query};e.credentialToken&&(s.token=e.credentialToken);let a=(0,c.x0)(s);(0,o.A)("esri-url-encodes-apostrophe")&&(a=a.replaceAll("'","%27"));const l=t.length+1+a.length;let h;y="delete"===r.method||"post"===r.method||"put"===r.method||!!r.body||l>m.maxUrlLength;const p=r.useProxy||!!(0,c.zs)(t);if(p){const e=(0,c.s_)(t);h=e.path,!y&&h.length+1+l>m.maxUrlLength&&(y=!0),e.query&&(s={...e.query,...s})}if("HEAD"===i.method&&(y||p)){if(y){if(l>m.maxUrlLength)throw S("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params);throw S("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params)}if(p)throw S("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(y?(i.method="delete"===r.method?"DELETE":"put"===r.method?"PUT":"POST",r.body?t=(0,c.a6)(t,s):(i.body=(0,c.x0)(s),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):t=(0,c.a6)(t,s),p&&(e.useProxy=!0,t=`${h}?${t}`),s.token&&g&&i.body instanceof FormData&&!(0,u.$E)(t)&&i.body.set("token",s.token),r.hasOwnProperty("withCredentials"))e.withCredentials=r.withCredentials;else if(!(0,c.FX)(t,(0,c.Xq)()))if((0,c.FL)(t))e.withCredentials=!0;else if(n.id){const r=n.id.findServerInfo(t);r?.webTierAuth&&(e.withCredentials=!0)}e.withCredentials&&(i.credentials="include",(0,d.xW)(t)&&await(0,d.m3)(y?(0,c.a6)(t,s):t))}let _,v,b=0,w=!1;h>0&&(b=setTimeout((()=>{w=!0,e.controller.abort()}),h));try{if("native-request-init"===r.responseType)v=i,v.url=t;else if("image"!==r.responseType||"default"!==i.cache||"GET"!==i.method||y||function(e){if(e)for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0;return!1}(r.headers)||!s&&!e.useProxy&&m.proxyUrl&&!x(t)){if(p._beforeFetch&&await p._beforeFetch(t,i),_=await fetch(t,i),p._afterFetch&&await p._afterFetch(_),e.useProxy||function(e){const t=(0,c.$z)(e);t&&!p._corsServers.includes(t)&&p._corsServers.push(t)}(t),"native"===r.responseType)v=_;else if("HEAD"!==i.method)if(_.ok){switch(a){case"array-buffer":v=await _.arrayBuffer();break;case"blob":case"image":v=await _.blob();break;default:v=await _.text()}if(b&&(clearTimeout(b),b=0),"json"===a||"xml"===a||"document"===a)if(v)switch(a){case"json":v=JSON.parse(v);break;case"xml":v=E(v,"application/xml");break;case"document":v=E(v,"text/html")}else v=null;if(v){if("array-buffer"===a||"blob"===a){const e=_.headers.get("Content-Type");if(e&&/application\/json|text\/plain/i.test(e)&&v["blob"===a?"size":"byteLength"]<=750)try{const e=await new Response(v).json();e.error&&(v=e)}catch{}}"image"===a&&v instanceof Blob&&(v=await P(URL.createObjectURL(v),e,!0))}}else{v=await _.text();try{v=JSON.parse(v)}catch{}}}else v=await P(t,e)}catch(f){if("AbortError"===f.name){if(w)throw(0,d.ql)();throw(0,l.NK)("Request canceled")}if(!(!_&&f instanceof TypeError&&m.proxyUrl)||r.body||"delete"===r.method||"head"===r.method||"post"===r.method||"put"===r.method||e.useProxy||x(t))throw f;e.redoRequest=!0,(0,c.oy)({proxyUrl:m.proxyUrl,urlPrefix:(0,c.$z)(t)??""})}finally{b&&clearTimeout(b)}return[_,v]}async function C(e,t){if(null!=e.responseData)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let i,n;try{n=await e.before(t)}catch(r){i=S("request:interceptor",r,t)}if((n instanceof Error||n instanceof s.A)&&(i=S("request:interceptor",n,t)),i)throw e.error&&e.error(i),i;return n}}function E(e,t){let r;try{r=(new DOMParser).parseFromString(e,t)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function R(e,t,r){if(e.redoRequest)return e.redoRequest=!1,!1;const i=e.params.requestOptions;if(!t||"native"===i.responseType||"native-request-init"===i.responseType)return!0;let s,o;if(r&&(r.error&&"object"==typeof r.error?s=r.error:"error"===r.status&&Array.isArray(r.messages)&&(s={...r},s[w]=r,s.details=r.messages)),!s&&!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[w]=r,s;let a,l=null;s&&(o=Number(s.code),l=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=a?.toUpperCase());const c=i.authMode;if(403===o&&(4===l||s.message?.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&("no-prompt"!==c||498===o)&&void 0!==o&&y.has(o)&&!M(e.params.url)&&(403!==o||(!a||!_.has(a))&&(null==l||2===l&&e.credentialToken))){await T();try{const t=await n.id.getCredential(e.params.url,{error:S("request:server",s,e.params),prompt:"no-prompt"!==c,signal:e.controller.signal,token:e.credentialToken});return e.credential=t,e.credentialToken=t.token,e.useSSL=e.useSSL||t.ssl,!1}catch(u){if("no-prompt"===c)return e.credential=void 0,e.credentialToken=void 0,!1;s=u}}if(s)throw s;return!0}function P(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=t.controller.signal,n=new Image;return t.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.fetchPriority=m.priority,n.src=e,(0,d.Sx)(n,e,r,i)}p._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],p._beforeFetch=void 0,p._afterFetch=void 0},71334:(e,t,r)=>{"use strict";r.d(t,{C:()=>u});var i=r(3825),n=r(40565),s=r(19902),o=r(54994),a=r(71838),l=r(70414);const c=(0,n.dp)(l.A);async function u(e,t,r){t=c(t);const n=(0,o.Dl)(e),l={...n.query,f:"json",...t.toJSON()},u=t.outSpatialReference,h=(0,s.$B)(t.geometries[0]),d=(0,o.jV)(l,r);return(0,i.A)(n.path+"/project",d).then((e=>{let{data:{geometries:t}}=e;return(0,a.V)(t,h,u)}))}},71838:(e,t,r)=>{"use strict";r.d(t,{V:()=>s,X:()=>n});var i=r(19902);function n(e){return{geometryType:(0,i.$B)(e[0]),geometries:e.map((e=>e.toJSON()))}}function s(e,t,r){const n=(0,i.xD)(t);return e.map((e=>{const t=n.fromJSON(e);return t.spatialReference=r,t}))}},64533:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var i=r(35143),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842));let a=class extends n.oY{constructor(e){super(e),this.assetGroupCode=null,this.assetTypeCode=null,this.globalId=null,this.networkSourceId=null,this.objectId=null,this.positionFrom=null,this.positionTo=null,this.terminalId=null}};(0,i._)([(0,s.MZ)({type:Number,json:{write:!0}})],a.prototype,"assetGroupCode",void 0),(0,i._)([(0,s.MZ)({type:Number,json:{write:!0}})],a.prototype,"assetTypeCode",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],a.prototype,"globalId",void 0),(0,i._)([(0,s.MZ)({type:Number,json:{write:!0}})],a.prototype,"networkSourceId",void 0),(0,i._)([(0,s.MZ)({type:Number,json:{write:!0}})],a.prototype,"objectId",void 0),(0,i._)([(0,s.MZ)({type:Number,json:{write:!0}})],a.prototype,"positionFrom",void 0),(0,i._)([(0,s.MZ)({type:Number,json:{write:!0}})],a.prototype,"positionTo",void 0),(0,i._)([(0,s.MZ)({type:Number,json:{write:!0}})],a.prototype,"terminalId",void 0),a=(0,i._)([(0,o.$)("esri.rest.networks.support.NetworkElement")],a);const l=a},57778:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var i=r(35143),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(66388),l=r(65215),c=r(23701);let u=class extends n.oY{constructor(e){super(e),this.line=null,this.multipoint=null,this.polygon=null}};(0,i._)([(0,s.MZ)({type:c.A,json:{write:!0},readOnly:!0})],u.prototype,"line",void 0),(0,i._)([(0,s.MZ)({type:a.A,json:{read:{source:"point"},write:{target:"point"}},readOnly:!0})],u.prototype,"multipoint",void 0),(0,i._)([(0,s.MZ)({type:l.A,json:{write:!0},readOnly:!0})],u.prototype,"polygon",void 0),u=(0,i._)([(0,o.$)("esri.rest.networks.support.AggregatedGeometry")],u);const h=u;let d=class extends n.oY{constructor(e){super(e),this.functionType=null,this.networkAttributeName=null,this.result=null}};(0,i._)([(0,s.MZ)({type:["add","subtract","average","count","min","max"],json:{write:!0},readOnly:!0})],d.prototype,"functionType",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0},readOnly:!0})],d.prototype,"networkAttributeName",void 0),(0,i._)([(0,s.MZ)({type:Number,json:{write:!0},readOnly:!0})],d.prototype,"result",void 0),d=(0,i._)([(0,o.$)("esri.rest.networks.support.FunctionResult")],d);const p=d;var f=r(64533);let m=class extends n.oY{constructor(e){super(e),this.aggregatedGeometry=null,this.elements=null,this.globalFunctionResults=null,this.kFeaturesForKNNFound=!1,this.startingPointsIgnored=!1,this.warnings=null}};(0,i._)([(0,s.MZ)({type:h,json:{write:!0},readOnly:!0})],m.prototype,"aggregatedGeometry",void 0),(0,i._)([(0,s.MZ)({type:[f.A],json:{write:!0},readOnly:!0})],m.prototype,"elements",void 0),(0,i._)([(0,s.MZ)({type:[p],json:{write:!0},readOnly:!0})],m.prototype,"globalFunctionResults",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0},readOnly:!0})],m.prototype,"kFeaturesForKNNFound",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0},readOnly:!0})],m.prototype,"startingPointsIgnored",void 0),(0,i._)([(0,s.MZ)({type:[String],json:{write:!0},readOnly:!0})],m.prototype,"warnings",void 0),m=(0,i._)([(0,o.$)("esri.rest.networks.support.TraceResult")],m);const g=m},11187:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var i=r(35143),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842));let a=class extends n.oY{constructor(e){super(e),this.moment=null,this.fullUpdate=!1,this.validateErrorsCreated=!1,this.dirtyAreaCount=null,this.exceededTransferLimit=null,this.serviceEdits=null,this.discoveredSubnetworks=null}};(0,i._)([(0,s.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.moment=e?e.getTime():null}}}})],a.prototype,"moment",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"fullUpdate",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"validateErrorsCreated",void 0),(0,i._)([(0,s.MZ)({type:Number,json:{write:!0}})],a.prototype,"dirtyAreaCount",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"exceededTransferLimit",void 0),(0,i._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"serviceEdits",void 0),(0,i._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"discoveredSubnetworks",void 0),a=(0,i._)([(0,o.$)("esri.rest.networks.support.ValidateNetworkTopologyResult")],a);const l=a},10290:(e,t,r)=>{"use strict";r.d(t,{u:()=>o});var i=r(31633),n=r(80963);function s(e,t,r){if(null==e.hasM||e.hasZ)for(const i of t)for(const e of i)e.length>2&&(e[2]*=r)}function o(e,t,r){if(!e&&!t||!r)return;const n=(0,i.G9)(r);a(e,r,n),a(t,r,n)}function a(e,t,r){if(e)for(const i of e)l(i.geometry,t,r)}function l(e,t,r){if(!e?.spatialReference||(0,n.aI)(e.spatialReference,t))return;const o=(0,i.G9)(e.spatialReference)/r;if(1!==o)if("x"in e)null!=e.z&&(e.z*=o);else if("rings"in e)s(e,e.rings,o);else if("paths"in e)s(e,e.paths,o);else if("points"in e&&(null==e.hasM||e.hasZ))for(const i of e.points)i.length>2&&(i[2]*=o)}},57831:(e,t,r)=>{"use strict";r.d(t,{q:()=>n});var i=r(86729);function n(e,t,r){if(!r?.features||!r.hasZ)return;const n=(0,i.N)(r.geometryType,t,e.outSpatialReference);if(null!=n)for(const i of r.features)n(i.geometry)}},6259:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var i,n=r(35143),s=r(69539),o=r(53084),a=r(46053),l=r(40565),c=r(6409),u=r(85842),h=r(56280);let d=i=class extends h.A{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new i({fromColor:(0,o.o8)(this.fromColor),toColor:(0,o.o8)(this.toColor),algorithm:this.algorithm})}};(0,n._)([(0,c.e)({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],d.prototype,"algorithm",void 0),(0,n._)([(0,a.MZ)({type:s.A,json:{type:[l.jz],write:!0}})],d.prototype,"fromColor",void 0),(0,n._)([(0,a.MZ)({type:s.A,json:{type:[l.jz],write:!0}})],d.prototype,"toColor",void 0),(0,n._)([(0,a.MZ)({type:["algorithmic"]})],d.prototype,"type",void 0),d=i=(0,n._)([(0,u.$)("esri.rest.support.AlgorithmicColorRamp")],d);const p=d},9708:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i,n=r(35143),s=r(42553),o=r(53084),a=r(46053),l=r(40565),c=r(85842),u=r(17707);let h=i=class extends s.oY{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new i((0,o.o8)({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};(0,n._)([(0,a.MZ)({type:[String],json:{write:!0}})],h.prototype,"attachmentTypes",void 0),(0,n._)([(0,a.MZ)({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],h.prototype,"attachmentsWhere",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],h.prototype,"cacheHint",void 0),(0,n._)([(0,a.MZ)({type:[String],json:{write:!0}})],h.prototype,"keywords",void 0),(0,n._)([(0,a.MZ)({type:[Number],json:{write:!0}})],h.prototype,"globalIds",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],h.prototype,"name",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{read:{source:"resultRecordCount"}}})],h.prototype,"num",void 0),(0,n._)([(0,a.MZ)({type:[Number],json:{write:!0}})],h.prototype,"objectIds",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{default:!1,write:!0}})],h.prototype,"returnMetadata",void 0),(0,n._)([(0,a.MZ)({type:[Number],json:{write:!0}})],h.prototype,"size",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{read:{source:"resultOffset"}}})],h.prototype,"start",void 0),(0,n._)([(0,u.K)("start"),(0,u.K)("num")],h.prototype,"writeStart",null),(0,n._)([(0,a.MZ)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],h.prototype,"where",void 0),h=i=(0,n._)([(0,c.$)("esri.rest.support.AttachmentQuery")],h),h.from=(0,l.dp)(h);const d=h},56280:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var i=r(35143),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842));let a=class extends n.oY{constructor(e){super(e),this.type=null}};(0,i._)([(0,s.MZ)({readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,i._)([(0,o.$)("esri.rest.support.ColorRamp")],a);const l=a},77725:(e,t,r)=>{"use strict";r.d(t,{A:()=>v});var i,n=r(35143),s=r(35238),o=r(39356),a=r(45802),l=r(42553),c=r(53084),u=r(46053),h=(r(81806),r(76460),r(28379)),d=r(85842),p=r(17707),f=r(13312),m=r(19902),g=r(44135);const y=new a.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let _=i=class extends l.oY{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){const r=f.A.fromJSON(t.spatialReference),i=[];for(let n=0;n<e.length;n++){const t=e[n],s=o.A.fromJSON(t),a=t.geometry?.spatialReference;null==s.geometry||a||(s.geometry.spatialReference=r);const l=t.aggregateGeometries,c=s.aggregateGeometries;if(l&&null!=c)for(const e in c){const t=c[e],i=l[e],n=i?.spatialReference;null==t||n||(t.spatialReference=r)}i.push(s)}return i}writeGeometryType(e,t,r,i){if(e)return void y.write(e,t,r,i);const{features:n}=this;if(n)for(const s of n)if(null!=s?.geometry)return void y.write(s.geometry.type,t,r,i)}readQueryGeometry(e,t){if(!e)return null;const r=!!e.spatialReference,i=(0,m.rS)(e);return i&&!r&&t.spatialReference&&(i.spatialReference=f.A.fromJSON(t.spatialReference)),i}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:r}=this;if(r)for(const i of r)if(i&&null!=i.geometry&&i.geometry.spatialReference)return void(t.spatialReference=i.geometry.spatialReference.toJSON())}clone(){return new i(this.cloneProperties())}cloneProperties(){return(0,c.o8)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let r=0;r<t.features.length;r++){const i=t.features[r];if(i.geometry){const t=e?.[r];i.geometry=t?.toJSON()||i.geometry}}return t}quantize(e){const{scale:[t,r],translate:[i,n]}=e,s=this.features,o=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-i)/t)),(e=>Math.round((n-e)/r)));for(let a=0,l=s.length;a<l;a++)o?.(s[a].geometry)||(s.splice(a,1),a--,l--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:r}=this;if(!r)return this;const{translate:[i,n],scale:[s,o]}=r;let a=null,l=null;if(this.hasZ&&null!=r?.scale?.[2]){const{translate:[,,e],scale:[,,t]}=r;a=r=>r*t+e}if(this.hasM&&null!=r?.scale?.[3]){const{translate:[,,,e],scale:[,,,t]}=r;l=r=>null==r?r:r*t+e}const c=this._getHydrationFunction(e,(e=>e*s+i),(e=>n-e*o),a,l);for(const{geometry:u}of t)null!=u&&c&&c(u);return this.transform=null,this}_quantizePoints(e,t,r){let i,n;const s=[];for(let o=0,a=e.length;o<a;o++){const a=e[o];if(o>0){const e=t(a[0]),o=r(a[1]);e===i&&o===n||(s.push([e-i,o-n]),i=e,n=o)}else i=t(a[0]),n=r(a[1]),s.push([i,n])}return s.length>0?s:null}_getQuantizationFunction(e,t,r){return"point"===e?e=>(e.x=t(e.x),e.y=r(e.y),e):"polyline"===e||"polygon"===e?e=>{const i=(0,m.Bi)(e)?e.rings:e.paths,n=[];for(let s=0,o=i.length;s<o;s++){const e=i[s],o=this._quantizePoints(e,t,r);o&&n.push(o)}return n.length>0?((0,m.Bi)(e)?e.rings=n:e.paths=n,e):null}:"multipoint"===e?e=>{const i=this._quantizePoints(e.points,t,r);return i&&i.length>0?(e.points=i,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,r,i,n){return"point"===e?e=>{e.x=t(e.x),e.y=r(e.y),i&&(e.z=i(e.z))}:"polyline"===e||"polygon"===e?e=>{const s=(0,m.Bi)(e)?e.rings:e.paths;let o,a;for(let i=0,n=s.length;i<n;i++){const e=s[i];for(let i=0,n=e.length;i<n;i++){const n=e[i];i>0?(o+=n[0],a+=n[1]):(o=n[0],a=n[1]),n[0]=t(o),n[1]=r(a)}}if(i&&n)for(let t=0,r=s.length;t<r;t++){const e=s[t];for(let t=0,r=e.length;t<r;t++){const r=e[t];r[2]=i(r[2]),r[3]=n(r[3])}}else if(i)for(let t=0,r=s.length;t<r;t++){const e=s[t];for(let t=0,r=e.length;t<r;t++){const r=e[t];r[2]=i(r[2])}}else if(n)for(let t=0,r=s.length;t<r;t++){const e=s[t];for(let t=0,r=e.length;t<r;t++){const r=e[t];r[2]=n(r[2])}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax),i&&null!=e.zmax&&null!=e.zmin&&(e.zmax=i(e.zmax),e.zmin=i(e.zmin)),n&&null!=e.mmax&&null!=e.mmin&&(e.mmax=n(e.mmax),e.mmin=n(e.mmin))}:"multipoint"===e?e=>{const s=e.points;let o,a;for(let i=0,n=s.length;i<n;i++){const e=s[i];i>0?(o+=e[0],a+=e[1]):(o=e[0],a=e[1]),e[0]=t(o),e[1]=r(a)}if(i&&n)for(let t=0,r=s.length;t<r;t++){const e=s[t];e[2]=i(e[2]),e[3]=n(e[3])}else if(i)for(let t=0,r=s.length;t<r;t++){const e=s[t];e[2]=i(e[2])}else if(n)for(let t=0,r=s.length;t<r;t++){const e=s[t];e[2]=n(e[2])}}:null}};(0,n._)([(0,u.MZ)({type:String,json:{write:!0}})],_.prototype,"displayFieldName",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],_.prototype,"exceededTransferLimit",void 0),(0,n._)([(0,u.MZ)({type:[o.A],json:{write:!0}})],_.prototype,"features",void 0),(0,n._)([(0,h.w)("features")],_.prototype,"readFeatures",null),(0,n._)([(0,u.MZ)({type:[g.A],json:{write:!0}})],_.prototype,"fields",void 0),(0,n._)([(0,u.MZ)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:y.read}}})],_.prototype,"geometryType",void 0),(0,n._)([(0,p.K)("geometryType")],_.prototype,"writeGeometryType",null),(0,n._)([(0,u.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],_.prototype,"hasM",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],_.prototype,"hasZ",void 0),(0,n._)([(0,u.MZ)({types:s.yR,json:{write:!0}})],_.prototype,"queryGeometry",void 0),(0,n._)([(0,h.w)("queryGeometry")],_.prototype,"readQueryGeometry",null),(0,n._)([(0,u.MZ)({type:f.A,json:{write:!0}})],_.prototype,"spatialReference",void 0),(0,n._)([(0,p.K)("spatialReference")],_.prototype,"writeSpatialReference",null),(0,n._)([(0,u.MZ)({json:{write:!0}})],_.prototype,"transform",void 0),_=i=(0,n._)([(0,d.$)("esri.rest.support.FeatureSet")],_),_.prototype.toJSON.isDefaultToJSON=!0;const v=_},77269:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i=r(35143),n=r(69098),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842));let l=class extends((0,n.O)(s.oY)){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};(0,i._)([(0,o.MZ)({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.onFields&&this.onFields.length>0}}}}})],l.prototype,"onFields",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"operator",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"searchTerm",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"searchType",void 0),l=(0,i._)([(0,a.$)("esri.rest.support.FullTextSearch")],l);const c=l},63068:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var i,n=r(35143),s=r(53084),o=r(46053),a=(r(81806),r(76460),r(85842)),l=r(6259),c=r(56280);let u=i=class extends c.A{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new i({colorRamps:(0,s.o8)(this.colorRamps)})}};(0,n._)([(0,o.MZ)({type:[l.A],json:{write:!0}})],u.prototype,"colorRamps",void 0),(0,n._)([(0,o.MZ)({type:["multipart"]})],u.prototype,"type",void 0),u=i=(0,n._)([(0,a.$)("esri.rest.support.MultipartColorRamp")],u);const h=u},70414:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i=r(35143),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(19902),l=r(80963);let c=class extends n.oY{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map((e=>e.toJSON())),t=this.geometries[0],r={};return r.outSR=(0,l.YX)(this.outSpatialReference),r.inSR=(0,l.YX)(t.spatialReference),r.geometries=JSON.stringify({geometryType:(0,a.$B)(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(r.transformForward=this.transformForward),r}};(0,i._)([(0,s.MZ)()],c.prototype,"geometries",void 0),(0,i._)([(0,s.MZ)({json:{read:{source:"outSR"}}})],c.prototype,"outSpatialReference",void 0),(0,i._)([(0,s.MZ)()],c.prototype,"transformation",void 0),(0,i._)([(0,s.MZ)()],c.prototype,"transformForward",void 0),c=(0,i._)([(0,o.$)("esri.rest.support.ProjectParameters")],c);const u=c},69194:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var i,n=r(35143),s=(r(35238),r(45802)),o=r(42553),a=r(53084),l=r(46053),c=(r(81806),r(76460),r(85842)),u=r(76797);const h=new s.J({upperLeft:"upper-left",lowerLeft:"lower-left"});let d=i=class extends o.oY{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new i((0,a.o8)({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};(0,n._)([(0,l.MZ)({type:u.A,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],d.prototype,"extent",void 0),(0,n._)([(0,l.MZ)({type:["view","edit"],json:{write:!0}})],d.prototype,"mode",void 0),(0,n._)([(0,l.MZ)({type:String,json:{read:h.read,write:h.write}})],d.prototype,"originPosition",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],d.prototype,"tolerance",void 0),d=i=(0,n._)([(0,c.$)("esri.rest.support.QuantizationParameters")],d);const p=d},68295:(e,t,r)=>{"use strict";r.d(t,{A:()=>A});var i,n=r(35143),s=r(35238),o=r(82111),a=r(45802),l=r(42553),c=r(53084),u=r(46053),h=r(21403),d=r(6409),p=r(85842),f=r(17707),m=r(40565),g=r(19902),y=r(89551),_=r(77269),v=r(69194),b=r(38432),w=r(21820),x=r(13312),S=r(19247);const T=new a.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let M=i=class extends l.oY{static from(e){return(0,m.PZ)(i,e)}constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(e){return"number"==typeof e||"object"==typeof e?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const r={};for(const t in e){const i=e[t];Array.isArray(i)?r[t]=i.map((e=>e instanceof Date?e.getTime():e)):i instanceof Date?r[t]=i.getTime():r[t]=i}t.parameterValues=r}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new i((0,c.o8)({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:null!=this.historicMoment?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};M.MAX_MAX_RECORD_COUNT_FACTOR=5,(0,n._)([(0,u.MZ)({json:{write:!0}})],M.prototype,"aggregateIds",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{write:!0}})],M.prototype,"cacheHint",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{default:!1,write:!0}})],M.prototype,"compactGeometryEnabled",void 0),(0,n._)([(0,u.MZ)({json:{write:!0}})],M.prototype,"datumTransformation",void 0),(0,n._)([(0,h.w)("datumTransformation")],M.prototype,"castDatumTransformation",null),(0,n._)([(0,u.MZ)({type:Boolean,json:{default:!1,write:!0}})],M.prototype,"defaultSpatialReferenceEnabled",void 0),(0,n._)([(0,u.MZ)({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],M.prototype,"distance",void 0),(0,n._)([(0,u.MZ)({type:y.L,json:{write:!0}})],M.prototype,"dynamicDataSource",void 0),(0,n._)([(0,u.MZ)({type:String,json:{write:!0}})],M.prototype,"formatOf3DObjects",void 0),(0,n._)([(0,u.MZ)({type:[_.A],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.fullText&&this.fullText.length>0}}}}})],M.prototype,"fullText",void 0),(0,n._)([(0,u.MZ)({type:String,json:{write:!0}})],M.prototype,"gdbVersion",void 0),(0,n._)([(0,u.MZ)({types:s.yR,json:{read:g.rS,write:!0}})],M.prototype,"geometry",void 0),(0,n._)([(0,u.MZ)({type:Number,json:{write:!0}})],M.prototype,"geometryPrecision",void 0),(0,n._)([(0,u.MZ)({type:[String],json:{write:!0}})],M.prototype,"groupByFieldsForStatistics",void 0),(0,n._)([(0,u.MZ)({type:String,json:{write:!0}})],M.prototype,"having",void 0),(0,n._)([(0,u.MZ)({type:Date})],M.prototype,"historicMoment",void 0),(0,n._)([(0,f.K)("historicMoment")],M.prototype,"writeHistoricMoment",null),(0,n._)([(0,u.MZ)({type:Number,json:{write:!0}})],M.prototype,"maxAllowableOffset",void 0),(0,n._)([(0,u.MZ)({type:Number,cast:e=>e<1?1:e>M.MAX_MAX_RECORD_COUNT_FACTOR?M.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],M.prototype,"maxRecordCountFactor",void 0),(0,n._)([(0,u.MZ)({type:["xyFootprint"],json:{write:!0}})],M.prototype,"multipatchOption",void 0),(0,n._)([(0,u.MZ)({type:Number,json:{read:{source:"resultRecordCount"}}})],M.prototype,"num",void 0),(0,n._)([(0,u.MZ)({json:{write:!0}})],M.prototype,"objectIds",void 0),(0,n._)([(0,u.MZ)({type:[String],json:{write:!0}})],M.prototype,"orderByFields",void 0),(0,n._)([(0,u.MZ)({type:[String],json:{write:!0}})],M.prototype,"outFields",void 0),(0,n._)([(0,u.MZ)({type:x.A,json:{name:"outSR",write:!0}})],M.prototype,"outSpatialReference",void 0),(0,n._)([(0,u.MZ)({type:[w.A],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.outStatistics&&this.outStatistics.length>0}}}}})],M.prototype,"outStatistics",void 0),(0,n._)([(0,u.MZ)({json:{write:!0}})],M.prototype,"parameterValues",void 0),(0,n._)([(0,f.K)("parameterValues")],M.prototype,"writeParameterValues",null),(0,n._)([(0,u.MZ)({type:S.A,json:{write:!0}})],M.prototype,"pixelSize",void 0),(0,n._)([(0,u.MZ)({type:v.A,json:{write:!0}})],M.prototype,"quantizationParameters",void 0),(0,n._)([(0,u.MZ)({type:[Object],json:{write:!0}})],M.prototype,"rangeValues",void 0),(0,n._)([(0,u.MZ)({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:"relation"===this.spatialRelationship}}}}})],M.prototype,"relationParameter",void 0),(0,n._)([(0,u.MZ)({type:String,json:{write:!0}})],M.prototype,"resultType",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{default:!1,write:!0}})],M.prototype,"returnCentroid",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{default:!1,write:!0}})],M.prototype,"returnDistinctValues",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{default:!0,write:!0}})],M.prototype,"returnExceededLimitFeatures",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{write:!0}})],M.prototype,"returnGeometry",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{default:!1,write:!0}})],M.prototype,"returnQueryGeometry",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{default:!1,write:!0}})],M.prototype,"returnM",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],M.prototype,"returnZ",void 0),(0,n._)([(0,u.MZ)({type:x.A,json:{write:!0}})],M.prototype,"sourceSpatialReference",void 0),(0,n._)([(0,d.e)(b.x,{ignoreUnknown:!1,name:"spatialRel"})],M.prototype,"spatialRelationship",void 0),(0,n._)([(0,u.MZ)({type:Number,json:{read:{source:"resultOffset"}}})],M.prototype,"start",void 0),(0,n._)([(0,f.K)("start"),(0,f.K)("num")],M.prototype,"writeStart",null),(0,n._)([(0,u.MZ)({type:String,json:{write:!0}})],M.prototype,"sqlFormat",void 0),(0,n._)([(0,u.MZ)({type:String,json:{write:!0}})],M.prototype,"text",void 0),(0,n._)([(0,u.MZ)({type:o.A,json:{write:!0}})],M.prototype,"timeExtent",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{default:!1,write:!0}})],M.prototype,"timeReferenceUnknownClient",void 0),(0,n._)([(0,d.e)(T,{ignoreUnknown:!1}),(0,u.MZ)({json:{write:{overridePolicy(e){return{enabled:!!e&&null!=this.distance&&this.distance>0}}}}})],M.prototype,"units",void 0),(0,n._)([(0,u.MZ)({type:String,json:{write:{overridePolicy(e){return{enabled:null!=e||null!=this.start&&this.start>0}}}}})],M.prototype,"where",void 0),(0,n._)([(0,f.K)("where")],M.prototype,"writeWhere",null),M=i=(0,n._)([(0,p.$)("esri.rest.support.Query")],M);const A=M},58289:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var i,n=r(35143),s=(r(35238),r(42553)),o=r(53084),a=r(46053),l=r(40565),c=r(85842),u=r(17707),h=r(89551),d=r(13312);let p=i=class extends s.oY{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&null==this.where&&(t.definitionExpression="1=1")}clone(){return new i((0,o.o8)({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};(0,n._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],p.prototype,"cacheHint",void 0),(0,n._)([(0,a.MZ)({type:h.L,json:{write:!0}})],p.prototype,"dynamicDataSource",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],p.prototype,"gdbVersion",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],p.prototype,"geometryPrecision",void 0),(0,n._)([(0,a.MZ)({type:Date})],p.prototype,"historicMoment",void 0),(0,n._)([(0,u.K)("historicMoment")],p.prototype,"_writeHistoricMoment",null),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],p.prototype,"maxAllowableOffset",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],p.prototype,"objectIds",void 0),(0,n._)([(0,a.MZ)({type:[String],json:{write:!0}})],p.prototype,"orderByFields",void 0),(0,n._)([(0,a.MZ)({type:[String],json:{write:!0}})],p.prototype,"outFields",void 0),(0,n._)([(0,a.MZ)({type:d.A,json:{read:{source:"outSR"},write:{target:"outSR"}}})],p.prototype,"outSpatialReference",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],p.prototype,"relationshipId",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{read:{source:"resultOffset"}}})],p.prototype,"start",void 0),(0,n._)([(0,u.K)("start"),(0,u.K)("num")],p.prototype,"writeStart",null),(0,n._)([(0,a.MZ)({type:Number,json:{read:{source:"resultRecordCount"}}})],p.prototype,"num",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],p.prototype,"returnGeometry",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],p.prototype,"returnM",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],p.prototype,"returnZ",void 0),(0,n._)([(0,a.MZ)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],p.prototype,"where",void 0),p=i=(0,n._)([(0,c.$)("esri.rest.support.RelationshipQuery")],p),p.from=(0,l.dp)(p);const f=p},21820:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var i,n=r(35143),s=r(45802),o=r(42553),a=r(53084),l=r(46053),c=(r(81806),r(76460),r(85842)),u=r(17707);const h=new s.J({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let d=i=class extends o.oY{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){"percentile-continuous"!==this.statisticType&&"percentile-discrete"!==this.statisticType||(t.statisticParameters=(0,a.o8)(e))}clone(){return new i({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:(0,a.o8)(this.statisticParameters)})}};(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],d.prototype,"maxPointCount",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],d.prototype,"maxRecordCount",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],d.prototype,"maxVertexCount",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"onStatisticField",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"outStatisticFieldName",void 0),(0,n._)([(0,l.MZ)({type:String,json:{read:{source:"statisticType",reader:h.read},write:{target:"statisticType",writer:h.write}}})],d.prototype,"statisticType",void 0),(0,n._)([(0,l.MZ)({type:Object})],d.prototype,"statisticParameters",void 0),(0,n._)([(0,u.K)("statisticParameters")],d.prototype,"writeStatisticParameters",null),d=i=(0,n._)([(0,c.$)("esri.rest.support.StatisticDefinition")],d);const p=d},58672:(e,t,r)=>{"use strict";r.d(t,{A:()=>x});var i,n=r(35143),s=r(35238),o=r(82111),a=r(45802),l=r(42553),c=r(53084),u=r(46053),h=r(40565),d=r(85842),p=r(17707),f=r(19902);r(81806),r(76460),r(47249);let m=i=class extends l.oY{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new i({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};(0,n._)([(0,u.MZ)({type:[String],json:{write:!0}})],m.prototype,"groupByFields",void 0),(0,n._)([(0,u.MZ)({type:Number,json:{write:!0}})],m.prototype,"topCount",void 0),(0,n._)([(0,u.MZ)({type:[String],json:{write:!0}})],m.prototype,"orderByFields",void 0),m=i=(0,n._)([(0,d.$)("esri.rest.support.TopFilter")],m);const g=m;var y,_=r(13312);const v=new a.J({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),b=new a.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let w=y=class extends l.oY{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new y((0,c.o8)({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};(0,n._)([(0,u.MZ)({type:Boolean,json:{write:!0}})],w.prototype,"cacheHint",void 0),(0,n._)([(0,u.MZ)({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],w.prototype,"distance",void 0),(0,n._)([(0,u.MZ)({types:s.yR,json:{read:f.rS,write:!0}})],w.prototype,"geometry",void 0),(0,n._)([(0,u.MZ)({type:Number,json:{write:!0}})],w.prototype,"geometryPrecision",void 0),(0,n._)([(0,u.MZ)({type:Number,json:{write:!0}})],w.prototype,"maxAllowableOffset",void 0),(0,n._)([(0,u.MZ)({type:Number,json:{read:{source:"resultRecordCount"}}})],w.prototype,"num",void 0),(0,n._)([(0,u.MZ)({json:{write:!0}})],w.prototype,"objectIds",void 0),(0,n._)([(0,u.MZ)({type:[String],json:{write:!0}})],w.prototype,"orderByFields",void 0),(0,n._)([(0,u.MZ)({type:[String],json:{write:!0}})],w.prototype,"outFields",void 0),(0,n._)([(0,u.MZ)({type:_.A,json:{read:{source:"outSR"},write:{target:"outSR"}}})],w.prototype,"outSpatialReference",void 0),(0,n._)([(0,u.MZ)({type:String,json:{write:!0}})],w.prototype,"resultType",void 0),(0,n._)([(0,u.MZ)({json:{write:!0}})],w.prototype,"returnGeometry",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"returnM",void 0),(0,n._)([(0,u.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"returnZ",void 0),(0,n._)([(0,u.MZ)({type:Number,json:{read:{source:"resultOffset"}}})],w.prototype,"start",void 0),(0,n._)([(0,p.K)("start"),(0,p.K)("num")],w.prototype,"writeStart",null),(0,n._)([(0,u.MZ)({type:String,json:{read:{source:"spatialRel",reader:v.read},write:{target:"spatialRel",writer:v.write}}})],w.prototype,"spatialRelationship",void 0),(0,n._)([(0,u.MZ)({type:o.A,json:{write:!0}})],w.prototype,"timeExtent",void 0),(0,n._)([(0,u.MZ)({type:g,json:{write:!0}})],w.prototype,"topFilter",void 0),(0,n._)([(0,u.MZ)({type:String,json:{read:b.read,write:{writer:b.write,overridePolicy(e){return{enabled:null!=e&&null!=this.distance&&this.distance>0}}}}})],w.prototype,"units",void 0),(0,n._)([(0,u.MZ)({type:String,json:{write:!0}})],w.prototype,"where",void 0),w=y=(0,n._)([(0,d.$)("esri.rest.support.TopFeaturesQuery")],w),w.from=(0,h.dp)(w);const x=w},22471:(e,t,r)=>{"use strict";r.d(t,{g:()=>o,r:()=>a});var i=r(6259),n=r(56280),s=r(63068);const o={key:"type",base:n.A,typeMap:{algorithmic:i.A,multipart:s.A}};function a(e){return e?.type?"algorithmic"===e.type?i.A.fromJSON(e):"multipart"===e.type?s.A.fromJSON(e):null:null}},29067:(e,t,r)=>{"use strict";r.d(t,{K:()=>i});const i={type:String,json:{read:{source:"token"},write:{target:"token"}}}},38432:(e,t,r)=>{"use strict";r.d(t,{x:()=>i});const i=new(r(45802).J)({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"})},54994:(e,t,r)=>{"use strict";r.d(t,{Dl:()=>o,jV:()=>s,lF:()=>a});r(86560),r(55171);var i=r(53084),n=r(90534);r(90924);function s(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}}function o(e){return"string"==typeof e?(0,n.An)(e):(0,i.o8)(e)}function a(e,t,r){const i={};for(const n in e){if("declaredClass"===n)continue;const s=e[n];if(null!=s&&"function"!=typeof s)if(Array.isArray(s))i[n]=s.map((e=>a(e)));else if("object"==typeof s)if(s.toJSON){const e=s.toJSON(r?.[n]);i[n]=t?e:JSON.stringify(e)}else i[n]=t?s:JSON.stringify(s);else i[n]=s}return i}},64519:(e,t,r)=>{"use strict";r.d(t,{Y:()=>c});var i=r(35143),n=r(39356),s=(r(76460),r(40565)),o=(r(47249),r(81806),r(50076),r(29101)),a=r(85842),l=r(5364);let c=class extends l.X{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};(0,i._)([(0,o.u)({Type:n.A,ensureType:(0,s.dp)(n.A)})],c.prototype,"itemType",void 0),c=(0,i._)([(0,a.$)("esri.support.GraphicsCollection")],c)},71671:(e,t,r)=>{"use strict";r.d(t,{Q:()=>d});var i=r(35143),n=r(19276),s=r(3975),o=r(76460),a=r(50346),l=r(46053),c=(r(81806),r(47249),r(85842)),u=r(25515);function h(e,t,r){let i,n;if(e)for(let s=0,o=e.length;s<o;s++){if(i=e.at(s),i?.[t]===r)return i;if("group"===i?.type&&(n=h(i.layers,t,r),n))return n}}const d=e=>{let t=class extends e{constructor(){super(...arguments),this.layers=new n.A;const e=e=>{e.parent=this,this.layerAdded(e),"elevation"!==e.type&&"base-elevation"!==e.type||o.A.getLogger(this).error(`Layer 'title:${e.title}, id:${e.id}' of type '${e.type}' is not supported as an operational layer and will therefore be ignored.`)},t=e=>{e.parent=null,this.layerRemoved(e)};this.addHandles([this.layers.on("before-add",(e=>{if(e.item===this)return e.preventDefault(),void o.A.getLogger(this).error("#add()","Cannot add layer to itself.");(e=>{e.parent&&"remove"in e.parent&&e.parent.remove(e)})(e.item)})),this.layers.on("after-add",(t=>e(t.item))),this.layers.on("after-remove",(e=>t(e.item)))])}destroy(){const e=this.layers.toArray();for(const t of e)t.destroy();this.layers.destroy()}set layers(e){this._set("layers",(0,s.V)(e,this._get("layers")))}add(e,t){const r=this.layers;if(t=r.getNextIndex(t),e instanceof u.A){const i=e;i.parent===this?this.reorder(i,t):r.add(i,t)}else(0,a.$X)(e)?e.then((e=>{this.destroyed||this.add(e,t)})):o.A.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(e,t){const r=this.layers;let i=r.getNextIndex(t);e.slice().forEach((e=>{e.parent!==this?(r.add(e,i),i+=1):this.reorder(e,i)}))}findLayerById(e){return h(this.layers,"id",e)}findLayerByUid(e){return h(this.layers,"uid",e)}remove(e){return this.layers.remove(e)}removeMany(e){return this.layers.removeMany(e)}removeAll(){return this.layers.removeAll()}reorder(e,t){return this.layers.reorder(e,t)}layerAdded(e){}layerRemoved(e){}};return(0,i._)([(0,l.MZ)()],t.prototype,"layers",null),t=(0,i._)([(0,c.$)("esri.support.LayersMixin")],t),t}},45730:(e,t,r)=>{"use strict";r.d(t,{l:()=>u});var i=r(35143),n=r(19276),s=r(3975),o=r(76460),a=r(46053),l=(r(81806),r(47249),r(85842));function c(e,t,r){if(e)for(let i=0,n=e.length;i<n;i++){const n=e.at(i);if(n[t]===r)return n;if("group"===n?.type){const e=c(n.tables,t,r);if(e)return e}}}const u=e=>{let t=class extends e{constructor(){super(...arguments),this.tables=new n.A,this.addHandles([this.tables.on("after-add",(e=>{const t=e.item;t.parent&&t.parent!==this&&"tables"in t.parent&&t.parent.tables.remove(t),t.parent=this,"feature"!==t.type&&o.A.getLogger(this).error(`Layer 'title:${t.title}, id:${t.id}' of type '${t.type}' is not supported as a table and will therefore be ignored.`)})),this.tables.on("after-remove",(e=>{e.item.parent=null}))])}destroy(){const e=this.tables.toArray();for(const t of e)t.destroy();this.tables.destroy()}set tables(e){this._set("tables",(0,s.V)(e,this._get("tables")))}findTableById(e){return c(this.tables,"id",e)}findTableByUid(e){return c(this.tables,"uid",e)}};return(0,i._)([(0,a.MZ)()],t.prototype,"tables",null),t=(0,i._)([(0,l.$)("esri.support.TablesMixin")],t),t}},50037:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(91967),o=r(5632),a=r(46053),l=(r(81806),r(76460),r(47249),r(85842));let c=i=class extends((0,o.sA)(s.A)){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new i({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};(0,n._)([(0,a.MZ)()],c.prototype,"active",void 0),(0,n._)([(0,a.MZ)()],c.prototype,"className",void 0),(0,n._)([(0,a.MZ)()],c.prototype,"disabled",void 0),(0,n._)([(0,a.MZ)()],c.prototype,"icon",void 0),(0,n._)([(0,a.MZ)()],c.prototype,"id",void 0),(0,n._)([(0,a.MZ)()],c.prototype,"indicator",void 0),(0,n._)([(0,a.MZ)()],c.prototype,"title",void 0),(0,n._)([(0,a.MZ)()],c.prototype,"type",void 0),(0,n._)([(0,a.MZ)()],c.prototype,"visible",void 0),c=i=(0,n._)([(0,l.$)("esri.support.actions.ActionBase")],c);const u=c},16700:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(50037);let l=i=class extends a.A{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new i({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};(0,n._)([(0,s.MZ)()],l.prototype,"image",void 0),l=i=(0,n._)([(0,o.$)("esri.support.actions.ActionButton")],l);const c=l},76192:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(50037);let l=i=class extends a.A{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new i({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};(0,n._)([(0,s.MZ)()],l.prototype,"image",void 0),(0,n._)([(0,s.MZ)()],l.prototype,"value",void 0),l=i=(0,n._)([(0,o.$)("esri.support.actions.ActionToggle")],l);const c=l},90924:(e,t,r)=>{"use strict";r.d(t,{Q:()=>s});var i=r(90534);const n=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function s(e){const t=(0,i.$z)(e,!0);return!!t&&t.endsWith(".arcgis.com")&&!n.has(t)&&!e.endsWith("/sharing/rest/generateToken")}},98976:(e,t,r)=>{"use strict";r.d(t,{$I:()=>l,Ad:()=>c,lw:()=>a,xR:()=>u});r(35238);var i=r(50076),n=r(76460),s=r(13312);let o;function a(){return o||(o=(async()=>{const e=await Promise.all([r.e(3620),r.e(289)]).then(r.bind(r,30289));return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),o}const l=(e,t,r)=>h.create(e,t,r,null,["$feature","$view"],[]),c=(e,t,r)=>h.create(e,t,r,null,["$feature","$view"],[]),u=(e,t,r,i)=>h.create(e,t,r,i,["$feature","$view"],[]);class h{constructor(e,t,r,i,n,s,o){this.services=null,this.script=e,this.evaluate=i;const a=Array.isArray(s)?s:s?.fields;this.fields=a??[],this._syntaxTree=r,this._arcade=t,this._arcadeFeature=n,this._spatialReference=o,this._referencesGeometry=t.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,t,r,o,l,c){const{arcade:u,Feature:d,Dictionary:p}=await a(),f=s.A.fromJSON(t);let m;try{m=u.parseScript(e,c)}catch(C){return n.A.getLogger("esri.support.arcadeOnDemand").error(new i.A("arcade-bad-expression","Failed to parse arcade script",{script:e,error:C})),null}const g=l.reduce(((e,t)=>({...e,[t]:null})),{});let y=null;null!=o&&(y=new p(o),y.immutable=!0,g.$config=null);const _=u.scriptUsesGeometryEngine(m),v=_&&u.enableGeometrySupport(),b=u.scriptUsesFeatureSet(m)&&u.enableFeatureSetSupport(),w=u.scriptIsAsync(m),x=w&&u.enableAsyncSupport(),S={vars:g,spatialReference:f,useAsync:!!x};await Promise.all([v,b,x]);const T=new Set;await u.loadDependentModules(T,m,null,w,_);const M=new p;M.immutable=!1,M.setField("scale",0);const A=u.compileScript(m,S);return new h(e,u,m,((e,t)=>{const r=e.$view?.timeZone;return"$view"in e&&e.$view&&(M.setField("scale","object"==typeof e.$view&&"scale"in e.$view?e.$view.scale:void 0),e.$view=M),y&&(e.$config=y),A({vars:e,spatialReference:f,services:t,timeZone:r})}),new d,r,f)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}}},59056:(e,t,r)=>{"use strict";function i(e){const t=atob(e),r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r.buffer}function n(e){const t=new Uint8Array(e);let r="";for(let i=0;i<t.length;i++)r+=String.fromCharCode(t[i]);return btoa(r)}r.d(t,{M:()=>i,Y:()=>n})},54047:(e,t,r)=>{"use strict";r.d(t,{H:()=>o,q:()=>s});var i=r(28899),n=r(63860);async function s(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e.includes("-3d")?e.slice(0,e.indexOf("-3d")):e,r=await(0,n.ud)("esri/t9n/basemaps");return r[e]||r[t]}const o={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}}},86300:(e,t,r)=>{"use strict";r.d(t,{JT:()=>g,Rc:()=>m,VC:()=>h,dp:()=>p,jj:()=>d,n8:()=>y,ns:()=>f});var i=r(194),n=r(86560),s=(r(19276),r(76460)),o=r(30726),a=r(90534),l=r(40565),c=(r(58503),r(54047));const u=()=>s.A.getLogger("esri.support.basemapUtils");function h(){return{}}function d(e){for(const t in e){const r=e[t];(0,o.pR)(r),delete e[t]}}function p(e,t){let r;if("string"==typeof e){const s=e in c.H,o=!s&&e.includes("/");if(!s&&!o){const t=Object.entries(c.H).filter((e=>{let[t,r]=e;return n.A.apiKey&&!r.classic||!n.A.apiKey&&(r.classic||r.is3d)})).map((e=>{let[t]=e;return`"${t}"`})).sort().join(", ");return u().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${t}`),null}t&&(r=t[e]),r||(r=s?i.default.fromId(e):new i.default({style:{id:e}}),t&&(t[e]=r))}else r=(0,l.dp)(i.default,e);return r?.destroyed&&(u().warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function f(e,t){return e.basemap?.referenceLayers?.some((e=>e.uid===t))||e.basemap?.baseLayers?.some((e=>e.uid===t))}function m(e){return!!e?.baseLayers.concat(e.referenceLayers).some(g)}function g(e){if(v(e.url))return!0;if("vector-tile"===e.type)for(const t in e.sourceNameToSource){const r=e.sourceNameToSource[t];if(v(r?.sourceUrl))return!0}return!1}function y(e,t){if(null==t||null==e)return{spatialReference:null,updating:!1};if("not-loaded"===t.loadStatus)return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(0===t.baseLayers.length)return{spatialReference:null,updating:!1};const r=t.baseLayers.at(0);switch(r.loadStatus){case"not-loaded":r.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const i=(("supportedSpatialReferences"in r?r.supportedSpatialReferences:null)||["tileInfo"in r?r.tileInfo?.spatialReference:r.spatialReference]).filter(Boolean),n=e.spatialReference;return n?{spatialReference:i.find((e=>n.equals(e)))??i[0]??null,updating:!1}:{spatialReference:i[0],updating:!1}}const _=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function v(e){if(!e)return!1;const t=new a.s0((0,a.s2)(e));return!!t.authority&&_.test(t.authority)}},10425:(e,t,r)=>{"use strict";r.d(t,{X:()=>s,Z:()=>n});var i=r(73763);function n(e){return new i.A({getCollections:()=>[e.tables,e.layers],getChildrenFunction:e=>{const t=[];return"tables"in e&&t.push(e.tables),"layers"in e&&t.push(e.layers),t},itemFilterFunction:e=>{const t=e.parent;return!!t&&"tables"in t&&t.tables.includes(e)}})}function s(e){for(const t of e.values())t?.destroy();e.clear()}},12482:(e,t,r)=>{"use strict";r.d(t,{$7:()=>T,B:()=>S,Fo:()=>b,M7:()=>C,Q5:()=>w,Tq:()=>R,Up:()=>x,XF:()=>A,Ze:()=>g,bK:()=>a,bh:()=>h,id:()=>y,ky:()=>u,qt:()=>E,tW:()=>M,v9:()=>d,w7:()=>l,wF:()=>o,wS:()=>_,wz:()=>f,x:()=>p,xS:()=>v,ze:()=>c});var i=r(31633),n=r(59097);function s(e){return e?E:R}function o(e,t){return t?.mode?t.mode:s(e).mode}function a(e,t){return null!=t?t:s(e)}function l(e,t){return o(null!=e&&e.hasZ,t)}function c(e,t){return a(null!=e&&!!e.hasZ,t)}function u(e){const t=m(e);return l(e.geometry,t)}function h(e){const t=m(e),r=l(e.geometry,t),i=null!=t&&"on-the-ground"!==r?C(t):0,n=t?.featureExpressionInfo;return{mode:r,offset:i,featureExpressionInfo:n}}function d(e){return f(e)||p(e)}function p(e){return"0"===e?.featureExpressionInfo?.expression}function f(e){if(!e)return!1;if("on-the-ground"===e.mode)return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||"0"===t)}function m(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function g(e,t){if(!e?.offset)return 0;const{offset:r,unit:n}=e;if("decimal-degrees"===n)return 0;const s="unknown"!==n&&n?n:"meters",o=(0,i.mq)(t);return o?(0,i.oU)(r,s,o):0}function y(e,t,r){if(!r?.mode)return;const i=e.hasZ?e.z:0,n=g(r,e.spatialReference);switch(r.mode){case"absolute-height":return i-n;case"on-the-ground":return 0;case"relative-to-ground":return i-((t.elevationProvider.getElevation(e.x,e.y,i,e.spatialReference,"ground")??0)+n);case"relative-to-scene":return i-((t.elevationProvider.getElevation(e.x,e.y,i,e.spatialReference,"scene")??0)+n)}}function _(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return b(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,r,i)}function v(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return b(e,t[0],t[1],t.length>2?t[2]:0,r,i,n)}function b(e,t,r,i,n,s){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(null==s)return;const a=null!=o?o.mode:"absolute-height";if("on-the-ground"===a)return 0;const{absoluteZ:l}=w(t,r,i,n,e,s);return function(e,t,r,i,n,s,o,a){const l=g(o,n);switch(a){case"absolute-height":return e-l;case"relative-to-ground":return e-((s.elevationProvider.getElevation(t,r,i,n,"ground")??0)+l);case"relative-to-scene":return e-((s.elevationProvider.getElevation(t,r,i,n,"scene")??0)+l)}}(l,t,r,i,n,e,o,a)}function w(e,t,r,i,n,s){const o=g(s,i);switch(s.mode){case"absolute-height":return{absoluteZ:r+o,elevation:0};case"on-the-ground":{const r=n.elevationProvider.getElevation(e,t,0,i,"ground")??0;return{absoluteZ:r,elevation:r}}case"relative-to-ground":{const s=n.elevationProvider.getElevation(e,t,r,i,"ground")??0;return{absoluteZ:r+s+o,elevation:s}}case"relative-to-scene":{const s=n.elevationProvider.getElevation(e,t,r,i,"scene")??0;return{absoluteZ:r+s+o,elevation:s}}}}function x(e,t){if(null==t)return!1;const{mode:r}=t;return null!=r&&("scene"===e&&"relative-to-scene"===r||"ground"===e&&"absolute-height"!==r)}function S(e,t,r){return r&&r.mode!==t?`${e} only support ${t} elevation mode`:null}function T(e,t,r){return r?.mode===t?`${e} do not support ${t} elevation mode`:null}function M(e,t){return null!=t?.featureExpressionInfo&&"0"!==t.featureExpressionInfo.expression?`${e} do not support featureExpressionInfo`:null}function A(e,t){t&&e.warn(".elevationInfo=",t)}function C(e){return(e?.offset??0)*(0,n.Ao)(e?.unit)}const E={mode:"absolute-height",offset:0},R={mode:"on-the-ground",offset:null}},31111:(e,t,r)=>{"use strict";r.d(t,{Qf:()=>s,Vd:()=>n,Vo:()=>c,lC:()=>a});var i=r(81806);const n=()=>!!(0,i.A)("enable-feature:force-wosr"),s=()=>!!(0,i.A)("enable-feature:direct-3d-object-feature-layer-display"),o=()=>i.A.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),a=()=>!!(0,i.A)("enable-i3s-patching"),l=()=>i.A.add("enable-i3s-patching",!1,!0,!0),c=()=>!!(0,i.A)("enable-feature:SceneLayer-editing");!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"i3s-patching";switch(l(),o(),i.A.add("enable-feature:SceneLayer-editing",!0,!0,!0),e){case"feature-layer-view":i.A.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0);break;case"i3s-patching":i.A.add("enable-i3s-patching",!0,!0,!0)}}("i3s-patching")},30973:(e,t,r)=>{"use strict";r.d(t,{tn:()=>c});var i=r(16868),n=r(53430),s=r(75900),o=(r(56362),r(87015),r(81940),r(6929)),a=(r(7198),r(93616),r(53539),r(40585)),l=r(17542);function c(e,t){let{displayField:r,editFieldsInfo:a,fields:l,objectIdField:c,title:u}=e;if(!l)return null;const h=d({editFieldsInfo:a,fields:l,objectIdField:c},t);if(!h.length)return null;const p=function(e){const t=(0,n.mB)(e),{titleBase:r}=e;return t?`${r}: {${t.trim()}}`:r??""}({titleBase:u,fields:l,displayField:r}),f=[new o.A,new s.A];return new i.A({title:p,content:f,fieldInfos:h})}const u=(e,t)=>t.visibleFieldNames?t.visibleFieldNames.has(e.name):(0,n.Bz)(e,t);function h(e,t){return"oid"===e.type?-1:"oid"===t.type?1:f(e)?-1:f(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function d(e,t){const r=t?.visibleFieldNames;return function(e,t){const r=e;return t&&(e=e.filter((e=>!t.includes(e.type)))),e===r&&(e=e.slice()),e.sort(h),e}(e.fields??[],t?.ignoreFieldTypes||m).map((t=>new a.A({fieldName:t.name,isEditable:(0,n.R$)(t,e),label:t.alias,format:p(t),visible:u(t,{...e,visibleFieldNames:r})})))}function p(e){switch(e.type){case"small-integer":case"integer":case"single":return new l.A({digitSeparator:!0,places:0});case"double":return new l.A({digitSeparator:!0,places:2});case"string":return(0,n.JL)(e.name)?new l.A({digitSeparator:!0,places:0}):void 0;default:return}}function f(e){if("name"===(e.name&&e.name.toLowerCase()))return!0;const t=e.alias?.toLowerCase();return"name"===t}const m=["geometry","blob","raster","guid","xml"]},49003:(e,t,r)=>{"use strict";r.d(t,{D:()=>n});var i=r(3825);async function n(e,t){const{data:r}=await(0,i.A)(e,{responseType:"image",...t});return r}},76312:(e,t,r)=>{"use strict";r.d(t,{Sx:()=>a,c8:()=>h,m3:()=>f,ql:()=>u,tz:()=>d,xW:()=>p});var i=r(86560),n=r(81806),s=r(50346),o=r(90534);function a(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;return new Promise(((o,a)=>{if((0,s.G4)(i))return void a(l());let c=()=>{d(),a(new Error(`Unable to load ${t}`))},u=()=>{const t=e;d(),o(t)},h=()=>{if(!e)return;const t=e;d(),t.src="",a(l())};const d=()=>{(0,n.A)("esri-image-decode")||(e.removeEventListener("error",c),e.removeEventListener("load",u)),c=null,u=null,e=null,null!=i&&i.removeEventListener("abort",h),h=null,r&&URL.revokeObjectURL(t)};null!=i&&i.addEventListener("abort",h),(0,n.A)("esri-image-decode")?e.decode().then(u,c):(e.addEventListener("error",c),e.addEventListener("load",u))}))}function l(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}const c="Timeout exceeded";function u(){return new Error(c)}function h(e){return"object"==typeof e&&!!e&&"message"in e&&e.message===c}function d(e){i.A.request.crossOriginNoCorsDomains||(i.A.request.crossOriginNoCorsDomains={});const t=i.A.request.crossOriginNoCorsDomains;for(let r of e)r=r.toLowerCase(),/^https?:\/\//.test(r)?t[(0,o.$z)(r)??""]=0:(t[(0,o.$z)("http://"+r)??""]=0,t[(0,o.$z)("https://"+r)??""]=0)}function p(e){const t=i.A.request.crossOriginNoCorsDomains;if(t){let r=(0,o.$z)(e);if(r)return r=r.toLowerCase(),!(0,o.FX)(r,(0,o.Xq)())&&t[r]<Date.now()-36e5}return!1}async function f(e){const t=i.A.request.crossOriginNoCorsDomains,r=(0,o.$z)(e);t&&r&&(t[r.toLowerCase()]=Date.now());const n=(0,o.An)(e);e=n.path,"json"===n.query?.f&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}},80483:(e,t,r)=>{"use strict";r.d(t,{$:()=>i,u:()=>n});const i="20240724",n="ac51c09e1d17be02f839eb2e22bd05fd7a16c2d3"},91896:(e,t,r)=>{"use strict";r.d(t,{fJ:()=>s,g4:()=>n,hY:()=>o});const i="calcite-mode-";function n(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"").startsWith("dark")}function s(){return`${i}${n()?"dark":"light"}`}function o(e){a(e),e.classList.add(s())}function a(e){Array.from(e.classList).forEach((t=>{t.startsWith(i)&&e.classList.remove(t)}))}},95444:(e,t,r)=>{"use strict";r.d(t,{dp:()=>B,$y:()=>R,wk:()=>P,Y7:()=>L,wC:()=>I,Ac:()=>N,Bu:()=>F,Es:()=>O,q8:()=>D,em:()=>z,Rv:()=>V,xK:()=>k,On:()=>U});var i,n=r(40565),s=r(7982),o=r(89465),a=(r(31671),r(48313)),l=(r(84847),r(61425),r(27796),r(16911)),c=r(34913),u=(r(22189),r(71706),r(94918)),h=(r(47943),r(54347),r(35143)),d=r(53084),p=r(76931),f=r(46053),m=(r(81806),r(76460),r(6409)),g=r(85842),y=r(94446);let _=i=class extends a.A{constructor(){super(...arguments),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,r,i){if(e&&"string"!=typeof e&&null==e.imageData)return e;const n={};return e&&(n.url=e),t&&(n.outline=t),null!=r&&(n.width=(0,p.cr)(r)),null!=i&&(n.height=(0,p.cr)(i)),n}clone(){const e=new i({color:(0,d.o8)(this.color),height:this.height,outline:(0,d.o8)(this.outline),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",(0,d.o8)(this.source)),e}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};(0,h._)([(0,m.e)({esriPFS:"picture-fill"},{readOnly:!0})],_.prototype,"type",void 0),(0,h._)([(0,f.MZ)(y.ku)],_.prototype,"url",void 0),(0,h._)([(0,f.MZ)({type:Number,json:{write:!0}})],_.prototype,"xscale",void 0),(0,h._)([(0,f.MZ)({type:Number,json:{write:!0}})],_.prototype,"yscale",void 0),(0,h._)([(0,f.MZ)({type:Number,cast:p.cr,json:{write:!0}})],_.prototype,"width",void 0),(0,h._)([(0,f.MZ)({type:Number,cast:p.cr,json:{write:!0}})],_.prototype,"height",void 0),(0,h._)([(0,f.MZ)({type:Number,cast:p.cr,json:{write:!0}})],_.prototype,"xoffset",void 0),(0,h._)([(0,f.MZ)({type:Number,cast:p.cr,json:{write:!0}})],_.prototype,"yoffset",void 0),(0,h._)([(0,f.MZ)(y.k7)],_.prototype,"source",void 0),_=i=(0,h._)([(0,g.$)("esri.symbols.PictureFillSymbol")],_);const v=_;var b=r(27410),w=r(37471),x=r(74343),S=r(86875),T=r(7246),M=r(76940),A=r(25900),C=(r(78135),r(38582),r(86659)),E=(r(21405),r(51317),r(89579));r(92135),r(68905);function R(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function P(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const O={base:A.A,key:"type",typeMap:{"simple-fill":S.A,"picture-fill":v,"picture-marker":b.A,"simple-line":T.A,"simple-marker":M.A,text:C.A,"label-3d":l.A,"line-3d":c.A,"mesh-3d":u.A,"point-3d":w.A,"polygon-3d":x.A,"web-style":E.A,cim:o.A},errorContext:"symbol"},I={base:A.A,key:"type",typeMap:{"picture-marker":b.A,"simple-marker":M.A,"point-3d":w.A,cim:o.A},errorContext:"symbol"},L={base:A.A,key:"type",typeMap:{"simple-line":T.A,"line-3d":c.A,cim:o.A},errorContext:"symbol"},N={base:A.A,key:"type",typeMap:{"simple-fill":S.A,"picture-fill":v,"polygon-3d":x.A,cim:o.A},errorContext:"symbol"},D={base:A.A,key:"type",typeMap:{"picture-marker":b.A,"simple-marker":M.A,text:C.A,"web-style":E.A,cim:o.A},errorContext:"symbol"},F=(0,s.C)({types:O}),k={base:A.A,key:"type",typeMap:{"simple-fill":S.A,"picture-fill":v,"picture-marker":b.A,"simple-line":T.A,"simple-marker":M.A,text:C.A,"line-3d":c.A,"mesh-3d":u.A,"point-3d":w.A,"polygon-3d":x.A,"web-style":E.A,cim:o.A},errorContext:"symbol"},z={base:A.A,key:"type",typeMap:{text:C.A,"label-3d":l.A},errorContext:"symbol"},U=(A.A,l.A,c.A,u.A,w.A,x.A,E.A,{base:A.A,key:"type",typeMap:{"line-3d":c.A,"mesh-3d":u.A,"point-3d":w.A,"polygon-3d":x.A,"web-style":E.A,cim:o.A},errorContext:"symbol"}),V={base:A.A,key:"type",typeMap:{"label-3d":l.A},errorContext:"symbol"},B=(0,n.aq)(O)},89465:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var i,n=r(35143),s=r(53084),o=r(88685),a=r(46053),l=(r(81806),r(76460),r(6409)),c=r(28379),u=r(85842),h=r(17707),d=r(53430),p=r(25900);let f=i=class extends p.A{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){Object.assign(t,e)}async collectRequiredFields(e,t){if("CIMSymbolReference"===this.data?.type){const r=this.data.primitiveOverrides;if(r){const i=r.map((r=>{const i=r.valueExpressionInfo;return i?(0,d.Dx)(e,t,i.expression):null}));await Promise.all(i)}}}clone(){return new i({data:(0,s.o8)(this.data)})}hash(){return(0,o.Wm)(JSON.stringify(this.data)).toString()}};(0,n._)([(0,a.MZ)({json:{write:!1}})],f.prototype,"color",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],f.prototype,"data",void 0),(0,n._)([(0,c.w)("data",["symbol"])],f.prototype,"readData",null),(0,n._)([(0,h.K)("data",{})],f.prototype,"writeData",null),(0,n._)([(0,l.e)({CIMSymbolReference:"cim"},{readOnly:!0})],f.prototype,"type",void 0),f=i=(0,n._)([(0,u.$)("esri.symbols.CIMSymbol")],f);const m=f},31671:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(6409)),a=r(85842),l=r(38582),c=r(73572),u=r(9994);let h=i=class extends l.A{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new i({edges:this.edges?.clone(),enabled:this.enabled,material:this.material?.clone(),castShadows:this.castShadows,size:this.size})}};(0,n._)([(0,o.e)({Extrude:"extrude"},{readOnly:!0})],h.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],h.prototype,"size",void 0),(0,n._)([(0,s.MZ)({type:u.N,json:{write:!0}})],h.prototype,"material",void 0),(0,n._)([(0,s.MZ)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],h.prototype,"castShadows",void 0),(0,n._)([(0,s.MZ)(c.J)],h.prototype,"edges",void 0),h=i=(0,n._)([(0,a.$)("esri.symbols.ExtrudeSymbol3DLayer")],h);const d=h},48313:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i=r(35143),n=r(46053),s=(r(81806),r(76460),r(47249),r(85842)),o=r(7246),a=r(25900);let l=class extends a.A{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline?.hash()}`}};(0,i._)([(0,n.MZ)({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":o.A}},json:{default:null,write:!0}})],l.prototype,"outline",void 0),(0,i._)([(0,n.MZ)({type:["simple-fill","picture-fill"],readOnly:!0})],l.prototype,"type",void 0),l=(0,i._)([(0,s.$)("esri.symbols.FillSymbol")],l);const c=l},84847:(e,t,r)=>{"use strict";r.d(t,{A:()=>M});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(6409)),a=r(85842),l=r(38582),c=r(73572),u=r(34870),h=r(91441),d=r(80669),p=r(39196),f=(r(50076),r(9994));let m=i=class extends f.N{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:null!=this.color?this.color.clone():null,colorMixMode:this.colorMixMode};return new i(e)}};(0,n._)([(0,o.e)({multiply:"multiply",replace:"replace",tint:"tint"})],m.prototype,"colorMixMode",void 0),m=i=(0,n._)([(0,a.$)("esri.symbols.support.Symbol3DFillMaterial")],m);var g,y=r(69539),_=r(42553),v=r(76931),b=r(85192),w=r(72733);let x=g=class extends _.oY{constructor(e){super(e),this.color=new y.A([0,0,0,1]),this.size=(0,v.PN)(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:null!=this.color?this.color.clone():null,size:this.size,pattern:null!=this.pattern?this.pattern.clone():null,patternCap:this.patternCap};return new g(e)}};var S;(0,n._)([(0,s.MZ)(b.E)],x.prototype,"color",void 0),(0,n._)([(0,s.MZ)(b.p)],x.prototype,"size",void 0),(0,n._)([(0,s.MZ)(d.v)],x.prototype,"pattern",void 0),(0,n._)([(0,s.MZ)({type:w.M4,json:{default:"butt",write:{overridePolicy(){return{enabled:null!=this.pattern}}}}})],x.prototype,"patternCap",void 0),x=g=(0,n._)([(0,a.$)("esri.symbols.support.Symbol3DOutline")],x);let T=S=class extends l.A{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:null!=this.edges?this.edges.clone():null,enabled:this.enabled,material:null!=this.material?this.material.clone():null,pattern:null!=this.pattern?this.pattern.clone():null,castShadows:this.castShadows,outline:null!=this.outline?this.outline.clone():null};return new S(e)}static fromSimpleFillSymbol(e){const t=e.outline&&e.outline.style&&"solid"!==e.outline.style?new u.A({style:e.outline.style}):null,r={size:e.outline?.width??0,color:(e.outline?.color??p.ON).clone(),pattern:t};return t&&e.outline?.cap&&(r.patternCap=e.outline.cap),new S({material:new m({color:(e.color??p.u7).clone()}),pattern:e.style&&"solid"!==e.style?new h.A({style:e.style}):null,outline:r})}};(0,n._)([(0,o.e)({Fill:"fill"},{readOnly:!0})],T.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:m,json:{write:!0}})],T.prototype,"material",void 0),(0,n._)([(0,s.MZ)(d.r)],T.prototype,"pattern",void 0),(0,n._)([(0,s.MZ)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],T.prototype,"castShadows",void 0),(0,n._)([(0,s.MZ)({type:x,json:{write:!0}})],T.prototype,"outline",void 0),(0,n._)([(0,s.MZ)(c.J)],T.prototype,"edges",void 0),T=S=(0,n._)([(0,a.$)("esri.symbols.FillSymbol3DLayer")],T);const M=T},61425:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i,n=r(35143),s=r(42553),o=r(76931),a=r(46053),l=r(21403),c=(r(47249),r(81806),r(85842)),u=r(27790);let h=i=class extends s.oY{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return(0,o.cr)(e)}clone(){return new i({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};(0,n._)([(0,a.MZ)({type:u.h9,json:{default:"none",write:!0}})],h.prototype,"decoration",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],h.prototype,"family",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.textSymbol3D})}}})],h.prototype,"size",void 0),(0,n._)([(0,l.w)("size")],h.prototype,"castSize",null),(0,n._)([(0,a.MZ)({type:u._R,json:{default:"normal",write:!0}})],h.prototype,"style",void 0),(0,n._)([(0,a.MZ)({type:u.NM,json:{default:"normal",write:!0}})],h.prototype,"weight",void 0),h=i=(0,n._)([(0,c.$)("esri.symbols.Font")],h);const d=h},27796:(e,t,r)=>{"use strict";r.d(t,{A:()=>T});var i,n=r(35143),s=r(53084),o=r(76460),a=r(90534),l=r(46053),c=(r(81806),r(6409)),u=r(85842),h=r(38582),d=r(39196),p=r(76589),f=r(85192),m=r(93223),g=r(69539),y=r(42553),_=r(76931);r(47249);let v=i=class extends y.oY{constructor(e){super(e),this.color=new g.A([0,0,0,1]),this.size=(0,_.PN)(1)}clone(){const e={color:null!=this.color?this.color.clone():null,size:this.size};return new i(e)}};(0,n._)([(0,l.MZ)(f.E)],v.prototype,"color",void 0),(0,n._)([(0,l.MZ)(f.p)],v.prototype,"size",void 0),v=i=(0,n._)([(0,u.$)("esri.symbols.support.Symbol3DIconOutline")],v);var b,w=r(9994);const x="esri.symbols.IconSymbol3DLayer";let S=b=class extends h.A{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new b({anchor:this.anchor,anchorPosition:(0,s.o8)(this.anchorPosition),enabled:this.enabled,material:(0,s.o8)(this.material),outline:(0,s.o8)(this.outline),resource:(0,s.o8)(this.resource),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||d.ON,r=M(e),i=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||d.ON).clone()}:null;return new b({size:e.size,resource:{primitive:E(e.style)},material:{color:t},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(e){const t=!e.color||(0,d.U9)(e.color)?d.ON:e.color,r=M(e);return new b({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(e){return new b({resource:{href:(0,a.Hg)({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};(0,n._)([(0,l.MZ)({type:w.N,json:{write:!0}})],S.prototype,"material",void 0),(0,n._)([(0,l.MZ)({type:p.i,json:{write:!0}})],S.prototype,"resource",void 0),(0,n._)([(0,c.e)({Icon:"icon"},{readOnly:!0})],S.prototype,"type",void 0),(0,n._)([(0,l.MZ)(f.p)],S.prototype,"size",void 0),(0,n._)([(0,c.e)({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),(0,l.MZ)({json:{default:"center"}})],S.prototype,"anchor",void 0),(0,n._)([(0,l.MZ)({type:m.Q,json:{type:[Number],read:{reader:e=>new m.Q({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],S.prototype,"anchorPosition",void 0),(0,n._)([(0,l.MZ)({type:v,json:{write:!0}})],S.prototype,"outline",void 0),S=b=(0,n._)([(0,u.$)(x)],S);const T=S;function M(e){const t="width"in e?e.width:e.size,r="height"in e?e.height:e.size,i=A(e.xoffset),n=A(e.yoffset);return(i||n)&&t&&r?{x:-i/t,y:n/r}:null}function A(e){return isFinite(e)?e:0}const C={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function E(e){return C[e]||(o.A.getLogger(x).warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}},16911:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var i,n=r(35143),s=r(19276),o=r(53084),a=r(46053),l=(r(81806),r(76460),r(6409)),c=r(85842),u=r(78135),h=r(21405),d=r(82041),p=r(48670);const f=s.A.ofType({base:null,key:"type",typeMap:{text:h.A}});let m=i=class extends u.A{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new f,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return(0,d.LH)(this)}hasVisibleVerticalOffset(){return(0,d.Yq)(this)}clone(){return new i({styleOrigin:(0,o.o8)(this.styleOrigin),symbolLayers:(0,o.o8)(this.symbolLayers),thumbnail:(0,o.o8)(this.thumbnail),callout:(0,o.o8)(this.callout),verticalOffset:(0,o.o8)(this.verticalOffset)})}static fromTextSymbol(e){return new i({symbolLayers:new s.A([h.A.fromTextSymbol(e)])})}};(0,n._)([(0,a.MZ)({type:p.A,json:{write:!0}})],m.prototype,"verticalOffset",void 0),(0,n._)([(0,a.MZ)(d.oG)],m.prototype,"callout",void 0),(0,n._)([(0,a.MZ)({json:{read:!1,write:!1}})],m.prototype,"styleOrigin",void 0),(0,n._)([(0,a.MZ)({type:f})],m.prototype,"symbolLayers",void 0),(0,n._)([(0,l.e)({LabelSymbol3D:"label-3d"},{readOnly:!0})],m.prototype,"type",void 0),m=i=(0,n._)([(0,c.$)("esri.symbols.LabelSymbol3D")],m);const g=m},34913:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var i,n=r(35143),s=r(19276),o=r(53084),a=r(46053),l=(r(81806),r(76460),r(6409)),c=r(85842),u=r(22189),h=r(54347),d=r(78135);const p=s.A.ofType({base:null,key:"type",typeMap:{line:u.A,path:h.A}}),f=s.A.ofType({base:null,key:"type",typeMap:{line:u.A,path:h.A}});let m=i=class extends d.A{constructor(e){super(e),this.symbolLayers=new p,this.type="line-3d"}clone(){return new i({styleOrigin:(0,o.o8)(this.styleOrigin),symbolLayers:(0,o.o8)(this.symbolLayers),thumbnail:(0,o.o8)(this.thumbnail)})}static fromSimpleLineSymbol(e){return new i({symbolLayers:new s.A([u.A.fromSimpleLineSymbol(e)])})}};(0,n._)([(0,a.MZ)({type:p,json:{type:f}})],m.prototype,"symbolLayers",void 0),(0,n._)([(0,l.e)({LineSymbol3D:"line-3d"},{readOnly:!0})],m.prototype,"type",void 0),m=i=(0,n._)([(0,c.$)("esri.symbols.LineSymbol3D")],m);const g=m},22189:(e,t,r)=>{"use strict";r.d(t,{A:()=>T});var i=r(35143),n=r(76931),s=r(46053),o=(r(81806),r(76460),r(47249),r(6409)),a=r(85842),l=r(69539),c=r(69098),u=r(42553),h=r(40565),d=r(62571);let p=class extends((0,c.O)(u.oY)){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return null!=e&&e.placement===this.placement&&e.style===this.style&&(null==this.color&&null==e.color||null!=this.color&&null!=e.color&&this.color.toJSON()===e.color.toJSON())}};(0,i._)([(0,s.MZ)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],p.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:d.x,json:{default:"begin-end",write:!0}})],p.prototype,"placement",void 0),(0,i._)([(0,s.MZ)({type:d.z,json:{default:"arrow",write:!0}})],p.prototype,"style",void 0),(0,i._)([(0,s.MZ)({type:l.A,json:{type:[h.jz],default:null,write:!0}})],p.prototype,"color",void 0),p=(0,i._)([(0,a.$)("esri.symbols.LineStyleMarker3D")],p);const f=p;var m,g=r(38582),y=r(34870),_=r(80669),v=r(39196),b=r(85192),w=r(9994),x=r(72733);let S=m=class extends g.A{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=(0,n.PN)(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:null!=this.material?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:null!=this.pattern?this.pattern.clone():null,marker:null!=this.marker?this.marker.clone():null};return new m(e)}static fromSimpleLineSymbol(e){const t={enabled:!0,size:e.width??(0,n.PN)(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style?new y.A({style:e.style}):null,material:new w.N({color:(e.color||v.ON).clone()}),marker:e.marker?new f({placement:e.marker.placement,style:e.marker.style,color:e.marker.color?.clone()??null}):null};return new m(t)}};(0,i._)([(0,s.MZ)({type:w.N,json:{write:!0}})],S.prototype,"material",void 0),(0,i._)([(0,o.e)({Line:"line"},{readOnly:!0})],S.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:x.e,json:{write:!0,default:"miter"}})],S.prototype,"join",void 0),(0,i._)([(0,s.MZ)({type:x.M4,json:{write:!0,default:"butt"}})],S.prototype,"cap",void 0),(0,i._)([(0,s.MZ)(b.p)],S.prototype,"size",void 0),(0,i._)([(0,s.MZ)(_.v)],S.prototype,"pattern",void 0),(0,i._)([(0,s.MZ)({types:{key:"type",base:f,typeMap:{style:f}},json:{write:!0}})],S.prototype,"marker",void 0),S=m=(0,i._)([(0,a.$)("esri.symbols.LineSymbol3DLayer")],S);const T=S},71706:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i=r(35143),n=r(76931),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(25900);let l=class extends a.A{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};(0,i._)([(0,s.MZ)({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],l.prototype,"angle",void 0),(0,i._)([(0,s.MZ)({type:["simple-marker","picture-marker"],readOnly:!0})],l.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:Number,cast:n.cr,json:{write:!0}})],l.prototype,"xoffset",void 0),(0,i._)([(0,s.MZ)({type:Number,cast:n.cr,json:{write:!0}})],l.prototype,"yoffset",void 0),(0,i._)([(0,s.MZ)({type:Number,cast:e=>"auto"===e?e:(0,n.cr)(e),json:{write:!0}})],l.prototype,"size",void 0),l=(0,i._)([(0,o.$)("esri.symbols.MarkerSymbol")],l);const c=l},94918:(e,t,r)=>{"use strict";r.d(t,{A:()=>f});var i,n=r(35143),s=r(19276),o=r(53084),a=r(46053),l=(r(81806),r(76460),r(6409)),c=r(85842),u=r(84847),h=r(78135);const d=s.A.ofType({base:null,key:"type",typeMap:{fill:u.A}});let p=i=class extends h.A{constructor(e){super(e),this.symbolLayers=new d,this.type="mesh-3d"}clone(){return new i({styleOrigin:(0,o.o8)(this.styleOrigin),symbolLayers:(0,o.o8)(this.symbolLayers),thumbnail:(0,o.o8)(this.thumbnail)})}static fromSimpleFillSymbol(e){return new i({symbolLayers:new s.A([u.A.fromSimpleFillSymbol(e)])})}};(0,n._)([(0,a.MZ)({type:d})],p.prototype,"symbolLayers",void 0),(0,n._)([(0,l.e)({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],p.prototype,"type",void 0),p=i=(0,n._)([(0,c.$)("esri.symbols.MeshSymbol3D")],p);const f=p},47943:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(6409)),a=r(85842),l=r(38582),c=r(47675),u=r(91967);let h=i=class extends u.A{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new i({x:this.x,y:this.y,z:this.z})}};(0,n._)([(0,s.MZ)({type:Number})],h.prototype,"x",void 0),(0,n._)([(0,s.MZ)({type:Number})],h.prototype,"y",void 0),(0,n._)([(0,s.MZ)({type:Number})],h.prototype,"z",void 0),h=i=(0,n._)([(0,a.$)("esri.symbols.support.Symbol3DAnchorPosition3D")],h);var d,p=r(9994);let f=d=class extends l.A{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new d({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition?.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material?.clone()??null,castShadows:this.castShadows,resource:this.resource?.clone(),width:this.width})}get isPrimitive(){return!this.resource||"string"!=typeof this.resource.href}};(0,n._)([(0,s.MZ)({type:p.N,json:{write:!0}})],f.prototype,"material",void 0),(0,n._)([(0,s.MZ)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],f.prototype,"castShadows",void 0),(0,n._)([(0,s.MZ)({type:c.E,json:{write:!0}})],f.prototype,"resource",void 0),(0,n._)([(0,o.e)({Object:"object"},{readOnly:!0})],f.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:Number,json:{write:!0}})],f.prototype,"width",void 0),(0,n._)([(0,s.MZ)({type:Number,json:{write:!0}})],f.prototype,"height",void 0),(0,n._)([(0,s.MZ)({type:Number,json:{write:!0}})],f.prototype,"depth",void 0),(0,n._)([(0,o.e)({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),(0,s.MZ)({json:{default:"origin"}})],f.prototype,"anchor",void 0),(0,n._)([(0,s.MZ)({type:h,json:{type:[Number],read:{reader:e=>new h({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],f.prototype,"anchorPosition",void 0),(0,n._)([(0,s.MZ)({type:Number,json:{write:!0}})],f.prototype,"heading",void 0),(0,n._)([(0,s.MZ)({type:Number,json:{write:!0}})],f.prototype,"tilt",void 0),(0,n._)([(0,s.MZ)({type:Number,json:{write:!0}})],f.prototype,"roll",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],f.prototype,"isPrimitive",null),f=d=(0,n._)([(0,a.$)("esri.symbols.ObjectSymbol3DLayer")],f);const m=f},54347:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var i,n=r(35143),s=r(46053),o=(r(81806),r(76460),r(47249),r(6409)),a=r(28379),l=r(85842),c=r(38582),u=r(9994),h=r(72733);let d=i=class extends c.A{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return null!=e?e:null==t.height&&null!=t.size?t.size:void 0}readHeight(e,t){return null!=e?e:null==t.width&&null!=t.size?t.size:void 0}clone(){return new i({enabled:this.enabled,material:null!=this.material?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};(0,n._)([(0,s.MZ)({type:u.N,json:{write:!0}})],d.prototype,"material",void 0),(0,n._)([(0,s.MZ)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],d.prototype,"castShadows",void 0),(0,n._)([(0,o.e)({Path:"path"},{readOnly:!0})],d.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:["circle","quad"],json:{write:!0,default:"circle"}})],d.prototype,"profile",void 0),(0,n._)([(0,s.MZ)({type:h.e,json:{write:!0,default:"miter"}})],d.prototype,"join",void 0),(0,n._)([(0,s.MZ)({type:h.Nv,json:{write:!0,default:"butt"}})],d.prototype,"cap",void 0),(0,n._)([(0,s.MZ)({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],d.prototype,"width",void 0),(0,n._)([(0,a.w)("width",["width","size","height"])],d.prototype,"readWidth",null),(0,n._)([(0,s.MZ)({type:Number,json:{write:!0}})],d.prototype,"height",void 0),(0,n._)([(0,a.w)("height",["height","size","width"])],d.prototype,"readHeight",null),(0,n._)([(0,s.MZ)({type:["center","bottom","top"],json:{write:!0,default:"center"}})],d.prototype,"anchor",void 0),(0,n._)([(0,s.MZ)({type:["heading","all"],json:{write:!0,default:"all"}})],d.prototype,"profileRotation",void 0),d=i=(0,n._)([(0,l.$)("esri.symbols.PathSymbol3DLayer")],d);const p=d},27410:(e,t,r)=>{"use strict";r.d(t,{A:()=>f});var i,n=r(35143),s=r(53084),o=r(76931),a=r(46053),l=(r(81806),r(76460),r(6409)),c=r(28379),u=r(85842),h=r(71706),d=r(94446);let p=i=class extends h.A{constructor(){super(...arguments),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,r){if(e&&"string"!=typeof e&&null==e.imageData)return e;const i={};return e&&(i.url=e),null!=t&&(i.width=(0,o.cr)(t)),null!=r&&(i.height=(0,o.cr)(r)),i}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new i({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",(0,s.o8)(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};(0,n._)([(0,a.MZ)({json:{write:!1}})],p.prototype,"color",void 0),(0,n._)([(0,l.e)({esriPMS:"picture-marker"},{readOnly:!0})],p.prototype,"type",void 0),(0,n._)([(0,a.MZ)(d.ku)],p.prototype,"url",void 0),(0,n._)([(0,a.MZ)(d.k7)],p.prototype,"source",void 0),(0,n._)([(0,a.MZ)({type:Number,cast:o.cr,json:{write:!0}})],p.prototype,"height",void 0),(0,n._)([(0,c.w)("height",["height","size"])],p.prototype,"readHeight",null),(0,n._)([(0,a.MZ)({type:Number,cast:o.cr,json:{write:!0}})],p.prototype,"width",void 0),(0,n._)([(0,a.MZ)({json:{write:!1}})],p.prototype,"size",void 0),p=i=(0,n._)([(0,u.$)("esri.symbols.PictureMarkerSymbol")],p);const f=p},37471:(e,t,r)=>{"use strict";r.d(t,{A:()=>b});var i,n=r(35143),s=r(69539),o=r(19276),a=r(53084),l=r(46053),c=(r(81806),r(76460),r(6409)),u=r(85842),h=r(27796),d=r(47943),p=r(78135),f=r(21405),m=r(82041),g=r(92135),y=r(48670);const _=o.A.ofType({base:null,key:"type",typeMap:{icon:h.A,object:d.A,text:f.A}});let v=i=class extends p.A{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new _,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return(0,m.LH)(this)}hasVisibleVerticalOffset(){return(0,m.Yq)(this)}clone(){return new i({verticalOffset:(0,a.o8)(this.verticalOffset),callout:(0,a.o8)(this.callout),styleOrigin:(0,a.o8)(this.styleOrigin),symbolLayers:(0,a.o8)(this.symbolLayers),thumbnail:(0,a.o8)(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new i({symbolLayers:new o.A([h.A.fromSimpleMarkerSymbol(e)])})}static fromPictureMarkerSymbol(e){return new i({symbolLayers:new o.A([h.A.fromPictureMarkerSymbol(e)])})}static fromCIMSymbol(e){const t=e.data?.symbol?.type;if("CIMPointSymbol"!==t)return null;const r=e.data.symbol;return new i(r?.callout?{symbolLayers:new o.A([h.A.fromCIMSymbol(e)]),callout:new g.A({size:.5,color:new s.A([0,0,0])}),verticalOffset:new y.A({screenLength:40})}:{symbolLayers:new o.A([h.A.fromCIMSymbol(e)])})}static fromTextSymbol(e){return new i({symbolLayers:new o.A([f.A.fromTextSymbol(e)])})}};(0,n._)([(0,l.MZ)({type:y.A,json:{write:!0}})],v.prototype,"verticalOffset",void 0),(0,n._)([(0,l.MZ)(m.oG)],v.prototype,"callout",void 0),(0,n._)([(0,l.MZ)({type:_,json:{origins:{"web-scene":{write:!0}}}})],v.prototype,"symbolLayers",void 0),(0,n._)([(0,c.e)({PointSymbol3D:"point-3d"},{readOnly:!0})],v.prototype,"type",void 0),v=i=(0,n._)([(0,u.$)("esri.symbols.PointSymbol3D")],v);const b=v},74343:(e,t,r)=>{"use strict";r.d(t,{A:()=>S});var i,n=r(35143),s=r(19276),o=r(63241),a=r(53084),l=r(76460),c=r(68134),u=r(46053),h=(r(81806),r(6409)),d=r(85842),p=r(31671),f=r(84847),m=r(27796),g=r(22189),y=r(47943),_=r(78135),v=r(21405),b=r(51317);const w=s.A.ofType({base:null,key:"type",typeMap:{extrude:p.A,fill:f.A,icon:m.A,line:g.A,object:y.A,text:v.A,water:b.A}});let x=i=class extends _.A{constructor(e){super(e),this.symbolLayers=new w,this.type="polygon-3d"}initialize(){const e=e=>{"line"===e.type&&(0,o.io)(l.A.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),"text"===e.type&&(0,o.io)(l.A.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const t of this.symbolLayers)e(t);this.addHandles((0,c.on)((()=>this.symbolLayers),"after-add",(t=>{let{item:r}=t;return e(r)}),c.OH))}clone(){return new i({styleOrigin:(0,a.o8)(this.styleOrigin),symbolLayers:(0,a.o8)(this.symbolLayers),thumbnail:(0,a.o8)(this.thumbnail)})}static fromJSON(e){const t=new i;if(t.read(e),2===t.symbolLayers.length&&"fill"===t.symbolLayers.at(0).type&&"line"===t.symbolLayers.at(1).type){const r=t.symbolLayers.at(0),i=t.symbolLayers.at(1);!i.enabled||e.symbolLayers?.[1]&&!1===e.symbolLayers[1].enable||(r.outline={size:i.size,color:null!=i.material?i.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new i({symbolLayers:new s.A([f.A.fromSimpleFillSymbol(e)])})}};(0,n._)([(0,u.MZ)({type:w,json:{write:!0}})],x.prototype,"symbolLayers",void 0),(0,n._)([(0,h.e)({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],x.prototype,"type",void 0),x=i=(0,n._)([(0,d.$)("esri.symbols.PolygonSymbol3D")],x);const S=x},86875:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var i,n=r(35143),s=r(69539),o=r(45802),a=r(53084),l=r(46053),c=(r(81806),r(76460),r(6409)),u=r(85842),h=r(48313),d=r(7246);const p=new o.J({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let f=i=class extends h.A{constructor(){super(...arguments),this.color=new s.A([0,0,0,.25]),this.outline=new d.A,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,r){if(e&&"string"!=typeof e)return e;const i={};return e&&(i.style=e),t&&(i.outline=t),r&&(i.color=r),i}clone(){return new i({color:(0,a.o8)(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};(0,n._)([(0,l.MZ)()],f.prototype,"color",void 0),(0,n._)([(0,l.MZ)()],f.prototype,"outline",void 0),(0,n._)([(0,c.e)({esriSFS:"simple-fill"},{readOnly:!0})],f.prototype,"type",void 0),(0,n._)([(0,l.MZ)({type:p.apiValues,json:{read:p.read,write:p.write}})],f.prototype,"style",void 0),f=i=(0,n._)([(0,u.$)("esri.symbols.SimpleFillSymbol")],f);const m=f},7246:(e,t,r)=>{"use strict";r.d(t,{A:()=>T});var i=r(35143),n=r(45802),s=r(53084),o=r(76931),a=r(46053),l=(r(81806),r(76460),r(6409)),c=r(85842),u=(r(47249),r(25900));let h=class extends u.A{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};(0,i._)([(0,l.e)({esriSLS:"simple-line"},{readOnly:!0})],h.prototype,"type",void 0),(0,i._)([(0,a.MZ)({type:Number,cast:o.cr,json:{write:!0}})],h.prototype,"width",void 0),h=(0,i._)([(0,c.$)("esri.symbols.LineSymbol")],h);const d=h;var p,f=r(69539),m=r(42553),g=r(28379),y=r(17707),_=r(62571);let v=p=class extends m.oY{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,r,i){t[r]="web-map"===i?.origin?"arrow":e}set color(e){this._set("color",e)}readColor(e){return null!=e?.[0]?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,r,i){"web-map"===i?.origin||(t[r]=e)}clone(){return new p({color:(0,s.o8)(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};(0,i._)([(0,a.MZ)({type:["begin","end","begin-end"],json:{write:!0}})],v.prototype,"placement",void 0),(0,i._)([(0,l.e)({"line-marker":"line-marker"},{readOnly:!0}),(0,a.MZ)({json:{origins:{"web-map":{write:!1}}}})],v.prototype,"type",void 0),(0,i._)([(0,a.MZ)({type:_.z})],v.prototype,"style",void 0),(0,i._)([(0,y.K)("style")],v.prototype,"writeStyle",null),(0,i._)([(0,a.MZ)({type:f.A,value:null,json:{write:{allowNull:!0}}})],v.prototype,"color",null),(0,i._)([(0,g.w)("color")],v.prototype,"readColor",null),(0,i._)([(0,y.K)("color")],v.prototype,"writeColor",null),v=p=(0,i._)([(0,c.$)("esri.symbols.LineSymbolMarker")],v);const b=v;var w;const x=new n.J({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let S=w=class extends d{constructor(){super(...arguments),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,r,i,n,s){if(e&&"string"!=typeof e)return e;const a={};return null!=e&&(a.style=e),null!=t&&(a.color=t),null!=r&&(a.width=(0,o.cr)(r)),null!=i&&(a.cap=i),null!=n&&(a.join=n),null!=s&&(a.miterLimit=(0,o.cr)(s)),a}clone(){return new w({color:(0,s.o8)(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};(0,i._)([(0,l.e)({esriSLS:"simple-line"},{readOnly:!0})],S.prototype,"type",void 0),(0,i._)([(0,a.MZ)({type:x.apiValues,json:{read:x.read,write:x.write}})],S.prototype,"style",void 0),(0,i._)([(0,a.MZ)({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,r)=>({enabled:"round"!==e&&null==r?.origin})}}})],S.prototype,"cap",void 0),(0,i._)([(0,a.MZ)({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,r)=>({enabled:"round"!==e&&null==r?.origin})}}})],S.prototype,"join",void 0),(0,i._)([(0,a.MZ)({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":b}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],S.prototype,"marker",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{read:!1,write:!1}})],S.prototype,"miterLimit",void 0),S=w=(0,i._)([(0,c.$)("esri.symbols.SimpleLineSymbol")],S);const T=S},76940:(e,t,r)=>{"use strict";r.d(t,{A:()=>y});var i,n=r(35143),s=r(69539),o=r(45802),a=r(53084),l=r(76931),c=r(46053),u=(r(81806),r(76460),r(6409)),h=r(85842),d=r(17707),p=r(71706),f=r(7246);const m=new o.J({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let g=i=class extends p.A{constructor(){super(...arguments),this.color=new s.A([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new f.A}normalizeCtorArgs(e,t,r,i){if(e&&"string"!=typeof e)return e;const n={};return e&&(n.style=e),null!=t&&(n.size=(0,l.cr)(t)),r&&(n.outline=r),i&&(n.color=i),n}writeColor(e,t){e&&"x"!==this.style&&"cross"!==this.style&&(t.color=e.toJSON()),null===e&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new i({angle:this.angle,color:(0,a.o8)(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};(0,n._)([(0,c.MZ)()],g.prototype,"color",void 0),(0,n._)([(0,d.K)("color")],g.prototype,"writeColor",null),(0,n._)([(0,u.e)({esriSMS:"simple-marker"},{readOnly:!0})],g.prototype,"type",void 0),(0,n._)([(0,c.MZ)()],g.prototype,"size",void 0),(0,n._)([(0,c.MZ)({type:m.apiValues,json:{read:m.read,write:m.write}})],g.prototype,"style",void 0),(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],g.prototype,"path",null),(0,n._)([(0,c.MZ)({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":f.A}},json:{default:null,write:!0}})],g.prototype,"outline",void 0),g=i=(0,n._)([(0,h.$)("esri.symbols.SimpleMarkerSymbol")],g);const y=g},25900:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var i=r(35143),n=r(69539),s=r(45802),o=r(42553),a=r(46053),l=(r(81806),r(76460),r(47249),r(28379)),c=r(85842);const u=new s.J({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let h=0,d=class extends o.oY{constructor(e){super(e),this.id="sym"+h++,this.type=null,this.color=new n.A([0,0,0,1])}readColor(e){return null!=e?.[0]?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};(0,i._)([(0,a.MZ)({type:u.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:u.write}}})],d.prototype,"type",void 0),(0,i._)([(0,a.MZ)({type:n.A,json:{write:{allowNull:!0}}})],d.prototype,"color",void 0),(0,i._)([(0,l.w)("color")],d.prototype,"readColor",null),d=(0,i._)([(0,c.$)("esri.symbols.Symbol")],d);const p=d},78135:(e,t,r)=>{"use strict";r.d(t,{A:()=>O});var i=r(35143),n=r(19276),s=r(3975),o=r(76460),a=r(90534),l=r(62754),c=r(46053),u=r(21403),h=(r(47249),r(81806),r(28379)),d=r(85842),p=r(17707),f=r(65308),m=r(79453),g=r(31671),y=r(84847),_=r(27796),v=r(22189),b=r(47943),w=r(54347),x=r(25900),S=r(38582),T=r(21405),M=r(51317),A=r(24141),C=r(25158);const E={icon:_.A,object:b.A,line:v.A,path:w.A,fill:y.A,extrude:g.A,text:T.A,water:M.A},R=n.A.ofType({base:S.A,key:"type",typeMap:E,errorContext:"symbol-layer"});let P=class extends x.A{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,r=t?.type,i=r||n.A;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.constructed&&o.A.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){(0,s.V)(e,this._get("symbolLayers"))}readStyleOrigin(e,t,r){if(e.styleUrl&&e.name){const t=(0,m.f)(e.styleUrl,r);return new A.A({styleUrl:t,name:e.name})}if(e.styleName&&e.name)return new A.A({portal:r?.portal||f.A.getDefault(),styleName:e.styleName,name:e.name});r?.messages&&r.messages.push(new l.A("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,t,r,i){if(e.styleUrl&&e.name){let r=(0,m.t)(e.styleUrl,i);(0,a.oP)(r)&&(r=(0,a.S8)(r)),t.styleOrigin={styleUrl:r,name:e.name}}else e.styleName&&e.name&&(e.portal&&i?.portal&&!(0,a.ut)(e.portal.restUrl,i.portal.restUrl)?i?.messages&&i.messages.push(new l.A("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof S.A||e&&E[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};(0,i._)([(0,c.MZ)({json:{read:!1,write:!1}})],P.prototype,"color",null),(0,i._)([(0,c.MZ)({type:R,nonNullable:!0,json:{write:!0}}),(0,u.w)(s.H)],P.prototype,"symbolLayers",null),(0,i._)([(0,c.MZ)({type:A.A})],P.prototype,"styleOrigin",void 0),(0,i._)([(0,h.w)("styleOrigin")],P.prototype,"readStyleOrigin",null),(0,i._)([(0,p.K)("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],P.prototype,"writeStyleOrigin",null),(0,i._)([(0,c.MZ)({type:C.V,json:{read:!1}})],P.prototype,"thumbnail",void 0),(0,i._)([(0,c.MZ)({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],P.prototype,"type",void 0),P=(0,i._)([(0,d.$)("esri.symbols.Symbol3D")],P);const O=P},38582:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i=r(35143),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842)),a=r(17707);let l=class extends n.oY{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,t,r){e||(t[r]=e)}};(0,i._)([(0,s.MZ)({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],l.prototype,"enabled",void 0),(0,i._)([(0,a.K)("enabled")],l.prototype,"writeEnabled",null),(0,i._)([(0,s.MZ)({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],l.prototype,"type",void 0),l=(0,i._)([(0,o.$)("esri.symbols.Symbol3DLayer")],l);const c=l},86659:(e,t,r)=>{"use strict";r.d(t,{A:()=>y});var i,n=r(35143),s=r(69539),o=r(53084),a=r(76931),l=r(46053),c=r(21403),u=r(6409),h=r(85842),d=r(17707),p=r(61425),f=r(25900),m=r(27790);let g=i=class extends f.A{constructor(){super(...arguments),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new p.A,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,r){if(e&&"string"!=typeof e)return e;const i={};return e&&(i.text=e),t&&(i.font=t),r&&(i.color=r),i}writeLineWidth(e,t,r,i){i&&"string"!=typeof i?i.origin:t[r]=e}castLineWidth(e){return(0,a.cr)(e)}writeLineHeight(e,t,r,i){i&&"string"!=typeof i?i.origin:t[r]=e}clone(){return new i({angle:this.angle,backgroundColor:(0,o.o8)(this.backgroundColor),borderLineColor:(0,o.o8)(this.borderLineColor),borderLineSize:this.borderLineSize,color:(0,o.o8)(this.color),font:this.font&&this.font.clone(),haloColor:(0,o.o8)(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};(0,n._)([(0,l.MZ)({type:s.A,json:{write:!0}})],g.prototype,"backgroundColor",void 0),(0,n._)([(0,l.MZ)({type:s.A,json:{write:!0}})],g.prototype,"borderLineColor",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0},cast:a.cr})],g.prototype,"borderLineSize",void 0),(0,n._)([(0,l.MZ)({type:p.A,json:{write:!0}})],g.prototype,"font",void 0),(0,n._)([(0,l.MZ)({...m.rM,json:{write:!0}})],g.prototype,"horizontalAlignment",void 0),(0,n._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],g.prototype,"kerning",void 0),(0,n._)([(0,l.MZ)({type:s.A,json:{write:!0}})],g.prototype,"haloColor",void 0),(0,n._)([(0,l.MZ)({type:Number,cast:a.cr,json:{write:!0}})],g.prototype,"haloSize",void 0),(0,n._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],g.prototype,"rightToLeft",void 0),(0,n._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],g.prototype,"rotated",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],g.prototype,"text",void 0),(0,n._)([(0,u.e)({esriTS:"text"},{readOnly:!0})],g.prototype,"type",void 0),(0,n._)([(0,l.MZ)({...m.x0,json:{write:!0}})],g.prototype,"verticalAlignment",void 0),(0,n._)([(0,l.MZ)({type:Number,cast:a.cr,json:{write:!0}})],g.prototype,"xoffset",void 0),(0,n._)([(0,l.MZ)({type:Number,cast:a.cr,json:{write:!0}})],g.prototype,"yoffset",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],g.prototype,"angle",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],g.prototype,"width",void 0),(0,n._)([(0,l.MZ)({type:Number})],g.prototype,"lineWidth",void 0),(0,n._)([(0,d.K)("lineWidth")],g.prototype,"writeLineWidth",null),(0,n._)([(0,c.w)("lineWidth")],g.prototype,"castLineWidth",null),(0,n._)([(0,l.MZ)(m.Tb)],g.prototype,"lineHeight",void 0),(0,n._)([(0,d.K)("lineHeight")],g.prototype,"writeLineHeight",null),g=i=(0,n._)([(0,h.$)("esri.symbols.TextSymbol")],g);const y=g},21405:(e,t,r)=>{"use strict";r.d(t,{A:()=>S});var i,n=r(35143),s=r(53084),o=r(46053),a=(r(81806),r(76460),r(6409)),l=r(85842),c=r(17707),u=r(61425),h=r(38582),d=r(85192),p=r(69539),f=r(42553);let m=i=class extends f.oY{constructor(){super(...arguments),this.color=new p.A([0,0,0,1]),this.size=0}clone(){const e={color:(0,s.o8)(this.color),size:this.size};return new i(e)}};(0,n._)([(0,o.MZ)(d.E)],m.prototype,"color",void 0),(0,n._)([(0,o.MZ)(d.p)],m.prototype,"size",void 0),m=i=(0,n._)([(0,l.$)("esri.symbols.support.Symbol3DHalo")],m);var g=r(9994),y=r(69098);r(47249);let _=class extends((0,y.O)(f.oY)){constructor(e){super(e),this.color=null}};(0,n._)([(0,o.MZ)(d.E)],_.prototype,"color",void 0),_=(0,n._)([(0,l.$)("esri.symbols.support.Symbol3DTextBackground")],_);var v,b=r(27790);let w=v=class extends h.A{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){null!=e&&null!=this._userSize&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,r,i){const n={...i,textSymbol3D:!0};t.font=e.write({},n),delete t.font.size}get size(){return null!=this._userSize?this._userSize:null!=this.font?.size?this.font.size:9}set size(e){this._userSize=e,null!=this.font&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new v({enabled:this.enabled,font:this.font&&(0,s.o8)(this.font),halo:this.halo&&(0,s.o8)(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:null!=this.material?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:(0,s.o8)(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new v({font:null!=e.font?e.font.clone():new u.A,halo:x(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new g.N({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new _({color:e.backgroundColor.clone()}):null})}};function x(e,t){return e&&null!=t&&t>0?new m({color:(0,s.o8)(e),size:t}):null}(0,n._)([(0,o.MZ)({type:u.A,json:{write:!0}})],w.prototype,"font",null),(0,n._)([(0,c.K)("font")],w.prototype,"writeFont",null),(0,n._)([(0,o.MZ)({type:m,json:{write:!0}})],w.prototype,"halo",void 0),(0,n._)([(0,o.MZ)({...b.rM,json:{default:"center",write:!0}})],w.prototype,"horizontalAlignment",void 0),(0,n._)([(0,o.MZ)({...b.Tb,json:{default:1,write:!0}})],w.prototype,"lineHeight",void 0),(0,n._)([(0,o.MZ)({type:g.N,json:{write:!0}})],w.prototype,"material",void 0),(0,n._)([(0,o.MZ)({type:_,json:{write:!0}})],w.prototype,"background",void 0),(0,n._)([(0,o.MZ)(d.p)],w.prototype,"size",null),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],w.prototype,"text",void 0),(0,n._)([(0,a.e)({Text:"text"},{readOnly:!0})],w.prototype,"type",void 0),(0,n._)([(0,o.MZ)({...b.x0,json:{default:"baseline",write:!0}})],w.prototype,"verticalAlignment",void 0),w=v=(0,n._)([(0,l.$)("esri.symbols.TextSymbol3DLayer")],w);const S=w},51317:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var i,n=r(35143),s=r(69539),o=r(53084),a=r(46053),l=r(40565),c=r(6409),u=r(85842),h=r(38582);let d=i=class extends h.A{constructor(e){super(e),this.color=f.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new i({color:(0,o.o8)(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};(0,n._)([(0,a.MZ)({type:s.A,nonNullable:!0,json:{type:[l.jz],write:(e,t,r)=>t[r]=e.toArray(s.A.AlphaMode.UNLESS_OPAQUE),default:()=>f.clone(),defaultEquals:e=>e.toCss(!0)===f.toCss(!0)}})],d.prototype,"color",void 0),(0,n._)([(0,c.e)({Water:"water"},{readOnly:!0})],d.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:["small","medium","large"],json:{write:!0,default:"medium"}})],d.prototype,"waterbodySize",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0,default:null}})],d.prototype,"waveDirection",void 0),(0,n._)([(0,a.MZ)({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],d.prototype,"waveStrength",void 0),d=i=(0,n._)([(0,u.$)("esri.symbols.WaterSymbol3DLayer")],d);const p=d,f=new s.A([0,119,190])},89579:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var i,n=r(35143),s=r(76460),o=r(50346),a=r(46053),l=(r(81806),r(47249),r(6409)),c=r(85842),u=r(65308),h=r(79453),d=r(25900),p=r(25158);let f=i=class extends d.A{constructor(e){super(e),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const e=null!=this.portal?this.portal:u.A.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?.portal,super.read(e,t)}clone(){return new i({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const i=null!=t?t.cache:null,n=i?this._fetchCacheKey:null;if(null!=i){const e=n&&i.get(n);if(e)return e.clone()}const{resolveWebStyleSymbol:a}=await Promise.resolve().then(r.bind(r,26314));(0,o.Te)(t);const l=a(this,{portal:this.portal},e,t);l.catch((e=>{s.A.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",e)}));const c=await l;return"webRef"===e&&"point-3d"===c.type||"cimRef"===e&&"cim"===c.type?(null!=i&&i.set(n,c.clone()),c):null}};(0,n._)([(0,a.MZ)({json:{write:!1}})],f.prototype,"color",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],f.prototype,"styleName",void 0),(0,n._)([(0,a.MZ)({type:u.A,json:{write:!1}})],f.prototype,"portal",void 0),(0,n._)([(0,a.MZ)({type:String,json:{read:h.r,write:h.w}})],f.prototype,"styleUrl",void 0),(0,n._)([(0,a.MZ)({type:p.V,json:{read:!1}})],f.prototype,"thumbnail",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],f.prototype,"name",void 0),(0,n._)([(0,l.e)({styleSymbolReference:"web-style"},{readOnly:!0})],f.prototype,"type",void 0),(0,n._)([(0,a.MZ)()],f.prototype,"_fetchCacheKey",null),f=i=(0,n._)([(0,c.$)("esri.symbols.WebStyleSymbol")],f);const m=f},60749:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var i=r(35143),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842));let a=class extends n.oY{constructor(e){super(e),this.visible=!0}clone(){throw new Error("Subclasses of Callout3D should implement their own clone method.")}};(0,i._)([(0,s.MZ)({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],a.prototype,"type",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],a.prototype,"visible",void 0),a=(0,i._)([(0,o.$)("esri.symbols.callouts.Callout3D")],a);const l=a},92135:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var i,n=r(35143),s=r(69539),o=r(53084),a=r(76931),l=r(46053),c=(r(81806),r(76460),r(6409)),u=r(85842),h=r(60749),d=r(68905),p=r(85192);let f=i=class extends h.A{constructor(e){super(e),this.type="line",this.color=new s.A([0,0,0,1]),this.size=(0,a.PN)(1),this.border=null}get visible(){return this.size>0&&null!=this.color&&this.color.a>0}clone(){return new i({color:(0,o.o8)(this.color),size:this.size,border:(0,o.o8)(this.border)})}};(0,n._)([(0,c.e)({line:"line"})],f.prototype,"type",void 0),(0,n._)([(0,l.MZ)(p.E)],f.prototype,"color",void 0),(0,n._)([(0,l.MZ)(p.p)],f.prototype,"size",void 0),(0,n._)([(0,l.MZ)({type:d.A,json:{write:!0}})],f.prototype,"border",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],f.prototype,"visible",null),f=i=(0,n._)([(0,u.$)("esri.symbols.callouts.LineCallout3D")],f);const m=f},68905:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i,n=r(35143),s=r(69539),o=r(42553),a=r(53084),l=r(46053),c=(r(81806),r(76460),r(85842)),u=r(85192);let h=i=class extends o.oY{constructor(e){super(e),this.color=new s.A("white")}clone(){return new i({color:(0,a.o8)(this.color)})}};(0,n._)([(0,l.MZ)(u.E)],h.prototype,"color",void 0),h=i=(0,n._)([(0,c.$)("esri.symbols.callouts.LineCallout3DBorder")],h);const d=h},82041:(e,t,r)=>{"use strict";r.d(t,{Ie:()=>l,LH:()=>o,YX:()=>a,Yq:()=>s,oG:()=>c});var i=r(60749),n=r(92135);function s(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||null!=t.maxWorldLength&&t.maxWorldLength<=0)}function o(e){if(!e)return!1;if(!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!s(e)}function a(e){return"point-3d"===e.type||"label-3d"===e.type}function l(e){return"center"===e.horizontalAlignment}const c={types:{key:"type",base:i.A,typeMap:{line:n.A}},json:{write:!0}}},71275:(e,t,r)=>{"use strict";r.d(t,{k:()=>a,q:()=>l});var i=r(84735),n=r(62032);const s=512;let o;class a{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}}function l(e,t){o||(o=new n.O3(0,0,0,1));const r="esriGeometryPolygon"===e.geometryType,a=r?n.dC.Polygon:n.dC.LineString,l=r?3:2;let c,u;for(o.reset(a),o.setPixelMargin(t+1),o.setExtent(s);e.nextPath();)if(!(e.pathSize<l)){for(e.nextPoint(),c=e.x,u=-e.y,o.moveTo(c,u);e.nextPoint();)c=e.x,u=-e.y,o.lineTo(c,u);r&&o.close()}const h=o.result(!1);if(h){const t=i.z.createEmptyOptimizedCIM(e.geometryType);for(const e of h){t.startPath();for(const r of e)t.pushXY(r.x,-r.y)}return t.reset(),t}return null}},5271:(e,t,r)=>{"use strict";r.d(t,{A:()=>xe,c:()=>Se});class i{static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,r,i,s){return new n(e,t,r)}}i.instance=null;class n{constructor(e,t,r){this._inputGeometries=e,this._angleTolerance=void 0!==t.angleTolerance?t.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();for(;e;){if("esriGeometryPolygon"===e.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===e.geometryType)this._isClosed=!1;else{if("esriGeometryEnvelope"!==e.geometryType){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const t=e.x,r=e.y;let i=t,n=r,s=e.pathSize,o=0,a=0,l=0,c=0,u=0,h=0;this._isClosed&&++s;for(let d=1;e.nextPoint()||d<s;++d){let p,f;this._isClosed&&d===s-1?(p=t,f=r):(p=e.x,f=e.y);const m=p-i,g=f-n,y=Math.sqrt(m*m+g*g);d>1&&y>0&&l>0&&(o*m+a*g)/y/l<=this._maxCosAngle&&e.setControlPointAt(d-1),1===d&&(c=m,u=g,h=y),y>0&&(i=p,n=f,o=m,a=g,l=y)}this._isClosed&&l>0&&h>0&&(o*c+a*u)/h/l<=this._maxCosAngle&&e.setControlPointAt(0)}}}var s=r(84735),o=r(16108),a=r(71275),l=r(78997);function c(e,t){e[4]=t}class u{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!t&&"esriGeometryPolygon"===e.geometryType||!r&&"esriGeometryPolyline"===e.geometryType?null:e,this.geomUnitsPerPoint=i,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new l.W}next(){if(!this.geometryCursor)return null;const e=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&e||(this.geometryCursor=null),e}processMultiPath(e){for(;this.iteratePath||e.pathIndex<e.totalSize-1;){this.iteratePath||e.nextPath(),this.iterateMultiPath=!0;const t=this.processPath(e);if(t)return t}return this.iterateMultiPath=!1,null}}class h{constructor(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.isClosed=!1,this._tileKey=null,this.inputGeometries=e,this.acceptPolygon=t,this.acceptPolyline=r,this.geomUnitsPerPoint=i,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===e.geometryType||"esriGeometryEnvelope"===e.geometryType,this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null;this._tileKey&&this.isClippingRequired(this.multiPathCursor)&&(this.multiPathCursor.reset(),this.multiPathCursor=(0,a.q)(this.multiPathCursor,256))}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}isClippingRequired(e){return!1}}var d=r(28808);const p=.03;class f{constructor(){}isEmpty(e){if(!e.nextPoint())return!0;let t,r,i,n;for(t=e.x,r=e.y;e.nextPoint();t=r,r=n)if(i=e.x,n=e.y,i!==t||n!==r)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);0!==t&&(e[0]/=t,e[1]/=t)}getLength(e,t,r,i){const n=r-e,s=i-t;return Math.sqrt(n*n+s*s)}getSegLength(e){const[[t,r],[i,n]]=e;return this.getLength(t,r,i,n)}getCoord2D(e,t,r,i,n){return[e+(r-e)*n,t+(i-t)*n]}getSegCoord2D(e,t){const[[r,i],[n,s]]=e;return this.getCoord2D(r,i,n,s,t)}getAngle(e,t,r,i,n){const s=r-e,o=i-t;return Math.atan2(o,s)}getAngleCS(e,t,r,i,n){const s=r-e,o=i-t,a=Math.sqrt(s*s+o*o);return a>0?[s/a,o/a]:[1,0]}getSegAngleCS(e,t){const[[r,i],[n,s]]=e;return this.getAngleCS(r,i,n,s,t)}cut(e,t,r,i,n,s){return[n<=0?[e,t]:this.getCoord2D(e,t,r,i,n),s>=1?[r,i]:this.getCoord2D(e,t,r,i,s)]}getSubCurve(e,t,r){const i=s.z.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(i,e,t,r)?i:null}appendSubCurve(e,t,r,i){e.startPath(),t.seekPathStart();let n=0,s=!0;if(!t.nextPoint())return!1;let o=t.x,a=t.y;for(;t.nextPoint();){const l=this.getLength(o,a,t.x,t.y);if(0!==l){if(s){if(n+l>r){const c=(r-n)/l;let u=1,h=!1;n+l>=i&&(u=(i-n)/l,h=!0);const d=this.cut(o,a,t.x,t.y,c,u);if(d&&e.pushPoints(d),h)break;s=!1}}else{if(n+l>i){const r=this.cut(o,a,t.x,t.y,0,(i-n)/l);r&&e.pushPoint(r[1]);break}e.pushXY(t.x,t.y)}n+=l,o=t.x,a=t.y}else o=t.x,a=t.y}return!0}getCIMPointAlong(e,t){if(!e.nextPoint())return null;let r,i,n,s,o=0;for(r=e.x,i=e.y;e.nextPoint();r=n,i=s){n=e.x,s=e.y;const a=this.getLength(r,i,n,s);if(0!==a){if(o+a>t){const e=(t-o)/a;return this.getCoord2D(r,i,n,s,e)}o+=a}}return null}offset(e,t,r,i,n){if(!e||e.length<2)return null;let s=0,o=e[s++],a=s;for(;s<e.length;){const t=e[s];t[0]===o[0]&&t[1]===o[1]||(s!==a&&(e[a]=e[s]),o=e[a++]),s++}const l=e[0][0]===e[a-1][0]&&e[0][1]===e[a-1][1];if(l&&--a,a<(l?3:2))return null;const c=[];o=l?e[a-1]:null;let u=e[0];for(let h=0;h<a;h++){const n=h===a-1?l?e[0]:null:e[h+1];if(o)if(n){const e=[n[0]-u[0],n[1]-u[1]];this.normalize(e);const s=[u[0]-o[0],u[1]-o[1]];this.normalize(s);const a=s[0]*e[1]-s[1]*e[0],l=s[0]*e[0]+s[1]*e[1];if(0===a&&1===l){u=n;continue}if(a>=0==t<=0){if(l<1){const r=[e[0]-s[0],e[1]-s[1]];this.normalize(r);const n=Math.sqrt((1+l)/2);if(n>1/i){const e=-Math.abs(t)/n;c.push([u[0]-r[0]*e,u[1]-r[1]*e])}}}else switch(r){case d.xw.Mitered:{const r=Math.sqrt((1+l)/2);if(r>0&&1/r<i){const i=[e[0]-s[0],e[1]-s[1]];this.normalize(i);const n=Math.abs(t)/r;c.push([u[0]-i[0]*n,u[1]-i[1]*n]);break}}case d.xw.Bevelled:c.push([u[0]+s[1]*t,u[1]-s[0]*t]),c.push([u[0]+e[1]*t,u[1]-e[0]*t]);break;case d.xw.Rounded:if(l<1){c.push([u[0]+s[1]*t,u[1]-s[0]*t]);const r=Math.floor(2.5*(1-l));if(r>0){const i=1/r;let n=i;for(let o=1;o<r;o++,n+=i){const r=[s[1]*(1-n)+e[1]*n,-s[0]*(1-n)-e[0]*n];this.normalize(r),c.push([u[0]+r[0]*t,u[1]+r[1]*t])}}c.push([u[0]+e[1]*t,u[1]-e[0]*t])}break;case d.xw.Square:default:if(a<0)c.push([u[0]+(s[1]+s[0])*t,u[1]+(s[1]-s[0])*t]),c.push([u[0]+(e[1]-e[0])*t,u[1]-(e[0]+e[1])*t]);else{const r=Math.sqrt((1+Math.abs(l))/2),i=[e[0]-s[0],e[1]-s[1]];this.normalize(i);const n=t/r;c.push([u[0]-i[0]*n,u[1]-i[1]*n])}}}else{const e=[u[0]-o[0],u[1]-o[1]];this.normalize(e),c.push([u[0]+e[1]*t,u[1]-e[0]*t])}else{const e=[n[0]-u[0],n[1]-u[1]];this.normalize(e),c.push([u[0]+e[1]*t,u[1]-e[0]*t])}o=u,u=n}return c.length<(l?3:2)?null:(l&&c.push([c[0][0],c[0][1]]),c)}}const m=1.7320508075688772,g=d.oF.OpenEnded;class y{static local(){return null===y.instance&&(y.instance=new y),y.instance}execute(e,t,r,i,n){return new _(e,t,r)}}y.instance=null;class _ extends h{constructor(e,t,r){super(e,!1,!0),this._curveHelper=new f,this._width=(void 0!==t.width?t.width:5)*r,this._arrowType=void 0!==t.geometricEffectArrowType?t.geometricEffectArrowType:void 0!==t.arrowType?t.arrowType:g,this._offsetFlattenError=p*r}processPath(e){const t=s.z.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case d.oF.OpenEnded:default:this._constructSimpleArrow(t,e,!0);break;case d.oF.Block:this._constructSimpleArrow(t,e,!1);break;case d.oF.Crossed:this._constructCrossedArrow(t,e)}return t}_constructSimpleArrow(e,t,r){const i=t.pathLength();let n=this._width;i<2*n&&(n=i/2);const s=this._curveHelper.getSubCurve(t,0,i-n);if(!s||!s.nextPath())return;s.seekPathStart();const a=n/2;if(this._curveHelper.isEmpty(s))return;const l=(0,o.A)(s),c=this._constructOffset(l,-a);if(!c)return;const u=this._constructOffset(l,a);if(!u)return;const h=this._constructArrowBasePoint(c,-a/2);if(!h)return;const d=this._constructArrowBasePoint(u,a/2);if(!d)return;t.seekInPath(t.pathSize-1);const p=[t.x,t.y];e.pushPath(u),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(d),e.nextPoint(),e.setControlPoint(),e.pushPoint(p),e.nextPoint(),e.setControlPoint(),e.pushPoint(h),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),r||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(u[0])),e.reset()}_constructCrossedArrow(e,t){const r=t.pathLength();let i=this._width;r<i*(1+m+1)&&(i=r/(1+m+1)),t.seekPathStart();const n=this._curveHelper.getSubCurve(t,0,r-i*(1+m));if(!n)return;n.nextPath();const s=i/2;if(this._curveHelper.isEmpty(n))return;const a=(0,o.A)(n),l=this._constructOffset(a,s);if(!l)return;const c=this._constructOffset(a,-s);if(!c)return;const u=this._curveHelper.getSubCurve(t,0,r-i);if(!u)return;if(u.nextPath(),this._curveHelper.isEmpty(u))return;const h=(0,o.A)(u),d=this._constructOffset(h,s);if(!d)return;const p=this._constructOffset(h,-s);if(!p)return;const f=d[d.length-1],g=this._constructArrowBasePoint(d,s/2);if(!g)return;const y=p[p.length-1],_=this._constructArrowBasePoint(p,-s/2);if(!_)return;t.seekInPath(t.pathSize-1);const v=[t.x,t.y];e.pushPath(l),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(y),e.nextPoint(),e.setControlPoint(),e.pushPoint(_),e.nextPoint(),e.setControlPoint(),e.pushPoint(v),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoint(f),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,t){return this._curveHelper.offset(e,t,d.xw.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(e,t){if(!e||e.length<2)return null;const r=e[e.length-2],i=e[e.length-1],n=[i[0]-r[0],i[1]-r[1]];return this._curveHelper.normalize(n),[i[0]+n[1]*t,i[1]-n[0]*t]}}r(35238);var v=r(13312);class b{static local(){return null===b.instance&&(b.instance=new b),b.instance}execute(e,t,r,i,n,s){return new w(e,t,r,i,n,s)}}b.instance=null;class w{constructor(e,t,r,i,n,s){this._inputGeometries=e,this._tileKey=i,this._geometryEngine=n,this._curveHelper=new f,this._size=(void 0!==t.size?t.size:1)*r,this._maxInflateSize=s*r,this._offsetFlattenError=p*r}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._size)return e;if("esriGeometryEnvelope"===e.geometryType)if(this._size>0){const t=s.z.createEmptyOptimizedCIM(e.geometryType),r=(0,o.x)(e)[0],i=this._curveHelper.offset(r,this._size,d.xw.Rounded,4,this._offsetFlattenError);if(i)return t.pushPath(i),t}else if(this._size<0){const t=e.asJSON();if(Math.min(t.xmax-t.xmin,t.ymax-t.ymin)+2*this._size>0)return s.z.fromJSONCIM({xmin:t.xmin-this._size,xmax:t.xmax+this._size,ymin:t.ymin-this._size,ymax:t.ymax+this._size})}const t=this._geometryEngine;if(null==t)return null;const r=this._tileKey?(0,a.q)(e,this._maxInflateSize):e;if(!r)continue;const i=t.buffer(v.A.WebMercator,r.asJSON(),this._size,1);return i?s.z.fromJSONCIM(i):null}return null}}class x{static local(){return null===x.instance&&(x.instance=new x),x.instance}execute(e,t,r,i,n){return new S(e,t,r)}}x.instance=null;class S{constructor(e,t,r){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=r,this._rule=t.rule??d.uQ.FullGeometry,this._defaultSize=this._defaultPointSize*r}next(){let e;for(;e=this._inputGeometries.next();){const t=this._processGeom((0,o.x)(e));if(t?.length)return s.z.fromJSONCIM({paths:t})}return null}_clone(e){return[e[0],e[1]]}_mid(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}_mix(e,t,r,i){return[e[0]*t+r[0]*i,e[1]*t+r[1]*i]}_add(e,t){return[e[0]+t[0],e[1]+t[1]]}_add2(e,t,r){return[e[0]+t,e[1]+r]}_sub(e,t){return[e[0]-t[0],e[1]-t[1]]}_dist(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)/this._norm(e);e[0]*=t,e[1]*=t}_leftPerpendicular(e){const t=-e[1],r=e[0];e[0]=t,e[1]=r}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const t=e[1],r=-e[0];e[0]=t,e[1]=r}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,t){return e[0]*t[0]+e[1]*t[1]}_crossProduct(e,t){return e[0]*t[1]-e[1]*t[0]}_rotateDirect(e,t,r){const i=e[0]*t-e[1]*r,n=e[0]*r+e[1]*t;e[0]=i,e[1]=n}_makeCtrlPt(e){const t=[e[0],e[1]];return c(t,1),t}_addAngledTicks(e,t,r,i){const n=this._sub(r,t);this._normalize(n);const s=this._crossProduct(n,this._sub(i,t));let o;o=s>0?this._rightPerp(n):this._leftPerp(n);const a=Math.abs(s)/2,l=[];l.push([t[0]+(o[0]-n[0])*a,t[1]+(o[1]-n[1])*a]),l.push(t),l.push(r),l.push([r[0]+(o[0]+n[0])*a,r[1]+(o[1]+n[1])*a]),e.push(l)}_addBezier2(e,t,r,i,n){if(0==n--)return void e.push(i);const s=this._mid(t,r),o=this._mid(r,i),a=this._mid(s,o);this._addBezier2(e,t,s,a,n),this._addBezier2(e,a,o,i,n)}_addBezier3(e,t,r,i,n,s){if(0==s--)return void e.push(n);const o=this._mid(t,r),a=this._mid(r,i),l=this._mid(i,n),c=this._mid(o,a),u=this._mid(a,l),h=this._mid(c,u);this._addBezier3(e,t,o,c,h,s),this._addBezier3(e,h,u,l,n,s)}_add90DegArc(e,t,r,i,n){const s=n??this._crossProduct(this._sub(r,t),this._sub(i,t))>0,o=this._mid(t,r),a=this._sub(o,t);s?this._leftPerpendicular(a):this._rightPerpendicular(a),o[0]+=a[0],o[1]+=a[1],this._addBezier3(e,t,this._mix(t,.33333,o,.66667),this._mix(r,.33333,o,.66667),r,4)}_addArrow(e,t,r){const i=t[0],n=t[1],s=t[t.length-1],o=this._sub(i,n),a=this._norm(o);this._normalize(o);const l=Math.abs(this._crossProduct(o,this._sub(s,n)));let c=this._dotProduct(o,this._sub(s,n));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const u=.5*l,h=this._leftPerp(o),d=[n[0]+o[0]*c,n[1]+o[1]*c],p=t.length-1,f=[];f.push(r?[-h[0],-h[1]]:h);let m=[-o[0],-o[1]];for(let g=1;g<p-1;g++){const e=this._sub(t[g+1],t[g]);this._normalize(e);const r=this._dotProduct(e,m),i=this._crossProduct(e,m),n=Math.sqrt((1+r)/2),s=this._sub(e,m);this._normalize(s),s[0]/=n,s[1]/=n,f.push(i<0?[-s[0],-s[1]]:s),m=e}f.push(this._rightPerp(m));for(let g=f.length-1;g>0;g--)e.push([t[g][0]+f[g][0]*u,t[g][1]+f[g][1]*u]);e.push([d[0]+f[0][0]*u,d[1]+f[0][1]*u]),e.push([d[0]+f[0][0]*l,d[1]+f[0][1]*l]),e.push(i),e.push([d[0]-f[0][0]*l,d[1]-f[0][1]*l]),e.push([d[0]-f[0][0]*u,d[1]-f[0][1]*u]);for(let g=1;g<f.length;g++)e.push([t[g][0]-f[g][0]*u,t[g][1]-f[g][1]*u])}_cp2(e,t,r){return e.length>=2?e[1]:this._add2(e[0],t*this._defaultSize,r*this._defaultSize)}_cp3(e,t,r,i){if(e.length>=3)return e[2];const n=this._mix(e[0],1-r,t,r),s=this._sub(t,e[0]);return this._normalize(s),this._rightPerpendicular(s),[n[0]+s[0]*i*this._defaultSize,n[1]+s[1]*i*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const t=e[0],r=this._cp2(e,-4,0),i=this._sub(t,r);this._normalize(i);const n=this._rightPerp(i);return[t,r,[t[0]+(n[0]-i[0])*this._defaultSize,t[1]+(n[1]-i[1])*this._defaultSize]]}_arrowLastSeg(e){const t=e[0],r=this._cp2(e,-4,0);let i;if(e.length>=3)i=e[e.length-1];else{const e=this._sub(t,r);this._normalize(e);const n=this._rightPerp(e);i=[t[0]+(n[0]-e[0])*this._defaultSize,t[1]+(n[1]-e[1])*this._defaultSize]}return[r,i]}_processGeom(e){if(!e)return null;const t=[];for(const r of e){if(!r||0===r.length)continue;const e=r.length;let i=r[0];switch(this._rule){case d.uQ.PerpendicularFromFirstSegment:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,.5,4),s=[];s.push(n),s.push(this._mid(i,e)),t.push(s);break}case d.uQ.ReversedFirstSegment:{const e=this._cp2(r,0,-1);t.push([e,i]);break}case d.uQ.PerpendicularToSecondSegment:{if(r.length<3)return[];const e=this._cp2(r,-4,1),n=this._cp3(r,e,.882353,-1.94),s=[];s.push(this._mid(e,n)),s.push(i),t.push(s);break}case d.uQ.SecondSegmentWithTicks:{if(r.length<3)return[];const e=this._cp2(r,-4,1),n=this._cp3(r,e,.882353,-1.94),s=this._sub(n,e);let o;o=this._crossProduct(s,this._sub(i,e))>0?this._rightPerp(s):this._leftPerp(s);const a=[];a.push([e[0]+(o[0]-s[0])/3,e[1]+(o[1]-s[1])/3]),a.push(e),a.push(n),a.push([n[0]+(o[0]+s[0])/3,n[1]+(o[1]+s[1])/3]),t.push(a);break}case d.uQ.DoublePerpendicular:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,.5,3),s=this._mid(i,e),o=this._sub(s,n);this._normalize(o);const a=this._crossProduct(o,this._sub(i,n));this._leftPerpendicular(o);const l=[];l.push(i),l.push([n[0]+o[0]*a,n[1]+o[1]*a]),t.push(l);const c=[];c.push([n[0]-o[0]*a,n[1]-o[1]*a]),c.push(e),t.push(c);break}case d.uQ.OppositeToFirstSegment:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,.5,3),s=this._mid(i,e),o=this._sub(s,n);this._normalize(o);const a=this._crossProduct(o,this._sub(i,n));this._leftPerpendicular(o);const l=[];l.push([n[0]+o[0]*a,n[1]+o[1]*a]),l.push([n[0]-o[0]*a,n[1]-o[1]*a]),t.push(l);break}case d.uQ.TriplePerpendicular:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,.5,4),s=this._mid(i,e),o=this._sub(s,n);this._normalize(o);const a=this._crossProduct(o,this._sub(i,n));this._leftPerpendicular(o);const l=[];l.push([n[0]+o[0]*a*.8,n[1]+o[1]*a*.8]),l.push([s[0]+.8*(i[0]-s[0]),s[1]+.8*(i[1]-s[1])]),t.push(l),t.push([n,s]);const c=[];c.push([n[0]-o[0]*a*.8,n[1]-o[1]*a*.8]),c.push([s[0]+.8*(e[0]-s[0]),s[1]+.8*(e[1]-s[1])]),t.push(c);break}case d.uQ.HalfCircleFirstSegment:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,.5,4),s=this._mid(i,e);let o=this._sub(e,i);const a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18),c=Math.sqrt((1+a)/2),u=Math.sqrt((1-a)/2),h=[];let d;this._crossProduct(o,this._sub(n,i))>0?(h.push(i),o=this._sub(i,s),d=e):(h.push(e),o=this._sub(e,s),d=i),this._rotateDirect(o,c,u),o[0]/=c,o[1]/=c;for(let t=1;t<=18;t++)h.push(this._add(s,o)),this._rotateDirect(o,a,l);h.push(d),t.push(h);break}case d.uQ.HalfCircleSecondSegment:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,1,-1);let s=this._sub(i,e);this._normalize(s);const o=this._crossProduct(s,this._sub(n,e))/2;this._leftPerpendicular(s);const a=[e[0]+s[0]*o,e[1]+s[1]*o];s=this._sub(e,a);const l=Math.cos(Math.PI/18);let c=Math.sin(Math.PI/18);o>0&&(c=-c);const u=[e];for(let t=1;t<=18;t++)this._rotateDirect(s,l,c),u.push(this._add(a,s));t.push(u);break}case d.uQ.HalfCircleExtended:{const n=this._cp2(r,0,-2),s=this._cp3(r,n,1,-1);let o;if(e>=4)o=r[3];else{const e=this._sub(i,n);o=this._add(s,e)}const a=this._dist(n,s)/2/.75,l=this._sub(n,i);this._normalize(l,a);const c=this._sub(s,o);this._normalize(c,a);const u=[o,s];t.push(u);const h=[this._clone(s)];this._addBezier3(h,s,this._add(s,c),this._add(n,l),n,4),h.push(i),t.push(h);break}case d.uQ.OpenCircle:{const e=this._cp2(r,-2,0),n=this._sub(e,i),s=Math.cos(Math.PI/18),o=-Math.sin(Math.PI/18),a=[e];for(let t=1;t<=33;t++)this._rotateDirect(n,s,o),a.push(this._add(i,n));t.push(a);break}case d.uQ.CoverageEdgesWithTicks:{const n=this._cp2(r,0,-1);let s,o;if(e>=3)s=r[2];else{const e=this._sub(n,i),t=this._leftPerp(e);s=[i[0]+t[0]-.25*e[0],i[1]+t[1]-.25*e[1]]}if(e>=4)o=r[3];else{const e=this._mid(i,n),t=this._sub(i,n);this._normalize(t),this._leftPerpendicular(t);const r=this._crossProduct(t,this._sub(s,e));this._rightPerpendicular(t),o=[s[0]+t[0]*r*2,s[1]+t[1]*r*2]}const a=this._sub(n,i);let l,c;l=this._crossProduct(a,this._sub(s,i))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push(s),c.push(i),c.push([i[0]+(l[0]-a[0])/3,i[1]+(l[1]-a[1])/3]),t.push(c),l=this._crossProduct(a,this._sub(o,n))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push([n[0]+(l[0]+a[0])/3,n[1]+(l[1]+a[1])/3]),c.push(n),c.push(o),t.push(c);break}case d.uQ.GapExtentWithDoubleTicks:{const n=this._cp2(r,0,2),s=this._cp3(r,n,0,1);let o;if(e>=4)o=r[3];else{const e=this._sub(n,i);o=this._add(s,e)}this._addAngledTicks(t,i,n,this._mid(s,o)),this._addAngledTicks(t,s,o,this._mid(i,n));break}case d.uQ.GapExtentMidline:{const n=this._cp2(r,2,0),s=this._cp3(r,n,0,1);let o;if(e>=4)o=r[3];else{const e=this._sub(n,i);o=this._add(s,e)}const a=[];a.push(this._mid(i,s)),a.push(this._mid(n,o)),t.push(a);break}case d.uQ.Chevron:{const n=this._cp2(r,-1,-1);let s;if(e>=3)s=r[2];else{const e=this._sub(n,i);this._leftPerpendicular(e),s=this._add(i,e)}t.push([n,this._makeCtrlPt(i),s]);break}case d.uQ.PerpendicularWithArc:{const n=this._cp2(r,0,-2),s=this._cp3(r,n,.5,-1),o=this._sub(n,i),a=this._norm(o);o[0]/=a,o[1]/=a;const l=this._crossProduct(o,this._sub(s,i));let c=this._dotProduct(o,this._sub(s,i));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const u=[i[0]+o[0]*c,i[1]+o[1]*c];let h=this._leftPerp(o),d=[];if(d.push([u[0]-h[0]*l,u[1]-h[1]*l]),d.push([u[0]+h[0]*l,u[1]+h[1]*l]),t.push(d),e>=4){const e=r[3];let n=this._dotProduct(o,this._sub(e,i));n<.1*a?n=.1*a:n>.9*a&&(n=.9*a);const s=[i[0]+o[0]*n,i[1]+o[1]*n],l=this._crossProduct(o,this._sub(e,i)),c=[];c.push([s[0]-h[0]*l,s[1]-h[1]*l]),c.push([s[0]+h[0]*l,s[1]+h[1]*l]),t.push(c)}const p=[n[0]+h[0]*l,n[1]+h[1]*l];h=this._sub(n,p);const f=Math.cos(Math.PI/18);let m=Math.sin(Math.PI/18);l<0&&(m=-m),d=[i,n];for(let e=1;e<=9;e++)this._rotateDirect(h,f,m),d.push(this._add(p,h));t.push(d);break}case d.uQ.ClosedHalfCircle:{const e=this._cp2(r,2,0),n=this._mid(i,e),s=this._sub(e,n),o=Math.cos(Math.PI/18),a=Math.sin(Math.PI/18),l=[i,e];for(let t=1;t<=18;t++)this._rotateDirect(s,o,a),l.push(this._add(n,s));t.push(l);break}case d.uQ.TripleParallelExtended:{const e=this._cp2(r,0,-2),n=this._cp3(r,e,1,-2),s=this._mid(i,e),o=this._sub(n,e);this._normalize(o);const a=Math.abs(this._crossProduct(o,this._sub(s,e)))/2,l=this._dist(e,n),u=[e,i];u.push([i[0]+o[0]*l*.5,i[1]+o[1]*l*.5]),t.push(u);const h=[];h.push([s[0]-o[0]*a,s[1]-o[1]*a]),h.push([s[0]+o[0]*l*.375,s[1]+o[1]*l*.375]),c(h[h.length-1],1),h.push([s[0]+o[0]*l*.75,s[1]+o[1]*l*.75]),t.push(h);const d=[e,n];t.push(d);break}case d.uQ.ParallelWithTicks:{const e=this._cp2(r,3,0),n=this._cp3(r,e,.5,-1),s=this._sub(n,e);this._normalize(s);const o=this._crossProduct(s,this._sub(n,i));this._leftPerpendicular(s),this._addAngledTicks(t,i,e,n),this._addAngledTicks(t,this._mix(i,1,s,o),this._mix(e,1,s,o),this._mid(i,e));break}case d.uQ.Parallel:{const e=this._cp2(r,3,0),n=this._cp3(r,e,.5,-1),s=this._sub(e,i);this._normalize(s);const o=this._leftPerp(s),a=this._crossProduct(s,this._sub(n,i));let l=[i,e];t.push(l),l=[],l.push([i[0]+o[0]*a,i[1]+o[1]*a]),l.push([e[0]+o[0]*a,e[1]+o[1]*a]),t.push(l);break}case d.uQ.PerpendicularToFirstSegment:{const e=this._cp2(r,3,0),n=this._cp3(r,e,.5,-1),s=this._mid(i,e),o=this._sub(e,i);this._normalize(o);const a=this._crossProduct(o,this._sub(n,i));this._leftPerpendicular(o);const l=[];l.push([s[0]-o[0]*a*.25,s[1]-o[1]*a*.25]),l.push([s[0]+o[0]*a*1.25,s[1]+o[1]*a*1.25]),t.push(l);break}case d.uQ.ParallelOffset:{const e=this._cp2(r,3,0),n=this._cp3(r,e,.5,-1),s=this._sub(e,i);this._normalize(s);const o=this._crossProduct(s,this._sub(n,i));this._leftPerpendicular(s);const a=[];a.push([i[0]-s[0]*o,i[1]-s[1]*o]),a.push([e[0]-s[0]*o,e[1]-s[1]*o]),t.push(a);const l=[];l.push([i[0]+s[0]*o,i[1]+s[1]*o]),l.push([e[0]+s[0]*o,e[1]+s[1]*o]),t.push(l);break}case d.uQ.OffsetOpposite:{const e=this._cp2(r,3,0),n=this._cp3(r,e,.5,-1),s=this._sub(e,i);this._normalize(s);const o=this._crossProduct(s,this._sub(n,i));this._leftPerpendicular(s);const a=[];a.push([i[0]-s[0]*o,i[1]-s[1]*o]),a.push([e[0]-s[0]*o,e[1]-s[1]*o]),t.push(a);break}case d.uQ.OffsetSame:{const e=this._cp2(r,3,0),n=this._cp3(r,e,.5,-1),s=this._sub(e,i);this._normalize(s);const o=this._crossProduct(s,this._sub(n,i));this._leftPerpendicular(s);const a=[];a.push([i[0]+s[0]*o,i[1]+s[1]*o]),a.push([e[0]+s[0]*o,e[1]+s[1]*o]),t.push(a);break}case d.uQ.CircleWithArc:{let n=this._cp2(r,3,0);const s=this._cp3(r,n,.5,-1);let o,a;if(e>=4)o=r[3],a=this._crossProduct(this._sub(o,n),this._sub(s,n))>0;else{o=n,a=this._crossProduct(this._sub(o,i),this._sub(s,i))>0;const e=24*this._geomUnitsPerPoint,t=this._sub(o,i);this._normalize(t,e);const r=Math.sqrt(2)/2;this._rotateDirect(t,r,a?r:-r),n=this._add(i,t)}const l=this._sub(n,i),u=Math.cos(Math.PI/18),h=Math.sin(Math.PI/18),d=[n];for(let e=1;e<=36;e++)this._rotateDirect(l,u,h),d.push(this._add(i,l));this._add90DegArc(d,n,o,s,a),c(d[d.length-8],1),t.push(d);break}case d.uQ.DoubleJog:{let n,s=this._cp2(r,-3,1),o=this._cp3(r,s,-1,-.5);if(e>=4)n=r[3];else{const e=i;i=s,n=o;const t=this._dist(i,e),r=this._dist(n,e);let a=30*this._geomUnitsPerPoint;.5*t<a&&(a=.5*t),.5*r<a&&(a=.5*r),s=this._mix(i,a/t,e,(t-a)/t),o=this._mix(n,a/r,e,(r-a)/r)}const a=this._mid(i,s),l=this._mid(n,o),c=this._dist(i,s),u=this._dist(o,n);let h=Math.min(c,u)/8;h=Math.min(h,24*this._geomUnitsPerPoint);const d=Math.cos(Math.PI/4);let p=this._sub(i,s);this._normalize(p,h),this._crossProduct(p,this._sub(n,s))>0?this._rotateDirect(p,d,-d):this._rotateDirect(p,d,d);let f=[];f.push(s),f.push(this._add(a,p)),f.push(this._sub(a,p)),f.push(i),t.push(f),p=this._sub(n,o),this._normalize(p,h),this._crossProduct(p,this._sub(i,o))<0?this._rotateDirect(p,d,d):this._rotateDirect(p,d,-d),f=[],f.push(o),f.push(this._add(l,p)),f.push(this._sub(l,p)),f.push(n),t.push(f);break}case d.uQ.PerpendicularOffset:{const e=this._cp2(r,-4,1),n=this._cp3(r,e,.882353,-1.94),s=this._sub(n,e);this._crossProduct(s,this._sub(i,e))>0?this._rightPerpendicular(s):this._leftPerpendicular(s);const o=[s[0]/8,s[1]/8],a=this._sub(this._mid(e,n),o);t.push([a,i]);break}case d.uQ.LineExcludingLastSegment:{const e=this._arrowPath(r),i=[];let n=e.length-2;for(;n--;)i.push(e[n]);t.push(i);break}case d.uQ.MultivertexArrow:{const e=this._arrowPath(r),i=[];this._addArrow(i,e,!1),t.push(i);break}case d.uQ.CrossedArrow:{const e=this._arrowPath(r),i=[];this._addArrow(i,e,!0),t.push(i);break}case d.uQ.ChevronArrow:{const[e,n]=this._arrowLastSeg(r),s=10*this._geomUnitsPerPoint,o=this._sub(i,e),a=this._norm(o);this._normalize(o);const l=this._crossProduct(o,this._sub(n,e));let c=this._dotProduct(o,this._sub(n,e));c<.05*a?c=.05*a:c>.95*a-s&&(c=.95*a-s);const u=[e[0]+o[0]*c,e[1]+o[1]*c],h=this._leftPerp(o),d=[];d.push([u[0]+h[0]*l+o[0]*s,u[1]+h[1]*l+o[1]*s]),d.push(i),d.push([u[0]-h[0]*l+o[0]*s,u[1]-h[1]*l+o[1]*s]),t.push(d);break}case d.uQ.ChevronArrowOffset:{const[e,n]=this._arrowLastSeg(r),s=this._sub(i,e),o=this._norm(s);this._normalize(s);const a=this._crossProduct(s,this._sub(n,e));let l=this._dotProduct(s,this._sub(n,e));l<.05*o?l=.05*o:l>.95*o&&(l=.95*o);const c=[e[0]+s[0]*l,e[1]+s[1]*l];this._leftPerpendicular(s);const u=[];u.push([c[0]+s[0]*a*.5,c[1]+s[1]*a*.5]),u.push(this._mid(c,i)),u.push([c[0]-s[0]*a*.5,c[1]-s[1]*a*.5]),t.push(u);break}case d.uQ.PartialFirstSegment:{const[e,n]=this._arrowLastSeg(r),s=this._sub(i,e),o=this._norm(s);this._normalize(s);let a=this._dotProduct(s,this._sub(n,e));a<.05*o?a=.05*o:a>.95*o&&(a=.95*o);const l=[e[0]+s[0]*a,e[1]+s[1]*a];t.push([e,l]);break}case d.uQ.Arch:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,.5,1),s=this._sub(i,e),o=this._mix(n,1,s,.55),a=this._mix(n,1,s,-.55),l=[i];this._addBezier2(l,i,o,n,4),this._addBezier2(l,n,a,e,4),t.push(l);break}case d.uQ.CurvedParallelTicks:{const e=this._cp2(r,-4,1),n=this._cp3(r,e,.882353,-1.94),s=this._sub(n,e);this._crossProduct(s,this._sub(i,e))>0?this._rightPerpendicular(s):this._leftPerpendicular(s);const o=[s[0]/8,s[1]/8],a=this._sub(this._mid(e,n),o),l=this._sub(this._mix(e,.75,n,.25),o),c=this._sub(this._mix(e,.25,n,.75),o),u=[e];this._addBezier2(u,e,l,a,3),this._addBezier2(u,a,c,n,3),t.push(u);for(let r=0;r<8;r++){const e=u[2*r+1],i=[this._clone(e)];i.push(this._add(e,[s[0]/4,s[1]/4])),t.push(i)}break}case d.uQ.Arc90Degrees:{const e=this._cp2(r,0,-1),n=this._cp3(r,e,.5,1),s=[e];this._add90DegArc(s,e,i,n),t.push(s);break}case d.uQ.TipWithPerpendicularAndTicks:{const[e,n]=this._arrowLastSeg(r),s=10*this._geomUnitsPerPoint,o=this._sub(i,e),a=this._norm(o);this._normalize(o);let l=this._crossProduct(o,this._sub(n,e)),c=this._dotProduct(o,this._sub(n,e));c<.05*a?c=.05*a:c>.95*a-s&&(c=.95*a-s);const u=this._leftPerp(o),h=[i[0]-o[0]*s,i[1]-o[1]*s],d=.5*Math.max(a-c-s,s);l=Math.abs(l);const p=[];p.push([h[0]+u[0]*(l+d)-o[0]*d,h[1]+u[1]*(l+d)-o[1]*d]),p.push([h[0]+u[0]*l,h[1]+u[1]*l]),p.push([h[0]-u[0]*l,h[1]-u[1]*l]),p.push([h[0]-u[0]*(l+d)-o[0]*d,h[1]-u[1]*(l+d)-o[1]*d]),t.push(p),t.push([h,i]);break}case d.uQ.FullGeometry:default:t.push(r)}}return t}}class T{static local(){return null===T.instance&&(T.instance=new T),T.instance}execute(e,t,r,i,n){return new M(e,t,r)}}T.instance=null;class M extends h{constructor(e,t,r){super(e,!0,!0),this._curveHelper=new f,this._beginCut=(void 0!==t.beginCut?t.beginCut:1)*r,this._endCut=(void 0!==t.endCut?t.endCut:1)*r,this._middleCut=(void 0!==t.middleCut?t.middleCut:0)*r,this._invert=void 0!==t.invert&&t.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:t,_endCut:r,_middleCut:i}=this,n=e.pathLength(),o=s.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(0!==t||0!==r||0!==i)if(t+r+i>=n)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,t),this._curveHelper.appendSubCurve(o,e,.5*(n-i),.5*(n+i)),this._curveHelper.appendSubCurve(o,e,n-r,r)}else if(0===t&&0===r&&0===i)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else t+r+i<n&&(0===i?this._curveHelper.appendSubCurve(o,e,t,n-r):(this._curveHelper.appendSubCurve(o,e,t,.5*(n-i)),this._curveHelper.appendSubCurve(o,e,.5*(n+i),n-r)));return 0===o.totalSize?null:o}}var A=r(5262);class C{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._setEmpty(),!e||0===e.length)return!1;for(let i=0;i<e.length;i++){let t=Math.abs(e[i]);r&&t<1e-7&&(t=1e-7),this._values.push(t),this._length+=t}return t&&1&e.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const t=this._values?this._values.length:0;for(let r=0;r<t;++r)this._values[r]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}}class E{constructor(){this.pt=null,this.ca=0,this.sa=0}}var R;!function(e){e[e.FAIL=0]="FAIL",e[e.END=1]="END",e[e.CONTINUE=2]="CONTINUE"}(R||(R={}));class P{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return null!==this.segment}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}}class O extends f{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]&&arguments[1]),this._tolerance=p,this._currentPosition=new P}updateTolerance(e){this._tolerance=p*e}init(e,t){return!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?(this._patternLength=t.length(),this._partExtPtGap=t.extPtGap,this._partCtrlPtGap=t.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.FAIL;const r=new P;return!!this._nextPosition(e,r,null,t)&&(r.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[t,r]=this._getAngleCS(this._currentPosition);e.ca=t,e.sa=r}nextPointAndAngle(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.FAIL;const i=new P;if(!this._nextPosition(e,i,null,r))return!1;i.copyTo(this._currentPosition),t.pt=this._getPoint(i);const[n,s]=this._getAngleCS(i);return t.ca=n,t.sa=s,!0}nextCurve(e){if(0===e)return null;const t=s.z.createEmptyOptimizedCIM("esriGeometryPolyline");t.startPath(),t.nextPath();const r=new P;return this._nextPosition(e,r,t,R.END)?(r.copyTo(this._currentPosition),t):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,t,r,i){if(this._currentPosition.isPathEnd)return!1;let n=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(n/=this._currentPosition.segmentLength),this._currentPosition.copyTo(t);t.abscissa+e*this._partLengthRatio>t.segmentLength+this._tolerance;){if(r){if(0===r.pathSize)if(0===n){const e=t.segment[0];r.pushXY(e[0],e[1])}else r.pushPoint(this.getSegCoord2D(t.segment,n));const e=t.segment[1];r.pushXY(e[0],e[1])}if(n=0,e-=(t.segmentLength-t.abscissa)/this._partLengthRatio,this._partSegCount)t.segment=this._nextSegment(),t.segmentLength=this.getSegLength(t.segment),t.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return i!==R.FAIL&&(t.segmentLength=this.getSegLength(t.segment),t.isPartEnd=!0,i===R.END?(t.abscissa=t.segmentLength,t.isPathEnd=!0):t.abscissa=t.segmentLength+e,!0);this._currentPosition.copyTo(t)}}if(t.abscissa+=e*this._partLengthRatio,r){0===r.pathSize&&(0===n?r.pushPoint(t.segment[0]):r.pushPoint(this.getSegCoord2D(t.segment,n)));const e=t.abscissa/t.segmentLength;1===e?r.pushPoint(t.segment[1]):r.pushPoint(this.getSegCoord2D(t.segment,e))}return this._partSegCount||Math.abs(t.abscissa-t.segmentLength)<this._tolerance&&(t.isPathEnd=this._partIsLast,t.isPartEnd=!0),!0}_getPoint(e){const t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,t)}_getAngleCS(e){const t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,t)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const t=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(t);let r=t+this._partSegCount+1;if(r>=this._pathCursor.pathSize&&(r=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(r),this._patternLength>0){const e=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,t=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let r=Math.round((this._partLength-(e+t))/this._patternLength);r<=0&&(r=e+t>0?0:1),this._partLengthRatio=this._partLength/(e+t+r*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}var I=r(97763);class L{static local(){return null===L.instance&&(L.instance=new L),L.instance}execute(e,t,r,i,n){return new N(e,t,r,i)}}L.instance=null;class N extends h{constructor(e,t,r,i){super(e,!0,!0),this._firstCurve=null,this._walker=new O,this._walker.updateTolerance(r),this._endings=t.lineDashEnding,this._customDashPos=-(t.offsetAlongLine??0)*r,this._offsetAtEnd=(t.customEndingOffset??0)*r,this._tileKey=i;let n=(0,I.K3)(t).dashTemplate;null==n&&(n=[]),n.length%2&&(n=[...n,...n]);let s=0;for(let o=0;o<n.length;o++){let e=Math.abs(n[o]);e<1e-7&&(e=1e-7),s+=e}this._patternLength=s,this._numOfDashesPerPattern=n.length/2,this._pattern=new C,this._pattern.init(n,!0),this._pattern.scale(r)}processPath(e){if(0===this._pattern.length()){this.iteratePath=!1;const t=(0,o.A)(e);return s.z.fromJSONCIM({paths:[t]})}if(!this.iteratePath){let t=!0;switch(this._endings){case d.yS.HalfPattern:case d.yS.HalfGap:default:this._pattern.extPtGap=0;break;case d.yS.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case d.yS.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case d.yS.NoConstraint:this.isClosed||(t=!1);break;case d.yS.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const r=e.pathLength();if(this._pattern.isEmpty()||r<.1*this._pattern.length()){const t=(0,o.A)(e);return s.z.fromJSONCIM({paths:[t]})}if(!this._walker.init(e,this._pattern,t)){const t=(0,o.A)(e);return s.z.fromJSONCIM({paths:[t]})}}let t;if(this.iteratePath)t=this._pattern.nextValue();else{let e;switch(this._endings){case d.yS.HalfPattern:default:e=.5*this._pattern.firstValue();break;case d.yS.HalfGap:e=.5*-this._pattern.lastValue();break;case d.yS.FullGap:e=-this._pattern.lastValue();break;case d.yS.FullPattern:e=0;break;case d.yS.NoConstraint:case d.yS.Custom:e=-this._customDashPos}let r=e/this._pattern.length();r-=Math.floor(r),e=r*this._pattern.length(),this._pattern.reset(),t=this._pattern.nextValue();let i=!1;for(;e>=t;)e-=t,t=this._pattern.nextValue(),i=!i;t-=e,i?(this._walker.nextPosition(t),t=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(t),t=this._pattern.nextValue(),this._walker.nextPosition(t),t=this._pattern.nextValue())}let r=this._walker.nextCurve(t);if(r)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)r.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else t=this._pattern.nextValue(),!this._walker.nextPosition(t)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(r.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,r=this._firstCurve,this._firstCurve=null;return r?.reset(),r}isClippingRequired(e){const t=(0,o.x)(e);let r=0;for(const i of t)r+=(0,A.Yl)(i);return Math.round(this._numOfDashesPerPattern*(r/this._patternLength))>1e3}}class D{static local(){return null===D.instance&&(D.instance=new D),D.instance}execute(e,t,r,i,n,s){return new F(e,t,r,i,n,s)}}D.instance=null;class F{constructor(e,t,r,i,n,s){switch(this._inputGeometries=e,this._tileKey=i,this._geometryEngine=n,this._maxInflateSize=s*r,this._width=(void 0!==t.width?t.width:2)*r,t.method){case d.M1.Mitered:case d.M1.Bevelled:case d.M1.Rounded:case d.M1.TrueBuffer:case d.M1.Square:}this._option=t.option}next(){let e;for(;e=this._inputGeometries.next();){if("esriGeometryEnvelope"===e.geometryType&&this._width>0){const t=e.asJSON();return Math.min(t.xmax-t.xmin,t.ymax-t.ymin)-2*this._width<0?e:s.z.fromJSONCIM({paths:[[[t.xmin+this._width,t.ymin+this._width],[t.xmax-this._width,t.ymin+this._width],[t.xmax-this._width,t.ymax-this._width],[t.xmin+this._width,t.ymax-this._width],[t.xmin+this._width,t.ymin+this._width]],[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]})}if("esriGeometryPolygon"===e.geometryType){if(0===this._width)return e.clone();const t=this._geometryEngine;if(null==t)return null;const r=this._tileKey?(0,a.q)(e,this._maxInflateSize):e.clone();if(!r)continue;const i=t.buffer(v.A.WebMercator,r.asJSON(),-this._width,1);if(i)for(const e of i.rings)if(e){r.startPath();for(const t of e.reverse())r.pushXY(t[0],r.yFactor*t[1])}return r}}return null}}class k{static local(){return null===k.instance&&(k.instance=new k),k.instance}execute(e,t,r,i,n){return new z(e,t,r)}}k.instance=null;class z extends h{constructor(e,t,r){super(e,!1,!0),this._curveHelper=new f,this._length=(void 0!==t.length?t.length:20)*r,this._angle=void 0!==t.angle?t.angle:225,this._position=void 0!==t.position?t.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const t=s.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const r=e.x,i=e.y;e.seekInPath(e.pathSize-1);const n=e.x,o=e.y,a=[n-r,o-i];this._curveHelper.normalize(a);const l=r+(n-r)*this._position/100,c=i+(o-i)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let h=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(h=-h),this._mirror=!this._mirror;const d=[l-this._length/2*u,c-this._length/2*h],p=[l+this._length/2*u,c+this._length/2*h];return t.pushPath([[r,i],d,p,[n,o]]),t}}class U{static local(){return null===U.instance&&(U.instance=new U),U.instance}execute(e,t,r,i,n){return new V(e,t,r)}}U.instance=null;class V{constructor(e,t,r){this._inputGeometries=e,this._offsetX=void 0!==t.offsetX?t.offsetX*r:0,this._offsetY=void 0!==t.offsetY?t.offsetY*r:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,t,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+t,e.y=e.y+r;return e.reset(),e}}var B=r(19902);class j{static local(){return null===j.instance&&(j.instance=new j),j.instance}execute(e,t,r,i,n,s){return new H(e,t,r,i,n,s)}}j.instance=null;class H{constructor(e,t,r,i,n,s){this._inputGeometries=e,this._tileKey=i,this._geometryEngine=n,this._curveHelper=new f,this._offset=(t.offset??1)*r,this._method=t.method,this._maxInflateSize=Math.max(Math.abs(s*r),10),this._option=t.option,this._offsetFlattenError=p*r}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._offset)return e.clone();if("esriGeometryEnvelope"===e.geometryType){if(this._method===d.xw.Rounded&&this._offset>0){const t=(0,o.A)(e),r=this._curveHelper.offset(t,-this._offset,this._method,4,this._offsetFlattenError);if(r){const t=s.z.createEmptyOptimizedCIM(e.geometryType);return t.pushPath(r),t}return null}const t=e.asJSON();if((0,B.ZC)(t)&&Math.min(t.xmax-t.xmin,t.ymax-t.ymin)+2*this._offset>0)return s.z.fromJSONCIM({xmin:t.xmin-this._offset,xmax:t.xmax+this._offset,ymin:t.ymin-this._offset,ymax:t.ymax+this._offset})}const t=this._geometryEngine;if(null==t)continue;const r=this._tileKey?(0,a.q)(e,this._maxInflateSize):e.clone();if(!r)continue;const i=t.offset(v.A.WebMercator,r.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return i?s.z.fromJSONCIM(i):null}return null}}class G{static local(){return null===G.instance&&(G.instance=new G),G.instance}execute(e,t,r,i,n){return new Z(e,t,r)}}G.instance=null;class Z{constructor(e,t,r){this._inputGeometries=e,this._reverse=void 0===t.reverse||t.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if("esriGeometryPolyline"===e.geometryType)return $(e.clone());e=this._inputGeometries.next()}return null}}function $(e){for(;e.nextPath();)for(let t=0;t<e.pathSize/2;t++){e.seekInPath(t);const r=e.x,i=e.y;e.seekInPath(e.pathSize-t-1);const n=e.x,s=e.y;e.x=r,e.y=i,e.seekInPath(t),e.x=n,e.y=s}return e.reset(),e}var q=r(65391);class W{static local(){return null===W.instance&&(W.instance=new W),W.instance}execute(e,t,r,i,n){return new Y(e,t,r)}}W.instance=null;class Y{constructor(e,t,r){this._inputGeometries=e,this._rotateAngle=void 0!==t.angle?t.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._rotateAngle||"esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const t=(0,q.z8)(e),r=(t[2]+t[0])/2,i=(t[3]+t[1])/2;return e.reset(),this._rotate(e.clone(),r,i)}e=this._inputGeometries.next()}return null}_rotate(e,t,r){const i=Math.cos(this._rotateAngle),n=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const s=e.x-t,o=e.y-r;e.x=t+s*i-o*n,e.y=r+s*n+o*i}return e.reset(),e}}class X{static local(){return null===X.instance&&(X.instance=new X),X.instance}execute(e,t,r,i,n){return new J(e,t,r)}}X.instance=null;class J{constructor(e,t,r){this._inputGeometries=e,this._xFactor=void 0!==t.xScaleFactor?t.xScaleFactor:1.15,this._yFactor=void 0!==t.yScaleFactor?t.yScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(1===this._xFactor&&1===this._yFactor)return e;if("esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const t=(0,q.z8)(e),r=(t[2]+t[0])/2,i=(t[3]+t[1])/2;return e.reset(),this._scaleCursor(e.clone(),r,i)}}return null}_scaleCursor(e,t,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=t+(e.x-t)*this._xFactor,e.y=r+(e.y-r)*this._yFactor;return e.reset(),e}}class K{static local(){return null===K.instance&&(K.instance=new K),K.instance}execute(e,t,r,i,n){return new Q(e,t,r)}}K.instance=null;class Q{constructor(e,t,r){this._inputGeometries=e,this._height=(void 0!==t.amplitude?t.amplitude:2)*r,this._period=(void 0!==t.period?t.period:3)*r,this._style=t.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new C,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new O,this._walker.updateTolerance(r)}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._height||0===this._period)return e;const t=this._processGeom(e);if(t)return t;e=this._inputGeometries.next()}return null}_processGeom(e){const t=s.z.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){t.startPath();const r=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case d.WE.Sinus:default:this._constructCurve(t,r,!1);break;case d.WE.Square:this._constructSquare(t,r);break;case d.WE.Triangle:this._constructTriangle(t,r);break;case d.WE.Random:this._constructCurve(t,r,!0)}else for(;e.nextPoint();)t.pushXY(e.x,e.y)}return t}_constructCurve(e,t,r){let i=Math.round(t/this._period);0===i&&(i=1);const n=16*i+1,s=t/i,o=this._period/16,a=1/n,l=2*Math.PI*t/s,c=2*Math.PI*Math.random(),u=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),d=.75-Math.random()/2,p=.75-Math.random()/2,f=new E;this._walker.curPointAndAngle(f),e.pushPoint(f.pt);let m=0;for(;;){if(!this._walker.nextPointAndAngle(o,f)){e.pushPoint(this._walker.getPathEnd());break}{const t=m;let i;if(m+=a,r){const e=this._height/2*(1+.3*Math.sin(d*l*t+c));i=e*Math.sin(l*t+u),i+=e*Math.sin(p*l*t+h),i/=2}else i=.5*this._height*Math.sin(.5*l*t);e.pushXY(f.pt[0]-i*f.sa,f.pt[1]+i*f.ca)}}}_constructSquare(e,t){Math.round(t/this._period);let r=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const i=new E;this._walker.curPointAndAngle(i);const n=new E;if(this._walker.nextPointAndAngle(this._period,n)){const s=new E;this._walker.nextPointAndAngle(this._period,s)&&(r?(e.pushPoint(i.pt),r=!1):e.pushPoint(i.pt),e.pushXY(i.pt[0]-this._height/2*i.sa,i.pt[1]+this._height/2*i.ca),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(n.pt[0]+this._height/2*n.sa,n.pt[1]-this._height/2*n.ca),e.pushXY(s.pt[0]+this._height/2*s.sa,s.pt[1]-this._height/2*s.ca),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,t){Math.round(t/this._period);let r=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const i=new E;this._walker.curPointAndAngle(i);const n=new E;if(this._walker.nextPointAndAngle(this._period/2,n)){const s=new E;this._walker.nextPointAndAngle(this._period,s)&&(this._walker.nextPosition(this._period/2)&&(r?(e.pushPoint(i.pt),r=!1):e.pushPoint(i.pt),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(s.pt[0]+this._height/2*s.sa,s.pt[1]-this._height/2*s.ca)),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}}class ee{static local(){return null===ee.instance&&(ee.instance=new ee),ee.instance}execute(e,t,r,i,n){return new te(e,t,r)}}ee.instance=null;class te extends u{constructor(e,t,r){super(e),this._geometryWalker=new O,this._geometryWalker.updateTolerance(r),this._angleToLine=t.angleToLine??!0,this._offset=(t.offset?t.offset:0)*r,this._originalEndings=t.endings,this._offsetAtEnd=(t.customEndingOffset?t.customEndingOffset:0)*r,this._position=-(t.offsetAlongLine?t.offsetAlongLine:0)*r,this._pattern=new C,this._pattern.init(t.placementTemplate,!1),this._pattern.scale(r),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath)t=this._pattern.nextValue();else{this._originalEndings===d.e_.WithFullGap&&this.isClosed?this._endings=d.e_.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let r,i=!0;switch(this._endings){case d.e_.NoConstraint:r=-this._position,r=this._adjustPosition(r),i=!1;break;case d.e_.WithHalfGap:default:r=-this._pattern.lastValue()/2;break;case d.e_.WithFullGap:r=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case d.e_.WithMarkers:r=0;break;case d.e_.Custom:r=-this._position,r=this._adjustPosition(r),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,i))return null;this._pattern.reset();let n=0;for(;r>n;)r-=n,n=this._pattern.nextValue();n-=r,t=n,this.iteratePath=!0}const r=new E;return this._geometryWalker.nextPointAndAngle(t,r)?this._endings===d.e_.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===d.e_.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca),this._angleToLine&&this.internalPlacement.setRotateCS(r.ca,r.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let t=e/this._pattern.length();return t-=Math.floor(t),t*this._pattern.length()}}class re{static local(){return null===re.instance&&(re.instance=new re),re.instance}execute(e,t,r,i,n){return new ie(e,t,r)}}re.instance=null;class ie extends u{constructor(e,t,r){super(e,!1,!0),this._curveHelper=new f,this._placePerPart=t.placePerPart??!1,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._type=t.extremityPlacement,this._position=void 0!==t.offsetAlongLine?t.offsetAlongLine*r:0,this._beginProcessed=!1}processMultiPath(e){return this._placePerPart?super.processMultiPath(e):this.processPath(e)}processPath(e){let t;switch(this._type){case d.$2.Both:default:this._beginProcessed?(t=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case d.$2.JustBegin:t=this._atExtremities(e,this._position,!0);break;case d.$2.JustEnd:t=this._atExtremities(e,this._position,!1);case d.$2.None:}return t}_atExtremities(e,t,r){if(this._placePerPart||(r?e.seekPath(0):e.seekPath(e.totalSize-1)),r||e.seekPathEnd(),r?e.nextPoint():e.prevPoint()){let i=0,[n,s]=[0,0],[o,a]=[e.x,e.y];for(;r?e.nextPoint():e.prevPoint();){n=o,s=a,o=e.x,a=e.y;const r=this._curveHelper.getLength(n,s,o,a);if(i+r>t){const e=(t-i)/r,[l,c]=this._curveHelper.getAngleCS(n,s,o,a,e),u=this._curveHelper.getCoord2D(n,s,o,a,e);return this.internalPlacement.setTranslate(u[0]-this._offset*c,u[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(-l,-c),this.internalPlacement}i+=r}}return null}}class ne{static local(){return null===ne.instance&&(ne.instance=new ne),ne.instance}execute(e,t,r,i,n){return new se(e,t,r)}}ne.instance=null;class se extends u{constructor(e,t,r){super(e),this._walker=new O,this._walker.updateTolerance(r),this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._beginGap=void 0!==t.beginPosition?t.beginPosition*r:0,this._endGap=void 0!==t.endPosition?t.endPosition*r:0,this._flipFirst=void 0===t.flipFirst||t.flipFirst,this._pattern=new C,this._pattern.init(t.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath){const e=this._pattern.nextValue()*this._subPathLen,r=this._beginGap+e;t=r-this._prevPos,this._prevPos=r}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const r=this._pattern.nextValue()*this._subPathLen,i=this._beginGap+r;t=i-this._prevPos,this._prevPos=i,this.iteratePath=!0}const r=new E;if(!this._walker.nextPointAndAngle(t,r,R.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca);const i=this._isFirst&&this._flipFirst;let n,s;return this._angleToLine?(n=r.ca,s=r.sa):(n=1,s=0),i&&(n=-n,s=-s),this.internalPlacement.setRotateCS(n,s),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}var oe=r(47249);const ae=512,le=24,ce=1e-6;class ue{static local(){return null===ue.instance&&(ue.instance=new ue),ue.instance}execute(e,t,r,i,n){return new he(e,t,r,i,n)}}ue.instance=null;class he{constructor(e,t,r,i,n){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(t.stepX??16)*r,this._stepY=Math.abs(t.stepY??16)*r,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,0!==this._stepX&&0!==this._stepY){if(this._gridType=t.gridType??d.Q1.Fixed,this._gridType===d.Q1.Random){const e=t.seed??13,r=1;this._randomLCG=new oe.A(e*r),this._randomness=(t.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=t.gridAngle??0,this._shiftOddRows=t.shiftOddRows??!1,this._offsetX=(t.offsetX??0)*r,this._offsetY=(t.offsetY??0)*r,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,null!=i){const[e,t,r,n]=i.split("/"),s=parseFloat(e),o=parseFloat(t),a=parseFloat(r),l=parseFloat(n);this._graphicOriginX=-(l*2**s+a)*ae,this._graphicOriginY=o*ae,this._testInsidePolygon=!0}this._internalPlacement=new l.W,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!he._randValues){he._randValues=[];for(let e=0;e<le;e++)for(let t=0;t<le;t++)he._randValues.push(this._randomLCG.getFloat()),he._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let t,r,i,n,s,o,a,l,c,u,h,d,p,f;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,a=l=p=h=Number.MAX_VALUE,c=u=f=d=-Number.MAX_VALUE;const m=1!==this._cosAngle;for(e.reset();e.nextPath();)for(;e.nextPoint();)o=e.x,s=e.y,t=o-this._graphicOriginX-this._offsetX,r=s-this._graphicOriginY-this._offsetY,m?(i=this._cosAngle*t-this._sinAngle*r,n=this._sinAngle*t+this._cosAngle*r):(i=t,n=r),a=Math.min(a,i),c=Math.max(c,i),l=Math.min(l,n),u=Math.max(u,n),h=Math.min(h,s),d=Math.max(d,s),p=Math.min(p,o),f=Math.max(f,o);h=h!==Number.MAX_VALUE?h:-512-this._stepY,d=d!==-Number.MAX_VALUE?d:this._stepY,p=p!==Number.MAX_VALUE?p:-this._stepX,f=f!==-Number.MAX_VALUE?f:ae+this._stepX;const g=d-h,y=f-p;if(this._verticalSubdivision=g>=y,this._polygonMin=this._verticalSubdivision?h:p,this._testInsidePolygon){let e=0-this._graphicOriginX-this._offsetX-this._stepX,t=ae-this._graphicOriginX-this._offsetX+this._stepX,r=-512-this._graphicOriginY-this._offsetY-this._stepY,i=0-this._graphicOriginY-this._offsetY+this._stepY;if(m){const n=[[e,r],[e,i],[t,r],[t,i]];e=r=Number.MAX_VALUE,t=i=-Number.MAX_VALUE;for(const s of n){const n=this._cosAngle*s[0]-this._sinAngle*s[1],o=this._sinAngle*s[0]+this._cosAngle*s[1];e=Math.min(e,n),t=Math.max(t,n),r=Math.min(r,o),i=Math.max(i,o)}}a=a!==Number.MAX_VALUE?Math.max(a,e):e,l=l!==Number.MAX_VALUE?Math.max(l,r):r,c=c!==-Number.MAX_VALUE?Math.min(c,t):t,u=u!==-Number.MAX_VALUE?Math.min(u,i):i}this._xMin=Math.round(a/this._stepX),this._xMax=Math.round(c/this._stepX),this._yMin=Math.round(l/this._stepY),this._yMax=Math.round(u/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,p,f,h,d)}_buildAccelerationMap(e,t,r,i,n){e.reset();const s=new Map,o=this._verticalSubdivision,a=o?n-i:r-t;let l=Math.ceil(a/10);if(l<=1)return;const c=Math.floor(a/l);let u,h,d,p,f,m,g,y,_,v,b;for(l++,this._delta=c,o?(_=-512-2*this._stepY,v=2*this._stepY,b=i):(_=-2*this._stepX,v=ae+2*this._stepX,b=t);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(u=e.x,h=e.y;e.nextPoint();u=d,h=p){if(d=e.x,p=e.y,o){if(h===p||h<_&&p<_||h>v&&p>v)continue;f=Math.min(h,p),m=Math.max(h,p)}else{if(u===d||u<_&&d<_||u>v&&d>v)continue;f=Math.min(u,d),m=Math.max(u,d)}for(;f<m;)g=Math.floor((f-b)/c),de(g,u,h,d,p,s),f+=c;y=Math.floor((m-b)/c),y>g&&de(y,u,h,d,p,s)}this._accelerationMap=s}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const t=this._currentY*this._stepY+this._offsetY;let r,i;if(this._currentX++,this._gridType===d.Q1.Random){const n=(this._currentX%le+le)%le,s=(this._currentY%le+le)%le;r=this._graphicOriginX+e+this._stepX*this._randomness*(.5-he._randValues[s*le+n])*2/3,i=this._graphicOriginY+t+this._stepY*this._randomness*(.5-he._randValues[s*le+n+1])*2/3}else r=this._graphicOriginX+this._cosAngle*e+this._sinAngle*t,i=this._graphicOriginY-this._sinAngle*e+this._cosAngle*t;if(!this._testInsidePolygon||this._isInsidePolygon(r,i,this._geometryCursor))return this._internalPlacement.setTranslate(r,i),this._internalPlacement}}_isInsidePolygon(e,t,r){if(null==this._accelerationMap)return function(e,t,r){let i,n,s,o,a=0;for(e+=ce,t+=ce,r.reset();r.nextPath();)if(r.nextPoint())for(i=r.x,n=r.y;r.nextPoint();i=s,n=o)s=r.x,o=r.y,n>t!=o>t&&((s-i)*(t-n)-(o-n)*(e-i)>0?a++:a--);return 0!==a}(e,t,r);e+=ce,t+=ce;const i=this._verticalSubdivision,n=i?t:e,s=Math.floor((n-this._polygonMin)/this._delta),o=this._accelerationMap.get(s);if(!o)return!1;let a,l,c,u=0;for(const h of o){if(a=h[0],l=h[1],i){if(a[1]>t==l[1]>t)continue;c=(l[0]-a[0])*(t-a[1])-(l[1]-a[1])*(e-a[0])}else{if(a[0]>e==l[0]>e)continue;c=(l[1]-a[1])*(e-a[0])-(l[0]-a[0])*(t-a[1])}c>0?u++:u--}return 0!==u}}function de(e,t,r,i,n,s){let o=s.get(e);o||(o=[],s.set(e,o)),o.push([[t,r],[i,n]])}class pe{static local(){return null===pe.instance&&(pe.instance=new pe),pe.instance}execute(e,t,r,i,n){return new fe(e,t,r)}}pe.instance=null;class fe extends u{constructor(e,t,r){super(e),this._curveHelper=new f,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._relativeTo=t.relativeTo,this._position=void 0!==t.startPointOffset?t.startPointOffset*r:0,this._epsilon=.001*r}processPath(e){const t=this._position;if(this._relativeTo===d.ip.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[t,r]=[e.x,e.y],[i,n]=[0,0];for(;e.nextPoint();){i=e.x,n=e.y;const s=this._curveHelper.getLength(t,r,i,n);if(s<this._epsilon){t=i,r=n;continue}const o=.5+this._position/s,[a,l]=this._curveHelper.getAngleCS(t,r,i,n,o),c=this._curveHelper.getCoord2D(t,r,i,n,o);return this.internalPlacement.setTranslate(c[0]-this._offset*l,c[1]+this._offset*a),this._angleToLine&&this.internalPlacement.setRotateCS(a,l),this.internalPlacement}}return this.iteratePath=!1,null}const r=this._relativeTo===d.ip.LineEnd;return this.onLine(e,t,r)}onLine(e,t,r){let i,n=!1;switch(this._relativeTo){case d.ip.LineMiddle:default:e.seekPathStart(),i=e.pathLength()/2+t;break;case d.ip.LineBeginning:i=t;break;case d.ip.LineEnd:i=t,n=!0}r?e.seekPathEnd():e.seekPathStart();let s=0;if(r?e.prevPoint():e.nextPoint()){let[t,o]=[e.x,e.y],[a,l]=[0,0];for(;r?e.prevPoint():e.nextPoint();){a=e.x,l=e.y;const r=this._curveHelper.getLength(t,o,a,l);if(s+r>i){const e=(i-s)/r,[c,u]=this._curveHelper.getAngleCS(t,o,a,l,e),h=this._curveHelper.getCoord2D(t,o,a,l,e),d=n?-this._offset:this._offset;return this.internalPlacement.setTranslate(h[0]-d*u,h[1]+d*c),this._angleToLine&&(n?this.internalPlacement.setRotateCS(-c,-u):this.internalPlacement.setRotateCS(c,u)),this.internalPlacement}t=a,o=l,s+=r}}return null}}class me{static local(){return null===me.instance&&(me.instance=new me),me.instance}execute(e,t,r,i,n){return new ge(e,t,r)}}me.instance=null;class ge extends u{constructor(e,t,r){super(e),this._curveHelper=new f,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._endPoints=void 0===t.placeOnEndPoints||t.placeOnEndPoints,this._controlPoints=void 0===t.placeOnControlPoints||t.placeOnControlPoints,this._regularVertices=void 0===t.placeOnRegularVertices||t.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const t=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(t[2]);let r=t[0],i=t[1];if(0!==this._offset){const e=Math.cos(t[2]),n=Math.sin(t[2]);r-=this._offset*n,i+=this._offset*e}return this.internalPlacement.setTranslate(r,i),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const t=e.isClosed();let r=0,i=!1,n=0,s=0;if(e.seekPathStart(),e.nextPoint()){let o=e.x,a=e.y,l=e.getControlPoint(),c=!0,u=e.nextPoint();for(;u;){const h=e.x,d=e.y,p=e.getControlPoint();(this._angleToLine||0!==this._offset)&&(n=this._curveHelper.getAngle(o,a,h,d,0)),c?(c=!1,t?(r=n,i=l):(this._endPoints||this._controlPoints&&l)&&this._tags.push([o,a,n])):l?this._controlPoints&&this._tags.push([o,a,ye(s,n)]):this._regularVertices&&this._tags.push([o,a,ye(s,n)]),(this._angleToLine||0!==this._offset)&&(s=this._curveHelper.getAngle(o,a,h,d,1)),u=e.nextPoint(),u||(t?p||i?this._controlPoints&&this._tags.push([h,d,ye(s,r)]):this._regularVertices&&this._tags.push([h,d,ye(s,r)]):(this._endPoints||this._controlPoints&&p)&&this._tags.push([h,d,s])),o=h,a=d,l=p}}this._tagIterator=0}}function ye(e,t){const r=Math.PI;for(;Math.abs(t-e)>r+2e-15;)t-e>r?t-=2*r:t+=2*r;return(e+t)/2}var _e=r(205),ve=r(88501);class be{static local(){return null===be.instance&&(be.instance=new be),be.instance}execute(e,t,r,i,n){return new we(e,t,r)}}be.instance=null;class we{constructor(e,t,r){this._geometryCursor=e,this._offsetX=void 0!==t.offsetX?t.offsetX*r:0,this._offsetY=void 0!==t.offsetY?t.offsetY*r:0,this._method=void 0!==t.method?t.method:d.YI.OnPolygon,this._internalPlacement=new l.W}next(){const e=this._geometryCursor;return this._geometryCursor=null,e?this._polygonCenter(e):null}_polygonCenter(e){let t=!1;switch(this._method){case d.YI.CenterOfMass:{const r=(0,_e.TP)(e);r&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),t=!0)}break;case d.YI.BoundingBoxCenter:{const r=(0,q.z8)(e);r&&(this._internalPlacement.setTranslate((r[2]+r[0])/2+this._offsetX,(r[3]+r[1])/2+this._offsetY),t=!0)}break;case d.YI.OnPolygon:default:{const r=(0,ve.d)(e);null!==r&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),t=!0)}}return t?this._internalPlacement:null}}function xe(e){if(!e)return null;switch(e.type){case"CIMGeometricEffectAddControlPoints":return i.local();case"CIMGeometricEffectArrow":return y.local();case"CIMGeometricEffectBuffer":return b.local();case"CIMGeometricEffectControlMeasureLine":return x.local();case"CIMGeometricEffectCut":return T.local();case"CIMGeometricEffectDashes":return L.local();case"CIMGeometricEffectDonut":return D.local();case"CIMGeometricEffectJog":return k.local();case"CIMGeometricEffectMove":return U.local();case"CIMGeometricEffectOffset":return j.local();case"CIMGeometricEffectReverse":return G.local();case"CIMGeometricEffectRotate":return W.local();case"CIMGeometricEffectScale":return X.local();case"CIMGeometricEffectWave":return K.local()}return null}function Se(e){if(!e)return null;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":return ee.local();case"CIMMarkerPlacementAtExtremities":return re.local();case"CIMMarkerPlacementAtRatioPositions":return ne.local();case"CIMMarkerPlacementInsidePolygon":return ue.local();case"CIMMarkerPlacementOnLine":return pe.local();case"CIMMarkerPlacementOnVertices":return me.local();case"CIMMarkerPlacementPolygonCenter":return be.local()}return null}},78997:(e,t,r)=>{"use strict";r.d(t,{W:()=>i});class i{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,t){this.tx=e,this.ty=t}setTranslateZ(e){this.tz=e}setRotateCS(e,t){this.rz=void 0,this.rzCos=e,this.rzSin=t}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}}},16355:(e,t,r)=>{"use strict";r.d(t,{Rj:()=>P,mx:()=>R,IT:()=>C});var i=r(85504),n=(r(81806),r(53084)),s=r(76460),o=r(3789),a=r(76931),l=r(84735),c=r(2413),u=r(65391),h=r(205),d=r(19902),p=r(71275);class f{applyColorSubstituition(e,t){if(!t)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:i}=e,n=this._rasterizationCanvas,s=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=i,s.drawImage(e,0,0,r,i));const o=s.getImageData(0,0,r,i).data;if(t)for(const l of t)if(l&&l.oldColor&&4===l.oldColor.length&&l.newColor&&4===l.newColor.length){const[e,t,r,i]=l.oldColor,[n,s,a,c]=l.newColor;if(e===n&&t===s&&r===a&&i===c)continue;for(let l=0;l<o.length;l+=4)e===o[l]&&t===o[l+1]&&r===o[l+2]&&i===o[l+3]&&(o[l]=n,o[l+1]=s,o[l+2]=a,o[l+3]=c)}const a=new ImageData(o,r,i);return s.putImageData(a,0,0),n}tintImageData(e,t){if(!t||t.length<4)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:i}=e,n=this._rasterizationCanvas,s=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=i,s.drawImage(e,0,0,r,i));const o=s.getImageData(0,0,r,i),a=new Uint8Array(o.data),l=[t[0]/255,t[1]/255,t[2]/255,t[3]/255];for(let u=0;u<a.length;u+=4)a[u]*=l[0],a[u+1]*=l[1],a[u+2]*=l[2],a[u+3]*=l[3];const c=new ImageData(new Uint8ClampedArray(a.buffer),r,i);return s.putImageData(c,0,0),n}}var m=r(5271),g=r(78997),y=r(13442),_=r(28808);function v(e){const t=e.getFrame(0);if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)return t;const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const i=r.getContext("2d");return t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0),r}class b{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=e,this.y=t,this.width=r,this.height=i}static fromExtent(e){return new b(e.xmin,-e.ymax,e.xmax-e.xmin,e.ymax-e.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}var w=r(27790);function x(e){return`rgba(${e.slice(0,3).toString()},${e[3]})`}class S{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,i=r.getContext("2d",{willReadFrequently:!0});T(i,t),this._parameters=t,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:n,weight:s}=t.font;this._lineThroughWidthOffset=n&&"line-through"===n?.1*this._lineHeight:0;const o=null!=t.backgroundColor||null!=t.borderLine,l=o?w.y7:0,c=this._computeTextWidth(i,t)+2*l,u=this._lineHeight*this._textLines.length+2*l;if(r.width=c+2*this._lineThroughWidthOffset,r.height=u,0===r.width||0===r.height)return r.width=r.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:r};this._renderedLineHeight=Math.round(this._lineHeight*t.pixelRatio),this._renderedHaloSize=(0,a.Lz)(t.halo.size)*t.pixelRatio,this._renderedWidth=c*t.pixelRatio,this._renderedHeight=u*t.pixelRatio,this._lineThroughWidthOffset*=t.pixelRatio;const h=t.color??[0,0,0,0],d=t.halo&&t.halo.color?t.halo.color:[0,0,0,0];this._fillStyle=x(h),this._haloStyle=function(e){return`rgb(${e.slice(0,3).toString()})`}(d);const p=this._renderedLineHeight,f=this._renderedHaloSize;i.save(),i.clearRect(0,0,r.width,r.height),T(i,t);const m=l*t.pixelRatio,g=function(e,t){return"center"===e?.5*t:"right"===e?t:0}(i.textAlign,this._renderedWidth-2*m)+f+m,y=f+m,_=f>0;let v=this._lineThroughWidthOffset,b=0;if(o){i.save();const e=t.backgroundColor??[0,0,0,0],n=t.borderLine?.color??[0,0,0,0],s=2*(0,a.Lz)(t.borderLine?.size??0);i.fillStyle=x(e),i.strokeStyle=x(n),i.lineWidth=s,i.fillRect(0,0,r.width,r.height),i.strokeRect(0,0,r.width,r.height),i.restore()}_&&this._renderHalo(i,g,y,v,b,t),b+=y,v+=g;for(const a of this._textLines)_?(i.globalCompositeOperation="destination-out",i.fillStyle="rgb(0, 0, 0)",i.fillText(a,v,b),i.globalCompositeOperation="source-over",i.fillStyle=this._fillStyle,i.fillText(a,v,b)):(i.fillStyle=this._fillStyle,i.fillText(a,v,b)),n&&"none"!==n&&this._renderDecoration(i,v,b,n,s),b+=p;i.restore();const S=this._renderedWidth+2*this._lineThroughWidthOffset,M=this._renderedHeight,A=i.getImageData(0,0,S,M),C=new Uint8Array(A.data);if(t.premultiplyColors){let e;for(let t=0;t<C.length;t+=4)e=C[t+3]/255,C[t]=C[t]*e,C[t+1]=C[t+1]*e,C[t+2]=C[t+2]*e}let E,R;switch(t.horizontalAlignment){case"left":E=-.5;break;case"right":E=.5;break;default:E=0}switch(t.verticalAlignment){case"bottom":R=-.5;break;case"top":R=.5;break;case"baseline":R=-1/6;break;default:R=0}return{size:[S,M],image:new Uint32Array(C.buffer),sdf:!1,simplePattern:!1,anchorX:E,anchorY:R,canvas:r}}_renderHalo(e,t,r,i,n,s){const o=this._renderedWidth,a=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=o,this._haloRasterizationCanvas.height=a;const l=this._haloRasterizationCanvas,c=l.getContext("2d");c.clearRect(0,0,o,a),T(c,s);const{decoration:u,weight:h}=s.font;c.fillStyle=this._haloStyle,c.strokeStyle=this._haloStyle,c.lineJoin="round",this._renderHaloNative(c,t,r,u,h),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(l,0,0,o,a,i,n,o,a),e.globalAlpha=1}_renderHaloNative(e,t,r,i,n){const s=this._renderedLineHeight,o=this._renderedHaloSize;for(const a of this._textLines){const l=2*o,c=5,u=.1;for(let s=0;s<c;s++){const o=(1-(c-1)*u+s*u)*l;e.lineWidth=o,e.strokeText(a,t,r),i&&"none"!==i&&this._renderDecoration(e,t,r,i,n,o)}r+=s}}computeTextSize(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,i=r.getContext("2d");T(i,t),this._parameters=t,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const n=this._computeTextWidth(i,t),s=this._lineHeight*this._textLines.length;return r.width=n,r.height=s,[n*t.pixelRatio,s*t.pixelRatio]}_computeTextWidth(e,t){let r=0;for(const n of this._textLines)r=Math.max(r,e.measureText(n).width);const i=t.font;return("italic"===i.style||"oblique"===i.style||"string"==typeof i.weight&&("bold"===i.weight||"bolder"===i.weight)||"number"==typeof i.weight&&i.weight>600)&&(r+=.3*e.measureText("w").width),r+=2*(0,a.Lz)(this._parameters.halo.size),Math.round(r)}_computeLineHeight(){let e=1.275*this._parameters.size;const t=this._parameters.font.decoration;return t&&"underline"===t&&(e*=1.3),Math.round(e+2*(0,a.Lz)(this._parameters.halo.size))}_renderDecoration(e,t,r,i,n,s){const o=.9*this._lineHeight,a="bold"===n?.06:"bolder"===n?.09:.04;switch(e.textAlign){case"center":t-=this._renderedWidth/2;break;case"right":t-=this._renderedWidth}const l=e.textBaseline;if("underline"===i)switch(l){case"top":r+=o;break;case"middle":r+=o/2}else if("line-through"===i)switch(l){case"top":r+=o/1.5;break;case"middle":r+=o/3}const c=s?1.5*s:Math.ceil(o*a);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=c,e.moveTo(t-this._lineThroughWidthOffset,r),e.lineTo(t+this._renderedWidth+2*this._lineThroughWidthOffset,r),e.stroke(),e.restore()}}function T(e,t){const r=Math.max(t.size,.5),i=t.font,n=`${i.style} ${i.weight} ${(0,a.Lz)(r*t.pixelRatio).toFixed(1)}px ${i.family}, sans-serif`;let s;switch(e.font=n,e.textBaseline="top",t.horizontalAlignment){case"left":default:s="left";break;case"right":s="right";break;case"center":s="center"}e.textAlign=s}var M=r(97763);r(5095),r(40392),r(97683);const A=Math.PI/180;class C{constructor(e){this._t=e}static createIdentity(){return new C([1,0,0,0,1,0])}clone(){const e=this._t;return new C(e.slice())}transform(e){const t=this._t;return[t[0]*e[0]+t[1]*e[1]+t[2],t[3]*e[0]+t[4]*e[1]+t[5]]}static createScale(e,t){return new C([e,0,0,0,t,0])}scale(e,t){const r=this._t;return r[0]*=e,r[1]*=e,r[2]*=e,r[3]*=t,r[4]*=t,r[5]*=t,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,t){return new C([0,0,e,0,0,t])}translate(e,t){const r=this._t;return r[2]+=e,r[5]+=t,this}static createRotate(e){const t=Math.cos(e),r=Math.sin(e);return new C([t,-r,0,r,t,0])}rotate(e){return C.multiply(this,C.createRotate(e),this)}angle(){const e=this._t[0],t=this._t[3],r=Math.sqrt(e*e+t*t);return[e/r,t/r]}static multiply(e,t,r){const i=e._t,n=t._t,s=i[0]*n[0]+i[3]*n[1],o=i[1]*n[0]+i[4]*n[1],a=i[2]*n[0]+i[5]*n[1]+n[2],l=i[0]*n[3]+i[3]*n[4],c=i[1]*n[3]+i[4]*n[4],u=i[2]*n[3]+i[5]*n[4]+n[5],h=r._t;return h[0]=s,h[1]=o,h[2]=a,h[3]=l,h[4]=c,h[5]=u,r}invert(){const e=this._t;let t=e[0]*e[4]-e[1]*e[3];if(0===t)return new C([0,0,0,0,0,0]);t=1/t;const r=(e[1]*e[5]-e[2]*e[4])*t,i=(e[2]*e[3]-e[0]*e[5])*t,n=e[4]*t,s=-e[1]*t,o=-e[3]*t,a=e[0]*t;return new C([n,s,r,o,a,i])}}class E{constructor(e,t){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new o.A(g.W,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(t||C.createIdentity()),this._sizeTransfos.push(t?t.scaleRatio():1)}setTransform(e,t){this._transfos=[e||C.createIdentity()],this._sizeTransfos=[t||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,t){const r=t?e.scaleRatio():1;C.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*r)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,t,r){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,t);break;case"CIMTextSymbol":this.drawTextSymbol(e,t,r)}}drawMultiLayerSymbol(e,t){if(!e||!t)return;const r=e.symbolLayers;if(!r)return;const i=e.effects;if(i&&i.length>0){const e=this.executeEffects(i,t);if(e){let t=e.next();for(;t;)this.drawSymbolLayers(r,t.asJSON()),t=e.next()}}else this.drawSymbolLayers(r,t)}executeEffects(e,t){const r=this._resourceManager.geometryEngine;let i=new p.k(l.z.fromJSONCIM(t));for(const n of e){const e=(0,m.A)(n);e&&(i=e.execute(i,n,this.geomUnitsPerPoint(),null,r))}return i}drawSymbolLayers(e,t){let r=e.length;for(;r--;){const i=e[r];if(!i||!1===i.enable)continue;const n=i.effects;if(n&&n.length>0){const e=this.executeEffects(n,t);if(e){let t=null;for(;(t=e.next())&&(this.drawSymbolLayer(i,t.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(i,t);if(this._earlyReturn)return}}drawSymbolLayer(e,t){switch(e.type){case"CIMSolidFill":this.drawSolidFill(t,e.color);break;case"CIMHatchFill":this.drawHatchFill(t,e);break;case"CIMPictureFill":this.drawPictureFill(t,e);break;case"CIMGradientFill":this.drawGradientFill(t,e);break;case"CIMSolidStroke":this.drawSolidStroke(t,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMPictureStroke":this.drawPictureStroke(t,e);break;case"CIMGradientStroke":this.drawGradientStroke(t,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,t)}}drawHatchFill(e,t){const r=function(e,t,r){let i=(0,M.$w)(e.separation,y.D.CIMHatchFill.separation)*r,n=(0,M.$w)(e.rotation);if(0===i)return null;i<0&&(i=-i);let s=0;const o=.5*i;for(;s>o;)s-=i;for(;s<-o;)s+=i;const a=(0,c.vt)();(0,u.Rg)(a,t),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;n>180;)n-=180;for(;n<0;)n+=180;const h=Math.cos(n*A),d=Math.sin(n*A),p=-i*d,f=i*h;let m,g,_,v;s=(0,M.$w)(e.offsetX)*r*d-(0,M.$w)(e.offsetY)*r*h,m=_=Number.MAX_VALUE,g=v=-Number.MAX_VALUE;for(const c of l){const e=c[0],t=c[1],r=h*e+d*t,i=-d*e+h*t;m=Math.min(m,r),_=Math.min(_,i),g=Math.max(g,r),v=Math.max(v,i)}_=Math.floor(_/i)*i;let b=h*m-d*_-p*s/i,w=d*m+h*_-f*s/i,x=h*g-d*_-p*s/i,S=d*g+h*_-f*s/i;const T=1+Math.round((v-_)/i),C=[];for(let c=0;c<T;c++)b+=p,w+=f,x+=p,S+=f,C.push([[b,w],[x,S]]);return{paths:C}}(t,e,this.geomUnitsPerPoint());r&&(this.pushClipPath(e),this.drawMultiLayerSymbol(t.lineSymbol,r),this.popClipPath())}drawPictureFill(e,t){}drawGradientFill(e,t){}drawPictureStroke(e,t){}drawGradientStroke(e,t){}drawMarkerLayer(e,t){const r=e.markerPlacement;if(r){const i=(0,m.c)(r);if(i){const n="CIMMarkerPlacementInsidePolygon"===r.type||"CIMMarkerPlacementPolygonCenter"===r.type&&r.clipAtBoundary;n&&this.pushClipPath(t);const s=i.execute(l.z.fromJSONCIM(t),r,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(s){let t=null;for(;(t=s.next())&&(this.drawMarker(e,t),!this._earlyReturn););}n&&this.popClipPath()}}else{const r=this._placementPool.acquire();if((0,d.fT)(t))r.tx=t.x,r.ty=t.y,this.drawMarker(e,r);else if((0,d.Bi)(t)){const i=(0,h.l8)(t);i&&([r.tx,r.ty]=i,this.drawMarker(e,r))}else for(const i of t.points)if(r.tx=i[0],r.ty=i[1],this.drawMarker(e,r),this._earlyReturn)break;this._placementPool.release(r)}}drawMarker(e,t){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,t);break;case"CIMVectorMarker":this.drawVectorMarker(e,t)}}drawPictureMarker(e,t){if(!e)return;const r=this._resourceManager.getResource(e.url),i=(0,M.$w)(e.size,y.D.CIMPictureMarker.size);if(null==r||i<=0)return;const n=r.width,s=r.height;if(!n||!s)return;const o=n/s,a=(0,M.$w)(e.scaleX,1),l=C.createIdentity(),c=e.anchorPoint;if(c){let t=c.x,r=c.y;"Absolute"!==e.anchorPointUnits&&(t*=i*o*a,r*=i),l.translate(-t,-r)}let u=(0,M.$w)(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*A);let h=(0,M.$w)(e.offsetX),d=(0,M.$w)(e.offsetY);if(h||d){if(this._mapRotation){const e=A*this._mapRotation,t=Math.cos(e),r=Math.sin(e),i=h*r+d*t;h=h*t-d*r,d=i}l.translate(h,d)}const p=this.geomUnitsPerPoint();1!==p&&l.scale(p,p);const f=t.getAngle();f&&l.rotate(f),l.translate(t.tx,t.ty),this.push(l,!1),this.drawImage(e,i),this.pop()}drawVectorMarker(e,t){if(!e)return;const r=e.markerGraphics;if(!r)return;const i=(0,M.$w)(e.size,y.D.CIMVectorMarker.size),n=e.frame,o=n?n.ymax-n.ymin:0,a=i&&o?i/o:1,l=C.createIdentity();n&&l.translate(.5*-(n.xmax+n.xmin),.5*-(n.ymax+n.ymin));const c=e.anchorPoint;if(c){let t=c.x,r=c.y;"Absolute"!==e.anchorPointUnits?n&&(t*=n.xmax-n.xmin,r*=n.ymax-n.ymin):(t/=a,r/=a),l.translate(-t,-r)}1!==a&&l.scale(a,a);let u=(0,M.$w)(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*A);let h=(0,M.$w)(e.offsetX),d=(0,M.$w)(e.offsetY);if(h||d){if(this._mapRotation){const e=A*this._mapRotation,t=Math.cos(e),r=Math.sin(e),i=h*r+d*t;h=h*t-d*r,d=i}l.translate(h,d)}const p=this.geomUnitsPerPoint();1!==p&&l.scale(p,p);const f=t.getAngle();f&&l.rotate(f),l.translate(t.tx,t.ty),this.push(l,e.scaleSymbolsProportionally);for(const m of r){m?.symbol&&m.geometry||s.A.getLogger("esri.symbols.cim.CIMSymbolDrawHelper").error("Invalid marker graphic",m);let e=m.textString;if("number"==typeof e&&(e=e.toString()),this.drawSymbol(m.symbol,m.geometry,e),this._earlyReturn)break}this.pop()}drawTextSymbol(e,t,r){if(!e)return;if(!(0,d.fT)(t))return;if((0,M.$w)(e.height,y.D.CIMTextSymbol.height)<=0)return;const i=C.createIdentity();let n=(0,M.$w)(e.angle);n=-n,n&&i.rotate(n*A);const s=(0,M.$w)(e.offsetX),o=(0,M.$w)(e.offsetY);(s||o)&&i.translate(s,o);const a=this.geomUnitsPerPoint();1!==a&&i.scale(a,a),i.translate(t.x,t.y),this.push(i,!1),this.drawText(e,r),this.pop()}}class R extends E{constructor(e,t){super(e,t),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new b(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return(0,c.fA)(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if((0,d.Bi)(e))this._processPath(e.rings,0);else if((0,d.Rg)(e))this._processPath(e.paths,0);else if((0,d.ZC)(e)){const t=I(e);t&&this._processPath(t.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(e,t,r){if(!e||this._clipCount>0||null==r||r<=0)return;const i=Math.max(.5*this.transformSize((0,M.$w)(r,y.D.CIMSolidStroke.width)),.25);if((0,d.Bi)(e))this._processPath(e.rings,i);else if((0,d.Rg)(e))this._processPath(e.paths,i);else if((0,d.ZC)(e)){const t=I(e);t&&this._processPath(t.rings,i)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(e,t){(0,d.Bi)(t)&&e.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===e.markerPlacement.type&&e.markerPlacement.clipAtBoundary)?this._processPath(t.rings,0):super.drawMarkerLayer(e,t)}drawHatchFill(e,t){this.drawSolidFill(e)}drawPictureFill(e,t){this.drawSolidFill(e)}drawGradientFill(e,t){this.drawSolidFill(e)}drawPictureStroke(e,t){this.drawSolidStroke(e,null,t.width)}drawGradientStroke(e,t){this.drawSolidStroke(e,null,t.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,t){const{url:r}=e,i=(0,M.$w)(e.scaleX,1);let n=i*t,s=t;const o=this._resourceManager.getResource(r);if(null!=o){const e=o.height/o.width;n=i*(t?e>1?t:t/e:o.width),s=t?e>1?t*e:t:o.height}this._merge(this.transformPt([-n/2,-s/2]),0),this._merge(this.transformPt([-n/2,s/2]),0),this._merge(this.transformPt([n/2,-s/2]),0),this._merge(this.transformPt([n/2,s/2]),0)}drawText(e,t){if(!t||0===t.length)return;this._textRasterizer||(this._textRasterizer=new S);const r=L(e);let[i,n]=this._textRasterizer.computeTextSize(t,r);i=(0,a.PN)(i),n=(0,a.PN)(n);let s=0;switch(e.horizontalAlignment){case"Left":s=i/2;break;case"Right":s=-i/2}let o=0;switch(e.verticalAlignment){case"Bottom":o=n/2;break;case"Top":o=-n/2;break;case"Baseline":o=n/6}this._merge(this.transformPt([-i/2+s,-n/2+o]),0),this._merge(this.transformPt([-i/2+s,n/2+o]),0),this._merge(this.transformPt([i/2+s,-n/2+o]),0),this._merge(this.transformPt([i/2+s,n/2+o]),0)}_processPath(e,t){if(e)for(const r of e){const e=r?r.length:0;if(e>1){this._merge(this.transformPt(r[0]),t);for(let i=1;i<e;i++)this._merge(this.transformPt(r[i]),t)}}}_merge(e,t){e[0]-t<this._xmin&&(this._xmin=e[0]-t),e[0]+t>this._xmax&&(this._xmax=e[0]+t),e[1]-t<this._ymin&&(this._ymin=e[1]-t),e[1]+t>this._ymax&&(this._ymax=e[1]+t)}}class P extends E{constructor(e,t,r,i){super(t,r),this._applyAdditionalRenderProps=i,this._colorSubstitutionHelper=new f,this._ctx=e}drawSolidFill(e,t){if(!e)return;if((0,d.Bi)(e))this._buildPath(e.rings,!0);else if((0,d.Rg)(e))this._buildPath(e.paths,!0);else if((0,d.ZC)(e))this._buildPath(I(e).rings,!0);else{if(!(0,d.U9)(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const r=this._ctx;r.fillStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+(t[3]??255)/255+")",r.fill("evenodd")}drawSolidStroke(e,t,r,i,n,s){if(!e||!t||0===r)return;if((0,d.Bi)(e))this._buildPath(e.rings,!0);else if((0,d.Rg)(e))this._buildPath(e.paths,!1);else{if(!(0,d.ZC)(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(I(e).rings,!0)}const o=this._ctx;o.strokeStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+(t[3]??255)/255+")",o.lineWidth=Math.max(this.transformSize(r),.5),this._setCapStyle(i),this._setJoinStyle(n),o.miterLimit=s,o.stroke()}pushClipPath(e){if(this._ctx.save(),(0,d.Bi)(e))this._buildPath(e.rings,!0);else if((0,d.Rg)(e))this._buildPath(e.paths,!0);else{if(!(0,d.ZC)(e))return;this._buildPath(I(e).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,t){const{colorSubstitutions:r,url:i,tintColor:n}=e,s=(0,M.$w)(e.scaleX,1),o=this._resourceManager.getResource(i);if(null==o)return;let a=t*(o.width/o.height),l=t;t||(a=o.width,l=o.height);const c=(0,M.UE)(i)||"src"in o&&(0,M.UE)(o.src);let u="getFrame"in o?v(o):o;r&&(u=this._colorSubstitutionHelper.applyColorSubstituition(u,r)),this._applyAdditionalRenderProps&&!c&&n&&(u=this._colorSubstitutionHelper.tintImageData(u,n));const h=this.transformPt([0,0]),[d,p]=this.getTransformAngle(),f=this.transformSize(1),m=this._ctx;m.save(),m.setTransform({m11:s*f*d,m12:s*f*p,m21:-f*p,m22:f*d,m41:h[0],m42:h[1]}),m.drawImage(u,-a/2,-l/2,a,l),m.restore()}drawText(e,t){if(!t||0===t.length)return;this._textRasterizer||(this._textRasterizer=new S);const r=L(e);r.size*=this.transformSize((0,a.PN)(1));const i=this._textRasterizer.rasterizeText(t,r);if(!i)return;const{size:n,anchorX:s,anchorY:o,canvas:l}=i,c=n[0]*(s+.5),u=n[1]*(o-.5),h=this._ctx,d=this.transformPt([0,0]),[p,f]=this.getTransformAngle();h.save(),h.setTransform({m11:1*p,m12:1*f,m21:-1*f,m22:1*p,m41:d[0]-1*c,m42:d[1]+1*u}),h.drawImage(l,0,0),h.restore()}drawPictureFill(e,t){if(!e)return;let{colorSubstitutions:r,height:i,offsetX:n,offsetY:s,rotation:o,scaleX:a,tintColor:l,url:c}=t;const u=this._resourceManager.getResource(c);if(null==u)return;if((0,d.Bi)(e))this._buildPath(e.rings,!0);else if((0,d.Rg)(e))this._buildPath(e.paths,!0);else if((0,d.ZC)(e))this._buildPath(I(e).rings,!0);else{if(!(0,d.U9)(e))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const h=this._ctx,p=(0,M.UE)(c)||"src"in u&&(0,M.UE)(u.src);let f,m="getFrame"in u?v(u):u;if(r&&(m=this._colorSubstitutionHelper.applyColorSubstituition(m,r)),this._applyAdditionalRenderProps){p||l&&(m=this._colorSubstitutionHelper.tintImageData(m,l)),f=h.createPattern(m,"repeat");const e=this.transformSize(1);o||(o=0),n?n*=e:n=0,s?s*=e:s=0,i&&(i*=e);const t=i?i/u.height:1,r=a&&i?a*i/u.width:1;if(0!==o||1!==t||1!==r||0!==n||0!==s){const e=new DOMMatrix;e.rotateSelf(0,0,-o).translateSelf(n,s).scaleSelf(r,t,1),f.setTransform(e)}}else f=h.createPattern(m,"repeat");h.save(),h.fillStyle=f,h.fill("evenodd"),h.restore()}drawPictureStroke(e,t){if(!e)return;let{colorSubstitutions:r,capStyle:i,joinStyle:s,miterLimit:o,tintColor:l,url:c,width:u}=t;const h=this._resourceManager.getResource(c);if(null==h)return;let p;if((0,d.Bi)(e))p=e.rings;else if((0,d.Rg)(e))p=e.paths;else{if(!(0,d.ZC)(e))return(0,d.U9)(e)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;p=I(e).rings}u||(u=h.width);const f=(0,M.UE)(c)||"src"in h&&(0,M.UE)(h.src);let m="getFrame"in h?v(h):h;r&&(m=this._colorSubstitutionHelper.applyColorSubstituition(m,r)),this._applyAdditionalRenderProps&&(f||l&&(m=this._colorSubstitutionHelper.tintImageData(m,l)));const g=Math.max(this.transformSize((0,a.Lz)(u)),.5),y=g/m.width,_=this._ctx,b=_.createPattern(m,"repeat-y");let w,x;_.save(),this._setCapStyle(i),this._setJoinStyle(s),void 0!==o&&(_.miterLimit=o),_.lineWidth=g;for(let a of p)if(a=(0,n.o8)(a),D(a),a&&!(a.length<=1)){w=this.transformPt(a[0]);for(let e=1;e<a.length;e++){x=this.transformPt(a[e]);const t=O(w,x),r=new DOMMatrix;r.translateSelf(0,w[1]-g/2).scaleSelf(y,y,1).rotateSelf(0,0,90-t),b.setTransform(r),_.strokeStyle=b,_.beginPath(),_.moveTo(w[0],w[1]),_.lineTo(x[0],x[1]),_.stroke(),w=x}}_.restore()}_buildPath(e,t){const r=this._ctx;if(r.beginPath(),e)for(const i of e){const e=i?i.length:0;if(e>1){let n=this.transformPt(i[0]);r.moveTo(n[0],n[1]);for(let t=1;t<e;t++)n=this.transformPt(i[t]),r.lineTo(n[0],n[1]);t&&r.closePath()}}}_setCapStyle(e){switch(e){case _.uT.Butt:this._ctx.lineCap="butt";break;case _.uT.Round:this._ctx.lineCap="round";break;case _.uT.Square:this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case _.wd.Bevel:this._ctx.lineJoin="bevel";break;case _.wd.Round:this._ctx.lineJoin="round";break;case _.wd.Miter:this._ctx.lineJoin="miter"}}}function O(e,t){const r=t[0]-e[0],i=t[1]-e[1];return 180/Math.PI*Math.atan2(i,r)}const I=e=>e?{spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:null;function L(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const r=(0,M.DW)(e),n=(0,M._d)(e.fontStyleName),s=e.fontFamilyName??i.Vb,{weight:o,style:a}=n,l=t*(e.height||5),c=(0,M.Bu)(e.horizontalAlignment),u=(0,M.Nl)(e.verticalAlignment),h=(0,M.pM)(e),d=(0,M.pM)(e.haloSymbol),p=null!=d?t*(e.haloSize??0):0,f="CIMBackgroundCallout"===e.callout?.type?e.callout.backgroundSymbol:null,m=(0,M.pM)(f),g=(0,M.xo)(f),y=(0,M._1)(f);return{color:h,size:l,horizontalAlignment:c,verticalAlignment:u,font:{family:s,style:(0,M.pV)(a),weight:(0,M.Kn)(o),decoration:r},halo:{size:p||0,color:d,style:a},backgroundColor:m,borderLine:null!=g&&null!=y?{size:g,color:y}:null,pixelRatio:1,premultiplyColors:!0}}const N=1e-4;function D(e){let t,r,i,n,s,o=e[0],a=1;for(;a<e.length;)t=e[a][0]-o[0],r=e[a][1]-o[1],n=0!==t?r/t:Math.PI/2,void 0!==i&&n-i<=N?(e.splice(a-1,1),o=s):(s=o,o=e[a],a++),i=n}},67855:(e,t,r)=>{"use strict";r.d(t,{wp:()=>T,ll:()=>S});const i=new(r(23164).A);var n=r(81806),s=r(53084),o=r(76460),a=r(47249),l=r(76931),c=(r(2413),r(65391),r(61425)),u=r(78997),h=r(16355),d=r(13442),p=r(28808),f=r(97763),m=r(84202),g=(r(55033),r(5095));r(40392),r(97683);const y=Math.PI,_=y/2,v=(Math.PI,96/72),b=()=>o.A.getLogger("esri.symbols.cim.CIMSymbolHelper");function w(e,t,r){switch(t.type){case"CIMSymbolReference":return w(e,t.symbol,r);case"CIMPointSymbol":null==r&&(r={x:0,y:0}),e.drawSymbol(t,r);break;case"CIMLineSymbol":null==r&&(r={paths:[[[0,0],[10,0]]]}),e.drawSymbol(t,r);break;case"CIMPolygonSymbol":null==r&&(r={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),e.drawSymbol(t,r);break;case"CIMTextSymbol":{const r={x:0,y:0};e.drawSymbol(t,r);break}case"CIMVectorMarker":{const r=new u.W;e.drawMarker(t,r);break}}return e.envelope()}function x(e){if(!e)return 0;switch(e.type){case"CIMGeometricEffectArrow":return Math.abs(.5*e.width);case"CIMGeometricEffectBuffer":return Math.abs(e.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(e.length);case"CIMGeometricEffectJog":return Math.abs(.5*e.length);case"CIMGeometricEffectMove":return Math.max(Math.abs((0,f.$w)(e.offsetX)),Math.abs((0,f.$w)(e.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(e.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(e.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(e.fromWidth),Math.abs(e.toWidth));case"CIMGeometricEffectWave":return Math.abs(e.amplitude);case"CIMGeometricEffectDonut":return Math.abs(e.width)}}function S(e){if(!e)return 0;let t=0;for(const r of e)t+=x(r);return t}class T{static getEnvelope(e,t,r){if(!e)return null;const i=new h.mx(r);if(Array.isArray(e)){let r;for(const n of e)r?r.union(w(i,n,t)):r=w(i,n,t);return r}return w(i,e,t)}static getTextureAnchor(e,t){const r=this.getEnvelope(e,null,t);if(!r)return[0,0,0];const i=(r.x+.5*r.width)*v,n=(r.y+.5*r.height)*v,s=r.width*v+2,o=r.height*v+2;return[-i/s,-n/o,o]}static rasterize(e,t,r,i){let n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const s=r||this.getEnvelope(t,null,i);if(!s)return[null,0,0,0,0];const o=(s.x+.5*s.width)*v,a=(s.y+.5*s.height)*v;e.width=s.width*v,e.height=s.height*v,r||(e.width+=2,e.height+=2);const l=e.getContext("2d",{willReadFrequently:!0}),c=h.IT.createScale(v,-v);c.translate(.5*e.width-o,.5*e.height+a);const d=new h.Rj(l,i,c);switch(t.type){case"CIMPointSymbol":{const e={type:"point",x:0,y:0};d.drawSymbol(t,e);break}case"CIMVectorMarker":{const e=new u.W;d.drawMarker(t,e);break}}const p=l.getImageData(0,0,e.width,e.height),f=new Uint8Array(p.data);if(n){let e;for(let t=0;t<f.length;t+=4)e=f[t+3]/255,f[t]=f[t]*e,f[t+1]=f[t+1]*e,f[t+2]=f[t+2]*e}return[f,e.width,e.height,-o/e.width,-a/e.height]}static fromTextSymbol(e){const{text:t}=e;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:T.createCIMTextSymbolfromTextSymbol(e),textString:t}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(e){const{height:t,outline:r,width:i,xoffset:n,xscale:s,yoffset:o,yscale:a}=e,l=[],c={type:"CIMPolygonSymbol",symbolLayers:l};if(r){const e=k(r);e&&l.push(e)}let u=e.url;"esriPFS"===e.type&&e.imageData&&(u=e.imageData);const h="angle"in e?e.angle??0:0,d=(i??0)*(s||1),m=(t??0)*(a||1);return l.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:p.O$.Picture,tintColor:null,url:u,height:m,width:d,offsetX:(0,f.$w)(n),offsetY:(0,f.$w)(o),rotation:(0,f.$w)(-h),colorSubstitutions:null}),c}static fromSimpleFillSymbol(e){const{color:t,style:r,outline:i}=e,n=[],o={type:"CIMPolygonSymbol",symbolLayers:n};if(i){const e=k(i);e&&n.push(e)}if(r&&"solid"!==r&&"none"!==r&&"esriSFSSolid"!==r&&"esriSFSNull"!==r){const e={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:P(t),capStyle:p.uT.Butt,joinStyle:p.wd.Miter,width:.75}]};let i=0;const o=(0,l.PN)(F(r)?8:10);switch(r){case"vertical":case"esriSFSVertical":i=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":i=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":i=45;break;case"cross":case"esriSFSCross":i=0}n.push({type:"CIMHatchFill",lineSymbol:e,offsetX:0,offsetY:0,rotation:i,separation:o}),"cross"===r||"esriSFSCross"===r?n.push({type:"CIMHatchFill",lineSymbol:(0,s.o8)(e),offsetX:0,offsetY:0,rotation:90,separation:o}):"diagonal-cross"!==r&&"esriSFSDiagonalCross"!==r||n.push({type:"CIMHatchFill",lineSymbol:(0,s.o8)(e),offsetX:0,offsetY:0,rotation:45,separation:o})}else!r||"solid"!==r&&"esriSFSSolid"!==r||n.push({type:"CIMSolidFill",enable:!0,color:P(t)});return o}static fromSimpleLineSymbol(e){const{cap:t,color:r,join:i,marker:n,miterLimit:s,style:o,width:a}=e;let l=null;"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(l=[{type:"CIMGeometricEffectDashes",dashTemplate:N(o,t),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const c=[];if(n){let e;switch(n.placement){case"begin-end":e=p.$2.Both;break;case"begin":e=p.$2.JustBegin;break;case"end":e=p.$2.JustEnd;break;default:e=p.$2.None}const t=T.fromSimpleMarker(n,a,r).symbolLayers[0];t.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:e,offsetAlongLine:0},c.push(t)}return c.push({type:"CIMSolidStroke",color:"none"!==o&&"esriSLSNull"!==o?P(r):[0,0,0,0],capStyle:A(t),joinStyle:C(i),miterLimit:s,width:a,effects:l}),{type:"CIMLineSymbol",symbolLayers:c}}static fromPictureMarker(e){const{angle:t,height:r,width:i,xoffset:n,yoffset:s}=e;let o=e.url;return"esriPMS"===e.type&&e.imageData&&(o=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:p.O$.Picture,tintColor:null,url:o,size:r,width:i,offsetX:(0,f.$w)(n),offsetY:(0,f.$w)(s),rotation:(0,f.$w)(-t)}]}}static createCIMTextSymbolfromTextSymbol(e){const{angle:t,color:r,font:n,haloColor:s,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:c,text:u,verticalAlignment:h,xoffset:d,yoffset:m,backgroundColor:g,borderLineColor:y,borderLineSize:_}=e;let v,b,w,x,S,T;n&&(v=n.family,b=n.style,w=n.weight,x=n.size,S=n.decoration);let M=!1;return u&&(M=function(e){if(null==e)return["",!1];if(!i.hasBidiChar(e))return[e,!1];let t;return t="rtl"===i.checkContextual(e)?"IDNNN":"ICNNN",[i.bidiTransform(e,t,"VLYSN"),!0]}(u)[1]),(g||_)&&(T={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:P(g)},{type:"CIMSolidStroke",color:P(y),width:_}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:t,blockProgression:p.TZ.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:p.Y.Normal,fontEncoding:p.bj.Unicode,fontFamilyName:v||"Arial",fontStyleName:O(b,w),fontType:p.g7.Unspecified,haloSize:o,height:x,hinting:p.mU.Default,horizontalAlignment:E(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:c,offsetX:(0,f.$w)(d),offsetY:(0,f.$w)(m),strikethrough:"line-through"===S,underline:"underline"===S,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:P(r)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:P(s)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:M?p.f0.RTL:p.f0.LTR,verticalAlignment:R(h??"baseline"),verticalGlyphOrientation:p.vG.Right,wordSpacing:100,billboardMode3D:p.xn.FaceNearPlane,callout:T}}static createPictureMarkerRasterizationParam(e){const{angle:t,height:r,width:i,xoffset:n,yoffset:s}=e,o=e.url??e.source?.url??e.source?.imageData;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:p.O$.Picture,tintColor:null,url:o,size:r,width:i,offsetX:(0,f.$w)(n),offsetY:(0,f.$w)(s),rotation:(0,f.$w)(-t)}}:null}static createPictureFillRasterizationParam(e){const{width:t,height:r,xoffset:i,yoffset:n,url:s}=e;return s?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:p.O$.Picture,tintColor:null,url:s,width:t,height:r,offsetX:(0,f.$w)(i),offsetY:(0,f.$w)(n),rotation:0}}:null}static fromSimpleMarker(e,t,r){const{style:i}=e,n=e.color??r;if("path"===i||"esriSMSPath"===i){const t=[];if("outline"in e&&e.outline){const r=e.outline;t.push({type:"CIMSolidStroke",enable:!0,width:r.width,color:P(r.color),path:e.path})}t.push({type:"CIMSolidFill",enable:!0,color:P(n),path:e.path});const[r,i]=D("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-(0,f.$w)(e.angle),size:(0,f.$w)(e.size||6),offsetX:(0,f.$w)(e.xoffset),offsetY:(0,f.$w)(e.yoffset),scaleSymbolsProportionally:!1,frame:r,markerGraphics:[{type:"CIMMarkerGraphic",geometry:i,symbol:{type:"CIMPolygonSymbol",symbolLayers:t}}]}]}}const s=[];let o,a,l=e.size;if("outline"in e&&e.outline&&"none"!==e.outline.style&&"esriSLSNull"!==e.outline.style){const t=e.outline,r="solid"!==t.style&&"esriSLSSolid"!==t.style;[o,a]=r?D(i,e.size):D(i);const n=t.width??m.A7.width;if(r){const t=n/e.size,r=(o.xmax-o.xmin)*t/2,i=(o.ymax-o.ymin)*t/2;o.xmin-=r,o.xmax+=r,o.ymin-=i,o.ymax+=i,l&&(l+=n)}const c="cross"!==e.style&&"x"!==e.style||"dot"===e?.outline.style||"short-dot"===e?.outline.style?p.yS.HalfGap:p.yS.FullPattern,u=r?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:N(t.style,null).map((e=>t.width&&t.width>0?e*t.width:e)),lineDashEnding:c,controlPointEnding:p.yS.FullPattern}]:void 0;s.push({type:"CIMSolidStroke",capStyle:r?p.uT.Round:p.uT.Butt,enable:!0,width:n,color:P(t.color),effects:u})}else!t||"line-marker"!==e.type||"cross"!==e.style&&"x"!==e.style?[o,a]=D(i):([o,a]=D(i),s.push({type:"CIMSolidStroke",enable:!0,width:t,color:P(n)}));s.push({type:"CIMSolidFill",enable:!0,color:P(n)});const c={type:"CIMPolygonSymbol",symbolLayers:s};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:(0,f.$w)(-e.angle),size:(0,f.$w)(l||6*t),offsetX:(0,f.$w)(e.xoffset),offsetY:(0,f.$w)(e.yoffset),scaleSymbolsProportionally:!1,frame:o,markerGraphics:[{type:"CIMMarkerGraphic",geometry:a,symbol:c}]}]}}static fromCIMHatchFill(e,t){const r=t*(e.separation??d.D.CIMHatchFill.separation),i=r/2,n=(0,s.o8)(e.lineSymbol);n.symbolLayers?.forEach((e=>{switch(e.type){case"CIMSolidStroke":null!=e.width&&(e.width*=t),e.effects?.forEach((e=>{if("CIMGeometricEffectDashes"===e.type){const r=e.dashTemplate;e.dashTemplate=r?.map((e=>e*t))}}));break;case"CIMVectorMarker":{null!=e.size&&(e.size*=t);const r=e.markerPlacement;null!=r&&"placementTemplate"in r&&(r.placementTemplate=r.placementTemplate.map((e=>e*t)));break}}}));let o=this._getLineSymbolPeriod(n)||4;for(;o<4;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-i,ymax:i},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:n}],size:r}}static fetchResources(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return e&&t?(M(e,(e=>{(function(e,t,r){if(!e.effects||null!=t.geometryEngine)return;if(t.geometryEnginePromise)return void r.push(t.geometryEnginePromise);(0,f.yH)(e.effects)&&(t.geometryEnginePromise=(0,f._H)(),r.push(t.geometryEnginePromise),t.geometryEnginePromise.then((e=>t.geometryEngine=e)))})(e,t,r),"url"in e&&e.url&&r.push(t.fetchResource(e.url,{signal:i}))})),r):r}static fetchFonts(e,t,r){if(e&&t)if("symbolLayers"in e&&e.symbolLayers){for(const i of e.symbolLayers)if("CIMVectorMarker"===i.type&&i.markerGraphics)for(const e of i.markerGraphics)e?.symbol&&T.fetchFonts(e.symbol,t,r)}else if("CIMTextSymbol"===e.type){const{fontFamilyName:i,fontStyleName:n}=e;if(!i||"calcitewebcoreicons"===i.toLowerCase())return;const{style:s,weight:o}=(0,f._d)(n),a=(0,f.DW)(e),l=new c.A({family:i,style:s,weight:o,decoration:a});r.push(t.loadFont(l).catch((()=>{b().error(`Unsupported font ${i} in CIM symbol`)})))}}static _getLineSymbolPeriod(e){if(e){const t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers)for(const r of e.symbolLayers)if(r){const e=this._getEffectsRepeat(r.effects);if(e)return e;switch(r.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=this._getPlacementRepeat(r.markerPlacement);if(e)return e}}}}return 0}static _getEffectsRepeat(e){if(e)for(const t of e)if(t)switch(t.type){case"CIMGeometricEffectDashes":{const e=t.dashTemplate;if(e&&e.length){let t=0;for(const r of e)t+=r;return 1&e.length&&(t*=2),t}break}case"CIMGeometricEffectWave":return t.period;default:b().error(`unsupported geometric effect type ${t.type}`)}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const t=e.placementTemplate;if(t&&t.length){let e=0;for(const r of t)e+=+r;return 1&t.length&&(e*=2),e}break}}return 0}static fromCIMInsidePolygon(e){const t=e.markerPlacement,r={...e};r.markerPlacement=null,r.anchorPoint=null;const i=Math.abs(t.stepX),n=Math.abs(t.stepY),s=(t.randomness??100)/100;let o,c,u,h;if("Random"===t.gridType){const e=(0,l.PN)(g.yv),r=Math.max(Math.floor(e/i),1),d=Math.max(Math.floor(e/n),1);o=r*i/2,c=d*n/2,u=2*c;const p=new a.A(t.seed),f=s*i/1.5,m=s*n/1.5;h=[];for(let t=0;t<r;t++)for(let e=0;e<d;e++){const r=t*i-o+f*(.5-p.getFloat()),s=e*n-c+m*(.5-p.getFloat());h.push({x:r,y:s}),0===t&&h.push({x:r+2*o,y:s}),0===e&&h.push({x:r,y:s+2*c})}}else!0===t.shiftOddRows?(o=i/2,c=n,u=2*n,h=[{x:-o,y:0},{x:o,y:0},{x:0,y:c},{x:0,y:-c}]):(o=i/2,c=n/2,u=n,h=[{x:-i,y:0},{x:0,y:-n},{x:-i,y:-n},{x:0,y:0},{x:i,y:0},{x:0,y:n},{x:i,y:n},{x:-i,y:n},{x:i,y:-n}]);return{type:"CIMVectorMarker",frame:{xmin:-o,xmax:o,ymin:-c,ymax:c},markerGraphics:h.map((e=>({type:"CIMMarkerGraphic",geometry:e,symbol:{type:"CIMPointSymbol",symbolLayers:[r]}}))),size:u}}}function M(e,t){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=e.symbolLayers;if(!r)return;for(const e of r)if(t(e),"CIMVectorMarker"===e.type){const r=e.markerGraphics;if(!r)continue;for(const e of r)if(e){const r=e.symbol;r&&M(r,t)}}break}}}const A=e=>{if(!e)return p.uT.Butt;switch(e){case"butt":return p.uT.Butt;case"square":return p.uT.Square;case"round":return p.uT.Round}},C=e=>{if(!e)return p.wd.Miter;switch(e){case"miter":return p.wd.Miter;case"round":return p.wd.Round;case"bevel":return p.wd.Bevel}},E=e=>{if(null==e)return"Center";switch(e){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},R=e=>{if(null==e)return"Center";switch(e){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},P=e=>{if(!e)return[0,0,0,0];const{r:t,g:r,b:i,a:n}=e;return[t,r,i,255*n]},O=(e,t)=>{const r=I(t),i=L(e);return r&&i?`${r}-${i}`:`${r}${i}`},I=e=>{if(!e)return"";switch(e.toLowerCase()){case"bold":case"bolder":return"bold"}return""},L=e=>{if(!e)return"";switch(e.toLowerCase()){case"italic":case"oblique":return"italic"}return""},N=(e,t)=>{const r=(0,n.A)("safari")?.001:0,i="butt"===t;switch(e){case"dash":case"esriSLSDash":return i?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return i?[4,3,1,3]:[3,4,r,4];case"dot":case"esriSLSDot":return i?[1,3]:[r,4];case"long-dash":case"esriSLSLongDash":return i?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return i?[8,3,1,3]:[7,4,r,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return i?[8,3,1,3,1,3]:[7,4,r,4,r,4];case"short-dash":case"esriSLSShortDash":return i?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return i?[4,1,1,1]:[3,2,r,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return i?[4,1,1,1,1,1]:[3,2,r,2,r,2];case"short-dot":case"esriSLSShortDot":return i?[1,1]:[r,2];case"solid":case"esriSLSSolid":case"none":return b().error("Unexpected: style does not require rasterization"),[0,0];default:return b().error(`Tried to rasterize SLS, but found an unexpected style: ${e}!`),[0,0]}};const D=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;const r=t/2;let i,n;const s=e;if("circle"===s||"esriSMSCircle"===s){const e=.25;let t=Math.acos(1-e/r),s=Math.ceil(y/t/4);0===s&&(s=1),t=_/s,s*=4;const o=[];o.push([r,0]);for(let i=1;i<s;i++)o.push([r*Math.cos(i*t),-r*Math.sin(i*t)]);o.push([r,0]),i={rings:[o]},n={xmin:-r,ymin:-r,xmax:r,ymax:r}}else if("cross"===s||"esriSMSCross"===s){const e=0;i={paths:[[[e,r],[e,-r]],[[r,e],[-r,e]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r}}else if("diamond"===s||"esriSMSDiamond"===s)i={rings:[[[-r,0],[0,r],[r,0],[0,-r],[-r,0]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if("square"===s||"esriSMSSquare"===s)i={rings:[[[-r,-r],[-r,r],[r,r],[r,-r],[-r,-r]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if("x"===s||"esriSMSX"===s)i={paths:[[[r,r],[-r,-r]],[[r,-r],[-r,r]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if("triangle"===s||"esriSMSTriangle"===s){const e=.5773502691896257*t,r=-e,s=2/3*t,o=s-t;i={rings:[[[r,o],[0,s],[e,o],[r,o]]]},n={xmin:r,ymin:o,xmax:e,ymax:s}}else"arrow"===s&&(i={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r});return[n,i]},F=e=>"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e;function k(e){if(!e)return null;let t=null;const{cap:r,color:i,join:n,miterLimit:s,style:o,width:a}=e;return"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(t=[{type:"CIMGeometricEffectDashes",dashTemplate:N(o,r),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:"esriSLSNull"!==o&&"none"!==o?P(i):[0,0,0,0],capStyle:A(r),joinStyle:C(n),miterLimit:s,width:a,effects:t}}},48988:(e,t,r)=>{"use strict";r.d(t,{$:()=>u});var i=r(69539),n=r(59784),s=r(53084),o=r(98976),a=r(97763),l=r(52629);const c=e=>{if(!e)return[0,0,0,0];const{r:t,g:r,b:i,a:n}=e;return[t,r,i,255*n]};class u{static findApplicableOverrides(e,t,r){if(e&&t){if(e.primitiveName){let i=!1;for(const t of r)if(t.primitiveName===e.primitiveName){i=!0;break}if(!i)for(const n of t)n.primitiveName===e.primitiveName&&r.push(n)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const i of e.effects)u.findApplicableOverrides(i,t,r);if(e.symbolLayers)for(const i of e.symbolLayers)u.findApplicableOverrides(i,t,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const i of e.effects)u.findApplicableOverrides(i,t,r);if(e.markerPlacement&&u.findApplicableOverrides(e.markerPlacement,t,r),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const i of e.markerGraphics)u.findApplicableOverrides(i,t,r),u.findApplicableOverrides(i.symbol,t,r)}else"CIMCharacterMarker"===e.type?u.findApplicableOverrides(e.symbol,t,r):"CIMHatchFill"===e.type?u.findApplicableOverrides(e.lineSymbol,t,r):"CIMPictureMarker"===e.type&&u.findApplicableOverrides(e.animatedSymbolProperties,t,r)}}}static findEffectOverrides(e,t){if(!e)return null;if("CIMGeometricEffectDashes"===e.type&&(0,a.K3)(e),!t||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const r=(0,a.rB)(e),i=e.primitiveName,n=[];for(const s of t)s.primitiveName===i&&n.push((0,a.rB)(s));return{type:"cim-effect-param",effect:r,overrides:(0,a.pk)(n)}}static async resolveSymbolOverrides(e,t,r,i,n,o,l){if(!e?.symbol)return null;let{symbol:c,primitiveOverrides:h}=e;const d=!!h;if(!d&&!i)return c;c=(0,s.o8)(c),h=(0,s.o8)(h);let p=!0;if(t||(t={attributes:{}},p=!1),d){if(p||(h=h.filter((e=>!e.valueExpressionInfo?.expression.includes("$feature")))),l||(h=h.filter((e=>!e.valueExpressionInfo?.expression.includes("$view")))),h.length>0){const e={spatialReference:r,fields:(0,a.O2)(t.attributes),geometryType:n};await u.createRenderExpressions(h,e),u.evaluateOverrides(h,t,n??"esriGeometryPoint",o,l)}u.applyOverrides(c,h)}return i&&u.applyDictionaryTextOverrides(c,t,i,null),c}static async createRenderExpressions(e,t){const r=[];for(const i of e){const e=i.valueExpressionInfo;if(!e||u._expressionToRenderExpression.has(e.expression))continue;const n=(0,o.Ad)(e.expression,t.spatialReference,t.fields);r.push(n),n.then((t=>u._expressionToRenderExpression.set(e.expression,t)))}r.length>0&&await Promise.all(r)}static evaluateOverrides(e,t,r,i,s){const o={$view:{scale:s?.scale}};for(const a of e){a.value&&"object"==typeof a.value&&(0,n.IB)(a.value)&&("Color"===a.propertyName||"StrokeColor"===a.propertyName)&&(a.value=c(a.value));const e=a.valueExpressionInfo;if(!e)continue;const s=u._expressionToRenderExpression.get(e.expression);s&&(a.value=(0,l.A)(s,t,o,r,i))}}static applyDictionaryTextOverrides(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Normal";if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const s=e.symbolLayers;if(!s)return;for(const o of s)o&&"CIMVectorMarker"===o.type&&u.applyDictionaryTextOverrides(o,t,r,i,"CIMTextSymbol"===e.type?e.textCase:n)}break;case"CIMVectorMarker":{const n=e.markerGraphics;if(!n)return;for(const e of n)e&&u.applyDictionaryTextOverrides(e,t,r,i)}break;case"CIMMarkerGraphic":{const s=e.textString;if(s&&s.includes("[")){const o=(0,a.gQ)(s,r);e.textString=(0,a.FM)(t,o,i,n)}}}}static applyOverrides(e,t,r,i){if(e.primitiveName)for(const n of t)if(n.primitiveName===e.primitiveName){const t=(0,a.YF)(n.propertyName);if(i&&i.push({cim:e,nocapPropertyName:t,value:e[t]}),r){let t=!1;for(const i of r)i.primitiveName===e.primitiveName&&(t=!0);t||r.push(n)}null!=n.value&&(e[t]=n.value)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)u.applyOverrides(n,t,r,i);if(e.symbolLayers)for(const n of e.symbolLayers)u.applyOverrides(n,t,r,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const n of e.effects)u.applyOverrides(n,t,r,i);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const n of e.markerGraphics)u.applyOverrides(n,t,r,i),u.applyOverrides(n.symbol,t,r,i)}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t="";for(const r of e)void 0!==r.value&&(t+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return t}static toValue(e,t){if("DashTemplate"===e)return t.split(" ").map((e=>Number(e)));if("Color"===e){const e=new i.A(t).toRgba();return e[3]*=255,e}return t}}u._expressionToRenderExpression=new Map},13442:(e,t,r)=>{"use strict";r.d(t,{D:()=>i});const i={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0}}},28808:(e,t,r)=>{"use strict";var i,n,s,o,a,l,c,u,h,d,p,f,m,g,y,_,v,b,w,x,S,T,M,A,C,E,R,P,O,I,L,N,D,F,k,z,U,V,B,j,H,G,Z,$,q,W,Y,X,J,K,Q,ee,te,re,ie,ne,se,oe,ae,le,ce;r.d(t,{$2:()=>a,C1:()=>s,JO:()=>n,M1:()=>T,O$:()=>se,Q1:()=>W,TZ:()=>_,WE:()=>P,Y:()=>c,YI:()=>X,bj:()=>u,e_:()=>q,f0:()=>ne,g7:()=>h,ip:()=>Y,mU:()=>O,oF:()=>x,uQ:()=>S,uT:()=>z,vG:()=>ae,wd:()=>j,xR:()=>i,xn:()=>v,xw:()=>C,yS:()=>U}),function(e){e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e[e.UNKNOWN=4]="UNKNOWN"}(i||(i={})),function(e){e[e.BEVEL=0]="BEVEL",e[e.ROUND=1]="ROUND",e[e.MITER=2]="MITER",e[e.UNKNOWN=4]="UNKNOWN"}(n||(n={})),function(e){e[e.SCREEN=0]="SCREEN",e[e.MAP=1]="MAP"}(s||(s={})),function(e){e[e.Tint=0]="Tint",e[e.Ignore=1]="Ignore",e[e.Multiply=99]="Multiply"}(o||(o={})),function(e){e.Both="Both",e.JustBegin="JustBegin",e.JustEnd="JustEnd",e.None="None"}(a||(a={})),function(e){e[e.Mosaic=0]="Mosaic",e[e.Centered=1]="Centered"}(l||(l={})),function(e){e[e.Normal=0]="Normal",e[e.Superscript=1]="Superscript",e[e.Subscript=2]="Subscript"}(c||(c={})),function(e){e[e.MSSymbol=0]="MSSymbol",e[e.Unicode=1]="Unicode"}(u||(u={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.TrueType=1]="TrueType",e[e.PSOpenType=2]="PSOpenType",e[e.TTOpenType=3]="TTOpenType",e[e.Type1=4]="Type1"}(h||(h={})),function(e){e[e.Display=0]="Display",e[e.Map=1]="Map"}(d||(d={})),function(e){e.None="None",e.Loop="Loop",e.Oscillate="Oscillate"}(p||(p={})),function(e){e[e.Z=0]="Z",e[e.X=1]="X",e[e.Y=2]="Y"}(f||(f={})),function(e){e[e.XYZ=0]="XYZ",e[e.ZXY=1]="ZXY",e[e.YXZ=2]="YXZ"}(m||(m={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.RoundedRectangle=1]="RoundedRectangle",e[e.Oval=2]="Oval"}(g||(g={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.Screen=2]="Screen",e[e.Multiply=3]="Multiply",e[e.Add=4]="Add"}(y||(y={})),function(e){e[e.TTB=0]="TTB",e[e.RTL=1]="RTL",e[e.BTT=2]="BTT"}(_||(_={})),function(e){e[e.None=0]="None",e[e.SignPost=1]="SignPost",e[e.FaceNearPlane=2]="FaceNearPlane"}(v||(v={})),function(e){e[e.Float=0]="Float",e[e.String=1]="String",e[e.Boolean=2]="Boolean"}(b||(b={})),function(e){e[e.Intersect=0]="Intersect",e[e.Subtract=1]="Subtract"}(w||(w={})),function(e){e.OpenEnded="OpenEnded",e.Block="Block",e.Crossed="Crossed"}(x||(x={})),function(e){e.FullGeometry="FullGeometry",e.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",e.ReversedFirstSegment="ReversedFirstSegment",e.PerpendicularToSecondSegment="PerpendicularToSecondSegment",e.SecondSegmentWithTicks="SecondSegmentWithTicks",e.DoublePerpendicular="DoublePerpendicular",e.OppositeToFirstSegment="OppositeToFirstSegment",e.TriplePerpendicular="TriplePerpendicular",e.HalfCircleFirstSegment="HalfCircleFirstSegment",e.HalfCircleSecondSegment="HalfCircleSecondSegment",e.HalfCircleExtended="HalfCircleExtended",e.OpenCircle="OpenCircle",e.CoverageEdgesWithTicks="CoverageEdgesWithTicks",e.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",e.GapExtentMidline="GapExtentMidline",e.Chevron="Chevron",e.PerpendicularWithArc="PerpendicularWithArc",e.ClosedHalfCircle="ClosedHalfCircle",e.TripleParallelExtended="TripleParallelExtended",e.ParallelWithTicks="ParallelWithTicks",e.Parallel="Parallel",e.PerpendicularToFirstSegment="PerpendicularToFirstSegment",e.ParallelOffset="ParallelOffset",e.OffsetOpposite="OffsetOpposite",e.OffsetSame="OffsetSame",e.CircleWithArc="CircleWithArc",e.DoubleJog="DoubleJog",e.PerpendicularOffset="PerpendicularOffset",e.LineExcludingLastSegment="LineExcludingLastSegment",e.MultivertexArrow="MultivertexArrow",e.CrossedArrow="CrossedArrow",e.ChevronArrow="ChevronArrow",e.ChevronArrowOffset="ChevronArrowOffset",e.PartialFirstSegment="PartialFirstSegment",e.Arch="Arch",e.CurvedParallelTicks="CurvedParallelTicks",e.Arc90Degrees="Arc90Degrees",e.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks"}(S||(S={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square",e.TrueBuffer="TrueBuffer"}(T||(T={})),function(e){e.ClosePath="ClosePath",e.ConvexHull="ConvexHull",e.RectangularBox="RectangularBox"}(M||(M={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(A||(A={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square"}(C||(C={})),function(e){e.Fast="Fast",e.Accurate="Accurate"}(E||(E={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(R||(R={})),function(e){e.Sinus="Sinus",e.Square="Square",e.Triangle="Triangle",e.Random="Random"}(P||(P={})),function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Force=2]="Force"}(O||(O={})),function(e){e[e.Buffered=0]="Buffered",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.AlongLine=3]="AlongLine"}(I||(I={})),function(e){e[e.Linear=0]="Linear",e[e.Rectangular=1]="Rectangular",e[e.Circular=2]="Circular",e[e.Buffered=3]="Buffered"}(L||(L={})),function(e){e[e.Discrete=0]="Discrete",e[e.Continuous=1]="Continuous"}(N||(N={})),function(e){e[e.AcrossLine=0]="AcrossLine",e[e.AloneLine=1]="AloneLine"}(D||(D={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e[e.Justify=3]="Justify"}(F||(F={})),function(e){e[e.Base=0]="Base",e[e.MidPoint=1]="MidPoint",e[e.ThreePoint=2]="ThreePoint",e[e.FourPoint=3]="FourPoint",e[e.Underline=4]="Underline",e[e.CircularCW=5]="CircularCW",e[e.CircularCCW=6]="CircularCCW"}(k||(k={})),function(e){e.Butt="Butt",e.Round="Round",e.Square="Square"}(z||(z={})),function(e){e.NoConstraint="NoConstraint",e.HalfPattern="HalfPattern",e.HalfGap="HalfGap",e.FullPattern="FullPattern",e.FullGap="FullGap",e.Custom="Custom"}(U||(U={})),function(e){e[e.None=-1]="None",e[e.Custom=0]="Custom",e[e.Circle=1]="Circle",e[e.OpenArrow=2]="OpenArrow",e[e.ClosedArrow=3]="ClosedArrow",e[e.Diamond=4]="Diamond"}(V||(V={})),function(e){e[e.ExtraLeading=0]="ExtraLeading",e[e.Multiple=1]="Multiple",e[e.Exact=2]="Exact"}(B||(B={})),function(e){e.Bevel="Bevel",e.Round="Round",e.Miter="Miter"}(j||(j={})),function(e){e[e.Default=0]="Default",e[e.String=1]="String",e[e.Numeric=2]="Numeric"}(H||(H={})),function(e){e[e.InsidePolygon=0]="InsidePolygon",e[e.PolygonCenter=1]="PolygonCenter",e[e.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(G||(G={})),function(e){e[e.Tint=0]="Tint",e[e.Replace=1]="Replace",e[e.Multiply=2]="Multiply"}(Z||(Z={})),function(e){e[e.ClipAtBoundary=0]="ClipAtBoundary",e[e.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",e[e.DoNotTouchBoundary=2]="DoNotTouchBoundary",e[e.DoNotClip=3]="DoNotClip"}($||($={})),function(e){e.NoConstraint="NoConstraint",e.WithMarkers="WithMarkers",e.WithFullGap="WithFullGap",e.WithHalfGap="WithHalfGap",e.Custom="Custom"}(q||(q={})),function(e){e.Fixed="Fixed",e.Random="Random",e.RandomFixedQuantity="RandomFixedQuantity"}(W||(W={})),function(e){e.LineMiddle="LineMiddle",e.LineBeginning="LineBeginning",e.LineEnd="LineEnd",e.SegmentMidpoint="SegmentMidpoint"}(Y||(Y={})),function(e){e.OnPolygon="OnPolygon",e.CenterOfMass="CenterOfMass",e.BoundingBoxCenter="BoundingBoxCenter"}(X||(X={})),function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(J||(J={})),function(e){e[e.MarkerCenter=0]="MarkerCenter",e[e.MarkerBounds=1]="MarkerBounds"}(K||(K={})),function(e){e[e.None=0]="None",e[e.PropUniform=1]="PropUniform",e[e.PropNonuniform=2]="PropNonuniform",e[e.DifUniform=3]="DifUniform",e[e.DifNonuniform=4]="DifNonuniform"}(Q||(Q={})),function(e){e.Tube="Tube",e.Strip="Strip",e.Wall="Wall"}(ee||(ee={})),function(e){e[e.Random=0]="Random",e[e.Increasing=1]="Increasing",e[e.Decreasing=2]="Decreasing",e[e.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(te||(te={})),function(e){e[e.Relative=0]="Relative",e[e.Absolute=1]="Absolute"}(re||(re={})),function(e){e[e.Normal=0]="Normal",e[e.LowerCase=1]="LowerCase",e[e.Allcaps=2]="Allcaps"}(ie||(ie={})),function(e){e[e.LTR=0]="LTR",e[e.RTL=1]="RTL"}(ne||(ne={})),function(e){e.Draft="Draft",e.Picture="Picture",e.Text="Text"}(se||(se={})),function(e){e[e.Top=0]="Top",e[e.Center=1]="Center",e[e.Baseline=2]="Baseline",e[e.Bottom=3]="Bottom"}(oe||(oe={})),function(e){e[e.Right=0]="Right",e[e.Upright=1]="Upright"}(ae||(ae={})),function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large"}(le||(le={})),function(e){e[e.Calm=0]="Calm",e[e.Rippled=1]="Rippled",e[e.Slight=2]="Slight",e[e.Moderate=3]="Moderate"}(ce||(ce={}))},97763:(e,t,r)=>{"use strict";r.d(t,{$w:()=>m,Bu:()=>M,DW:()=>w,FM:()=>l,K3:()=>I,Kn:()=>v,MM:()=>h,MO:()=>D,Nl:()=>A,O2:()=>C,UE:()=>E,YC:()=>N,YF:()=>P,_1:()=>S,_H:()=>y,_d:()=>b,bs:()=>L,e6:()=>c,gQ:()=>a,jn:()=>p,lW:()=>u,mA:()=>d,n5:()=>R,pM:()=>x,pV:()=>_,pk:()=>F,rB:()=>k,s4:()=>n,xo:()=>T,yH:()=>g,zb:()=>O,zr:()=>f});var i=r(13442);function n(e,t,r,i){return function(e){return"function"==typeof e}(e)?e(t,r,i):e}const s=" /-,\n";function o(e){let t=e.length;for(;t--;)if(!s.includes(e.charAt(t)))return!1;return!0}function a(e,t){const r=[];let i=0,n=-1;do{if(n=e.indexOf("[",i),n>=i){if(n>i){const t=e.substr(i,n-i);r.push([t,null,o(t)])}if(i=n+1,n=e.indexOf("]",i),n>=i){if(n>i){const s=t[e.substr(i,n-i)];s&&r.push([null,s,!1])}i=n+1}}}while(-1!==n);if(i<e.length-1){const t=e.substr(i);r.push([t,null,o(t)])}return r}function l(e,t,r,i){let n="",s=null;for(const o of t){const[t,i,a]=o;if(t)a?s=t:(s&&(n+=s,s=null),n+=t);else{let t=i;null!=r&&(t=D(i,r));const o=e.attributes[t];o&&(s&&(n+=s,s=null),n+=o)}}return function(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}(n,i)}function c(e){return e?[e[0],e[1],e[2],e[3]/255]:[0,0,0,0]}function u(e){return e.data?.symbol??null}function h(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type}function d(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type}function p(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)}function f(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type)}const m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==e||isNaN(e)?t:e},g=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function y(){return Promise.all([r.e(2612),r.e(1669)]).then(r.bind(r,1669))}function _(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function v(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function b(e){let t="normal",r="normal";if(e){const i=e.toLowerCase();i.includes("italic")?t="italic":i.includes("oblique")&&(t="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:t,weight:r}}function w(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}function x(e){if(!e)return null;switch(e.type){case"CIMPolygonSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=x(t);if(null!=e)return e}break;case"CIMTextSymbol":return x(e.symbol);case"CIMSolidFill":return e.color}return null}function S(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const t=e.symbolLayers;if(t)for(const e of t){const t=S(e);if(null!=t)return t}break}case"CIMTextSymbol":return S(e.symbol);case"CIMSolidStroke":return e.color}}function T(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=T(t);if(void 0!==e)return e}break;case"CIMTextSymbol":return T(e.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return e.width}}function M(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function A(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function C(e){return(e?Object.keys(e):[]).map((t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"})))}const E=e=>e.includes("data:image/svg+xml");function R(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function P(e){return e?e.charAt(0).toLowerCase()+e.substring(1):e}function O(e,t,r,i,n,s){const{infos:o}=s;let a=1,l=0,c=0,u=0;for(const{offsetX:p,offsetY:f,rotation:m,size:g,frameHeight:y,rotateClockWise:_}of o)c=U(p,f,l,a,c),u=z(p,f,l,a,u),y&&(a*=g/y),l=V(m,_,l);const h=U(i,n,l,a,c),d=z(i,n,l,a,u);return{size:e*a,rotation:V(t,r,l),offsetX:h,offsetY:d}}function I(e){return e?.dashTemplate&&"string"==typeof e.dashTemplate&&(e.dashTemplate=e.dashTemplate.split(" ").map(Number)),e}function L(e){if(null==e)return"Normal";switch(e.type){case"CIMTextSymbol":return e.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const t=e.symbolLayers;if(!t)return"Normal";for(const e of t)if("CIMVectorMarker"===e.type)return L(e)}break;case"CIMVectorMarker":{const t=e.markerGraphics;if(!t)return"Normal";for(const e of t)if(e.symbol)return L(e.symbol)}}return"Normal"}function N(e){if(e)switch(e.type){case"CIMTextSymbol":return e.height;case"CIMPointSymbol":{let t=0;if(e.symbolLayers)for(const r of e.symbolLayers)if(r)switch(r.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=r.size??i.D.CIMVectorMarker.size;e>t&&(t=e);break}}return t}case"CIMLineSymbol":case"CIMPolygonSymbol":{let t=0;if(e.symbolLayers)for(const r of e.symbolLayers)if(r)switch(r.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=r.width;null!=e&&e>t&&(t=e);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(r.markerPlacement&&f(r.markerPlacement)){const e=r.size??i.D.CIMVectorMarker.size;e>t&&(t=e)}break;case"CIMPictureFill":{const e=r.height;null!=e&&e>t&&(t=e)}}return t}}}function D(e,t){if(null!==t){const r=t.get(e);return r?r.name:e}return e}function F(e){return e.map((e=>({...e,propertyName:P(e.propertyName)})))}function k(e){const t={};for(const r in e){const i=e[r];t[P(r)]=i}return t}function z(e,t,r,i,n){const s=r*Math.PI/180;if(s){const r=Math.cos(s);return(Math.sin(s)*e+r*t)*i+n}return t*i+n}function U(e,t,r,i,n){const s=r*Math.PI/180;return s?(Math.cos(s)*e-Math.sin(s)*t)*i+n:e*i+n}function V(e,t,r){return t?r-e:r+e}},27842:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i=r(35143),n=r(69539),s=r(42553),o=r(53084),a=r(76931),l=r(46053),c=(r(81806),r(76460),r(85842)),u=r(85192);let h=class extends s.oY{constructor(e){super(e),this.color=new n.A([0,0,0,1]),this.extensionLength=0,this.size=(0,a.PN)(1)}clone(){}cloneProperties(){return{color:(0,o.o8)(this.color),size:this.size,extensionLength:this.extensionLength}}};(0,i._)([(0,l.MZ)({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],h.prototype,"type",void 0),(0,i._)([(0,l.MZ)(u.E)],h.prototype,"color",void 0),(0,i._)([(0,l.MZ)({...u.p,json:{write:{overridePolicy:e=>({enabled:!!e})}}})],h.prototype,"extensionLength",void 0),(0,i._)([(0,l.MZ)(u.p)],h.prototype,"size",void 0),h=(0,i._)([(0,c.$)("esri.symbols.edges.Edges3D")],h);const d=h},73471:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i,n=r(35143),s=(r(76460),r(81806),r(47249),r(50076),r(6409)),o=r(85842),a=r(27842);let l=i=class extends a.A{constructor(e){super(e),this.type="solid"}clone(){return new i(this.cloneProperties())}};(0,n._)([(0,s.e)({solid:"solid"},{readOnly:!0})],l.prototype,"type",void 0),l=i=(0,n._)([(0,o.$)("esri.symbols.edges.SolidEdges3D")],l);const c=l},73572:(e,t,r)=>{"use strict";r.d(t,{J:()=>h});var i,n=r(27842),s=r(35143),o=(r(76460),r(81806),r(47249),r(50076),r(6409)),a=r(85842);let l=i=class extends n.A{constructor(e){super(e),this.type="sketch"}clone(){return new i(this.cloneProperties())}};(0,s._)([(0,o.e)({sketch:"sketch"},{readOnly:!0})],l.prototype,"type",void 0),l=i=(0,s._)([(0,a.$)("esri.symbols.edges.SketchEdges3D")],l);const c=l;var u=r(73471);const h={types:{key:"type",base:n.A,typeMap:{solid:u.A,sketch:c}},json:{write:!0}}},33019:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var i=r(35143),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842));let a=class extends n.oY{constructor(e){super(e)}clone(){throw new Error("Subclasses of LinePattern3D should implement their own clone method.")}};(0,i._)([(0,s.MZ)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],a.prototype,"type",void 0),a=(0,i._)([(0,o.$)("esri.symbols.patterns.LinePattern3D")],a);const l=a},34870:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var i=r(35143),n=r(45802),s=r(46053),o=(r(81806),r(76460),r(47249),r(6409)),a=r(85842),l=r(33019);var c;const u=(0,n.O)()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let h=c=class extends l.A{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new c(e)}};(0,i._)([(0,s.MZ)({type:["style"]})],h.prototype,"type",void 0),(0,i._)([(0,o.e)(u),(0,s.MZ)({type:["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"]})],h.prototype,"style",void 0),h=c=(0,i._)([(0,a.$)("esri.symbols.patterns.LineStylePattern3D")],h);const d=h},5501:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var i=r(35143),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842));let a=class extends n.oY{constructor(e){super(e),this.type="style"}clone(){throw new Error("Subclasses of Pattern3D should implement their own clone method.")}};(0,i._)([(0,s.MZ)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],a.prototype,"type",void 0),a=(0,i._)([(0,o.$)("esri.symbols.patterns.Pattern3D")],a);const l=a},91441:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i=r(35143),n=r(46053),s=(r(81806),r(76460),r(47249),r(85842)),o=r(5501);var a;let l=a=class extends o.A{constructor(e){super(e),this.type="style",this.style="solid"}clone(){return new a({style:this.style})}};(0,i._)([(0,n.MZ)({type:["style"]})],l.prototype,"type",void 0),(0,i._)([(0,n.MZ)({type:["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"],json:{read:!0,write:!0}})],l.prototype,"style",void 0),l=a=(0,i._)([(0,s.$)("esri.symbols.patterns.StylePattern3D")],l);const c=l},80669:(e,t,r)=>{"use strict";r.d(t,{r:()=>a,v:()=>l});var i=r(33019),n=r(34870),s=r(5501),o=r(91441);const a={types:{key:"type",base:s.A,typeMap:{style:o.A}},json:{write:!0}},l={types:{key:"type",base:i.A,typeMap:{style:n.A}},json:{write:!0}}},731:(e,t,r)=>{"use strict";r.d(t,{A:()=>b});var i,n=r(35143),s=r(45802),o=r(42553),a=r(30726),l=r(46053),c=(r(81806),r(76460),r(47249),r(28379)),u=r(85842),h=r(17707),d=r(53430);let p=i=class extends o.oY{constructor(e){super(e)}async collectRequiredFields(e,t){return(0,d.Dx)(e,t,this.expression)}clone(){return new i({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],p.prototype,"expression",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],p.prototype,"title",void 0),p=i=(0,n._)([(0,u.$)("esri.symbols.support.FeatureExpressionInfo")],p);const f=p;var m,g=r(59097);const y=(0,s.O)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),_=new s.J({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let v=m=class extends o.oY{constructor(e){super(e),this.offset=null}readFeatureExpressionInfo(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,r,i){t[r]=e.write({},i),"0"===e.expression&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):null!=e||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new m({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&(0,a.CM)(this.featureExpressionInfo,e.featureExpressionInfo)}};(0,n._)([(0,l.MZ)({type:f,json:{write:!0}})],v.prototype,"featureExpressionInfo",void 0),(0,n._)([(0,c.w)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],v.prototype,"readFeatureExpressionInfo",null),(0,n._)([(0,h.K)("featureExpressionInfo",{featureExpressionInfo:{type:f},"featureExpression.value":{type:[0]}})],v.prototype,"writeFeatureExpressionInfo",null),(0,n._)([(0,l.MZ)({type:y.apiValues,nonNullable:!0,json:{type:y.jsonValues,read:y.read,write:{writer:y.write,isRequired:!0}}})],v.prototype,"mode",null),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],v.prototype,"offset",void 0),(0,n._)([(0,l.MZ)({type:g.KQ,json:{type:String,read:_.read,write:_.write}})],v.prototype,"unit",null),v=m=(0,n._)([(0,u.$)("esri.symbols.support.ElevationInfo")],v);const b=v},76589:(e,t,r)=>{"use strict";r.d(t,{i:()=>m,r:()=>g});var i,n=r(35143),s=r(45802),o=r(42553),a=r(90534),l=r(46053),c=(r(81806),r(76460),r(47249),r(6409)),u=r(28379),h=r(85842),d=r(17707),p=r(79453);const f=(0,s.O)()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let m=i=class extends o.oY{constructor(e){super(e)}readHref(e,t,r){return e?(0,p.f)(e,r):t.dataURI}writeHref(e,t,r,i){e&&((0,a.DB)(e)?t.dataURI=e:(t.href=(0,p.t)(e,i),(0,a.oP)(t.href)&&(t.href=(0,a.S8)(t.href))))}clone(){return new i({href:this.href,primitive:this.primitive})}};(0,n._)([(0,l.MZ)({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],m.prototype,"href",void 0),(0,n._)([(0,u.w)("href")],m.prototype,"readHref",null),(0,n._)([(0,d.K)("href",{href:{type:String},dataURI:{type:String}})],m.prototype,"writeHref",null),(0,n._)([(0,c.e)(f)],m.prototype,"primitive",void 0),m=i=(0,n._)([(0,h.$)("esri.symbols.support.IconSymbol3DLayerResource")],m);const g="circle"},47675:(e,t,r)=>{"use strict";r.d(t,{E:()=>d,r:()=>p});var i,n=r(35143),s=r(45802),o=r(42553),a=r(46053),l=(r(81806),r(76460),r(47249),r(6409)),c=r(85842),u=r(79453);const h=(0,s.O)()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let d=i=class extends o.oY{clone(){return new i({href:this.href,primitive:this.primitive})}};(0,n._)([(0,a.MZ)({type:String,json:{read:u.r,write:u.w}})],d.prototype,"href",void 0),(0,n._)([(0,l.e)(h)],d.prototype,"primitive",void 0),d=i=(0,n._)([(0,c.$)("esri.symbols.support.ObjectSymbol3DLayerResource")],d);const p="sphere"},24141:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(91967),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842)),l=r(65308);let c=i=class extends s.A{constructor(e){super(e),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new i({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};(0,n._)([(0,o.MZ)({type:String})],c.prototype,"name",void 0),(0,n._)([(0,o.MZ)({type:String})],c.prototype,"styleUrl",void 0),(0,n._)([(0,o.MZ)({type:String})],c.prototype,"styleName",void 0),(0,n._)([(0,o.MZ)({type:l.A})],c.prototype,"portal",void 0),c=i=(0,n._)([(0,a.$)("esri.symbols.support.StyleOrigin")],c);const u=c},93223:(e,t,r)=>{"use strict";r.d(t,{Q:()=>l});var i,n=r(35143),s=r(91967),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842));let l=i=class extends s.A{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new i({x:this.x,y:this.y})}};(0,n._)([(0,o.MZ)({type:Number})],l.prototype,"x",void 0),(0,n._)([(0,o.MZ)({type:Number})],l.prototype,"y",void 0),l=i=(0,n._)([(0,a.$)("esri.symbols.support.Symbol3DAnchorPosition2D")],l)},9994:(e,t,r)=>{"use strict";r.d(t,{N:()=>c});var i,n=r(35143),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842)),l=r(85192);let c=i=class extends s.oY{constructor(e){super(e),this.color=null}clone(){const e={color:null!=this.color?this.color.clone():null};return new i(e)}};(0,n._)([(0,o.MZ)(l.E)],c.prototype,"color",void 0),c=i=(0,n._)([(0,a.$)("esri.symbols.support.Symbol3DMaterial")],c)},48670:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842)),l=r(85192);let c=i=class extends s.oY{constructor(e){super(e),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new i({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};(0,n._)([(0,o.MZ)(l.p)],c.prototype,"screenLength",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,json:{write:!0,default:0}})],c.prototype,"minWorldLength",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"maxWorldLength",void 0),c=i=(0,n._)([(0,a.$)("esri.symbols.support.Symbol3DVerticalOffset")],c);const u=c},25158:(e,t,r)=>{"use strict";r.d(t,{V:()=>l});var i,n=r(35143),s=r(91967),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842));let l=i=class extends s.A{constructor(){super(...arguments),this.url=""}clone(){return new i({url:this.url})}};(0,n._)([(0,o.MZ)({type:String})],l.prototype,"url",void 0),l=i=(0,n._)([(0,a.$)("esri.symbols.support.Thumbnail")],l)},29632:(e,t,r)=>{"use strict";r.d(t,{Fe:()=>h,Km:()=>s,Nk:()=>l});var i=r(69539),n=r(97763);function s(e,t,r,i){if(e)if("CIMTextSymbol"!==e.type){if(r&&e.effects)for(const r of e.effects)a(r,t);if(e.symbolLayers)for(const r of e.symbolLayers)switch(r.type){case"CIMPictureMarker":case"CIMVectorMarker":o(r,t,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!i?.preserveOutlineWidth&&r.width&&(r.width*=t);break;case"CIMPictureFill":r.height&&(r.height*=t),r.offsetX&&(r.offsetX*=t),r.offsetY&&(r.offsetY*=t);break;case"CIMHatchFill":s(r.lineSymbol,t,!0,{...i,preserveOutlineWidth:!1}),r.offsetX&&(r.offsetX*=t),r.offsetY&&(r.offsetY*=t),r.separation&&(r.separation*=t)}}else null!=e.height&&(e.height*=t)}function o(e,t,r){if(e&&(e.markerPlacement&&function(e,t){switch((0,n.zr)(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map((e=>e*t));e.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map((e=>e*t));e.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=null!=e.size?e.size*t:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const i of e.markerGraphics)e.scaleSymbolsProportionally||s(i.symbol,t,!0,r)}function a(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const r=e.dashTemplate.map((e=>e*t));e.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function l(e){const t=[];return c((0,n.lW)(e),t),t.length?new i.A((0,n.e6)(t[0])):null}function c(e,t){if(!e)return;let r;r="CIMTextSymbol"===e.type?e.symbol:e;const i="CIMPolygonSymbol"===e.type;if(r?.symbolLayers)for(const s of r.symbolLayers)if(!(s.colorLocked||i&&((0,n.mA)(s)||(0,n.MM)(s)&&s.markerPlacement&&(0,n.zr)(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&u(t,s.tintColor);break;case"CIMVectorMarker":s.markerGraphics?.forEach((e=>{c(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":u(t,s.color);break;case"CIMHatchFill":c(s.lineSymbol,t)}}function u(e,t){for(const r of e)if(r.join(".")===t.join("."))return;e.push(t)}function h(e,t,r){t instanceof i.A||(t=new i.A(t));const s=(0,n.lW)(e);s&&d(s,t,r)}function d(e,t,r){if(!e)return;let i;i="CIMTextSymbol"===e.type?e.symbol:e;const s="CIMPolygonSymbol"===i?.type;if(i?.symbolLayers)for(const o of i.symbolLayers){if(o.colorLocked)continue;if(s)if(r){const{layersToColor:e}=r;if(((0,n.mA)(o)||(0,n.MM)(o)&&o.markerPlacement&&(0,n.zr)(o.markerPlacement))&&"fill"===e||(0,n.jn)(o)&&"outline"===e)continue}else if((0,n.mA)(o)||(0,n.MM)(o)&&o.markerPlacement&&(0,n.zr)(o.markerPlacement))continue;const e=t.toArray();switch(o.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":o.tintColor=e;break;case"CIMVectorMarker":o.markerGraphics?.forEach((e=>{d(e.symbol,t,r)}));break;case"CIMSolidStroke":case"CIMSolidFill":o.color=e;break;case"CIMHatchFill":d(o.lineSymbol,t,r)}}}},39196:(e,t,r)=>{"use strict";r.d(t,{ON:()=>n,U9:()=>o,u7:()=>s});var i=r(69539);const n=new i.A("white"),s=(new i.A("black"),new i.A([255,255,255,0]));function o(e){return 0===e.r&&0===e.g&&0===e.b}},84202:(e,t,r)=>{"use strict";r.d(t,{A7:()=>c,Cx:()=>u,Hk:()=>h,SF:()=>d,UK:()=>l});r(81806);var i=r(86875),n=r(7246),s=r(76940),o=r(86659),a=r(44460);const l=s.A.fromJSON(a.Cb),c=n.A.fromJSON(a.yM),u=i.A.fromJSON(a.WR),h=o.A.fromJSON(a.JZ);function d(e){if(null==e)return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return l;case"polyline":return c;case"polygon":case"extent":return u}return null}s.A.fromJSON(a.nC),n.A.fromJSON(a.HW),i.A.fromJSON(a.b6)},46265:(e,t,r)=>{"use strict";r.d(t,{af:()=>b,al:()=>v,dX:()=>w});var i=r(69539),n=(r(95444),r(19276)),s=(r(81806),r(76931)),o=r(84847),a=r(34913),l=r(94918),c=r(37471),u=r(74343),h=r(73471),d=r(84202),p=r(44460),f=r(22189);const m=c.A.fromSimpleMarkerSymbol(d.UK),g=a.A.fromSimpleLineSymbol(d.A7),y=u.A.fromSimpleFillSymbol(d.Cx),_=new l.A({symbolLayers:new n.A([new o.A({material:{color:p.fT},edges:new h.A({size:(0,s.PN)(1),color:new i.A(p.JR)})})])}),v=new a.A({symbolLayers:new n.A([new f.A({material:{color:new i.A([0,0,0])},size:(0,s.PN)(1)})])}),b=new u.A({symbolLayers:new n.A([new o.A({outline:{color:new i.A([0,0,0]),size:(0,s.PN)(1)}})])});function w(e){if(null==e)return null;switch(e.type){case"mesh":return _;case"point":case"multipoint":return m;case"polyline":return g;case"polygon":case"extent":return y}return null}},44460:(e,t,r)=>{"use strict";r.d(t,{Cb:()=>s,HW:()=>u,JR:()=>n,JZ:()=>l,WR:()=>a,b6:()=>h,fT:()=>i,nC:()=>c,yM:()=>o});const i=[252,146,31,255],n=[153,153,153,255],s={type:"esriSMS",style:"esriSMSCircle",size:6,color:i,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},o={type:"esriSLS",style:"esriSLSSolid",width:.75,color:i},a={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},c={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},u={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},h={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},87840:(e,t,r)=>{"use strict";r.d(t,{$4:()=>v,O0:()=>b,O1:()=>w,Sw:()=>x,eH:()=>y,rc:()=>_});var i=r(28899),n=r(69539),s=r(3825),o=r(53521),a=r(76931),l=r(29632);const c="picture-fill",u="simple-fill",h="simple-line",d="simple-marker",p="text",f="cim",m=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),g=new o.q(1e3);function y(e){const t=e.style;let r=null;if(e)switch(e.type){case d:"cross"!==t&&"x"!==t&&(r=e.color);break;case u:t&&"solid"!==t?"none"!==t&&(r={type:"pattern",x:0,y:0,src:(0,i.s)(`esri/symbols/patterns/${t}.png`),width:5,height:5}):r=e.color;break;case c:r={type:"pattern",src:e.url,width:(0,a.Lz)(e.width)*e.xscale,height:(0,a.Lz)(e.height)*e.yscale,x:(0,a.Lz)(e.xoffset),y:(0,a.Lz)(e.yoffset)};break;case p:r=e.color;break;case f:r=(0,l.Nk)(e)}return r}function _(e,t){const r=e+"-"+t;return void 0!==g.get(r)?Promise.resolve(g.get(r)):(0,s.A)(e,{responseType:"image"}).then((e=>{const i=e.data,n=i.naturalWidth,s=i.naturalHeight,o=document.createElement("canvas");o.width=n,o.height=s;const a=o.getContext("2d");a.fillStyle=t,a.fillRect(0,0,n,s),a.globalCompositeOperation="destination-in",a.drawImage(i,0,0);const l=o.toDataURL();return g.put(r,l),l}))}function v(e){if(!e)return null;let t=null;switch(e.type){case u:case c:case d:t=v(e.outline);break;case h:{const r=(0,a.Lz)(e.width);null!=e.style&&"none"!==e.style&&0!==r&&(t={color:e.color,style:w(e.style),width:r,cap:e.cap,join:"miter"===e.join?(0,a.Lz)(e.miterLimit):e.join},t.dashArray=b(t).join(",")||"none");break}default:t=null}return t}function b(e){if(!e?.style)return[];const{dashArray:t,style:r,width:i}=e;if("string"==typeof t&&"none"!==t)return t.split(",").map((e=>Number(e)));const n=i??0,s=m.has(r)?m.get(r).map((e=>e*n)):[];if("butt"!==e.cap)for(const[o,a]of s.entries())s[o]=o%2==1?a+n:Math.max(a-n,1);return s}const w=(()=>{const e={};return t=>{if(e[t])return e[t];const r=t.replaceAll("-","");return e[t]=r,r}})(),x=new n.A([128,128,128])},10609:(e,t,r)=>{"use strict";r.d(t,{M9:()=>c,oO:()=>u,rS:()=>p});var i=r(95444),n=r(50076),s=r(31933),o=r(78135),a=r(87708),l=r(89579);function c(e,t,r,i){const n=d(e,{},{context:i,isLabelSymbol:!1});null!=n&&(t[r]=n)}function u(e,t,r,i){const n=d(e,{},{context:i,isLabelSymbol:!0});null!=n&&(t[r]=n)}function h(e){return e instanceof o.A||e instanceof l.A}function d(e,t,r){if(null==e)return null;const{context:i,isLabelSymbol:o}=r,l=i?.origin,c=i?.messages;if("web-scene"===l&&!h(e)){const r=(0,a.t)(e,{retainCIM:!0,hasLabelingContext:o});return null!=r.symbol?r.symbol.write(t,i):(c?.push(new n.A("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:i,error:r.error})),null)}return("web-map"===l||"portal-item"===l&&!(0,s.TU)(i?.layer))&&h(e)?(c?.push(new n.A("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:i})),null):e.write(t,i)}function p(e,t){return(0,i.Bu)(e,null,t)}},62571:(e,t,r)=>{"use strict";r.d(t,{x:()=>i,z:()=>n});const i=["begin","end","begin-end"],n=["arrow","circle","square","diamond","cross","x"]},85192:(e,t,r)=>{"use strict";r.d(t,{E:()=>a,p:()=>l});var i=r(69539),n=r(76931),s=r(40565),o=r(2183);const a={type:i.A,json:{type:[s.jz],default:null,read:{source:["color","transparency"],reader:function(e,t){const r=null!=t.transparency?(0,o.D)(t.transparency):1,n=t.color;return n&&Array.isArray(n)?new i.A([n[0]||0,n[1]||0,n[2]||0,r]):null}},write:{target:{color:{type:[s.jz]},transparency:{type:s.jz}},writer:function(e,t){t.color=e.toJSON().slice(0,3);const r=(0,o.p)(e.a);0!==r&&(t.transparency=r)}}}},l={type:Number,cast:n.cr,json:{write:!0}}},8446:(e,t,r)=>{"use strict";r.d(t,{bo:()=>p,cF:()=>d,jg:()=>_,o5:()=>f,yA:()=>m});var i=r(3825),n=r(50076),s=r(50346),o=r(90534),a=r(65308),l=r(36351),c=r(31111);let u={};function h(e,t,r){const i=null!=t.portal?t.portal:a.A.getDefault();let s;const o=`${i.url} - ${i.user?.username} - ${e}`;return u[o]||(u[o]=function(e,t,r){return t.load(r).then((()=>{const i=new l.A({disableExtraQuery:!0,query:`owner:${g} AND type:${y} AND typekeywords:"${e}"`});return t.queryItems(i,r)})).then((t=>{let{results:i}=t,s=null;const o=e.toLowerCase();if(i&&Array.isArray(i))for(const e of i){const t=e.typeKeywords?.some((e=>e.toLowerCase()===o));if(t&&e.type===y&&e.owner===g){s=e;break}}if(!s)throw new n.A("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(r)}))}(e,i,r).then((e=>(s=e,e.fetchData()))).then((t=>({data:t,baseUrl:s.itemUrl??"",styleName:e})))),u[o]}function d(e,t,r){return null!=e?.styleUrl?async function(e,t){try{return{data:(await m(e,t)).data,baseUrl:(0,o.nM)(e),styleUrl:e}}catch(r){return(0,s.QP)(r),null}}(e.styleUrl,r):null!=e?.styleName?h(e.styleName,t,r):Promise.reject(new n.A("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function p(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}}function f(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["gltf"];if("cimRef"===t)return encodeURI(e.cimRef);if(e.formatInfos&&!(0,c.Vd)())for(const i of r){const t=e.formatInfos.find((e=>e.type===i));if(t)return t.href}return encodeURI(e.webRef)}function m(e,t){const r={responseType:"json",query:{f:"json"},...t};return(0,i.A)((0,o.S8)(e),r)}const g="esri_en",y="Style",_="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json"},87708:(e,t,r)=>{"use strict";r.d(t,{c:()=>y,t:()=>_});var i=r(95444),n=r(50076),s=r(46265),o=r(89579),a=r(37471),l=r(7246),c=r(34913),u=r(76940),h=r(27410),d=r(86875),p=r(94918),f=r(74343),m=r(86659),g=r(16911);const y={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function _(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y;if(!e)return{symbol:null};const{retainId:r=y.retainId,ignoreDrivers:_=y.ignoreDrivers,hasLabelingContext:v=y.hasLabelingContext,retainCIM:b=y.retainCIM,cimFallbackEnabled:w=y.cimFallbackEnabled}=t;let x=null;if((0,i.wk)(e)||e instanceof o.A)x=e.clone();else if("cim"===e.type){const r=e.data?.symbol?.type;switch(r){case"CIMPointSymbol":x=b?e.clone():a.A.fromCIMSymbol(e);break;case"CIMLineSymbol":w&&(x=s.al.clone(),t?.logWarning?.("Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":w&&(x=s.af.clone(),t?.logWarning?.("Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!x)return{error:new n.A("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${r||"unknown"}' is unsupported in 3D`,{symbol:e})}}else if(e instanceof l.A)x=c.A.fromSimpleLineSymbol(e);else if(e instanceof u.A)x=a.A.fromSimpleMarkerSymbol(e);else if(e instanceof h.A)x=a.A.fromPictureMarkerSymbol(e);else if(e instanceof d.A)x=t.geometryType&&"mesh"===t.geometryType?p.A.fromSimpleFillSymbol(e):f.A.fromSimpleFillSymbol(e);else{if(!(e instanceof m.A))return{error:new n.A("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};x=v?g.A.fromTextSymbol(e):a.A.fromTextSymbol(e)}return r&&x&&"cim"!==x.type&&(x.id=e.id),_&&(0,i.wk)(x)&&x.symbolLayers.forEach((e=>e.ignoreDrivers=!0)),{symbol:x}}},72733:(e,t,r)=>{"use strict";r.d(t,{Bb:()=>s,Fq:()=>c,M4:()=>u,Nv:()=>h,e:()=>d});r(81806);var i=r(9392),n=r(42294);function s(e,t){let{isPrimitive:r,width:n,depth:s,height:o}=t;const a=r?10:1;if(null==n&&null==o&&null==s)return[a*e[0],a*e[1],a*e[2]];const l=(0,i.fA)(n,s,o);let c;for(let i=0;i<3;i++){const t=l[i];if(null!=t){c=t/e[i];break}}for(let i=0;i<3;i++)null==l[i]&&(l[i]=e[i]*c);return l}const o=(0,n.fA)(-.5,-.5,-.5,.5,.5,.5),a=(0,n.fA)(-.5,-.5,0,.5,.5,1),l=(0,n.fA)(-.5,-.5,0,.5,.5,.5);function c(e){switch(e){case"sphere":case"cube":case"diamond":return o;case"cylinder":case"cone":case"inverted-cone":return a;case"tetrahedron":return l;default:return}}const u=["butt","square","round"],h=[...u,"none"],d=["miter","bevel","round"]},27790:(e,t,r)=>{"use strict";r.d(t,{NM:()=>a,Tb:()=>l,_R:()=>o,h9:()=>s,rM:()=>c,x0:()=>u,y7:()=>h});var i=r(15941),n=r(40565);const s=["none","underline","line-through"],o=["normal","italic","oblique"],a=["normal","lighter","bold","bolder"],l={type:Number,cast:e=>{const t=(0,n.GB)(e);return 0===t?1:(0,i.qE)(t,.1,4)},nonNullable:!0},c={type:["left","right","center"],nonNullable:!0},u={type:["baseline","top","middle","bottom"],nonNullable:!0},h=8},59097:(e,t,r)=>{"use strict";r.d(t,{Ao:()=>s,KQ:()=>o,Tg:()=>n});var i=r(3454);function n(e){return!!e&&null!=i.j[e]}function s(e){return 1/(i.j[e]||1)}const o=function(){const e=Object.keys(i.j);return e.sort(),e}()},94446:(e,t,r)=>{"use strict";r.d(t,{k7:()=>a,ku:()=>o});var i=r(90534),n=r(79453);function s(e,t){if(!(0,i.oP)(e)){const r=function(e){if(!e)return null;const{origin:t,layer:r}=e;if("service"!==t&&"portal-item"!==t)return null;const i=r?.type;return"feature"===i||"stream"===i?r.parsedUrl?.path:"map-image"===i||"tile"===i?e.url?.path:null}(t);if(r)return(0,i.fj)(r,"images",e)}return(0,n.f)(e,t)}const o={json:{read:{source:["imageData","url"],reader:function(e,t,r){return t.imageData?(0,i.Hg)({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):s(t.url,r)}},write:{writer(e,t,r,s){!function(e,t,r,s){if((0,i.DB)(e)){const o=(0,i.r$)(e);if(!o)return;t.contentType=o.mediaType,t.imageData=o.data,r&&r.imageData===t.imageData&&r.url&&(0,n.w)(r.url,t,"url",s)}else(0,n.w)(e,t,"url",s)}(e,t,this.source,s)}}}},a={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,r){const i={};return t.imageData&&(i.imageData=t.imageData),t.contentType&&(i.contentType=t.contentType),t.url&&(i.url=s(t.url,r)),i}}}}},94439:(e,t,r)=>{"use strict";r.d(t,{$d:()=>f,GG:()=>T,N7:()=>m,Sx:()=>g,UQ:()=>S,di:()=>M,dt:()=>_,f3:()=>A,k_:()=>p,yG:()=>C});var i=r(69539),n=r(95444),s=r(98773),o=(r(81806),r(76931)),a=r(9392),l=r(66758),c=r(29632),u=r(87840),h=r(9994);const d=new i.A("white");function p(e){if(!e)return 0;if((0,n.wk)(e)){const t=function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}(e);return null!=t?t:0}return(0,o.PN)((0,u.$4)(e)?.width)}function f(e){if(null==e||!("symbolLayers"in e)||null==e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function m(e){return e.resource?.href??""}function g(e,t){if(!e)return null;let r=null;return(0,n.wk)(e)?r=function(e){const t=e.symbolLayers;if(!t)return null;let r=null;return t.forEach((e=>{"object"===e.type&&e.resource?.href||(r="water"===e.type?e.color:e.material?e.material.color:null)})),r?new i.A(r):null}(e):(0,n.$y)(e)&&(r="cim"===e.type?(0,c.Nk)(e):e.color?new i.A(e.color):null),r?y(r,t):null}function y(e,t){if(null==t||null==e)return e;const r=e.toRgba();return r[3]=r[3]*t,new i.A(r)}function _(e,t,r){e&&(t||null!=r)&&(t&&(t=new i.A(t)),(0,n.wk)(e)?function(e,t,r){const i=e.symbolLayers;if(!i)return;const n=e=>y(t=t??e??(null!=r?d:null),r);i.forEach((e=>{if("object"!==e.type||!e.resource?.href||t)if("water"===e.type)e.color=n(e.color);else{const t=null!=e.material?e.material.color:null,i=n(t);null==e.material?e.material=new h.N({color:i}):e.material.color=i,null!=r&&"outline"in e&&null!=e.outline?.color&&(e.outline.color=y(e.outline.color,r))}}))}(e,t,r):(0,n.$y)(e)&&function(e,t,r){(t=t??e.color)&&(e.color=y(t,r)),null!=r&&"outline"in e&&e.outline?.color&&(e.outline.color=y(e.outline.color,r))}(e,t,r))}async function v(e,t){const i=e.symbolLayers;i&&await(0,s.jJ)(i,(async e=>async function(e,t){switch(e.type){case"extrude":!function(e,t){e.size="number"==typeof t[2]?t[2]:0}(e,t);break;case"icon":case"line":case"text":!function(e,t){const r=b(t);null!=r&&(e.size=r)}(e,t);break;case"path":!function(e,t){const r=w(t,a.Un,[e.width,void 0,e.height]);e.width=x(t[0],e.width,1,r),e.height=x(t[2],e.height,1,r)}(e,t);break;case"object":await async function(e,t){const{resourceSize:i,symbolSize:n}=await async function(e){const{computeObjectLayerResourceSize:t}=await r.e(4374).then(r.bind(r,44374)),i=await t(e,10),{width:n,height:s,depth:o}=e,a=[n,o,s];let l=1;for(let r=0;r<3;r++){const e=a[r];if(null!=e){l=e/i[r];break}}for(let r=0;r<3;r++)null==a[r]&&(a[r]=i[r]*l);return{resourceSize:i,symbolSize:a}}(e),s=w(t,i,n);e.width=x(t[0],n[0],i[0],s),e.depth=x(t[1],n[1],i[1],s),e.height=x(t[2],n[2],i[2],s)}(e,t)}}(e,t)))}function b(e){for(const t of e)if("number"==typeof t)return t;return null}function w(e,t,r){for(let i=0;i<3;i++){const n=e[i];switch(n){case"symbol-value":{const e=r[i];return null!=e?e/t[i]:1}case"proportional":break;default:if(n&&t[i])return n/t[i]}}return 1}function x(e,t,r,i){switch(e){case"proportional":return r*i;case"symbol-value":return null!=t?t:r;default:return e}}async function S(e,t){if(e&&t)return(0,n.wk)(e)?v(e,t):void((0,n.$y)(e)&&function(e,t){const r=b(t);if(null!=r)switch(e.type){case"simple-marker":e.size=r;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=r,e.height=r*t):(e.width=r*t,e.height=r);break}case"simple-line":e.width=r;break;case"text":e.font.size=r}}(e,t))}function T(e,t,r){if(e&&null!=t)if((0,n.wk)(e)){const i=e.symbolLayers;i&&i.forEach((e=>{if(e&&"object"===e.type)switch(r){case"tilt":e.tilt=(e.tilt??0)+t;break;case"roll":e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}}))}else(0,n.$y)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle+=t))}function M(e){if(!e)return null;const t=e.effects.filter((e=>"bloom"!==e.type)).map((e=>e.toJSON()));return(0,l.zu)(t)}function A(e){return null!=e&&"polygon-3d"===e.type&&e.symbolLayers.some((e=>"extrude"===e.type))}async function C(e,t){return await e.fetchSymbol(t)||e.fetchCIMSymbol(t)}},26314:(e,t,r)=>{"use strict";r.d(t,{I:()=>m,p:()=>f,resolveWebStyleSymbol:()=>p});var i=r(95444),n=r(93795),s=r(50076),o=r(90534),a=r(65308),l=r(79453),c=r(10609),u=r(24141),h=r(8446),d=r(25158);function p(e,t,r,i){const n=e.name;return null==n?Promise.reject(new s.A("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):e.styleName&&"Esri2DPointSymbolsStyle"===e.styleName?function(e,t,r){const i=h.jg.replaceAll(/\{SymbolName\}/gi,e),n=null!=t.portal?t.portal:a.A.getDefault();return(0,h.yA)(i,r).then((e=>{const t=(0,h.bo)(e.data);return(0,c.rS)(t,{portal:n,url:(0,o.An)((0,o.nM)(i)),origin:"portal-item"})}))}(n,t,i):(0,h.cF)(e,t,i).then((e=>m(e,n,t,r,h.o5,i)))}function f(e,t){return t.items.find((t=>t.name===e))}function m(e,t,r,p,m,g){const y=null!=r?.portal?r.portal:a.A.getDefault(),_={portal:y,url:(0,o.An)(e.baseUrl),origin:"portal-item"},v=f(t,e.data);if(!v){const e=`The symbol name '${t}' could not be found`;return Promise.reject(new s.A("symbolstyleutils:symbol-name-not-found",e,{symbolName:t}))}let b=(0,l.f)(m(v,p),_),w=v.thumbnail?.href??null;const x=v.thumbnail?.imageData;(0,n.b5)()&&(b=(0,n.EM)(b)??"",w=(0,n.EM)(w));const S={portal:y,url:(0,o.An)((0,o.nM)(b)),origin:"portal-item"};return(0,h.yA)(b,g).then((n=>{const s="cimRef"===p?(0,h.bo)(n.data):n.data,o=(0,c.rS)(s,S);if(o&&(0,i.wk)(o)){if(w){const e=(0,l.f)(w,_);o.thumbnail=new d.V({url:e})}else x&&(o.thumbnail=new d.V({url:`data:image/png;base64,${x}`}));e.styleUrl?o.styleOrigin=new u.A({portal:r.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(o.styleOrigin=new u.A({portal:r.portal,styleName:e.styleName,name:t}))}return o}))}},67478:(e,t,r)=>{"use strict";r.d(t,{ZS:()=>h,hv:()=>d,qU:()=>s,N5:()=>l,P6:()=>u,L5:()=>o,n$:()=>a});const i=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Bishkek"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);var n=r(24241);const s="system",o="unknown",a="UTC",l=Intl.DateTimeFormat().resolvedOptions().timeZone,c="shortOffset";function u(e){return{json:{read:{source:e,reader:(t,r)=>r[e]?h(r[e]):null},write:!!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&{allowNull:!0,writer(t,r){r[e]=t?function(e){return{timeZoneIANA:e}}(t):null}}}}}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;return e?function(e){return"timeZoneIANA"in e}(e)?e.timeZoneIANA:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;if(!e||!i.has(e.timeZone))return t;const r=i.get(e.timeZone);return function(e){return e.startsWith("UTC")}(e.timeZone)||e.respectsDaylightSaving?r:function(e){const t=n.c9.local().setZone(e),r=Math.min(t.set({month:1,day:1}).offset,t.set({month:5}).offset);return 0===r?"Etc/UTC":`Etc/GMT${n.mQ.instance(-r).formatOffset(0,"narrow")}`}(r)}(e,t):t}function d(e,t,r,i,n){if(t&&"date"===n)return{timeZone:a,timeZoneName:void 0};const s=i.timeStyle||i.hour,l=r===o;return{timeZone:l?"timestamp-offset"===n?void 0:e??a:r,timeZoneName:l&&s?c:void 0}}},35298:(e,t,r)=>{"use strict";r.d(t,{TA:()=>n,We:()=>a,Z3:()=>s,ZJ:()=>l,w5:()=>c});var i=r(3825);const n=(0,r(49723).vD)(),s=new Map,o=new Map;new Map;async function a(e,t,r){if(!e||!r)return!1;if(!t)return!0;const n=new URL(e).host;let o=s.get(n);if(!o){const t=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");o=(await(0,i.A)(t,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return o===t}async function l(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||!t)return!0;const s=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),a=o.get(s)?.entries();if(a)for(const[o,l]of a)if(l.name===t){const e=!l.stack?.hasForwardEdits();if(!e&&i){const[{deleteForwardEdits:e},{default:t}]=await Promise.all([r.e(6868).then(r.bind(r,56868)),r.e(7028).then(r.bind(r,37028))]),i=await e(s,o,new t({sessionId:n,moment:l.moment}));return i.success&&l.stack?.clearForwardEdits(),i.success}return e}return!0}function c(e,t){if(!e)return!1;const r=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),i=o.get(r)?.entries();if(i)for(const[n,s]of i)if(s.name===t)return"edit"===s.lockType;return!1}},52629:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var i=r(50076),n=r(76460),s=r(76279);function o(e,t,r,i,s){if(null==e)return null;const o=e.referencesGeometry()&&s?l(t,i,s):t,a=e.repurposeFeature(o);try{return e.evaluate({...r,$feature:a},e.services)}catch(c){return n.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",c),null}}const a=new Map;function l(e,t,r){const{transform:o,hasZ:l,hasM:c}=r;a.has(t)||a.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,r,i,n)=>(0,s.Tr)(r,t,e,i,n);case"esriGeometryPolygon":return(e,r,i,n)=>(0,s.$X)(r,t,e,i,n);case"esriGeometryPolyline":return(e,r,i,n)=>(0,s.P5)(r,t,e,i,n);case"esriGeometryMultipoint":return(e,r,i,n)=>(0,s.SW)(r,t,e,i,n);default:return n.A.getLogger("esri.views.2d.support.arcadeOnDemand").error(new i.A("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}(t));const u=a.get(t)(e.geometry,o,l,c);return{...e,geometry:u}}},72770:(e,t,r)=>{"use strict";var i,n;r.d(t,{M:()=>n,T:()=>i}),function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"}(i||(i={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(n||(n={}))},55033:(e,t,r)=>{"use strict";r.d(t,{GW:()=>g,IU:()=>b,Jo:()=>o,MG:()=>s,Wh:()=>d,cP:()=>T,os:()=>u,p6:()=>m,pJ:()=>a,ru:()=>x,s3:()=>w,w4:()=>S,wV:()=>f,yM:()=>M,z0:()=>p});var i=r(5262),n=r(62032);const s=Number.POSITIVE_INFINITY,o=Math.PI,a=2*o,l=128/o,c=256/360,u=o/180,h=1/Math.LN2;function d(e,t){return(e%=t)>=0?e:e+t}function p(e){return d(e*l,256)}function f(e){return d(e*c,256)}function m(e){return Math.log(e)*h}function g(e,t,r){return e*(1-r)+t*r}const y=8,_=14,v=16;function b(e){return y+Math.max((e-_)*v,0)}function w(e,t,r){let i,n,s,o=0;for(const a of r){i=a.length;for(let r=1;r<i;++r)n=a[r-1],s=a[r],n.y>t!=s.y>t&&((s.x-n.x)*(t-n.y)-(s.y-n.y)*(e-n.x)>0?o++:o--)}return 0!==o}function x(e,t,r,n){let s,o,a,l;const c=n*n;for(const u of r){const r=u.length;if(!(r<2)){s=u[0].x,o=u[0].y;for(let n=1;n<r;++n){if(a=u[n].x,l=u[n].y,(0,i.Ng)(e,t,s,o,a,l)<c)return!0;s=a,o=l}}}return!1}function S(e,t,r,i,n,s,o){const a=Math.max(i,Math.min(t,s))-t,l=Math.max(n,Math.min(r,o))-r;return a*a+l*l<=e*e}function T(e,t){if(0===t||Number.isNaN(t))return e;const r=[],i=new n.bR(0,0),s=new n.bR(0,0),o=new n.bR(0,0);for(let a=0;a<e.length;a++){const l=e[a],c=[];for(let e=0;e<l.length;e++){const r=l[e-1],a=l[e],u=l[e+1];0===e?i.setCoords(0,0):i.assignSub(a,r).normalize().rightPerpendicular(),e===l.length-1?s.setCoords(0,0):s.assignSub(u,a).normalize().rightPerpendicular(),o.assignAdd(i,s).normalize();const h=o.x*s.x+o.y*s.y;0!==h&&o.scale(1/h),c.push(n.bR.add(a,o.scale(t)))}r.push(c)}return r}function M(e,t,r,i){const s=new n.bR(e[0],e[1]);if(s.scale(i),"viewport"===t){const e=-r*(Math.PI/180),t=Math.cos(e),i=Math.sin(e);s.rotate(t,i)}return s}},542:(e,t,r)=>{"use strict";r.d(t,{c:()=>b,D:()=>x});r(81806);var i=r(63919),n=r(85827),s=r(8254),o=r(30726),a=r(78393),l=(r(40181),r(93453)),c=(r(15389),r(96345),r(6645)),u=r(76718),h=r(93345),d=r(36911);class p{constructor(e,t){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let r=1;const i=new Uint32Array(e);this.layerUIDs=[];const n=i[r++];for(let s=0;s<n;s++)this.layerUIDs[s]=i[r++];this.bufferDataOffset=r,t&&(this.layer=t.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){null!=this._data&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}}class f extends p{constructor(e,t){super(e,t),this.type=s.NP.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let i=this.bufferDataOffset;this.lineIndexStart=r[i++],this.lineIndexCount=r[i++];const n=r[i++];if(n>0){this.patternMap=new Map;for(let e=0;e<n;e++){const e=r[i++],t=r[i++],n=r[i++];this.patternMap.set(e,[t,n])}}this.bufferDataOffset=i}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=(0,o.WD)(this.vao)}doPrepareForRendering(e,t,r){const i=new Uint32Array(t),n=new Int32Array(i.buffer),s=i[r++],o=u.g.createVertex(e,h._U.STATIC_DRAW,new Int32Array(n.buffer,4*r,s));r+=s;const a=i[r++],l=u.g.createIndex(e,h._U.STATIC_DRAW,new Uint32Array(i.buffer,4*r,a));r+=a;const c=this.layer.lineMaterial;this.vao=new d.Z(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:o},l)}}class m extends p{constructor(e,t){super(e,t),this.type=s.NP.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let i=this.bufferDataOffset;this.fillIndexStart=r[i++],this.fillIndexCount=r[i++],this.outlineIndexStart=r[i++],this.outlineIndexCount=r[i++];const n=r[i++];if(n>0){this.patternMap=new Map;for(let e=0;e<n;e++){const e=r[i++],t=r[i++],n=r[i++];this.patternMap.set(e,[t,n])}}this.bufferDataOffset=i}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=(0,o.WD)(this.fillVAO),this.outlineVAO=(0,o.WD)(this.outlineVAO)}doPrepareForRendering(e,t,r){const i=new Uint32Array(t),n=new Int32Array(i.buffer),s=i[r++],o=u.g.createVertex(e,h._U.STATIC_DRAW,new Int32Array(n.buffer,4*r,s));r+=s;const a=i[r++],l=u.g.createIndex(e,h._U.STATIC_DRAW,new Uint32Array(i.buffer,4*r,a));r+=a;const c=i[r++],p=u.g.createVertex(e,h._U.STATIC_DRAW,new Int32Array(n.buffer,4*r,c));r+=c;const f=i[r++],m=u.g.createIndex(e,h._U.STATIC_DRAW,new Uint32Array(i.buffer,4*r,f));r+=f;const g=this.layer,y=g.fillMaterial,_=g.outlineMaterial;this.fillVAO=new d.Z(e,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:o},l),this.outlineVAO=new d.Z(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:p},m)}}class g extends p{constructor(e,t,r){super(e,t),this.type=s.NP.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const i=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!i[a++];const u=i[a++],h=i[a++],d=i[a++],p=new l.A(u,h,d,0),f=i[a++];for(let s=0;s<f;s++){const e=i[a++],t=i[a++],r=i[a++];this.iconPerPageElementsMap.set(e,[t,r])}const m=i[a++];for(let s=0;s<m;s++){const e=i[a++],t=i[a++],r=i[a++];this.glyphPerPageElementsMap.set(e,[t,r])}const g=i[a++],y=i[a++];this.iconOpacity=new Int32Array(g),this.textOpacity=new Int32Array(y),a=(0,c.X1)(i,n,o,a,this.symbols,r,p),this.bufferDataOffset=a}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+(0,a.Ek)(this.iconOpacity)+(0,a.Ek)(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[t,r]of this.iconPerPageElementsMap)e+=r[1];for(const[t,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){this.iconVAO=(0,o.WD)(this.iconVAO),this.textVAO=(0,o.WD)(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,t=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===t.usedMemory&&t.setSubData(e,0,0,e.length);const r=this.textOpacity,i=this.textVAO.vertexBuffers.opacity;r.length>0&&r.byteLength===i.usedMemory&&i.setSubData(r,0,0,r.length)}doPrepareForRendering(e,t,r){const i=new Uint32Array(t),n=new Int32Array(i.buffer),s=i[r++],o=u.g.createVertex(e,h._U.STATIC_DRAW,new Int32Array(n.buffer,4*r,s));r+=s;const a=i[r++],l=u.g.createIndex(e,h._U.STATIC_DRAW,new Uint32Array(i.buffer,4*r,a));r+=a;const c=i[r++],p=u.g.createVertex(e,h._U.STATIC_DRAW,new Int32Array(n.buffer,4*r,c));r+=c;const f=i[r++],m=u.g.createIndex(e,h._U.STATIC_DRAW,new Uint32Array(i.buffer,4*r,f));r+=f;const g=u.g.createVertex(e,h._U.STATIC_DRAW,this.iconOpacity.buffer),y=u.g.createVertex(e,h._U.STATIC_DRAW,this.textOpacity.buffer),_=this.layer,v=_.iconMaterial,b=_.textMaterial;this.iconVAO=new d.Z(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:o,opacity:g},l),this.textVAO=new d.Z(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:p,opacity:y},m)}}class y extends p{constructor(e,t){super(e,t),this.type=s.NP.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let i=this.bufferDataOffset;this.circleIndexStart=r[i++],this.circleIndexCount=r[i++],this.bufferDataOffset=i}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=(0,o.WD)(this.vao)}doPrepareForRendering(e,t,r){const i=new Uint32Array(t),n=new Int32Array(i.buffer),s=i[r++],o=u.g.createVertex(e,h._U.STATIC_DRAW,new Int32Array(n.buffer,4*r,s));r+=s;const a=i[r++],l=u.g.createIndex(e,h._U.STATIC_DRAW,new Uint32Array(i.buffer,4*r,a));r+=a;const c=this.layer.circleMaterial;this.vao=new d.Z(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:o},l)}}var _=r(62887),v=r(4273);class b extends v.Y{constructor(e,t,r,i,n,s,o){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;super(e,t,r,i,n,s,4096,4096),this.styleRepository=o,this._memCache=a,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<_.zk}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<_.zk)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){let t=!1;for(const r of e){const e=this.layerData.get(r);e&&(this._memoryUsedByLayerData-=e.memoryUsed,e.type===s.NP.SYMBOL&&this.symbols.delete(r)&&(t=!0),e.destroy(),this.layerData.delete(r))}this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData),t&&(this.featureIndex?.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){"unloaded"!==this.status&&(this.featureIndex=null,w.delete(this),b._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(e){this.featureIndex?.clear();let t=!1;if(e){const{bucketsWithData:r,emptyBuckets:i}=e,n=this._createRenderBuckets(r);if(i&&i.byteLength>0){const e=new Uint32Array(i);for(const t of e)this._deleteLayerData(t)}for(const[e,o]of n)this._deleteLayerData(e),o.type===s.NP.SYMBOL&&(this.symbols.set(e,o.symbols),t=!0),this._memoryUsedByLayerData+=o.memoryUsed,this.layerData.set(e,o);this._memCache?.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const[r,i]of this.layerData)i.type===s.NP.SYMBOL&&(this._hasSymbolBuckets=!0);t&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(e){e.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const t=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*t,n=this.height/this.rangeY*t,s=[0,0];e.toScreen(s,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;(0,i.D_)(o),(0,i.Tl)(o,o,s),(0,i.e$)(o,o,Math.PI*e.rotation/180),(0,i.hs)(o,o,[r,n,1])}_createTransforms(){return{displayViewScreenMat3:(0,n.vt)(),tileMat3:(0,n.vt)(),tileUnitsToPixels:(0,n.vt)()}}static _destroyRenderBuckets(e){if(!e)return;const t=new Set;for(const r of e.values())t.has(r)||(r.destroy(),t.add(r));e.clear()}_createRenderBuckets(e){const t=new Map,r=new Map;for(const i of e){const e=this._deserializeBucket(i,r);for(const r of e.layerUIDs)t.set(r,e)}return t}_deserializeBucket(e,t){let r=t.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case s.NP.FILL:r=new m(e,this.styleRepository);break;case s.NP.LINE:r=new f(e,this.styleRepository);break;case s.NP.SYMBOL:r=new g(e,this.styleRepository,this);break;case s.NP.CIRCLE:r=new y(e,this.styleRepository)}return t.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const t=this.layerData.get(e);this._memoryUsedByLayerData-=t.memoryUsed,t.destroy(),this.layerData.delete(e)}}const w=new Map;function x(){w.forEach(((e,t)=>{console.log(`\n${t.key}:`),e[0].forEach((e=>console.log(e))),console.log("========"),e[1].forEach((e=>console.log(e)))}))}},62887:(e,t,r)=>{"use strict";r.d(t,{IT:()=>i,o2:()=>n,zk:()=>s});const i=!0,n=32,s=200},36458:(e,t,r)=>{"use strict";r.d(t,{D:()=>i,S:()=>n});class i{constructor(e,t){this.sourceTile=t,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}}class n{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}},6645:(e,t,r)=>{"use strict";r.d(t,{I:()=>o,OI:()=>h,X1:()=>l,jy:()=>c,xT:()=>a});var i=r(8254),n=r(55033),s=r(36458);function o(e,t,r,i,n,s){const o=r-n;if(o>=0)return(t>>o)+(i-(s<<o))*(e>>o);const a=-o;return t-(s-(i<<a))*(e>>a)<<a}class a{constructor(e,t,r){this._rows=Math.ceil(t/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let i=0;i<this._rows;i++){this.cells[i]=new Array(this._columns);for(let e=0;e<this._columns;e++)this.cells[i][e]=[]}}getCell(e,t){const r=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),i=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][i]||null}getCellSpan(e,t,r,i){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function l(e,t,r,i,n,o,a){const l=t[i++];for(let c=0;c<l;c++){const l=new s.D(o,a);l.xTile=t[i++],l.yTile=t[i++],l.hash=t[i++],l.priority=t[i++],l.featureIndex=t[i++];const c=t[i++];for(let e=0;e<c;e++){const e=t[i++],n=t[i++],s=t[i++],o=t[i++],a=!!t[i++],c=t[i++],u=r[i++],h=r[i++],d=t[i++],p=t[i++];l.colliders.push({xTile:e,yTile:n,dxPixels:s,dyPixels:o,hard:a,partIndex:c,width:d,height:p,minLod:u,maxLod:h})}const u=e[i++];for(let t=0;t<u;t++)l.textVertexRanges.push([e[i++],e[i++]]);const h=e[i++];for(let t=0;t<h;t++)l.iconVertexRanges.push([e[i++],e[i++]]);n.push(l)}return i}function c(e,t,r){for(const[i,n]of e.symbols)u(e,t,r,n,i)}function u(e,t,r,n,s){const o=e.layerData.get(s);if(o.type===i.NP.SYMBOL){for(const t of n){const i=t.unique;let n;if(t.selectedForRendering){const t=i.parts[0],s=t.startOpacity,o=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===o;const a=r?Math.floor(127*s)|o<<7:o?255:0;n=a<<24|a<<16|a<<8|a}else n=0;for(const[e,r]of t.iconVertexRanges)for(let t=e;t<e+r;t+=4)o.iconOpacity[t/4]=n;if(t.selectedForRendering){const t=i.parts[1],s=t.startOpacity,o=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===o;const a=r?Math.floor(127*s)|o<<7:o?255:0;n=a<<24|a<<16|a<<8|a}else n=0;for(const[e,r]of t.textVertexRanges)for(let t=e;t<e+r;t+=4)o.textOpacity[t/4]=n}o.lastOpacityUpdate=t,o.opacityChanged=!0}}function h(e,t,r,i){const s=e.colliders;let o,a,l,c;for(const u of s)if(e.unique.show&&e.unique.parts[u.partIndex].show&&(o=u.xScreen-i[0]+u.dxScreen,a=u.yScreen-i[1]+u.dyScreen,l=o+u.width,c=a+u.height,(0,n.w4)(r,t.x,t.y,o,a,l,c)))return!0;return!1}},8254:(e,t,r)=>{"use strict";var i,n,s;r.d(t,{$q:()=>s,NP:()=>i,kh:()=>n}),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(i||(i={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(n||(n={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(s||(s={}))},76418:(e,t,r)=>{"use strict";r.d(t,{$u:()=>p,Cq:()=>u,Dc:()=>i,I5:()=>o,KI:()=>l,Ms:()=>c,O6:()=>a,bv:()=>n,kt:()=>s,v9:()=>h});var i,n,s,o,a,l,c,u,h,d=r(28808);!function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(i||(i={})),function(e){e[e.VISIBLE=0]="VISIBLE",e[e.NONE=1]="NONE"}(n||(n={})),function(e){e[e.POINT=0]="POINT",e[e.LINE=1]="LINE",e[e.LINE_CENTER=2]="LINE_CENTER"}(s||(s={})),function(e){e[e.MAP=0]="MAP",e[e.VIEWPORT=1]="VIEWPORT",e[e.AUTO=2]="AUTO"}(o||(o={})),function(e){e[e.AUTO=0]="AUTO",e[e.LEFT=1]="LEFT",e[e.CENTER=2]="CENTER",e[e.RIGHT=3]="RIGHT"}(a||(a={})),function(e){e[e.CENTER=0]="CENTER",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP",e[e.BOTTOM=4]="BOTTOM",e[e.TOP_LEFT=5]="TOP_LEFT",e[e.TOP_RIGHT=6]="TOP_RIGHT",e[e.BOTTOM_LEFT=7]="BOTTOM_LEFT",e[e.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(l||(l={})),function(e){e[e.NONE=0]="NONE",e[e.UPPERCASE=1]="UPPERCASE",e[e.LOWERCASE=2]="LOWERCASE"}(c||(c={})),function(e){e[e.MAP=0]="MAP",e[e.VIEWPORT=1]="VIEWPORT"}(u||(u={})),function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL"}(h||(h={}));class p{}p.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:n.VISIBLE}},p.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:n.VISIBLE}},p.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:n.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:d.xR.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:d.JO.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},p.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:n.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:s.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:l.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:o.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:l.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:a.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:o.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:c.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[h.HORIZONTAL]}},p.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:n.VISIBLE}},p.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},p.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:u.MAP}},p.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:u.MAP},"line-width":{type:"number",minimum:0,default:1}},p.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:u.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:u.MAP}},p.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},p.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:u.MAP}}},15671:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});class i{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=e,this.y=t,this.width=r,this.height=i}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},4273:(e,t,r)=>{"use strict";r.d(t,{Y:()=>c});var i=r(63919),n=r(54099),s=r(81806),o=r(50346);class a extends n.A{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const t=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t?.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return null==this._transforms&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=(0,o.Tw)(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=(0,o.Tw)(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver?.(),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,t){const r=0===(0,s.A)("mapview-transitions-duration")?0:1/(0,s.A)("mapview-transitions-duration");if(this.fadeTransitionEnabled&&0!==r){const t=this._fadeOutResolver||!this.visible?0:this.opacity,i=this.computedOpacity;if(i===t)this.computedVisible=this.visible;else{const n=e*r;this.computedOpacity=i>t?Math.max(t,i-n):Math.min(t,i+n),this.computedVisible=this.computedOpacity>0;const s=t===this.computedOpacity;this.inFadeTransition=!s,s||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}var l=r(93453);class c extends a{constructor(e,t,r,i,n,s){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:s;super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new l.A(e),this.resolution=t,this.x=r,this.y=i,this.width=n,this.height=s,this.rangeX=o,this.rangeY=a}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const t=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*t,a=this.height/this.rangeY*t;(0,i.hZ)(r,o,0,0,0,a,0,n,s,1),(0,i.lw)(this.transforms.displayViewScreenMat3,e.displayViewMat3,r)}get destroyed(){return this._destroyed}}},71447:(e,t,r)=>{"use strict";r.d(t,{Dy:()=>u,UD:()=>l,gy:()=>o,iT:()=>c,xy:()=>a});var i=r(76460);const n=()=>i.A.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var s,o;function a(e){if(!e)return s.Center;switch(e){case"Left":case"left":return s.Left;case"Right":case"right":return s.Right;case"Justify":return n().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),s.Center;case"Center":case"center":return s.Center}}function l(e){if(!e)return o.Center;switch(e){case"Top":case"top":return o.Top;case"Center":case"middle":return o.Center;case"Baseline":case"baseline":return o.Baseline;case"Bottom":case"bottom":return o.Bottom}}function c(e){switch(e){case s.Right:case"right":return-1;case s.Center:case"center":return 0;case s.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${e}`),0}}function u(e){switch(e){case o.Top:case"top":return 1;case o.Center:case"middle":return 0;case o.Bottom:case o.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${e}`),0}}!function(e){e[e.Left=-1]="Left",e[e.Center=0]="Center",e[e.Right=1]="Right"}(s||(s={})),function(e){e[e.Top=1]="Top",e[e.Center=0]="Center",e[e.Bottom=-1]="Bottom",e[e.Baseline=2]="Baseline"}(o||(o={}))},19358:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var i=r(59422);class n{constructor(e,t,r,n){this.computedX=0,this.computedY=0,this.center=(0,i.fA)(e,t),this.centerT=(0,i.vt)(),this.halfWidth=r/2,this.halfHeight=n/2,this.width=r,this.height=n}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(e){this.center[0]=e}set y(e){this.center[1]=e}clone(){return new n(this.x,this.y,this.width,this.height)}serialize(e){return e.writeF32(this.center[0]),e.writeF32(this.center[1]),e.push(this.width),e.push(this.height),e}findCollisionDelta(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;const r=Math.abs(e.centerT[0]-this.centerT[0]),i=Math.abs(e.centerT[1]-this.centerT[1]),n=(e.halfWidth+this.halfWidth+t)/r,s=(e.halfHeight+this.halfHeight+t)/i,o=Math.min(n,s);return Math.log2(o)}extend(e){const t=Math.min(this.xmin,e.xmin),r=Math.min(this.ymin,e.ymin),i=Math.max(this.xmax,e.xmax)-t,n=Math.max(this.ymax,e.ymax)-r,s=t+i/2,o=r+n/2;this.width=i,this.height=n,this.halfWidth=i/2,this.halfHeight=n/2,this.x=s,this.y=o}static deserialize(e){const t=e.readF32(),r=e.readF32(),i=e.readInt32(),s=e.readInt32();return new n(t,r,i,s)}}},5095:(e,t,r)=>{"use strict";r.d(t,{$U:()=>u,CQ:()=>i,C_:()=>d,DY:()=>n,GR:()=>y,Gh:()=>a,TB:()=>g,_M:()=>l,cp:()=>_,dV:()=>o,eG:()=>s,fq:()=>f,hM:()=>p,ie:()=>c,mg:()=>h,yv:()=>m});const i=512,n=29,s=24;var o;!function(e){e[e.FilterFlags=0]="FilterFlags",e[e.Animation=1]="Animation",e[e.GPGPU=2]="GPGPU",e[e.VV=3]="VV",e[e.DD0=4]="DD0",e[e.DD1=5]="DD1",e[e.DD2=6]="DD2"}(o||(o={}));const a=1.05,l=3,c=3,u=5,h=6,d=1.15,p=2,f=10,m=1024,g=256,y=32,_=512},40392:(e,t,r)=>{"use strict";r.d(t,{Tl:()=>T});var i=r(94967),n=r(98006),s=r(19555),o=r(59422),a=r(71447),l=r(15671),c=r(19358);const u=22,h=4,d=u+h,p=u-6,f=3,m=Math.PI/180;class g{constructor(e,t,r,i){this._rotationT=(0,n.vt)(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const s=r.rect,o=new Float32Array(8);e*=i,t*=i;const a=r.code?s.width*i:r.metrics.width,l=r.code?s.height*i:r.metrics.height;this.width=a,this.height=l,o[0]=e,o[1]=t,o[2]=e+a,o[3]=t,o[4]=e,o[5]=t+l,o[6]=e+a,o[7]=t+l,this._data=o,this._setTextureCoords(s),this._scale=i,this._mosaic=r,this.x=e,this.y=t,this.maxOffset=Math.max(e+a,t+l)}get mosaic(){return this._mosaic}set angle(e){this._angle=e,(0,i.$0)(this._rotationT,-e),this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:e,width:t}=this._mosaic.metrics,r=t*this._scale,s=Math.abs(e)*this._scale,o=new Float32Array(8);o[0]=this.x,o[1]=this.y,o[2]=this.x+r,o[3]=this.y,o[4]=this.x,o[5]=this.y+s,o[6]=this.x+r,o[7]=this.y+s;const a=(0,i.lw)((0,n.vt)(),this._rotationT,this._transform);(0,n.gb)(o,o,a);let l=1/0,u=1/0,h=0,d=0;for(let i=0;i<4;i++){const e=o[2*i],t=o[2*i+1];l=Math.min(l,e),u=Math.min(u,t),h=Math.max(h,e),d=Math.max(d,t)}const p=h-l,f=d-u,m=l+p/2,g=u+f/2;this._bounds=new c.A(m,g,p,f)}return this._bounds}setTransform(e){this._transform=e,this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const e=(0,i.lw)((0,n.vt)(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0],this._offsets.topLeft[1]=this._data[1],this._offsets.topRight[0]=this._data[2],this._offsets.topRight[1]=this._data[3],this._offsets.bottomLeft[0]=this._data[4],this._offsets.bottomLeft[1]=this._data[5],this._offsets.bottomRight[0]=this._data[6],this._offsets.bottomRight[1]=this._data[7],(0,s.l0)(this._offsets.topLeft,this._offsets.topLeft,e),(0,s.l0)(this._offsets.topRight,this._offsets.topRight,e),(0,s.l0)(this._offsets.bottomLeft,this._offsets.bottomLeft,e),(0,s.l0)(this._offsets.bottomRight,this._offsets.bottomRight,e)}_setTextureCoords(e){let{x:t,y:r,width:i,height:n}=e;this._texcoords={topLeft:[t,r],topRight:[t+i,r],bottomLeft:[t,r+n],bottomRight:[t+i,r+n]}}}const y=(e,t)=>({code:0,page:0,sdf:!0,rect:new l.A(0,0,11,8),textureBinding:t,metrics:{advance:0,height:4,width:e,left:0,top:0}});function _(e,t){return e.forEach((e=>(0,s.l0)(e,e,t))),{topLeft:e[0],topRight:e[1],bottomLeft:e[2],bottomRight:e[3]}}class v{constructor(e,t,r){this._rotation=0,this._decorate(e,t,r),this.glyphs=e,this.bounds=this._createBounds(e),this.isMultiline=t.length>1,this._hasRotation=0!==r.angle,this._transform=this._createGlyphTransform(this.bounds,r),this._borderLineSizePx=r.borderLineSizePx,(r.borderLineSizePx||r.hasBackground)&&([this.bounds,this.textBox]=this.shapeBackground(this._transform));for(const i of e)i.setTransform(this._transform)}setRotation(e){if(0===e&&0===this._rotation)return;this._rotation=e;const t=this._transform,r=(0,i.$0)((0,n.vt)(),e);(0,i.lw)(t,r,t);for(const i of this.glyphs)i.setTransform(this._transform)}_decorate(e,t,r){if(!r.decoration||"none"===r.decoration||!e.length)return;const i=r.scale,n="underline"===r.decoration?d:p,s=e[0].textureBinding;for(const o of t){const t=o.startX*i,r=o.startY*i,a=(o.width+o.glyphWidthEnd)*i;e.push(new g(t,r+n*i,y(a,s),1))}}shapeBackground(e){const t=(1.5+(this._borderLineSizePx||0))/2,r=this._borderLineSizePx?t:0,{xmin:i,ymin:n,xmax:s,ymax:o,x:a,y:l,width:u,height:h}=this.bounds,d=[i-8,n-8],p=[s+8,n-8],f=[i-8,o+8],m=[s+8,o+8],g=_([[d[0]-t,d[1]-t],[p[0]+t,p[1]-t],[d[0]+r,d[1]+r],[p[0]-r,p[1]+r]],e),y=_([[f[0]+r,f[1]-r],[m[0]-r,m[1]-r],[f[0]-t,f[1]+t],[m[0]+t,m[1]+t]],e),v=_([[d[0]-t,d[1]-t],[d[0]+r,d[1]+r],[f[0]-t,f[1]+t],[f[0]+r,f[1]-r]],e),b=_([[p[0]-r,p[1]+r],[p[0]+t,p[1]-t],[m[0]-r,m[1]-r],[m[0]+t,m[1]+t]],e),w={main:_([d,p,f,m],e),top:g,bot:y,left:v,right:b};return[new c.A(a,l,u+2*t,h+2*t),w]}get boundsT(){const e=this.bounds,t=(0,s.hZ)((0,o.vt)(),e.x,e.y);if((0,s.l0)(t,t,this._transform),this._hasRotation){const r=Math.max(e.width,e.height);return new c.A(t[0],t[1],r,r)}return new c.A(t[0],t[1],e.width,e.height)}_createBounds(e){let t=1/0,r=1/0,i=0,n=0;for(const a of e)t=Math.min(t,a.xTopLeft),r=Math.min(r,a.yTopLeft),i=Math.max(i,a.xBottomRight),n=Math.max(n,a.yBottomRight);const s=i-t,o=n-r;return new c.A(t+s/2,r+o/2,s,o)}_createGlyphTransform(e,t){const r=m*t.angle,a=(0,n.vt)(),l=(0,o.vt)();return(0,i.Tl)(a,a,(0,s.hZ)(l,t.xOffset,-t.yOffset)),t.useCIMAngleBehavior?(0,i.e$)(a,a,r):((0,i.Tl)(a,a,(0,s.hZ)(l,e.x,e.y)),(0,i.e$)(a,a,r),(0,i.Tl)(a,a,(0,s.hZ)(l,-e.x,-e.y))),a}}class b{constructor(e,t,r,i,n,s){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(t,r)),this.end=Math.max(0,Math.max(t,r)),this.end<e.length&&(this.glyphWidthEnd=e[this.end].metrics.width),this.width=i,this.yMin=n,this.yMax=s}}const w=e=>10===e,x=e=>32===e;function S(e,t){let r=0;for(let s=0;s<e.length;s++){const{width:t}=e[s];r=Math.max(t,r)}const i="underline"===t.decoration?h:0,n=e[0].yMin;return{x:0,y:n,height:e[e.length-1].yMax+t.lineHeight*(e.length-1)+i-n,width:r}}function T(e,t){const r=t.scale,i=new Array,{glyphs:n,isRightToLeft:s}=e,o=function(e,t,r){const i=new Array,n=1/r.scale,s=r.maxLineWidth*n,o=t?e.length-1:0,a=t?-1:e.length,l=t?-1:1;let c=o,u=0,h=0,d=c,p=d,f=0,m=1/0,g=0;for(;c!==a;){const{code:t,metrics:r}=e[c],n=Math.abs(r.top);if(w(t)||x(t)||(m=Math.min(m,n),g=Math.max(g,n+r.height)),w(t))c!==o&&(i.push(new b(e,d,c-l,u,m===1/0?0:m,g)),m=1/0,g=0),u=0,d=c+l,p=c+l,h=0;else if(x(t))p=c+l,h=0,f=r.advance,u+=r.advance;else if(u>s){if(p!==d){const t=p-2*l;u-=f,i.push(new b(e,d,t,u-h,m,g)),m=1/0,g=0,d=p,u=h}else i.push(new b(e,d,c-l,u,m,g)),m=1/0,g=0,d=c,p=c,u=0;u+=r.advance,h+=r.advance}else u+=r.advance,h+=r.advance;c+=l}const y=new b(e,d,c-l,u,m,g);return y.start>=0&&y.end<e.length&&i.push(y),i}(n,s,t),l=o.length?S(o,t):{x:0,y:0,height:0,width:0},c=(0,a.xy)(t.horizontalAlignment),h=(0,a.UD)(t.verticalAlignment),d=h===a.gy.Baseline?1:0,p=d?0:h-1,m=(1-d)*-l.y+p*(l.height/2)+(d?1:0)*-u;for(let a=0;a<o.length;a++){const{start:e,end:s,width:l}=o[a];let u=-1*(c+1)*(l/2)-f;const h=a*t.lineHeight+m-f;o[a].startX=u,o[a].startY=h;for(let t=e;t<=s;t++){const e=n[t];if(w(e.code))continue;const s=new g(u+e.metrics.left,h-e.metrics.top,e,r);u+=e.metrics.advance,i.push(s)}}return new v(i,o,t)}},97683:(e,t,r)=>{"use strict";r.d(t,{Lu:()=>o,hV:()=>s});var i=r(76931),n=(r(65215),r(2413),r(80963),r(5095));function s(e){return(0,i.PN)(Math.round((0,i.Lz)(e)))}function o(e){const t=(0,i.PN)(n.GR),r=(0,i.PN)(n.cp);return Math.max(t,Math.min(e||r,r))}},18798:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var i=r(3789),n=r(93453);class s{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:t,colFrom:r,colTo:i}of this.spans)for(let s=r;s<=i;s++){const r=e.getWorldForColumn(s);yield new n.A(e.level,t,e.normalizeCol(s),r)}}forEach(e,t){const{spans:r,lodInfo:i}=this,{level:n}=i;if(0!==r.length)for(const{row:s,colFrom:o,colTo:a}of r)for(let r=o;r<=a;r++)e.call(t,n,s,i.normalizeCol(r),i.getWorldForColumn(r))}}s.pool=new i.A(s)},40181:(e,t,r)=>{"use strict";r.d(t,{A:()=>f});var i=r(80963),n=r(93453);function s(e,t){return[e,t]}function o(e,t,r){return e[0]=t,e[1]=r,e}const a=new n.A("0/0/0/0");class l{static create(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=(0,i.Vp)(e.spatialReference),a=t.origin||s(e.origin.x,e.origin.y),c=s(e.size[0]*t.resolution,e.size[1]*t.resolution),u=s(-1/0,-1/0),h=s(1/0,1/0),d=s(1/0,1/0);null!=r&&(o(u,Math.max(0,Math.floor((r.xmin-a[0])/c[0])),Math.max(0,Math.floor((a[1]-r.ymax)/c[1]))),o(h,Math.max(0,Math.floor((r.xmax-a[0])/c[0])),Math.max(0,Math.floor((a[1]-r.ymin)/c[1]))),o(d,h[0]-u[0]+1,h[1]-u[1]+1));const{cols:p,rows:f}=t;let m,g,y,_;return!r&&p&&f&&(o(u,p[0],f[0]),o(h,p[1],f[1]),o(d,p[1]-p[0]+1,f[1]-f[0]+1)),e.isWrappable?(m=s(Math.ceil(Math.round((n.valid[1]-n.valid[0])/t.resolution)/e.size[0]),d[1]),g=s(Math.floor((n.origin[0]-a[0])/c[0]),u[1]),y=s(m[0]+g[0]-1,h[1]),_=!0):(g=u,y=h,m=d,_=!1),new l(t.level,t.resolution,t.scale,a,u,h,d,c,g,y,m,_)}constructor(e,t,r,i,n,s,o,a,l,c,u,h){this.level=e,this.resolution=t,this.scale=r,this.origin=i,this.first=n,this.last=s,this.size=o,this.norm=a,this.worldStart=l,this.worldEnd=c,this.worldSize=u,this.wrap=h}normalizeCol(e){if(!this.wrap)return e;const t=this.worldSize[0];return e<0?t-1-Math.abs((e+1)%t):e%t}denormalizeCol(e,t){return this.wrap?this.worldSize[0]*t+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a.set(t);const i=r?a.col:this.denormalizeCol(a.col,a.world),n=a.row;return function(e,t,r,i,n){e[0]=t,e[1]=r,e[2]=i,e[3]=n}(e,this.getXForColumn(i),this.getYForRow(n+1),this.getXForColumn(i+1),this.getYForRow(n)),e}getTileCoords(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a.set(t);const i=r?a.col:this.denormalizeCol(a.col,a.world);return Array.isArray(e)?o(e,this.getXForColumn(i),this.getYForRow(a.row)):(e.x=this.getXForColumn(i),e.y=this.getYForRow(a.row)),e}}var c=r(18798);class u{constructor(e,t,r){this.row=e,this.colFrom=t,this.colTo=r}}const h=new n.A("0/0/0/0");class d{static create(e,t){e[1]>t[1]&&([e,t]=[t,e]);const[r,i]=e,[n,s]=t,o=n-r,a=s-i,l=0!==a?o/a:0,c=(Math.ceil(i)-i)*l,u=(Math.floor(i)-i)*l;return new d(r,Math.floor(i),Math.ceil(s),l,o<0?c:u,o<0?u:c,o<0?n:r,o<0?r:n)}constructor(e,t,r,i,n,s,o,a){this.x=e,this.ymin=t,this.ymax=r,this.invM=i,this.leftAdjust=n,this.rightAdjust=s,this.leftBound=o,this.rightBound=a}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const p=[[0,0],[0,0],[0,0],[0,0]];class f{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.lods[0].level,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.lods[e.lods.length-1].level;this.tileInfo=e,this.fullExtent=t,this.scales=[],this._infoByScale={},this._infoByLevel={};const n=e.lods.filter((e=>e.level>=r&&e.level<=i));this.minScale=n[0].scale,this.maxScale=n[n.length-1].scale;const s=this._lodInfos=n.map((r=>l.create(e,r,t)));n.forEach(((e,t)=>{this._infoByLevel[e.level]=s[t],this._infoByScale[e.scale]=s[t],this.scales[t]=e.scale}),this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel["number"==typeof e?e:e.level]}getTileBounds(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];h.set(t);const i=this._infoByLevel[h.level];return i?i.getTileBounds(e,h,r):e}getTileCoords(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];h.set(t);const i=this._infoByLevel[h.level];return i?i.getTileCoords(e,h,r):e}getTileCoverage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:192,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"closest";if(!(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const i="closest"===r?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),n=c.A.pool.acquire(i),s=this._wrap;let o,a,l,h=1/0,f=-1/0;const m=n.spans;p[0][0]=p[0][1]=p[1][1]=p[3][0]=-t,p[1][0]=p[2][0]=e.size[0]+t,p[2][1]=p[3][1]=e.size[1]+t;for(const c of p)e.toMap(c,c),c[0]=i.getColumnForX(c[0]),c[1]=i.getRowForY(c[1]);const g=[];let y=3;for(let c=0;c<4;c++){if(p[c][1]===p[y][1]){y=c;continue}const e=d.create(p[c],p[y]);h=Math.min(e.ymin,h),f=Math.max(e.ymax,f),void 0===g[e.ymin]&&(g[e.ymin]=[]),g[e.ymin].push(e),y=c}if(null==h||null==f||f-h>100)return null;let _=[];for(o=h;o<f;){null!=g[o]&&(_=_.concat(g[o])),a=1/0,l=-1/0;for(let e=_.length-1;e>=0;e--){const t=_[e];a=Math.min(a,t.getLeftCol()),l=Math.max(l,t.getRightCol())}if(a=Math.floor(a),l=Math.floor(l),o>=i.first[1]&&o<=i.last[1])if(s)if(i.size[0]<i.worldSize[0]){const e=Math.floor(l/i.worldSize[0]);for(let t=Math.floor(a/i.worldSize[0]);t<=e;t++)m.push(new u(o,Math.max(i.getFirstColumnForWorld(t),a),Math.min(i.getLastColumnForWorld(t),l)))}else m.push(new u(o,a,l));else a>i.last[0]||l<i.first[0]||(a=Math.max(a,i.first[0]),l=Math.min(l,i.last[0]),m.push(new u(o,a,l)));o+=1;for(let e=_.length-1;e>=0;e--){const t=_[e];t.ymax>=o?t.incrRow():_.splice(e,1)}}return n}getTileParentId(e){h.set(e);const t=this._infoByLevel[h.level],r=this._lodInfos.indexOf(t)-1;return r<0?null:(this._getTileIdAtLOD(h,this._lodInfos[r],h),h.id)}getTileResolution(e){const t=this._infoByLevel["object"==typeof e?e.level:e];return t?t.resolution:-1}getTileScale(e){const t=this._infoByLevel[e.level];return t?t.scale:-1}intersects(e,t){h.set(t);const r=this._infoByLevel[h.level],i=e.lodInfo;if(i.resolution>r.resolution){this._getTileIdAtLOD(h,i,h);const t=i.denormalizeCol(h.col,h.world);for(const r of e.spans)if(r.row===h.row&&r.colFrom<=t&&r.colTo>=t)return!0}if(i.resolution<r.resolution){const[t,n,s,o]=e.spans.reduce(((e,t)=>(e[0]=Math.min(e[0],t.row),e[1]=Math.max(e[1],t.row),e[2]=Math.min(e[2],t.colFrom),e[3]=Math.max(e[3],t.colTo),e)),[1/0,-1/0,1/0,-1/0]),a=r.denormalizeCol(h.col,h.world),l=i.getColumnForX(r.getXForColumn(a)),c=i.getRowForY(r.getYForRow(h.row)),u=i.getColumnForX(r.getXForColumn(a+1))-1,d=i.getRowForY(r.getYForRow(h.row+1))-1;return!(l>o||u<s||c>n||d<t)}const n=i.denormalizeCol(h.col,h.world);return e.spans.some((e=>e.row===h.row&&e.colFrom<=n&&e.colTo>=n))}normalizeBounds(e,t,r){if(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],this._wrap){const t=(0,i.Vp)(this.tileInfo.spatialReference),n=-r*(t.valid[1]-t.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>t[0])return this._infoByScale[t[0]];for(let r=1;r<t.length-1;r++)if(e>t[r]+1e-6)return this._infoByScale[t[r-1]];return this._infoByScale[t[t.length-1]]}getClosestInfoForScale(e){const t=this.scales;return this._infoByScale[e]||(e=t.reduce(((t,r)=>Math.abs(r-e)<Math.abs(t-e)?r:t),t[0])),this._infoByScale[e]}scaleToLevel(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=t.length-1;r>=0;r--)if(e<t[r])return r===t.length-1?this._infoByScale[t[t.length-1]].level:this._infoByScale[t[r]].level+(t[r]-e)/(t[r]-t[r+1]);return this._infoByScale[t[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}zoomToScale(e){return this.tileInfo.zoomToScale(e)}_getTileIdAtLOD(e,t,r){const i=this._infoByLevel[r.level];return e.set(r),t.resolution<i.resolution?null:(t.resolution===i.resolution||(e.level=t.level,e.col=Math.floor(r.col*i.resolution/t.resolution+.01),e.row=Math.floor(r.row*i.resolution/t.resolution+.01)),e)}}},93453:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var i=r(3789);class n{static getId(e,t,r,i){return"object"==typeof e?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${t}/${r}/${i}`}constructor(e,t,r,i){this.set(e,t,r,i)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,t=4095&this.col,r=63&this.level;return(3&this.world)<<30|t<<22|e<<8|r}acquire(e,t,r,i){this.set(e,t,r,i)}contains(e){const t=e.level-this.level;return t>=0&&this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}containsChild(e){const t=e.level-this.level;return t>0&&this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new n(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,t,r,i){if(null==e)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof e)this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if("string"==typeof e){const[t,r,i,n]=e.split("/");this.level=parseFloat(t),this.row=parseFloat(r),this.col=parseFloat(i),this.world=parseFloat(n)}else this.level=+e,this.row=+t,this.col=+r,this.world=+i||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new n(this.level-1,this.row>>1,this.col>>1,this.world)}getNeighborId(e,t){return`${this.level}/${this.row+t}/${this.col+e}/${this.world}`}getChildKeys(){const e=this.level+1,t=this.row<<1,r=this.col<<1,i=this.world;return[new n(e,t,r,i),new n(e,t,r+1,i),new n(e,t+1,r,i),new n(e,t+1,r+1,i)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}}n.pool=new i.A(n,null,null,25,50)},15389:(e,t,r)=>{"use strict";var i=r(35143),n=r(91967),s=r(30726),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842)),l=r(19555),c=r(80544);const u=new Set,h=[],d=new Map,p=[0,0];let f=class extends n.A{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:t,strategy:r}=this;this._queue=new c.e({concurrency:e,process:(e,r)=>{const i=this._keyToItem.get(e);return t(i,{signal:r})},peeker:"scale-first"===r?e=>this._peekByScaleFirst(e):e=>this._peekByCenterFirst(e)})}destroy(){this.clear(),this._queue=(0,s.pR)(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(e){const t="string"==typeof e?e:e.id;this._queue.abort(t)}clear(){this._queue.clear(),this._keyToItem.clear()}has(e){return"string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const t="string"==typeof e?e:e.id;return this.has(t)&&this._queue.isOngoing(t)}pause(){this._queue.pause()}push(e){const t=e.key.id;if(this._queue.has(t))return this._queue.get(t);const r=this._queue.push(t),i=()=>{this._keyToItem.delete(t)};return this._keyToItem.set(t,e),r.then(i,i),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;e.forEach((e=>{const t=this._keyToItem.get(e),n=this.tileInfoView.getTileScale(t.key);d.has(n)||(d.set(n,[]),r=Math.max(n,r),i=Math.min(n,i)),d.get(n).push(t.key),u.add(n)}));let n=this.state.scale;d.has(n)||(function(e,t){e.length=0,t.forEach((t=>e.push(t)))}(h,u),h.sort(((e,t)=>e-t)),n=h.reduce(((e,t)=>Math.abs(t-n)<Math.abs(e-n)?t:e),h[0])),n=Math.min(n,r),n=Math.max(n,i);const s=d.get(n),o=t.getClosestInfoForScale(n),a=o.getColumnForX(this.state.center[0]),l=o.getRowForY(this.state.center[1]);return s.sort(((e,t)=>{const r=o.denormalizeCol(e.col,e.world),i=o.denormalizeCol(t.col,t.world);return Math.sqrt((a-r)*(a-r)+(l-e.row)*(l-e.row))-Math.sqrt((a-i)*(a-i)+(l-t.row)*(l-t.row))})),u.clear(),d.clear(),s[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView,r=this.state.center;let i,n=Number.POSITIVE_INFINITY;return e.forEach((e=>{const s=this._keyToItem.get(e);t.getTileCoords(p,s.key);const o=(0,l.Io)(p,r);o<n&&(n=o,i=s.key)})),i.id}};(0,i._)([(0,o.MZ)({constructOnly:!0})],f.prototype,"concurrency",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],f.prototype,"process",void 0),(0,i._)([(0,o.MZ)()],f.prototype,"state",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],f.prototype,"strategy",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],f.prototype,"tileInfoView",void 0),f=(0,i._)([(0,a.$)("esri.views.2d.tiling.TileQueue")],f)},96345:(e,t,r)=>{"use strict";r(2413),r(19555);r(18798);new(r(93453).A)(0,0,0,0),new Map},84687:(e,t,r)=>{"use strict";r.d(t,{HD:()=>l,Rt:()=>c,bZ:()=>u});var i=r(20664),n=r(9392),s=r(34111),o=r(2413),a=r(29808);function l(e,t,r,i){return null!=e.renderCoordsHelper.fromRenderCoords(t.eye,p,i)&&(0,o.Uc)(r,p)}function c(e,t){return e.elevationProvider?e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground")??0:0}function u(e,t,r,n){const o=e.state.camera.clone();t&&r&&n&&(o.eye=t,o.center=r,o.up=n),function(e,t,r){let n=d[e.viewingMode];n||(n=(0,a.hz)(e.state.viewingMode),n.options.backfacesTerrain=!e.state.isGlobal,n.options.invisibleTerrain=!0,d[e.viewingMode]=n);const{isGlobal:o}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,n,r)||h(e,t.origin,r))||!(!e.renderCoordsHelper.intersectManifold(t,0,r)||h(e,t.origin,r))||!!o&&function(e,t,r){const n=(0,i.m)(e.origin,e.origin)-r*r,s=n>0?Math.sqrt(n)/3:1;return(0,i.j)(t,e.direction,s/(0,i.l)(e.direction)),(0,i.g)(t,t,e.origin),!0}(t,r,(0,s.tO)(e.spatialReference).radius)}(e,o.ray,f)||(0,i.c)(f,o.center);const l=e.state.constraints,c=l.minimumPoiDistance;if((0,i.a)(o.eye,f)<c){const t=l.collision.enabled;(0,i.c)(m,o.viewForward),(0,i.j)(m,m,c),t?o.eye=(0,i.f)(p,f,m):(0,i.g)(f,o.eye,m);const r=e.renderCoordsHelper,n=r.getAltitude(o.eye),s=l.collision.elevationMargin;t&&n<s&&((0,i.f)(m,f,o.eye),o.eye=r.setAltitude(p,s,o.eye),(0,i.g)(f,o.eye,m))}return o.center=f,o}function h(e,t,r){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;const n=c(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:o}=s.compute(t,r,e.renderDataExtent,n,g),a=o*o;return(0,i.a)(t,r)>a}const d={},p=(0,n.vt)(),f=(0,n.vt)(),m=(0,n.vt)(),g={near:0,far:0}},49753:(e,t,r)=>{"use strict";var i,n;function s(e){return null!=e?.cubeMap}function o(e){return null!=e&&!e.running}r.d(t,{c:()=>n,c2:()=>i,pi:()=>o,q9:()=>s}),function(e){e[e.RENDERING=0]="RENDERING",e[e.FADING=1]="FADING",e[e.FINISHED=2]="FINISHED"}(i||(i={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(n||(n={}))},63401:(e,t,r)=>{"use strict";r.d(t,{OQ:()=>i,ny:()=>f});var i,n=r(15941),s=r(34761),o=r(13191),a=r(20664),l=r(9392),c=r(52896),u=r(14556),h=r(49753),d=r(89038),p=r(98476);class f{constructor(){this.readChannels=h.c.RG,this.renderingStage=h.c2.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=(0,l.vt)(),this.parallax=new m,this.parallaxNew=new m,this.pointOnGround=(0,l.vt)(),this.fadeMode=i.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const t=this.parallax,r=(0,a.l)(e.eye);if(t.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(r*r-u.$O.radius*u.$O.radius,0))/r,(0,c.Cr)(g,t.anchorPointClouds,y),(0,s.e$)(t.transform,o.zK,y[3],(0,c.yo)(y)),this.fadeMode===i.CROSS_FADE){const e=this.parallaxNew;(0,c.Cr)(g,e.anchorPointClouds,y),(0,s.e$)(e.transform,o.zK,y[3],(0,c.yo)(y))}}updateFading(e,t,r,i){this.isFading&&this._advanceFading(r,i),this._evaluateFading(e,t,r)}_evaluateFading(e,t,r){const n=e.relativeElevation,s=this._calculateDistanceToAnchorPoint(e);if((n>1.7*d.ni||n<-d.ni||s>x)&&this.opacity>0)this._setFade(i.HIDE,r);else if(!this.isFading)if((n>d.ni||n<-.35*d.ni||s>w)&&this.opacity>0)this._setFade(i.FADE_OUT,r);else if(n<=d.ni&&n>=-.35*d.ni&&t===p.M.IDLE&&(0,h.pi)(this.data)){if(0===this.opacity)return void this._setFade(i.FADE_IN,r);(s>b||this.renderingStage===h.c2.FADING)&&this._setFade(i.CROSS_FADE,r)}}_advanceFading(e,t){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,t)}_advanceFadingFactorAndOpacity(e,t){if(this.fadeFactor<1)return this.fadeFactor=t?(0,n.qE)((e-this.startTime)/(v*t),0,1):1,this.fadeMode===i.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===i.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===i.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===i.FADE_OUT&&(this.opacity=0),this.fadeMode===i.FADE_IN&&(this.opacity=1),this.fadeMode===i.CROSS_FADE&&(this.opacity=1),this.fadeMode=i.NONE}_switchReadChannels(){const e=this.fadeMode===i.CROSS_FADE&&1===this.fadeFactor,t=this.fadeMode===i.FADE_IN&&0===this.fadeFactor;this.renderingStage===h.c2.FADING&&(e||t)&&(this.readChannels=1-this.readChannels,this.renderingStage=h.c2.FINISHED)}_calculateDistanceToAnchorPoint(e){return(0,a.n)(this.pointOnGround,e.eye),(0,a.j)(this.pointOnGround,this.pointOnGround,u.$O.radius),(0,a.l)((0,a.f)(_,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===i.CROSS_FADE&&(0===this.fadeFactor&&(0,a.c)(this.parallaxNew.anchorPointClouds,this.pointOnGround),1===this.fadeFactor&&(0,a.c)(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===i.FADE_IN&&0===this.fadeFactor&&(0,a.c)(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,t){switch(e){case i.HIDE:this.opacity=0;break;case i.FADE_OUT:this.opacity=1;break;case i.FADE_IN:this.opacity=0;break;case i.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=t}get isFading(){return this.fadeMode===i.FADE_OUT||this.fadeMode===i.FADE_IN||this.fadeMode===i.CROSS_FADE}}!function(e){e[e.NONE=0]="NONE",e[e.HIDE=1]="HIDE",e[e.FADE_OUT=2]="FADE_OUT",e[e.FADE_IN=3]="FADE_IN",e[e.CROSS_FADE=4]="CROSS_FADE"}(i||(i={}));class m{constructor(){this.anchorPointClouds=(0,l.vt)(),this.radiusCurvatureCorrectionFactor=0,this.transform=(0,o.vt)()}}const g=(0,l.fA)(0,0,1),y=(0,c.vt)(),_=(0,l.vt)(),v=1.25,b=34e3,w=64e3,x=2e5},46141:(e,t,r)=>{"use strict";r.d(t,{n:()=>o});var i=r(60645);class n{constructor(e,t,r,i,n,s,o,a){let l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:.5;this.coverage=e,this.density=t,this.absorption=r,this.cloudSize=i,this.detailSize=n,this.smoothness=s,this.cloudHeight=o,this.raymarchingSteps=a,this.median=l}}const s=new n([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],i.p.SIXTEEN),o={sunny:s,cloudy:new n([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],i.p.TWOHUNDRED,.6),rainy:new n([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],i.p.TWOHUNDRED,.4),snowy:new n([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],i.p.HUNDRED,.65),foggy:new n([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],i.p.SIXTEEN),default:s}},60645:(e,t,r)=>{"use strict";r.d(t,{H:()=>l,p:()=>i});var i,n=r(35143),s=r(81806),o=r(49753),a=r(99415);!function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"}(i||(i={}));class l extends a.K{constructor(){super(...arguments),this.steps=i.SIXTEEN,this.writeTextureChannels=o.c.RG}}(0,n._)([(0,a.W)({count:i.COUNT})],l.prototype,"steps",void 0),(0,n._)([(0,a.W)({constValue:(0,s.A)("esri-mobile")?1024:2048})],l.prototype,"cubeMapSize",void 0),(0,n._)([(0,a.W)()],l.prototype,"writeTextureChannels",void 0)},39033:(e,t,r)=>{"use strict";r.d(t,{F:()=>o,L:()=>i});var i,n=r(35143),s=r(99415);!function(e){e[e.Full=0]="Full",e[e.WeatherMap=1]="WeatherMap",e[e.COUNT=2]="COUNT"}(i||(i={}));class o extends s.K{constructor(){super(...arguments),this.mode=i.Full}}(0,n._)([(0,s.W)({count:i.COUNT})],o.prototype,"mode",void 0)},89426:(e,t,r)=>{"use strict";r.d(t,{CQ:()=>i,M4:()=>a,QG:()=>l,Y8:()=>n,fI:()=>c,ik:()=>s,jj:()=>o});const i=(0,r(81806).A)("esri-mobile")?64:128,n=i/128,s=Math.ceil(Math.sqrt(i)),o=(i+2)*s,a=1e5,l=128,c=o/1560},90376:(e,t,r)=>{"use strict";r.d(t,{C:()=>i,a:()=>o});var i,n=r(35143),s=r(99415);!function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT"}(i||(i={}));class o extends s.K{constructor(){super(...arguments),this.type=i.Rain}}(0,n._)([(0,s.W)({count:i.COUNT})],o.prototype,"type",void 0)},99650:(e,t,r)=>{"use strict";r.d(t,{$:()=>a,d:()=>i});var i,n=r(35143),s=r(99415),o=r(92656);!function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"}(i||(i={}));class a extends o.E{constructor(){super(...arguments),this.geometry=i.Cone}}(0,n._)([(0,s.W)({count:i.COUNT})],a.prototype,"geometry",void 0)},68814:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i,n=r(35143),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(6409)),l=r(85842);let c=i=class extends s.oY{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new i({cloudCover:this.cloudCover})}};(0,n._)([(0,a.e)({sunny:"sunny"})],c.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),c=i=(0,n._)([(0,l.$)("esri.views.3d.environment.SunnyWeather")],c);const u=c},45462:(e,t,r)=>{"use strict";r.d(t,{GF:()=>n,UP:()=>s,nv:()=>o,yv:()=>a});var i=r(15941);function n(e){const t=1e5;return(0,i.qE)((e-t)/9e5,0,1)}const s=1e4,o=.085,a=1e5},89038:(e,t,r)=>{"use strict";r.d(t,{k9:()=>M,TJ:()=>S,ni:()=>T,eM:()=>w});var i,n=r(35143),s=r(42553),o=r(46053),a=(r(81806),r(76460),r(47249),r(6409)),l=r(85842);let c=i=class extends s.oY{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new i({cloudCover:this.cloudCover})}};(0,n._)([(0,a.e)({cloudy:"cloudy"})],c.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),c=i=(0,n._)([(0,l.$)("esri.views.3d.environment.CloudyWeather")],c);const u=c;var h;let d=h=class extends s.oY{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new h({fogStrength:this.fogStrength})}};(0,n._)([(0,a.e)({foggy:"foggy"})],d.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"fogStrength",void 0),d=h=(0,n._)([(0,l.$)("esri.views.3d.environment.FoggyWeather")],d);const p=d;var f;let m=f=class extends s.oY{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,n._)([(0,a.e)({rainy:"rainy"})],m.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"cloudCover",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"precipitation",void 0),m=f=(0,n._)([(0,l.$)("esri.views.3d.environment.RainyWeather")],m);const g=m;var y;let _=y=class extends s.oY{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new y({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,n._)([(0,a.e)({snowy:"snowy"})],_.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_.prototype,"cloudCover",void 0),(0,n._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_.prototype,"precipitation",void 0),(0,n._)([(0,o.MZ)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],_.prototype,"snowCover",void 0),_=y=(0,n._)([(0,l.$)("esri.views.3d.environment.SnowyWeather")],_);const v=_;var b=r(68814);const w={key:"type",base:b.A,typeMap:{sunny:b.A,cloudy:u,rainy:g,snowy:v,foggy:p}},x=Object.keys(w.typeMap);function S(e,t){return!!x.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const T=1e4,M=1e5},11109:(e,t,r)=>{"use strict";r.d(t,{R:()=>l});var i=r(3825),n=r(98773),s=r(50076),o=r(50346),a=r(90534);class l{constructor(e){this._streamDataRequester=e}async loadJSON(e,t){return this._load("json",e,t)}async loadBinary(e,t){return(0,a.DB)(e)?((0,o.Te)(t),(0,a.lJ)(e)):this._load("binary",e,t)}async loadImage(e,t){return this._load("image",e,t)}async _load(e,t,r){if(null==this._streamDataRequester)return(await(0,i.A)(t,{responseType:c[e]})).data;const a=await(0,n.Ke)(this._streamDataRequester.request(t,e,r));if(!0===a.ok)return a.value;throw(0,o.QP)(a.error),new s.A("",`Request for resource failed: ${a.error}`)}}const c={image:"image",binary:"array-buffer",json:"json","image+type":void 0}},54439:(e,t,r)=>{"use strict";r.d(t,{G:()=>o});var i=r(44680),n=r(59422),s=r(63919);function o(e){if(null==e)return null;const t=null!=e.offset?e.offset:n.uY,r=null!=e.rotation?e.rotation:0,o=null!=e.scale?e.scale:n.Un,a=(0,i.fA)(1,0,0,0,1,0,t[0],t[1],1),l=(0,i.fA)(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),c=(0,i.fA)(o[0],0,0,0,o[1],0,0,0,1),u=(0,i.vt)();return(0,s.lw)(u,l,c),(0,s.lw)(u,a,u),u}},420:(e,t,r)=>{"use strict";r.d(t,{x:()=>o});var i=r(78393),n=r(38496),s=r(93345);function o(e,t){switch(t){case s.WR.TRIANGLES:return function(e){return"number"==typeof e?(0,n.tM)(e):(0,i.mg)(e)?new Uint16Array(e):e}(e);case s.WR.TRIANGLE_STRIP:return function(e){const t="number"==typeof e?e:e.length;if(t<3)return[];const r=t-2,i=(0,n.my)(3*r);if("number"==typeof e){let e=0;for(let t=0;t<r;t+=1)t%2==0?(i[e++]=t,i[e++]=t+1,i[e++]=t+2):(i[e++]=t+1,i[e++]=t,i[e++]=t+2)}else{let t=0;for(let n=0;n<r;n+=1)n%2==0?(i[t++]=e[n],i[t++]=e[n+1],i[t++]=e[n+2]):(i[t++]=e[n+1],i[t++]=e[n],i[t++]=e[n+2])}return i}(e);case s.WR.TRIANGLE_FAN:return function(e){const t="number"==typeof e?e:e.length;if(t<3)return new Uint16Array(0);const r=t-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if("number"==typeof e){let e=0;for(let t=0;t<r;++t)i[e++]=0,i[e++]=t+1,i[e++]=t+2;return i}const n=e[0];let s=e[1],o=0;for(let a=0;a<r;++a){const t=e[a+2];i[o++]=n,i[o++]=s,i[o++]=t,s=t}return i}(e)}}},37040:(e,t,r)=>{"use strict";r.d(t,{KB:()=>a,Xi:()=>s,pn:()=>l,x3:()=>o});var i=r(81806),n=r(83490);class s{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=n.JS.KTX2_ENCODING}}function o(e){return"encoded-mesh-texture"===e?.type}async function a(e){const t=new Blob([e]),r=await t.text();return JSON.parse(r)}async function l(e,t){if(t===n.JS.KTX2_ENCODING)return new s(e);const r=new Blob([e],{type:t}),o=URL.createObjectURL(r),a=new Image;if((0,i.A)("esri-iPhone"))return new Promise(((e,t)=>{const r=()=>{n(),e(a)},i=e=>{n(),t(e)},n=()=>{URL.revokeObjectURL(o),a.removeEventListener("load",r),a.removeEventListener("error",i)};a.addEventListener("load",r),a.addEventListener("error",i),a.src=o}));try{a.src=o,await a.decode()}catch(l){console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(o),a}},56516:(e,t,r)=>{"use strict";r.d(t,{y:()=>V});var i=r(76460),n=r(13191),s=r(93345);var o,a,l=r(50076),c=r(87663),u=r(50346),h=r(90534),d=r(19898),p=r(34761),f=r(60008),m=r(4336),g=r(88105),y=r(39539);r(81806);class _{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const t=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,t,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}}!function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"}(o||(o={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(a||(a={}));var v=r(4212);const b={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},w={pbrMetallicRoughness:b,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},x={ESRI_externalColorMixMode:"tint",ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},S=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={...b,...e.pbrMetallicRoughness},r=function(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:(0,v.Xb)(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return e}({...x,...e.extras});return{...w,...e,pbrMetallicRoughness:t,extras:r}};const T={magFilter:s.Cj.LINEAR,minFilter:s.Cj.LINEAR_MIPMAP_LINEAR,wrapS:s.pF.REPEAT,wrapT:s.pF.REPEAT};var M=r(37040);const A=1179937895,C=1313821514,E=5130562;class R{constructor(e,t,r,i){if(this._context=e,this.uri=t,this.json=r,this._glbBuffer=i,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"],this._baseUri=function(e){let t,r;return e.replace(/^(.*\/)?([^/]*)$/,((e,i,n)=>(t=i||"",r=n||"",""))),{dirPart:t,filePart:r}}(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),null==r.scenes)throw new l.A("gltf-loader-unsupported-feature","Scenes must be defined.");if(null==r.meshes)throw new l.A("gltf-loader-unsupported-feature","Meshes must be defined");if(null==r.nodes)throw new l.A("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,t,r){if((0,h.DB)(t)){const r=(0,h.r$)(t);if(r&&"model/gltf-binary"!==r.mediaType)try{const i=JSON.parse(r.isBase64?atob(r.data):r.data);return new R(e,t,i)}catch{}const i=(0,h.lJ)(t);if(R._isGLBData(i))return this._fromGLBData(e,t,i)}if(k.test(t)||"gltf"===r?.expectedType){const i=await e.loadJSON(t,r);return new R(e,t,i)}const i=await e.loadBinary(t,r);if(R._isGLBData(i))return this._fromGLBData(e,t,i);if(z.test(t)||"glb"===r?.expectedType)throw new l.A("gltf-loader-invalid-glb","This is not a valid glb file.");const n=await e.loadJSON(t,r);return new R(e,t,n)}static _isGLBData(e){if(null==e)return!1;const t=new _(e);return t.remainingBytes()>=4&&t.readUint32()===A}static async _fromGLBData(e,t,r){const i=await R._parseGLBData(r);return new R(e,t,i.json,i.binaryData)}static async _parseGLBData(e){const t=new _(e);if(t.remainingBytes()<12)throw new l.A("gltf-loader-error","glb binary data is insufficiently large.");const r=t.readUint32(),n=t.readUint32(),s=t.readUint32();if(r!==A)throw new l.A("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(e.byteLength<s)throw new l.A("gltf-loader-error","glb binary data is smaller than header specifies.");if(2!==n)throw new l.A("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let o,a,c=0;for(;t.remainingBytes()>=8;){const e=t.readUint32(),r=t.readUint32();if(0===c){if(r!==C)throw new l.A("gltf-loader-error","First glb chunk must be JSON.");if(e<0)throw new l.A("gltf-loader-error","No JSON data found.");o=await(0,M.KB)(t.readUint8Array(e))}else if(1===c){if(r!==E)throw new l.A("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");a=t.readUint8Array(e)}else i.A.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");c+=1}if(!o)throw new l.A("gltf-loader-error","No glb JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,t){const r=this.json.buffers[e];if(null==r.uri){if(null==this._glbBuffer)throw new l.A("gltf-loader-error","glb buffer not present");return this._glbBuffer}const i=await this._getBufferLoader(e,t);if(i.byteLength!==r.byteLength)throw new l.A("gltf-loader-error","Buffer byte lengths should match.");return i}async _getBufferLoader(e,t){const r=this._bufferLoaders.get(e);if(r)return r;const i=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(i),t).then((e=>new Uint8Array(e)));return this._bufferLoaders.set(e,n),n}async getAccessor(e,t){if(!this.json.accessors)throw new l.A("gltf-loader-unsupported-feature","Accessors missing.");const r=this.json.accessors[e];if(null==r?.bufferView)throw new l.A("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(r.type in[o.MAT2,o.MAT3,o.MAT4])throw new l.A("gltf-loader-unsupported-feature",`AttributeType ${r.type} is not supported`);const i=this.json.bufferViews[r.bufferView],n=await this.getBuffer(i.buffer,t),s=L[r.type],a=N[r.componentType],c=s*a,u=i.byteStride||c;return{raw:n.buffer,byteStride:u,byteOffset:n.byteOffset+(i.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:u===c,componentCount:s,componentByteSize:a,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,t){if(null==e.indices)return;const r=await this.getAccessor(e.indices,t);if(r.isDenselyPacked)switch(r.componentType){case s.pe.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case s.pe.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case s.pe.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case s.pe.UNSIGNED_BYTE:return(0,y.m)(D(g.SL,r));case s.pe.UNSIGNED_SHORT:return(0,y.m)(D(g.h,r));case s.pe.UNSIGNED_INT:return(0,y.m)(D(g.P,r))}}async getPositionData(e,t){if(null==e.attributes.POSITION)throw new l.A("gltf-loader-unsupported-feature","No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,t);if(r.componentType!==s.pe.FLOAT)throw new l.A("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+s.pe[r.componentType]);if(3!==r.componentCount)throw new l.A("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return D(g.xs,r)}async getNormalData(e,t){if(null==e.attributes.NORMAL)throw new l.A("gltf-loader-error","No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,t);if(r.componentType!==s.pe.FLOAT)throw new l.A("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+s.pe[r.componentType]);if(3!==r.componentCount)throw new l.A("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return D(g.xs,r)}async getTangentData(e,t){if(null==e.attributes.TANGENT)throw new l.A("gltf-loader-error","No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,t);if(r.componentType!==s.pe.FLOAT)throw new l.A("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+s.pe[r.componentType]);if(4!==r.componentCount)throw new l.A("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed());return new g.Eq(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,t){if(null==e.attributes.TEXCOORD_0)throw new l.A("gltf-loader-error","No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,t);if(2!==r.componentCount)throw new l.A("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed());if(r.componentType===s.pe.FLOAT)return D(g.gH,r);if(!r.normalized)throw new l.A("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return function(e){switch(e.componentType){case s.pe.BYTE:return new g.D6(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case s.pe.UNSIGNED_BYTE:return new g.LC(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case s.pe.SHORT:return new g.mJ(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case s.pe.UNSIGNED_SHORT:return new g.Yi(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case s.pe.UNSIGNED_INT:return new g.An(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case s.pe.FLOAT:return new g.gH(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount)}}(r)}async getVertexColors(e,t){if(null==e.attributes.COLOR_0)throw new l.A("gltf-loader-error","No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,t);if(4!==r.componentCount&&3!==r.componentCount)throw new l.A("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed());if(4===r.componentCount){if(r.componentType===s.pe.FLOAT)return D(g.Eq,r);if(r.componentType===s.pe.UNSIGNED_BYTE)return D(g.XP,r);if(r.componentType===s.pe.UNSIGNED_SHORT)return D(g.Uz,r)}else if(3===r.componentCount){if(r.componentType===s.pe.FLOAT)return D(g.xs,r);if(r.componentType===s.pe.UNSIGNED_BYTE)return D(g.eI,r);if(r.componentType===s.pe.UNSIGNED_SHORT)return D(g.nS,r)}throw new l.A("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+s.pe[r.componentType])}hasPositions(e){return void 0!==e.attributes.POSITION}hasNormals(e){return void 0!==e.attributes.NORMAL}hasVertexColors(e){return void 0!==e.attributes.COLOR_0}hasTextureCoordinates(e){return void 0!==e.attributes.TEXCOORD_0}hasTangents(e){return void 0!==e.attributes.TANGENT}async getMaterial(e,t,r){let i=e.material?this._materialCache.get(e.material):void 0;if(!i){const n=null!=e.material?S(this.json.materials[e.material]):S(),s=n.pbrMetallicRoughness,o=this.hasVertexColors(e),a=this.getTexture(s.baseColorTexture,t),l=this.getTexture(n.normalTexture,t),c=r?this.getTexture(n.occlusionTexture,t):void 0,u=r?this.getTexture(n.emissiveTexture,t):void 0,h=r?this.getTexture(s.metallicRoughnessTexture,t):void 0,d=null!=e.material?e.material:-1;i={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:s.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await a,normalTexture:await l,name:n.name,id:d,occlusionTexture:await c,emissiveTexture:await u,emissiveFactor:n.emissiveFactor,metallicFactor:s.metallicFactor,roughnessFactor:s.roughnessFactor,metallicRoughnessTexture:await h,hasVertexColors:o,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode,colorTextureTransform:s?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:n.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:n.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:n.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:s?.metallicRoughnessTexture?.extensions?.KHR_texture_transform,receiveAmbientOcclusion:n.extras.ESRI_receiveAmbientOcclusion,receiveShadows:n.extras.ESRI_receiveShadows}}return i}async getTexture(e,t){if(!e)return;if(0!==(e.texCoord||0))throw new l.A("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const r=e.index,i=this.json.textures[r],n=(e=>({...T,...e}))(null!=i.sampler?this.json.samplers[i.sampler]:{}),s=F(i),o=this.json.images[s],a=await this._loadTextureImageData(r,i,t);return(0,c.tE)(this._textureCache,r,(()=>{const e=e=>33071===e||33648===e||10497===e,t=e=>{throw new l.A("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${e}`)};return{data:a,wrapS:e(n.wrapS)?n.wrapS:t(n.wrapS),wrapT:e(n.wrapT)?n.wrapT:t(n.wrapT),minFilter:n.minFilter,name:o.name,id:r}}))}getNodeTransform(e){if(void 0===e)return P;let t=this._nodeTransformCache.get(e);if(!t){const r=this.getNodeTransform(this._getNodeParent(e)),i=this.json.nodes[e];i.matrix?t=(0,p.lw)((0,n.vt)(),r,i.matrix):i.translation||i.rotation||i.scale?(t=(0,n.o8)(r),i.translation&&(0,p.Tl)(t,t,i.translation),i.rotation&&(I[3]=(0,f.Xd)(I,i.rotation),(0,p.e$)(t,t,I[3],I)),i.scale&&(0,p.hs)(t,t,i.scale)):t=(0,n.o8)(r),this._nodeTransformCache.set(e,t)}return t}_resolveUri(e){return(0,h.s2)(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=d.R.parse(this.json.asset.version,"glTF");O.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every((e=>this._supportedExtensions.includes(e))))throw new l.A("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach(((e,t)=>{e.children&&e.children.forEach((e=>{this._nodeParentMap.set(e,t)}))}))}async _loadTextureImageData(e,t,r){const i=this._textureLoaders.get(e);if(i)return i;const n=this._createTextureLoader(t,r);return this._textureLoaders.set(e,n),n}async _createTextureLoader(e,t){const r=F(e),i=this.json.images[r];if(i.uri){if(i.uri.endsWith(".ktx2")){const e=await this._context.loadBinary(this._resolveUri(i.uri),t);return new M.Xi(new Uint8Array(e))}return this._context.loadImage(this._resolveUri(i.uri),t)}if(null==i.bufferView)throw new l.A("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(null==i.mimeType)throw new l.A("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[i.bufferView],s=await this.getBuffer(n.buffer,t);if(null!=n.byteStride)throw new l.A("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const o=s.byteOffset+(n.byteOffset||0);return(0,M.pn)(new Uint8Array(s.buffer,o,n.byteLength),i.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await(0,u.nA)(Array.from(this._bufferLoaders.values())),t=await(0,u.nA)(Array.from(this._textureLoaders.values()));return e.reduce(((e,t)=>e+(t?.byteLength??0)),0)+t.reduce(((e,t)=>e+(t?(0,M.x3)(t)?t.data.byteLength:t.width*t.height*4:0)),0)}}const P=(0,p.hM)((0,n.vt)(),Math.PI/2),O=new d.R(2,0,"glTF"),I=(0,m.vt)(),L={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},N={[s.pe.BYTE]:1,[s.pe.UNSIGNED_BYTE]:1,[s.pe.SHORT]:2,[s.pe.UNSIGNED_SHORT]:2,[s.pe.HALF_FLOAT]:2,[s.pe.FLOAT]:4,[s.pe.INT]:4,[s.pe.UNSIGNED_INT]:4};function D(e,t){return new e(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)}function F(e){if(null!=e.extensions?.KHR_texture_basisu)return e.extensions.KHR_texture_basisu.source;if(null!==e.source)return e.source;throw new l.A("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}const k=/\.gltf$/i,z=/\.glb$/i;let U=0;async function V(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=await R.load(e,t,r),l="gltf_"+U++,c={lods:[],materials:new Map,textures:new Map,meta:B(a)},u=!(!a.json.asset.extras||"symbolResource"!==a.json.asset.extras.ESRI_type),h=a.json.asset.extras?.ESRI_webstyleSymbol?.webstyle,d=new Map;await j(a,(async(e,t,u,h)=>{const p=d.get(u)??0;d.set(u,p+1);const f=void 0!==e.mode?e.mode:s.WR.TRIANGLES,m=f===s.WR.TRIANGLES||f===s.WR.TRIANGLE_STRIP||f===s.WR.TRIANGLE_FAN?f:null;if(null==m)return void i.A.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+s.WR[f]+"). Skipping primitive.");if(!a.hasPositions(e))return void i.A.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const g=a.getPositionData(e,r),y=a.getMaterial(e,r,o),_=a.hasNormals(e)?a.getNormalData(e,r):null,v=a.hasTangents(e)?a.getTangentData(e,r):null,b=a.hasTextureCoordinates(e)?a.getTextureCoordinates(e,r):null,w=a.hasVertexColors(e)?a.getVertexColors(e,r):null,x=a.getIndexData(e,r),S={name:h,transform:(0,n.o8)(t),attributes:{position:await g,normal:_?await _:null,texCoord0:b?await b:null,color:w?await w:null,tangent:v?await v:null},indices:await x,primitiveType:m,material:G(c,await y,l)};let T=null;null!=c.meta?.ESRI_lod&&"screenSpaceRadius"===c.meta.ESRI_lod.metric&&(T=c.meta.ESRI_lod.thresholds[u]),c.lods[u]=c.lods[u]||{parts:[],name:h,lodThreshold:T},c.lods[u].parts[p]=S}));for(const i of c.lods)i.parts=i.parts.filter((e=>!!e));const p=await a.getLoadedBuffersSize();return{model:c,meta:{isEsriSymbolResource:u,uri:a.uri,ESRI_webstyle:h},customMeta:{},size:p}}function B(e){const t=e.json;let r=null;return t.nodes.forEach((e=>{const t=e.extras;null!=t&&(t.ESRI_proxyEllipsoid||t.ESRI_lod)&&(r=t)})),r}async function j(e,t){const r=e.json,n=r.scenes[r.scene||0].nodes,s=n.length>1,o=[];for(const i of n){const e=r.nodes[i];o.push(a(i,0)),H(e)&&!s&&e.extensions.MSFT_lod.ids.forEach(((e,t)=>a(e,t+1)))}async function a(n,s){const l=r.nodes[n],c=e.getNodeTransform(n);if(null!=l.weights&&i.A.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),null!=l.mesh){const e=r.meshes[l.mesh];for(const r of e.primitives)o.push(t(r,c,s,e.name))}for(const e of l.children||[])o.push(a(e,s))}await Promise.all(o)}function H(e){return e.extensions?.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function G(e,t,r){const i=t=>{const i=`${r}_tex_${t&&t.id}${t?.name?"_"+t.name:""}`;if(t&&!e.textures.has(i)){const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{data:e,parameters:{wrap:{s:s.pF.REPEAT,t:s.pF.REPEAT,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}(t.data,{wrap:{s:t.wrapS,t:t.wrapT},mipmap:Z.has(t.minFilter),noUnpackFlip:!0});e.textures.set(i,r)}return i},n=`${r}_mat_${t.id}_${t.name}`;if(!e.materials.has(n)){const r=function(){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}}}({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?i(t.colorTexture):void 0,textureNormal:t.normalTexture?i(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?i(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?i(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?i(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],colorTextureTransform:t.colorTextureTransform,normalTextureTransform:t.normalTextureTransform,occlusionTextureTransform:t.occlusionTextureTransform,emissiveTextureTransform:t.emissiveTextureTransform,metallicRoughnessTextureTransform:t.metallicRoughnessTextureTransform,metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor,receiveShadows:t.receiveShadows,receiveAmbientOcclustion:t.receiveAmbientOcclusion});e.materials.set(n,r)}return n}const Z=new Set([s.Cj.LINEAR_MIPMAP_LINEAR,s.Cj.LINEAR_MIPMAP_NEAREST])},75228:(e,t,r)=>{"use strict";r.d(t,{Bk:()=>o,pw:()=>a,r8:()=>l});let i,n=null;const s=new Map;async function o(e){null==n&&(null==i&&(i=r.e(2797).then(r.bind(r,52797))),n=await i);const t=e.view;let o=s.get(t);return o||(o=new n.default({view:t}),s.set(t,o)),await o.initializeWasm(),o.add3DTilesLayerView(e)}function a(e){return s.get(e)}function l(e){const t=e.view,r=s.get(t);r&&r.remove3DTilesLayerView(e)<1&&(s.delete(t),0===s.size&&(i=null,n=null))}},60704:(e,t,r)=>{"use strict";r.d(t,{Bk:()=>o,ds:()=>a,r8:()=>l});let i,n=null;const s=new Map;async function o(e){null==n&&(null==i&&(i=r.e(8300).then(r.bind(r,38300))),n=await i);const t=e.view;let o=s.get(t);return o||(o=new n.default({view:t}),s.set(t,o)),o.addVoxelLayer(e)}function a(e){return s.get(e)}function l(e){const t=e.view,r=s.get(t);r&&r.removeVoxelLayer(e)<1&&(s.delete(t),0===s.size&&(i=null,n=null))}},29308:(e,t,r)=>{"use strict";r.d(t,{B6:()=>f,G8:()=>m,Jf:()=>y,Zd:()=>_});var i=r(34761),n=r(13191),s=r(20664),o=r(9392),a=r(5809),l=r(45308),c=r(67425),u=r(22955),h=r(80935),d=r(9612),p=r(66470);function f(e,t,r,i,n){const s=e.stageObject,o=s.geometries;let a=0;for(const l of o){if(!(0,d.p)(l))continue;const{update:e,averageGeometrySampledElevation:o}=A(l,t,r,i,n);a+=o,e&&s.geometryVertexAttributeUpdated(l,p.r.POSITION)}return a/o.length}function m(e,t,r,n,o,l){const h=e.stageObject,d=t.centerPointInElevationSR;let p=0;h.usesVerticalDistanceToGround?(n(d,M),(0,c.ai)(h,M.verticalDistanceToGround),p=M.sampledElevation):(n(d,M),"absolute-height"!==t.mode&&(p=M.sampledElevation));const f=(0,i.C)(g,l??h.transformation),m=(0,s.s)(T,f[12],f[13],f[14]);u.b.TESTS_DISABLE_OPTIMIZATIONS?(b[0]=d.x,b[1]=d.y,b[2]=M.z,(0,a.l)(d.spatialReference,b,f,o.spatialReference)&&(l?(0,i.C)(l,f):h.transformation=f)):o.setAltitudeOfTransformation(M.z,f);const y=v/o.unitInMeters;return(Math.abs(f[12]-m[0])>=y||Math.abs(f[13]-m[1])>=y||Math.abs(f[14]-m[2])>=y)&&(l?(0,i.C)(l,f):h.transformation=f),p}const g=(0,n.vt)();function y(e,t,r,i,n){const o=e.graphics3DSymbolLayer.lodRenderer;if(null==o)return 0;const l=t.centerPointInElevationSR;i(l,M);const c="absolute-height"!==t.mode?M.sampledElevation:0,h=o.instanceData,d=e.instanceIndex,p=S;h.getGlobalTransform(d,p);const f=(0,s.s)(T,p[12],p[13],p[14]);u.b.TESTS_DISABLE_OPTIMIZATIONS?(b[0]=l.x,b[1]=l.y,b[2]=M.z,(0,a.l)(l.spatialReference,b,p,n.spatialReference)&&h.setGlobalTransform(d,p)):n.setAltitudeOfTransformation(M.z,p);const m=v/n.unitInMeters;return(u.b.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(p[12]-f[0])>=m||Math.abs(p[13]-f[1])>=m||Math.abs(p[14]-f[2])>=m)&&h.setGlobalTransform(d,p),c}function _(e,t,r,i,n){const s=e.stageObject,o=s.geometries;if(0===o.length)return 0;let a=0,l=null,c=0,u=!1;for(const h of o){if(!(0,d.p)(h))continue;const e=h.attributes.get(p.r.POSITION);if(e!==l){const{update:s,averageGeometrySampledElevation:o}=A(h,t,r,i,n);c=o,l=e,u=s}u&&s.geometryVertexAttributeUpdated(h,p.r.POSITION),a+=c}return a/o.length}const v=.01,b=(0,o.vt)(),w=(0,o.vt)(),x=(0,o.vt)(),S=(0,n.vt)(),T=(0,o.vt)(),M=new c.Uk;function A(e,t,r,i,n){let s=!1;const o=e.transformation,a=t.requiresSampledElevationInfo;w[0]=o[12],w[1]=o[13],w[2]=o[14],e.invalidateBoundingInfo();const c=e.getMutableAttribute(p.r.POSITION),d=c.data,f=c.size,m=d.length/f,g=new h.aY(e.mapPositions,r);let y=0,_=0;for(let h=0;h<m;h++){if(x[0]=d[y],x[1]=d[y+1],x[2]=d[y+2],i(g,M),a&&(_+=M.sampledElevation),u.b.TESTS_DISABLE_OPTIMIZATIONS)d[y]=g.array[g.offset],d[y+1]=g.array[g.offset+1],d[y+2]=M.z,(0,l.projectBuffer)(d,r,y,d,n.spatialReference,y,1),d[y]-=w[0],d[y+1]-=w[1],d[y+2]-=w[2],s=!0;else{b[0]=d[y]+w[0],b[1]=d[y+1]+w[1],b[2]=d[y+2]+w[2],n.setAltitude(b,M.z),d[y]=b[0]-w[0],d[y+1]=b[1]-w[1],d[y+2]=b[2]-w[2];const e=v/n.unitInMeters;(Math.abs(x[0]-d[y])>=e||Math.abs(x[1]-d[y+1])>=e||Math.abs(x[2]-d[y+2])>=e)&&(s=!0)}y+=f,g.offset+=3}return _/=m,{update:s,averageGeometrySampledElevation:_}}},49296:(e,t,r)=>{"use strict";r.d(t,{F:()=>s});var i=r(59097),n=r(41595);class s{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,i.Ao)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const r=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?r:e+r}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return null!=r&&(t+=(0,n.g7)(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=(0,i.Tg)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,t,r){if(null==e)return void(this._featureExpressionInfoContext=null);const i=e?.arcade;i&&null!=t&&null!=r?(this._featureExpressionInfoContext=(0,n.o8)(e),(0,n.gf)(this._featureExpressionInfoContext,(0,n.VG)(i.modules,t,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new s;return null!=e&&t.setFromElevationInfo(e),t}}},94683:(e,t,r)=>{"use strict";r.d(t,{I:()=>l,p:()=>a});r(35238);var i=r(18690),n=(r(81806),r(50346)),s=r(59752),o=r(66388);class a{constructor(e,t){this.spatialReference=e,this._view=t}getElevation(e,t,r){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}async queryElevation(e,t,r,i,n){return this._view.elevationProvider.queryElevation(e,t,0,this.spatialReference,n,r,i)}}class l{constructor(e,t,r,i){this.spatialReference=t,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...i,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(s.W6.ELEVATION_QUERY,this)}destroy(){let{completeTasks:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{completeTasks:!1};if(this._frameTask.remove(),this.running)if(e)this.runTask(s.Bb);else for(const t of this._queries)t.result.reject((0,n.NK)())}queryElevation(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=(0,n.Tw)(),a={x:e,y:t,minDemResolution:s,result:o,signal:r};return this._queries.push(a),(0,n.u7)(r,(()=>{(0,i.TF)(this._queries,a),o.reject((0,n.NK)())})),o.promise}get running(){return this._queries.length>0}runTask(e){const t=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return t.forEach((e=>e.result.reject())),void e.madeProgress();const i=t.map((e=>[e.x,e.y])),s=t.reduce(((e,t)=>Math.min(e,t.minDemResolution)),1/0),a=new o.A({points:i,spatialReference:this.spatialReference}),l=t.length>1&&t.some((e=>!!e.signal))?new AbortController:null,c=null!=l?l.signal:t[0].signal;if(null!=l){let e=0;t.forEach((r=>(0,n.u7)(r.signal,(()=>{e++,r.result.reject((0,n.NK)()),e===t.length&&l.abort()}))))}const u={...this._queryOptions,minDemResolution:s,signal:c};r.queryElevation(a,u).then((e=>{t.forEach(((t,r)=>{null!=t.signal&&t.signal.aborted?t.result.reject((0,n.NK)()):t.result.resolve(e.geometry.points[r][2])}))})).catch((e=>{t.forEach((t=>t.result.reject(e)))})),e.madeProgress()}get test(){}}},26611:(e,t,r)=>{"use strict";r.d(t,{L:()=>a});var i=r(76460),n=r(82041),s=r(19852);const o=()=>i.A.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function a(e,t){if(!(0,n.YX)(e))return o().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const r=l[e.callout.type];return r?new r(e,t):(o().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const l={line:s.Ws}},49048:(e,t,r)=>{"use strict";r.d(t,{x:()=>i});class i{constructor(e,t,r){this.graphic=e,this.renderingInfo=t,this.layer=r}}},19852:(e,t,r)=>{"use strict";r.d(t,{Ws:()=>Y,Rj:()=>ee,AG:()=>Q});var i=r(69539),n=r(76931),s=r(9392),o=r(55855),a=r(82041),l=r(29308),c=r(67425),u=r(49296),h=r(49048),d=r(99057),p=r(28350),f=r(24947),m=r(36423),g=r(88265),y=r(90346),_=r(50468),v=r(87634),b=r(51799),w=r(66470),x=r(88685),S=r(59422),T=r(48549),M=r(34981),A=r(59696),C=r(45463),E=r(77730),R=r(52757),P=r(64465),O=r(16506),I=r(42693),L=r(32119),N=r(28584),D=r(40431),F=r(93345),k=r(57162);class z extends I.w{initializeConfiguration(e,t){t.spherical=e.viewingMode===P.RT.Global}initializeProgram(e){return new N.B(e.rctx,z.shader.get().build(this.configuration),L.D)}setPipelineState(e){const t=e?F.MT.ALWAYS:F.MT.LESS;return this.configuration.depthHudEnabled?(0,k.Ey)({depthTest:{func:t},depthWrite:k.kn}):(0,k.Ey)({blending:(0,k.p3)(F.dn.ONE,F.dn.SRC_ALPHA,F.dn.ONE_MINUS_SRC_ALPHA,F.dn.ONE_MINUS_SRC_ALPHA),depthTest:{func:t},colorWrite:k.wE})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}}z.shader=new O.$(D.L,(()=>r.e(9873).then(r.bind(r,99873))));var U=r(35143),V=r(99415),B=r(92656);class j extends B.E{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.multipassEnabled=!1}}(0,U._)([(0,V.W)()],j.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,U._)([(0,V.W)()],j.prototype,"spherical",void 0),(0,U._)([(0,V.W)()],j.prototype,"occlusionTestEnabled",void 0),(0,U._)([(0,V.W)()],j.prototype,"hasVerticalOffset",void 0),(0,U._)([(0,V.W)()],j.prototype,"hasScreenSizePerspective",void 0),(0,U._)([(0,V.W)()],j.prototype,"depthHudEnabled",void 0),(0,U._)([(0,V.W)()],j.prototype,"depthHudAlignStartEnabled",void 0),(0,U._)([(0,V.W)()],j.prototype,"hasSlicePlane",void 0),(0,U._)([(0,V.W)()],j.prototype,"multipassEnabled",void 0),(0,U._)([(0,V.W)({constValue:!0})],j.prototype,"hasSliceInVertexProgram",void 0),(0,U._)([(0,V.W)({constValue:!1})],j.prototype,"draped",void 0);class H extends C.im{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new Z),this.produces=new Map([[E.N.LINE_CALLOUTS,e=>e===M.V.Color],[E.N.LINE_CALLOUTS_HUD_DEPTH,e=>e===M.V.Color]]),this._configuration=new j,this._uniqueMaterialIdentifier=H.uniqueMaterialIdentifier(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,t){const r=t?.slot!==E.N.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective,this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration}intersect(){}createGLMaterial(e){return new G(e)}createBufferWriter(){return new W}validateParameters(e){const t=H.uniqueMaterialIdentifier(e);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t)}static uniqueMaterialIdentifier(e){let{renderOccluded:t,isDecoration:r,horizontalScreenOffset:i,color:n,size:s,occlusionTest:o,shaderPolygonOffset:a,depthHUDAlignStart:l,centerOffsetUnits:c,hasSlicePlane:u,screenSizePerspective:h,verticalOffset:d,borderColor:p}=e;return x.ML`${t}:${r}:${i}:[${n}]:${s}:${o}:${a}:${l}:${c}:${u}:${null!=h}:{${d.screenLength}:${d.minWorldLength}:${d.maxWorldLength}}:[${p}]`}}class G extends A.A{beginSlot(e){return this.ensureTechnique(z,e)}}class Z extends C.qA{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const $=(0,T.BP)().vec3f(w.r.POSITION).vec3f(w.r.NORMAL).vec2f(w.r.UV0).vec4f(w.r.CENTEROFFSETANDDISTANCE),q=[(0,S.fA)(0,0),(0,S.fA)(1,0),(0,S.fA)(0,1),(0,S.fA)(1,0),(0,S.fA)(1,1),(0,S.fA)(0,1)];class W{constructor(){this.vertexBufferLayout=$}elementCount(e){return 6*e.attributes.get(w.r.POSITION).indices.length}write(e,t,r,i,n){(0,R.Hk)(r.attributes.get(w.r.POSITION),e,i.position,n,6),(0,R.p1)(r.attributes.get(w.r.NORMAL),t,i.normal,n,6),(0,R.Ut)(r.attributes.get(w.r.CENTEROFFSETANDDISTANCE),i.centerOffsetAndDistance,n,6);for(let s=0;s<q.length;++s)i.uv0.setVec(n+s,q[s])}}class Y extends f.U{constructor(e,t){super(e,null,t,K),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new H(this._materialParameters),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const t=this._materialParameters;return t.horizontalScreenOffset=e.horizontalScreenOffset??0,t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get _materialParameters(){const e=new Z,t=this.symbol,r=t.callout;if(e.color=null!=r.color?i.A.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=(0,n.Lz)(r.size||0),t.verticalOffset){const{screenLength:r,minWorldLength:i,maxWorldLength:s}=t.verticalOffset;e.verticalOffset={screenLength:(0,n.Lz)(r),minWorldLength:i||0,maxWorldLength:null!=s?s:1/0}}e.borderColor=null!=r.border?.color?i.A.toUnitRGBA(r.border.color):null;const s="object"===t.symbolLayers.at(0).type,o="label-3d"===t.type;return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=o,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return J}createGraphics3DGraphic(e){const t=e.renderingInfo,r=e.graphic,i=this.setGraphicElevationContext(r,new u.F,t.elevationOffset||0),n=t.symbol,s="on-the-ground"===this._elevationContext.mode&&("cim"===n.type||!n.symbolLayers.some((e=>"object"===e.type||"text"===e.type)));if("label-3d"!==n.type&&s)return null;if("point-3d"===n.type&&n.symbolLayers.every((e=>"text"===e.type&&!(0,a.Ie)(e))))return null;const o=(0,m.W$)(r.geometry);return null==o?null:this._createAs3DShape(o,i,t,r.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=(0,c.I2)(Y.elevationModeChangeTypes,r,i);return n!==c.uw.UPDATE||e.forEach((e=>{const r=t(e);null!=r&&this.updateGraphicElevationContext(e.graphic,r)})),n}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return super.setGraphicElevationContext(e,t),t.addOffsetRenderUnits(r),t}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,null!=t.metadata?t.metadata.elevationOffset:0),t.needsElevationUpdates=(0,c.nu)(t.elevationContext.mode)}computeComplexity(){return new y.rz({verticesPerFeature:6})}_getOrCreateMaterial(e){const t=this._perInstanceMaterialParameters(e),r=H.uniqueMaterialIdentifier(t);if(r===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(null!=e.materialCollection){let i=e.materialCollection.get(r);return null==i&&(i=new H(t),e.materialCollection.add(r,i)),{material:i,isUnique:!1}}return{material:new H(t),isUnique:!0}}_createAs3DShape(e,t,r,i){const n=this._context.layer.uid,s=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:n}),o=this._getOrCreateMaterial(r),a=new b.V(o.material,function(e){const{translation:t,centerOffset:r}=e,i=new _.n(t?[t[0],t[1],t[2]]:[0,0,0],X,3,!0),n=new _.n(r?[r[0],r[1],r[2],r[3]]:[0,0,0,1],X,4,!0);return[[w.r.POSITION,i],[w.r.NORMAL,new _.n([0,0,1],X,3,!0)],[w.r.CENTEROFFSETANDDISTANCE,n]]}(r),null,v.X.Point,s),u=(0,g.SZ)(this._context,e,a,t,i);if(null==u)return null;const h=new d.Y(this,u.object,[a],o.isUnique?[o.material]:null,null,l.G8,t);return h.metadata=new p.Z(r.elevationOffset),h.alignedSampledElevation=u.sampledElevation,h.needsElevationUpdates=(0,c.nu)(t.mode),(0,g.d2)(h,e,this._context.elevationProvider),h}}Y.elevationModeChangeTypes={definedChanged:c.uw.UPDATE,staysOnTheGround:c.uw.UPDATE,onTheGroundChanged:c.uw.RECREATE};const X=[0],J={mode:"relative-to-ground",offset:0},K={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class Q{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,s.vt)(),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,o.vt)(),n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"world",l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.renderer=e,this.symbol=t,this.translation=r,this.centerOffset=i,this.horizontalScreenOffset=n,this.centerOffsetUnits=a,this.elevationOffset=l,this.materialCollection=c}}class ee extends h.x{}},99057:(e,t,r)=>{"use strict";r.d(t,{H:()=>d,Y:()=>p});var i=r(20664),n=r(9392),s=r(42294),o=r(93582),a=r(67425),l=r(41595),c=r(36423),u=r(83490),h=r(46702);class d{constructor(e,t,r){this.baseMaterial=e,this.edgeMaterials=t,this.properties=r}}class p{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,t,r,i,n,s,o){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=r,this._uniqueMaterials=i,this._sharedResource=n,this.elevationAligner=s,this.elevationContext=o,this._edgeState=a,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const t=e.stage;t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),e.renderer.edgeView?.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,t){const{stageObject:r,_edgeState:i,_stageLayer:n}=this;if(null==i)return;const s=f(i.baseMaterial);let o=!1;for(const a of i.edgeMaterials)a.objectTransparency!==s&&(a.objectTransparency=s,o=!0);o&&this.resetEdgeObject(t),n.stage.renderer.withEdgeView((t=>{t.updateAllComponentOpacities(r,[e])}))}slicePlaneEnabledChanged(e,t){const{stageObject:r,_edgeState:i,_stageLayer:n}=this;null!=i&&n.stage.renderer.withEdgeView((n=>{n.updateAllComponentMaterials(r,i.edgeMaterials,{hasSlicePlane:e},!t),i.properties.hasSlicePlane=e}))}setVisibility(e){const{_edgeState:t,stageObject:r,_stageLayer:i}=this;null!=i&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(i.add(r),this._addedToStage=!0),null!=t&&i.stage.renderer.withEdgeView((i=>{i.hasObject(r)?i.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(t,i,!1)})))}get visible(){return this._visible}alignWithElevation(e,t,r,i){if(null==this.elevationAligner)return;null!=r&&(0,l.gf)(this.elevationContext.featureExpressionInfoContext,r);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,((r,i)=>(0,a.sE)(r,e,this.elevationContext,t,i)),t),this.resetEdgeObject(i)}alignWithAbsoluteElevation(e,t,r){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,((t,r)=>{r.sampledElevation=e,r.verticalDistanceToGround=0,r.z=e}),t),this.resetEdgeObject(r)}getCenterObjectSpace(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.vt)();return(0,i.c)(e,(0,o.g)(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.vt)();const t=this.stageObject.boundingVolumeObjectSpace;return(0,s.Ne)(e,t.min),(0,s.vI)(e,t.max),e}computeAttachmentOrigin(e){const t=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(y)&&((0,i.h)(y,y,t),(0,i.g)(e.render.origin,e.render.origin,y),e.render.num++)}async getProjectedBoundingBox(e,t,r,n,o){const a=this.getBoundingBoxObjectSpace(o),l=_,u=(0,s.fT)(a)?1:l.length;for(let s=0;s<u;s++){const e=l[s];g[0]=a[e[0]],g[1]=a[e[1]],g[2]=a[e[2]],(0,i.h)(g,g,this.stageObject.transformation),m[3*s]=g[0],m[3*s+1]=g[1],m[3*s+2]=g[2]}if(!e(m,0,u))return null;(0,s.Ie)(a);let h=null;this.calculateRelativeScreenBounds&&(h=this.calculateRelativeScreenBounds());for(let i=0;i<3*u;i+=3){for(let e=0;e<3;e++)a[e]=Math.min(a[e],m[i+e]),a[e+3]=Math.max(a[e+3],m[i+e]);h&&r.push({location:m.slice(i,i+3),screenSpaceBoundingRect:h})}if(t?.service&&"absolute-height"!==this.elevationContext.mode){(0,s.gX)(a,y);const e="relative-to-scene"===this.elevationContext.mode?"scene":"ground";let r=0;if(t.useViewElevation)r=t.service.getElevation(y[0],y[1],e)??0;else try{const i=(0,c.vY)(a,t.service.spatialReference,t);r=await t.service.queryElevation(y[0],y[1],n,i,e)??0}catch(d){}(0,s.cY)(a,0,0,-this.alignedSampledElevation+r)}return a}addObjectState(e,t){e===u.Mg.Highlight&&t.addObject(this.stageObject,this.stageObject.highlight()),e===u.Mg.MaskOccludee&&t.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:t,stageObject:r,_stageLayer:i,_visible:n}=this;null!=t&&i.stage.renderer.withEdgeView((i=>{n?this._addOrUpdateEdgeObject(t,i,e):i.removeObject(r)}))}_addOrUpdateEdgeObject(e,t,r){const i=f(e.baseMaterial);for(const n of e.edgeMaterials)n.objectTransparency=i;t.addOrUpdateObject3D(this.stageObject,e.edgeMaterials,e.properties,!r).then((()=>this._stageLayer?.sync()))}}function f(e){return e.isVisible()?e.parameters.transparent?h.x.TRANSPARENT:h.x.OPAQUE:h.x.INVISIBLE}const m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=(0,n.vt)(),y=(0,n.vt)(),_=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]]},28350:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});class i{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.labelText=t,this.elevationOffset=e??0}}},64573:(e,t,r)=>{"use strict";r.d(t,{RL:()=>n,ZC:()=>s,kf:()=>i});const i=3,n=3,s=10},80141:(e,t,r)=>{"use strict";r.d(t,{Z:()=>yl});var i=r(18690),n=r(98773),s=r(81806),o=r(50346),a=r(48989),l=r(21499),c=r(3789),u=r(19555),h=r(72745),d=r(20664),p=r(9392),f=r(65215),m=r(50840),g=r(42294),y=r(2413),_=r(80963),v=r(99784),b=r(98618),w=r(89422),x=r(41595);const S=new c.A(Array,(e=>(0,g.hZ)(e,g.v_)),null,10,5),T=(0,y.vt)();class M{get labelLayers(){return this._labelLayers||i.tR}get extent(){return this._extent}get isElevationSource(){return this.layers.some((e=>e?.isElevationSource))}constructor(e,t,r,i,n){this.graphic=e,this.graphics3DSymbol=t,this.layers=r,this._visibleFlags=w.Z.ALL_LABEL,this.deconflictionPriority=0,++t.referenced,this._featureExpressionFeature=n?(0,x.VG)(n,e,i):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic((t=>{t.initialize(e),t.setVisibility(this.isVisible())}))}destroy(){this._forEachSymbolLayerGraphic((e=>e.destroy())),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this.layers}clearLabelGraphics(){this._forEachLabelGraphic((e=>e.destroy())),this._labelLayers=null}addLabelGraphic(e,t){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(t),e.setVisibility(this.isVisible(w.u.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic((t=>{"draped"===t.type&&(e=!0)})),e}isVisible(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.u.GRAPHIC,t=arguments.length>1?arguments[1]:void 0;const r=t?this._visibleFlags|t|w.u.LABEL*t:this._visibleFlags;return e===w.u.GRAPHIC?(r&w.Z.ALL_GRAPHIC)===w.Z.ALL_GRAPHIC:(r&w.Z.ALL_LABEL)===w.Z.ALL_LABEL}setVisibilityFlag(e,t,r){const i=this.isVisible(e);r?this._visibleFlags|=e*t:this._visibleFlags&=~(e*t);const n=this.isVisible(e);if(i===n)return!1;if(e===w.u.LABEL)this._forEachLabelGraphic((e=>e.setVisibility(n)));else{this._forEachSymbolLayerGraphic((e=>e.setVisibility(n)));const e=this.isVisible(w.u.LABEL);this._forEachLabelGraphic((t=>t.setVisibility(e)))}return!0}getVisibilityFlag(e,t){return!!(this._visibleFlags&e*t)}computeExtent(e){if(!this._extent){const t=this.graphic.geometry;if(null==t)return!1;this._extent=(0,y.vt)(),(0,v.iQ)(t,this._extent);const r=t.spatialReference;if(!(0,_.aI)(r,e)&&!(0,m.S)(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,t,r){let i=e.geometry;return"mesh"!==i.type&&"extent"!==i.type||(i=f.A.fromExtent("mesh"===i.type?i.extent:i)),(0,b.Ux)(i,t,r)}get usedMemory(){let e=(0,l.eY)(this.graphic.attributes);return this._forEachSymbolLayerGraphic((t=>e+=t.graphics3DSymbolLayer.usedMemory)),e}computeAttachmentOrigin(){const e={render:{origin:(0,p.vt)(),num:0},draped:{origin:(0,h.vt)(),num:0}};for(const t of this.layers)null!=t&&t.computeAttachmentOrigin(e);return e.render.num>1&&(0,d.j)(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&(0,u.hs)(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,r,i,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?(0,g.Ie)(s.boundingBox):s.boundingBox=(0,g.Ie)(),s.requiresDrapedElevation=!1,await(0,n.jJ)(this.layers,(async n=>{if(null==n)return;const o="draped"===n.type?t:e,a=S.acquire(),l=await n.getProjectedBoundingBox(o,r,s.screenSpaceObjects,i,a);isFinite(l[2])&&isFinite(l[5])||(s.requiresDrapedElevation=!0),l&&(0,g.RF)(s.boundingBox,a),S.release(a)})),(0,g.vQ)(s.boundingBox)||(0,y.vQ)((0,g.ES)(s.boundingBox,T))?s:null}needsElevationUpdates(){for(const e of this.layers)if(null!=e&&("object3d"===e.type||"lod-instance"===e.type)&&e.needsElevationUpdates)return!0;return this._labelLayers?.some((e=>e?.needsElevationUpdates??!1))??!1}alignWithElevation(e,t,r){this._forEachRenderedGraphic((i=>{"object3d"!==i.type&&"lod-instance"!==i.type||i.alignWithElevation(e,t,this._featureExpressionFeature,r)}))}alignWithAbsoluteElevation(e,t,r){this._forEachRenderedGraphic((i=>{"object3d"===i.type&&i.alignWithAbsoluteElevation(e,t,r)}))}addObjectStateSet(e,t){this._forEachSymbolLayerGraphic((r=>r.addObjectState(e,t)))}removeObjectState(e){this._forEachSymbolLayerGraphic((t=>t.removeObjectState(e)))}_forEachGraphicList(e,t){e?.forEach((e=>e&&t(e)))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}}var A=r(99057),C=r(22294),E=r(76460),R=r(50076),P=r(53084),O=r(31633),I=r(38983),L=r(63919),N=r(44680),D=r(34761),F=r(13191),k=r(5809),z=r(44815),U=r(38496),V=r(45136),B=r(59883),j=r(86486),H=r(64465),G=r(67425),Z=r(24947),$=r(36423),q=r(41854),W=(r(35238),r(5568)),Y=r(10294),X=r(50468),J=r(87634),K=r(51799),Q=r(66470),ee=r(76797);function te(e,t,r){const i=(t.length>0?t[0]:e.length/3)-1,n=(0,Y.S)(e,i,r);if(n!==W._.Z){e=e.slice();for(let t=0;t<e.length;t+=3)e[t+n]=e[t+2]}return(0,I.e)(e,t,3)}function re(e){const t=[[Q.r.POSITION,new X.n(e.attributeData.position,e.indices,3,!0)]],r=(0,U.EH)(e.indices.length);return null!=e.attributeData.colorFeature?t.push([Q.r.COLORFEATUREATTRIBUTE,new X.n([e.attributeData.colorFeature],r,1,!0)]):e.attributeData.color&&t.push([Q.r.COLOR,new X.n(e.attributeData.color,r,4,!0)]),e.attributeData.uvMapSpace&&t.push([Q.r.UVMAPSPACE,new X.n(e.attributeData.uvMapSpace,e.indices,4,!0)]),e.attributeData.boundingRect&&t.push([Q.r.BOUNDINGRECT,new X.n(e.attributeData.boundingRect,e.indices,9,!0)]),new K.V(e.material,t,e.mapPositions,J.X.Mesh,e.attributeData.objectAndLayerIdColor)}function ie(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r=[[Q.r.POSITION,new X.n(e.attributeData.position,e.indices,3,!0)],[Q.r.UV0,new X.n(e.attributeData.uv0,e.indices,2,!0)]];return new K.V(e.material,r,e.mapPositions,J.X.Mesh,t)}function ne(e){switch(e.type){case"extent":if(e instanceof ee.A)return f.A.fromExtent(e);break;case"polygon":return e}return null}class se{constructor(e,t,r){this.renderData=e,this.layerUid=t,this.graphicUid=r,this.outGeometries=new Array}}var oe=r(7342),ae=r(22955),le=r(80935),ce=r(45308),ue=r(99785),he=r(33169);function de(e,t,r,i){const n=(0,ue.oR)(e.rings,!!e.hasZ&&"on-the-ground"!==i.mode,ue.Wq.CCW_IS_HOLE,e.spatialReference),s=(0,z.jh)(n.position.length),o=(0,G.au)(n.position,e.spatialReference,0,s,0,n.position,0,n.position.length/3,t,r,i),a=null!=o;return new be(n.position,s,me(n.polygons,n.position,s),fe(n.outlines,n.position,s),a,o)}function pe(e,t){const r=(0,ue.oR)(e.rings,!1,ue.Wq.CCW_IS_HOLE),i=(0,ce.projectBuffer)(r.position,e.spatialReference,0,r.position,t,0,r.position.length/3);for(let n=2;n<r.position.length;n+=3)r.position[n]=he.bi;return{position:r.position,polygons:me(r.polygons,r.position),outlines:fe(r.outlines,r.position),projectionSuccess:i}}function fe(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e.filter((e=>{let{count:t}=e;return t>1})).map((e=>{let{index:i,count:n}=e;const s=3*i,o=3*n;return null!=r?new ye(i,n,(0,z.l5)(t,s,o),(0,z.l5)(r,s,o)):new ge(i,n,(0,z.l5)(t,s,o))}))}function me(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new Array;for(const{index:n,count:s,holeIndices:o,pathLengths:a}of e){if(s<=1)continue;const e=3*n,l=3*s,c=o.map((e=>e-n)),u=null!=r?new _e(n,s,(0,z.l5)(t,3*n,3*s),(0,z.l5)(r,e,l),c,a):new ve(n,s,(0,z.l5)(t,3*n,3*s),c,a);i.push(u)}return i}class ge{constructor(e,t,r){this.index=e,this.count=t,this.position=r}}class ye extends ge{constructor(e,t,r,i){super(e,t,r),this.mapPositions=i}}class _e extends ye{constructor(e,t,r,i,n,s){super(e,t,r,i),this.holeIndices=n,this.pathLengths=s}}class ve extends ge{constructor(e,t,r,i,n){super(e,t,r),this.holeIndices=i,this.pathLengths=n}}class be{constructor(e,t,r,i,n,s){this.position=e,this.mapPositions=t,this.polygons=r,this.outlines=i,this.projectionSuccess=n,this.sampledElevation=s}}var we=r(59046),xe=r(83490),Se=r(9612),Te=r(25672),Me=r(37046),Ae=r(65131);const Ce=["polygon","extent"];class Ee extends Z.U{constructor(e,t,r,i){super(e,t,r,i),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=(0,$.Hj)(this._getSymbolSize());if(e)throw new R.A("graphics3dextrudesymbollayer:invalid-size",e)}const e=this.symbolLayer?.material?.color,t=this._getCombinedOpacityAndColor(e),r=(0,p.ci)(t),i=t[3],n=i<1||this.needsDrivenTransparentPass,s={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:i,transparent:n,cullFace:n?xe.s2.None:xe.s2.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:we.W.Compressed};this._materials[Ke.Main]=new Ae.$U(s),this._materials[Ke.Bottom]=new Ae.$U({...s,cullFace:xe.s2.Back}),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Ce,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),i=this.setGraphicElevationContext(t);return this._createAs3DShape(t,e.renderingInfo,r,i,t.uid)}layerOpacityChanged(e,t){const r=this.symbolLayer?.material?.color,i=this._getCombinedOpacity(r),n=i<1||this.needsDrivenTransparentPass;this._materials[Ke.Main]?.setParameters({opacity:i,transparent:n}),this._materials[Ke.Bottom]?.setParameters({opacity:i,transparent:n});const s=this._getLayerOpacity();e.forEach((e=>{const r=t(e);null!=r&&r.layerOpacityChanged(s,this._context.isAsync)}))}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,G.Kf)}slicePlaneEnabledChanged(e,t){return this._materials[Ke.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Ke.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach((e=>{const r=t(e);null!=r&&r.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)})),!0}physicalBasedRenderingChanged(){const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return this._materials[Ke.Main]?.setParameters(e),this._materials[Ke.Bottom]?.setParameters(e),!0}_getExtrusionSize(e){let t;return t=e.size&&this._drivenProperties.size?(0,j.kg)(e.size,2)??0:this._getSymbolSize(),t/=this._context.renderCoordsHelper.unitInMeters,t}applyRendererDiff(e,t){return this._drivenPropertiesChanged(t)?q.w.RecreateSymbol:q.w.RecreateGraphics}async queryForSnapping(e,t,r,i){const n=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/(0,O.G9)(t),{objectId:s,target:o}=e,a=(0,P.o8)(o);switch(a.z=(a.z??0)+n,e.type){case"edge":{const{start:t,end:r}=e,i=(0,P.o8)(t),o=(0,P.o8)(r);return i.z=(i.z??0)+n,o.z=(o.z??0)+n,[(0,B.P)(s,a,1/0,i,o)]}case"vertex":return[(0,B.k)(s,a,1/0),(0,B.P)(s,o,1/0,o,a)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,t,r,i,n){const s=ne(e.geometry);if(null==s)return null;if(0===s.rings.length||!s.rings.some((e=>e.length>0)))return this._logGeometryValidationWarnings(s.rings,"rings","ExtrudeSymbol3DLayer"),null;const o=de(s,this._context.elevationProvider,this._context.renderCoordsHelper,i);this._logGeometryCreationWarnings(o,s.rings,"rings","ExtrudeSymbol3DLayer");const a=(0,$.W$)(s);if(null==a)return null;const l=new Array,c=new Array,u=(0,g.vt)(),h=(0,F.vt)(),f=(0,p.vt)(),m=this._context.renderCoordsHelper.viewingMode===H.RT.Global;m||this._context.renderCoordsHelper.worldUpAtPosition(null,f),(0,k.l)(s.spatialReference,[a.x,a.y,0],h,this._context.renderCoordsHelper.spatialReference);const y=(0,F.vt)();(0,D.B8)(y,h);const _=(0,N.vt)();(0,L.Ge)(_,y);const{polygons:v,mapPositions:b,position:w}=o,x=new Map,S=this._materials[Ke.Main];for(const d of v){const e=d.count;if(this._context.clippingExtent&&((0,g.Ie)(u),(0,g.Hq)(u,d.mapPositions),!(0,g.KG)(u,this._context.clippingExtent)))continue;const i=(0,I.e)(d.mapPositions,d.holeIndices,3);if(0===i.length)continue;const s=i.length,o=6*e,a=(0,U.my)(o+s),p=(0,U.my)(s),_=(0,z.jh)(3*o),v=(0,z.jh)(3*o),T=(0,z.jh)(3*o),M=(0,z.jh)(o);Pe(w,b,i,d,_,T,v,M,a,p,this._getExtrusionSize(t),f,m),(0,V.a)(_,_,y);const A=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),C=new Qe(_,T,(0,Te.fA)(v),M),E=Re(S,a,a.length-p.length,C,r,A),R=e,P=e,O=2*d.count,L=new et(R,P,O,s/3);Be(E,L,h),x.set(E,L),l.push(E,Re(this._materials[Ke.Bottom],p,0,C,r,A)),c.push(C.heights)}if(0===l.length)return null;const T=new Me.B({geometries:l,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});T.transformation=h;const M=(0,oe.Cc)(this.symbolLayer,{opacity:this._getLayerOpacity()}),C=null!=M?{baseMaterial:this._materials[Ke.Main],edgeMaterials:[M],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,E=new A.Y(this,T,l,null,null,((e,t,r,i,n)=>function(e,t,r,i,n,s,o){const a=e.stageObject,l=a.geometries,c=l.length,u="absolute-height"!==t.mode;let h=0;const p=a.transformation,f=(0,D.Qw)((0,F.vt)(),p);for(let m=0;m<c;m+=2){const e=l[m];if(!(0,Se.p)(e))continue;const t=e.getMutableAttribute(Q.r.POSITION).data,c=s[m/2],g=new le.aY(e.mapPositions),y=t.length/3;let _=!1,v=0;{let e=0;for(let s=0;s<y;s++){Ve[0]=t[e],Ve[1]=t[e+1],Ve[2]=t[e+2],i(g,Ge),u&&(v+=Ge.sampledElevation),ae.b.TESTS_DISABLE_OPTIMIZATIONS?((0,d.s)(je,g.array[g.offset],g.array[g.offset+1],Ge.z+c[e/3]),null!=r&&n.toRenderCoords(je,r,je),(0,d.h)(je,je,f)):((0,d.s)(je,t[e],t[e+1],t[e+2]),(0,d.h)(je,je,p),n.setAltitude(je,Ge.z+c[e/3]),(0,d.h)(je,je,f)),t[e]=je[0],t[e+1]=je[1],t[e+2]=je[2];const s=qe/n.unitInMeters;(Math.abs(Ve[0]-t[e])>=s||Math.abs(Ve[1]-t[e+1])>=s||Math.abs(Ve[2]-t[e+2])>=s)&&(_=!0),g.offset+=3,e+=3}}if(_){const t=o.get(e);t&&Be(e,t,p),a.geometryVertexAttributeUpdated(l[m],Q.r.NORMALCOMPRESSED),e.invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[m],Q.r.POSITION),l[m+1].invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[m+1],Q.r.POSITION)}h+=v/y}return h/c}(e,t,r,i,n,c,x)),i,C);return E.alignedSampledElevation=o.sampledElevation,E.needsElevationUpdates=(0,G.Kf)(i.mode),E}}function Re(e,t,r,i,n,s){const o=(0,U.EH)(t.length),a=[[Q.r.POSITION,new X.n(i.positions,t,3,!0)],[Q.r.NORMALCOMPRESSED,new X.n(i.normals,t,2,!0)],[Q.r.COLOR,new X.n(n,o,4,!0)]];return new K.V(e,a,i.elevation,J.X.Mesh,s,r)}function Pe(e,t,r,i,n,s,o,a,l,c,u,h,p){{const f=r.length/3,m=2*i.count;!function(e,t,r,i,n,s,o,a,l,c,u,h,p,f,m,g,y){(0,d.c)(He,g);{const n=m>0?1:-1;let s=3*r,o=0,h=3*o,p=i,f=3*p;for(let r=0;r<i;++r){const r=e[s],i=e[s+1],g=e[s+2];y&&(He[0]=r,He[1]=i,He[2]=g,(0,d.n)(He,He)),a[h+0]=r,a[h+1]=i,a[h+2]=g;const _=t[s+0],v=t[s+1],b=t[s+2];l[h+0]=_,l[h+1]=v,l[h+2]=b,c[h+0]=-n*He[0],c[h+1]=-n*He[1],c[h+2]=-n*He[2],u[o]=0,a[f+0]=r+m*He[0],a[f+1]=i+m*He[1],a[f+2]=g+m*He[2],l[f+0]=_,l[f+1]=v,l[f+2]=b,u[p]=m,h+=3,f+=3,s+=3,o+=1,p+=1}}{let e=3*s,t=0,r=3*f;const a=m<0?$e:Ze,l=m<0?Ze:$e;for(let s=0;s<o;++s)p[t]=n[e+a[0]],p[t+1]=n[e+a[1]],p[t+2]=n[e+a[2]],h[r]=n[e+l[0]]+i,h[r+1]=n[e+l[1]]+i,h[r+2]=n[e+l[2]]+i,t+=3,r+=3,e+=3}}(e,t,i.index,i.count,r,0,f,n,s,o,a,l,c,m,u,h,p)}{let e=0,t=2*i.count,r=0;const c=i.pathLengths[0];Le(n,s,a,o,e,c,i.count,t,l,r,u),t+=4*c,r+=2*c,e+=c;for(let h=1;h<i.pathLengths.length;++h){const c=i.pathLengths[h];Le(n,s,a,o,e,c,i.count,t,l,r,u),t+=4*c,r+=2*c,e+=c}}}function Oe(e,t,r,i,n,s,o){i[s]=i[o],o*=3,e[s*=3]=e[o],e[s+1]=e[o+1],e[s+2]=e[o+2],t[s]=t[o],t[s+1]=t[o+1],t[s+2]=t[o+2],r[s]=n[0],r[s+1]=n[1],r[s+2]=n[2]}const Ie=(0,p.vt)();function Le(e,t,r,i,n,s,o,a,l,c,u){let h=n,d=n+1,p=n+o,f=n+o+1,m=a,g=a+1,y=a+2*s,_=a+2*s+1;u<0&&(h=n+o+1,f=n);let v=3*c;for(let b=0;b<s;++b)b===s-1&&(d=n,u>0?f=n+o:h=n+o),Ue(e,h,d,p,Ie),Oe(e,t,i,r,Ie,m,h),Oe(e,t,i,r,Ie,g,d),Oe(e,t,i,r,Ie,y,p),Oe(e,t,i,r,Ie,_,f),l[v]=m,l[v+1]=y,l[v+2]=_,l[v+3]=m,l[v+4]=_,l[v+5]=g,v+=6,h++,d++,p++,f++,m+=2,g+=2,y+=2,_+=2}const Ne=(0,p.vt)(),De=(0,p.vt)(),Fe=(0,p.vt)(),ke=(0,p.vt)(),ze=(0,p.vt)();function Ue(e,t,r,i,n){t*=3,r*=3,i*=3,(0,d.s)(Ne,e[t++],e[t++],e[t++]),(0,d.s)(De,e[r++],e[r++],e[r++]),(0,d.s)(Fe,e[i++],e[i++],e[i++]),(0,d.f)(ke,De,Ne),(0,d.f)(ze,Fe,Ne),(0,d.b)(n,ze,ke),(0,d.n)(n,n)}const Ve=(0,p.vt)();function Be(e,t,r){const i=e.getMutableAttribute(Q.r.POSITION),n=e.getMutableAttribute(Q.r.NORMALCOMPRESSED).data,{topVertexStart:s,topVertexCount:o,topFaceStart:a,topFaceCount:l}=t,c=i.data,u=o,h=e.attributes.get(Q.r.POSITION).indices,p=a+l,f=s+o,m=(0,z.jh)(3*u);for(let d=0;d<u;++d){const e=3*d;m[e+0]=0,m[e+1]=0,m[e+2]=0}const g=We,y=Ye,_=Xe,v=Je,b=He;for(let w=a;w<p;++w){const e=3*w;for(let t=0;t<3;++t){const i=h[e+t];v[t]=i;const n=3*i;(0,d.s)(je,c[n+0],c[n+1],c[n+2]),(0,d.h)(g[t],je,r)}(0,d.z)(y,g[1],g[0]),(0,d.z)(_,g[2],g[0]),(0,d.b)(b,y,_),(0,d.n)(b,b);for(let t=0;t<3;++t){const e=3*(v[t]-s);m[e+0]+=b[0],m[e+1]+=b[1],m[e+2]+=b[2]}}for(let d=s;d<f;++d){const e=3*(d-s),t=m[e+0],r=m[e+1],i=m[e+2],o=Math.sqrt(t*t+r*r+i*i);(0,Te.aT)(n,d,t/o,r/o,i/o)}}const je=(0,p.vt)(),He=(0,p.vt)(),Ge=new G.Uk,Ze=[0,2,1],$e=[0,1,2],qe=.01,We=[(0,p.vt)(),(0,p.vt)(),(0,p.vt)()],Ye=(0,p.vt)(),Xe=(0,p.vt)(),Je=[0,0,0];var Ke;!function(e){e[e.Main=0]="Main",e[e.Bottom=1]="Bottom"}(Ke||(Ke={}));class Qe{constructor(e,t,r,i){this.positions=e,this.elevation=t,this.normals=r,this.heights=i}}class et{constructor(e,t,r,i){this.topVertexStart=e,this.topVertexCount=t,this.topFaceStart=r,this.topFaceCount=i}}var tt=r(69539),rt=r(30726),it=r(76931),nt=r(88685),st=r(90534),ot=r(55855),at=r(64232),lt=r(98976),ct=r(67855),ut=r(48988),ht=r(97763),dt=r(29632),pt=r(76589),ft=r(93223),mt=r(94439),gt=r(52629),yt=r(38865),_t=r(29308),vt=r(57824);class bt{constructor(e,t,r,i){this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=r,this._drapeSourceRenderer=i,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(null!=this.stage&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,vt.q.ADD);if(e||this._addedToStage){for(const e of this.renderGeometries)e.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,vt.k.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,vt.q.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,p.vt)();return(0,d.s)(e,0,0,0)}getBoundingBoxObjectSpace(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,g.vt)();return(0,g.Ie)(e)}addObjectState(e,t){e===xe.Mg.Highlight&&(this.renderGeometries.forEach((e=>{const r=e.geometry.addHighlight();t.addRenderGeometry(e,r,this)})),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,vt.k.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach((t=>{e.removeRenderGeometry(t)}))}removeRenderGeometryObjectState(e,t){e.geometry.removeHighlight(t),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,vt.k.HIGHLIGHT)}computeAttachmentOrigin(e){for(const t of this.renderGeometries)t.geometry.computeAttachmentOrigin(St)&&(e.draped.origin[0]+=St[0],e.draped.origin[1]+=St[1],e.draped.num++)}async getProjectedBoundingBox(e,t,r,i,n){(0,g.Ie)(n);for(let s=0;s<this.renderGeometries.length;s++){const t=this.renderGeometries[s];this._getRenderGeometryProjectedBoundingRect(t,e,wt,r),(0,g.DC)(n,wt)}if(t){let e;(0,g.gX)(n,St);const r=(0,$.vY)(n,t.service.spatialReference,t);try{e=await t.service.queryElevation(St[0],St[1],i,r,"ground")}catch(ye){}null!=e&&(n[2]=Math.min(n[2],e),n[5]=Math.max(n[5],e))}return n}_getRenderGeometryProjectedBoundingRect(e,t,r,i){if(this.boundingBox)(0,g.hZ)(xt,this.boundingBox);else{const t=e.boundingSphere,r=t[3];xt[0]=t[0]-r,xt[1]=t[1]-r,xt[2]=t[2]-r,xt[3]=t[0]+r,xt[4]=t[1]+r,xt[5]=t[2]+r}return t(xt,0,2),this.calculateRelativeScreenBounds&&i.push({location:(0,g.gX)(xt),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),(0,g.ES)(xt,r)}}const wt=(0,y.vt)(),xt=(0,g.vt)(),St=(0,p.vt)();var Tt=r(82250),Mt=r(88265),At=r(63048),Ct=r(72900),Et=r(62577),Rt=r(442),Pt=r(96897),Ot=r(84248);const It=(0,p.fA)(0,0,1),Lt=Ct.CN,Nt=[Lt/2,Lt/2,1-Lt/2,1-Lt/2],Dt=[Ct.Q_*Lt,Ct.Q_*Lt];class Ft extends Z.U{getCachedSize(){return{size:this._getIconSize()}}constructor(e,t,r,i){super(e,t,r,i),this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._patchTask=null,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const t=this._prepareMaterialParameters(),r=this._getPrimitive();if(null!=r)this._prepareResourcesPrimitive(t,r);else{const r=(0,mt.N7)(this.symbolLayer),i=zt(r);null!=i?await this._prepareResourcesCIM(t,JSON.parse(i),e):await this._prepareResourcesHref(t,r,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=(0,$.Hj)(this._getIconSize());if(e)throw new R.A("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,t=Math.round(null!=e.size?(0,it.Lz)(e.size):16);return this._drivenProperties.size?Math.max(t,64):t}_generateTextureCIM(e){let t=this._cimData;if(t&&t.symbol||this.logger.error("Can't create texture, CIM data is undefined"),t.primitiveOverrides){t=(0,P.o8)(t);const r=t.primitiveOverrides;ut.$.evaluateOverrides(r,e,this._arcadeInfo.geometryType,null,null),ut.$.applyOverrides(t.symbol,r)}const r=(0,nt.Wm)(JSON.stringify(t));let i=this._cimSymbolTextures.get(r);if(i)return i;const n=this._context.sharedResources.cimSymbolRasterizer,s=this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null;s&&ut.$.applyDictionaryTextOverrides(t.symbol,e,s,null);const o=null!=this._cimScaleFactorOrFunction?(0,ht.s4)(this._cimScaleFactorOrFunction,e):1;1!==o&&t.symbol&&(0,dt.Km)(t.symbol,o,!0);const a=ct.wp.getEnvelope(t,null,n.resourceManager);if(a?.width&&a.height){const e=a.x+a.width/2,r=a.y+a.height/2,s=n.rasterize({type:"cim",data:t},a.width,a.height,e,r,1,"esriGeometryPoint"),o=new ft.Q({x:-a.x/a.width-.5,y:(a.height+a.y)/a.height-.5});this._cimMaterialParametersInfo.anchorPosition=Ut("relative",o),i=new Pt.g(s,{width:s?.width??1,height:s?.height??1,reloadable:!0})}else i=new Pt.g(new ImageData(1,1),{width:1,height:1,reloadable:!0});return this._cimSymbolTextures.set(r,i),this._context.stage.add(i),i}_prepareMaterialParameters(){const e={anchorPosition:Ut(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},t=this.symbol;if(function(e){return e&&"point-3d"===e.type&&e.hasVisibleVerticalOffset()}(t)){const{screenLength:r,minWorldLength:i,maxWorldLength:n}=t.verticalOffset;e.verticalOffset={screenLength:(0,it.Lz)(r),minWorldLength:i||0,maxWorldLength:null!=n?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!(0,s.A)("enable-feature:non-occluded-hud"),e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,t){const r=this._getOutlineSize();if(kt(t)&&0===r)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,null!=this._context.sharedResources.textures){const r=this._context.sharedResources.textures.fromData(`${t}-icon`,(()=>(0,Ct.sZ)(t)));this._textureHandle=r,e.textureId=r.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=(0,Ct.ny)(t),e.distanceFieldBoundingBox=Nt;const i=this._getIconSize();this._size=[i,i],this._symbolTextureRatio=1/Lt,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,t,r){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const i=this._getIconSize(),s=i*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(null!=this._context.sharedResources.textures){const a=await(0,n.Ke)(this._context.sharedResources.textures.fromUrl(t,s,{signal:r}));if(!1===a.ok)throw(0,o.QP)(a.error),new R.A("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${t})`);this._textureHandle=a.value;const l=a.value.texture;this._size=Vt(l,i),e.textureId=l.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,t,i){if(this._cimData=t,!this._context.sharedResources.cimSymbolRasterizer){const e=(await r.e(5840).then(r.bind(r,45840))).CIMSymbolRasterizer;(0,o.Te)(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new e(this._context.renderCoordsHelper.spatialReference))}const n=this._context.sharedResources.cimSymbolRasterizer,s=[],a=t,l=a?.symbol;ct.wp.fetchResources(l,n.resourceManager,s,i),ct.wp.fetchFonts(l,n.resourceManager,s);const c=this._context.layer.fields?this._context.layer.fields.map((e=>e.toJSON())):[],u=this._context.renderCoordsHelper.spatialReference;if(this._arcadeInfo={spatialReference:u,fields:c,geometryType:"esriGeometryPoint"},a?.primitiveOverrides&&s.push(ut.$.createRenderExpressions(a.primitiveOverrides,this._arcadeInfo)),s.length>0&&(await Promise.all(s),(0,o.Te)(i)),this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression){const e=this._context.renderer;if(e.scaleExpression){const t=e.scaleExpression,r=await(0,lt.Ad)(t,this._context.layer.spatialReference,c);this._cimScaleFactorOrFunction=(e,t,i)=>{const n=(0,gt.A)(r,e,{$view:i},"esriGeometryPoint",t);return null!==n?n:1}}}(0,o.Te)(i),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource?.href?null:this.symbolLayer.resource?.primitive??pt.r}_getOutlineSize(){let e=0;const t=this.symbolLayer;return null!=t.outline?.size?Math.max((0,it.Lz)(t.outline.size),0):(e=kt(this._getPrimitive())?1.5:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),t=this.symbolLayer,r=t?.outline?.color;if(null!=r){const t=tt.A.toUnitRGB(r),i=r.a*e;return[t[0],t[1],t[2],i]}return[0,0,0,0]}_getFillColor(){if(kt(this._getPrimitive()))return yt.r4;const e=null==this._getPrimitive(),t=this.symbolLayer?.material?.color;return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})}_createMaterialAndAddToStage(e,t){if(this._cimData){this._fastUpdates=null;let r=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new Ot.R(e),this._cimSymbolMaterials.set(e.textureId??0,r),t.add(r)),r}return this._fastUpdates=(0,At.s_)(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._materials[0]=new Ot.R(e),t.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial((e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:this.draped})})),this.layerOpacityChanged())}destroy(){super.destroy(),this._patchTask=(0,rt.DC)(this._patchTask),this._forEachMaterial((e=>this._context.stage.remove(e))),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach((e=>this._context.stage.remove(e))),this._cimSymbolTextures.clear(),this._textureHandle=(0,rt.Gz)(this._textureHandle)}_getScaleFactor(e,t){if(this._drivenProperties.size&&e.size){for(let t=0;t<3;t++){const r=e.size[t];r&&"symbol-value"!==r&&"proportional"!==r&&(e.size[t]=(0,it.Lz)(r))}if("symbol-value"===e.size[0])return 1;if(isFinite(+e.size[0]))return+e.size[0]/t;if(isFinite(+e.size[2]))return+e.size[2]/t}return 1}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;let r,i=[0,0];if(this._cimData){if(!this._cimData.symbol)return null;const e=this._generateTextureCIM(t),n={textureId:e.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(n,this._context.stage);const s=window.devicePixelRatio||1;i=[e.parameters.width/s,e.parameters.height/s]}else i=this._size,r=this._materials[0];const n=(0,Mt.ZX)(t.geometry);if(null==n)return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`),null;const s=e.renderingInfo,o=this._getVertexOpacityAndColor(s);let a=1;if(!this._fastUpdates?.visualVariables.size){const e=i[0]>i[1]?i[0]:i[1];a=this._getScaleFactor(s,e)}a*=this._symbolTextureRatio;const l=(0,h.fA)(i[0]*a,i[1]*a),c=this.setGraphicElevationContext(t);return this.ensureDrapedStatus("on-the-ground"===c.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(t,n,r,o,l,e.layer.uid):this._createAs3DShape(t,n,r,o,l,c,t.uid)}layerOpacityChanged(){const e=this._getFillColor(),t=this._getOutlineColor();this._forEachMaterial((r=>{r.setParameters({color:e}),r.setParameters({outlineColor:t})}))}updateGeometry(e,t){if(this.draped||!this._validateGeometry(t))return!1;const{elevationContext:r,stageObject:i}=e;if(r.mode!==this.getGeometryElevationMode(t))return!1;const n=(0,Mt.ZX)(t);if(!n)return!1;const s=(0,Mt.hS)(i,this._context,n,r);if(null==s)return!1;const o=(0,Mt.R$)(this._context,n);return i.geometries[0].localOrigin===o&&(e.alignedSampledElevation=s,(0,Mt.d2)(e,n,this._context.elevationProvider),!0)}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=(0,G.I2)(Ft.elevationModeChangeTypes,r,i);if(n!==G.uw.UPDATE)return n;const s=(0,G.nu)(i)||"absolute-height"===i;return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>s))}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial((e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return null!=this._getPrimitive()}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return q.w.RecreateSymbol;if(!(0,At.J_)(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return q.w.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return q.w.FastUpdate}prepareSymbolLayerPatch(e){if(this._patchTask?.abort(),"partial"!==e.diff.type)return;const t=e.diff.diff;this._preparePatchResource(e,t)}_preparePatchResource(e,t){if(!t.resource||"partial"!==t.resource.type)return;const r=t.resource.diff;if("complete"!==r?.href?.type)return;const i=r.href.newValue,{textures:s}=this._context.sharedResources;if(null==i||null==s||null!=zt(i))return;const a=this._getIconSize(),l=a*this._context.graphicsCoreOwner.view.state.pixelRatio;e.symbolLayerStatePatches.push((()=>{this._patchTask=(0,rt.DC)(this._patchTask),this._patchTask=(0,n.UT)((e=>this._context.schedule((async(e,t)=>{const r=await(0,n.Ke)(s.fromUrl(i,l,{signal:t}));(0,o.Te)(t);const c=!r.ok;if(c&&(0,o.QP)(r.error),this._textureHandle=(0,rt.Gz)(this._textureHandle),this._patchTask=null,c){this._forEachMaterial((e=>{e.visible=!1,e.setParameters({textureId:null})}));const e=`Failed to load (Request for icon resource failed: ${i})`;return void this.logger.error(new R.A("graphics3diconsymbollayer:request-failed",e))}this._textureHandle=r.value;const u=r.value.texture;this._size=Vt(u,a),this._forEachMaterial((e=>{e.setParameters({textureId:u.id}),e.visible=!0}))}),e)))})),delete r.href}_defaultElevationInfoNoZ(){return Bt}_createAs3DShape(e,t,r,i,n,s,o){const a=this.getFastUpdateAttrValues(e),l=this._context.layer.uid,c=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:o,layerUid:l}),u=(0,Et.DJ)(r,It,null,i,n,jt,null,a,c),h=(0,Mt.SZ)(this._context,t,u,s,o);if(null==h)return null;const d=new A.Y(this,h.object,[u],null,null,_t.G8,s);return d.alignedSampledElevation=h.sampledElevation,d.needsElevationUpdates=(0,G.nu)(s.mode)||"absolute-height"===s.mode,d.getScreenSize=this._createScreenSizeGetter(n,a),d.calculateRelativeScreenBounds=e=>r.calculateRelativeScreenBounds(d.getScreenSize(),1,e),(0,Mt.d2)(d,t,this._context.elevationProvider),d}_createAsOverlay(e,t,r,i,n,s){r.renderPriority=this._renderPriority;const o=(0,p.vt)();(0,at.g)(t,o,this._context.overlaySR),o[2]=he.bi;const a=this._context.clippingExtent;if(null!=a&&!(0,g.Uc)(a,o))return null;const l=this.getFastUpdateAttrValues(e),c=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),u=(0,Et.DJ)(r,It,o,i,n,null,null,l,c),h=new Rt.$(u,{layerUid:s,graphicUid:e.uid}),d=new bt(this,[h],null,this._context.drapeSourceRenderer);return d.getScreenSize=this._createScreenSizeGetter(n,l),d.calculateRelativeScreenBounds=e=>r.calculateRelativeScreenBounds(d.getScreenSize(),1,e),d}_createScreenSizeGetter(e,t){var r=this;const i=this._outlineSize+2;if(this._fastUpdates&&t){const n=e[0]/this._symbolTextureRatio,s=e[1]/this._symbolTextureRatio;return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,h.vt)();const[o,a]=(0,At.VC)(Ht,r._fastUpdates.materialParameters,t);return e[0]=o*n+i,e[1]=a*s+i,e}}const n=e[0]/this._symbolTextureRatio+i,s=e[1]/this._symbolTextureRatio+i;return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,h.vt)();return e[0]=n,e[1]=s,e}}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),t=(0,p.fA)(e,e,e),r=(0,it.PN)(1),i=e*r,n=(0,p.fA)(i,i,i);return new At.wI({size:!0,color:!0,rotation:!0,opacity:!1},t,n,r)}_forEachMaterial(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._materials[0]}}}function kt(e){return null!=e&&("cross"===e||"x"===e)}function zt(e){const t=(0,st.r$)(e);return"application/json"===t?.mediaType?t.data:void 0}function Ut(e,t){return"relative"===e?(0,h.fA)((t.x||0)+.5,.5-(t.y||0)):e in Tt.Zd?Tt.Zd[e]:Tt.Zd.center}function Vt(e,t){let{parameters:r}=e;const i=(r.width??1)/(r.height??1);return i>1?[t,Math.round(t/i)]:[Math.round(t*i),t]}Ft.PRIMITIVE_SIZE=Dt,Ft.elevationModeChangeTypes={definedChanged:G.uw.UPDATE,staysOnTheGround:G.uw.NONE,onTheGroundChanged:G.uw.RECREATE};const Bt={mode:"relative-to-ground",offset:0},jt=(0,ot.fA)(0,0,0,1),Ht=(0,p.vt)();var Gt=r(46259);function Zt(e){switch(e){case"butt":return Gt.x.BUTT;case"square":return Gt.x.SQUARE;case"round":return Gt.x.ROUND;default:return null}}function $t(e){return"diamond"===e?"kite":e}var qt=r(70667),Wt=r(29889),Yt=r(60561),Xt=r(35925),Jt=r(425);const Kt=["polyline","polygon","extent"],Qt=new At.wI({size:!0,color:!0,rotation:!1,opacity:!0});class er extends Z.U{constructor(e,t,r,i){super(e,t,r,i)}async doLoad(){if(this._fastUpdates=(0,At.s_)(this._context.renderer,Qt),!this._drivenProperties.size&&(null!=this.symbolLayer.size?this.symbolLayer.size:(0,it.PN)(1))<0)throw new R.A("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=this._getCombinedOpacityAndColor(t&&this._markerColor||this._materialColor);this._patternHidesLine&&!t&&(r[3]=0);const i={width:this._computeMaterialWidth(this.symbolLayer?.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:Zt(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:(0,Xt.Xq)(this.symbolLayer.pattern)};return this._fastUpdates?.visualVariables?{...i,...this._fastUpdates.materialParameters}:i}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){return null==this._materials[nr.Line]&&(this._materials[nr.Line]=new Jt.W(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[nr.Line])),this._materials[nr.Line]}get _ringMaterial(){return null==this._materials[nr.Ring]&&(this._materials[nr.Ring]=new Jt.W(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[nr.Ring])),this._materials[nr.Ring]}get _wireframeLineMaterial(){return null==this._materials[nr.LineWireframe]&&(this._materials[nr.LineWireframe]=new Jt.W({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[nr.LineWireframe])),this._materials[nr.LineWireframe]}get _wireframeRingMaterial(){return null==this._materials[nr.RingWireframe]&&(this._materials[nr.RingWireframe]=new Jt.W({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[nr.RingWireframe])),this._materials[nr.RingWireframe]}get _markerMaterial(){return null==this._materials[nr.Marker]&&null!=this.symbolLayer.marker&&(this._materials[nr.Marker]=new Yt.i({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:$t(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[nr.Marker])),this._materials[nr.Marker]}destroy(){super.destroy(),this._forEachMaterial((e=>this._context.stage.remove(e))),this._materials.length=0}_getDrivenSize(e){return this._drivenProperties.size&&e.size?(0,it.Lz)((0,j.or)(e.size)):1}_getDrivenColor(e){const t=(0,ot.fA)(1,1,1,1);return this._drivenProperties.color&&e.color&&(t[0]=e.color[0],t[1]=e.color[1],t[2]=e.color[2],e.color.length>0&&(t[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(t[3]=e.opacity),t}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Kt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,t.uid)}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return q.w.RecreateSymbol;{const e=this._fastUpdates;if(!(0,At.J_)(e,t,Qt))return q.w.RecreateSymbol;this._forEachMaterial((t=>t?.setParameters(e.materialParameters)))}}return q.w.FastUpdate}prepareSymbolLayerPatch(e){if("partial"!==e.diff.type)return;const t=e.diff.diff,r={};"complete"===t.size?.type&&(r.width=this._computeMaterialWidth(t.size.newValue),delete t.size),"complete"===t.cap?.type&&(r.cap=Zt(t.cap.newValue??"butt"),delete t.cap);const i=this._prepareMarkerPatch(e,t);this._prepareMaterialPatch(e,t,i),e.symbolLayerStatePatches.push((()=>this._forEachMaterial((e=>e?.setParameters(r)))))}layerOpacityChanged(){this._forEachMaterial(((e,t)=>this._updateMaterialLayerOpacity(e,t===nr.Marker)))}_forEachMaterial(e){this._materials.forEach(e)}_updateMaterialLayerOpacity(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==e)return;const r=e.parameters.color,i=this.symbolLayer?.material?.color,n=this._patternHidesLine&&!t?0:this._getCombinedOpacity(i),s=(0,ot.fA)(r[0],r[1],r[2],n);e.setParameters({color:s})}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=(0,G.I2)(er.elevationModeChangeTypes,r,i);if(n!==G.uw.UPDATE)return n;const s=(0,G.nu)(i);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>s))}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial((t=>t?.setParameters(e))),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,t,r){const i=tr(e.graphic.geometry),n="polygon"===i.type?i.rings:i.paths,s=new Array,o=(0,g.vt)(),a=(0,Wt.C)(i,this._context.elevationProvider,this._context.renderCoordsHelper,t),l="polygon"===i.type?"rings":"paths";this._logGeometryCreationWarnings(a,n,l,"LineSymbol3DLayer");for(let h=0;h<a.lines.length;h++){const t=a.lines[h],n=t.position,l=t.mapPositions;if(null!=this._context.clippingExtent&&((0,g.Ie)(o),(0,g.Hq)(o,l),!(0,g.KG)(o,this._context.clippingExtent)))continue;const c=this._createGeometry("polygon"===i.type?this._ringMaterial:this._lineMaterial,e,n,l,i.type,ir.ELEVATED,r);s.push(c),ae.b.LINE_WIREFRAMES&&s.push(c.instantiate({material:"polygon"===i.type?this._wireframeRingMaterial:this._wireframeLineMaterial})),null!=this._markerMaterial&&s.push(c.instantiate({material:this._markerMaterial}))}if(0===s.length)return null;const c=new Me.B({geometries:s,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),u=new A.Y(this,c,s,null,null,_t.Zd,t);return u.alignedSampledElevation=a.sampledElevation,u.needsElevationUpdates=(0,G.nu)(t.mode),u}_createGeometry(e,t,r,i,n,s,o){const a=s===ir.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,l="polygon"===n,c=this._fastUpdates?.visualVariables.color,u=this._fastUpdates?.visualVariables.size,h=this._fastUpdates?.visualVariables.opacity,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:o,layerUid:this._context.layer.uid}),p={position:r,size:u?null:this._getDrivenSize(t.renderingInfo),color:c?null:this._getDrivenColor(t.renderingInfo),sizeFeature:u?(0,At.ul)(u.field,t.graphic):null,colorFeature:c?(0,At.ul)(c.field,t.graphic):null,opacityFeature:h?(0,At.ul)(h.field,t.graphic):null};return(0,qt.t)(e,{overlayInfo:a,removeDuplicateStartEnd:l,mapPositions:i,attributeData:p},d)}_createAsOverlay(e,t){const r=e.graphic,i=tr(r.geometry),n="polygon"===i.type?i.rings:i.paths,s="polygon"===i.type?this._ringMaterial:this._lineMaterial;s.renderPriority=this._renderPriority;const o=ae.b.LINE_WIREFRAMES?"polygon"===i.type?this._wireframeRingMaterial:this._wireframeLineMaterial:null,a=this._markerMaterial;null!=o&&(o.renderPriority=this._renderPriority-.001),null!=a&&(a.renderPriority=this._renderPriority-.002);const l=new Array,c=(0,g.vt)(),u=(0,g.Ie)(),h=(0,Wt.A)(i,this._context.overlaySR),d="polygon"===i.type?"rings":"paths";this._logGeometryCreationWarnings(h,n,d,"LineSymbol3DLayer");for(const p of h.lines){if((0,g.Ie)(c),(0,g.Hq)(c,p.position),!(0,g.KG)(c,this._context.clippingExtent))continue;(0,g.RF)(u,c);const n=n=>{const s=this._createGeometry(n,e,p.position,void 0,i.type,ir.DRAPED,r.uid),o=new Rt.$(s,{layerUid:t,graphicUid:r.uid});l.push(o)};if(null!=a){n(a);const e=this.symbolLayer.marker.placement;"begin"!==e&&"begin-end"!==e||(0,g.Hq)(c,p.position,0,1),"end"!==e&&"begin-end"!==e||(0,g.Hq)(c,p.position,p.position.length-3,1)}n(s),ae.b.LINE_WIREFRAMES&&n(o)}return new bt(this,l,u,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return null!=e&&"style"===e.type&&"none"===e.style}_computeMaterialWidth(e){return e=e??(0,it.PN)(1),this._drivenProperties.size?this._fastUpdates?.visualVariables.size?(0,it.Lz)(1):1:(0,it.Lz)(e)}_prepareMaterialPatch(e,t,r){const i=t.material;if(null==i)return void(r.changed&&r.useMaterialColor&&rr(this._getCombinedOpacityAndColor(this._materialColor),this._materials[nr.Marker],e));if("collection"===i.type)return;const n="complete"===i.type?i.newValue?.color:"complete"===i.diff.color?.type?i.diff.color.newValue:null,s=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&rr((0,ot.o8)(s),this._materials[nr.Marker],e),this._patternHidesLine&&(s[3]=0),rr(s,this._materials[nr.Line],e),delete t.material}_prepareMarkerPatch(e,t){const r=t.marker,i=this._markerMaterial;if(null==r||"partial"!==r.type||null==r.diff||null!=r.diff.placement||null!=r.diff.style&&"complete"!==r.diff.style.type||null!=r.diff.color&&"complete"!==r.diff.color.type||null==i)return{changed:!1,useMaterialColor:null==this._markerColor};const n=r.diff.color,s=null!=n,o=s?n.newValue:null,a=null==o&&null==this._markerColor;o&&rr(this._getCombinedOpacityAndColor(o),i,e);const l=r.diff.style?.newValue;return l&&e.symbolLayerStatePatches.push((()=>i.setParameters({markerPrimitive:$t(l)}))),delete t.marker,{changed:s,useMaterialColor:a}}}function tr(e){switch(e.type){case"extent":if(e instanceof ee.A)return f.A.fromExtent(e);break;case"polygon":case"polyline":return e}return null}function rr(e,t,r){null!=t&&r.symbolLayerStatePatches.push((()=>t.setParameters({color:e})))}var ir,nr;er.elevationModeChangeTypes={definedChanged:G.uw.RECREATE,staysOnTheGround:G.uw.NONE,onTheGroundChanged:G.uw.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(ir||(ir={})),function(e){e[e.Line=0]="Line",e[e.Ring=1]="Ring",e[e.LineWireframe=2]="LineWireframe",e[e.RingWireframe=3]="RingWireframe",e[e.Marker=4]="Marker"}(nr||(nr={}));var sr=r(15941),or=r(9624),ar=r(60216),lr=r(75002),cr=r(79629),ur=r(44032),hr=r(63713),dr=r(99773),pr=r(26375),fr=r(18117),mr=r(82062),gr=r(37040),yr=r(54439);const _r=2e3;class vr extends A.Y{constructor(){super(...arguments),this.fastTransformUpdatesAllowed=!1,this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1,this._autoDisableFastUpdatesTimeoutId=0}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}destroy(){super.destroy(),this._cancelAutoDisableFastUpdates()}enableFastTransformUpdates(e,t){if(!this.fastTransformUpdatesAllowed||this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!0;const{stageObject:r}=this,i=r.geometries.slice();r.removeAllGeometries();const n=(0,D.sC)(br,r.transformation),s=t.getOrigin(n);for(const o of i){const t=e(o.material),i=o.instantiate({material:t});i.localOrigin=s,r.addGeometry(i)}this._originalGeometries=i}autoDisableFastTransformUpdates(e){this._cancelAutoDisableFastUpdates(),this._autoDisableFastUpdatesTimeoutId=setTimeout((()=>{this._autoDisableFastUpdatesTimeoutId=0,e()}),_r)}updateAutoDisableFastTransformUpdates(e){this._autoDisableFastUpdatesTimeoutId&&this.autoDisableFastTransformUpdates(e)}_cancelAutoDisableFastUpdates(){clearTimeout(this._autoDisableFastUpdatesTimeoutId),this._autoDisableFastUpdatesTimeoutId=0}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!1;const{stageObject:t}=this,r=t.geometries.map((t=>e(t.material)));t.removeAllGeometries();for(let i=0;i<this._originalGeometries.length;i++){const e=this._originalGeometries[i],n=r[i];n.setParameters({modelTransformation:null}),n===e.material?t.addGeometry(e):t.addGeometry(e.instantiate({material:n}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,t,r){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:i}=this;if(0===i.geometries.length)return;const n=i.geometries[0].localOrigin,s=(0,D.sC)(br,e),o=r.getOrigin(s);if(o===n)return;const a=t?.localMatrix??F.zK;i.shaderTransformation=null,i.transformation=e,i.geometries.forEach((e=>{e.transformation=a,e.localOrigin=o}))}updateTransform(e,t,r){const{stageObject:i}=this,n=t?.localMatrix??F.zK;if(!this._fastTransformUpdatesEnabled)return i.shaderTransformation=null,i.transformation=e,i.geometries.forEach((e=>e.transformation=n)),void this._updateEdgeTransform(r);const s=i.transformation,o=i.geometries[0].transformation,a=e,l=n,c=(0,D.lw)(wr,s,o),u=(0,D.lw)(xr,a,l),h=(0,D.lw)(Tr,u,(0,D.B8)(Tr,o));i.shaderTransformation=h,this._setFastMaterialTransformation({matA:c,matB:u}),this._updateEdgeTransform(r)}alignWithElevation(e,t,r,i){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,t,r,i);null!=r&&(0,x.gf)(this.elevationContext.featureExpressionInfoContext,r);const{stageObject:n}=this;if(!n.geometries[0].material.parameters.modelTransformation)return;const s=n.transformation,o=n.geometries[0].transformation,a=(0,D.lw)(wr,s,o),l=n.effectiveTransformation,c=(0,D.C)(Sr,l);this.alignedSampledElevation=(0,_t.G8)(this,this.elevationContext,e.spatialReference,((r,i)=>(0,G.sE)(r,e,this.elevationContext,t,i)),t,c),n.shaderTransformation=c;const u=n.geometries[0].transformation,h=(0,D.lw)(xr,c,u);this._setFastMaterialTransformation({matA:a,matB:h}),this._updateEdgeTransform(i)}_setFastMaterialTransformation(e){let{matA:t,matB:r}=e;const{stageObject:i}=this;if(0===i.geometries.length)return;const n=i.geometries[0].localOrigin,s=(0,D.kN)(Cr,(0,d.j)(br,n.vec3,-1)),o=(0,D.lw)(Mr,s,t),a=(0,D.lw)(Ar,s,r),l=(0,D.B8)(Mr,o),c=(0,D.lw)(Ar,a,l);for(const u of i.geometries)u.material.setParameters({modelTransformation:c})}_updateEdgeTransform(e){const{stageObject:t,_stageLayer:r}=this;r.stage.renderer.withEdgeView((r=>{r.fastUpdateObject3DEdgesTransform(t)||this.resetEdgeObject(e)}))}}const br=(0,p.vt)(),wr=(0,F.vt)(),xr=(0,F.vt)(),Sr=(0,F.vt)(),Tr=(0,F.vt)(),Mr=(0,F.vt)(),Ar=(0,F.vt)(),Cr=(0,F.vt)();class Er{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,t,r){e.enableFastTransformUpdates((e=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(e))return e;const r=t.byMaterial(e);return this._fastTransformOriginalMaterials.set(e,r),t.delete(e),e}const i=new Ae.$U(e.parameters);return r.stage.add(i),this._fastTransformClonedMaterials.set(i,e),i}),r.localOriginFactory)}disable(e,t,r){const i=new Set,n=new Set;e.disableFastTransformUpdates((e=>{if(!this._fastTransformClonedMaterials.has(e)){const r=e,s=this._fastTransformOriginalMaterials.get(r);return t.has(s.uid)?(i.add(r),t.byUid(s.uid).material):(n.add(r),s.material)}const s=e,o=this._fastTransformClonedMaterials.get(s);return this._fastTransformClonedMaterials.delete(s),r.stage.remove(s),o}));for(const s of i)this._fastTransformOriginalMaterials.delete(s),r.stage.remove(s);for(const s of n){const e=this._fastTransformOriginalMaterials.get(s);this._fastTransformOriginalMaterials.delete(s),t.set(e.uid,e)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,t,r){this._graphicReferenceCount--,this.disable(e,t,r)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),(e=>{let{material:t}=e;return t}))),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}}class Rr{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),(e=>e.material))}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,t){this._byUid.set(e,t),this._byMaterial.set(t.material,t)}delete(e){const t=this._byMaterial.get(e)?.uid;t&&(this._byUid.delete(t),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}}var Pr=r(51990),Or=r(4763),Ir=r(44230),Lr=r(13927),Nr=r(34981),Dr=r(59696),Fr=r(45463),kr=r(77730),zr=r(86994),Ur=r(82809),Vr=r(86401),Br=r(16506),jr=r(42693),Hr=r(32119),Gr=r(28584),Zr=r(96643),$r=r(34026),qr=r(93345),Wr=r(57162);class Yr extends jr.w{initializeProgram(e){return new Gr.B(e.rctx,Yr.shader.get().build(this.configuration),Hr.D)}initializePipeline(){const e=this.configuration,t=(0,Wr.p3)(qr.dn.SRC_ALPHA,qr.dn.ONE,qr.dn.ONE_MINUS_SRC_ALPHA,qr.dn.ONE_MINUS_SRC_ALPHA),r=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,Wr.Ey)({blending:r,depthTest:Zr.m,depthWrite:i,colorWrite:Wr.wE,stencilWrite:e.hasOccludees?Zr.v0:null,stencilTest:e.hasOccludees?t?Zr.a9:Zr.qh:null})};return e.output===Nr.V.Color?(this._occludeePipelineState=r(!0,e.transparent?t:null,Wr.kn),r(!1,e.transparent?t:null,Wr.kn)):r(!1)}get primitiveType(){return qr.WR.LINES}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}Yr.shader=new Br.$($r.N,(()=>r.e(6272).then(r.bind(r,36272))));var Xr=r(35143),Jr=r(99415),Kr=r(92656);class Qr extends Kr.E{constructor(){super(...arguments),this.output=Nr.V.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}}(0,Xr._)([(0,Jr.W)({count:Nr.V.COUNT})],Qr.prototype,"output",void 0),(0,Xr._)([(0,Jr.W)()],Qr.prototype,"hasSlicePlane",void 0),(0,Xr._)([(0,Jr.W)()],Qr.prototype,"hasVertexColors",void 0),(0,Xr._)([(0,Jr.W)()],Qr.prototype,"transparent",void 0),(0,Xr._)([(0,Jr.W)()],Qr.prototype,"hasOccludees",void 0);class ei extends Fr.im{constructor(e){super(e,new ri),this._configuration=new Qr,this.produces=new Map([[kr.N.OPAQUE_MATERIAL,e=>e===Nr.V.Color||e===Nr.V.Highlight||e===Nr.V.ObjectAndLayerIdColor]])}getConfiguration(e){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}intersect(e,t,r,i,n,s){if(!r.options.selectionMode||!e.visible)return;if(!(0,zr.zH)(t))return void E.A.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const o=e.attributes.get(Q.r.POSITION).data,a=r.camera,l=pi;(0,u.C)(l,r.point);(0,d.s)(fi[0],l[0]-2,l[1]+2,0),(0,d.s)(fi[1],l[0]+2,l[1]+2,0),(0,d.s)(fi[2],l[0]+2,l[1]-2,0),(0,d.s)(fi[3],l[0]-2,l[1]-2,0);for(let u=0;u<4;u++)if(!a.unprojectFromRenderScreen(fi[u],mi[u]))return;(0,Lr.Cr)(a.eye,mi[0],mi[1],gi),(0,Lr.Cr)(a.eye,mi[1],mi[2],yi),(0,Lr.Cr)(a.eye,mi[2],mi[3],_i),(0,Lr.Cr)(a.eye,mi[3],mi[0],vi);let c=Number.MAX_VALUE,h=0;for(let u=0;u<o.length-5;u+=3){if(ii[0]=o[u]+t[12],ii[1]=o[u+1]+t[13],ii[2]=o[u+2]+t[14],ni[0]=o[u+3]+t[12],ni[1]=o[u+4]+t[13],ni[2]=o[u+5]+t[14],(0,Lr.mN)(gi,ii)<0&&(0,Lr.mN)(gi,ni)<0||(0,Lr.mN)(yi,ii)<0&&(0,Lr.mN)(yi,ni)<0||(0,Lr.mN)(_i,ii)<0&&(0,Lr.mN)(_i,ni)<0||(0,Lr.mN)(vi,ii)<0&&(0,Lr.mN)(vi,ni)<0)continue;if(a.projectToRenderScreen(ii,ai),a.projectToRenderScreen(ni,li),ai[2]<0&&li[2]>0){(0,d.f)(si,ii,ni);const e=a.frustum,t=-(0,Lr.mN)(e[Or.FB.NEAR],ii)/(0,d.m)(si,(0,Lr.Qj)(e[Or.FB.NEAR]));(0,d.j)(si,si,t),(0,d.g)(ii,ii,si),a.projectToRenderScreen(ii,ai)}else if(ai[2]>0&&li[2]<0){(0,d.f)(si,ni,ii);const e=a.frustum,t=-(0,Lr.mN)(e[Or.FB.NEAR],ni)/(0,d.m)(si,(0,Lr.Qj)(e[Or.FB.NEAR]));(0,d.j)(si,si,t),(0,d.g)(ni,ni,si),a.projectToRenderScreen(ni,li)}else if(ai[2]<0&&li[2]<0)continue;ai[2]=0,li[2]=0;const e=(0,Ir.kb)((0,Ir.Cr)(ai,li,hi),l);e<c&&(c=e,(0,d.c)(ci,ii),(0,d.c)(ui,ni),h=u/3)}const p=r.rayBegin,f=r.rayEnd;if(c<4){let e=Number.MAX_VALUE;if((0,Ir.ld)((0,Ir.Cr)(ci,ui,hi),(0,Ir.Cr)(p,f,di),oi)){(0,d.f)(oi,oi,p);const t=(0,d.l)(oi);(0,d.j)(oi,oi,1/t),e=t/(0,d.p)(p,f)}s(e,oi,h,!1)}}intersectDraped(e,t,r,i,n,s){if(!r.options.selectionMode)return;const o=e.attributes.get(Q.r.POSITION).data,a=e.attributes.get(Q.r.SIZE),l=a?a.data[0]:0,c=i[0],u=i[1],h=((l+1)/2+4)*e.screenToWorldRatio;let d=Number.MAX_VALUE,p=0;for(let f=0;f<o.length-5;f+=3){const e=o[f],t=o[f+1],r=c-e,i=u-t,n=o[f+3]-e,s=o[f+4]-t,a=(0,sr.qE)((n*r+s*i)/(n*n+s*s),0,1),l=n*a-r,h=s*a-i,m=l*l+h*h;m<d&&(d=m,p=f/3)}d<h*h&&n(s.dist,s.normal,p,!1)}createGLMaterial(e){return new ti(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?Vr.dB:Vr.Ci;return new Ur.Z(e)}}class ti extends Dr.A{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===Nr.V.Color&&this._updateOccludeeState(e),this.ensureTechnique(Yr,e)}}class ri extends Fr.qA{constructor(){super(...arguments),this.color=ot.Un,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.hasOccludees=!1}}const ii=(0,p.vt)(),ni=(0,p.vt)(),si=(0,p.vt)(),oi=(0,p.vt)(),ai=(0,it.r_)(),li=(0,it.r_)(),ci=(0,p.vt)(),ui=(0,p.vt)(),hi=(0,Ir.vt)(),di=(0,Ir.vt)(),pi=(0,p.vt)(),fi=[(0,it.r_)(),(0,it.r_)(),(0,it.r_)(),(0,it.r_)()],mi=[(0,p.vt)(),(0,p.vt)(),(0,p.vt)(),(0,p.vt)()],gi=(0,Lr.vt)(),yi=(0,Lr.vt)(),_i=(0,Lr.vt)(),vi=(0,Lr.vt)();var bi=r(78992);const wi=["mesh"];class xi extends Z.U{constructor(e,t,r,i){super(e,t,r,i),this._materialInfoCache=new Rr,this._fastUpdateProcessor=new Er,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){ae.b.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new ei({color:[1,0,1,1]}),this._debugTangentNormalMaterial=new ei({color:[1,.5,0,1]}),this._debugFaceNormalMaterial=new ei({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach((e=>e.unload())),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,wi,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(t),i=e.renderingInfo;return this._createAs3DShape(t,i,r,t.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,t){const r=this._getLayerOpacity();this._updateMaterialParameters((e=>{e.material.setParameters({layerOpacity:r});const t=e.material.parameters;this._setMaterialTransparentParameter(t,e),e.material.setParameters({transparent:t.transparent})})),e.forEach((e=>t(e)?.layerOpacityChanged(r,this._context.isAsync)))}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,G.Kf)}slicePlaneEnabledChanged(e,t){return this._updateMaterialParameters((e=>{let{material:t}=e;t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),e.forEach((e=>t(e)?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync))),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters((t=>{let{material:r}=t;return r.setParameters({usePBR:e})})),!0}updateTransform(e,t,r,i){if(!e.fastTransformUpdatesAllowed)return!1;const n=e.fastTransformUpdatesEnabled;switch(i){case mr.$.EnableFastUpdates:if(n)return!0;break;case mr.$.DisableFastUpdates:if(!n)return!0;break;default:if(!n)return!!this.updateTransform(e,t,r,mr.$.EnableFastUpdates)&&(e.autoDisableFastTransformUpdates((()=>this.updateTransform(e,t,r,mr.$.DisableFastUpdates))),!0)}const s=this._context.renderCoordsHelper.spatialReference,o=Bi,{origin:a,transform:l}=r;if(!(0,k.l)(t,(0,d.s)(Fi,a.x,a.y,a.z??0),o,s))return!1;switch(i){case mr.$.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case mr.$.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case mr.$.UpdateFastLocalOrigin:e.updateFastLocalOrigin(o,l,this._context.localOriginFactory)}const{elevationContext:c}=e;c.centerPointInElevationSR=this._getCenterPointInElevationSR(o);const{elevationProvider:u,renderCoordsHelper:h}=this._context;return e.alignedSampledElevation=(0,_t.G8)(e,c,u.spatialReference,((e,t)=>(0,G.sE)(e,u,c,h,t)),h,o),e.updateTransform(o,l,this._context.isAsync),e.updateAutoDisableFastTransformUpdates((()=>this.updateTransform(e,t,r,mr.$.DisableFastUpdates))),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_materialPropertiesDefault(e,t){const r=this._requiresSymbolVertexColors(),i=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:i,hasVertexTangents:n,uid:`vc:${i},vt:${n},vct${t},svc:${r}`}}_materialProperties(e,t,r){const i=this._materialPropertiesDefault(e,r);if(!t.material)return i;const{color:n,colorTexture:s,colorTextureTransform:o,normalTexture:a,normalTextureTransform:l,doubleSided:c,alphaCutoff:u,alphaMode:h}=t.material,d=Ii(n),p=Ii(s),f=Li(o),m=Ii(a),g=Li(l);if(i.color=n,i.colorTexture=s,i.normalTexture=a,i.uid=`${i.uid},cmuid:${d},ctmuid:${p},cttuid:${f},ntmuid:${m},nttuid:${g},ds:${c},ac:${u},am:${h}`,t.material instanceof ur.A){const{metallic:e,roughness:r,metallicRoughnessTexture:n,metallicRoughnessTextureTransform:s,emissiveColor:a,emissiveTexture:c,emissiveTextureTransform:u,occlusionTexture:h,occlusionTextureTransform:d}=t.material,p=Ii(n),f=Li(s),m=Ii(a),g=Ii(c),y=Li(u),_=Ii(h),v=Li(d);i.metallic=e,i.roughness=r,i.metallicRoughnessTexture=n,i.emissiveColor=a,i.emissiveTexture=c,i.occlusionTexture=h,i.colorTextureTransform=Ri(o),i.normalTextureTransform=Ri(l),i.emissiveTextureTransform=Ri(u),i.occlusionTextureTransform=Ri(d),i.metallicRoughnessTextureTransform=Ri(s),i.uid=`${i.uid},mrm:${e},mrr:${r},mrt:${p},mrtt:${f},emuid:${m},etmuid:${g},ett:${y},otmuid:${_},ott:${v}`}return i}_getInternalTextureId(e){const t=this._getInternalTexture(e,xe.sf.Opaque);return t?.id}_getInternalTexture(e,t){const r=function(e){return e.data??e.url}(e);if(!r)return null;const i=`${e.contentHash}/${t}`;let n=this._textures.get(i);if(!n){let s=null;const o=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,a={wrap:Pi(e.wrap),noUnpackFlip:!0,maxAnisotropy:o,mipmap:o>1};(0,gr.x3)(r)?(s=r.data,a.preMultiplyAlpha=!1,a.encoding=r.encoding):(s=r,a.preMultiplyAlpha=t!==xe.sf.Opaque,a.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),n=new Pt.g(s,a),this._textures.set(i,n),n.load(this._context.stage.renderView.renderingContext),this._context.stage.add(n)}return n}_setInternalMaterialParameters(e,t){if(null!=e.color&&function(e,t){t.diffuse=tt.A.toUnitRGB(e),t.opacity=e.a}(e.color,t),null!=e.colorTexture){const r=this._getInternalTexture(e.colorTexture,t.textureAlphaMode);r?(t.textureId=r.id,t.textureAlphaPremultiplied=!!r.parameters.preMultiplyAlpha):t.textureId=void 0}e.normalTexture&&(t.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor&&(t.emissiveFactor=tt.A.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(t.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture&&(t.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture&&(t.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),t.colorTextureTransformMatrix=(0,yr.G)(e.colorTextureTransform),t.normalTextureTransformMatrix=(0,yr.G)(e.normalTextureTransform);const r=null!=e.normalTextureTransform?.scale?e.normalTextureTransform?.scale:h.Un;t.scale=[r[0],r[1]],t.occlusionTextureTransformMatrix=(0,yr.G)(e.occlusionTextureTransform),t.emissiveTextureTransformMatrix=(0,yr.G)(e.emissiveTextureTransform),t.metallicRoughnessTextureTransformMatrix=(0,yr.G)(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const t=this._drivenProperties.color;let r=this.symbolLayer.material?.colorMixMode??null;if(t)e.externalColor=ot.Un;else{const t=this.symbolLayer.material?.color??null;t?e.externalColor=tt.A.toUnitRGBA(t):(r=null,e.externalColor=ot.Un)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_getOrCreateMaterial(e,t){const r=t.material?.color,i=t.material?.colorTexture,n=t.material?.alphaMode,s="blend"===n,o=!("opaque"===n)&&(function(e){const t=e.vertexAttributes.color;if(null==t)return!1;for(let r=3;r<t.length;r+=4)if(255!==t[r])return!0;return!1}(e)||null!=r&&r.a<1||i?.transparent||s),a=this._materialProperties(e,t,o),l=this._materialInfoCache.byUid(a.uid);if(l)return l.material;const c={uid:a.uid,material:null,isComponentTransparent:o,alphaMode:t.material?t.material.alphaMode:"opaque"},u=(0,bi.Jr)({normalTexture:a.normalTexture,metallicRoughnessTexture:a.metallicRoughnessTexture,metallicFactor:a.metallic,roughnessFactor:a.roughness,emissiveTexture:a.emissiveTexture,emissiveFactor:tt.A.toUnitRGB(a.emissiveColor),occlusionTexture:a.occlusionTexture}),h={usePBR:this._usePBR(),isSchematic:u,hasVertexColors:a.hasVertexColors,hasSymbolColors:a.hasSymbolVertexColors,hasVertexTangents:a.hasVertexTangents,ambient:p.uY,diffuse:p.Un,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:xe.s2.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};h.mrrFactors=u?[...bi.mX]:[a.metallic,a.roughness,bi.Rk[2]],t.material&&(h.doubleSided=t.material.doubleSided,h.cullFace=t.material.doubleSided?xe.s2.None:xe.s2.Back,h.textureAlphaCutoff=t.material.alphaCutoff),this._setExternalMaterialParameters(h),this._setMaterialTransparentParameter(h,c),this._setInternalMaterialParameters(a,h);const d=new Ae.$U(h);return c.material=d,this._materialInfoCache.set(a.uid,c),this._context.stage.add(d),d}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,t){e.transparent=this.needsDrivenTransparentPass||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,"auto"===t.alphaMode?e.textureAlphaMode=e.transparent?xe.sf.MaskBlend:xe.sf.Opaque:e.textureAlphaMode="opaque"===t.alphaMode?xe.sf.Opaque:"mask"===t.alphaMode?xe.sf.Mask:xe.sf.Blend}_createFaceDebugNormals(e,t){const r=t.length,i=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*i,e.extent.height*i,e.extent.zmax-e.extent.zmin),s=[],o=[],a=t[0].transformation,l=(0,L.Ge)((0,N.vt)(),a);for(let c=0;c<r;c++){const e=t[c].attributes.get(Q.r.POSITION);if(!e)continue;const r=e.data,i=e.indices;for(let t=0;t<i.length;t+=3)Ei(r,i,t,Ui),Ci(r,i,t,Fi,ki,zi),(0,d.g)(Fi,Fi,ki),(0,d.g)(Fi,Fi,zi),(0,d.j)(Fi,Fi,1/3),(0,d.h)(Fi,Fi,a),s.push(...Fi),(0,d.t)(Ui,Ui,l),(0,d.n)(Ui,Ui),(0,d.r)(Fi,Fi,Ui,n),s.push(...Fi),o.push(o.length),o.push(o.length)}return s.length?new K.V(this._debugFaceNormalMaterial,[[Q.r.POSITION,new X.n(s,o,3,!0)]],null,J.X.Line):null}_createPerVertexDebugVectors(e,t,r,i,n){const s=t.length,o=e.spatialReference.isGeographic?20015077/180:1,a=.1*n*Math.max(e.extent.width*o,e.extent.height*o,e.extent.zmax-e.extent.zmin),l=[],c=[],u=t[0].transformation,h=(0,L.Ge)((0,N.vt)(),u);r===Q.r.TANGENT&&(0,L.z0)(h,u);for(let p=0;p<s;p++){const e=t[p],i=e.attributes.get(Q.r.POSITION),n=e.attributes.get(r);if(!i||!n)continue;const s=i.data,o=i.indices,f=n.data,m=n.indices;for(let t=0;t<o.length;t++){const e=3*o[t],r=m[t]*n.stride;(0,d.s)(Fi,s[e+0],s[e+1],s[e+2]),(0,d.h)(Fi,Fi,u),l.push(...Fi),(0,d.s)(ki,f[r+0],f[r+1],f[r+2]),(0,d.t)(ki,ki,h),(0,d.n)(ki,ki),(0,d.r)(Fi,Fi,ki,a),l.push(...Fi),c.push(c.length),c.push(c.length)}}return l.length?new K.V(i,[[Q.r.POSITION,new X.n(l,c,3,!0)]],null,J.X.Line):null}_createAs3DShape(e,t,r,i){const n=e.geometry;if("mesh"!==n.type)return null;const s=this._createGeometryInfo(n,t,i);if(null==s)return null;const{geometries:o,objectTransformation:a}=s;if(ae.b.DRAW_MESH_GEOMETRY_NORMALS){const e=this._createPerVertexDebugVectors(n,o,Q.r.NORMAL,this._debugVertexNormalMaterial,1),t=this._createPerVertexDebugVectors(n,o,Q.r.TANGENT,this._debugTangentNormalMaterial,.5),r=this._createFaceDebugNormals(n,o);e&&o.push(e),t&&o.push(t),r&&o.push(r)}const l=new Me.B({geometries:o,layerUid:this._context.layer.uid,graphicUid:i,isElevationSource:!0});l.transformation=a;const c=(0,oe.Cc)(this.symbolLayer,{opacity:this._getLayerOpacity()}),u=c?new A.H(o[0].material,[c],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,h=new vr(this,l,o,null,null,_t.G8,r,u);this._fastUpdateProcessor.onAddGraphic(),h.needsElevationUpdates=(0,G.Kf)(r.mode),h.useObjectOriginAsAttachmentOrigin=!0,h.fastTransformUpdatesAllowed=this._fastTransformUpdatesAllowed(n),r.centerPointInElevationSR=this._getCenterPointInElevationSR(l.transformation);const{elevationProvider:d,renderCoordsHelper:p}=this._context;return h.alignedSampledElevation=(0,_t.G8)(h,r,d.spatialReference,((e,t)=>(0,G.sE)(e,d,r,p,t)),p),h}_fastTransformUpdatesAllowed(e){const{vertexSpace:t,spatialReference:r}=e;if(!(0,dr.Hq)(t))return!1;const{type:i}=t,{view:n}=this._context.graphicsCoreOwner,{viewingMode:s}=n.state,o=n.spatialReference;return s===H.RT.Global&&"local"===i||s===H.RT.Local&&(0,_.aI)(o,r)&&"georeferenced"===i&&!r.isGeographic}_getCenterPointInElevationSR(e){const t=(0,fr.T)(0,0,0,null!=this._context.elevationProvider.spatialReference?this._context.elevationProvider.spatialReference:null);return(0,ar.E)([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,t),t}_passthroughReprojectionInfo(e){return e.reprojection===Gi.NONE&&!!e.objectTransformation}_createPositionBuffer(e,t){const r=e.vertexAttributes.position;let i=r,n=null;if(t.reprojection===Gi.NONE)return{position:i,georeferencedPositionBuffer:n};const s=t.reprojection===Gi.RENDER?t.transformBeforeProject:null;s&&(i=(0,V.a)(new Float64Array(i.length),i,s));const{normal:o,tangent:a}=e.vertexAttributes;this._passthroughReprojectionInfo(t)||!o&&!a||(n=i);const l=i===r||i===n?new Float64Array(i.length):i;return(0,ce.projectBuffer)(i,e.spatialReference,0,l,this._context.renderCoordsHelper.spatialReference,0,i.length/3),{position:l,georeferencedPositionBuffer:n}}_createNormalBuffer(e,t,r,i){const n=e.vertexAttributes.normal;if(null==n)return null;let s=n;const o=i.reprojection===Gi.RENDER?i.transformBeforeProject:null;o&&(s=(0,pr.qs)(s,new Float32Array(s.length),o));const a=this._context.graphicsCoreOwner.view.viewingMode;if(i.reprojection===Gi.NONE)return s;if("local"===a){if(!(0,_.r1)(this._context.renderCoordsHelper.spatialReference))return s;if(null==r)return null;if(e.spatialReference.isGeographic){const e=s===n?new Float32Array(s.length):s;return(0,pr.gZ)(s,pr.OD.NORMAL,r,e)}if(e.spatialReference.isWebMercator){const e=s===n?new Float32Array(s.length):s;return(0,pr.GN)(s,pr.OD.NORMAL,r,e)}return s}if(null==r)return null;const l=s===n?new Float32Array(s.length):s;return(0,pr.X4)(s,r,t,e.spatialReference,l)}_createTangentBuffer(e,t,r,i){const n=e.vertexAttributes.tangent;if(null==n)return null;let s=n;const o=i.reprojection===Gi.RENDER?i.transformBeforeProject:null;o&&(s=(0,pr.KM)(s,new Float32Array(s.length),o));const a=this._context.graphicsCoreOwner.view.viewingMode;if(i.reprojection===Gi.NONE)return s;if("local"===a){if(!(0,_.r1)(this._context.renderCoordsHelper.spatialReference))return s;if(null==r)return null;if(e.spatialReference.isGeographic){const e=s===n?new Float32Array(s.length):s;return(0,pr.gZ)(s,pr.OD.TANGENT,r,e)}if(e.spatialReference.isWebMercator){const e=s===n?new Float32Array(s.length):s;return(0,pr.GN)(s,pr.OD.TANGENT,r,e)}return s}if(null==r)return null;const l=s===n?new Float32Array(s.length):s;return(0,pr.xA)(s,r,t,e.spatialReference,l)}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const t=this._getVertexOpacityAndColor(e),r=(0,Pr.Eb)(this.symbolLayer?.material?.colorMixMode),i=new Uint8Array(4);return(0,Pr._j)(t,r,i),i}return null}_createBuffers(e,t){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const i=e.vertexAttributes.normal,n=e.vertexAttributes.uv,s=e.vertexAttributes.tangent;if(i&&i.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(s&&s.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const o=this._computeReprojectionInfo(e),{position:a,georeferencedPositionBuffer:l}=this._createPositionBuffer(e,o),c=function(e){return e.vertexAttributes.color}(e),u=this._createSymbolColorBuffer(t),h=this._createNormalBuffer(e,a,l,o),d=this._createTangentBuffer(e,a,l,o),p=n,{transformation:f,position:m,normal:g,tangent:y}=this._passthroughReprojectionInfo(o)?{transformation:o.objectTransformation,position:a,normal:h,tangent:d}:this._transformOriginLocal(e,a,h,d);return{positionBuffer:m,normalBuffer:g,tangentBuffer:y,uvBuffer:p,colorBuffer:c,symbolColorBuffer:u,objectTransformation:f,geometryTransformation:o.reprojection===Gi.NONE&&o.geometryTransformation?o.geometryTransformation:(0,F.vt)()}}_computeReprojectionInfo(e){const{vertexSpace:t}=e,r="georeferenced"===t.type?(0,_.aI)(this._context.renderCoordsHelper.spatialReference,e.spatialReference)?Gi.NONE:Gi.RENDER:Gi.NONE;if((0,dr.E9)(t))return{reprojection:r};const i=t.origin,n=(0,F.vt)(),s=e.transform?.localMatrix??F.zK;if(r===Gi.NONE)return(0,k.l)(e.spatialReference,i,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:(0,F.o8)(s)};const o=(0,D.kN)((0,F.vt)(),i);return(0,D.lw)(o,o,s),{reprojection:r,transformBeforeProject:o}}_transformOriginLocal(e,t,r,i){const n=this._context.renderCoordsHelper.spatialReference,s=e.anchor;Di[0]=s.x,Di[1]=s.y,Di[2]=s.z??0;const o=(0,F.vt)();(0,k.l)(e.spatialReference,Di,o,n),(0,D.B8)(Vi,o);const{position:a,normal:l,tangent:c}=e.vertexAttributes,u=t===a?new Float64Array(t.length):t;(0,V.a)(u,t,Vi);const h=r?r===l?new Float32Array(r.length):r:null,d=i?i===c?new Float32Array(i.length):i:null;return r&&h&&(0,pr.qs)(r,h,Vi),i&&d&&(0,pr.KM)(i,d,Vi),{transformation:o,position:u,normal:h,tangent:d}}_validateFaces(e,t){const r=e.vertexAttributes.position.length/3,i=t.faces;if(i){let e=-1;for(let t=0;t<i.length;t++){const r=i[t];r>e&&(e=r)}if(r<=e)return this.logger.warn(`Vertex index ${e} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const t=e.vertexAttributes?.position;if(!t)return!1;const r=this._context.elevationProvider.spatialReference,i=(0,pr.project)({positions:t,transform:e.transform,vertexSpace:e.vertexSpace,inSpatialReference:e.spatialReference,outSpatialReference:r??e.spatialReference,localMode:this._context.stage.viewingMode===H.RT.Local});if(!i)return!1;const n=i.length/3;return(0,g.Ie)(ji),(0,g.Hq)(ji,i,0,n),!(0,g.KG)(ji,this._context.clippingExtent)}_createGeometryInfo(e,t,r){if(!(0,or.canProjectWithoutEngine)(e.spatialReference,this._context.renderCoordsHelper.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(!this._validateVertexSpace(e))return null;if(this._isOutsideClippingArea(e))return null;const i=this._createBuffers(e,t);if(null==i)return null;const{positionBuffer:n,uvBuffer:s,colorBuffer:o,symbolColorBuffer:a,normalBuffer:l,tangentBuffer:c,objectTransformation:u,geometryTransformation:h}=i,d=function(e){return e.components??Hi}(e),p=new Array;let f=!1;const m=(0,D.sC)(Fi,u),g=this._context.localOriginFactory.getOrigin(m);for(const y of d){if(!this._validateFaces(e,y))return null;const t=Ti(e,y);if(0===t.length)continue;const i=Mi(n,l,y,t);i.didFlipNormals&&(f=!0);const u=[[Q.r.POSITION,new X.n(n,t,3,!0)],[Q.r.NORMAL,new X.n(i.normals,i.indices,3,!0)]];o&&u.push([Q.r.COLOR,new X.n(o,t,4,!0)]),a&&u.push([Q.r.SYMBOLCOLOR,new X.n(a,(0,U.EH)(t.length),4,!0)]),s&&u.push([Q.r.UV0,new X.n(s,t,2,!0)]),c&&u.push([Q.r.TANGENT,new X.n(c,t,4,!0)]);const d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),m=this._getOrCreateMaterial(e,y),_=new K.V(m,u,null,J.X.Mesh,d);_.transformation=h,_.localOrigin=g,p.push(_)}return f&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:p,objectTransformation:u}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial(((e,t)=>{t.setParameters(e.parameters)}))}_validateVertexSpace(e){const{_context:{graphicsCoreOwner:{view:{state:{viewingMode:t}}}}}=this,{vertexSpace:r}=e;return t!==H.RT.Local||"local"!==r.type||(this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."),!1)}test(){return{...super.test(),materials:this._materialInfoCache.materials}}}class Si{constructor(e,t,r){this.normals=e,this.indices=t,this.didFlipNormals=r}}function Ti(e,t){return t.faces??(0,U.tM)(e.vertexAttributes.position.length/3)}function Mi(e,t,r,i){switch(r.shading||"flat"){default:case"source":return function(e,t,r,i){if(null==t)return Ai(e,i);let n=!1;if(!r.trustSourceNormals)for(let s=0;s<i.length;s+=3){Ei(e,i,s,Ui);for(let e=0;e<3;e++){const r=3*i[s+e];Fi[0]=t[r],Fi[1]=t[r+1],Fi[2]=t[r+2],(0,d.m)(Ui,Fi)<0&&(t[r]=-t[r],t[r+1]=-t[r+1],t[r+2]=-t[r+2],n=!0)}}return new Si(t,i,n)}(e,t,r,i);case"flat":return Ai(e,i);case"smooth":return function(e,t){const r={};for(let s=0;s<t.length;s+=3){const i=Ei(e,t,s,Ui);for(let e=0;e<3;e++){const n=t[s+e];let o=r[n];o||(o={normal:(0,p.vt)(),count:0},r[n]=o),(0,d.g)(o.normal,o.normal,i),o.count++}}const i=(0,lr.oe)(3*t.length),n=new Array(3*t.length);for(let s=0;s<t.length;s++){const e=r[t[s]];1!==e.count&&((0,d.n)(e.normal,e.normal),e.count=1);for(let t=0;t<3;t++)i[3*s+t]=e.normal[t];n[s]=s}return new Si(i,n,!1)}(e,i)}}function Ai(e,t){const r=(0,lr.oe)(t.length),i=new Array(3*t.length);for(let n=0;n<t.length;n+=3){const s=Ei(e,t,n,Ui);for(let e=0;e<3;e++)r[n+e]=s[e],i[n+e]=n/3}return new Si(r,i,!1)}function Ci(e,t,r,i,n,s){const o=3*t[r],a=3*t[r+1],l=3*t[r+2];i[0]=e[o],i[1]=e[o+1],i[2]=e[o+2],n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],s[0]=e[l],s[1]=e[l+1],s[2]=e[l+2]}function Ei(e,t,r,i){return Ci(e,t,r,Fi,ki,zi),(0,d.f)(ki,ki,Fi),(0,d.f)(zi,zi,Fi),(0,d.b)(Fi,ki,zi),(0,d.n)(i,Fi),i}function Ri(e){if(!e)return null;const{scale:t,offset:r,rotation:i}=e;return{scale:t,offset:r,rotation:(0,sr.kU)(i)}}function Pi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"repeat";if("string"==typeof e){const t=Oi(e);return{s:t,t:t}}return{s:Oi(e.horizontal),t:Oi(e.vertical)}}function Oi(e){switch(e){case"clamp":return qr.pF.CLAMP_TO_EDGE;case"mirror":return qr.pF.MIRRORED_REPEAT;default:return qr.pF.REPEAT}}function Ii(e){return null==e?"-":e instanceof tt.A?e.toHex():e.contentHash}function Li(e){const{offset:t,scale:r,rotation:i}=e??Ni;return`${t[0]},${t[1]},${i},${r[0]},${r[1]}`}const Ni=new hr.A,Di=(0,p.vt)(),Fi=(0,p.vt)(),ki=(0,p.vt)(),zi=(0,p.vt)(),Ui=(0,p.vt)(),Vi=(0,F.vt)(),Bi=(0,F.vt)(),ji=(0,g.vt)(),Hi=[new cr.A];var Gi;!function(e){e[e.NONE=0]="NONE",e[e.RENDER=1]="RENDER"}(Gi||(Gi={}));var Zi=r(78393),$i=r(47675),qi=r(72733),Wi=r(35416);class Yi{constructor(e,t,r,i){this.graphics3DSymbolLayer=e,this.instanceIndex=t,this.elevationAligner=r,this.elevationContext=i,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const t=this._lodRenderer.instanceData;e!==t.getVisible(this.instanceIndex)&&t.setVisible(this.instanceIndex,e)}destroy(){null!=this.instanceIndex&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,t,r){if(this.elevationAligner){(0,x.gf)(this.elevationContext.featureExpressionInfoContext,r);const i=(r,i)=>(0,G.sE)(r,e,this.elevationContext,t,i),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,i,t);null!=n&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,p.vt)();return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,en),(0,d.h)(e,this._lodRenderer.baseBoundingSphere.center,en)}getBoundingBoxObjectSpace(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,g.vt)();this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,en);const t=this._lodRenderer.baseBoundingBox;(0,g.Ie)(e);for(let r=0;r<8;++r)(0,d.s)(Ji,1&r?t[3]:t[0],2&r?t[4]:t[1],4&r?t[5]:t[2]),(0,d.h)(Ji,Ji,en),(0,g.iT)(e,Ji);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,en),e.render.origin[0]+=en[12],e.render.origin[1]+=en[13],e.render.origin[2]+=en[14],e.render.num++}async getProjectedBoundingBox(e,t,r,i,n){const s=this.getBoundingBoxObjectSpace(n),o=Qi,a=(0,g.fT)(s)?1:o.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,en);for(let c=0;c<a;c++){const e=o[c];Ji[0]=s[e[0]],Ji[1]=s[e[1]],Ji[2]=s[e[2]],(0,d.h)(Ji,Ji,en),Xi[3*c]=Ji[0],Xi[3*c+1]=Ji[1],Xi[3*c+2]=Ji[2]}if(!e(Xi,0,a))return null;(0,g.Ie)(s);let l=null;this.calculateRelativeScreenBounds&&(l=this.calculateRelativeScreenBounds());for(let c=0;c<3*a;c+=3){for(let e=0;e<3;e++)s[e]=Math.min(s[e],Xi[c+e]),s[e+3]=Math.max(s[e+3],Xi[c+e]);l&&r.push({location:Xi.slice(c,c+3),screenSpaceBoundingRect:l})}if(t&&((0,g.gX)(s,Ki),"absolute-height"!==this.elevationContext.mode)){let e;const r=(0,$.vY)(s,t.service.spatialReference,t);try{e=await t.service.queryElevation(Ki[0],Ki[1],i,r,"ground")}catch(xt){}null!=e&&(0,g.cY)(s,0,0,-this.alignedSampledElevation+e)}return s}addObjectState(e,t){if(e===xe.Mg.Highlight){const r=new Wi.X(e);this._addHighlightId(r),t.addExternal((e=>{this._removeHighlightId(e)}),r)}}removeObjectState(e){this._highlights.forEach((t=>e.remove(t)))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const Xi=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ji=(0,p.vt)(),Ki=(0,p.vt)(),Qi=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],en=(0,F.vt)();var tn=r(75646),rn=r(12062);function nn(e,t){const r=e.stageResources.geometries.map((t=>new rn.iC(t,e.stageResources.textures))),i=null==e.lodThreshold||0===e.lodThreshold&&t>0?function(e){const t=e.reduce(((e,t)=>{let{geometry:r}=t;return e+r.indexCount/3}),0);return Math.sqrt(t*sn/Math.PI)}(r):e.lodThreshold;return new rn.hr(r,i,e.pivotOffset)}const sn=20;var on=r(7323),an=r(73177),ln=r(90346),cn=r(8446),un=r(26314);var hn=r(46053),dn=r(85842),pn=r(57481),fn=r(48549),mn=r(33062),gn=r(60586),yn=r(3112),_n=r(94536),vn=r(91967),bn=r(54099),wn=r(88105),xn=r(94966),Sn=r(76718);class Tn{constructor(e,t,r){this._elementSize=t,this._buffer=Sn.g.createVertex(e,qr._U.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const n=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,i*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,t){const r=e*this._elementSize,i=t*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,i)}resize(e){const t=e*this._elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(t),this._capacity=e}}class Mn{constructor(e){this.modelOriginHi=e.getField(Q.r.INSTANCEMODELORIGINHI,wn.xs),this.modelOriginLo=e.getField(Q.r.INSTANCEMODELORIGINLO,wn.xs),this.model=e.getField(Q.r.INSTANCEMODEL,wn.jZ),this.modelNormal=e.getField(Q.r.INSTANCEMODELNORMAL,wn.jZ),this.featureAttribute=e.getField(Q.r.INSTANCEFEATUREATTRIBUTE,wn.Eq),this.color=e.getField(Q.r.INSTANCECOLOR,wn.XP),this.objectAndLayerIdColor=e.getField(Q.r.INSTANCEOBJECTANDLAYERIDCOLOR,wn.XP)}}class An{constructor(e,t){this._rctx=e,this._instanceBufferLayout=t,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){(0,zr.vA)(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){(0,zr.vA)(this._updating,"not updating"),this.size<i.$U*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){(0,zr.vA)(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),(0,zr.vA)(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){(0,zr.vA)(this._updating,"not updating"),(0,zr.vA)(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(Cn,Math.floor(this._capacity*i.Ji));this._resize(e)}_shrink(){const e=Math.max(Cn,Math.floor(this._capacity*i.He));this._resize(e)}_resize(e){if((0,zr.vA)(this._updating,"not updating"),e===this._capacity)return;const t=new Tn(this._rctx,this._instanceBufferLayout.stride,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const e=this.size,r=this._compactInstances(t);(0,zr.vA)(r===e,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=r,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new Mn(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const t=this._headIndex,r=this._tailIndex;return r<t?(this._buffer.copyRange(r,t,e),t-r):r>t?(this._buffer.copyRange(r,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-r),t+(this._capacity-r)):0}_incrementHead(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}}const Cn=64;var En;!function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"}(En||(En={}));class Rn{constructor(e){this.localTransform=e.getField(Q.r.LOCALTRANSFORM,wn.E$),this.globalTransform=e.getField(Q.r.GLOBALTRANSFORM,wn.E$),this.modelOrigin=e.getField(Q.r.MODELORIGIN,wn.Xm),this.model=e.getField(Q.r.INSTANCEMODEL,wn.jZ),this.modelNormal=e.getField(Q.r.INSTANCEMODELNORMAL,wn.jZ),this.modelScaleFactors=e.getField(Q.r.MODELSCALEFACTORS,wn.gH),this.boundingSphere=e.getField(Q.r.BOUNDINGSPHERE,wn.Aj),this.featureAttribute=e.getField(Q.r.FEATUREATTRIBUTE,wn.Eq),this.color=e.getField(Q.r.COLOR,wn.XP),this.objectAndLayerIdColor=e.getField(Q.r.OBJECTANDLAYERIDCOLOR,wn.XP),this.state=e.getField(Q.r.STATE,wn.SL),this.lodLevel=e.getField(Q.r.LODLEVEL,wn.SL)}}let Pn=class extends vn.A{constructor(e,t){super(e),this.events=new bn.A,this._capacity=0,this._size=0,this._next=0,this._layout=function(e){let t=(0,fn.BP)().mat4f64(Q.r.LOCALTRANSFORM).mat4f64(Q.r.GLOBALTRANSFORM).vec4f64(Q.r.BOUNDINGSPHERE).vec3f64(Q.r.MODELORIGIN).mat3f(Q.r.INSTANCEMODEL).mat3f(Q.r.INSTANCEMODELNORMAL).vec2f(Q.r.MODELSCALEFACTORS);return e.includes(Q.r.FEATUREATTRIBUTE)&&(t=t.vec4f(Q.r.FEATUREATTRIBUTE)),e.includes(Q.r.COLOR)&&(t=t.vec4u8(Q.r.COLOR)),e.includes(Q.r.OBJECTANDLAYERIDCOLOR)&&(t=t.vec4u8(Q.r.OBJECTANDLAYERIDCOLOR)),t=t.u8(Q.r.STATE).u8(Q.r.LODLEVEL),t}(t),this._capacity=Cn,this._buffer=this._layout.createBuffer(this._capacity),this._view=new Rn(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,En.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const t=this._view.state;(0,zr.vA)(e>=0&&e<this._capacity&&!!(t.get(e)&En.ALLOCATED),"invalid instance handle"),this._getStateFlag(e,En.ACTIVE)?this._setStateFlags(e,En.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const t=this._view.state;(0,zr.vA)(e>=0&&e<this._capacity&&!!(t.get(e)&En.ALLOCATED),"invalid instance handle"),t.set(e,0),this._size--}setLocalTransform(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){const t=this._view,r=On,i=In;t.localTransform.getMat(e,Ln),t.globalTransform.getMat(e,Nn);const n=(0,D.lw)(Nn,Nn,Ln);(0,d.s)(r,n[12],n[13],n[14]),t.modelOrigin.setVec(e,r),(0,L.z0)(i,n),t.model.setMat(e,i);const s=(0,xn.wp)(On,n);s.sort(),t.modelScaleFactors.set(e,0,s[1]),t.modelScaleFactors.set(e,1,s[2]),(0,L.B8)(i,i),(0,L.mg)(i,i),t.modelNormal.setMat(e,i),this._setStateFlags(e,En.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,t){const r=this._view;r.model.getMat(e,In),r.modelOrigin.getVec(e,On),t[0]=In[0],t[1]=In[1],t[2]=In[2],t[3]=0,t[4]=In[3],t[5]=In[4],t[6]=In[5],t[7]=0,t[8]=In[6],t[9]=In[7],t[10]=In[8],t[11]=0,t[12]=On[0],t[13]=On[1],t[14]=On[2],t[15]=1}applyShaderTransformation(e,t){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){this._view.localTransform.getMat(e,t),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(On,this,e),t*=Math.max(On[0],On[1],On[2])),t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(On,this,e),t*=function(e,t,r){return Math.max(Math.min(e,t),Math.min(Math.max(e,t),r))}(On[0],On[1],On[2])),t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute.getVec(e,t)}setColor(e,t){this._view.color.setVec(e,t)}setObjectAndLayerIdColor(e,t){this._view.objectAndLayerIdColor.setVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,En.VISIBLE,t),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,En.VISIBLE)}setHighlight(e,t){t!==this.getHighlight(e)&&(this._setStateFlag(e,En.HIGHLIGHT,t),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,En.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t}_setStateFlags(e,t){const r=this._view.state;t=r.get(e)|t,r.set(e,t)}_clearStateFlags(e,t){const r=this._view.state;t=r.get(e)&~t,r.set(e,t)}_setStateFlag(e,t,r){r?this._setStateFlags(e,t):this._clearStateFlags(e,t)}_getStateFlag(e,t){return!!(this._view.state.get(e)&t)}_grow(){this._capacity=Math.max(Cn,Math.floor(this._capacity*i.Ji)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new Rn(this._buffer)}_findSlot(){const e=this._view.state;let t=this._next;for(;e.get(t)&En.ALLOCATED;)t=t+1===this._capacity?0:t+1;return this._next=t+1===this._capacity?0:t+1,t}};(0,Xr._)([(0,hn.MZ)({constructOnly:!0})],Pn.prototype,"shaderTransformation",void 0),(0,Xr._)([(0,hn.MZ)()],Pn.prototype,"_size",void 0),(0,Xr._)([(0,hn.MZ)({readOnly:!0})],Pn.prototype,"size",null),Pn=(0,Xr._)([(0,dn.$)("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],Pn);const On=(0,p.vt)(),In=(0,N.vt)(),Ln=(0,F.vt)(),Nn=(0,F.vt)();var Dn=r(93582);class Fn extends _n.A{constructor(e,t){super((e=>(0,Dn.w)(this._instanceData.view.boundingSphere.getVec(e,this._tmpSphere))),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=t,this._tmpSphere=(0,Dn.c)(),this._tmpMat4=(0,F.vt)()}addInstance(e){const t=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);(0,d.h)((0,Dn.g)(this._tmpSphere),this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*(0,xn.hG)(r),t.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}}class kn{constructor(e,t){this._worldSpaceRadius=e,this._minScreenSpaceRadii=t}selectLevel(e,t,r){const i=r.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*t/i;let s=0;for(let o=1;o<this._minScreenSpaceRadii.length;++o)n>=this._minScreenSpaceRadii[o]&&(s=o);return s}}var zn=r(50255),Un=r(29808),Vn=r(69008),Bn=r(71488);class jn{constructor(e,t){const r=e.renderContext.rctx,i=t.geometry;this._materials=e.materials,i.material.setParameters({instancedDoublePrecision:!0});const n=i.material.createBufferWriter(),s=n.vertexBufferLayout,o=n.elementCount(i),a=s.createBuffer(o);n.write(null,null,i,a,0),this.geometry=i,this.material=i.material,this.glMaterials=new zn.c(i.material,this._materials),this.vertexBufferLayout=s,this.vbo=Sn.g.createVertex(r,qr._U.STATIC_DRAW,a.buffer),this.vao=new Vn.Z(r,Hr.D,{geometry:(0,pn.U)(s)},{geometry:this.vbo}),this.vertexCount=o}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,t,r,i,n,s,o,a){const l=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,i,((r,i,c,u,h)=>{if(r>=0){if(null!=t&&!t(e.rayBegin,e.rayEnd,r))return;const u=new Bn.h(s.layerUid,s.graphicUid(n),l,c,o,a);if((null==e.results.min.drapedLayerOrder||h>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||r<e.results.min.dist)&&e.results.min.set(yn.dz.LOD,u,r,i,e.transform.transform,h),e.options.store!==yn.oH.MIN&&(null==e.results.max.drapedLayerOrder||h>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||r>e.results.max.dist)&&e.results.max.set(yn.dz.LOD,u,r,i,e.transform.transform,h),e.options.store===yn.oH.ALL){const t=(0,Un.G7)(e.results.min.ray);t.set(yn.dz.LOD,u,r,i,e.transform.transform,h),e.results.all.push(t)}}}))}}class Hn{static async create(e,t,r){const n=await Promise.allSettled(t.components.map((t=>e.controller.schedule((()=>new jn(e,t)),r)))),s=n.map((e=>"fulfilled"===e.status?e.value:null)).filter(i.Ru);if((0,o.G4)(r)||s.length!==n.length){s.forEach((e=>e.destroy())),(0,o.Te)(r);for(const e of n)if("rejected"===e.status)throw e.reason}return new Hn(t.minScreenSpaceRadius,s)}constructor(e,t){this.minScreenSpaceRadius=e,this.components=t}destroy(){this.components.forEach((e=>e.destroy()))}intersect(e,t,r,i,n,s,o){this.components.forEach((a=>a.intersect(e,t,r,i,n,s,this.boundingSphere,o)))}get boundingBox(){if(null==this._boundingBox){const e=(0,g.Ie)();this.components.forEach((t=>{null!=t.boundingInfo&&((0,g.iT)(e,t.boundingInfo.bbMin),(0,g.iT)(e,t.boundingInfo.bbMax))})),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(null==this._boundingSphere){const e=this.boundingBox,t=(0,p.vt)();(0,g.gX)(e,t),this._boundingSphere={center:t,radius:.5*(0,g._F)(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce(((e,t)=>e+t.triangleCount),0)}}var Gn=r(99362),Zn=r(68967),$n=r(37267),qn=r(59752),Wn=r(27207);let Yn=class extends gn.S{constructor(e,t){super(e),this.type=yn.dz.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new mn.A,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[kr.N.OPAQUE_MATERIAL,e=>this._produces(e)],[kr.N.TRANSPARENT_MATERIAL,e=>!!this._hasTransparentLevels()&&this._produces(e)]]),this._instanceData=new Pn({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(t.registerTask(qn.W6.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=function(e){let t=(0,fn.BP)().vec3f(Q.r.INSTANCEMODELORIGINHI).vec3f(Q.r.INSTANCEMODELORIGINLO).mat3f(Q.r.INSTANCEMODEL).mat3f(Q.r.INSTANCEMODELNORMAL);return null!=e&&e.includes("featureAttribute")&&(t=t.vec4f(Q.r.INSTANCEFEATUREATTRIBUTE)),null!=e&&e.includes("color")&&(t=t.vec4u8(Q.r.INSTANCECOLOR)),null!=e&&e.includes("objectAndLayerIdColor")&&(t=t.vec4u8(Q.r.INSTANCEOBJECTANDLAYERIDCOLOR)),t}(this.optionalFields),this._glInstanceBufferLayout=(0,pn.U)(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",(()=>this._requestUpdateCycle())),this._instanceData.events.on("instance-transform-changed",(e=>{let{index:t}=e;this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(t)})),this._instanceData.events.on("instance-visibility-changed",(e=>{let{index:t}=e;this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(t)})),this._instanceData.events.on("instance-highlight-changed",(()=>this._requestUpdateCycle(!0)))])}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce(((e,t)=>t.reduce(((e,t)=>e+t.usedMemory),e)),0)}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach(((e,r)=>{const i=this._allRenderInstanceData[0][r].size+this._allRenderInstanceData[1][r].size,n=e.triangleCount;t.push({renderedInstances:i,renderedTriangles:i*n,trianglesPerInstance:n})})),{totalInstances:e,renderedInstances:t.reduce(((e,t)=>e+t.renderedInstances),0),renderedTriangles:t.reduce(((e,t)=>e+t.renderedTriangles),0),levels:t}}async initializeRenderContext(e,t){this._context=e;const r=e.renderContext.rctx,n=await Promise.allSettled(this.symbol.levels.map((i=>(this._defaultRenderInstanceData[0].push(new An(r,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new An(r,this._instanceBufferLayout)),Hn.create(e,i,t))))),s=n.map((e=>"fulfilled"===e.status?e.value:null)).filter(i.Ru);if((0,o.G4)(t)||s.length!==n.length){s.forEach((e=>e.destroy())),(0,o.Te)(t);for(const e of n)if("rejected"===e.status)throw e.reason}this._levels=s,this._levelSelector=(e=>{const t=e.baseBoundingSphere.radius,r=e.levels.map((e=>e.minScreenSpaceRadius));return new kn(t,r)})(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach((e=>e.destroy())),this._defaultRenderInstanceData[0].forEach((e=>e.destroy())),this._highlightRenderInstanceData[0].forEach((e=>e.destroy()))}_hasTransparentLevels(){return this._levels.some((e=>e.components.some((e=>{const t=e.material.produces.get(kr.N.TRANSPARENT_MATERIAL);return t?.(Nr.V.Color)}))))}hasHighlights(){return this._highlightRenderInstanceData[0].some((e=>e.size>0))}_produces(e){return e!==Nr.V.Highlight&&e!==Nr.V.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!ae.b.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const t=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),t||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(qn.Bb),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const t=this._getInstanceDatas(e.output);if(!t)return null;const r=new Array;return t.forEach((t=>this.levels.forEach(((i,n)=>{i.components.forEach((i=>r.push(this._beginComponent(e,t[n],i))))})))),r}renderNode(e,t){const r=this._getInstanceDatas(e.output);if(!r||null==t)return;let i=0;e.rctx.bindVAO(),r.forEach((r=>this.levels.forEach(((n,s)=>{n.components.forEach((n=>this._renderComponent(e,t[i++],r[s],n,s)))}))))}_getInstanceDatas(e){const t=e!==Nr.V.Highlight&&e!==Nr.V.ShadowHighlight,r=e!==Nr.V.ShadowExcludeHighlight;return t&&r?this._allRenderInstanceData:t?this._defaultRenderInstanceData:r?this._highlightRenderInstanceData:null}intersect(e,t,r,i){if(!this.baseMaterial.isVisible()||null==this._octree)return;const n=(0,p.vt)();(0,d.f)(n,i,r);const s=n=>{this._instanceData.getCombinedModelTransform(n,Qn),e.transform.set(Qn),(0,d.h)(es,r,e.transform.inverse),(0,d.h)(ts,i,e.transform.inverse);const s=this._instanceData.getState(n),o=this._instanceData.getLodLevel(n),a=this._levels.length;(0,zr.vA)(!!(s&En.ACTIVE),"invalid instance state"),(0,zr.vA)(o>=0&&o<a,"invaid lod level"),this._levels[o].intersect(e,t,es,ts,n,this.metadata,a)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(s):this._octree.forEachAlongRay(r,n,s)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(null==this._octreeCached){const e=this._instanceData,t=e.view?.state;if(!t)return null;this._octreeCached=new Fn(e,this.baseBoundingSphere);for(let r=0;r<e.capacity;++r)t.get(r)&En.ACTIVE&&this._octreeCached.addInstance(r)}return this._octreeCached}_invalidateOctree(){this._octreeCached=(0,rt.pR)(this._octreeCached)}queryDepthRange(e){if(null==this._octree)return{near:1/0,far:-1/0};const t=e.viewForward,r=this._octree.findClosest(t,_n.A.DepthOrder.FRONT_TO_BACK,e.frustum),i=this._octree.findClosest(t,_n.A.DepthOrder.BACK_TO_FRONT,e.frustum);if(null==r||null==i)return{near:1/0,far:-1/0};const n=e.eye,s=this._instanceData.view;s.boundingSphere.getVec(r,Kn),(0,d.f)(Kn,Kn,n);const o=(0,d.m)(Kn,t)-Kn[3];s.boundingSphere.getVec(i,Kn),(0,d.f)(Kn,Kn,n);const a=(0,d.m)(Kn,t)+Kn[3];return{near:Math.max(e.near,o),far:Math.min(e.far,a)}}_requestUpdateCycle(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.startUpdateCycle()))))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:t,_camera:r,_levelSelector:i}=this;this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.beginUpdate()))));const n=this._instanceData,s=n.view;let o=n.size;const a=n.capacity;let l=this._instanceIndex;const c=Math.ceil(a/500);for(let u=0;u<o&&!e.done;++u){l===this._cycleStartIndex&&this._startUpdateCycle();const u=s.state.get(l);let h=0;if(!(u&En.ALLOCATED)){l=l+1===a?0:l+1,o++;continue}const d=s.lodLevel.get(l);if(u&En.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][d].freeTail(),u&En.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][d].freeTail(),u&En.REMOVE)n.freeInstance(l);else if(u&En.VISIBLE){let e=0;t&&(s.modelOrigin.getVec(l,Jn),e=i.selectLevel(Jn,n.getCombinedMedianScaleFactor(l),r)),h=u&~(En.ACTIVE|En.TRANSFORM_CHANGED),e>=0&&(u&En.HIGHLIGHT?(Xn(this._highlightRenderInstanceData[0][e],s,l),h|=En.HIGHLIGHT_ACTIVE):(Xn(this._defaultRenderInstanceData[0][e],s,l),h|=En.DEFAULT_ACTIVE)),s.state.set(l,h),s.lodLevel.set(l,e)}else h=u&~(En.ACTIVE|En.TRANSFORM_CHANGED),s.state.set(l,h);if(null!=this._octreeCached){const e=!!(u&En.ACTIVE),t=!!(h&En.ACTIVE);!e&&t?this._octreeCached.addInstance(l):e&&!t?this._octreeCached.removeInstance(l):e&&t&&u&En.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(l),this._octreeCached.addInstance(l))}l=l+1===a?0:l+1,l%c==0&&e.madeProgress()}this._instanceIndex=l,this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.endUpdate())))),this._context.requestRender()}_beginComponent(e,t,r){if(0===t.size)return null;const i=r.glMaterials.load(e.rctx,e.bindParameters.slot,e.output);return null!=i?i.beginSlot(e.bindParameters):null}_renderComponent(e,t,r,i,n){if(!t)return;const{bindParameters:s,rctx:o}=e;o.runAppleAmdDriverHelper();const a=o.bindTechnique(t,s,i.material.parameters,is);o.bindVAO(i.vao),t.ensureAttributeLocations(i.vao),ae.b.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===Nr.V.Color&&(a.setUniform4fv("externalColor",rs[Math.min(n,rs.length-1)]),a.setUniform1i("colorMixMode",Gn.Um.replace));const l=r.capacity,c=r.headIndex,u=r.tailIndex,h=r.firstIndex,d=this._glInstanceBufferLayout,p=(e,n)=>{(0,Wn.yu)(o,Hr.D,r.buffer,d,e),o.drawArraysInstanced(t.primitiveType,0,i.vertexCount,n-e),(0,Wn.Hi)(o,Hr.D,r.buffer,d)};i.material.parameters.transparent&&null!=h?c>u?((0,zr.vA)(h>=u&&h<=c,"invalid firstIndex"),p(h,c),p(u,h)):c<u&&(h<=c?((0,zr.vA)(h>=0&&h<=c,"invalid firstIndex"),p(h,c),p(u,l),p(0,h)):((0,zr.vA)(h>=u&&h<=l,"invalid firstIndex"),p(h,l),p(0,c),p(u,h))):c>u?p(u,c):c<u&&(p(0,c),p(u,l)),o.bindVAO(null)}};function Xn(e,t,r){const i=e.allocateHead();!function(e,t,r,i){(0,Zn.Vk)(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,e.model,t),r.modelNormal.copyFrom(i,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(i,e.color,t),e.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,e.objectAndLayerIdColor,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,e.featureAttribute,t)}(t,r,e.view,i)}(0,Xr._)([(0,hn.MZ)({constructOnly:!0})],Yn.prototype,"symbol",void 0),(0,Xr._)([(0,hn.MZ)({constructOnly:!0})],Yn.prototype,"optionalFields",void 0),(0,Xr._)([(0,hn.MZ)({constructOnly:!0})],Yn.prototype,"metadata",void 0),(0,Xr._)([(0,hn.MZ)({constructOnly:!0})],Yn.prototype,"shaderTransformation",void 0),(0,Xr._)([(0,hn.MZ)()],Yn.prototype,"_instanceData",void 0),(0,Xr._)([(0,hn.MZ)()],Yn.prototype,"_cycleStartIndex",void 0),(0,Xr._)([(0,hn.MZ)({readOnly:!0})],Yn.prototype,"_enableLevelSelection",null),(0,Xr._)([(0,hn.MZ)()],Yn.prototype,"_updateCyclesWithStaticCamera",void 0),(0,Xr._)([(0,hn.MZ)({readOnly:!0})],Yn.prototype,"running",null),Yn=(0,Xr._)([(0,dn.$)("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Yn);const Jn=(0,p.vt)(),Kn=(0,ot.vt)(),Qn=(0,F.vt)(),es=(0,p.vt)(),ts=(0,p.vt)(),rs=[(0,ot.fA)(1,0,1,1),(0,ot.fA)(0,0,1,1),(0,ot.fA)(0,1,0,1),(0,ot.fA)(1,1,0,1),(0,ot.fA)(1,0,0,1)],is=new $n.V;class ns{constructor(e,t,r,i,n,s,o,a,l,c,u,h){this.lodResources=e,this.lodRenderer=t,this.stageResources=r,this.originalMaterialParameters=i,this.resourceSize=n,this.isEsriSymbolResource=s,this.isWosr=o,this.resourceBoundingBox=a,this.symbolSize=l,this.extentPadding=c,this.physicalBasedRenderingEnabled=u,this.pivotOffset=h}}class ss extends Z.U{getCachedSize(){const[e,t,r]=null!=this._resources?this._resources.symbolSize:[1,1,1];return{width:e,depth:t,height:r}}constructor(e,t,r,i){super(e,t,r,i),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&(0,$.Hj)(this.symbolLayer))throw new Error;if(this._isPrimitive){const t=this.symbolLayer.resource,r=t&&(0,an.k)(t?.primitive)?t.primitive:$i.r;this._resources=await this._createResourcesForPrimitive(r,e)}else{const t=await async function(e){if(null===e||null==e.styleName&&null==e.styleUrl)return null;const t=e.name;if(null==t)throw new R.A("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const r={portal:e.portal},i=await(0,cn.cF)(e,r).catch((()=>null));if(null===i)return null;const n=(0,un.p)(t,i.data);if(n&&!n.formatInfos?.some((e=>"gltf_basisu"===e.type)))return null;const s=await(0,un.I)(i,t,r,"webRef",((e,t)=>(0,cn.o5)(e,t,["gltf_basisu","gltf"]))).catch((()=>null));if(null===s||"point-3d"!==s.type)return null;const o=s.symbolLayers.items[0];return"object"===o.type?o.resource:null}(this.symbol.styleOrigin),r=t?.href??this.symbolLayer.resource?.href;this._resources=await this._createResourcesForUrl(r,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return null!=this._resources?this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}get materials(){return this._resources?.stageResources.materials??[]}_setMaterialTransparencyParameters(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.symbolLayer?.material?.color;const r=this._getCombinedOpacity(t),i=r<1||this.needsDrivenTransparentPass;return e.transparent=i,e.opacity=r,e.cullFace=i?xe.s2.None:xe.s2.Back,e}async _createResourcesForPrimitive(e,t){const r=this.symbolLayer,i=(0,g.vt)((0,qi.Fq)(e)),n=(0,p.ci)((0,g.Ej)(i)),o=(0,p.ci)((0,qi.Bb)(n,r)),a=(0,d.l)(o),l={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...bi.mX],ambient:p.Un,diffuse:p.Un,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},c=!!l.usePBR;this._setMaterialTransparencyParameters(l);const u=this.symbol;if("point-3d"===u.type&&u.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=u.verticalOffset;l.verticalOffset={screenLength:(0,it.Lz)(e),minWorldLength:t||0,maxWorldLength:null!=r?r:1/0},l.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(l.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)l.externalColor=ot.Un;else{const e=null!=r.material?r.material.color:null,t=null!=e?tt.A.toUnitRGBA(e):ot.Un;l.externalColor=t}this._fastUpdates=(0,At.s_)(this._context.renderer,this._fastVisualVariableConvertOptions(i,o,n,null)),l.isInstanced=!0,this._fastUpdates?(Object.assign(l,this._fastUpdates.materialParameters),this._optionalFields.push(Q.r.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(l.hasInstancedColor=!0,this._optionalFields.push(Q.r.COLOR)),(0,s.A)("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(Q.r.OBJECTANDLAYERIDCOLOR);const h=new Ae.$U(l),f=(0,an._)(e,h);if(!f)throw new Error(`Unknown object symbol primitive: ${e}`);const m=(0,rn.lS)(f).map((e=>({opacity:1,transparent:e.parameters.transparent}))),y=await this._createStageResources(f,c,t),_=await this._createLodRenderer(f,t);return new ns(f,_,y,m,n,!1,!1,i,o,a,c,null)}async _createResourcesForUrl(e,t){const r={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=(0,At.s_)(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(r.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(Q.r.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(r.materialParameters.hasInstancedColor=!0,this._optionalFields.push(Q.r.COLOR)),(0,s.A)("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(Q.r.OBJECTANDLAYERIDCOLOR);const i=this.symbol;if("point-3d"===i.type&&i.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:n}=i.verticalOffset;r.materialParameters.verticalOffset={screenLength:(0,it.Lz)(e),minWorldLength:t||0,maxWorldLength:null!=n?n:1/0},r.materialParameters.castShadows=!1}const n=this._context.physicalBasedRenderingEnabled;r.signal=t,r.usePBR=n,r.skipHighLods=this._context.skipHighSymbolLods;const o=await(0,on.fetch)(e,r),a=o.isEsriSymbolResource,l=o.isWosr,c=function(e){return new rn.Fe(e.map(((e,t)=>nn(e,t))))}(o.lods),u=this._context,h=this.symbolLayer.material,f=this._getExternalColorParameters(h),m=this.symbolLayer?.material?.color,y=this._getCombinedOpacity(m,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,v=(0,rn.lS)(c),b=(0,rn.lS)(c).map((e=>({opacity:e.parameters.opacity||1,transparent:e.parameters.transparent})));v.forEach((e=>{const t=e.parameters;e.setParameters(f);const r=t.opacity*y,i=r<1||_||t.transparent;e.setParameters({opacity:r,transparent:i}),u.screenSizePerspectiveEnabled&&e.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})}));const w=o.referenceBoundingBox,x=(0,p.ci)((0,g.Ej)(w)),S=(0,p.ci)(c.levels[0].pivotOffset),T=(0,p.ci)((0,qi.Bb)(x,this.symbolLayer)),M=(0,d.l)(T),A=this._fastUpdates;(0,At.J_)(A,this._context.renderer,this._fastVisualVariableConvertOptions(w,T,x,S))&&v.forEach((e=>e.setParameters(A.materialParameters)));const C=await this._createStageResources(c,n,t),E=await this._createLodRenderer(c,t);return new ns(c,E,C,b,x,a,l,w,T,M,n,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,t,r){const i=this._context.stage,n=(0,rn.lS)(e);t!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),i.addMany(n),this._addDisposeResource((()=>i.removeMany(n)));const s=(0,rn.n3)(e);i.addMany(s),this._addDisposeResource((()=>{s.forEach((e=>e.unload())),i.removeMany(s)})),await Promise.all(s.map((e=>this._context.stage.schedule((()=>e.load(i.renderView.renderingContext)),r)))),(0,o.Te)(r);const a=(0,rn.XT)(e);return i.addMany(a),this._addDisposeResource((()=>i.removeMany(a))),{materials:n,textures:s,geometries:a}}async _createLodRenderer(e,t){const r=this._context.stage,i={layerUid:this._context.layer.uid,graphicUid:e=>this._instanceIndexToGraphicUid.get(e),notifyGraphicGeometryChanged:e=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(e)),notifyGraphicVisibilityChanged:e=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(e))},n=this._fastUpdates,s=n?{applyTransform:(e,t,r)=>{e.getFeatureAttribute(t,hs),(0,D.C)(r,(0,At.b3)(n.materialParameters,hs,r))},scaleFactor:(e,t,r)=>{t.getFeatureAttribute(r,hs),(0,At.VC)(e,n.materialParameters,hs)}}:null,o=new Yn({symbol:e,optionalFields:this._optionalFields,metadata:i,shaderTransformation:s},this._context.scheduler);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource((()=>{r.removeRenderPlugin(o),o.destroy()})),await r.addRenderPlugin(o,t),o}_getExternalColorParameters(e){const t={};return this._drivenProperties.color?t.externalColor=ot.Un:null!=e?.color?t.externalColor=tt.A.toUnitRGBA(e.color):(t.externalColor=ot.Un,t.colorMixMode="ignore"),t}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach((e=>e())),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;const r=(0,Mt.ZX)(t.geometry);if(null==r)return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`),null;const i=this.setGraphicElevationContext(t),n=e.renderingInfo;return this._createAs3DShape(t,r,n,i,t.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(null==this._resources)return;const e=this._drivenProperties.opacity,t=!this._isPrimitive,r=this._resources.stageResources.materials,i=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const s=r[n],o=this.symbolLayer?.material?.color,a=i[n],l=this._getCombinedOpacity(o,{hasIntrinsicColor:t})*a.opacity,c=l<1||e||a.transparent;s.setParameters({opacity:l,transparent:c}),this._isPrimitive&&s.setParameters({cullFace:c?xe.s2.None:xe.s2.Back})}}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,G.Kf)}slicePlaneEnabledChanged(){if(null==this._resources)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(null==this._resources)return!0;const{stageResources:e,isWosr:t}=this._resources;for(const r of e.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):t||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1!==this._hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,t){if(null==this._resources)return q.w.RecreateSymbol;const{stageResources:{materials:r},lodRenderer:i,resourceBoundingBox:n,symbolSize:s,resourceSize:o,pivotOffset:a}=this._resources;for(const l in e.diff){if("visualVariables"!==l)return q.w.RecreateSymbol;if(!(0,At.J_)(this._fastUpdates,t,this._fastVisualVariableConvertOptions(n,s,o,a)))return q.w.RecreateSymbol;for(const e of r)e.setParameters(this._fastUpdates.materialParameters);i.notifyShaderTransformationChanged()}return q.w.FastUpdate}computeComplexity(){if(null==this._resources)return super.computeComplexity();const e=this._resources.lodResources,t=(0,a.pg)(e.levels),r=(0,rn.XT)(e).reduce(((e,t)=>e+(e=>Array.from(e.attributes.values()).reduce(((e,t)=>e+(0,Zi.Ek)(t.data,t.indices)),0))(t)),0),i=(0,rn.n3)(e).reduce(((e,t)=>e+t.memoryEstimate),0)+r,n={...(0,a.GI)(this.symbol,this.symbolLayer),resourceBytes:i};return new ln.rz({verticesPerFeature:t,memory:n})}_hasLodRenderer(){return null!=this._resources}_createAs3DShape(e,t,r,i,n,s){if(!this._hasLodRenderer()||null==this._resources)return null;const o=this.getFastUpdateAttrValues(e),a=this._context.clippingExtent;if((0,at.g)(t,ls,this._context.elevationProvider.spatialReference),null!=a&&!(0,g.Uc)(a,ls))return null;const l=as(i),c=this._computeGlobalTransform(t,i,us,ds),u=this._computeLocalTransform(this._resources,this.symbolLayer,r,cs),h=this._resources.lodRenderer.instanceData,d=h.addInstance();this._instanceIndexToGraphicUid.set(d,n),h.setLocalTransform(d,u,!1),h.setGlobalTransform(d,c),o&&h.setFeatureAttribute(d,o),null==this._fastUpdates&&this._hasPerInstanceColor()&&h.setColor(d,(0,$.$C)(r.color,r.opacity,255)),null!=this._context.stage.renderView.objectAndLayerIdRenderHelper&&h.setObjectAndLayerIdColor(d,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:s}));const p=new Yi(this,d,_t.Jf,i);return l&&(p.alignedSampledElevation=ds.sampledElevation),p.needsElevationUpdates=(0,G.Kf)(i.mode),(0,Mt.d2)(p,t,this._context.elevationProvider),p}_computeGlobalTransform(e,t,r,i){return(0,G.sE)(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,i),ls[0]=e.x,ls[1]=e.y,ls[2]=i.z,(0,k.l)(e.spatialReference,ls,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,t,r,i){return(0,D.D_)(i),this._applyObjectRotation(r,!1,i),this._applyObjectRotation(t,!0,i),this._applyObjectScale(e,r,i),this._applyAnchor(e,t,i),i}_applyObjectScale(e,t,r){if(this._fastUpdates?.requiresShaderTransformation)return;const i=this._drivenProperties.size&&t.size?t.size:e.symbolSize,n=(0,$.pW)(i,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===n[0]&&1===n[1]&&1===n[2]||(0,D.hs)(r,r,n)}prepareSymbolLayerPatch(e){if("partial"!==e.diff.type)return;const t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}updateGeometry(e,t){if(null==this._resources)return!0;const r=t&&(0,Mt.ZX)(t);if(null==r)return!1;const i=this.getGeometryElevationMode(t);return e.elevationContext.mode===i&&(this._computeGlobalTransform(r,e.elevationContext,us,ds),as(e.elevationContext)&&(e.alignedSampledElevation=ds.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,us,!0),(0,Mt.d2)(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,t){if(!(t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition))return;if(null==this._resources)return;const r=(e,t,r)=>(null!=e&&"complete"===e.type?e.newValue:t)??r,i=r(t.heading,this.symbolLayer.heading,0),n=r(t.tilt,this.symbolLayer.tilt,0),s=r(t.roll,this.symbolLayer.roll,0),o=r(t.width,this.symbolLayer.width,void 0),a=r(t.height,this.symbolLayer.height,void 0),l=r(t.depth,this.symbolLayer.depth,void 0),c=r(t.anchor,this.symbolLayer.anchor,void 0),u=r(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;const h={heading:i,tilt:n,roll:s,anchor:c,anchorPosition:u},d=this._resources;this.loadStatus===tn.P.LOADED&&e.symbolLayerStatePatches.push((()=>{d.symbolSize=(0,p.ci)((0,qi.Bb)(d.resourceSize,{width:o,height:a,depth:l,isPrimitive:this.symbolLayer.isPrimitive}))})),e.graphics3DGraphicPatches.push(((e,t)=>{const r=this._computeLocalTransform(d,h,t,cs),i=e.instanceIndex;d.lodRenderer.instanceData.setLocalTransform(i,r,!0)}))}_preparePatchColor(e,t){if(!t.material||"partial"!==t.material.type)return;const r=t.material.diff;if(!r.color||"complete"!==r.color.type||null==r.color.newValue||null==r.color.oldValue)return;const i=r.color.newValue,n=null!=i?tt.A.toUnitRGBA(i):ot.Un;delete r.color;const s=this._resources;null!=s&&e.graphics3DGraphicPatches.push((e=>{let t;this._hasPerInstanceColor()?(s.lodRenderer.instanceData.setColor(e.instanceIndex,n),t=this._setMaterialTransparencyParameters({},i)):t=this._setMaterialTransparencyParameters({externalColor:n},i);for(const r of s.stageResources.materials)r.setParameters(t)}))}_applyObjectRotation(e,t,r){if(!this._fastUpdates?.requiresShaderTransformation||!t)return(0,$.$2)(e.heading,e.tilt,e.roll,r)}_applyAnchor(e,t,r){if(this._fastUpdates?.requiresShaderTransformation)return;const i=os(e.resourceBoundingBox,e.pivotOffset,t);i&&(0,D.Tl)(r,r,i)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,t,r,i){const n=null!=e?(0,p.ci)((0,g.Ej)(e)):p.Un,s=null!=e?os(e,i,this.symbolLayer):p.uY,o=this._context.renderCoordsHelper.unitInMeters,a=(0,$.pW)(null!=t?t:void 0,t,r,o),l=(0,p.fA)(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new At.wI({size:!0,color:!0,rotation:!0,opacity:!1},n,t??p.Un,o,s,a,l)}}function os(e,t,r){const i=(0,p.vt)();switch(r.anchor){case"center":(0,d.c)(i,(0,g.gX)(e)),(0,d.k)(i,i);break;case"top":{const t=(0,g.gX)(e);(0,d.s)(i,-t[0],-t[1],-e[5]);break}case"bottom":{const t=(0,g.gX)(e);(0,d.s)(i,-t[0],-t[1],-e[2]);break}case"relative":{const t=(0,g.gX)(e),n=(0,g.Ej)(e),s=r.anchorPosition,o=s?(0,p.fA)(s.x,s.y,s.z):p.uY;(0,d.B)(i,n,o),(0,d.g)(i,i,t),(0,d.k)(i,i);break}default:null!=t?(0,d.k)(i,t):(0,d.c)(i,p.uY)}return i}function as(e){return"absolute-height"!==e.mode}const ls=(0,p.vt)(),cs=(0,F.vt)(),us=(0,F.vt)(),hs=(0,ot.vt)(),ds=new G.Uk;var ps=r(64573);class fs{constructor(e,t,r,i){this.vertices=e,this.positionsES=t,this.offset=i;const n=e.length,s=Math.floor(n/2),o=this.offset+3*s,a=r[o],l=r[o+1],c=r[o+2];this.origin=(0,p.fA)(a,l,c),this.positions=(0,lr.oe)(3*n);const u=this.offset+3*n;for(let h=this.offset;h<u;h+=3)this.positions[h]=r[h]-a,this.positions[h+1]=r[h+1]-l,this.positions[h+2]=r[h+2]-c;this.updatePathVertexInformation()}get usedMemory(){return(0,Zi.Ek)(this.positions)}updatePathVertexInformation(){const e=this.vertices.length,t=this.vertices[0];let r=this.offset;const i=this.positions;t.vRight[0]=i[r+3]-i[r],t.vRight[1]=i[r+4]-i[r+1],t.vRight[2]=i[r+5]-i[r+2],r+=3;let n=(0,d.l)(t.vRight);t.vMinSiblingLength=n,(0,d.n)(t.vRight,t.vRight);let s=t;for(let o=1;o<e;++o){const t=this.vertices[o];if(t.vLeft=s.vRight,o<e-1){t.vRight[0]=i[r+3]-i[r],t.vRight[1]=i[r+4]-i[r+1],t.vRight[2]=i[r+5]-i[r+2];const e=(0,d.l)(t.vRight);t.vMinSiblingLength=Math.min(n,e),n=e,(0,d.n)(t.vRight,t.vRight)}else(0,d.c)(t.vRight,t.vLeft),t.vMinSiblingLength=n;s=t,r+=3}}}class ms{constructor(e,t,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.path=e,this.profile=t,this.extruder=r,this.startCap=i,this.endCap=n,this.options=s,this._extrusionVertexCount=0;const o=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*o+2,this.numVerticesTotal=t.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const a=this.startCap.numVertices;this.numVerticesTotal+=a,this.endCap.vertexBufferStart=this.numVerticesTotal;const l=this.endCap.numVertices;this.numVerticesTotal+=l,this.pathVertexData=(0,U.JH)(1*this.numVerticesTotal),this.profileRightAxes=(0,lr.oe)(4*this.numVerticesTotal),this.profileUpAxes=(0,lr.oe)(4*this.numVerticesTotal),this.profileVertexAndNormals=(0,lr.oe)(4*this.numVerticesTotal),this.positions=(0,lr.AK)(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return(0,Zi.Ek)(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(e,t,r,i,n){const s=4*this._extrusionVertexCount;if(this.profileRightAxes[s]=t.right[0],this.profileRightAxes[s+1]=t.right[1],this.profileRightAxes[s+2]=t.right[2],this.profileUpAxes[s]=t.up[0],this.profileUpAxes[s+1]=t.up[1],this.profileUpAxes[s+2]=t.up[2],this.profileVertexAndNormals[s]=r[0],this.profileVertexAndNormals[s+1]=r[1],this.profileVertexAndNormals[s+2]=i[0],this.profileVertexAndNormals[s+3]=i[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const t=this.path.vertices[e],r=t.maxStretchDistance;this.profileRightAxes[s+3]=t.rotationRight[0]*r,this.profileUpAxes[s+3]=t.rotationRight[1]*r}else this.profileRightAxes[s+3]=0,this.profileUpAxes[s+3]=0;++this._extrusionVertexCount}emitCapVertex(e,t,r,i,n,s){const o=4*this._extrusionVertexCount;this.profileRightAxes[o]=t.right[0],this.profileRightAxes[o+1]=t.right[1],this.profileRightAxes[o+2]=t.right[2],this.profileRightAxes[o+3]=n,this.profileUpAxes[o]=t.up[0],this.profileUpAxes[o+1]=t.up[1],this.profileUpAxes[o+2]=t.up[2],this.profileUpAxes[o+3]=s,this.profileVertexAndNormals[o]=r[0],this.profileVertexAndNormals[o+1]=r[1],this.profileVertexAndNormals[o+2]=i[0],this.profileVertexAndNormals[o+3]=i[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:t,vertices:r}=this.path;this.positions=(0,lr.AK)(e,t,3*r.length);let i=0;const n=(e,t,r,n,s)=>this.emitCapVertex(i,e,t,r,n,s),s=(e,t,r,n)=>this.emitVertex(i,e,t,r,n);for(this.startCap.rebuildConnectingProfileGeometry(r[i],this.profile,n),i=1;i<r.length-1;++i)this.extruder.extrude(r[i],this.profile,s);this.endCap.rebuildConnectingProfileGeometry(r[i],this.profile,n),i=0,this.startCap.rebuildCapGeometry(r[i],n),i=r.length-1,this.endCap.rebuildCapGeometry(r[i],n)}buildTopology(){const e=this.profile.vertices.length,t=this.profile.numSegments,r=this.numExtrusionProfiles-1;let i=t*r*2*3;this.startCap.indexBufferStart=i,this.startCap.firstProfileVertexIndex=0,i+=this.startCap.numIndices,this.endCap.indexBufferStart=i,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,s=new Array,o=new Array,a=(e,t,r)=>{n.push(e),n.push(t),n.push(r),s.push(e),s.push(t),s.push(r),o.push(this.pathVertexData[e]),o.push(this.pathVertexData[t]),o.push(this.pathVertexData[r])};for(let l=0;l<t;++l){const t=this.profile.indices[2*l],i=this.profile.indices[2*l+1];for(let n=0;n<r;++n){const r=n*e+t,s=(n+1)*e+i,o=n*e+i;a(r,(n+1)*e+t,s),a(r,s,o)}}this.startCap.buildTopology(this.path.vertices[0],a),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],a),this.vertexIndices=(0,U.Dg)(n),this.normalIndices=(0,U.Dg)(s),this.pathVertexIndices=(0,U.Dg)(o)}onPathChanged(){this._rebuildGeometry()}}class gs{rebuildConnectingProfileGeometry(e,t,r){for(let i=0;i<t.vertices.length;++i)r(e.frame,t.vertices[i],t.normals[i],0,0)}}class ys extends gs{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}}class _s extends gs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.profile=e,this.profilePlaneOffset=t,this.flip=r}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,t,r){const i=this.profilePlaneOffset;for(let n=0;n<t.vertices.length;++n)r(e.frame,t.vertices[n],t.normals[n],i,0)}rebuildCapGeometry(e,t){const r=this.profile,i=this.flip?1:-1,n=this.profilePlaneOffset,s=ws;(0,u.hZ)(s,0,0);for(let o=0;o<r.vertices.length;++o)t(e.frame,r.vertices[o],s,n,i)}buildTopology(e,t){const r=this.profile,i=this.vertexBufferStart+r.indices[0];for(let n=1;n<r.numSegments;++n){const e=r.indices[2*n],s=r.indices[2*n+1],o=this.vertexBufferStart+e,a=this.vertexBufferStart+s;this.flip?t(a,o,i):t(i,o,a)}}}class vs extends gs{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const t=this.profile;e+=2*t.numSegments*(this.numSegments-1);for(let r=0;r<t.numSegments;++r){const i=t.indices[2*r],n=t.indices[2*r+1];t.poleIndices[i]===t.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,t){const r=this.profile,i=e.frame,n=.5*this.sign,s=bs,o=ws;(0,u.hZ)(o,0,0);for(const a of r.poles)a.normal?t(i,a.position,a.normal,n,0):t(i,a.position,o,n,this.sign);if(this.breakNormals)for(let a=0;a<r.vertices.length;++a)t(i,r.vertices[a],r.normals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const e=(1-(a+1)/this.numSegments)*Math.PI*.5,l=Math.sin(e),c=Math.cos(e);for(let a=0;a<r.vertices.length;++a){const e=r.poles[r.poleIndices[a]];(0,u.Re)(s,r.vertices[a],e.position),(0,u.hs)(s,s,l),e.normal?((0,u.WQ)(s,s,e.position),t(i,s,e.normal,n*c,0)):((0,u.S8)(o,s),(0,u.hs)(o,o,l),(0,u.WQ)(s,s,e.position),t(i,s,o,n*c,this.sign*c))}}}buildTopology(e,t){const r=this.profile,i=this.breakNormals?this.vertexBufferStart+r.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+r.poles.length+r.vertices.length:this.vertexBufferStart+r.poles.length;for(let s=0;s<r.numSegments;++s){const e=r.indices[2*s],o=r.indices[2*s+1],a=this.vertexBufferStart+r.poleIndices[e],l=this.vertexBufferStart+r.poleIndices[o];let c=i+e,u=i+o;for(let i=0;i<this.numSegments-1;++i){const s=n+i*r.vertices.length+e,a=n+i*r.vertices.length+o;this.flip?(t(s,u,c),t(u,s,a)):(t(c,u,s),t(a,s,u)),c=s,u=a}this.flip?(t(a,u,c),a!==l&&t(a,l,u)):(t(c,u,a),a!==l&&t(u,l,a))}}}const bs=(0,h.vt)(),ws=(0,h.vt)();class xs{numProfilesPerJoin(){return 1}extrude(e,t,r){for(let i=0;i<t.vertices.length;++i)r(e.frame,t.vertices[i],t.normals[i],!1)}}class Ss{constructor(e,t){this.cutoffAngle=e,this.numBendSubdivisions=t}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,t,r){const i=Es,{rotationAngle:n,rotationRight:s,frame:o}=e;if(Math.abs(n)>=this.cutoffAngle){const a=e.rotationFrameUp;for(let l=0;l<this.numBendSubdivisions+1;++l){(0,D.$0)(Cs,.5*-n+l*n/this.numBendSubdivisions,a),Ms(i,o,Cs);for(let a=0;a<t.vertices.length;++a)(0,u.Om)(t.vertices[a],s)*n>=0?r(i,t.vertices[a],t.normals[a],!1):r(o,e.applyMiterStretch(As,t.vertices[a]),t.normals[a],!0)}}else for(let a=0;a<this.numBendSubdivisions+1;++a)for(let i=0;i<t.vertices.length;++i){const a=(0,u.Om)(t.vertices[i],s)*n>=0;r(o,e.applyMiterStretch(As,t.vertices[i]),t.normals[i],!a)}}}class Ts{constructor(){this.up=(0,p.vt)(),this.right=(0,p.vt)()}}function Ms(e,t,r){(0,d.h)(e.up,t.up,r),(0,d.h)(e.right,t.right,r)}const As=(0,h.vt)(),Cs=(0,F.vt)(),Es=new Ts;class Rs extends K.V{constructor(e,t,r,i,n,s){super(e,t,null,J.X.Mesh,s),this.path=r,this.geometrySR=i,this.stencilWidth=n}}var Ps;function Os(e){return"path"in e}!function(e){e[e.World=0]="World",e[e.Path=1]="Path"}(Ps||(Ps={}));var Is=r(48168);class Ls{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}}class Ns extends Ls{constructor(e){super(e),this.vertexAttributeColor=(0,ot.fA)(255,255,255,255),this.size=new Array,this.vertexAttributePosition=(0,lr.oe)(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:t,pathVertexData:r,path:i,positions:n,profileRightAxes:s,profileUpAxes:o,profileVertexAndNormals:a}=this.builder;for(let l=0;l<t;++l){let t=r[l];const c=0===t||t===i.vertices.length-1;t*=3;const h=Vs;let p=0,f=0;const m=4*l,g=(0,d.s)(Bs,s[m],s[m+1],s[m+2]),y=(0,d.s)(js,o[m],o[m+1],o[m+2]),_=(0,u.hZ)(Fs,a[m]*e[0],a[m+1]*e[1]);if(c)(0,d.b)(h,y,g),p=s[m+3]*e[0],f=o[m+3];else{const e=ks,t=zs;(0,u.hZ)(e,s[m+3],o[m+3]);const r=(0,u.Bw)(e);(0,u.S8)(e,e);const i=(0,u.Om)(_,e);if(Math.abs(i)>r){(0,u.hZ)(t,-e[1],e[0]);const n=(0,u.Om)(_,t);(0,u.hs)(e,e,r*Math.sign(i)),(0,u.hs)(t,t,n),(0,u.WQ)(_,e,t)}(0,d.s)(h,0,0,0)}const v=(0,d.s)(Us,g[0]*_[0]+y[0]*_[1],g[1]*_[0]+y[1]*_[1],g[2]*_[0]+y[2]*_[1]),b=3*l;this.vertexAttributePosition[b]=n[t]+v[0]+h[0]*p,this.vertexAttributePosition[b+1]=n[t+1]+v[1]+h[1]*p,this.vertexAttributePosition[b+2]=n[t+2]+v[2]+h[2]*p;const w=(0,u.hZ)(Fs,a[m+2],a[m+3]);(0,Te.aT)(this.vertexAttributeNormal,l,g[0]*w[0]+y[0]*w[1]+h[0]*f,g[1]*w[0]+y[1]*w[1]+h[1]*f,g[2]*w[0]+y[2]*w[1]+h[2]*f)}}createGeometryData(){const e=this.builder.vertexIndices.length,{normalIndices:t,vertexIndices:r}=this.builder;return[[Q.r.POSITION,new X.n(this.vertexAttributePosition,r,3,!0)],[Q.r.NORMALCOMPRESSED,new X.n(this.vertexAttributeNormal,t,2,!0)],[Q.r.COLOR,new X.n(this.vertexAttributeColor,(0,U.EH)(e),4)]]}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,t,r,i){const n=this.builder.vertexIndices,s=new X.K(this.vertexAttributePosition,3),o=n.length/3;(0,Is.Z$)(e,t,0,o,n,s,void 0,r,((e,t,r)=>{i(e,r,t,!1)}))}}class Ds extends Ls{constructor(e,t,r,i){super(e),this.sizeAttributeValue=t,this.colorAttributeValue=r,this.opacityAttributeValue=i,this.vvData=null,this.baked=new Ns(e),this.vvData=(0,lr.oe)(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n]=t,this.vvData[4*n+1]=r,this.vvData[4*n+2]=i;const e=0===n||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=e?1:0}}createGeometryData(){const{positions:e,profileRightAxes:t,profileUpAxes:r,profileVertexAndNormals:i,pathVertexIndices:n,vertexIndices:s}=this.builder;return[[Q.r.POSITION,new X.n(e,n,3,!0)],[Q.r.PROFILERIGHT,new X.n(t,s,4,!0)],[Q.r.PROFILEUP,new X.n(r,s,4,!0)],[Q.r.PROFILEVERTEXANDNORMAL,new X.n(i,s,4,!0)],[Q.r.FEATUREVALUE,new X.n(this.vvData,n,4,!0)]]}onPathChanged(e){super.onPathChanged(e);const t=e.getMutableAttribute(Q.r.POSITION);t&&(t.data=this.builder.positions)}}const Fs=(0,h.vt)(),ks=(0,h.vt)(),zs=(0,h.vt)(),Us=(0,p.vt)(),Vs=(0,p.vt)(),Bs=(0,p.vt)(),js=(0,p.vt)();var Hs=r(95925);const Gs=(0,p.vt)();class Zs{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,t){return this.vertices.push((0,h.o8)(e)),this.normals.push((0,h.o8)(t)),this.vertices.length-1}addPole(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.poles.push({position:(0,h.o8)(e),normal:t?(0,h.o8)(t):null}),this.poles.length-1}addSegment(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.indices.push(e.v0),this.indices.push(e.v1),t&&(this.poleIndices.push(t.v0),this.poleIndices.push(t.v1))}get numSegments(){return this.indices.length/2}translate(e,t){for(const r of this.vertices)r[0]+=e,r[1]+=t;for(const r of this.poles)r.position[0]+=e,r.position[1]+=t}get usedMemory(){return this.vertices.length*(0,Zi.Ek)(this.vertices[0])*2+(0,Zi.Ek)(this.indices)}}const $s={top:[0,-.5],bottom:[0,.5]};function qs(e){const t=ps.ZC,r=new Zs,i={v0:0,v1:0};r.addPole((0,h.fA)(0,0));for(let s=0;s<t;++s){const e=2*s*Math.PI/t,i=Math.cos(e),n=Math.sin(e),o=(0,h.fA)(.5*i,.5*n),a=(0,h.fA)(i,n);r.addVertex(o,a)}for(let s=0;s<t-1;++s){const e={v0:s,v1:s+1};r.addSegment(e,i)}const n={v0:t-1,v1:0};if(r.addSegment(n,i),"center"!==e){const t=$s[e];r.translate(t[0],t[1])}return r}const Ws={center:qs("center"),top:qs("top"),bottom:qs("bottom")},Ys={center:Xs("center"),top:Xs("top"),bottom:Xs("bottom")};function Xs(e){const t=new Zs,r=(0,h.fA)(-.5,-.5),i=(0,h.fA)(.5,-.5),n=(0,h.fA)(.5,.5),s=(0,h.fA)(-.5,.5),o=(0,h.fA)(0,-1),a=(0,h.fA)(1,0),l=(0,h.fA)(0,1),c=(0,h.fA)(-1,0);if(t.addPole((0,h.fA)(0,.5),l),t.addPole((0,h.fA)(0,.5)),t.addPole((0,h.fA)(0,-.5)),t.addPole((0,h.fA)(0,-.5),o),t.addVertex(r,o),t.addVertex(i,o),t.addSegment({v0:0,v1:1},{v0:3,v1:3}),t.addVertex(i,a),t.addVertex(n,a),t.addSegment({v0:2,v1:3},{v0:2,v1:1}),t.addVertex(n,l),t.addVertex(s,l),t.addSegment({v0:4,v1:5},{v0:0,v1:0}),t.addVertex(s,c),t.addVertex(r,c),t.addSegment({v0:6,v1:7},{v0:1,v1:2}),"center"!==e){const r=$s[e];t.translate(r[0],r[1])}return t}var Js=r(53494);function Ks(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function Qs(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*a+s*l,e[1]=n*a+o*l,e[2]=i*c+s*u,e[3]=n*c+o*u,e}function eo(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}const to=Qs,ro=eo;Object.freeze(Object.defineProperty({__proto__:null,LDU:function(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},adjoint:function(e,t){const r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},equals:function(e,t){const r=e[0],i=e[1],n=e[2],s=e[3],o=t[0],a=t[1],l=t[2],c=t[3],u=(0,Js.FD)();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)},fromRotation:function(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},invert:function(e,t){const r=t[0],i=t[1],n=t[2],s=t[3];let o=r*s-n*i;return o?(o=1/o,e[0]=s*o,e[1]=-i*o,e[2]=-n*o,e[3]=r*o,e):null},mul:to,multiply:Qs,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},rotate:function(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+s*a,e[1]=n*l+o*a,e[2]=i*-a+s*l,e[3]=n*-a+o*l,e},scale:function(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=r[0],l=r[1];return e[0]=i*a,e[1]=n*a,e[2]=s*l,e[3]=o*l,e},set:Ks,str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},sub:ro,subtract:eo,transpose:function(e,t){if(e===t){const r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}},Symbol.toStringTag,{value:"Module"}));function io(){return[1,0,0,1]}Object.freeze(Object.defineProperty({__proto__:null,clone:function(e){return[e[0],e[1],e[2],e[3]]},create:io,createView:function(e,t){return new Float64Array(e,t,4)},fromValues:function(e,t,r,i){return[e,t,r,i]}},Symbol.toStringTag,{value:"Module"}));class no{constructor(){this.vLeft=(0,p.vt)(),this.vRight=(0,p.vt)(),this.vMinSiblingLength=0,this.frame=new Ts}setFrameFromUpVector(e){(0,d.c)(this.frame.up,e),(0,d.g)(yo,this.vLeft,this.vRight),(0,d.n)(yo,yo),(0,d.j)(go,this.frame.up,(0,d.m)(yo,this.frame.up)),(0,d.f)(_o,yo,go),(0,d.n)(_o,_o),(0,d.b)(this.frame.right,_o,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}}class so extends no{get rotationFrameUp(){return this.frame.up}get rotationRight(){return h.Cw}get rotationAngle(){return(0,d.j)(fo,this.frame.up,(0,d.m)(this.frame.up,this.vLeft)),(0,d.f)(fo,this.vLeft,fo),(0,d.k)(fo,fo),(0,d.n)(fo,fo),(0,d.j)(mo,this.frame.up,(0,d.m)(this.frame.up,this.vRight)),(0,d.f)(mo,this.vRight,mo),(0,d.n)(mo,mo),(0,d.b)(po,this.rotationFrameUp,this.vLeft),Math.sign((0,d.m)(po,this.vRight))*(Math.PI-(0,sr.XM)((0,d.m)(fo,mo)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,t){const r=this.rotationAngle;if(Math.abs(r)<=0)return t;const i=(0,sr.J_)(Math.cos(.5*r));return(0,u.hZ)(e,(i-1+1)*t[0],t[1])}}class oo extends no{get rotationFrameUp(){const e=Math.sign((0,d.m)(this.frame.right,this.vRight));return(0,d.b)(lo,this.vRight,this.vLeft),(0,d.j)(lo,lo,e),(0,d.n)(lo,lo)}get rotationRight(){const e=this.rotationFrameUp,t=(0,d.m)(e,this.frame.up),r=(0,d.m)(e,this.frame.right);return(0,d.j)(uo,this.frame.up,-r),(0,d.j)(ho,this.frame.right,t),(0,d.g)(uo,uo,ho),(0,d.n)(uo,uo),function(e,t,r){(0,u.hZ)(e,(0,d.m)(r,t.right),(0,d.m)(r,t.up))}(co,this.frame,uo),co}get rotationAngle(){const e=Math.sign((0,d.m)(this.frame.right,this.vRight));return(0,d.k)(po,this.vLeft),-e*(Math.PI-(0,sr.XM)((0,d.m)(po,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*(0,sr.J_)(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,t){const r=this.rotationAngle;if(0===Math.abs(r))return t;const i=(0,sr.J_)(Math.cos(.5*r)),n=this.rotationRight,s=Ks(vo,1+(i-1)*n[0]*n[0],(i-1)*n[0]*n[1],(i-1)*n[0]*n[1],1+(i-1)*n[1]*n[1]);return(0,u.ZF)(e,t,s)}}function ao(e){switch(e){case Ps.World:return new so;case Ps.Path:return new oo}}const lo=(0,p.vt)(),co=(0,h.vt)(),uo=(0,p.vt)(),ho=(0,p.vt)(),po=(0,p.vt)(),fo=(0,p.vt)(),mo=(0,p.vt)(),go=(0,p.vt)(),yo=(0,p.vt)(),_o=(0,p.vt)(),vo=[1,0,0,1];var bo=r(27920),wo=r(85887),xo=r(26719),So=r(60322),To=r(10773),Mo=r(91116);const Ao=new Map([[Q.r.POSITION,0],[Q.r.PROFILERIGHT,1],[Q.r.PROFILEUP,2],[Q.r.PROFILEVERTEXANDNORMAL,3],[Q.r.FEATUREVALUE,4],[Q.r.OBJECTANDLAYERIDCOLOR,5]]);class Co extends wo.W{constructor(){super(...arguments),this.ambient=(0,p.fA)(.2,.2,.2),this.diffuse=(0,p.fA)(.8,.8,.8),this.specular=(0,p.fA)(0,0,0),this.opacity=1,this.origin=(0,p.vt)(),this.modelTransformation=null}}class Eo extends jr.w{initializeConfiguration(e,t){t.spherical=e.viewingMode===H.RT.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Gr.B(e.rctx,Eo.shader.get().build(this.configuration),Ao)}initializePipeline(){const e=this.configuration.transparencyPassType,t=this.configuration,r=e===To.y.NONE,i=e===To.y.FrontFace;return(0,Wr.Ey)({blending:t.output===Nr.V.Color&&t.transparent?r?So.V0:(0,So.ez)(e):null,culling:t.hasSlicePlane&&!t.transparent&&t.doubleSidedMode!==bo.W.None?Wr.hG:null,depthTest:{func:(0,So.K_)(e)},depthWrite:r||i?Wr.kn:null,drawBuffers:t.output===Nr.V.Depth?{buffers:[qr.Hr.NONE]}:(0,So.cl)(e),colorWrite:Wr.wE,stencilWrite:t.hasOccludees?Zr.v0:null,stencilTest:t.hasOccludees?Zr.qh:null,polygonOffset:r||i?null:So.SE})}}Eo.shader=new Br.$(Mo.P,(()=>r.e(438).then(r.bind(r,10438))));class Ro extends Kr.E{constructor(){super(...arguments),this.output=Nr.V.Color,this.doubleSidedMode=bo.W.None,this.transparencyPassType=To.y.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1,this.objectAndLayerIdColorInstanced=!1}}(0,Xr._)([(0,Jr.W)({count:Nr.V.COUNT})],Ro.prototype,"output",void 0),(0,Xr._)([(0,Jr.W)({count:bo.W.COUNT})],Ro.prototype,"doubleSidedMode",void 0),(0,Xr._)([(0,Jr.W)({count:To.y.COUNT})],Ro.prototype,"transparencyPassType",void 0),(0,Xr._)([(0,Jr.W)()],Ro.prototype,"spherical",void 0),(0,Xr._)([(0,Jr.W)()],Ro.prototype,"receiveShadows",void 0),(0,Xr._)([(0,Jr.W)()],Ro.prototype,"receiveAmbientOcclusion",void 0),(0,Xr._)([(0,Jr.W)()],Ro.prototype,"vvSize",void 0),(0,Xr._)([(0,Jr.W)()],Ro.prototype,"vvColor",void 0),(0,Xr._)([(0,Jr.W)()],Ro.prototype,"vvOpacity",void 0),(0,Xr._)([(0,Jr.W)()],Ro.prototype,"hasSlicePlane",void 0),(0,Xr._)([(0,Jr.W)()],Ro.prototype,"transparent",void 0),(0,Xr._)([(0,Jr.W)()],Ro.prototype,"hasOccludees",void 0),(0,Xr._)([(0,Jr.W)()],Ro.prototype,"multipassEnabled",void 0),(0,Xr._)([(0,Jr.W)()],Ro.prototype,"cullAboveGround",void 0),(0,Xr._)([(0,Jr.W)()],Ro.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,Xr._)([(0,Jr.W)({constValue:!1})],Ro.prototype,"occlusionPass",void 0),(0,Xr._)([(0,Jr.W)({constValue:xo.A9.Disabled})],Ro.prototype,"pbrMode",void 0),(0,Xr._)([(0,Jr.W)({constValue:!0})],Ro.prototype,"hasVvInstancing",void 0),(0,Xr._)([(0,Jr.W)({constValue:!1})],Ro.prototype,"useCustomDTRExponentForWater",void 0),(0,Xr._)([(0,Jr.W)({constValue:!1})],Ro.prototype,"useFillLights",void 0),(0,Xr._)([(0,Jr.W)({constValue:!1})],Ro.prototype,"hasColorTexture",void 0);class Po extends Fr.im{constructor(e){super(e,new Lo),this.supportsEdges=!0,this.produces=new Map([[kr.N.OPAQUE_MATERIAL,e=>(this.parameters.castShadows&&(0,Nr.PJ)(e)||(0,Nr.XY)(e))&&!this.parameters.transparent],[kr.N.TRANSPARENT_MATERIAL,e=>(this.parameters.castShadows&&(0,Nr.PJ)(e)||(0,Nr.XY)(e))&&this.parameters.transparent]]),this._vertexAttributeLocations=Ao,this._configuration=new Ro,this._vertexBufferLayout=Po.getVertexBufferLayout()}getConfiguration(e,t){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e===Nr.V.Color&&(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?bo.W.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?bo.W.WindingOrder:bo.W.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=null!=t.ssao),this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==Nr.V.Shadow&&e!==Nr.V.ShadowExcludeHighlight&&e!==Nr.V.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,t,r,i,n,s){const o=e;if(!Os(o))return;const a=o.path,l=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:e,factor:t,minSize:r,maxSize:i}=this.parameters.vvSize,n=a.sizeAttributeValue;l[0]*=(0,sr.qE)(e[0]+n*t[0],r[0],i[0]),l[1]*=(0,sr.qE)(e[2]+n*t[2],r[2],i[2])}const c=new Is.JG(!1,r.options.normalRequired),u=Math.max(l[0],l[1]),h=e.boundingInfo;if(null==h)return void Io(a,l,i,n,c,s);const d=(0,g.fA)(h.bbMin[0]-u,h.bbMin[1]-u,h.bbMin[2]-u,h.bbMax[0]+u,h.bbMax[1]+u,h.bbMax[2]+u),p=[n[0]-i[0],n[1]-i[1],n[2]-i[2]],f=Math.sqrt(p[0]*p[0]+p[1]*p[1]+p[2]*p[2]),m=[f/p[0],f/p[1],f/p[2]];(0,Is.Wb)(d,i,m,r.tolerance)&&Io(a,l,i,n,c,s)}createBufferWriter(){return new Ur.Z(this._vertexBufferLayout)}createGLMaterial(e){return new Oo(e)}static getVertexBufferLayout(){const e=(0,fn.BP)().vec3f(Q.r.POSITION).vec4f(Q.r.PROFILERIGHT).vec4f(Q.r.PROFILEUP).vec4f(Q.r.PROFILEVERTEXANDNORMAL).vec4f(Q.r.FEATUREVALUE);return(0,s.A)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(Q.r.OBJECTANDLAYERIDCOLOR),e}}class Oo extends Dr.A{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){null!=this.technique&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output===Nr.V.Color&&(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(Eo,e)}}function Io(e,t,r,i,n,s){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(r,i,n,s)}class Lo extends Co{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}const No=["polyline"];class Do extends Z.U{constructor(e,t,r,i){super(e,t,r,i),this._intrinsicSize=(0,h.fA)(1,1),this._upVectorAlignment=Ps.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){const e=null!=this.symbolLayer.width?this.symbolLayer.width:this.symbolLayer.height,t=null!=this.symbolLayer.height?this.symbolLayer.height:e;this._vvConvertOptions=new At.wI({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,t],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=this._context.renderer?.visualVariables?.length>0?(0,At.s_)(this._context.renderer,this._vvConvertOptions):null;const r=this.symbolLayer.anchor||"center";this._upVectorAlignment="heading"===this.symbolLayer.profileRotation?Ps.World:Ps.Path;const i=this.symbolLayer.profile||"circle";switch(i){default:case"circle":this._profile=Ws[r];break;case"quad":this._profile=Ys[r]}switch(this.symbolLayer.join){case"round":this._extruder=new Ss(0,ps.kf);break;case"bevel":this._extruder=new Ss(0,1);break;case"miter":this._extruder=new Ss(.8*Math.PI,1);break;default:this._extruder=new xs}const n=this.symbolLayer.cap||"butt";switch(n){case"none":this._startCap=new ys,this._endCap=new ys;break;case"butt":default:this._startCap=new _s(this._profile,0),this._endCap=new _s(this._profile,0,!0);break;case"square":this._startCap=new _s(this._profile,-.5),this._endCap=new _s(this._profile,.5,!0);break;case"round":{const e="quad"===i;this._startCap=new vs({profile:this._profile,flip:!1,breakNormals:e,subdivisions:ps.RL}),this._endCap=new vs({profile:this._profile,flip:!0,breakNormals:e,subdivisions:ps.RL});break}}const s=this.symbolLayer?.material?.color,o=this._getCombinedOpacityAndColor(s),a=(0,p.ci)(o),l=o[3],c=l<1||this.needsDrivenTransparentPass,d={diffuse:a,ambient:a,opacity:l,transparent:c,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:c||"none"===n?xe.s2.None:xe.s2.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&((0,u.hZ)(this._intrinsicSize,e,t),!(0,$.Mh)(this._intrinsicSize[0])||!(0,$.Mh)(this._intrinsicSize[1])))throw new R.A("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates?.visualVariables.size||(0,u.hs)(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const e={...d,...this._fastUpdates.materialParameters,size:(0,h.ci)(this._intrinsicSize)};this._materials[0]=new Po(e)}else d.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,d.normalType=we.W.Compressed,this._materials[0]=new Ae.$U(d);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,No,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t),i=e.renderingInfo;return this._createAs3DShape(t,i,r,t.uid)}layerOpacityChanged(){const e=this.symbolLayer?.material?.color,t=this._getCombinedOpacity(e),r=t<1||this.needsDrivenTransparentPass;this._materials[0]?.setParameters({opacity:t,transparent:r})}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,G.Kf)}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._materials[0]?.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return q.w.RecreateSymbol;if(!(0,At.J_)(this._fastUpdates,t,this._vvConvertOptions))return q.w.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return q.w.FastUpdate}_getVertexData(e){let t=0;const r=e.paths,i=[],n=e.spatialReference,s=this._context.elevationProvider.spatialReference,o=this._context.renderCoordsHelper.spatialReference;for(const u of r)t+=u.length;const a=(0,z.jh)(3*t);let l,c=0;for(const u of r){i.push({offset:c,numVertices:u.length});for(const t of u)a[c++]=t[0],a[c++]=t[1],a[c++]=e.hasZ?t[2]:0}return null==s||n.equals(s)||(0,ce.projectBuffer)(a,n,0,a,s,0,t)?(null==s||s.equals(o)?l=(0,z.xm)(a):(l=(0,z.jh)(3*t),(0,ce.projectBuffer)(a,s,0,l,o,0,t)),{pathVertexDataInfos:i,vertexDataES:a,vertexDataRS:l}):null}_createAs3DShape(e,t,r,i){this.usedMemory=0;const n=e.geometry,s=this._getVertexData(n);if(null==s)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0===s.pathVertexDataInfos.length)return 0!==n.paths.length&&n.paths.some((e=>e.length>0))||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const o=new Array,a=n.spatialReference,l=(0,g.vt)(),c=this._context.renderCoordsHelper,u=new le.aY(s.vertexDataES);for(const f of s.pathVertexDataInfos){const n=f.numVertices;if(n<2)continue;const h=f.offset;if(null!=this._context.clippingExtent&&((0,g.Ie)(l),(0,g.Hq)(l,s.vertexDataES,h,n),!(0,g.KG)(l,this._context.clippingExtent)))continue;const p=new Array,m=h+3*n;for(let e=h;e<m;e+=3){u.offset=e;const t=(0,G.nG)(u,this._context.elevationProvider,r,c);(0,d.s)(Uo,s.vertexDataRS[e],s.vertexDataRS[e+1],s.vertexDataRS[e+2]),c.setAltitude(Uo,t),s.vertexDataRS[e]=Uo[0],s.vertexDataRS[e+1]=Uo[1],s.vertexDataRS[e+2]=Uo[2],p.push(ao(this._upVectorAlignment))}const y=new fs(p,s.vertexDataES,s.vertexDataRS,h);Fo(y,this._upVectorAlignment,this._context.renderCoordsHelper);const _=new ms(y,this._profile,this._extruder,this._startCap,this._endCap);let v=null;if(this._fastUpdates){const t=this._fastUpdates.visualVariables,r=(0,At.ul)(t.size?.field,e)??0,i=(0,At.ul)(t.color?.field,e)??0,n=(0,At.ul)(t.opacity?.field,e)??0;v=new Ds(_,r,i,n)}else{const e=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const r=t.size;e[0]*=ko(r[0],"symbol-value"===r[2]?this.symbolLayer.height||0:r[2],this.symbolLayer.width||0),e[1]*=ko(r[2],"symbol-value"===r[0]?this.symbolLayer.width||0:r[0],this.symbolLayer.height||0)}let r;this._drivenProperties.color&&(r=t.color),this._drivenProperties.opacity&&null!=t.opacity&&(r=r?[r[0],r[1],r[2],t.opacity]:[1,1,1,t.opacity]);const i=new Ns(_);i.bake(e),r&&i.bakeVertexColors(r),v=i}const b=v.createGeometryData(),w=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),x=new Rs(this._materials[0],b,v,a,this._stencilWidth,w);x.transformation=(0,D.Tl)((0,F.vt)(),F.zK,_.path.origin),o.push(x),this.usedMemory+=_.usedMemory}if(0===o.length)return null;const h=new Me.B({geometries:o,layerUid:this._context.layer.uid,graphicUid:i}),p=new A.Y(this,h,o,null,null,((e,t,r,i,n)=>function(e,t,r,i,n){const s=e.stageObject,o=s.geometries;let a=0;for(const l of o){if(!Os(l))continue;const e=l.path,o=e.builder.path;a+=zo(o,t,r,i),n!==Ps.World&&Fo(o,n,i),e.onPathChanged(l),l.invalidateBoundingInfo(),s.geometryVertexAttributeUpdated(l,Q.r.POSITION)}return a/o.length}(e,t,i,n,this._upVectorAlignment)),r);return p.alignedSampledElevation=0,p.needsElevationUpdates=(0,G.Kf)(r.mode),p}}function Fo(e,t,r){const{origin:i,positions:n}=e;let s=e.offset;switch(t){default:case Ps.World:for(const t of e.vertices)Uo[0]=n[s++]+i[0],Uo[1]=n[s++]+i[1],Uo[2]=n[s++]+i[2],r.worldUpAtPosition(Uo,Uo),t.setFrameFromUpVector(Uo);break;case Ps.Path:Uo[0]=n[s]+i[0],Uo[1]=n[s+1]+i[1],Uo[2]=n[s+2]+i[2],r.worldUpAtPosition(Uo,Uo),function(e,t){let r=null;const i=e.vertices.length,n=.99619469809,s=(0,p.vt)(),o=(0,p.vt)(),a=(0,p.vt)(),l=(0,p.vt)(),c=(0,p.vt)(),u=(0,p.vt)(),h=(0,Lr.vt)();let f=e.vertices[0];(0,d.c)(o,t),(0,d.s)(s,0,1,0),(0,Et.Xl)(f.vRight,o,s,s,a,o,n),(0,d.c)(f.frame.up,o),(0,d.c)(f.frame.right,a);const m=e.positions;let g=e.offset;r=f;for(let p=1;p<i;++p){f=e.vertices[p],(0,d.g)(c,f.vLeft,f.vRight);let t=(0,d.l)(c);t>0?(t=1/Math.sqrt(t),c[0]=c[0]*t,c[1]=c[1]*t,c[2]=c[2]*t):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),u[0]=m[g]+r.frame.up[0],u[1]=m[g+1]+r.frame.up[1],u[2]=m[g+2]+r.frame.up[2],g+=3;const i=(0,d.s)(Gs,m[g],m[g+1],m[g+2]);(0,Lr.O_)(i,c,h),(0,Lr.Ui)(h,(0,Hs.LV)(u,f.vLeft),l)?(l[0]-=m[g],l[1]-=m[g+1],l[2]-=m[g+2],(0,d.n)(o,l),(0,d.b)(a,c,o),(0,d.n)(a,a)):(0,Et.Xl)(c,r.frame.up,r.frame.right,s,a,o,n),(0,d.c)(f.frame.up,o),(0,d.c)(f.frame.right,a),r=f}}(e,Uo)}}function ko(e,t,r){switch(e){case"symbol-value":return r;case"proportional":return t;default:return e}}function zo(e,t,r,i){let n=0;const{origin:s,vertices:o,positions:a,positionsES:l}=e,c=e.offset+3*o.length;for(let u=e.offset;u<c;u+=3)(0,d.s)(Uo,l[u],l[u+1],l[u+2]),r(Uo,Vo),n+=Vo.sampledElevation,Uo[0]=a[u]+s[0],Uo[1]=a[u+1]+s[1],Uo[2]=a[u+2]+s[2],i.setAltitude(Uo,Vo.z),a[u]=Uo[0]-s[0],a[u+1]=Uo[1]-s[1],a[u+2]=Uo[2]-s[2];return e.updatePathVertexInformation(),n/o.length}const Uo=(0,p.vt)(),Vo=new G.Uk;var Bo=r(34111),jo=r(482);function Ho(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;(0,d.s)(qo,1,0,0),(0,d.s)(Wo,0,1,0),(0,d.s)(Yo,0,0,1),function(e,t){(0,d.s)(sa,0,0,0);for(let r=0;r<t.length-3;r+=3)sa[0]+=t[r],sa[1]+=t[r+1],sa[2]+=t[r+2];(0,d.j)(e,sa,1/(t.length/3-1))}(Go,r),(0,Lr.ci)($o,r)&&function(e,t,r,i,n,s){null!=n?(n.basisMatrixAtPosition(s,ta),(0,d.s)(ra,ta[0],ta[1],ta[2]),(0,d.s)(ia,ta[4],ta[5],ta[6]),(0,d.s)(na,ta[8],ta[9],ta[10])):((0,d.s)(ra,1,0,0),(0,d.s)(ia,0,1,0),(0,d.s)(na,0,0,1));const o=(0,Lr.Qj)(e);(0,d.m)(o,na)<0&&(0,d.j)(o,o,-1),(0,d.c)(i,o);const a=(0,d.m)(o,ia),l=(0,d.m)(o,ra);Math.abs(a)>Math.abs(l)?((0,d.r)(t,ra,o,-l),(0,d.n)(t,t),(0,d.b)(r,t,o),(0,d.n)(r,r),(0,d.j)(r,r,-1)):((0,d.r)(r,ia,o,-a),(0,d.n)(r,r),(0,d.b)(t,r,o),(0,d.n)(t,t))}($o,qo,Wo,Yo,i,Go),(0,u.hZ)(Xo,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),(0,u.hZ)(Jo,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<r.length;u+=3){(0,d.s)(Zo,r[u],r[u+1],r[u+2]);const e=(0,d.m)(qo,Zo),t=(0,d.m)(Wo,Zo);Xo[0]=Math.min(Xo[0],e),Xo[1]=Math.min(Xo[1],t),Jo[0]=Math.max(Jo[0],e),Jo[1]=Math.max(Jo[1],t)}const s=(0,d.m)(Yo,Go);oa(Ko,Xo[0],Xo[1],s,qo,Wo,Yo),oa(Qo,Jo[0],Xo[1],s,qo,Wo,Yo),oa(ea,Xo[0],Jo[1],s,qo,Wo,Yo),(0,d.f)(Qo,Qo,Ko),(0,d.j)(Qo,Qo,.5),(0,d.f)(ea,ea,Ko),(0,d.j)(ea,ea,.5),(0,d.g)(Ko,Ko,Qo),(0,d.g)(Ko,Ko,ea);const o=Xo[0]%n,a=Xo[1]%n,l=Xo[0]-o,c=Xo[1]-a;for(let u=0;u<r.length;u+=3){(0,d.s)(Zo,r[u],r[u+1],r[u+2]);const i=u/3,s=4*i;e[s]=((0,d.m)(qo,Zo)-l)/n,e[s+1]=((0,d.m)(Wo,Zo)-c)/n,e[s+2]=l/n,e[s+3]=c/n;const o=9*i;for(let e=0;e<3;e++)t[o+e]=Ko[e],t[o+e+3]=Qo[e],t[o+e+6]=ea[e]}}const Go=(0,p.vt)(),Zo=(0,p.vt)(),$o=(0,Lr.vt)(),qo=(0,p.vt)(),Wo=(0,p.vt)(),Yo=(0,p.vt)(),Xo=(0,h.vt)(),Jo=(0,h.vt)(),Ko=(0,p.vt)(),Qo=(0,p.vt)(),ea=(0,p.vt)();const ta=(0,F.vt)(),ra=(0,p.vt)(),ia=(0,p.vt)(),na=(0,p.vt)();const sa=(0,p.vt)();function oa(e,t,r,i,n,s,o){(0,d.s)(e,t*n[0]+r*s[0]+i*o[0],t*n[1]+r*s[1]+i*o[1],t*n[2]+r*s[2]+i*o[2])}var aa=r(76956),la=r(30250),ca=r(63928),ua=r(93684),ha=r(52757),da=r(58071);class pa extends jr.w{initializeProgram(e){return new Gr.B(e.rctx,pa.shader.get().build(this.configuration),(0,s.A)("enable-feature:objectAndLayerId-rendering")?ya:ga)}_setPipelineState(e,t){const r=this.configuration,i=e===To.y.NONE,n=e===To.y.FrontFace;return(0,Wr.Ey)({blending:r.output===Nr.V.Color?i?So.V0:(0,So.ez)(e):null,culling:(0,Wr.Xt)(r.cullFace),depthTest:r.draped?null:{func:(0,So.K_)(e)},depthWrite:r.draped?null:i?Wr.kn:(0,So.XO)(e),drawBuffers:r.output===Nr.V.Depth?{buffers:[qr.Hr.NONE]}:(0,So.cl)(e),colorWrite:Wr.wE,stencilWrite:r.hasOccludees?Zr.v0:null,stencilTest:r.hasOccludees?t?Zr.a9:Zr.qh:null,polygonOffset:i||n?r.polygonOffset?fa:null:(0,So.aB)(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}pa.shader=new Br.$(da.P,(()=>r.e(1109).then(r.bind(r,71109))));const fa={factor:1,units:1};class ma extends Kr.E{constructor(){super(...arguments),this.output=Nr.V.Color,this.cullFace=xe.s2.None,this.transparencyPassType=To.y.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasOccludees=!1,this.enableOffset=!0,this.multipassEnabled=!1,this.cullAboveGround=!1,this.vvColor=!1,this.objectAndLayerIdColorInstanced=!1}}(0,Xr._)([(0,Jr.W)({count:Nr.V.COUNT})],ma.prototype,"output",void 0),(0,Xr._)([(0,Jr.W)({count:xe.s2.COUNT})],ma.prototype,"cullFace",void 0),(0,Xr._)([(0,Jr.W)({count:la.O.COUNT})],ma.prototype,"style",void 0),(0,Xr._)([(0,Jr.W)({count:To.y.COUNT})],ma.prototype,"transparencyPassType",void 0),(0,Xr._)([(0,Jr.W)()],ma.prototype,"hasSlicePlane",void 0),(0,Xr._)([(0,Jr.W)()],ma.prototype,"hasVertexColors",void 0),(0,Xr._)([(0,Jr.W)()],ma.prototype,"polygonOffset",void 0),(0,Xr._)([(0,Jr.W)()],ma.prototype,"hasOccludees",void 0),(0,Xr._)([(0,Jr.W)()],ma.prototype,"patternSpacing",void 0),(0,Xr._)([(0,Jr.W)()],ma.prototype,"lineWidth",void 0),(0,Xr._)([(0,Jr.W)()],ma.prototype,"enableOffset",void 0),(0,Xr._)([(0,Jr.W)()],ma.prototype,"draped",void 0),(0,Xr._)([(0,Jr.W)()],ma.prototype,"multipassEnabled",void 0),(0,Xr._)([(0,Jr.W)()],ma.prototype,"cullAboveGround",void 0),(0,Xr._)([(0,Jr.W)()],ma.prototype,"vvColor",void 0),(0,Xr._)([(0,Jr.W)({constValue:!0})],ma.prototype,"writeDepth",void 0),(0,Xr._)([(0,Jr.W)({constValue:!1})],ma.prototype,"occlusionPass",void 0),(0,Xr._)([(0,Jr.W)({constValue:!1})],ma.prototype,"hasVvInstancing",void 0),(0,Xr._)([(0,Jr.W)({constValue:!1})],ma.prototype,"vvSize",void 0),(0,Xr._)([(0,Jr.W)({constValue:!1})],ma.prototype,"vvOpacity",void 0);const ga=new Map([[Q.r.POSITION,0],[Q.r.COLOR,3],[Q.r.UVMAPSPACE,4],[Q.r.COLORFEATUREATTRIBUTE,5],[Q.r.BOUNDINGRECT,6]]),ya=new Map([[Q.r.POSITION,0],[Q.r.COLOR,3],[Q.r.UVMAPSPACE,4],[Q.r.COLORFEATUREATTRIBUTE,5],[Q.r.BOUNDINGRECT,6],[Q.r.OBJECTANDLAYERIDCOLOR,9]]);class _a extends ca.W{constructor(e){super(e,new xa),this.supportsEdges=!0,this.produces=new Map([[kr.N.OPAQUE_MATERIAL,e=>(0,Nr.u5)(e)],[kr.N.TRANSPARENT_MATERIAL,e=>(0,Nr._o)(e)],[kr.N.TRANSPARENT_NO_SSAO_DEPTH,e=>(0,Nr.eh)(e)&&this.parameters.writeLinearDepth],[kr.N.DRAPED_MATERIAL,e=>this.parameters.draped&&e===Nr.V.Color||(0,Nr.u5)(e)]]),this._vertexAttributeLocations=(0,s.A)("enable-feature:objectAndLayerId-rendering")?ya:ga,this._configuration=new ma}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<So.xt,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}createGLMaterial(e){return new va(e)}createBufferWriter(){const e=(0,fn.BP)().vec3f(Q.r.POSITION).vec4f(Q.r.UVMAPSPACE);return this.parameters.draped||e.mat3f(Q.r.BOUNDINGRECT),this.parameters.vvColor?e.f32(Q.r.COLORFEATUREATTRIBUTE):e.vec4u8(Q.r.COLOR),(0,s.A)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(Q.r.OBJECTANDLAYERIDCOLOR),new ba(e)}}class va extends Dr.A{_updateParameters(e){return this.ensureTechnique(pa,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===Nr.V.Color&&this._updateOccludeeState(e),this._updateParameters(e)}}class ba extends Ur.Z{write(e,t,r,i,n){(0,ha.SA)(r,this.vertexBufferLayout,e,t,i,n);for(const s of this.vertexBufferLayout.fields.keys()){const t=r.attributes.get(s),o=t?.indices;if(t&&o)switch(s){case Q.r.UVMAPSPACE:{(0,zr.vA)(4===t.size);const e=i.getField(s,wn.Eq);e&&(0,ha.Ut)(t,e,n);break}case Q.r.BOUNDINGRECT:{(0,zr.vA)(9===t.size);const r=i.getField(s,wn.jZ);r&&wa(t,e,r,n);break}}}}}function wa(e,t,r,i){const{data:n,indices:s}=e,o=t,a=r.typedBuffer,l=r.typedBufferStride,c=s.length;i*=l;for(let u=0;u<c;++u){const e=9*s[u],t=n[e],r=n[e+1],c=n[e+2];a[i]=o[0]*t+o[4]*r+o[8]*c+o[12],a[i+1]=o[1]*t+o[5]*r+o[9]*c+o[13],a[i+2]=o[2]*t+o[6]*r+o[10]*c+o[14];for(let s=3;s<9;++s)a[i+s]=n[e+s];i+=l}}class xa extends ua.S{constructor(){super(...arguments),this.color=(0,ot.fA)(1,1,1,1),this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=xe.s2.None,this.hasOccludees=!1,this.style=la.O.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function Sa(e,t){const r=e?.pattern??null;return null==r?new aa.v(t):"none"===r.style||"solid"===r.style?("none"===r.style&&(t.color=(0,ot.fA)(0,0,0,0),t.forceTransparentMode=!0),new aa.v(t)):(t.style=function(e){switch(e){case"horizontal":return la.O.Horizontal;case"vertical":return la.O.Vertical;case"cross":return la.O.Cross;case"forward-diagonal":return la.O.ForwardDiagonal;case"backward-diagonal":return la.O.BackwardDiagonal;case"diagonal-cross":return la.O.DiagonalCross;default:return}}(r.style),new _a(t))}function Ta(e,t){if(function(e){return e.material instanceof _a&&!e.material.parameters.draped}(e)){const r=e.attributes.get(Q.r.POSITION).data;Ho(e.getMutableAttribute(Q.r.UVMAPSPACE).data,e.getMutableAttribute(Q.r.BOUNDINGRECT).data,r,t)}}function Ma(e,t,r,i,n){const s=(0,_t.B6)(e,t,r,i,n),o=e.stageObject.geometries;for(const a of o)Ta(a,n);return s}const Aa=["polyline","polygon","extent"],Ca=new At.wI({size:!1,color:!0,rotation:!1,opacity:!1});class Ea extends Z.U{constructor(e,t,r,i){super(e,t,r,i),this._needsUV=!1}async doLoad(){this._fastUpdates=(0,At.s_)(this._context.renderer,Ca)}_createMaterials(){if(this._materials.length>0)return;const e=this.symbolLayer?.material?.color,t=this._getCombinedOpacityAndColor(e);this._materials[Ia.Fill]=Sa(this.symbolLayer,{color:t,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters}),this._needsUV=this._materials[Ia.Fill]instanceof _a;const r=this.symbolLayer.outline;if(function(e){return null!=e?.size&&e.size>0&&null!=e.color&&(null==e.pattern||"style"!==e.pattern.type||"none"!==e.pattern.style)}(r)){const e=(0,Xt.Xq)(r.pattern);this._materials[Ia.Outline]=new Jt.W({width:(0,it.Lz)(r.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:e,cap:Zt(r.patternCap||"butt")})}this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Aa,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),i=this.setGraphicElevationContext(t);return this.ensureDrapedStatus("on-the-ground"===i.mode),this._createMaterials(),this.draped?this._createAsOverlay(t,r):this._createAs3DShape(t,r,i)}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return q.w.RecreateSymbol;if(!(0,At.J_)(this._fastUpdates,t,Ca))return q.w.RecreateSymbol;this._materials[Ia.Fill]?.setParameters(this._fastUpdates.materialParameters)}return q.w.FastUpdate}layerOpacityChanged(){if(null!=this._materials[Ia.Fill]){const e=this._materials[Ia.Fill].parameters.color,t=this.symbolLayer?.material?.color,r=this._getCombinedOpacity(t);this._materials[Ia.Fill].setParameters({color:[e[0],e[1],e[2],r],forceTransparentMode:this.needsDrivenTransparentPass})}if(null!=this._materials[Ia.Outline]){const e=this._materials[Ia.Outline].parameters.color;this._materials[Ia.Outline].setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=(0,G.I2)(Ea.elevationModeChangeTypes,r,i);if(n!==G.uw.UPDATE)return n;const s=(0,G.nu)(i);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>s))}slicePlaneEnabledChanged(){if(this._materials[Ia.Fill]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Ia.Outline]){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[Ia.Outline].setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,t,r){const i=ne(e.geometry);if(!i)return null;const n=de(i,this._context.elevationProvider,this._context.renderCoordsHelper,r),s=new Pa(n,t,this._context.layer.uid,e.uid),o=s.renderData.position.length/3;if(this._needsUV&&(s.uvMapSpace=(0,lr.oe)(4*o,!0),s.boundingRect=(0,z.jh)(9*o,!0),Ho(s.uvMapSpace,s.boundingRect,s.renderData.position,this._context.renderCoordsHelper)),s.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(s),this._createAs3DShapeFill(e,s),this._materials[Ia.Outline]&&this._createAs3DShapeOutline(s),this._logGeometryCreationWarnings(s.renderData,i.rings,"rings","FillSymbol3DLayer"),0===s.outGeometries.length)return null;const a=new Me.B({geometries:s.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),l=new A.Y(this,a,s.outGeometries,null,null,Ma,r);return l.alignedSampledElevation=s.renderData.sampledElevation,l.needsElevationUpdates=(0,G.nu)(r.mode),l}_createAs3DShapeFill(e,t){const r=t.renderData.polygons;for(const{position:i,mapPositions:n,holeIndices:s,index:o,count:a}of r){if(null!=this._context.clippingExtent&&((0,g.Ie)(Ra),(0,g.Hq)(Ra,n),!(0,g.KG)(Ra,this._context.clippingExtent)))continue;const r=te(n,s,this._context.elevationProvider.spatialReference);if(0===r.length)continue;const l=this._fastUpdates?.visualVariables.color,c=re({material:this._materials[Ia.Fill],indices:r,mapPositions:n,attributeData:{position:i,color:l?null:t.color,colorFeature:l?(0,At.ul)(l.field,e):null,uvMapSpace:this._needsUV?(0,lr.AK)(t.uvMapSpace,4*o,4*a):null,boundingRect:this._needsUV?(0,z.l5)(t.boundingRect,9*o,9*a):null,objectAndLayerIdColor:t.objectAndLayerIdColor}});t.outGeometries.push(c)}}_createAs3DShapeOutline(e){if(null==this._materials[Ia.Outline])return;const t=e.renderData.outlines;for(const{mapPositions:r,position:i}of t){if(null!=this._context.clippingExtent&&((0,g.Ie)(Ra),(0,g.Hq)(Ra,r),!(0,g.KG)(Ra,this._context.clippingExtent)))continue;const t=(0,qt.t)(this._materials[Ia.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:r,attributeData:{position:i}},e.objectAndLayerIdColor);e.outGeometries.push(t)}}_createAsOverlay(e,t){const r=ne(e.geometry);if(null==r)return null;this._materials[Ia.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,null!=this._materials[Ia.Outline]&&(this._materials[Ia.Outline].renderPriority=this._renderPriority);const i=pe(r,this._context.overlaySR),n=new Oa(i,t,this._context.layer.uid,e.uid),s=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=(0,lr.oe)(4*s,!0),function(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(r.isGeographic&&i===H.RT.Global){const e=(0,z.jh)(t.length),i=t.length,n=(0,Bo.tO)(r);for(let r=0;r<i;r+=3)(0,jo.RC)(t,r,e,r,n);t=e}(0,u.hZ)(Xo,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<t.length;c+=3)Xo[0]=Math.min(Xo[0],t[c]),Xo[1]=Math.min(Xo[1],t[c+1]);const s=Xo[0]%n,o=Xo[1]%n,a=Xo[0]-s,l=Xo[1]-o;for(let c=0;c<t.length;c+=3){const r=c/3*4;e[r]=(t[c]-a)/n,e[r+1]=(t[c+1]-l)/n,e[r+2]=a/n,e[r+3]=l/n}}(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=(0,g.Ie)(),n.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(n),this._createAsOverlayFill(e,n),this._materials[Ia.Outline]&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,r.rings,"rings","FillSymbol3DLayer"),0===n.outGeometries.length?null:new bt(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,t){const r=t.renderData.polygons;for(const{position:i,holeIndices:n,index:s,count:o}of r){const r=(0,g.Ie)(Ra);if((0,g.Hq)(r,i),!(0,g.KG)(r,this._context.clippingExtent))continue;const a=(0,I.e)(i,n,3);if(0===a.length)continue;(0,g.RF)(t.outBoundingBox,r);const l=this._fastUpdates?.visualVariables.color,c=re({material:this._materials[Ia.Fill],indices:a,attributeData:{position:i,color:l?null:t.color,colorFeature:l?(0,At.ul)(l.field,e):null,uvMapSpace:this._needsUV?(0,lr.AK)(t.uvMapSpace,4*s,4*o):null,objectAndLayerIdColor:t.objectAndLayerIdColor}});t.outGeometries.push(new Rt.$(c,t))}}_createAsOverlayOutline(e){if(null==this._materials[Ia.Outline])return;const t=e.renderData.outlines;for(let r=0;r<t.length;++r){const{position:i}=t[r];if((0,g.Ie)(Ra),(0,g.Hq)(Ra,i),!(0,g.KG)(Ra,this._context.clippingExtent))continue;(0,g.RF)(e.outBoundingBox,Ra);const n=(0,qt.t)(this._materials[Ia.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:i}},e.objectAndLayerIdColor);e.outGeometries.push(new Rt.$(n,e))}}_getOutlineOpacity(){const e=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(null!=e?e.a:0)}_getOutlineColor(){const e=this.symbolLayer?.outline?.color,t=this._getOutlineOpacity();return(0,$.$C)(null!=e?tt.A.toUnitRGB(e):null,t)}test(){return{...super.test(),createAsOverlay:(e,t)=>this._createAsOverlay(e,t),createAs3DShape:(e,t,r)=>this._createAs3DShape(e,t,r)}}}Ea.elevationModeChangeTypes={definedChanged:G.uw.RECREATE,staysOnTheGround:G.uw.NONE,onTheGroundChanged:G.uw.RECREATE};const Ra=(0,g.vt)();class Pa extends se{constructor(e,t,r,i){super(e,r,i),this.color=t}}class Oa extends se{constructor(e,t,r,i){super(e,r,i),this.color=t}}var Ia;!function(e){e[e.Fill=0]="Fill",e[e.Outline=1]="Outline"}(Ia||(Ia={}));var La=r(82041),Na=r(49296),Da=r(28350),Fa=r(70374),ka=r(48190),za=r(70741),Ua=r(39345),Va=r(42510),Ba=r(25175);class ja{constructor(e,t,r){this._renderer=new Va.Js(e,t,r,Ba.C.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=(0,Ua.y)(Ha,this._renderer.renderedWidth,this._renderer.renderedHeight),t=e.getContext("2d");return t.save(),this._renderer.render(t,0,0),t.restore(),new Pt.g(e,{wrap:{s:qr.pF.CLAMP_TO_EDGE,t:qr.pF.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}}const Ha={canvas:null},Ga=(0,p.fA)(0,0,1);class Za extends Z.U{constructor(e,t,r,i){super(e,t,r,i),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=(0,$.Hj)(this.symbolLayer.size);if(e)throw new R.A("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await za.G.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const t=e.graphic,r=(0,Mt.ZX)(t.geometry);if(null==r)return this.logger.warn(`unsupported geometry type for text symbol: ${t.geometry.type}`),null;const i=this.symbolLayer.text;if(null==i||""===i)return null;const n=(0,La.YX)(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(null!=n&&!(0,La.Ie)(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:s}=this.symbolLayer,o=new Fa.A(n);(0,Tt.xU)(s,o.screenOffset);const a=new Fa.J(o,this.symbolLayer.horizontalAlignment,(0,Tt.RH)(s));return this._createAs3DShape(t,r,i,a)}createLabel(e,t,r,i,n){const s=e.graphic,o=(0,Mt.ZX)(s.geometry);if(null==o)return this.logger.warn(`unsupported geometry type for label: ${s.geometry.type}`),null;const a=t.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(s,o,a,t,r,i,n)}setGraphicElevationContext(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return super.setGraphicElevationContext(e,t),t.addOffsetRenderUnits(r),t}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,t){return $a(e,t,((e,t)=>{this.updateGraphicElevationContext(t,e)})),G.uw.UPDATE}slicePlaneEnabledChanged(e,t){return $a(e,t,(e=>{for(const t of e.stageObject.geometries)t.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,t){const r=t.elevationContext;this.setGraphicElevationContext(e,r,null!=t.metadata?t.metadata.elevationOffset:0),t.needsElevationUpdates=(0,G.nu)(r.mode)||"absolute-height"===r.mode}updateGeometry(e,t){if(this.draped||!this._validateGeometry(t))return!1;const{elevationContext:r,stageObject:i}=e;if(r.mode!==this.getGeometryElevationMode(t))return!1;const n=(0,Mt.ZX)(t);if(!n)return!1;const s=(0,Mt.hS)(i,this._context,n,r);if(null==s)return!1;const o=(0,Mt.R$)(this._context,n);return i.geometries[0].localOrigin===o&&(e.alignedSampledElevation=s,(0,Mt.d2)(e,n,this._context.elevationProvider),!0)}_defaultElevationInfoNoZ(){return qa}_createAs3DShape(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>i.placement.elevationOffset;const c=this.setGraphicElevationContext(e,new Na.F,i.placement.elevationOffset),u="polyline"===e.geometry?.type,d=e.uid;let p=null,f=null;if(null==a){const e=(0,Tt.QE)(i.horizontalPlacement);p=new ja(r,e,this._textRenderParameters);let t=null;if(null!=this._context.sharedResources.textures){f=this._context.sharedResources.textures.fromData(p.key,(()=>p.create())),f.texture.events.on("unloaded",(()=>t=(0,rt.Gz)(t)));const e=this._context.stage.renderView.textures.acquire(f.texture.id);if(null==e||(0,o.$X)(e))return f.release(),null;t=e}}const m=function(e,t){if("baseline"===t.verticalPlacement){const r=Tt.cN[t.horizontalPlacement],i=null!=e?e.baselineAnchorY:0;return(0,h.fA)(r,i)}const r=(0,Tt.Ir)(t.horizontalPlacement,t.verticalPlacement);return Tt.Zd[r]}(p,i),g={occlusionTest:!(0,s.A)("enable-feature:non-occluded-hud"),screenOffset:i.placement.screenOffset,anchorPosition:m,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:i.placement.centerOffsetUnits,drawInSecondSlot:!0};if(u&&(g.shaderPolygonOffset=1e-4),a?g.textureId=a.id:f&&(g.textureId=f.texture.id),null!=i.placement.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=i.placement.verticalOffset;g.verticalOffset={screenLength:(0,it.Lz)(e),minWorldLength:t||0,maxWorldLength:null!=r?r:1/0}}const y={screenOffset:g.screenOffset,anchorPosition:m,centerOffsetUnits:g.centerOffsetUnits,verticalOffset:g.verticalOffset,shaderPolygonOffset:g.shaderPolygonOffset};if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:e,screenSizePerspectiveSettingsLabels:t}=this._context.sharedResources,r=(0,ka.z)(this._textRenderParameters);g.screenSizePerspective=t.overrideFontHeight(r.maxHeight),g.screenSizePerspectiveAlignment=e,y.fontHeight=r.maxHeight}g.hasSlicePlane=this._context.slicePlaneEnabled;const _=n?((e,t,r)=>{let i=e.get(r);return null==i&&(i=new Ot.R(t),e.add(r,i)),i})(n,g,JSON.stringify(y)):new Ot.R(g),v=i.placement.translation,b=p?(0,h.fA)(p.displayWidth,p.displayHeight):h.uY,w=i.placement.centerOffset,x=Ga,S=(0,h.vt)(),T=(0,Et.DJ)(_,x,v,null,b,w,S,null),M=(0,Mt.SZ)(this._context,t,T,c,d);if(null==M)return null;const C=new A.Y(this,M.object,[T],null==n?[_]:null,f,((t,r,n,s,o,a)=>{const c=l()||i.placement.elevationOffset,u=this.setGraphicElevationContext(e,r,c);return(0,_t.G8)(t,u,n,s,o,a)}),c);C.alignedSampledElevation=M.sampledElevation,C.needsElevationUpdates=(0,G.nu)(c.mode)||"absolute-height"===c.mode,C.getScreenSize=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,h.vt)();return e[0]=p?p.displayWidth:i.displaySize[0],e[1]=p?p.displayHeight:i.displaySize[1],e};const E=new Da.Z(i.placement.elevationOffset,r);return C.metadata=E,(0,Mt.d2)(C,t,this._context.elevationProvider),C}}function $a(e,t,r){e&&e.forEach((e=>{const i=t(e);null!=i&&r(i,e.graphic)}))}const qa={mode:"relative-to-ground",offset:0};var Wa=r(43047),Ya=r(91417),Xa=r(72085),Ja=(r(82884),r(15263));class Ka extends jr.w{initializeConfiguration(e,t){t.spherical=e.viewingMode===H.RT.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Gr.B(e.rctx,Ka.shader.get().build(this.configuration),Hr.D)}_setPipelineState(e){const t=this.configuration,r=e===To.y.NONE,i=e===To.y.FrontFace;return(0,Wr.Ey)({blending:t.output!==Nr.V.Normal&&t.output!==Nr.V.Highlight&&t.output!==Nr.V.ObjectAndLayerIdColor&&t.transparent?r?So.V0:(0,So.ez)(e):null,depthTest:t.draped?null:{func:(0,So.K_)(e)},depthWrite:t.draped?null:r?t.writeDepth?Wr.kn:null:(0,So.XO)(e),drawBuffers:(0,So.cl)(e),colorWrite:Wr.wE,polygonOffset:r||i?null:(0,So.aB)(t.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Ka.shader=new Br.$(Ja.W,(()=>r.e(9233).then(r.bind(r,69233))));class Qa extends Kr.E{constructor(){super(...arguments),this.output=Nr.V.Color,this.transparencyPassType=To.y.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}}(0,Xr._)([(0,Jr.W)({count:Nr.V.COUNT})],Qa.prototype,"output",void 0),(0,Xr._)([(0,Jr.W)({count:To.y.COUNT})],Qa.prototype,"transparencyPassType",void 0),(0,Xr._)([(0,Jr.W)()],Qa.prototype,"spherical",void 0),(0,Xr._)([(0,Jr.W)()],Qa.prototype,"receiveShadows",void 0),(0,Xr._)([(0,Jr.W)()],Qa.prototype,"hasSlicePlane",void 0),(0,Xr._)([(0,Jr.W)()],Qa.prototype,"transparent",void 0),(0,Xr._)([(0,Jr.W)()],Qa.prototype,"enableOffset",void 0),(0,Xr._)([(0,Jr.W)()],Qa.prototype,"writeDepth",void 0),(0,Xr._)([(0,Jr.W)()],Qa.prototype,"hasScreenSpaceReflections",void 0),(0,Xr._)([(0,Jr.W)()],Qa.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,Xr._)([(0,Jr.W)()],Qa.prototype,"hasCloudsReflections",void 0),(0,Xr._)([(0,Jr.W)()],Qa.prototype,"objectAndLayerIdColorInstanced",void 0),(0,Xr._)([(0,Jr.W)()],Qa.prototype,"draped",void 0),(0,Xr._)([(0,Jr.W)()],Qa.prototype,"multipassEnabled",void 0),(0,Xr._)([(0,Jr.W)()],Qa.prototype,"cullAboveGround",void 0),(0,Xr._)([(0,Jr.W)({constValue:!1})],Qa.prototype,"occlusionPass",void 0),(0,Xr._)([(0,Jr.W)({constValue:xo.A9.Water})],Qa.prototype,"pbrMode",void 0),(0,Xr._)([(0,Jr.W)({constValue:!0})],Qa.prototype,"useCustomDTRExponentForWater",void 0),(0,Xr._)([(0,Jr.W)({constValue:!0})],Qa.prototype,"highStepCount",void 0),(0,Xr._)([(0,Jr.W)({constValue:!1})],Qa.prototype,"useFillLights",void 0);class el extends Dr.A{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const t=null!=e.ssr.lastFrameColor;t!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t})}_updateCloudsReflectionState(e){const t=null!=e.cloudsFade.data;t!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:t})}ensureResources(e){return this._techniques.constructionContext.waterTextures.ensureResources(e)}beginSlot(e){return this._output===Nr.V.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniques.constructionContext.waterTextures.passParameters),this.ensureTechnique(Ka,e)}}class tl extends ca.W{constructor(e){super(e,new rl),this._configuration=new Qa,this._animation=new Xa.a,this.produces=new Map([[kr.N.OPAQUE_MATERIAL,e=>(0,Nr._o)(e)&&!this.parameters.transparent||(0,Nr.u5)(e)],[kr.N.TRANSPARENT_MATERIAL,e=>(0,Nr._o)(e)&&this.parameters.transparent||(0,Nr.u5)(e)],[kr.N.DRAPED_MATERIAL,e=>this.parameters.draped&&e===Nr.V.Color||(0,Nr.u5)(e)],[kr.N.DRAPED_WATER,e=>e===Nr.V.Normal]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.writeDepth=!0,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<So.xt,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<il;const r=this._animation.advance(e);return this.setParameters({timeElapsed:(0,Ya.y)(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&r}createGLMaterial(e){return new el(e)}createBufferWriter(){return new Ur.Z((0,s.A)("enable-feature:objectAndLayerId-rendering")?Vr.Dq:Vr.zK)}get test(){}}class rl extends Fr.qA{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=(0,h.fA)(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=(0,ot.fA)(0,0,0,0),this.transparent=!0,this.hasSlicePlane=!1,this.draped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=(0,p.vt)(),this.modelTransformation=null}}const il=35e3,nl={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},sl=["polyline","polygon","extent"];class ol extends Z.U{constructor(e,t,r,i){super(e,t,r,i)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,sl,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(t):this._createAs3DShape(t,r,t.uid)}ensureMaterial(){if(this._materials[0])return;const e=new rl,t=this.symbolLayer.color;null!=t&&(e.color=tt.A.toUnitRGBA(t));const r=this._getCombinedOpacity(t,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=null!=this.symbolLayer.waveDirection?ol.headingVectorFromAngle(this.symbolLayer.waveDirection):(0,h.fA)(0,0);const i=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=nl[i];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.draped=this.draped,this._materials[0]=new tl(e),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(null==this._materials[0])return;const e=this._materials[0].parameters.color,t=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=t<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],t],transparent:r})}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=(0,G.I2)(ol.elevationModeChangeTypes,r,i);if(n!==G.uw.UPDATE)return n;const s=(0,G.nu)(i);return this.updateGraphics3DGraphicElevationInfo(e,t,(()=>s))}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,t,r){const i=ne(e.geometry);if(null==i)return null;const n=de(i,this._context.elevationProvider,this._context.renderCoordsHelper,t),s=n.position.length/3,o=(0,z.jh)(2*s);al(o,n.mapPositions,s,this._context.elevationProvider.spatialReference);const a=new dl(n,o,this._context.layer.uid,e.uid);if(a.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(a),this._create3DShapeGeometries(a),this._logGeometryCreationWarnings(a.renderData,i.rings,"rings","WaterSymbol3DLayer"),0===a.outGeometries.length)return null;const l=new Me.B({geometries:a.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),c=new A.Y(this,l,a.outGeometries,null,null,_t.B6,t);return c.alignedSampledElevation=a.renderData.sampledElevation,c.needsElevationUpdates=(0,G.nu)(t.mode),c}_create3DShapeGeometries(e){const t=e.renderData.polygons,r=e.uvCoords;for(const{count:i,index:n,position:s,mapPositions:o,holeIndices:a}of t){if(null!=this._context.clippingExtent&&((0,g.Ie)(hl),(0,g.Hq)(hl,o),!(0,g.KG)(hl,this._context.clippingExtent)))continue;const t=(0,I.e)(o,a,3);if(0===t.length)continue;const l=(0,z.l5)(r,2*n,2*i),c=ie({material:this._materials[0],indices:t,mapPositions:o,attributeData:{position:s,uv0:l}},e.objectAndLayerIdColor);e.outGeometries.push(c)}}_createAsOverlay(e){const t=ne(e.geometry);if(null==t)return null;this._materials[0].renderPriority=this._renderPriority;const r=pe(t,this._context.overlaySR),i=r.position.length/3,n=(0,z.jh)(2*i);al(n,r.position,i,this._context.overlaySR);const s=new pl(r,n,this._context.layer.uid,e.uid);return s.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(s),s.outBoundingBox=(0,g.Ie)(),this._createAsOverlayWater(s),this._logGeometryCreationWarnings(s.renderData,t.rings,"rings","WaterSymbol3DLayer"),0===s.outGeometries.length?null:new bt(this,s.outGeometries,s.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const t=e.uvCoords,r=e.renderData.polygons;for(const{position:i,holeIndices:n,index:s,count:o}of r){if((0,g.Ie)(hl),(0,g.Hq)(hl,i),!(0,g.KG)(hl,this._context.clippingExtent))continue;(0,g.RF)(e.outBoundingBox,hl);const r=(0,I.e)(i,n,3);if(0===r.length)continue;const a=(0,z.l5)(t,2*s,2*o),l=ie({material:this._materials[0],indices:r,attributeData:{position:i,uv0:a}},e.objectAndLayerIdColor);e.outGeometries.push(new Rt.$(l,e))}}static headingVectorFromAngle(e){const t=(0,h.vt)(),r=(0,Js.DF)(e);return t[0]=Math.sin(r),t[1]=Math.cos(r),t}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}function al(e,t,r,i){const n=(0,O.GA)(i);(0,y.Ie)(cl);for(let a=0;a<r;a++)(0,u.hZ)(ul,t[3*a],t[3*a+1]),(0,y.tK)(cl,ul);(0,Wa.b)(cl,cl,n);const s=cl[0]%ol.unitSizeOfTexture,o=cl[1]%ol.unitSizeOfTexture;ll[0]=cl[0]-s,ll[1]=cl[1]-o;for(let a=0;a<r;a++)e[2*a]=(t[3*a]*n-ll[0])/ol.unitSizeOfTexture,e[2*a+1]=(t[3*a+1]*n-ll[1])/ol.unitSizeOfTexture}ol.unitSizeOfTexture=100,ol.elevationModeChangeTypes={definedChanged:G.uw.RECREATE,staysOnTheGround:G.uw.NONE,onTheGroundChanged:G.uw.RECREATE};const ll=(0,h.vt)(),cl=(0,y.vt)(),ul=(0,h.vt)(),hl=(0,g.vt)();class dl extends se{constructor(e,t,r,i){super(e,r,i),this.uvCoords=t}}class pl extends se{constructor(e,t,r,i){super(e,r,i),this.uvCoords=t}}function fl(e,t,r,i){const n=gl[e.type]?.[t.type]||ml[t.type];return n?new n(e,t,r,i):(E.A.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const ml={icon:Ft,object:ss,line:er,path:Do,fill:Ea,extrude:Ee,text:Za,water:ol};const gl={"mesh-3d":{fill:xi}};class yl extends tn.x{set symbol(e){this._symbol=e,e.symbolLayers.forEach(((t,r)=>{const i=this.symbolLayers[r];null!=i&&(i.symbol=e,i.symbolLayer=t)}))}get symbol(){return this._symbol}constructor(e,t,r){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const r=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const i=[];for(let n=0;n<r;n++){const s=t.at(n);if(!1===s.enabled)continue;_l.renderPriority=1-(1+n)/r,_l.renderPriorityStep=1/r,_l.ignoreDrivers=s.ignoreDrivers;const a=fl(this.symbol,s,this._context,_l),l=(0,o.NY)(e,(()=>{this.symbolLayers[n]=null,a.destroy()}));l&&i.push(l),this.symbolLayers[n]=a}if(await(0,n.jJ)(this.symbolLayers,(async(e,t)=>{if(null!=e)try{await e.load(),this._extentPadding+=Math.max(this._extentPadding,e.extentPadding)}catch{this.symbolLayers[t]=null}})),i.forEach((e=>e.remove())),(0,o.Te)(e),this.symbolLayers.length&&!this.symbolLayers.some((e=>!!e)))throw new Error}getSymbolLayerSize(e){const t=this.symbolLayers[e];return null!=t?t.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some((e=>e?.queryForSnapping))}createGraphics3DGraphic(e,t){const r=e.graphic,i=this.symbolLayers.map((t=>t?.createGraphics3DGraphic(e)??null)),n=this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null;return new M(r,t||this,i,e.layer,n)}get complexity(){return(0,a.Tf)(this.symbolLayers.map((e=>null!=e?e.complexity:null)))}globalPropertyChanged(e,t){const r=this.symbolLayers.length;for(let i=0;i<r;i++){const r=this.symbolLayers[i],n=e=>{const t=e.layers[i];return t instanceof A.Y?t:null};if(null!=r&&!r.globalPropertyChanged(e,t,n))return!1}return!0}applyRendererDiff(e,t){return this.loadStatus!==tn.P.LOADED?q.w.RecreateSymbol:this.symbolLayers.reduce(((r,i)=>r!==q.w.RecreateSymbol&&null!=i?Math.min(r,i.applyRendererDiff(e,t)):r),q.w.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===tn.P.FAILED)return;if("partial"!==e.diff.type)return;const t=e.diff.diff;if(!t.symbolLayers||"partial"!==t.symbolLayers.type)return;const r=t.symbolLayers.diff;this.symbolLayers.forEach(((t,i)=>{if(null==t)return;const n=r[i];if(n){const r={diff:n,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(r),e.symbolStatePatches.push(...r.symbolLayerStatePatches),r.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push(((e,t)=>{const n=e.layers[i];null!=n&&r.graphics3DGraphicPatches.forEach((e=>e(n,t)))}))}}))}updateGeometry(e,t){return this._updateGeometryOrTransform(e,((e,r)=>e.updateGeometry(r,t)))}updateTransform(e,t,r,i){return this._updateGeometryOrTransform(e,((e,n)=>e.updateTransform(n,t,r,i)))}_updateGeometryOrTransform(e,t){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(null==i)continue;const n=e.layers[r];if(!n||!t(i,n))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){const r=this.symbolLayers[t];if(null==r)continue;const i=e.layers[t];null!=i&&r.onRemoveGraphic(i)}}getFastUpdateStatus(){let e=0,t=0,r=0;return this.symbolLayers.forEach((i=>{null!=i&&(i.loadStatus===tn.P.LOADING?e++:i.isFastUpdatesEnabled()?r++:t++)})),{loading:e,slow:t,fast:r}}async queryForSnapping(e,t,r,n){const s=this.symbolLayers.filter(i.Ru).filter((e=>null!=e.queryForSnapping)).map((i=>i.queryForSnapping(e,t,r,n))),a=await Promise.all(s);return(0,o.Te)(n),a.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)null!=e&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const _l=new C.S},22294:(e,t,r)=>{"use strict";r.d(t,{$:()=>i,S:()=>n});class i{constructor(e,t){this.scheduler=e,this.schedule=t,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}}class n{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}}},24947:(e,t,r)=>{"use strict";r.d(t,{U:()=>y});var i=r(69539),n=(r(81806),r(76460)),s=r(9392),o=r(55855),a=r(5262),l=r(48989),c=r(67425),u=r(49296),h=r(41595),d=r(36423),p=r(41854),f=r(75646),m=r(63048);const g=()=>n.A.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class y extends f.x{constructor(e,t,r,i){super(r.schedule),this.symbol=e,this.symbolLayer=t,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this._materials=[],this.usedMemory=0,this.logger=g(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=i.renderPriority,this._renderPriorityStep=i.renderPriorityStep,this._elevationContext=new u.F,this.complexity=this.computeComplexity(),this.ignoreDrivers=i.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=_(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const t=this._drivenProperties,r=_(e);return r.color!==t.color||r.opacity!==t.opacity||r.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||r.size!==t.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,r,i){const n=e.projectionSuccess,s="polygons"in e?e.polygons:null,o=`${i} geometry failed to be created`;n?!this._logGeometryValidationWarnings(t,r,i)&&s&&0===s.length&&"rings"===r&&t.length>0&&t[0].length>2&&g().warnOncePerTick(`${o} (filled rings should use clockwise winding - try reversing the order of vertices)`):g().warnOncePerTick(`${o} (failed to project geometry to view spatial reference)`)}_logGeometryValidationWarnings(e,t,r){const i=`${r} geometry failed to be created`;return!e.length||1===e.length&&!e[0].length?(g().warnOncePerTick(`${i} (no ${t} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(g().warnOncePerTick(`${i} (${t} should be defined as a 2D array)`),!0)}_validateGeometry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!=t&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const t=e;if(!isFinite(t.x)||!isFinite(t.y))return g().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":(0,a.m3)(e)&&g().warnOncePerTick("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return v}_defaultElevationInfoZ(){return b}_updateElevationContext(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getDefaultElevationInfo(e);return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.F;const r=e.geometry,i=this.getDefaultElevationInfo(r);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:i.unit,t.mode=this.getGeometryElevationMode(r,i),t.offsetMeters=this._elevationContext.meterUnitOffset??i.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode;n&&(t.mode="relative-to-ground",t.offsetMeters=0);const s=n?h.KF:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(s,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}updateTransform(e,t,r,i){return!1}onRemoveGraphic(e){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity??0;return this._context.layer.opacity??1}_getCombinedOpacity(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w,r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(null!=e?r*=e.a:t.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w;const r=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return(0,d.$C)(null,r);const n=null!=e?i.A.toUnitRGB(e):s.Un;return(0,d.$C)(n,r)}_getVertexOpacityAndColor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r=this._drivenProperties.color?e.color:null,i=this._drivenProperties.opacity?e.opacity:null,n=(0,d.$C)(r,i);return t&&(n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=t),n}isFastUpdatesEnabled(){return null!=this._fastUpdates}computeComplexity(){return(0,l.JV)(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged(t,r),!0;case"elevationInfo":{const e=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,e)!==c.uw.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,t,r){let i=c.uw.UPDATE;return e.forEach((e=>{const n=t(e);if(null!=n){const t=e.graphic;this.setGraphicElevationContext(t,n.elevationContext),n.needsElevationUpdates=r(n.elevationContext.mode)}else i=c.uw.RECREATE})),i}applyRendererDiff(e,t){return p.w.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const t=this._fastUpdates.visualVariables,r=t.size?(0,m.ul)(t.size.field,e):0,i=t.color?(0,m.ul)(t.color.field,e):0,n=t.opacity?(0,m.ul)(t.opacity.field,e):0;return(0,o.fA)(r,i,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&g().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null})}}}function _(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach((e=>{switch(e.type){case"color":if(t.color=!0,e.stops)for(let r=0;r<e.stops.length;r++){const i=e.stops[r].color;i&&(t.opacity=!0,i.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}})),t}const v={mode:"on-the-ground",offset:0,unit:"meters"},b={mode:"absolute-height",offset:0,unit:"meters"},w={hasIntrinsicColor:!1}},49223:(e,t,r)=>{"use strict";r.d(t,{Q:()=>o});var i=r(48989),n=r(41854),s=r(75646);class o extends s.x{constructor(e,t,r){super(t),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const t=await this.symbol.fetchSymbol({signal:e});t.id=this.symbol.id,this.graphics3DSymbol=this._convert(t),null!=this.graphics3DSymbol&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.complexity:i.uD}globalPropertyChanged(e,t){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return null!=this.graphics3DSymbol?this.graphics3DSymbol.applyRendererDiff(e,t):n.w.RecreateSymbol}prepareSymbolPatch(e){null!=this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.updateGeometry(e,t)}updateTransform(e,t,r,i){return this.graphics3DSymbol?.updateTransform(e,t,r,i)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){null!=this.graphics3DSymbol&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}}},70374:(e,t,r)=>{"use strict";r.d(t,{A:()=>o,J:()=>a});var i=r(72745),n=r(9392),s=r(55855);class o{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,i.vt)(),a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,s.fA)(0,0,0,-1),l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"world",c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:(0,n.vt)(),u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;this.verticalOffset=e,this.anchor=t,this.hasLabelVerticalOffset=r,this.screenOffset=o,this.centerOffset=a,this.centerOffsetUnits=l,this.translation=c,this.elevationOffset=u}}class a{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,i.vt)();this.placement=e,this.horizontalPlacement=t,this.verticalPlacement=r,this.text=n,this.displaySize=s}}},6918:(e,t,r)=>{"use strict";r.d(t,{C:()=>J,c:()=>ee});var i=r(35143),n=r(91967),s=r(98773),o=(r(81806),r(76460)),a=r(87663),l=r(30726),c=r(50346),u=r(68134),h=r(46053),d=(r(47249),r(85842)),p=r(72745),f=r(32535),m=r(79701),g=r(82041),y=r(89422),_=r(26611),v=r(19852),b=r(80141),w=r(49223);function x(e){return e instanceof w.Q?e.graphics3DSymbol:e instanceof b.Z?e:null}var S=r(70374),T=r(20664),M=r(9392),A=r(42294),C=r(38865),E=r(42510),R=r(84248);const P=()=>o.A.getLogger("esri.views.3d.layers.graphics.labelPlacement");class O{constructor(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.graphics3DGraphic=e,this.labelSymbol=t,this.labelClass=r,this.disablePlacement=i}}function I(e){const t=function(e){const t=e.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=e,n=x(i.graphics3DSymbol),s="point-3d"===n?.symbol.type?n.symbol:null,o=k[t]||D(e);return null!=s&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:s.verticalOffset.clone(),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||null!=s&&s.supportsCallout()&&s.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&function(e){return"above-center"===e}(o.placement)?{placement:"above-center",verticalOffset:r.verticalOffset.clone(),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(P().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null)}(e);if(null==t)return null;const r=function(e,t){if(t.anchor)return t;const r=e.labelClass.labelPlacement,i=k[r],n=i||D(e);return r&&!i&&P().warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),function(e,t){const r=t.graphics3DGraphic.graphic.geometry;if(null==r)return null;if(null!=t.disablePlacement)return t.labelClass.labelPlacement?(P().warnOncePerTick(N(e?.placement,t.disablePlacement.logEntityDescription)),D(t)):e;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return P().warnOncePerTick(N(e?.placement,`'${i}' geometries`)),D(t);break;case"point":case"mesh":return e}return e}(n,e)}(e,t);if(null==r)return null;const i=r.anchor,n=!!t.hasLabelVerticalOffset,s=t.verticalOffset;return function(e,t,r){const i=r.graphics3DGraphic.graphic.geometry;if(null==i)return null;switch(i.type){case"point":case"mesh":!function(e,t,r){const i=L(r);if(null==i)return;const n=r.graphics3DGraphic.layers[0];switch(null!=n?n.getCenterObjectSpace(e.translation):(0,T.s)(e.translation,0,0,0),i.type){case"icon":case"text":!function(e,t,r,i){const{graphics3DGraphic:n}=r,s=null!=i?i.getScreenSize():null;if(n.isDraped||null==s)e.hasLabelVerticalOffset||"center"===e.anchor||(k[r.labelClass.labelPlacement]&&P().warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center");else{const i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;const{graphics3DGraphic:r}=e,i=r.layers[0],n=i?.stageObject.geometries[0].material??null;if(n&&n instanceof R.R){const e=n.parameters.anchorPosition;t[0]=2*(e[0]-.5),t[1]=2*(e[1]-.5)}else t[0]=0,t[1]=0;return t}(r);e.screenOffset[0]=s[0]/2*(t.normalizedOffset[0]-i[0]);const n=s[1]/2*(t.normalizedOffset[1]-i[1]);e.hasLabelVerticalOffset?(e.centerOffset[1]=n,e.centerOffsetUnits="screen"):e.screenOffset[1]=n}}(e,t,r,n);break;case"object":case"fill":F(e,t,n)}}(e,t,r);break;case"polygon":!function(e,t,r){const i=L(r);if(null!=i)switch(i.type){case"extrude":{const i=r.graphics3DGraphic.layers[0];null!=i?(i.getBoundingBoxObjectSpace(V),(0,A.gX)(V,e.translation),e.translation[2]=(0,A.uJ)(V)/2):(0,T.s)(e.translation,0,0,0),F(e,t,i);break}}}(e,t,r)}const n=C.VN-E.Xd;return e.screenOffset[0]+=n*t.normalizedOffset[0],e.screenOffset[1]+=n*t.normalizedOffset[1],e}(new S.A(s,i,n),r,e)}function L(e){const t=x(e.graphics3DGraphic.graphics3DSymbol);return null!=t?t.symbol.symbolLayers.at(0):null}function N(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function D(e){const t=e.graphics3DGraphic.graphic.geometry;if(null==t)return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:M.uY,anchor:"center"};case"polygon":{const t=L(e);return null!=t&&"extrude"===t.type?k["above-center"]:{placement:"center-center",normalizedOffset:M.uY,anchor:"center"}}case"point":case"mesh":return k["above-center"];default:return}}function F(e,t,r){const i=null!=r?r.getBoundingBoxObjectSpace(V):V,n=(0,M.fA)(i[3]-i[0],i[4]-i[1],i[5]-i[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);e.centerOffset[0]=s/2*t.normalizedOffset[0];const o=e.translation[2],a=n[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=o+a;const l=(0,T.l)(n);e.centerOffset[2]=l/2*t.normalizedOffset[2]}const k={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},z={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const re in z){const e=z[re],t=k[re];e.forEach((e=>{k[e]=t}))}Object.freeze&&(Object.freeze(k),Object.keys(k).forEach((e=>{Object.freeze(k[e]),Object.freeze(k[e]?.normalizedOffset)})));const U=[0,0],V=(0,A.vt)();var B=r(82250);class j{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,t){this._materials.set(e,t),this._stage.add(t)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}var H=r(70741),G=r(25175),Z=r(8918),$=r(59752),q=r(22856);class W{constructor(e,t){this.labelingContext=e,this.graphics3DGraphic=t,this.hasGraphics3DResources=!1,this.visible=!1,this.addedToTextureAtlas=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}}class Y{constructor(e,t,r,i,n){this.labelClass=e,this.graphics3DSymbol=t,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=i,this.labelFunction=n,this.calloutSymbolLayerIndex=0}}class X{constructor(e,t,r,i,n,s,o,a){this.layer=t,this.graphics3DCore=r,this.scaleVisibility=i,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=s,this.disablePlacement=o,this.active=a,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new Z.x(e,{pickable:!0,disableOctree:!0},t.uid)}destroy(){this.stageLayer.destroy()}}let J=class extends n.A{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([(0,u.wB)((()=>this.view.state?.camera),(()=>this.setDirty())),(0,u.wB)((()=>this.view.state?.rasterPixelRatio),(()=>this._resetAllLabels())),this.view.resourceController.scheduler.registerTask($.W6.LABELER,this)]),this._textTextureAtlas=new G.C({view:this.view}),this._hudMaterialCollection=new j(this.view._stage),this._calloutMaterialCollection=new j(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=(0,l.WD)(this._textTextureAtlas),this._hudMaterialCollection=(0,l.WD)(this._hudMaterialCollection),this._calloutMaterialCollection=(0,l.WD)(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),te.graphic=null,te.renderingInfo=null,te.layer=null}_activateLabelingContext(e){e.graphics.forEach(((t,r)=>{const i=new W(e,t);this._labels.set(r,i),e.labelsToInitialize.set(r,i),t.setVisibilityFlag(y.u.LABEL,y.Z.USER,!0)})),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach(((e,t)=>{e.setVisibilityFlag(y.u.LABEL,y.Z.USER,!1),this.setLabelGraphicVisibility(e,!1),e.clearLabelGraphics(),this._labels.delete(t)})),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelLayers){if(!t._labelClass)continue;const r=e.textRenderers[t._labelIndex];r&&(this._textTextureAtlas.addTextTexture(r,t.stageObject),e.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelLayers){if(!t._labelClass)continue;const r=e.textRenderers[t._labelIndex];null!=r&&(this._textTextureAtlas.removeTextTexture(r,t.stageObject),e.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),q.G}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(t.active)if(K(t))this._dirty=!0;else if(Q(t.labelClassContexts)){if(null===t.labelClassContexts){this._deactivateLabelingContext(t);continue}this._createLabelClassContext(t),this._dirty=!0}else(0,a.Bs)(t.labelsToInitialize,((r,i)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(i,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(t.labelsToInitialize.delete(i),e.madeProgress()),e.done)))&&(this._dirty=!0);this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController?.signal;e.layer.when&&await e.layer.when(),(0,c.Te)(t),e.scaleVisibility?.updateScaleRangeActive();const r=e.graphics3DCore,i=r.layer,n=i.labelingInfo?.filter((e=>!!e.symbol));if(!n||0===n.length)return;let a=!1;await(0,s.jJ)(n,(async(i,n)=>{const l=i.symbol,u=x(r.getOrCreateGraphics3DSymbol(l));if(null==u)return void o.A.getLogger(this).error("Failed to create Graphics3DSymbol for label");await u.load(),(0,c.Te)(t);let h=null;(0,g.YX)(l)&&l.hasVisibleCallout()&&(h=(0,_.L)(l,r.symbolCreationContext),await h.load(),(0,c.Te)(t));const d=await(0,s.Ke)((0,m.l)(i,e.layer.fieldsIndex,this.view.spatialReference));if((0,c.Te)(t),!0===d.ok){const r=await this._createTextRenderParameters(u.symbol);(0,c.Te)(t),e.labelClassContexts[n]=new Y(i,u,h,r,d.value)}else o.A.getLogger(this).error(`Label expression failed to evaluate: ${d.error}`),a=!0})),(0,c.Te)(t)}async _createLabelClassContext(e){return null==e.labelClassPromise&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch((t=>{if((0,c.zf)(t))throw t;e.labelClassContexts.length=0})).then((()=>{e.labelClassAbortController=null,this.notifyChange("updating")})).catch((()=>{})),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.at(0);return"text"!==t?.type?null:H.G.fromSymbol(t,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,(0,l.DC)(t),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,r,i,n,s){const o=new S.J(r,(0,B.Dt)(r.anchor),(0,B.fy)(r.anchor),e.text,(0,p.fA)(e.displayWidth,e.displayHeight));return te.graphic=t,te.renderingInfo=null,te.layer=i,n.createLabel(te,o,this._hudMaterialCollection,this._textTextureAtlas,(()=>{const e=I(s);return e?e.elevationOffset:null}))}_createLineCalloutGraphic(e,t,r,i,n){te.graphic=e,te.layer=n;const s=i.screenOffset[0];return te.renderingInfo=new v.AG(null,t,i.translation,i.centerOffset,s,i.centerOffsetUnits,i.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(te)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,i=r.labelClassContexts;if(Q(i)||!r.emptySymbolLabelSupported&&0===t.layers.length)return!1;let n=!1;const s=t.graphic,o=r.layer,a=ee(r.layer);for(let l=0;l<i.length;l++){const c=e.textRenderers[l],u=e.textLabelPlacements[l];if(null==c||null==u)continue;const h=i[l],d=h.graphics3DSymbol,p=d.symbol&&"label-3d"===d.symbol.type?d.symbol:null,f=d.symbolLayers[0];if(!f)continue;f.setElevationInfoOverride(r.elevationInfoOverride);const m=new O(t,p,h.labelClass),g=this._createTextSymbolGraphic(c,s,u,o,f,m);if(null==g)return!1;g._labelClass=h.labelClass,g._labelIndex=l,t.addLabelGraphic(g,r.stageLayer),t.deconflictionPriority=h.textRenderParameters?.definition.size??0,t.setVisibilityFlag(y.u.LABEL,y.Z.USER,a),t.setVisibilityFlag(y.u.LABEL,y.Z.SCALE_RANGE,!0),t.setVisibilityFlag(y.u.LABEL,y.Z.DECONFLICTION,!1),n=!0;const _=h.graphics3DCalloutSymbolLayer;if(_&&u.hasLabelVerticalOffset){_.setElevationInfoOverride(r.elevationInfoOverride);const e=this._createLineCalloutGraphic(s,p,_,u,o);null!=e&&(h.calloutSymbolLayerIndex=t.labelLayers.length,t.addLabelGraphic(e,r.stageLayer))}break}return n&&r.scaleVisibility?.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(null==r._labelClass)continue;const e=t[r._labelIndex].graphics3DSymbol.symbolLayers[0];e?.onRemoveGraphic(r)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.textInitialized)return;const t=e.labelingContext,r=t.labelClassContexts;if(Q(r))return;const i=e.graphics3DGraphic.graphic;for(let s=0;s<r.length;s++){const o=r[s];if(e.textRenderers[s]=null,e.textLabelPlacements[s]=null,null==o?.textRenderParameters)continue;const a=o.labelFunction;let l;if("arcade"===a.type)try{const e=a.needsHydrationToEvaluate()?(0,f.wP)(i,t.layer):i;l=a.evaluate(e)}catch(n){l=null}else l=a.evaluate(i);if(null==l||""===l||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,u="label-3d"===c.symbol?.type?c.symbol:null;if(!c.symbolLayers[0])continue;const h=I({graphics3DGraphic:e.graphics3DGraphic,labelSymbol:u,labelClass:o.labelClass,disablePlacement:t.disablePlacement});if(null==h)continue;const d=(0,B.Dt)(h.anchor),p=(0,B.QE)(d);e.textRenderers[s]=new E.Js(l,p,o.textRenderParameters,G.C.maxSize),e.textLabelPlacements[s]=h}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,t){const r=t.graphic.uid;if(e.graphics.set(r,t),e.active){const i=new W(e,t);this._labels.set(r,i),e.labelsToInitialize.set(r,i)}this.setDirty(),this.deconflictor.setDirty()}_updateGraphicGeometry(e,t){const r=t.graphic.uid,i=this._labels.get(r);if(!i)return!0;for(const n of i.graphics3DGraphic.labelLayers)if(null!=n._labelClass&&!e.labelClassContexts[n._labelIndex].graphics3DSymbol.symbolLayers[0].updateGeometry(n,t.graphic.geometry))return!1;return this.setDirty(),this.deconflictor.setDirty(),!0}_removeGraphic(e,t){const r=t.graphic.uid,i=this._labels.get(r);e.graphics.delete(r),i&&(this._destroyGraphic(i,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.delete(t),e.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of t){const t=e.graphics.get(r);t&&(this._removeGraphic(e,t),this._addGraphic(e,t))}}_globalPropertyChanged(e,t){for(const r of t.labelClassContexts){const i=new Map;t.graphics.forEach((e=>i.set(e.graphic.uid,e)));const n=e=>e.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,i,n),r.graphics3DCalloutSymbolLayer){const t=e=>e.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,i,t)}}}_visibilityInfoChange(e){const t=ee(e.layer);t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach(((t,r)=>{const i=this._labels.get(r);i&&(this._destroyGraphic(i,r),i.visible=!1,e.labelsToInitialize.set(r,i))})),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,r){const i=r?.emptySymbolLabelSupported||!1,n=r?.elevationInfoOverride||null,s=r?.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,a=new X(this.view._stage,o,e,t,i,n,s,ee(o));return this._labelingContexts.push(a),this.setDirty(),{addGraphic:e=>this._addGraphic(a,e),removeGraphic:e=>this._removeGraphic(a,e),updateGraphicGeometry:e=>this._updateGraphicGeometry(a,e),layerLabelsEnabled:()=>ee(a.layer),labelingInfoChange:e=>this._labelingInfoChange(a,e),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",a),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",a),visibilityInfoChange:()=>this._visibilityInfoChange(a),reset:()=>this._resetLabels(a),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const r=this._labelingContexts.indexOf(t);this._labelingContexts.splice(r,1),t.graphics.forEach((e=>this._removeGraphic(t,e))),t.destroy(),this.setDirty()}setLabelGraphicVisibility(e,t){const r=e.graphic.uid,i=this._labels.get(r);i&&i.visible!==t&&(t&&!i.addedToTextureAtlas?(this._addLabelTextureToAtlas(i),i.textInitialized||i.labelingContext.labelsToInitialize.set(r,i)):!t&&i.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(i),i.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some((e=>K(e)))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce(((e,t)=>e+(K(t)?0:1)),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){}};function K(e){return!!e.labelClassPromise&&!!e.labelClassAbortController}function Q(e){return!e||0===e.length}function ee(e){return!0===e.labelsVisible&&!!e.labelingInfo?.some((e=>!!e.symbol))}(0,i._)([(0,h.MZ)({constructOnly:!0})],J.prototype,"view",void 0),(0,i._)([(0,h.MZ)({constructOnly:!0})],J.prototype,"deconflictor",void 0),(0,i._)([(0,h.MZ)()],J.prototype,"_textTextureAtlas",void 0),(0,i._)([(0,h.MZ)({type:Boolean,readOnly:!0})],J.prototype,"updating",null),J=(0,i._)([(0,d.$)("esri.views.3d.layers.graphics.Labeler")],J);const te=new v.Rj(null,null,null)},75646:(e,t,r)=>{"use strict";r.d(t,{P:()=>i,x:()=>o});var i,n=r(30726),s=r(50346);class o{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=i.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return this._loadStatus===i.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===i.FAILED?(t&&t(this._loadError),this._loader??Promise.resolve()):(null==this._loader&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then((()=>{this._abortController=null,this._loadStatus=i.LOADED}),(e=>{throw this._loadError=e,this._abortController=null,this._loadStatus=i.FAILED,!(0,s.zf)(e)&&this.logger&&e.message&&this.logger.warn(e.message),e}))),this._loader.then(e,t).catch((()=>{})),this._loader)}abortLoad(){null!=this._abortController?this._abortController=(0,n.DC)(this._abortController):this._loadStatus===i.LOADING&&(this._loadStatus=i.FAILED),this._loader=null}}!function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"}(i||(i={}))},90346:(e,t,r)=>{"use strict";r.d(t,{MT:()=>s,a8:()=>o,hk:()=>n,i3:()=>a,rz:()=>i});class i{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new a}}class n extends i{constructor(e){super(e),this.estimated=!0}}class s extends i{constructor(e,t){super(t),this.numComplexities=e}}class o extends n{constructor(e,t){super(t),this.numComplexities=e}}class a{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}}},38865:(e,t,r)=>{"use strict";r.d(t,{VN:()=>o,qD:()=>n,r4:()=>s});var i=r(55855);const n=1.2,s=i.uY,o=4},48989:(e,t,r)=>{"use strict";r.d(t,{Eg:()=>h,GI:()=>g,JV:()=>m,Tf:()=>d,k9:()=>p,pg:()=>_,uD:()=>u});var i=r(4212),n=r(47675),s=r(64573),o=r(73177),a=r(90346),l=r(7342),c=r(65131);const u=new a.hk({});function h(e){return"web-style"===e.type?u:d(e.symbolLayers.toArray().map((t=>m(e,t))))}function d(e){let t=0,r=0,i=0,n=!1,s=0;const o=new a.i3;for(const a of e)null!=a&&(t+=a.verticesPerFeature,r+=a.verticesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,n=n||a.estimated,++s);return n?new a.a8(s,{verticesPerFeature:t,verticesPerCoordinate:r,drawCallsPerFeature:i,memory:o}):new a.MT(s,{verticesPerFeature:t,verticesPerCoordinate:r,drawCallsPerFeature:i,memory:o})}function p(e){const t=d(e);return t.numComplexities>0&&(t.verticesPerFeature/=t.numComplexities,t.verticesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.resourceBytes/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities),t}const f={};function m(e,t){const r=g(e,t),o=(0,l.RF)(t)?2:0;switch(t.type){case"extrude":return new a.rz({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:o,memory:r});case"fill":if("mesh-3d"===e.type)return new a.rz({drawCallsPerFeature:o,memory:r});if(null!=t.outline&&t.outline.size>0)return new a.rz({verticesPerFeature:-12,verticesPerCoordinate:9,memory:r});case"water":return new a.rz({verticesPerFeature:-6,verticesPerCoordinate:3,memory:r});case"line":return new a.rz({verticesPerFeature:-6,verticesPerCoordinate:6,memory:r});case"object":return t.resource?.href?new a.hk({verticesPerFeature:100,memory:r}):{...y(t.resource?.primitive??n.r),memory:r};case"path":{let e=0,n=0;switch(t.profile){case"circle":e=s.ZC;break;case"quad":e=4;break;default:return void(0,i.Xb)(t.profile)}switch(t.join){case"round":n=s.kf;break;case"miter":case"bevel":n=1;break;default:return}const o=2*e,l=e*n*2,c=l+o;let u=-2*l-o;switch(t.cap){case"none":break;case"butt":case"square":u+=2*(e-1);break;case"round":u+=2*(e*(s.RL-1)*2+e);break;default:return}return new a.rz({verticesPerFeature:u,verticesPerCoordinate:c,memory:r})}case"text":case"icon":return new a.rz({verticesPerFeature:6,memory:r});default:return}}function g(e,t){const r="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?v.EXTRUDE_EDGES:v.EXTRUDE;case"fill":return null!=t.outline&&t.outline.size>0?v.FILL_OUTLINE:v.FILL;case"water":return v.FILL;case"line":return"round"===t.join?v.LINE_ROUND:v.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return v.PATH_ROUND_CIRCLE;case"quad":return v.PATH_ROUND_QUAD;default:return void(0,i.Xb)(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return v.PATH_MITER_CIRCLE;case"quad":return v.PATH_MITER_QUAD;default:return void(0,i.Xb)(t.profile)}default:return}case"object":return r?v.OBJECT_POINT:v.OBJECT_POLYGON;case"icon":case"text":return r?v.ICON_POINT:v.ICON_POLYGON;default:return}}function y(e){const t=f[e];if(t)return t;const r=_((0,o._)(e,new c.$U({})).levels);return f[e]=new a.rz({verticesPerFeature:r}),f[e]}function _(e){return e.reduce(((e,t,r)=>e+t.numVertices*(1/10**r)),0)/e.reduce(((e,t,r)=>e+1/10**r),0)}const v={ICON_POINT:{bytesPerFeature:2379.8272296852992,bytesPerFeatureLabel:852.246235,resourceBytes:0,draped:{bytesPerFeature:1868.2382921559424,bytesPerFeatureLabel:839.205415}},ICON_POLYGON:{bytesPerFeature:2957.8429876524656,bytesPerFeatureLabel:862.5307816666666,resourceBytes:0,draped:{bytesPerFeature:2579.7767085451133,bytesPerFeatureLabel:856.9298550000001}},OBJECT_POINT:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999,resourceBytes:0,draped:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999}},OBJECT_POLYGON:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998,resourceBytes:0,draped:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998}},LINE_MITER:{bytesPerFeature:3081.208408220661,bytesPerFeatureLabel:858.6749016666668,resourceBytes:0,draped:{bytesPerFeature:2682.57863388475,bytesPerFeatureLabel:844.6118016666666}},LINE_ROUND:{bytesPerFeature:3209.3236242927915,bytesPerFeatureLabel:858.1810416666667,resourceBytes:0,draped:{bytesPerFeature:2687.6256038096126,bytesPerFeatureLabel:849.578535}},PATH_MITER_CIRCLE:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415,resourceBytes:0,draped:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415}},PATH_ROUND_CIRCLE:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001,resourceBytes:0,draped:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001}},PATH_MITER_QUAD:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355,resourceBytes:0,draped:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355}},PATH_ROUND_QUAD:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955,resourceBytes:0,draped:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955}},FILL:{bytesPerFeature:3147.43349219103,bytesPerFeatureLabel:850.7598550000001,resourceBytes:0,draped:{bytesPerFeature:2673.7898488975106,bytesPerFeatureLabel:846.6459950000002}},FILL_OUTLINE:{bytesPerFeature:4565.099993465867,bytesPerFeatureLabel:855.334515,resourceBytes:0,draped:{bytesPerFeature:3904.46969705314,bytesPerFeatureLabel:844.7081016666667}},EXTRUDE:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333,resourceBytes:0,draped:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333}},EXTRUDE_EDGES:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335,resourceBytes:0,draped:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335}}}},67425:(e,t,r)=>{"use strict";r.d(t,{I2:()=>m,Kf:()=>y,Uk:()=>b,ai:()=>v,au:()=>d,fe:()=>_,nG:()=>f,nu:()=>g,sE:()=>p,uw:()=>i});var i,n=r(34761),s=r(13191),o=r(9392),a=r(5809),l=r(45308),c=r(81284),u=r(80935),h=r(66470);function d(e,t,r,i,n,s,o,a,c,u,h){const d=w[h.mode];let p,f,m=0;if((0,l.projectBuffer)(e,t,r,i,c.spatialReference,n,a))return d.requiresAlignment(h)?(m=d.applyElevationAlignmentBuffer(i,n,s,o,a,c,u,h),p=s,f=o):(p=i,f=n),(0,l.projectBuffer)(p,c.spatialReference,f,s,u.spatialReference,o,a)?m:void 0}function p(e,t,r,i,n){const s=((0,c.v)(e)?e.z:(0,u.cN)(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":{const r=(0,u.R1)(t,e,"ground")??0;return n.verticalDistanceToGround=0,n.sampledElevation=r,void(n.z=r)}case"relative-to-ground":{const o=(0,u.R1)(t,e,"ground")??0,a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"relative-to-scene":{const o=(0,u.R1)(t,e,"scene")??0,a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(s,i),a=(0,u.R1)(t,e,"ground")??0;return n.verticalDistanceToGround=o-a,n.sampledElevation=a,void(n.z=o)}default:return void(n.z=0)}}function f(e,t,r,i){return p(e,t,r,i,S),S.z}function m(e,t,r){return"on-the-ground"===t&&"on-the-ground"===r?e.staysOnTheGround:t===r||"on-the-ground"!==t&&"on-the-ground"!==r?null==t||null==r?e.definedChanged:i.UPDATE:e.onTheGroundChanged}function g(e){return"relative-to-ground"===e||"relative-to-scene"===e}function y(e){return"absolute-height"!==e}function _(e,t,r,i,s){p(t,r,s,i,S),v(e,S.verticalDistanceToGround);const o=S.sampledElevation,l=(0,n.C)(x,e.transformation);return T[0]=t.x,T[1]=t.y,T[2]=S.z,(0,a.l)(t.spatialReference,T,l,i.spatialReference)?e.transformation=l:console.warn("Could not locate symbol object properly, it might be misplaced"),o}function v(e,t){for(let r=0;r<e.geometries.length;++r){const i=e.geometries[r].getMutableAttribute(h.r.CENTEROFFSETANDDISTANCE);i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttributeUpdated(e.geometries[r],h.r.CENTEROFFSETANDDISTANCE))}}class b{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(i||(i={}));const w={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,r,i,n,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,i*=3;for(let u=0;u<n;++u){const n=e[t],s=e[t+1],o=e[t+2];r[i]=n,r[i+1]=s,r[i+2]=null==c?o+l:l,t+=3,i+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return 0!==t||null!=r}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,r,i,n,s){let o=0;const a=s.spatialReference;t*=3,i*=3;for(let l=0;l<n;++l){const n=e[t],l=e[t+1],c=e[t+2],u=s.getElevation(n,l,c,a,"ground")??0;o+=u,r[i]=n,r[i+1]=l,r[i+2]=u,t+=3,i+=3}return o/n},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=s.spatialReference;t*=3,i*=3;for(let d=0;d<n;++d){const n=e[t],o=e[t+1],a=e[t+2],d=s.getElevation(n,o,a,h,"ground")??0;l+=d,r[i]=n,r[i+1]=o,r[i+2]=null==u?a+d+c:d+c,t+=3,i+=3}return l/n},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=s.spatialReference;t*=3,i*=3;for(let d=0;d<n;++d){const n=e[t],o=e[t+1],a=e[t+2],d=s.getElevation(n,o,a,h,"scene")??0;l+=d,r[i]=n,r[i+1]=o,r[i+2]=null==u?a+d+c:d+c,t+=3,i+=3}return l/n},requiresAlignment:()=>!0}},x=(0,s.vt)(),S=new b,T=(0,o.vt)()},89422:(e,t,r)=>{"use strict";var i,n;r.d(t,{Z:()=>i,u:()=>n}),function(e){e[e.USER=1]="USER",e[e.SCALE_RANGE=2]="SCALE_RANGE",e[e.FILTER=4]="FILTER",e[e.DECONFLICTION=8]="DECONFLICTION",e[e.ALL_GRAPHIC=15]="ALL_GRAPHIC",e[e.ALL_LABEL=255]="ALL_LABEL"}(i||(i={})),function(e){e[e.GRAPHIC=1]="GRAPHIC",e[e.LABEL=16]="LABEL"}(n||(n={}))},41595:(e,t,r)=>{"use strict";r.d(t,{KF:()=>m,MF:()=>f,VG:()=>h,g7:()=>p,gf:()=>d,hI:()=>c,o8:()=>l,q6:()=>u});var i=r(76460),n=r(50346),s=r(32535),o=r(98976);const a=()=>i.A.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function l(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function c(e){const t=e?.expression;if("string"==typeof t){const e=y(t);if(null!=e)return{cachedResult:e}}return null}async function u(e,t,r,i){const s=e?.expression;if("string"!=typeof s)return null;const a=y(s);if(null!=a)return{cachedResult:a};const l=await(0,o.lw)();(0,n.Te)(r);const c=l.arcadeUtils,u=c.createSyntaxTree(s);return c.dependsOnView(u)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:c.createFunction(u),context:c.createExecContext(null,{sr:t}),modules:l}}}function h(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function d(e,t){if(null!=e&&!g(e)){if(!t||!e.arcade)return void a().errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=(0,s.wZ)(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function p(e){if(null!=e){if(g(e))return e.cachedResult;const t=e.arcade;let r=t?.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function f(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e?.featureExpressionInfo;const i=r?.expression;return t||"0"===i||(r=null),r??null}const m={cachedResult:0};function g(e){return null!=e.cachedResult}function y(e){return"0"===e?0:null}},36423:(e,t,r)=>{"use strict";r.d(t,{$2:()=>M,$C:()=>b,Hj:()=>S,Mh:()=>T,W$:()=>g,eA:()=>w,pW:()=>x,t8:()=>v,vY:()=>A});var i=r(31633),n=r(34761),s=r(13191),o=r(9392),a=r(43047),l=r(55855),c=r(9624),u=r(42294),h=r(2413),d=r(205),p=r(5262),f=r(18117),m=r(32535);function g(e,t){if("point"===e.type)return _(e,t,!1);if((0,m.gr)(e))switch(e.type){case"extent":return _(e.center,t,!1);case"polygon":return _(e.centroid,t,!1);case"polyline":return _(y(e),t,!0);case"mesh":return _(e.origin,t,!1)}else switch(e.type){case"extent":return _(function(e){return(0,f.T)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),null!=e.zmin&&null!=e.zmax&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return _(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const r=(0,d.S8)(e.rings,!!e.hasZ);return(0,f.T)(r[0],r[1],r[2],e.spatialReference)}(e),t,!0);case"polyline":return _(y(e),t,!0)}}function y(e){const t=e.paths[0];if(!t||0===t.length)return null;const r=(0,p.$H)(t,(0,p.Yl)(t)/2);return(0,f.T)(r[0],r[1],r[2],e.spatialReference)}function _(e,t,r){const i=r?e:(0,m.EL)(e);return t&&e?(0,c.projectPoint)(e,i,t)?i:null:i}function v(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e){t||(t=(0,h.vt)());const n=e;let s=.5*n.width*(r-1),o=.5*n.height*(r-1);return n.width<1e-7*n.height?s+=o/20:n.height<1e-7*n.width&&(o+=s/20),(0,a.s)(t,n.xmin-s-i,n.ymin-o-i,n.xmax+s+i,n.ymax+o+i),t}return null}function b(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=(0,l.o8)(l.Un);return null!=e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),null!=t?i[3]=t:null!=e&&e.length>3&&(i[3]=e[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function w(e,t,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[0,0,0,0];for(let o=0;o<3;++o)s[o]=null!=e?.[o]?e[o]:null!=r?.[o]?r[o]:n[o];return s[3]=null!=t?t:null!=i?i:n[3],s}function x(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.Un,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const n=new Array(3);if(null==t||null==r)n[0]=1,n[1]=1,n[2]=1;else{let i,s=0;for(let o=2;o>=0;o--){const a=e[o];let l;const c=null!=a,u=0===o&&!i&&!c,h=r[o];"symbol-value"===a||u?l=0!==h?t[o]/h:1:c&&"proportional"!==a&&isFinite(a)&&(l=0!==h?a/h:1),null!=l&&(n[o]=l,i=l,s=Math.max(s,Math.abs(l)))}for(let e=2;e>=0;e--)null==n[e]?n[e]=i:0===n[e]&&(n[e]=.001*s)}for(let s=2;s>=0;s--)n[s]/=i;return(0,o.ci)(n)}function S(e){return T(function(e){return null!=e.isPrimitive}(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function T(e){const t=e=>null==e||e>=0;return Array.isArray(e)?e.every(t):t(e)}function M(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,s.vt)();return e&&(0,n.Qr)(i,i,-e/180*Math.PI),t&&(0,n.eL)(i,i,t/180*Math.PI),r&&(0,n.Z8)(i,i,r/180*Math.PI),i}function A(e,t,r){if(null!=r.minDemResolution)return r.minDemResolution;const n=(0,i.GA)(t),s=(0,u.VL)(e)*n,o=(0,u.yr)(e)*n,a=(0,u.uJ)(e)*(t.isGeographic?1:n);return 0===s&&0===o&&0===a?r.minDemResolutionForPoints:.01*Math.max(s,o,a)}},41854:(e,t,r)=>{"use strict";var i;r.d(t,{w:()=>i}),function(e){e[e.RecreateSymbol=0]="RecreateSymbol",e[e.RecreateGraphics=1]="RecreateGraphics",e[e.FastUpdate=2]="FastUpdate"}(i||(i={}))},7323:(e,t,r)=>{"use strict";r.d(t,{fetch:()=>k});var i=r(93795),n=r(15941),s=r(63919),o=r(44680),a=r(34761),l=r(13191),c=r(72745),u=r(20664),h=r(9392),d=r(42294),p=r(75002),f=r(88105),m=r(45136),g=r(33328),y=r(52007),_=r(64591),v=r(2e3),b=r(11109),w=r(56516),x=r(420),S=r(37040),T=r(54439);class M{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}}class A{constructor(e,t,r){this.name=e,this.lodThreshold=t,this.pivotOffset=r,this.stageResources=new M,this.numberOfVertices=0}}var C=r(14766),E=r(59046),R=r(50468),P=r(83490),O=r(51799),I=r(96897),L=r(66470),N=r(65131),D=r(50791),F=r(78992);async function k(e,t){const r=function(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}((0,i.EM)(e));if("wosr"===r.fileType){const e=await(t.cache?t.cache.loadWOSR(r.url,t):(0,C.Hh)(r.url,t)),{engineResources:i,referenceBoundingBox:n}=(0,C.FJ)(e,t);return{lods:i,referenceBoundingBox:n,isEsriSymbolResource:!1,isWosr:!0}}const o=await(t.cache?t.cache.loadGLTF(r.url,t,!!t.usePBR):(0,w.y)(new b.R(t.streamDataRequester),r.url,t,t.usePBR)),M=o.model.meta?.ESRI_proxyEllipsoid,k=o.meta.isEsriSymbolResource&&null!=M&&"EsriRealisticTreesStyle"===o.meta.ESRI_webstyle;k&&!o.customMeta.esriTreeRendering&&(o.customMeta.esriTreeRendering=!0,function(e,t){for(let r=0;r<e.model.lods.length;++r){const i=e.model.lods[r];for(const n of i.parts){const i=n.attributes.normal;if(null==i)return;const s=n.attributes.position,o=s.count,c=(0,h.vt)(),d=(0,h.vt)(),p=(0,h.vt)(),m=new Uint8Array(4*o),g=new Float64Array(3*o),y=(0,a.B8)((0,l.vt)(),n.transform);let _=0,v=0;for(let a=0;a<o;a++){s.getVec(a,d),i.getVec(a,c),(0,u.h)(d,d,n.transform),(0,u.f)(p,d,t.center),(0,u.D)(p,p,t.radius);const o=p[2],l=(0,u.l)(p),h=Math.min(.45+.55*l*l,1);(0,u.D)(p,p,t.radius),null!==y&&(0,u.h)(p,p,y),(0,u.n)(p,p),r+1!==e.model.lods.length&&e.model.lods.length>1&&(0,u.o)(p,p,c,o>-1?.2:Math.min(-4*o-3.8,1)),g[_]=p[0],g[_+1]=p[1],g[_+2]=p[2],_+=3,m[v]=255*h,m[v+1]=255*h,m[v+2]=255*h,m[v+3]=255,v+=4}n.attributes.normal=new f.xs(g),n.attributes.color=new f.XP(m)}}}(o,M));const U=!!t.usePBR,V=o.meta.isEsriSymbolResource?{usePBR:U,isSchematic:!1,treeRendering:k,mrrFactors:[...F.d_]}:{usePBR:U,isSchematic:!1,treeRendering:!1,mrrFactors:[...F.Rk]},B={...t.materialParameters,treeRendering:k},{engineResources:j,referenceBoundingBox:H}=function(e,t,r,i){const o=e.model,a=new Array,l=new Map,u=new Map,h=o.lods.length,b=(0,d.Ie)();return o.lods.forEach(((e,w)=>{const M=!0===i.skipHighLods&&(h>1&&0===w||h>3&&1===w)||!1===i.skipHighLods&&null!=i.singleLodIndex&&w!==i.singleLodIndex;if(M&&0!==w)return;const C=new A(e.name,e.lodThreshold,[0,0,0]);e.parts.forEach((e=>{const i=M?new N.$U({}):function(e,t,r,i,n,s,o){const a=t.material+(t.attributes.normal?"_normal":"")+(t.attributes.color?"_color":"")+(t.attributes.texCoord0?"_texCoord0":"")+(t.attributes.tangent?"_tangent":""),l=e.materials.get(t.material),u=null!=t.attributes.texCoord0,h=null!=t.attributes.normal;if(null==l)return null;const d=function(e){switch(e){case"BLEND":return P.sf.Blend;case"MASK":return P.sf.Mask;case"OPAQUE":case null:case void 0:return P.sf.Opaque}}(l.alphaMode);if(!s.has(a)){if(u){const t=function(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null!=t&&!o.has(t)){const i=e.textures.get(t);if(null!=i){const e=i.data;o.set(t,new I.g((0,S.x3)(e)?e.data:e,{...i.parameters,preMultiplyAlpha:!(0,S.x3)(e)&&r,encoding:(0,S.x3)(e)&&null!=e.encoding?e.encoding:void 0}))}}};t(l.textureColor,d!==P.sf.Opaque),t(l.textureNormal),t(l.textureOcclusion),t(l.textureEmissive),t(l.textureMetallicRoughness)}const r=l.color[0]**(1/D.T),p=l.color[1]**(1/D.T),f=l.color[2]**(1/D.T),m=l.emissiveFactor[0]**(1/D.T),g=l.emissiveFactor[1]**(1/D.T),y=l.emissiveFactor[2]**(1/D.T),_=null!=l.textureColor&&u?o.get(l.textureColor):null,v=(0,F.Jr)({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion}),b=null!=l.normalTextureTransform?.scale?l.normalTextureTransform?.scale:c.Un;s.set(a,new N.$U({...i,transparent:d===P.sf.Blend,customDepthTest:P.it.Lequal,textureAlphaMode:d,textureAlphaCutoff:l.alphaCutoff,diffuse:[r,p,f],ambient:[r,p,f],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?P.s2.None:P.s2.Back,hasVertexColors:!!t.attributes.color,hasVertexTangents:!!t.attributes.tangent,normalType:h?E.W.Attribute:E.W.ScreenDerivative,castShadows:!0,receiveShadows:l.receiveShadows,receiveAmbientOcclusion:l.receiveAmbientOcclustion,textureId:null!=_?_.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:null!=l.textureNormal&&u?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:null!=_&&!!_.parameters.preMultiplyAlpha,occlusionTextureId:null!=l.textureOcclusion&&u?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:null!=l.textureEmissive&&u?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:null!=l.textureMetallicRoughness&&u?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[m,g,y],mrrFactors:v?[...F.mX]:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:v,colorTextureTransformMatrix:(0,T.G)(l.colorTextureTransform),normalTextureTransformMatrix:(0,T.G)(l.normalTextureTransform),scale:[b[0],b[1]],occlusionTextureTransformMatrix:(0,T.G)(l.occlusionTextureTransform),emissiveTextureTransformMatrix:(0,T.G)(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:(0,T.G)(l.metallicRoughnessTextureTransform),...n}))}const p=s.get(a);if(r.stageResources.materials.push(p),u){const e=e=>{null!=e&&r.stageResources.textures.push(o.get(e))};e(l.textureColor),e(l.textureNormal),e(l.textureOcclusion),e(l.textureEmissive),e(l.textureMetallicRoughness)}return p}(o,e,C,t,r,l,u),{geometry:a,vertexCount:h}=function(e,t){const r=e.attributes.position.count,i=(0,x.x)(e.indices||r,e.primitiveType),o=(0,p.oe)(3*r),{typedBuffer:a,typedBufferStride:l}=e.attributes.position;(0,m.a)(o,a,e.transform,3,l);const c=[[L.r.POSITION,new R.n(o,i,3,!0)]];if(null!=e.attributes.normal){const t=(0,p.oe)(3*r),{typedBuffer:o,typedBufferStride:a}=e.attributes.normal;(0,s.Ge)(z,e.transform),(0,m.t)(t,o,z,3,a),(0,n.or)(z)&&(0,m.n)(t,t),c.push([L.r.NORMAL,new R.n(t,i,3,!0)])}if(null!=e.attributes.tangent){const t=(0,p.oe)(4*r),{typedBuffer:o,typedBufferStride:a}=e.attributes.tangent;(0,s.z0)(z,e.transform),(0,g.t)(t,o,z,4,a),(0,n.or)(z)&&(0,m.n)(t,t,4),c.push([L.r.TANGENT,new R.n(t,i,4,!0)])}if(null!=e.attributes.texCoord0){const t=(0,p.oe)(2*r),{typedBuffer:n,typedBufferStride:s}=e.attributes.texCoord0;(0,y.n)(t,n,2,s),c.push([L.r.UV0,new R.n(t,i,2,!0)])}const u=e.attributes.color;if(null!=u){const t=new Uint8Array(4*r);4===u.elementCount?u instanceof f.Eq?(0,g.s)(t,u,255):u instanceof f.XP?(0,v.c)(t,u):u instanceof f.Uz&&(0,g.s)(t,u,1/256):(t.fill(255),u instanceof f.xs?(0,m.s)(t,u.typedBuffer,255,4,u.typedBufferStride):e.attributes.color instanceof f.eI?(0,_.c)(t,u.typedBuffer,4,e.attributes.color.typedBufferStride):e.attributes.color instanceof f.nS&&(0,m.s)(t,u.typedBuffer,1/256,4,u.typedBufferStride)),c.push([L.r.COLOR,new R.n(t,i,4,!0)])}return{geometry:new O.V(t,c),vertexCount:r}}(e,null!=i?i:new N.$U({})),A=a.boundingInfo;null!=A&&0===w&&((0,d.iT)(b,A.bbMin),(0,d.iT)(b,A.bbMax)),null!=i&&(C.stageResources.geometries.push(a),C.numberOfVertices+=h)})),M||a.push(C)})),{engineResources:a,referenceBoundingBox:b}}(o,V,B,t.skipHighLods&&null==r.specifiedLodIndex?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:j,referenceBoundingBox:H,isEsriSymbolResource:o.meta.isEsriSymbolResource,isWosr:!1}}const z=(0,o.vt)()},82250:(e,t,r)=>{"use strict";r.d(t,{Dt:()=>c,Ir:()=>h,QE:()=>l,RH:()=>d,Zd:()=>a,cN:()=>o,fy:()=>u,xU:()=>p});var i=r(19555),n=r(72745),s=r(42510);const o=Object.freeze({left:0,center:.5,right:1}),a=Object.freeze({"bottom-left":(0,n.fA)(0,0),bottom:(0,n.fA)(.5,0),"bottom-right":(0,n.fA)(1,0),left:(0,n.fA)(0,.5),center:(0,n.fA)(.5,.5),right:(0,n.fA)(1,.5),"top-left":(0,n.fA)(0,1),top:(0,n.fA)(.5,1),"top-right":(0,n.fA)(1,1)});function l(e){switch(e){case"left":return s.lV.Left;case"right":return s.lV.Right;default:return s.lV.Center}}function c(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function u(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function h(e,t){switch(t){case"bottom":return"left"===e?"bottom-left":"right"===e?"bottom-right":"bottom";case"center":return e;case"top":return"left"===e?"top-left":"right"===e?"top-right":"top"}}function d(e){return"middle"===e?"center":e}function p(e,t){switch(e){case"top":return(0,i.hZ)(t,0,s.Xd);case"bottom":return(0,i.hZ)(t,0,-s.Xd);default:return(0,i.C)(t,n.uY)}}},88265:(e,t,r)=>{"use strict";r.d(t,{R$:()=>g,SZ:()=>h,ZX:()=>m,d2:()=>f,hS:()=>d});var i=r(9392),n=r(64232),s=r(42294),o=r(5262),a=r(18117),l=r(67425),c=r(36423),u=r(37046);function h(e,t,r,i,n){if(p(e,t))return null;r.localOrigin=g(e,t);const s=new u.B({geometries:[r],castShadow:!1,layerUid:e.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0});return{object:s,sampledElevation:(0,l.fe)(s,t,e.elevationProvider,e.renderCoordsHelper,i)}}function d(e,t,r,i){return p(t,r)?null:(0,l.fe)(e,r,t.elevationProvider,t.renderCoordsHelper,i)}function p(e,t){const r=e.clippingExtent;return!!r&&((0,n.g)(t,y,e.elevationProvider.spatialReference),!(0,s.Uc)(r,y))}function f(e,t,r){const i=e.elevationContext,s=r.spatialReference;(0,n.g)(t,y,s),i.centerPointInElevationSR=(0,a.T)(y[0],y[1],t.hasZ?y[2]:0,null!=s?s:null)}function m(e){switch(e.type){case"point":return e;case"polygon":case"extent":return(0,c.W$)(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const r=(0,o.$H)(t,(0,o.Yl)(t)/2);return(0,a.T)(r[0],r[1],r[2],e.spatialReference)}case"mesh":return e.origin}return null}function g(e,t){return(0,n.g)(t,y,e.renderCoordsHelper.spatialReference),e.localOriginFactory.getOrigin(y)}const y=(0,i.vt)()},73177:(e,t,r)=>{"use strict";r.d(t,{_:()=>o,k:()=>s});r(81806);var i=r(62577),n=r(12062);function s(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function o(e,t){const r=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new n.Fe(e.map((e=>{const s=t(e.tesselation);return r&&(0,i.zC)(s),new n.hr([new n.iC(s)],e.minScreenSpaceRadius)})))};switch(e){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],(e=>(0,i.uX)(t,.5,e,!0)));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],(()=>(0,i.C1)(t,1)));case"cone":return r(a,(e=>(0,i.EE)(t,1,.5,e,!1)),!0);case"inverted-cone":return r(a,(e=>(0,i.EE)(t,1,.5,e,!0)),!0);case"cylinder":return r(a,(e=>(0,i.nW)(t,1,.5,e,[0,0,1],[0,0,.5])));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],(()=>(0,i.Ho)(t,1)),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],(()=>(0,i.td)(t,1)),!0);default:return}}const a=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]},14766:(e,t,r)=>{"use strict";r.d(t,{FJ:()=>A,Hh:()=>S});var i=r(3825),n=r(98773),s=r(21499),o=r(50076),a=r(76460),l=r(75941),c=r(50346),u=r(19898),h=r(9392),d=r(42294),p=r(38496),f=r(49003),m=r(50468),g=r(83490),y=r(51799),_=r(96897),v=r(66470),b=r(65131),w=r(93345);const x=()=>a.A.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function S(e,t){const r=await async function(e,t){const r=t?.streamDataRequester;if(r)return async function(e,t,r){const i=await(0,n.Ke)(t.request(e,"json",r));if(!0===i.ok)return i.value;(0,c.QP)(i.error),T(i.error.details.url)}(e,r,t);const s=await(0,n.Ke)((0,i.A)(e,t));if(!0===s.ok)return s.value.data;(0,c.QP)(s.error),T(s.error)}(e,t),o=await async function(e,t){const r=new Array;for(const s in e){const i=e[s],n=i.images[0].data;if(!n){x().warn("Externally referenced texture data is not yet supported");continue}const o=i.encoding+";base64,"+n,a="/textureDefinitions/"+s,l="rgba"===i.channels?i.alphaChannelUsage||"transparency":"none",c={noUnpackFlip:!0,wrap:{s:w.pF.REPEAT,t:w.pF.REPEAT},preMultiplyAlpha:E(l)!==g.sf.Opaque},u=t?.disableTextures?Promise.resolve(null):(0,f.D)(o,t);r.push(u.then((e=>({refId:a,image:e,parameters:c,alphaChannelUsage:l}))))}const i=await Promise.all(r),n={};for(const s of i)n[s.refId]=s;return n}(r.textureDefinitions??{},t);let a=0;for(const i in o)if(o.hasOwnProperty(i)){const e=o[i];a+=e?.image?e.image.width*e.image.height*4:0}return{resource:r,textures:o,size:a+(0,s.iL)(r)}}function T(e){throw new o.A("",`Request for object resource failed: ${e}`)}function M(e){const t=e.params,r=t.topology;let i=!0;switch(t.vertexAttributes||(x().warn("Geometry must specify vertex attributes"),i=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const e=t.faces;if(e){if(t.vertexAttributes)for(const r in t.vertexAttributes){const t=e[r];t?.values?(null!=t.valueType&&"UInt32"!==t.valueType&&(x().warn(`Unsupported indexed geometry indices type '${t.valueType}', only UInt32 is currently supported`),i=!1),null!=t.valuesPerElement&&1!==t.valuesPerElement&&(x().warn(`Unsupported indexed geometry values per element '${t.valuesPerElement}', only 1 is currently supported`),i=!1)):(x().warn(`Indexed geometry does not specify face indices for '${r}' attribute`),i=!1)}}else x().warn("Indexed geometries must specify faces"),i=!1;break}default:x().warn(`Unsupported topology '${r}'`),i=!1}e.params.material||(x().warn("Geometry requires material"),i=!1);const n=e.params.vertexAttributes;for(const s in n)n[s].values||(x().warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function A(e,t){const r=new Array,i=new Array,n=new Array,s=new l.O,o=e.resource,a=u.R.parse(o.version||"1.0","wosr");P.validate(a);const c=o.model.name,d=o.model.geometries,f=o.materialDefinitions??{},w=e.textures;let x=0;const S=new Map;for(let l=0;l<d.length;l++){const e=d[l];if(!M(e))continue;const o=R(e),a=e.params.vertexAttributes,c=[],u=t=>{if("PerAttributeArray"===e.params.topology)return null;const r=e.params.faces;for(const e in r)if(e===t)return r[e].values;return null},T=a[v.r.POSITION],A=T.values.length/T.valuesPerElement;for(const t in a){const e=a[t],r=e.values,i=u(t)??(0,p.tM)(A);c.push([t,new m.n(r,i,e.valuesPerElement,!0)])}const C=o.texture,P=w&&w[C];if(P&&!S.has(C)){const{image:e,parameters:t}=P,r=new _.g(e,t);i.push(r),S.set(C,r)}const O=S.get(C),I=O?O.id:void 0,L=o.material;let N=s.get(L,C);if(null==N){const e=f[L.substring(L.lastIndexOf("/")+1)].params;1===e.transparency&&(e.transparency=0);const r=P&&P.alphaChannelUsage,i=e.transparency>0||"transparency"===r||"maskAndTransparency"===r,n=P?E(P.alphaChannelUsage):void 0,o={ambient:(0,h.ci)(e.diffuse),diffuse:(0,h.ci)(e.diffuse),opacity:1-(e.transparency||0),transparent:i,textureAlphaMode:n,textureAlphaCutoff:.33,textureId:I,initTextureTransparent:!0,doubleSided:!0,cullFace:g.s2.None,colorMixMode:e.externalColorMixMode||"tint",textureAlphaPremultiplied:P?.parameters.preMultiplyAlpha??!1};t?.materialParameters&&Object.assign(o,t.materialParameters),N=new b.$U(o),s.set(L,C,N)}n.push(N);const D=new y.V(N,c);x+=c.find((e=>e[0]===v.r.POSITION))?.[1]?.indices.length??0,r.push(D)}return{engineResources:[{name:c,stageResources:{textures:i,materials:n,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:x,lodThreshold:null}],referenceBoundingBox:C(r)}}function C(e){const t=(0,d.Ie)();return e.forEach((e=>{const r=e.boundingInfo;null!=r&&((0,d.iT)(t,r.bbMin),(0,d.iT)(t,r.bbMax))})),t}function E(e){switch(e){case"mask":return g.sf.Mask;case"maskAndTransparency":return g.sf.MaskBlend;case"none":return g.sf.Opaque;default:return g.sf.Blend}}function R(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const P=new u.R(1,2,"wosr")},45270:(e,t,r)=>{"use strict";r.d(t,{Aw:()=>c,Jb:()=>l,Q5:()=>d,W3:()=>p,d:()=>o,db:()=>h,kV:()=>u,rb:()=>a});var i=r(3112),n=r(35737),s=r(46571);class o extends n.R6{constructor(e,t,r,i){super(t,r),this.point=e,this.createGraphic=i}}function a(e){return(0,s.i3)(e)&&e.intersector===i.dz.PCL&&!!e.target}class l extends n.HE{constructor(e,t,r,i,n){super(e),this.layerUid=e,this.sublayerUid=t,this.nodeIndex=r,this.componentIndex=i,this.triangleNr=n}}class c extends n.R6{constructor(e,t,r){super(t,null),this.point=e,this.createVoxelGraphic=r}}class u extends n.R6{constructor(e,t){super(e,null),this.createTiles3DGraphic=t}}function h(e){return(0,s.i3)(e)&&e.intersector===i.dz.I3S&&!!e.target}function d(e){return(0,s.i3)(e)&&e.intersector===i.dz.VOXEL&&!!e.target}function p(e){return(0,s.i3)(e)&&e.intersector===i.dz.TILES3D&&!!e.target}},57662:(e,t,r)=>{"use strict";var i,n,s;r.d(t,{O7:()=>n,Om:()=>i,sv:()=>s}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(i||(i={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(n||(n={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(s||(s={}))},63048:(e,t,r)=>{"use strict";r.d(t,{Gd:()=>D,J_:()=>L,VC:()=>z,b3:()=>k,s_:()=>I,ul:()=>U,wI:()=>R});r(81806);var i,n,s=r(15941),o=r(63919),a=r(44680),l=r(34761),c=r(13191),u=r(20664),h=r(9392),d=r(3454),p=r(22955),f=r(64839);!function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"}(i||(i={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(n||(n={}));class m{constructor(e){this.field=e}}class g extends m{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[i.Undefined,i.Undefined,i.Undefined]}}class y extends m{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}}class _ extends m{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}}class v{}function b(e){return null!=e}function w(e){return"number"==typeof e}function x(e){return"string"==typeof e}function S(e,t){e&&e.push(t)}function T(e,t,r,n,s){const o=e.minSize,a=e.maxSize;if(e.useSymbolValue){const e=n.symbolSize[r];return t.minSize[r]=e,t.maxSize[r]=e,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=i.DefinedSize,!0}if(b(e.field))return b(e.stops)?2===e.stops.length&&w(e.stops[0].size)&&w(e.stops[1].size)?(M(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=i.DefinedSize,!0):(S(s,"Could not convert size info: stops only supported with 2 elements"),!1):w(o)&&w(a)&&b(e.minDataValue)&&b(e.maxDataValue)?(M(o,a,e.minDataValue,e.maxDataValue,t,r),t.type[r]=i.DefinedSize,!0):"unknown"===e.valueUnit?(S(s,"Could not convert size info: proportional size not supported"),!1):null!=d.j[e.valueUnit]?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/d.j[e.valueUnit],t.type[r]=i.DefinedSize,!0):(S(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!b(e.field)){if(e.stops?.[0]&&w(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=i.DefinedSize,!0;if(w(o))return t.minSize[r]=o,t.maxSize[r]=o,t.offset[r]=o,t.factor[r]=0,t.type[r]=i.DefinedSize,!0}return S(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function M(e,t,r,i,n,s){const o=Math.abs(i-r)>0?(t-e)/(i-r):0;n.minSize[s]=o>0?e:t,n.maxSize[s]=o>0?t:e,n.offset[s]=e-r*o,n.factor[s]=o}function A(e,t,r,i){if(e.normalizationField||e.valueRepresentation)return S(i,"Could not convert size info: unsupported property"),null;if(!function(e){return null==e||x(e)}(e.field))return S(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return S(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size=new g(e.field);let n;switch(e.axis){case"width":return n=T(e,t.size,0,r,i),n?t:null;case"height":return n=T(e,t.size,2,r,i),n?t:null;case"depth":return n=T(e,t.size,1,r,i),n?t:null;case"width-and-depth":return n=T(e,t.size,0,r,i),n&&T(e,t.size,1,r,i),n?t:null;case null:case void 0:case"all":return n=T(e,t.size,0,r,i),n=n&&T(e,t.size,1,r,i),n=n&&T(e,t.size,2,r,i),n?t:null;default:return S(i,`Could not convert size info: unknown axis "${e.axis}""`),null}}function C(e,t,r){e[4*t]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function E(e,t,r){const i=2===r&&"arithmetic"===e.rotationType;t.offset[r]=i?90:0,t.factor[r]=i?-1:1,t.type[r]=1}class R{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1,1],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0,0],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0,0];this.supports=e,this.modelSize=t,this.symbolSize=r,this.unitInMeters=i,this.anchor=n,this.scale=s,this.rotation=o}}function P(e,t,r){if(!e)return null;const n=e.reduce(((e,i)=>{if(!e)return e;if(i.valueExpression)return S(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(i.type){case"size":return t.supports.size?A(i,e,t,r):e;case"color":return t.supports.color?function(e,t,r){if(e.normalizationField)return S(r,"Could not convert color info: unsupported property"),null;if(x(e.field)){if(!e.stops)return S(r,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return S(r,"Could not convert color info: too many color stops"),null;t.color=new y(e.field);const i=e.stops;for(let e=0;e<8;++e){const r=i[Math.min(e,i.length-1)];t.color.values[e]=r.value,C(t.color.colors,e,r.color)}}}else{if(!(e.stops&&e.stops.length>=0))return S(r,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.color.values[e]=1/0,C(t.color.colors,e,r)}}return t}(i,e,r):e;case"opacity":return t.supports.opacity?function(e,t,r){if(e.normalizationField)return S(r,"Could not convert opacity info: unsupported property"),null;if(x(e.field)){if(!e.stops)return S(r,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return S(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity=new _(e.field);const i=e.stops;for(let e=0;e<8;++e){const r=i[Math.min(e,i.length-1)];t.opacity.values[e]=r.value,t.opacity.opacityValues[e]=r.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return S(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=r}}return t}(i,e,r):null;case"rotation":return t.supports.rotation?function(e,t,r){if(!x(e.field))return S(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return S(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return E(e,t.rotation,0),t;case"roll":return E(e,t.rotation,1),t;case null:case void 0:case"heading":return E(e,t.rotation,2),t;default:return S(r,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}(i,e,r):e;default:return null}}),new v);return!(e.length>0&&n)||n.size||n.color||n.opacity||n.rotation?n?.size&&!function(e,t,r){for(let s=0;s<3;++s){let r=t.unitInMeters;e.type[s]===i.DefinedSize&&(r*=t.modelSize[s],e.type[s]=i.DefinedScale),e.minSize[s]=e.minSize[s]/r,e.maxSize[s]=e.maxSize[s]/r,e.offset[s]=e.offset[s]/r,e.factor[s]=e.factor[s]/r}let n;if(e.type[0]!==i.Undefined)n=0;else if(e.type[1]!==i.Undefined)n=1;else{if(e.type[2]===i.Undefined)return S(r,"No size axis contains a valid size or scale"),!1;n=2}for(let s=0;s<3;++s)e.type[s]===i.Undefined&&(e.minSize[s]=e.minSize[n],e.maxSize[s]=e.maxSize[n],e.offset[s]=e.offset[n],e.factor[s]=e.factor[n],e.type[s]=e.type[n]);return!0}(n.size,t,r)?null:n:null}class O{constructor(e,t,r){this.visualVariables=e,this.materialParameters=t,this.requiresShaderTransformation=r}}function I(e,t){if(!e)return null;if(p.b.TESTS_DISABLE_FAST_UPDATES)return null;const r=P(e.visualVariables,t);return r?new O(r,F(r,t),!!r.size):null}function L(e,t,r){if(!t||!e)return!1;const i=e.visualVariables,n=P(t.visualVariables,r);return!!n&&!!(N(i.size,n.size,"size")&&N(i.color,n.color,"color")&&N(i.rotation,n.rotation,"rotation")&&N(i.opacity,n.opacity,"opacity"))&&(e.visualVariables=n,e.materialParameters=F(n,r),e.requiresShaderTransformation=!!n.size,!0)}function N(e,t,r){if(!!e!=!!t)return!1;if(e&&e.field!==t?.field)return!1;if(e&&"rotation"===r){const r=e,i=t;for(let e=0;e<3;e++)if(r.type[e]!==i.type[e]||r.offset[e]!==i.offset[e]||r.factor[e]!==i.factor[e])return!1}return!0}class D extends f.Y{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}}function F(e,t){const r=new D(e);return r.vvSize&&(r.vvSymbolAnchor=t.anchor,(0,l.D_)(j),function(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,c.vt)();const n=e||0,s=t||0,o=r||0;0!==n&&(0,l.Qr)(i,i,-n/180*Math.PI),0!==s&&(0,l.eL)(i,i,s/180*Math.PI),0!==o&&(0,l.Z8)(i,i,o/180*Math.PI)}(t.rotation[2],t.rotation[0],t.rotation[1],j),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||(0,a.vt)(),(0,o.z0)(r.vvSymbolRotationMatrix,j)),r}function k(e,t,r){if(!e.vvSize)return r;(0,l.C)(V,r);const i=e.vvSymbolRotationMatrix;(0,l.hZ)(j,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),(0,l.lw)(V,V,j);for(let n=0;n<3;++n){const r=e.vvSize.offset[n]+t[0]*e.vvSize.factor[n];B[n]=(0,s.qE)(r,e.vvSize.minSize[n],e.vvSize.maxSize[n])}return(0,l.hs)(V,V,B),(0,l.Tl)(V,V,e.vvSymbolAnchor),V}function z(e,t,r){if(!t.vvSize)return(0,u.s)(e,1,1,1),e;for(let i=0;i<3;++i){const n=t.vvSize.offset[i]+r[0]*t.vvSize.factor[i];e[i]=(0,s.qE)(n,t.vvSize.minSize[i],t.vvSize.maxSize[i])}return e}function U(e,t){const r=null==e?0:t.attributes[e];return"number"==typeof r&&isFinite(r)?r:0}const V=(0,c.vt)(),B=(0,h.vt)(),j=(0,c.vt)()},33836:(e,t,r)=>{"use strict";r.d(t,{J:()=>s,b:()=>i});var i,n=r(2413);class s{constructor(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.lij=[0,0,0],this.extent=(0,n.vt)(),this.resolution=0,this.loadPriority=0,this.measures={visibility:i.VISIBLE_ON_SURFACE,screenRect:(0,n.vt)(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,t,r,s)}acquire(e,t,r,i){this.tilingScheme=i,this.id=s.id(e,t,r),this.lij[0]=e,this.lij[1]=t,this.lij[2]=r,i.getExtent(e,t,r,this.extent),this.resolution=i.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const t=this.lij[0]+1,r=2*this.lij[1],i=2*this.lij[2];return e?(e[0].acquire(t,r,i,this.tilingScheme),e[1].acquire(t,r+1,i,this.tilingScheme),e[2].acquire(t,r,i+1,this.tilingScheme),e[3].acquire(t,r+1,i+1,this.tilingScheme),e):[new s(t,r,i,this.tilingScheme),new s(t,r+1,i,this.tilingScheme),new s(t,r,i+1,this.tilingScheme),new s(t,r+1,i+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,(0,n.C)(e.measures.screenRect,this.measures.screenRect)}static id(e,t,r){return`${e}/${t}/${r}`}}!function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",e[e.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"}(i||(i={}))},65768:(e,t,r)=>{"use strict";r.d(t,{P:()=>i,T:()=>n});class i{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;this.usedMemory=e,this.displayedFeatures=t,this.totalFeatures=r,this.maximumFeatures=i,this.nodes=n,this.core=s}}function n(e){return"performanceInfo"in e}},7342:(e,t,r)=>{"use strict";r.d(t,{Cc:()=>c,Qo:()=>u,CC:()=>h,RF:()=>l});var i=r(69539),n=(r(81806),r(76931)),s=r(55855);var o=r(46702),a=r(28014);function l(e){return e&&e.enabled&&(function(e){return"extrude"===e.type}(e)||function(e){return"fill"===e.type}(e))&&null!=e.edges}function c(e,t){return u(function(e){return e&&e.enabled&&e.edges||null}(e),t)}function u(e,t){if(null==e)return null;const r=null!=e.color?(0,s.ci)(i.A.toUnitRGBA(e.color)):(0,s.fA)(0,0,0,0),o=(0,n.Lz)(e.size),l=(0,n.Lz)(e.extensionLength);switch(e.type){case"solid":return h({color:r,size:o,extensionLength:l,...t});case"sketch":return function(e){return{...p,...e,type:a.gP.Sketch}}({color:r,size:o,extensionLength:l,...t});default:return}}function h(e){return{...d,...e,type:a.gP.Solid}}const d={color:(0,s.fA)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:o.x.OPAQUE,hasSlicePlane:!1},p={color:(0,s.fA)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:o.x.OPAQUE,hasSlicePlane:!1}},51990:(e,t,r)=>{"use strict";r.d(t,{Eb:()=>s,_j:()=>o,k5:()=>i});var i,n=r(15941);function s(e){switch(e){case"multiply":default:return i.Multiply;case"ignore":return i.Ignore;case"replace":return i.Replace;case"tint":return i.Tint}}function o(e,t,r){if(null==e||t===i.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const s=(0,n.qE)(Math.round(e[3]*l),0,l),o=0===s||t===i.Tint?0:t===i.Replace?c:u;r[0]=(0,n.qE)(Math.round(e[0]*a),0,a),r[1]=(0,n.qE)(Math.round(e[1]*a),0,a),r[2]=(0,n.qE)(Math.round(e[2]*a),0,a),r[3]=s+o}!function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"}(i||(i={}));const a=255,l=85,c=l,u=2*l},61985:(e,t,r)=>{"use strict";r.d(t,{P:()=>o});var i=r(20664),n=r(9392),s=r(4763);class o{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=(0,s.vt)(),this._points=(0,s.Qy)(),this.lines=new Array(12),this._origin=(0,n.vt)(),this._direction=(0,n.vt)(),this._altitude=null;for(let t=0;t<12;t++)this.lines[t]={origin:null,direction:(0,n.vt)(),endpoint:null}}update(e){(0,s.ui)(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),(0,i.c)(this._origin,e.eye),(0,i.c)(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let t=0;t<this._points.length;t++)(0,i.c)(this._points[t],e[t]);(0,s.DV)(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return(0,s.m7)(this.frustum,e)}intersectsRay(e){return(0,s.pw)(this.frustum,e)}intersectsLineSegment(e,t){return(0,s.ST)(this.frustum,e,t)}intersectsPoint(e){return(0,s.bU)(this.frustum,e)}_updateLines(){const e=this._points;for(let t=0;t<4;t++){const r=t+4;a(this.lines[t],e[t],e[r]),a(this.lines[t+4],e[t],3===t?e[0]:e[t+1]),a(this.lines[t+8],e[r],3===t?e[4]:e[r+1])}}}function a(e,t,r){e.origin=t,e.endpoint=r,(0,i.E)(e.direction,t,r)}o.planePointIndices=s.c8,o.nearFarLineIndices=[[s.J7.NEAR_BOTTOM_LEFT,s.J7.FAR_BOTTOM_LEFT],[s.J7.NEAR_BOTTOM_RIGHT,s.J7.FAR_BOTTOM_RIGHT],[s.J7.NEAR_TOP_RIGHT,s.J7.FAR_TOP_RIGHT],[s.J7.NEAR_TOP_LEFT,s.J7.FAR_TOP_LEFT]]},80935:(e,t,r)=>{"use strict";r.d(t,{R1:()=>o,aY:()=>n,cN:()=>s});var i=r(81284);class n{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.array=e,this.spatialReference=t,this.offset=r}}function s(e){return"array"in e}function o(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if((0,i.v)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(s(t)){let i=t.offset;return e.getElevation(t.array[i++],t.array[i++],t.array[i]||0,t.spatialReference??e.spatialReference,r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}},95225:(e,t,r)=>{"use strict";r.d(t,{H:()=>i});class i{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0;this.elevationRangeMin=e,this.elevationRangeMax=t}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,t){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,t)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}}},15255:(e,t,r)=>{"use strict";r.d(t,{L:()=>n});var i=r(2413);class n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scene";this.context=e,this.extent=(0,i.Ie)()}}},53574:(e,t,r)=>{"use strict";r.d(t,{O:()=>S});var i=r(4212),n=r(15941),s=r(34761),o=r(13191),a=r(20664),l=r(9392),c=r(34111),u=r(5809),h=r(50840),d=r(14487),p=r(42294),f=r(2413),m=r(4763),g=r(44230),y=r(13927),_=r(95925),v=r(64465),b=r(70335);const w=.5*Math.PI,x=w/Math.PI*180;class S{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:(0,l.vt)(),direction:(0,l.vt)()};for(let t=0;t<4;t++)this._extent[t]={origin:(0,l.vt)(),direction:(0,l.vt)(),cap:{next:null,direction:(0,l.vt)()}},this._planes[t]=(0,y.vt)();this._planes[m.FB.NEAR]=(0,y.vt)(),this._planes[m.FB.FAR]=(0,y.vt)(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,t,r){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const n=this._extent;this._toRenderBoundingExtent(e,t,r),(0,a.g)(this._center.origin,n[0].origin,n[2].origin),(0,a.j)(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),i||(0,a.j)(this._center.direction,this._center.direction,-1);for(let s=0;s<4;s++){const e=n[s];this._renderCoordsHelper.worldUpAtPosition(e.origin,e.direction);const t=n[3===s?0:s+1];e.cap.next=t.origin,(0,a.E)(e.cap.direction,e.origin,t.origin),(0,y.mR)(e.direction,e.cap.direction,e.origin,this._planes[s]),i||(0,a.j)(e.direction,e.direction,-1)}(0,y.mR)(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[m.FB.NEAR]),i?(0,y.ze)(this._planes[m.FB.NEAR],this._planes[m.FB.FAR]):((0,y.C)(this._planes[m.FB.FAR],this._planes[m.FB.NEAR]),(0,y.ze)(this._planes[m.FB.NEAR],this._planes[m.FB.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=t,this._minGlobalAltitude=.9*(0,c.tO)(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e)return!1;if(this._renderCoordsHelper.viewingMode===v.RT.Global){const r=this._maxSpanSpatialReference.isGeographic?x:w*t;if(this._maxSpan>r)return!0;if(null!=e.altitude&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(0===this._maxSpan){const t=this._extent[0];return!(r||!e.intersectsRay((0,_.LV)(t.origin,t.direction)))}for(let n=0;n<this._extent.length;n++){const t=this._extent[n];if(!r&&e.intersectsRay((0,_.LV)(t.origin,t.direction)))return!0;if(e.intersectsLineSegment((0,g.Cr)(t.origin,t.cap.next,P),t.cap.direction))return!0}const i=r?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const t=e.lines[n];if((0,b.Sc)(i,t.origin,t.endpoint,t.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,t,r){(0,f.gX)(e,M),M[2]=r,(0,u.l)(t,M,A,this._renderCoordsHelper.spatialReference),(0,s.B8)(C,A),(0,p.Ie)(E);for(const{x0:i,x1:s,y0:o,y1:l}of T)for(let c=0;c<5;c++){const u=c/4;M[0]=(0,n.Cc)(e[i],e[s],u),M[1]=(0,n.Cc)(e[o],e[l],u),M[2]=r,(0,d.F)(M,t,M,this._renderCoordsHelper.spatialReference),(0,a.h)(M,M,C),(0,p.iT)(E,M)}(0,a.s)(this._extent[0].origin,E[0],E[1],E[2]),(0,a.s)(this._extent[1].origin,E[3],E[1],E[2]),(0,a.s)(this._extent[2].origin,E[3],E[4],E[2]),(0,a.s)(this._extent[3].origin,E[0],E[4],E[2]);for(let i=0;i<4;++i)(0,a.h)(this._extent[i].origin,this._extent[i].origin,A)}_toRenderBoundingExtentLocal(e,t,r){(0,h.S)(e,t,R,this._renderCoordsHelper.spatialReference),(0,a.s)(this._extent[0].origin,R[0],R[1],r),(0,a.s)(this._extent[1].origin,R[2],R[1],r),(0,a.s)(this._extent[2].origin,R[2],R[3],r),(0,a.s)(this._extent[3].origin,R[0],R[3],r)}_toRenderBoundingExtent(e,t,r){switch(this._renderCoordsHelper.viewingMode){case v.RT.Global:this._toRenderBoundingExtentGlobal(e,t,r);break;case v.RT.Local:this._toRenderBoundingExtentLocal(e,t,r);break;default:(0,i.Xb)(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(e){if((0,y.mN)(e.planes[m.FB.NEAR],this._center.origin)<0&&(0,a.m)(this._center.direction,e.direction)<0)return!0;for(let t=0;t<4;t++){const r=this._extent[t];if((0,y.mN)(e.planes[m.FB.NEAR],r.origin)<0&&(0,a.m)(r.direction,e.direction)<0)return!0}return!1}}const T=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],M=(0,l.vt)(),A=(0,o.vt)(),C=(0,o.vt)(),E=(0,p.vt)(),R=(0,f.vt)(),P=(0,g.vt)()},69495:(e,t,r)=>{"use strict";r.d(t,{G:()=>h,w:()=>u});var i=r(35143),n=r(91967),s=(r(81806),r(76460)),o=r(79369),a=r(52394),l=r(46053),c=(r(47249),r(85842));function u(e){return new d({view:e})}const h=.1;let d=class extends n.A{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new o.F,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles((0,a.mg)({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){null==e||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(1),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){null!=e&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,t){return new o.Mn(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<.6&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(1);else if(e)(this._memoryPredicted>1.1||this._usedMemory>1)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>h&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>1)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<.75&&this._quality<1){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,h),1))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some((e=>!!e.updating))}_updateMemory(){if(!this.view)return;this.view._stage?.renderer?.tick();const e=this.view._stage?.renderer?.usedMemory;let t=(this.view.basemapTerrain?.usedMemory??0)+(e?e.fbos+e.edges+e.plugins:0),r=0;this.view.allLayerViews&&this.view.allLayerViews.forEach((e=>{if(function(e){return"usedMemory"in e&&"unloadedMemory"in e&&"ignoresMemoryFactor"in e}(e)){const i=e.ignoresMemoryFactor?this._quality:1;t+=e.usedMemory*i,r+=e.unloadedMemory*i}}));const i=null==this._warnMemoryUsage||Math.round(10*t)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(t>n&&i){this._warnMemoryUsage=t;const e=e=>(e/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",i=Math.round(100*this._quality);s.A.getLogger(this).warn(`Memory Limit exceeded! Limit: ${e(n)} Current: ${e(t)} Projected: ${e(t+r)} Quality: ${i}%`)}this._usedMemory=t/n,this._memoryPredicted=(t+r)/n;const o=n-t;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){}};(0,i._)([(0,l.MZ)({constructOnly:!0})],d.prototype,"view",void 0),(0,i._)([(0,l.MZ)()],d.prototype,"maxMemory",null),(0,i._)([(0,l.MZ)()],d.prototype,"additionalCacheMemory",null),(0,i._)([(0,l.MZ)({readOnly:!0})],d.prototype,"memoryFactor",null),(0,i._)([(0,l.MZ)({readOnly:!0})],d.prototype,"updating",null),(0,i._)([(0,l.MZ)({readOnly:!0})],d.prototype,"usedMemory",null),(0,i._)([(0,l.MZ)({readOnly:!0})],d.prototype,"usedCacheMemory",null),(0,i._)([(0,l.MZ)()],d.prototype,"_quality",void 0),(0,i._)([(0,l.MZ)()],d.prototype,"_usedMemory",void 0),(0,i._)([(0,l.MZ)()],d.prototype,"_updating",void 0),(0,i._)([(0,l.MZ)()],d.prototype,"_stableQuality",void 0),(0,i._)([(0,l.MZ)()],d.prototype,"_maxMemory",void 0),(0,i._)([(0,l.MZ)()],d.prototype,"_additionalCacheMemory",void 0),d=(0,i._)([(0,c.$)("esri.views.3d.support.MemoryController")],d)},48606:(e,t,r)=>{"use strict";r.d(t,{M:()=>s});var i=r(92154),n=r(68452);class s{constructor(e,t){this._owner=t,this._properties={},this._afterDispatchHandle=null;for(const r in e){const t=e[r],n=new i.P(t,void 0,void 0,2,2);this._properties[r]={pool:n,acquired:[]}}this._afterDispatchHandle=(0,n.rs)((()=>this._release()))}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const t=this._properties[e];for(const e of t.acquired)(0,n.Gs)(e)||t.pool.release(e);t.pool.destroy(),t.pool=null,t.acquired=null}this._properties=null,this._owner=null}get(e){const t=this._owner._get(e),r=this._properties[e];let i=r.pool.acquire();for(r.acquired.push(i);i===t;)r.acquired.push(i),i=r.pool.acquire();return i}_release(){for(const e in this._properties){const t=this._properties[e];let r=0;for(const e of t.acquired)(0,n.Gs)(e)?t.acquired[r++]=e:t.pool.release(e);t.acquired.length=r}}}},74487:(e,t,r)=>{"use strict";r.d(t,{d:()=>v});var i=r(15941),n=r(31633),s=r(34761),o=r(20664),a=r(34111),l=r(98510),c=r(64232),u=r(60216),h=r(14487),d=r(5568),p=r(88954),f=r(13927),m=r(96190),g=r(75762),y=r(81284),_=r(64465);class v{constructor(e,t,r,i){this.viewingMode=e,this.spatialReference=t,this.unitInMeters=r,this._coordinateSystem=i,this._tmpCoordinateSystem=(0,p.vt)(i),this.referenceEllipsoid=(0,a.tO)(t),this.sphericalPCPF=(0,l.lO)(t)}set extent(e){e&&(0,p.b)(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return(0,p.US)(this._coordinateSystem,e)}setAltitude(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;return(0,p.E$)(this._coordinateSystem,r,t,e)}setAltitudeOfTransformation(e,t){(0,p.Jq)(this._coordinateSystem,t,e,t)}worldUpAtPosition(e,t){return(0,p.jI)(this._coordinateSystem,e,t)}worldBasisAtPosition(e,t,r){return(0,p.vf)(this._coordinateSystem,e,t,r)}basisMatrixAtPosition(e,t){const r=this.worldBasisAtPosition(e,d._.X,g.rq.get()),i=this.worldBasisAtPosition(e,d._.Y,g.rq.get()),n=this.worldBasisAtPosition(e,d._.Z,g.rq.get());return(0,s.hZ)(t,r[0],r[1],r[2],0,i[0],i[1],i[2],0,n[0],n[1],n[2],0,0,0,0,1),t}headingAtPosition(e,t){const r=this.worldUpAtPosition(e,g.rq.get()),n=this.worldBasisAtPosition(e,d._.Y,g.rq.get()),s=(0,m.EJ)(t,n,r);return(0,i.KJ)(s)}intersectManifoldClosestSilhouette(e,t,r){return(0,p.xW)(this._coordinateSystem,t,this._tmpCoordinateSystem),(0,p.lt)(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,t,r){(0,p.xW)(this._coordinateSystem,t,this._tmpCoordinateSystem);const i=g.rq.get();return(0,p.Ui)(this._tmpCoordinateSystem,e,i)?(0,o.c)(r,i):null}intersectInfiniteManifold(e,t,r){if(this.viewingMode===_.RT.Global)return this.intersectManifold(e,t,r);(0,p.xW)(this._coordinateSystem,t,this._tmpCoordinateSystem);const i=this._tmpCoordinateSystem.value,n=g.rq.get();return(0,f.Ui)(i.plane,e,n)?(0,o.c)(r,n):null}toRenderCoords(e,t,r){return(0,y.v)(e)?(0,c.g)(e,t,this.spatialReference):(0,h.F)(e,t,r,this.spatialReference)}fromRenderCoords(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,y.v)(t)?(null!=r&&(t.spatialReference=r),(0,u.E)(e,this.spatialReference,t)?t:null):(0,h.F)(e,this.spatialReference,t,r)?t:null}static create(e,t){switch(e){case _.RT.Local:return new v(_.RT.Local,t,(0,n.GA)(t),(0,p.oJ)());case _.RT.Global:return new v(_.RT.Global,t,1,(0,p.Sj)(t))}}static renderUnitScaleFactor(e,t){return(0,n.KX)(e)/(0,n.KX)(t)}}},48549:(e,t,r)=>{"use strict";r.d(t,{BP:()=>l,l5:()=>c,q3:()=>a});var i=r(88105),n=r(6381),s=r(86994);class o{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const r of e.fields.keys()){const t=e.fields.get(r);this[r]=new t.constructor(this.buffer,t.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const r=this[e];return r&&r.elementCount===t.ElementCount&&r.elementType===t.ElementType?r:null}slice(e,t){return new o(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.count;const n=this.stride;if(n%4==0){const s=new Uint32Array(e.buffer,t*n,i*n/4);new Uint32Array(this.buffer,r*n,i*n/4).set(s)}else{const s=new Uint8Array(e.buffer,t*n,i*n);new Uint8Array(this.buffer,r*n,i*n).set(s)}return this}get usedMemory(){return this.byteLength}dispose(){}}class a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach((e=>this._fields.set(e[0],{...e[1],constructor:d(e[1].constructor)}))))}freeze(){return this}vec2f(e,t){return this._appendField(e,i.gH,t),this}vec2f64(e,t){return this._appendField(e,i.si,t),this}vec3f(e,t){return this._appendField(e,i.xs,t),this}vec3f64(e,t){return this._appendField(e,i.Xm,t),this}vec4f(e,t){return this._appendField(e,i.Eq,t),this}vec4f64(e,t){return this._appendField(e,i.Aj,t),this}mat3f(e,t){return this._appendField(e,i.jZ,t),this}mat3f64(e,t){return this._appendField(e,i.j0,t),this}mat4f(e,t){return this._appendField(e,i.Sx,t),this}mat4f64(e,t){return this._appendField(e,i.E$,t),this}vec4u8(e,t){return this._appendField(e,i.XP,t),this}f32(e,t){return this._appendField(e,i.Y$,t),this}f64(e,t){return this._appendField(e,i.qB,t),this}u8(e,t){return this._appendField(e,i.SL,t),this}u16(e,t){return this._appendField(e,i.h,t),this}i8(e,t){return this._appendField(e,i.bf,t),this}vec2i8(e,t){return this._appendField(e,i.D6,t),this}vec2i16(e,t){return this._appendField(e,i.mJ,t),this}vec2u8(e,t){return this._appendField(e,i.LC,t),this}vec4u16(e,t){return this._appendField(e,i.Uz,t),this}u32(e,t){return this._appendField(e,i.P,t),this}_appendField(e,t,r){if(this._fields.has(e))return void(0,s.vA)(!1,`${e} already added to vertex buffer layout`);const i=t.ElementCount*(0,n.GJ)(t.ElementType),o=this._stride;this._stride+=i,this._fields.set(e,{size:i,constructor:t,offset:o,optional:r})}createBuffer(e){return new o(this,e)}createView(e){return new o(this,e)}clone(){const e=new a;return e._stride=this._stride,e._fields=new Map,this._fields.forEach(((t,r)=>e._fields.set(r,t))),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach((t=>e=Math.max(e,(0,n.GJ)(t.constructor.ElementType)))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}}function l(){return new a}class c{constructor(e){this.fields=new Array,e.fields.forEach(((e,t)=>{const r={...e,constructor:h(e.constructor)};this.fields.push([t,r])})),this.stride=e.stride}}const u=[i.Y$,i.gH,i.xs,i.Eq,i.jZ,i.Sx,i.qB,i.si,i.Xm,i.Aj,i.j0,i.E$,i.SL,i.LC,i.eI,i.XP,i.h,i.Yi,i.nS,i.Uz,i.P,i.An,i.H$,i.ml,i.bf,i.D6,i.m8,i.TX,i.Qt,i.mJ,i.Vp,i.E7,i.My,i.UL,i.zD,i.Y4];function h(e){return`${e.ElementType}_${e.ElementCount}`}function d(e){return p.get(e)}const p=new Map;u.forEach((e=>p.set(h(e),e)))},57481:(e,t,r)=>{"use strict";r.d(t,{U:()=>s});var i=r(93345),n=r(21812);function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=e.stride;return Array.from(e.fields.keys()).map((i=>{const s=e.fields.get(i),a=s.constructor.ElementCount,l=o(s.constructor.ElementType),c=s.offset,u=s.optional?.glNormalized??!1;return new n._(i,a,l,c,r,u,t)}))}function o(e){const t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const a={u8:i.pe.UNSIGNED_BYTE,u16:i.pe.UNSIGNED_SHORT,u32:i.pe.UNSIGNED_INT,i8:i.pe.BYTE,i16:i.pe.SHORT,i32:i.pe.INT,f32:i.pe.FLOAT}},22310:(e,t,r)=>{"use strict";r.d(t,{AO:()=>ae,gx:()=>Be,gn:()=>ve,Fj:()=>me,Cz:()=>he,V2:()=>_e,CA:()=>ye,gU:()=>ge,F3:()=>Oe,wI:()=>Ie,rW:()=>we,v2:()=>le,ZC:()=>ue,dl:()=>pe,tv:()=>fe,J9:()=>Ue,w1:()=>Le,XM:()=>Ve});var i=r(30358),n=r(73582),s=r(76460),o=r(15941),a=r(50346),l=r(20664),c=r(9392),u=r(34111),h=r(19247),d=r(9624),p=r(13312),f=r(64232),m=r(60216),g=r(14487),y=r(98510),_=r(80963),v=r(34038);var b=r(64465),w=r(84687),x=r(34761),S=r(13191),T=r(76797),M=r(71372);const A=(0,c.fA)(0,1,0),C=(0,c.fA)(0,0,1),E=(0,S.vt)(),R=(0,c.vt)(),P=(0,c.vt)();function O(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,M.N)();const{direction:n,up:s}=i;return(0,x.N9)(E,-(0,o.kU)(t)),(0,x.eL)(E,E,(0,o.kU)(r)),(0,l.h)(n,C,E),(0,l.j)(n,n,-1),(0,l.h)(s,A,E),i}function I(e,t,r,i,n){const s=e.renderSpatialReference,o=e.map&&e.spatialReference||t.spatialReference;return(0,f.g)(t,R,s),(0,f.g)(t,P,s),R[0]-=r/2,P[0]+=r/2,R[1]-=i/2,P[1]+=i/2,(0,g.F)(R,s,R,o),(0,g.F)(P,s,P,o),n?(n.xmin=R[0],n.ymin=R[1],n.xmax=P[0],n.ymax=P[1],n.spatialReference=o):n=new T.A(R[0],R[1],P[0],P[1],o),n}const L=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:function(e,t,r,i){return(0,M.g)(t,r,i,C,A)},eyeForCenterWithHeadingTilt:function(e,t,r,i){const n=O(e,r,i),s=(0,c.vt)();return(0,l.j)(s,n.direction,-t),(0,l.g)(s,s,e),{up:n.up,eye:s,heading:r,tilt:i}},eyeTiltToLookAtTilt:function(e){return(0,o.kU)(e)},headingTiltToDirectionUp:O,lookAtTiltToEyeTilt:function(e){return(0,o.KJ)(e)},toExtent:I},Symbol.toStringTag,{value:"Module"}));var N=r(45417),D=r(3136);const F=(0,c.fA)(0,0,1),k=(0,l.n)((0,c.vt)(),(0,c.fA)(1,1,1)),z=new n.hr(-180,180),U=(0,S.vt)(),V=(0,c.vt)(),B=(0,c.vt)();function j(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,M.N)();(0,l.b)(V,e,F),0===(0,l.m)(V,V)&&(0,l.b)(V,e,k),(0,x.$0)(U,-(0,o.kU)(t),e),(0,x.e$)(U,U,-(0,o.kU)(r),V);const{up:n,direction:s}=i;return(0,l.b)(n,V,e),(0,l.n)(n,n),(0,l.h)(n,n,U),(0,l.n)(s,e),(0,l.k)(s,s),(0,l.h)(s,s,U),i}function H(e){const t=e[1];e[1]=-e[2],e[2]=t}function G(e,t){const r=j(t,e.heading,e.tilt);return e.up=r.up,e}function Z(e,t,r,i,s){let a,l,c,h;const d=t.latitude,f=(0,u.tO)(e.spatialReference).radius,m=t.longitude,g=(0,D.cq)(d,r,f)/2;a=m-g,l=m+g;const y=(0,o.kU)(d),_=(1+Math.sin(y))/(1-Math.sin(y)),v=(_+1)*Math.tan(i/f/2),b=v*v;function w(e){const t=Math.PI/2;return(e=n.uC.normalize(e,-t))>t&&(e=Math.PI-e),e}if(c=1.5*Math.PI-2*Math.atan(.5*(v+Math.sqrt(4*_+b))),h=c+i/f,c=w(c),h=w(h),h<c){const e=h;h=c,c=e}if(c=Math.max((0,o.KJ)(c),-90),h=Math.min((0,o.KJ)(h),90),l=z.monotonic(a,l),l-a>180){const e=(l-a-180)/2;a+=e,l-=e}const x=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:p.A.WGS84;return s?(s.xmin=a,s.ymin=c,s.xmax=l,s.ymax=h,s.spatialReference=x):s=new T.A(a,c,l,h,x),e.spatialReference&&e.spatialReference.isWebMercator&&(0,N.Gh)(s,!1,s),s}const $=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:function(e,t,r,i){const n=V,s=B;return(0,l.n)(n,e),(0,l.b)(B,n,F),0===(0,l.m)(B,B)&&(0,l.b)(B,n,k),(0,l.b)(s,B,n),(0,M.g)(t,r,i,n,s)},eyeForCenterWithHeadingTilt:function(e,t,r,i){const n={eye:(0,c.vt)(),up:null,tilt:i,heading:r},s=V;s[0]=e[0],s[1]=e[2],s[2]=-e[1];const a=t,u=(0,o.kU)(r),h=(0,o.kU)(i),d=Math.sin(u),p=Math.cos(u),f=Math.sin(h),m=Math.cos(h),g=(0,l.l)(s);let y;if(Math.abs(h)<1e-8)y=a+g;else{const e=g/f,t=(0,o.YN)(a/e),r=Math.PI-h-t;y=e*Math.sin(r)}const _=m*a,v=a*a*(f*f),b=p*p*v,w=y-_,x=w*w,S=b*(b+x-s[1]*s[1]);if(S<0)return(0,l.j)(n.eye,s,y/g),n.tilt=0,G(n,e);const T=Math.sqrt(S),M=s[1]*w,A=b+x;let C;if(C=p>0?-T+M:T+M,Math.abs(A)<1e-8)return g<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=a):(0,l.j)(n.eye,s,y/g),n.tilt=0,H(n.eye),G(n,e);n.eye[1]=C/A;const E=d*d*v,R=f*a,P=p*R*n.eye[1],O=n.eye[1]*n.eye[1],I=1-O,L=Math.sqrt(I),N=b*O+E-2*P*L*w+I*x;return Math.abs(N)<1e-8?((0,l.j)(n.eye,s,y/g),n.tilt=0,H(n.eye),G(n,e)):(n.eye[0]=(I*(y*s[0]-_*s[0])-R*L*(s[0]*n.eye[1]*p+s[2]*d))/N,n.eye[2]=(I*(y*s[2]-_*s[2])-R*L*(s[2]*n.eye[1]*p-s[0]*d))/N,(0,l.j)(n.eye,n.eye,y),H(n.eye),G(n,e))},eyeTiltToLookAtTilt:function(e,t,r){const i=(0,o.kU)(e),n=(0,l.l)(t);return(0,o.YN)(r/(n/Math.sin(i)))+i},headingTiltToDirectionUp:j,lookAtTiltToEyeTilt:function(e,t,r){const i=(0,l.l)(t),n=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-e)),s=(0,o.YN)(r/(n/Math.sin(e)));return(0,o.KJ)(e-s)},toExtent:Z},Symbol.toStringTag,{value:"Module"}));var q=r(80935),W=r(59801);const Y=()=>s.A.getLogger("esri.views.3d.support.cameraUtils"),X=39.37,J=96,K=1,Q=8,ee=5,te=1,re=(0,c.vt)(),ie={heading:0,tilt:0},ne=(0,c.vt)(),se=new n.hr(-20037508.342788905,20037508.342788905),oe=new n.hr(-180,180);var ae;function le(e){return e.spatialReference??p.A.WGS84}function ce(e){return"global"===e.viewingMode?$:L}function ue(e,t,r,i,n){return ce(e).headingTiltToDirectionUp(t,r,i,n)}function he(e,t){if(null==t)return null;const r=e.renderSpatialReference,i=ce(e).headingTiltToDirectionUp,n=(0,c.vt)();if(!(0,f.g)(t.position,n,r))return null;const s=i(n,t.heading,t.tilt);(0,l.j)(s.direction,s.direction,e.state.camera.distance),(0,l.g)(s.direction,s.direction,n);const a=(0,w.bZ)(e,n,s.direction,s.up);return a.fov=(0,o.kU)(t.fov),a.row=t.layout.row,a.rows=t.layout.rows,a.column=t.layout.column,a.columns=t.layout.columns,a}!function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"}(ae||(ae={}));const de=(0,c.vt)();function pe(e,t,r){const n=e.renderSpatialReference,s=ve(e,t.eye,t.viewForward,t.up,ie);let a=le(e);return(0,g.F)(t.eye,n,de,a)||(a=p.A.WGS84,(0,g.F)(t.eye,n,de,a)),null==r?r=new i.A(new h.A(de,a),s.heading,s.tilt,(0,o.KJ)(t.fov)):(r.position.x=de[0],r.position.y=de[1],r.position.z=de[2],r.position.spatialReference=a,r.heading=s.heading,r.tilt=s.tilt,r.fov=(0,o.KJ)(t.fov)),r.layout.row=t.row,r.layout.rows=t.rows,r.layout.column=t.column,r.layout.columns=t.columns,r}function fe(e,t,r){const i=e.state.camera,n=i.width/2/i.pixelRatio;return e.renderCoordsHelper.viewingMode===b.RT.Global&&null!=r&&(t*=Math.cos((0,o.kU)(r))),t/=e.renderCoordsHelper.unitInMeters,n/(J*X/t)/Math.tan(i.fovX/2)}function me(e,t,r){const i=e.state.camera,n=t*Math.tan(i.fovX/2),s=i.width/2/i.pixelRatio;let a=J*X/(s/n);return e.renderCoordsHelper.viewingMode===b.RT.Global&&null!=r&&(a/=Math.cos((0,o.kU)(r))),a*e.renderCoordsHelper.unitInMeters}async function ge(e,t,r,i,n,s){return _e(e,t,fe(e,r,t.latitude),i,n,s)}function ye(e,t,r,i,n,s){return ke(e,we(e,i.heading,i.tilt,t,r,n),i.fov,s)}async function _e(e,t,r,i,n,s){const o=await xe(e,i.heading,i.tilt,t,r,n,s);return(0,a.Te)(s),ze(e,o,i.fov,s)}function ve(e,t,r,i,n){return ce(e).directionToHeadingTilt(t,r,i,n)}function be(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,ne,e.spatialReference)&&e.elevationProvider&&((0,q.R1)(e.elevationProvider,ne)??0)>ne[2]-te)}function we(e,t,r,i,n,s){return Se(e,t,r,i instanceof h.A?i:null,function(e,t){const r=(0,c.vt)();if(null==t)return(0,l.c)(r,e.state.camera.center);if(t instanceof h.A){if(!(0,f.g)(t,r,e.renderSpatialReference))return null;const{basemapTerrain:i,elevationProvider:n}=e;if(null==t.z&&null!=i&&null!=n){const i=(0,q.R1)(n,t);null!=i&&e.renderCoordsHelper.setAltitude(r,i)}return r}return(0,l.c)(r,t)}(e,i),n,s)}async function xe(e,t,r,i,n,s,o){const u=i instanceof h.A?i:null,d=await async function(e,t,r){const i=(0,c.vt)();if(null==t)return(0,l.c)(i,e.state.camera.center);if(t instanceof h.A){const{renderSpatialReference:n,basemapTerrain:s,elevationProvider:o}=e,l=t.spatialReference;if(await(0,f.W)(t,i,n,0,{signal:r}),(0,a.Te)(r),null==t.z&&null!=s&&null!=o){const n=await o.queryElevation(t.x,t.y,t.z??0,l,"ground",r);(0,a.Te)(r),null!=n&&e.renderCoordsHelper.setAltitude(i,n)}return i}return(0,l.c)(i,t)}(e,i,o);return(0,a.Te)(o),Te(e,t,r,u,d,n,s,o)}function Se(e,t,r,i,n,s,o){if(null==n)return null;if(!i&&(i=new h.A({spatialReference:le(e)}),!(0,m.E)(n,e.renderSpatialReference,i)))return null;const a=Me(e,t,r,n,s,o);if(Ae(e,r,o)&&be(e,a.eye)){const{tilt:o,mode:a}=Ce(e,r,n,s);return Se(e,t,o,i,n,s,a)}return Ee(a,n)}async function Te(e,t,r,i,n,s,o,l){i||(i=new h.A({spatialReference:le(e)}),await(0,m.C)(n,e.renderSpatialReference,i,{signal:l})||(i=null)),(0,a.Te)(l);const c=Me(e,t,r,n,s,o);if(Ae(e,r,o)&&await async function(e,t,r){if(be(e,t))return!0;const{elevationProvider:i,spatialReference:n,renderCoordsHelper:s}=e;if(null==i||!s.fromRenderCoords(t,ne,n))return!1;const[o,l,c]=ne,u=await i.queryElevation(o,l,c,n,"ground",r)??0;return(0,a.Te)(r),u>c-te}(e,c.eye,l)){(0,a.Te)(l);const{tilt:o,mode:c}=Ce(e,r,n,s);return Te(e,t,o,i,n,s,c,l)}return Ee(c,n)}function Me(e,t,r,i,n,s){const o=function(e,t,r,i,n,s){let o=0;return s===ae.ADJUST&&function(e,t,r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>Q)return!0;const n=t,s=e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return(0,l.p)(n,s)/(Math.tan(.5*e.state.camera.fov)*i)>ee}(e,i,n)?(t=0,o=function(e,t,r,i){const n=Fe(e,i,t,r);if(!e.state.constraints.tilt)return n;const s=e.state.constraints.tilt(t);s.max=Math.min(s.max,.5*Math.PI);const o=s.min*(1-Ne)+s.max*Ne;return Math.min(n,o)}(e,n,r,i)):o=Fe(e,i,n,r),o=e.state.constraints.clampTilt(n,o),{heading:t,tilt:r=De(e,i,n,o)}}(e,t,r,i,n=Math.max(n,e.state.constraints.minimumPoiDistance),s);return(0,ce(e).eyeForCenterWithHeadingTilt)(i,n,o.heading,o.tilt)}function Ae(e,t,r){const i=e.map.ground.navigationConstraint;return r===ae.ADJUST&&"global"===e.viewingMode&&t>0&&(null==i||"stay-above"===i.type)}function Ce(e,t,r,i){const n=De(e,r,i,function(e,t,r,i){let n=Fe(e,i,t,r);if(!e.state.constraints.tilt)return n;const s=e.state.constraints.tilt(t);return n=Math.min(n,.5*Math.PI),s.min*(1-Ne)+n*Ne}(e,i,t,r));return{tilt:n,mode:t-n<1?ae.LOCKED:ae.ADJUST}}function Ee(e,t){return{...e,center:(0,c.o8)(t)}}function Re(e,t){const{state:r,spatialReference:i}=e,n=t.spatialReference;return r.isGlobal&&(0,W.M)(n,b.RT.Global)||r.isLocal&&i.equals(n)}function Pe(e,t){let r,i,n;if(e.state.isGlobal){const e=new h.A(t.xmin,t.ymin,t.spatialReference),s=new h.A(t.xmax,t.ymax,t.spatialReference),o=t.spatialReference.isGeographic?oe:se;r=new h.A({x:o.center(e.x,s.x),y:(s.y+e.y)/2,z:null!=t.zmax&&null!=t.zmin?(t.zmax+t.zmin)/2:void 0,spatialReference:t.spatialReference});const a=(0,u.tO)(t.spatialReference),l=(0,D.J_)(r,e,s);i=l.lon,n=l.lat,o.diff(e.x,s.x)>o.range/2&&(i+=a.halfCircumference),i=Math.min(i,a.halfCircumference),n=Math.min(n,a.halfCircumference)}else{const s=e.renderSpatialReference??t.spatialReference;s.equals(t.spatialReference)||(t=(0,d.project)(t,s)),i=t.xmax-t.xmin,n=t.ymax-t.ymin;const o=null!=t.zmax&&null!=t.zmin?(t.zmax+t.zmin)/2:void 0;r=new h.A({x:t.xmin+.5*i,y:t.ymin+.5*n,z:o,spatialReference:s})}const s=null!=t.zmax&&null!=t.zmin?t.zmax-t.zmin:0,o=e.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:r,distance:Math.max(.5*i*a,.5*n*l,.5*s*c)/K}}async function Oe(e,t,r,i,n,s){const o=Re(e,t)?t:await(0,d.projectWithZConversion)(t,e.spatialReference,{signal:s});(0,a.Te)(s);const{center:l,distance:c}=Pe(e,o),u=await xe(e,r,i,l,c,n,s);return(0,a.Te)(s),ze(e,u,e.camera.fov,s)}function Ie(e,t,r,i,n,s){let o;try{o=Re(e,t)?t:(0,d.project)(t,e.spatialReference)}catch(u){return null}const{center:a,distance:l}=Pe(e,o),c=we(e,r,i,a,l,n);return null==c?null:ke(e,c,e.camera.fov,s)}function Le(e,t,r){const i=e.renderSpatialReference,n=new h.A({spatialReference:le(e)});if(!(0,m.E)(r,i,n))return null;const s=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),a=(0,l.F)(t.eye,r),c=2*a*s*K,u=2*a*o*K;return"global"===e.viewingMode?Z(e,n,c,u):I(e,n,c,u)}const Ne=.7;function De(e,t,r,i){return ce(e).lookAtTiltToEyeTilt(i,t,r)}function Fe(e,t,r,i){return ce(e).eyeTiltToLookAtTilt(i,t,r)}function ke(e,t,r,n){if(null==t)return null;const s=e.renderSpatialReference,o=new h.A({spatialReference:le(e)});return(0,m.E)(t.eye,s,o)?(n??=new i.A,n.position=o,n.heading=t.heading,n.tilt=t.tilt,n.fov=r,n):null}async function ze(e,t,r,n){const s=e.renderSpatialReference,o=new h.A({spatialReference:le(e)});return await(0,m.C)(t.eye,s,o,{signal:n}),(0,a.Te)(n),new i.A(o,t.heading,t.tilt,r)}function Ue(e,t){const r=e.basemapTerrain?.tilingScheme;if(r)return r.levelAtScale(t);Y().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function Ve(e,t){const r=e.basemapTerrain?.tilingScheme;if(r)return r.scaleAtLevel(t);Y().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function Be(e,t){const{renderSpatialReference:r}=e,i=function(e){return(0,_.aI)(e,y.AI)||(0,_.q8)(e)?{wkid:v.Y.GCSMARS2000}:(0,_.aI)(e,y.WR)||(0,_.KQ)(e)?{wkid:v.Y.GCSMOON2000}:p.A.WGS84}(r);let n=null;try{(0,g.F)(t.center,r,re,i)&&(n=re[1])}catch{}return me(e,t.distance,n)}},71372:(e,t,r)=>{"use strict";r.d(t,{N:()=>l,g:()=>c});var i=r(15941),n=r(20664),s=r(9392);const o=(0,s.vt)(),a=(0,s.vt)();function l(){return{direction:(0,s.vt)(),up:(0,s.vt)()}}function c(e,t,r,s,l){let c=(0,n.n)(o,e),u=(0,n.m)(c,s);const h=u>0;u=Math.abs(u),u>.99&&(u=Math.abs((0,n.m)(t,s)),u<.99?((0,n.c)(c,t),h&&(0,n.j)(c,c,-1)):c=null);let d=0;if(c){(0,n.j)(a,s,(0,n.m)(s,c)),(0,n.f)(c,c,a);const e=(0,n.m)(c,l)/((0,n.l)(c)*(0,n.l)(l));(0,n.b)(a,c,l),d=((0,n.m)(a,s)>0?1:-1)*(0,i.KJ)((0,i.XM)(e))}const p=(0,i.KJ)((0,i.XM)(-(0,n.m)(s,e)/(0,n.l)(e)));return r?(r.heading=d,r.tilt=p,r):{heading:d,tilt:p}}},22955:(e,t,r)=>{"use strict";r.d(t,{b:()=>l});var i=r(35143),n=r(91967),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842));let a=class extends n.A{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};(0,i._)([(0,s.MZ)()],a.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"DECONFLICTOR_SHOW_GRID",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"LABELS_SHOW_BORDER",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"TEXT_SHOW_BASELINE",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"TEXT_SHOW_BORDER",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"OVERLAY_SHOW_CENTER",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"SHOW_POI",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"I3S_TREE_SHOW_TILES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"I3S_SHOW_MODIFICATIONS",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"LINE_WIREFRAMES",void 0),a=(0,i._)([(0,o.$)("esri.views.3d.support.debugFlags")],a);const l=new a},3136:(e,t,r)=>{"use strict";r.d(t,{J_:()=>a,aE:()=>c,cq:()=>l});var i=r(15941),n=r(34111),s=r(19247);function o(e,t,r){if(null==t.longitude||null==t.latitude||null==r.longitude||null==r.latitude)throw new Error("Invalid points: no lon/lat");return function(e,t,r,n,s){const o=(0,i.kU)(r),a=(0,i.kU)(s),l=o-a,c=(0,i.kU)(t)-(0,i.kU)(n),u=Math.sin(l/2),h=Math.sin(c/2),d=2*(0,i.YN)(Math.sqrt(u*u+Math.cos(o)*Math.cos(a)*h*h))*e;return Math.round(1e4*d)/1e4}(e,t.longitude,t.latitude,r.longitude,r.latitude)}function a(e,t,r){const i=t.spatialReference,a=(0,n.tO)(i),l=new s.A(t.x,e.y,i),c=new s.A(r.x,e.y,i),u=new s.A(e.x,t.y,i),h=new s.A(e.x,r.y,i);return{lon:o(a.radius,l,c),lat:o(a.radius,u,h)}}function l(e,t,r){const n=t/r,s=(0,i.kU)(e),o=Math.sin(n/2),a=Math.cos(s),l=2*(0,i.YN)(Math.sqrt(o*o/(a*a)));return(0,i.KJ)(l)}function c(e,t){const r=e?.[0];if(null==r)return null;t||(t={hours:0,minutes:0,seconds:0}),t.hours=function(e,t){let r=e/15;return t||(r=Math.round(r)),r}(r,!0);const i=t.hours%1;t.hours-=i,t.minutes=60*i;const n=t.minutes%1;return t.minutes-=n,t.seconds=Math.round(60*n),t}},70667:(e,t,r)=>{"use strict";r.d(t,{t:()=>g,z:()=>v});var i=r(19555),n=r(72745),s=r(55855),o=r(34111),a=r(482),l=r(44815),c=r(75002),u=r(38496),h=r(64465),d=r(50468),p=r(87634),f=r(51799),m=r(66470);function g(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=[],g=t.mapPositions;!function(e,t){const{attributeData:{position:r},removeDuplicateStartEnd:i}=e,n=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(r)&&i,s=r.length/3-(n?1:0),o=new Array(2*(s-1)),a=n?r.slice(0,-3):r;let l=0;for(let c=0;c<s-1;c++)o[l++]=c,o[l++]=c+1;t.push([m.r.POSITION,new d.n(a,o,3,n)])}(t,n);const v=n[0][1].data,b=n[0][1].indices.length,w=(0,u.EH)(b);return function(e,t,r){if(null!=e.attributeData.colorFeature)return;const i=e.attributeData.color;t.push([m.r.COLOR,new d.n(i??s.Un,r,4)])}(t,n,w),function(e,t,r){null==e.attributeData.sizeFeature&&t.push([m.r.SIZE,new d.n([e.attributeData.size??1],r,1,!0)])}(t,n,w),function(e,t,r){e.attributeData.normal&&t.push([m.r.NORMAL,new d.n(e.attributeData.normal,r,3)])}(t,n,w),function(e,t,r){null!=e.attributeData.colorFeature&&t.push([m.r.COLORFEATUREATTRIBUTE,new d.n([e.attributeData.colorFeature],r,1,!0)])}(t,n,w),function(e,t,r){null!=e.attributeData.sizeFeature&&t.push([m.r.SIZEFEATUREATTRIBUTE,new d.n([e.attributeData.sizeFeature],r,1,!0)])}(t,n,w),function(e,t,r){null!=e.attributeData.opacityFeature&&t.push([m.r.OPACITYFEATUREATTRIBUTE,new d.n([e.attributeData.opacityFeature],r,1,!0)])}(t,n,w),function(e,t,r){if(null==e.overlayInfo||e.overlayInfo.renderCoordsHelper.viewingMode!==h.RT.Global||!e.overlayInfo.spatialReference.isGeographic)return;const n=(0,l.jh)(r.length),s=(0,o.tO)(e.overlayInfo.spatialReference);for(let i=0;i<n.length;i+=3)(0,a.RC)(r,i,n,i,s);const u=r.length/3,p=(0,c.oe)(u+1);let f=y,g=_,v=0,b=0;(0,i.hZ)(f,n[b++],n[b++]),b++,p[0]=0;for(let o=1;o<u+1;++o)o===u&&(b=0),(0,i.hZ)(g,n[b++],n[b++]),b++,v+=(0,i.xg)(f,g),p[o]=v,[f,g]=[g,f];t.push([m.r.DISTANCETOSTART,new d.n(p,t[0][1].indices,1,!0)])}(t,n,v),new f.V(e,n,g,p.X.Line,r)}const y=(0,n.vt)(),_=(0,n.vt)();function v(e,t){if(null==e||0===e.length)return[];const r=[];return e.forEach((e=>{const i=e.length,n=(0,l.jh)(3*i);e.forEach(((e,t)=>{n[3*t]=e[0],n[3*t+1]=e[1],n[3*t+2]=e[2]}));const s={attributeData:{position:n,normal:t},removeDuplicateStartEnd:!1};r.push(s)})),r}},99443:(e,t,r)=>{"use strict";r.d(t,{Cz:()=>l,DZ:()=>h,PV:()=>u,sS:()=>d,vO:()=>a});var i=r(72900),n=r(93345),s=r(98433),o=r(96673);const a=64,l=a/2,c=l/5,u=a/c,h=.25;function d(e,t){const r=(0,i.m9)(e,a,l,c),u=new o.R;return u.internalFormat=n.Ab.RGBA,u.width=a,u.height=a,u.wrapMode=n.pF.CLAMP_TO_EDGE,new s.g(t,u,r)}},72900:(e,t,r)=>{"use strict";r.d(t,{CN:()=>a,Q_:()=>o,m9:()=>u,ny:()=>l,sZ:()=>c});r(81806);var i=r(14522),n=r(96897),s=r(93345);const o=128,a=.5;function l(e){return"cross"===e||"x"===e}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;const r=u(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*a,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return new n.g(r,{mipmap:!1,wrap:{s:s.pF.CLAMP_TO_EDGE,t:s.pF.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0})}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;switch(e){case"circle":default:return function(e,t){const r=e/2-.5;return m(e,p(r,r,t/2))}(t,r);case"square":return function(e,t){return h(e,t,!1)}(t,r);case"cross":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return d(e,t,!1,r)}(t,r,i);case"x":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return d(e,t,!0,r)}(t,r,i);case"kite":return function(e,t){return h(e,t,!0)}(t,r);case"triangle":return function(e,t){return m(e,f(e/2,t,t/2))}(t,r);case"arrow":return function(e,t){const r=t,i=t/2,n=e/2,s=.8*r,o=p(n,(e-t)/2-s,Math.sqrt(s*s+i*i)),a=f(n,r,i);return m(e,((e,t)=>Math.max(a(e,t),-o(e,t))))}(t,r)}}function h(e,t,r){return r&&(t/=Math.SQRT2),m(e,((i,n)=>{let s=i-.5*e+.25,o=.5*e-n-.75;if(r){const e=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=e}return Math.max(Math.abs(s),Math.abs(o))-.5*t}))}function d(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t-=i,r&&(t*=Math.SQRT2);const n=.5*t;return m(e,((t,s)=>{let o,a=t-.5*e,l=.5*e-s-1;if(r){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),o=a>l?a>n?Math.sqrt((a-n)*(a-n)+l*l):l:l>n?Math.sqrt(a*a+(l-n)*(l-n)):a,o-=i/2,o}))}function p(e,t,r){return(i,n)=>{const s=i-e,o=n-t;return Math.sqrt(s*s+o*o)-r}}function f(e,t,r){const i=Math.sqrt(t*t+r*r);return(n,s)=>{const o=Math.abs(n-e)-r,a=s-e+t/2+.75,l=(t*o+r*a)/i,c=-a;return Math.max(l,c)}}function m(e,t){const r=new Uint8Array(4*e*e);for(let n=0;n<e;n++)for(let s=0;s<e;s++){const o=s+e*n;let a=t(s,n);a=a/e+.5,(0,i.U)(a,r,4*o)}return r}},42136:(e,t,r)=>{"use strict";r.d(t,{I:()=>s,k:()=>o});var i=r(9392),n=r(45308);function s(e,t,r){if(null==e||null==r)return!1;let i=!0;return a[0]=null!=e.xmin?e.xmin:0,a[1]=null!=e.ymin?e.ymin:0,a[2]=null!=e.zmin?e.zmin:0,i=i&&(0,n.projectBuffer)(a,e.spatialReference,0,t,r,0,1),a[0]=null!=e.xmax?e.xmax:0,a[1]=null!=e.ymax?e.ymax:0,a[2]=null!=e.zmax?e.zmax:0,i=i&&(0,n.projectBuffer)(a,e.spatialReference,0,t,r,3,1),null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.zmin&&(t[2]=-1/0),null==e.xmax&&(t[3]=1/0),null==e.ymax&&(t[4]=1/0),null==e.zmax&&(t[5]=1/0),i}function o(e,t,r){if(null==e||null==r)return!1;let i=!0;return a[0]=null!=e.xmin?e.xmin:0,a[1]=null!=e.ymin?e.ymin:0,a[2]=null!=e.zmin?e.zmin:0,i=i&&(0,n.projectBuffer)(a,e.spatialReference,0,a,r,0,1),t[0]=a[0],t[1]=a[1],a[0]=null!=e.xmax?e.xmax:0,a[1]=null!=e.ymax?e.ymax:0,a[2]=null!=e.zmax?e.zmax:0,i=i&&(0,n.projectBuffer)(a,e.spatialReference,0,a,r,0,1),t[2]=a[0],t[3]=a[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),i}const a=(0,i.vt)()},37431:(e,t,r)=>{"use strict";r.d(t,{Gc:()=>l,RI:()=>u,Z4:()=>c,dk:()=>d,vr:()=>h});var i=r(76931),n=r(19555),s=r(20664),o=r(95925),a=r(75762);function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,o.vt)();return c(e,(0,i.WA)(t),r),(0,s.n)(r.direction,r.direction),r}function c(e,t,r){return u(e,e.screenToRender(t,(0,i.sc)(a.rq.get())),r)}function u(e,t,r){const o=(0,i.sc)((0,n.C)(a.rq.get(),t));if(o[2]=0,!e.unprojectFromRenderScreen(o,r.origin))return null;const l=(0,i.sc)((0,n.C)(a.rq.get(),t));l[2]=1;const c=e.unprojectFromRenderScreen(l,a.rq.get());return null==c?null:((0,s.f)(r.direction,c,r.origin),r)}function h(e,t,r){return d(e,e.screenToRender(t,(0,i.sc)(a.rq.get())),r)}function d(e,t,r){(0,s.c)(r.origin,e.eye);const i=(0,s.s)(a.rq.get(),t[0],t[1],1),n=e.unprojectFromRenderScreen(i,a.rq.get());return null==n?null:((0,s.f)(r.direction,n,r.origin),r)}},88220:(e,t,r)=>{"use strict";r.d(t,{CB:()=>v,av:()=>b,zC:()=>M});r(35238);var i=r(39356),n=r(85361),s=r(76931),o=r(9392),a=r(14487),l=r(3569),c=r(31933),u=r(22955),h=r(80935),d=r(29808),p=r(3112),f=r(46571),m=r(30310),g=r(97974),y=r(13312),_=r(19247);async function v(e,t,r,i){const n=r?A(e,r):i,o=(0,s.gs)(t.x,t.y);n.requiresGroundFeedback=!0,n.enableDraped=!0;const a=(0,d.hz)(e.state.viewingMode);a.options.selectionMode=!0,a.options.store=p.oH.ALL,e.sceneIntersectionHelper.intersectIntersectorScreen(o,a,n);const l=function(e,t,r){const i=new Array;let n=null;for(let s=0;s<t.length;s++){const o=t[s],a=(0,m.FV)(o,e);if(null!=a&&(a===e.map.ground||"type"in a&&(0,c.Eq)(a.type)))break;const l=(0,m.FI)(o,e);if(null==l)continue;if("graphic"===l.type){if(null==n&&s!==t.length-1&&(n=new Set),null!=n){const e=x(l.graphic);if(n.has(e))continue;n.add(e)}if(!S(r,l.graphic))continue}const u=w(e,o),h=o.distanceInRenderSpace;if("media"===l.type){const e=l.element.toSource(u);i.push({...l,mapPoint:u,distance:h,sourcePoint:e})}else i.push({...l,mapPoint:u,distance:h})}return i}(e,a.results.all,n.graphics),h=a.results.ground,g=(0,m.FV)(h,e),y=null!=g&&"type"in g&&(0,c.Eq)(g.type)?g:null,_={screenPoint:t,results:l,ground:{mapPoint:w(e,h),distance:(0,f.i3)(h)?h.distanceInRenderSpace:0,layer:y}};return u.b.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(_.intersector=a),_}function b(e,t,r,i){const n=r?A(e,r):i,o=!(!n.graphics?.include&&!n.graphics?.exclude),a=!(!n.mediaElements?.include&&!n.mediaElements?.exclude),l=(0,s.WA)(t);n.enableDraped=n.include&&!n.include.has(g.fo)||n.exclude?.has(g.fo);const c=e.sceneIntersectionHelper,u=(0,d.hz)(e.state.viewingMode);if(u.options.selectionMode=!0,u.options.store=o||a?p.oH.ALL:p.oH.MIN,u.options.hud=!r?.excludeHud,c.intersectIntersectorScreen(l,u,n),o||a){for(const t of u.results.all){const r=(0,m.FI)(t,e);if(null==r)return w(e,t);if(o&&("graphic"!==r.type||S(n.graphics,r.graphic)))return w(e,t);if(a&&("media"!==r.type||T(n.mediaElements,r.element)))return w(e,t)}return null}return w(e,u.results.min)}function w(e,t,r){return t.getIntersectionPoint(R)?(r=M(e,R,r),t.intersector===p.dz.TERRAIN&&e.basemapTerrain&&(r.z=(0,h.R1)(e.basemapTerrain,r)??0),r):null}function x(e){const t=e.sourceLayer,r=e.layer,i=t&&"objectIdField"in t?t:r&&"objectIdField"in r?r:t;if(i){const t=i.objectIdField??l.r,r=e.attributes?.[t];if(r)return`o-${i.id}-${r}`}return`u-${e.uid}`}function S(e,t){return T(e,x(t))}function T(e,t){return null==e||(null==e.include||e.include.has(t))&&(null==e.exclude||!e.exclude.has(t))}function M(e,t,r){let i=e.spatialReference||y.A.WGS84;return(0,a.F)(t,e.renderSpatialReference,R,i)?t=R:(i=y.A.WGS84,(0,a.F)(t,e.renderSpatialReference,R,i)&&(t=R)),r?(r.x=t[0],r.y=t[1],r.z=t[2],r.spatialReference=i):r=new _.A(t,i),r}function A(e,t){const r=C(e,t.include,P.INCLUDE),i=C(e,t.exclude,P.EXCLUDE);return{include:r.layerUids,exclude:i.layerUids,graphics:{include:r.graphicUids,exclude:i.graphicUids},mediaElements:{include:r.mediaElements,exclude:i.mediaElements}}}function C(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{layerUids:void 0,graphicUids:void 0,mediaElements:void 0};if(!t)return s;if(t instanceof i.A)(function(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)})(s,x(t)),r===P.INCLUDE&&(null!=e.graphicsView&&t.layer===e?E(s,e.graphicsView.processor.layer.id):t.layer&&E(s,t.layer.uid));else if("layer"in t&&"element"in t)(function(e,t){e.mediaElements||(e.mediaElements=new Set),e.mediaElements.add(t)})(s,t.element),r===P.INCLUDE&&E(s,t.layer.uid);else if((0,n.xZ)(t))for(const i of t)i===e.graphics&&null!=e.graphicsView?E(s,e.graphicsView.processor.layer.id):i===e.map.ground?E(s,g.fo):C(e,i,r,s);else"uid"in t&&E(s,t.uid);return s}function E(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}const R=(0,o.vt)();var P;!function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(P||(P={}))},5729:(e,t,r)=>{"use strict";var i;r.d(t,{U0:()=>n,sK:()=>i,u1:()=>s}),function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"}(i||(i={}));const n=(()=>{const e=new Array;return e[i.ELEVATION]=10,e[i.BASEMAP]=10,e[i.I3S_INDEX]=10,e[i.I3S_DATA]=10,e[i.SYMBOLOGY]=5,e})(),s=30},70335:(e,t,r)=>{"use strict";r.d(t,{Rg:()=>l,Sc:()=>a});var i=r(72745),n=r(20664),s=r(9392),o=r(13927);function a(e,t,r,i){return d(e,t,r,u(i,t,r,!0))}function l(e,t,r,i){const s=(0,n.m)(r,(0,n.f)(e,i,t));return(0,n.g)(e,t,(0,n.j)(e,r,s))}const c={dir:(0,s.vt)(),len:0,clip:(0,i.vt)()};function u(e,t,r,i){const s=c;return e?(r&&i&&(s.len=(0,n.p)(t,r)),(0,n.c)(s.dir,e)):i?(s.len=(0,n.p)(t,r),(0,n.f)(s.dir,r,t),(0,n.j)(s.dir,s.dir,1/s.len)):((0,n.f)(s.dir,r,t),(0,n.n)(s.dir,s.dir)),s}function h(e,t,r){const i=(0,n.m)((0,o.Qj)(e),r.dir),s=-(0,o.mN)(e,t);if(s<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return s>0;if((s<0||i<0)&&!(s<0&&i<0))return!0;const a=s/i;return i>0?a<r.clip[1]&&(r.clip[1]=a):a>r.clip[0]&&(r.clip[0]=a),r.clip[0]<=r.clip[1]}function d(e,t,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let n=0;n<e.length;n++)if(!h(e[n],t,i))return!1;return!0}},94966:(e,t,r)=>{"use strict";r.d(t,{BI:()=>u,VV:()=>c,YH:()=>l,e9:()=>m,g7:()=>p,hG:()=>o,is:()=>d,ix:()=>g,nu:()=>h,su:()=>f,wp:()=>a});var i=r(15941),n=r(20664),s=r(9392);function o(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],r=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],i=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}function a(e,t){const r=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),i=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return(0,n.s)(e,r,i,s),e}function l(e,t,r){r=r||e;const i=(0,n.m)(e,t);(0,n.s)(r,e[0]-i*t[0],e[1]-i*t[1],e[2]-i*t[2]),(0,n.n)(r,r)}function c(e,t,r){Math.abs(e[0])>Math.abs(e[1])?(0,n.s)(t,0,1,0):(0,n.s)(t,1,0,0),(0,n.b)(r,e,t),(0,n.b)(t,r,e),(0,n.n)(r,r),(0,n.n)(t,t)}function u(e,t,r,i,n,s){const o=e+(t-e)*n;return o+(r+(i-r)*n-o)*s}function h(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,s.vt)();const o=(0,n.l)(e),a=(0,n.l)(t),l=(0,n.m)(e,t)/(o*a);if(l<.9999999999999999){const s=Math.acos(l),c=((1-r)*o+r*a)/Math.sin(s),u=c/o*Math.sin((1-r)*s),h=c/a*Math.sin(r*s);return(0,n.j)(b,e,u),(0,n.j)(w,t,h),(0,n.g)(i,b,w)}return(0,n.o)(i,e,t,r)}function d(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,s.vt)(),o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,s.vt)();const a=(0,n.l)(e),l=(0,n.l)(t),c=(0,n.m)(e,t)/(a*l);if(c<.9999999999999999){const s=Math.acos(c),u=Math.sin(s),h=Math.sin(r*s),d=Math.sin((1-r)*s),p=(1-r)*a+r*l;{const r=p/u,s=r/l*h;(0,n.j)(b,e,r/a*d),(0,n.j)(w,t,s),(0,n.g)(i,b,w)}{const i=1/a*(-Math.cos((1-r)*s)*s*p+d*(-a+l));(0,n.j)(b,e,i);const c=1/l*(Math.cos(r*s)*s*p+h*(-a+l));(0,n.j)(w,t,c),(0,n.g)(o,b,w),(0,n.j)(o,o,1/u)}return o}return(0,n.o)(i,e,t,r),(0,n.f)(o,t,e),(0,n.n)(o,o),o}function p(e,t,r){e=(0,n.n)(b,e),t=(0,n.n)(w,t);const s=(0,i.XM)((0,n.m)(e,t));if(r){const i=(0,n.b)(v,e,t);if((0,n.m)(i,r)<0)return-s}return s}function f(e){const t=e.length;return r=>{if(r<=e[0][0])return e[0][1];if(r>=e[t-1][0])return e[t-1][1];let i=1;for(;r>e[i][0];)i++;const n=e[i-1][0],s=e[i][0],o=(s-r)/(s-n);return o*e[i-1][1]+(1-o)*e[i][1]}}function m(e,t,r,i){(0,n.f)(y,t,e),(0,n.f)(_,r,e),(0,n.b)(i,y,_),(0,n.n)(i,i),i[3]=-(0,n.m)(e,i)}function g(e,t){if((0,n.s)(t,0,0,0),e.length>0){for(let r=0;r<e.length;++r)(0,n.g)(t,t,e[r]);(0,n.j)(t,t,1/e.length)}}const y=(0,s.vt)(),_=(0,s.vt)(),v=(0,s.vt)(),b=(0,s.vt)(),w=(0,s.vt)()},59231:(e,t,r)=>{"use strict";r.d(t,{ab:()=>be,OX:()=>Ce,gm:()=>Pe});var i=r(63919),n=r(44680),s=r(13191),o=r(60008),a=r(4336),l=r(20664),c=r(9392),u=r(43047),h=r(55855),d=r(34111),p=r(98510),f=r(5809),m=r(45308),g=r(482),y=r(13927),_=r(80963),v=r(75762),b=r(64465),w=r(72745),x=r(50468);const S=1e-6,T=(0,c.vt)(),M=(0,c.vt)();function A(e,t,r,i,n,s,o,a,l,c){return function(e,t,r){let i=_e(e.maxVert[0],e.minVert[0]),n=0;for(let s=1;s<7;++s){const t=_e(e.maxVert[s],e.minVert[s]);t>i&&(i=t,n=s)}fe(t,e.minVert[n]),fe(r,e.maxVert[n])}(e,i,n),_e(i,n)<S?1:(de(o,i,n),ge(o,o),function(e,t,r,i){const{data:n,size:s}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<n.length;l+=s){F[0]=n[l]-t[0],F[1]=n[l+1]-t[1],F[2]=n[l+2]-t[2];const e=r[0]*F[0]+r[1]*F[1]+r[2]*F[2],i=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],s=F[0]*F[0]+F[1]*F[1]+F[2]*F[2]-e*e/i;s>o&&(o=s,a=l)}return fe(i,n,a),o}(t,i,o,s)<S?2:(de(a,n,s),ge(a,a),de(l,s,i),ge(l,l),me(r,a,o),ge(r,r),G(t,r,o,a,l,c),0))}const C=(0,c.vt)(),E=(0,c.vt)(),R=(0,c.vt)(),P=(0,c.vt)(),O=(0,c.vt)(),I=(0,c.vt)(),L=(0,c.vt)(),N=(0,c.vt)();function D(e,t,r,i,n,s,o,a,l){(function(e,t,r,i,n){!function(e,t,r,i,n){const{data:s,size:o}=e;fe(i,s),fe(n,i),r[0]=ve(Z,t),r[1]=r[0];for(let a=o;a<s.length;a+=o){const e=s[a]*t[0]+s[a+1]*t[1]+s[a+2]*t[2];e<r[0]&&(r[0]=e,fe(i,s,a)),e>r[1]&&(r[1]=e,fe(n,s,a))}}(e,t,k,n,i);const s=ve(r,t);k[1]-S<=s&&(i[0]=void 0),k[0]+S>=s&&(n[0]=void 0)})(e,t,r,C,E),void 0!==C[0]&&(de(R,C,r),ge(R,R),de(P,C,i),ge(P,P),de(O,C,n),ge(O,O),me(I,P,s),ge(I,I),me(L,O,o),ge(L,L),me(N,R,a),ge(N,N),G(e,I,s,P,R,l),G(e,L,o,O,P,l),G(e,N,a,R,O,l)),void 0!==E[0]&&(de(R,E,r),ge(R,R),de(P,E,i),ge(P,P),de(O,E,n),ge(O,O),me(I,P,s),ge(I,I),me(L,O,o),ge(L,L),me(N,R,a),ge(N,N),G(e,I,s,P,R,l),G(e,L,o,O,P,l),G(e,N,a,R,O,l))}const F=[0,0,0];const k=(0,w.vt)();const z=(0,c.vt)(),U=(0,c.vt)(),V=(0,c.vt)(),B=(0,c.vt)(),j=(0,c.vt)(),H=(0,c.vt)();function G(e,t,r,i,n,s){if(ye(t)<S)return;me(z,r,t),me(U,i,t),me(V,n,t),$(e,t,k),j[1]=k[0],B[1]=k[1],H[1]=B[1]-j[1];const o=[r,i,n],a=[z,U,V];for(let l=0;l<3;++l){$(e,o[l],k),j[0]=k[0],B[0]=k[1],$(e,a[l],k),j[2]=k[0],B[2]=k[1],H[0]=B[0]-j[0],H[2]=B[2]-j[2];const r=ue(H);r<s.quality&&(fe(s.b0,o[l]),fe(s.b1,t),fe(s.b2,a[l]),s.quality=r)}}const Z=(0,c.vt)();function $(e,t,r){const{data:i,size:n}=e;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<i.length;s+=n){const e=i[s]*t[0]+i[s+1]*t[1]+i[s+2]*t[2];r[0]=Math.min(r[0],e),r[1]=Math.max(r[1],e)}}function q(e,t,r){r.center=e,r.halfSize=(0,l.j)(t,t,.5),r.quaternion=a.zK}const W=(0,c.vt)(),Y=(0,c.vt)(),X=(0,c.vt)(),J=(0,c.vt)(),K=(0,c.vt)(),Q=(0,c.vt)();function ee(e,t,r){fe(W,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?W[0]=0:Math.abs(t[1])>Math.abs(t[2])?W[1]=0:W[2]=0,ye(W)<S&&(W[0]=W[1]=W[2]=1),me(Y,t,W),ge(Y,Y),me(X,t,Y),ge(X,X),te(e,t,Y,X,J,K),de(Q,K,J),ae(t,Y,X,J,K,Q,r)}function te(e,t,r,i,n,s){$(e,t,k),n[0]=k[0],s[0]=k[1],$(e,r,k),n[1]=k[0],s[1]=k[1],$(e,i,k),n[2]=k[0],s[2]=k[1]}const re=(0,c.vt)(),ie=(0,c.vt)(),ne=(0,c.vt)(),se=(0,n.fA)(1,0,0,0,1,0,0,0,1),oe=(0,a.vt)();function ae(e,t,r,i,n,s,o){se[0]=e[0],se[1]=e[1],se[2]=e[2],se[3]=t[0],se[4]=t[1],se[5]=t[2],se[6]=r[0],se[7]=r[1],se[8]=r[2],o.quaternion=function(e,t){const r=t[0]+t[4]+t[8];if(r>0){let i=Math.sqrt(r+1);e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const i=(r+1)%3,n=(r+2)%3;let s=Math.sqrt(t[3*r+r]-t[3*i+i]-t[3*n+n]+1);e[r]=.5*s,s=.5/s,e[3]=(t[3*i+n]-t[3*n+i])*s,e[i]=(t[3*i+r]+t[3*r+i])*s,e[n]=(t[3*n+r]+t[3*r+n])*s}return e}(oe,se),he(re,i,n),pe(re,re,.5),pe(ie,e,re[0]),pe(ne,t,re[1]),he(ie,ie,ne),pe(ne,r,re[2]),o.center=(0,l.g)(ie,ie,ne),o.halfSize=(0,l.j)(re,s,.5)}class le{constructor(e){this.minVert=new Array(7),this.maxVert=new Array(7);this.buffer=new ArrayBuffer(448);let t=0;this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;for(let o=0;o<7;++o)this.minVert[o]=new Float64Array(this.buffer,t,3),t+=24;for(let o=0;o<7;++o)this.maxVert[o]=new Float64Array(this.buffer,t,3),t+=24;for(let o=0;o<7;++o)this.minProj[o]=Number.POSITIVE_INFINITY,this.maxProj[o]=Number.NEGATIVE_INFINITY;const r=new Array(7),i=new Array(7),{data:n,size:s}=e;for(let o=0;o<n.length;o+=s){let e=n[o];e<this.minProj[0]&&(this.minProj[0]=e,r[0]=o),e>this.maxProj[0]&&(this.maxProj[0]=e,i[0]=o),e=n[o+1],e<this.minProj[1]&&(this.minProj[1]=e,r[1]=o),e>this.maxProj[1]&&(this.maxProj[1]=e,i[1]=o),e=n[o+2],e<this.minProj[2]&&(this.minProj[2]=e,r[2]=o),e>this.maxProj[2]&&(this.maxProj[2]=e,i[2]=o),e=n[o]+n[o+1]+n[o+2],e<this.minProj[3]&&(this.minProj[3]=e,r[3]=o),e>this.maxProj[3]&&(this.maxProj[3]=e,i[3]=o),e=n[o]+n[o+1]-n[o+2],e<this.minProj[4]&&(this.minProj[4]=e,r[4]=o),e>this.maxProj[4]&&(this.maxProj[4]=e,i[4]=o),e=n[o]-n[o+1]+n[o+2],e<this.minProj[5]&&(this.minProj[5]=e,r[5]=o),e>this.maxProj[5]&&(this.maxProj[5]=e,i[5]=o),e=n[o]-n[o+1]-n[o+2],e<this.minProj[6]&&(this.minProj[6]=e,r[6]=o),e>this.maxProj[6]&&(this.maxProj[6]=e,i[6]=o)}for(let o=0;o<7;++o){let e=r[o];fe(this.minVert[o],n,e),e=i[o],fe(this.maxVert[o],n,e)}}}class ce{constructor(){this.b0=(0,c.fA)(1,0,0),this.b1=(0,c.fA)(0,1,0),this.b2=(0,c.fA)(0,0,1),this.quality=0}}function ue(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function he(e,t,r){e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2]}function de(e,t,r){e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2]}function pe(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}function fe(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2]}function me(e,t,r){const i=t[0],n=t[1],s=t[2],o=r[0],a=r[1],l=r[2];e[0]=n*l-s*a,e[1]=s*o-i*l,e[2]=i*a-n*o}function ge(e,t){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(r>0){const i=1/Math.sqrt(r);e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}}function ye(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function _e(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function ve(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}class be{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.uY,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ge,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.zK;this._data=[e[0],e[1],e[2],t[0],t[1],t[2],r[0],r[1],r[2],r[3]]}clone(){const e=new be;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const t=new be;return t._data=e.slice(),t}static fromJSON(e){return new be(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return(0,l.s)(v.rq.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,t,r){this._data[0]=e,this._data[1]=t,this._data[2]=r}get halfSize(){return(0,l.s)(v.rq.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return(0,o.hZ)(v.J8.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const t=we,r=this._data;t[0]=r[6],t[1]=r[7],t[2]=r[8],t[3]=r[9];for(let i=0;i<8;++i){const n=e[i];n[0]=(1&i?-1:1)*r[3],n[1]=(2&i?-1:1)*r[4],n[2]=(4&i?-1:1)*r[5],(0,l.u)(n,n,t),n[0]+=r[0],n[1]+=r[1],n[2]+=r[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],t=this._data[4],r=this._data[5];return Math.sqrt(e*e+t*t+r*r)}intersectSphere(e){Te[0]=this._data[0]-e[0],Te[1]=this._data[1]-e[1],Te[2]=this._data[2]-e[2];const t=this.getQuaternion(xe);return(0,o.Xr)(we,t),(0,l.u)(Te,Te,we),(0,l.v)(Te,Te),Me[0]=Math.min(Te[0],this._data[3]),Me[1]=Math.min(Te[1],this._data[4]),Me[2]=Math.min(Te[2],this._data[5]),(0,l.w)(Me,Te)<e[3]*e[3]}intersectSphereWithMBS(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.radius;const r=this._data;Te[0]=r[0]-e[0],Te[1]=r[1]-e[1],Te[2]=r[2]-e[2];const i=e[3],n=i+t;return!((0,l.x)(Te)>n*n)&&(we[0]=-r[6],we[1]=-r[7],we[2]=-r[8],we[3]=r[9],(0,l.u)(Te,Te,we),(0,l.v)(Te,Te),Me[0]=Math.min(Te[0],r[3]),Me[1]=Math.min(Te[1],r[4]),Me[2]=Math.min(Te[2],r[5]),(0,l.w)(Me,Te)<i*i)}intersectPlane(e){const t=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius((0,y.Qj)(e));return t>r?1:t<-r?-1:0}intersectRay(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=this._data,n=we;n[0]=-i[6],n[1]=-i[7],n[2]=-i[8],n[3]=i[9],Te[0]=e[0]-i[0],Te[1]=e[1]-i[1],Te[2]=e[2]-i[2];const s=(0,l.u)(Te,Te,we),o=(0,l.u)(Me,t,we);let a=-1/0,c=1/0;const u=this.getHalfSize(ke);for(let l=0;l<3;l++){const e=s[l],t=o[l],i=u[l]+r;if(Math.abs(t)>1e-6){const r=(i-e)/t,n=(-i-e)/t;a=Math.max(a,Math.min(r,n)),c=Math.min(c,Math.max(r,n))}else if(e>i||e<-i)return!1}return a<=c}projectedArea(e,t,r,n){const s=this.getQuaternion(xe);(0,o.Xr)(we,s),Te[0]=e[0]-this._data[0],Te[1]=e[1]-this._data[1],Te[2]=e[2]-this._data[2],(0,l.u)(Te,Te,we);const a=this.getHalfSize(ke),c=Te[0]<-a[0]?-1:Te[0]>a[0]?1:0,h=Te[1]<-a[1]?-1:Te[1]>a[1]?1:0,d=Te[2]<-a[2]?-1:Te[2]>a[2]?1:0,p=Math.abs(c)+Math.abs(h)+Math.abs(d);if(0===p)return 1/0;const f=1===p?4:6,m=6*(c+3*h+9*d+13);(0,i.I0)(ze,s),(0,i.hs)(ze,ze,a);const g=this.getCenter(De);for(let i=0;i<f;i++){const e=Re[m+i];(0,l.s)(Te,((1&e)<<1)-1,(2&e)-1,((4&e)>>1)-1),(0,l.t)(Te,Te,ze),(0,l.g)(Ae,g,Te),Ae[3]=1,(0,u.t)(Ae,Ae,t);const r=1/Math.max(1e-6,Ae[3]);Ee[2*i]=Ae[0]*r,Ee[2*i+1]=Ae[1]*r}const y=2*f-2;let _=Ee[0]*(Ee[3]-Ee[y+1])+Ee[y]*(Ee[1]-Ee[y-1]);for(let i=2;i<y;i+=2)_+=Ee[i]*(Ee[i+3]-Ee[i-1]);return Math.abs(_)*r*n*.125}projectedRadius(e){const t=this.getQuaternion(xe);return(0,o.Xr)(we,t),(0,l.u)(Te,e,we),Math.abs(Te[0]*this._data[3])+Math.abs(Te[1]*this._data[4])+Math.abs(Te[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius((0,y.Qj)(e))}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius((0,y.Qj)(e))}toAaBoundingBox(e){const t=this.getQuaternion(xe),r=(0,i.I0)(ze,t),n=this._data[3]*Math.abs(r[0])+this._data[4]*Math.abs(r[3])+this._data[5]*Math.abs(r[6]),s=this._data[3]*Math.abs(r[1])+this._data[4]*Math.abs(r[4])+this._data[5]*Math.abs(r[7]),o=this._data[3]*Math.abs(r[2])+this._data[4]*Math.abs(r[5])+this._data[5]*Math.abs(r[8]);e[0]=this._data[0]-n,e[1]=this._data[1]-s,e[2]=this._data[2]-o,e[3]=this._data[0]+n,e[4]=this._data[1]+s,e[5]=this._data[2]+o}transform(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,p.lO)(r),s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,p.lO)(t),a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:(0,g.jd)(t,s);if(r===n)t.isGeographic?function(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,p.lO)(r);const s=(0,d.tO)(r),a=1+Math.max(0,i)/(s.radius+e.centerZ);e.getCenter(Ne),Ne[2]+=i,(0,m.projectBuffer)(Ne,r,0,Ne,n,0,1),t.center=Ne;const c=e.getQuaternion(xe);t.quaternion=c,(0,o.Xr)(we,c),(0,l.s)(Be,0,0,1),(0,l.u)(Be,Be,we);const u=e.getHalfSize(ke);(0,l.s)(Be,u[0]*Math.abs(Be[0]),u[1]*Math.abs(Be[1]),u[2]*Math.abs(Be[2])),(0,l.j)(Be,Be,s.inverseFlattening),(0,l.g)(Be,u,Be),t.halfSize=(0,l.j)(Be,Be,a)}(this,e,t,i,s):function(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,p.lO)(r),s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,g.jd)(r,n);e.getCorners(Ve),e.getCenter(Ne),Ne[2]+=i,(0,f.l)(r,Ne,Ue,n),t.setCenter(Ue[12],Ue[13],Ue[14]);const a=2*Math.sqrt(1+Ue[0]+Ue[5]+Ue[10]);we[0]=(Ue[6]-Ue[9])/a,we[1]=(Ue[8]-Ue[2])/a,we[2]=(Ue[1]-Ue[4])/a,we[3]=.25*a;const c=e.getQuaternion(xe);t.quaternion=(0,o.lw)(we,we,c),(0,o.Xr)(we,we),(0,l.s)(je,0,0,0);const u=t.getCenter(Fe);for(const o of Ve)o[2]+=i,s(o,0,o,0),(0,l.z)(Be,o,u),(0,l.u)(Be,Be,we),(0,l.v)(Be,Be),(0,l.C)(je,je,Be);t.halfSize=je}(this,e,t,i,s,a);else if(t.isWGS84&&(r.isWebMercator||(0,_.r1)(r)))!function(e,t,r,i,n){t.getCenter(De),De[2]+=n;const s=(0,p.lO)(r);(0,m.projectBuffer)(De,e,0,De,s,0,1),Oe(s,t,De,r,i)}(t,this,r,e,i);else if(t.isWebMercator&&(0,_.r1)(r))!function(e,t,r,i,n){t.getCenter(De),De[2]+=n,Oe(e,t,De,r,i)}(t,this,r,e,i);else{const n=this.getCenter(De);n[2]+=i,(0,m.projectBuffer)(n,t,0,n,r,0,1),e.center=n,this!==e&&(e.quaternion=this.getQuaternion(xe),e.halfSize=this.getHalfSize(ke))}}}const we=(0,a.vt)(),xe=(0,a.vt)(),Se=(0,a.vt)(),Te=(0,c.vt)(),Me=(0,c.vt)(),Ae=(0,h.vt)();function Ce(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new be;return function(e,t){const{data:r,size:i}=e,n=r.length/i;if(n<=0)return;const s=new le(e);he(T,s.minProj,s.maxProj),pe(T,T,.5),de(M,s.maxProj,s.minProj);const o=ue(M),a=new ce;a.quality=o,n<14&&(e=new x.K(new Float64Array(s.buffer,112,42),3));const l=(0,c.vt)(),u=(0,c.vt)(),h=(0,c.vt)(),d=(0,c.vt)(),p=(0,c.vt)(),f=(0,c.vt)(),m=(0,c.vt)();switch(A(s,e,m,l,u,h,d,p,f,a)){case 1:return void q(T,M,t);case 2:return void ee(e,d,t)}D(e,m,l,u,h,d,p,f,a),te(e,a.b0,a.b1,a.b2,J,K);const g=(0,c.vt)();de(g,K,J),a.quality=ue(g),a.quality<o?ae(a.b0,a.b1,a.b2,J,K,g,t):q(T,M,t)}(e,t),t}const Ee=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],Re=(()=>{const e=new Int8Array(162);let t=0;const r=r=>{for(let i=0;i<r.length;i++)e[t+i]=r[i];t+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),e})();function Pe(e,t,r,i,n){const s=e.getQuaternion(xe);n.quaternion=s,(0,o.Xr)(we,s);const a=e.getCenter(De),u=e.getHalfSize(ke);if(i===b.RT.Global){(0,l.u)(Be,a,we),(0,l.v)(je,Be),(0,l.y)(He,je,u),(0,l.z)(He,je,He);const i=(0,l.l)(He);(0,l.g)(He,je,u);const s=(0,l.l)(He);if(i<r)n.center=a,(0,l.s)(Be,r,r,r),n.halfSize=(0,l.g)(Be,u,Be);else{const o=s>0?1+t/s:1,a=i>0?1+r/i:1,c=(a+o)/2,h=(a-o)/2;(0,l.j)(He,je,h),n.halfSize=(0,l.r)(He,He,u,c),(0,l.j)(He,je,c),(0,l.r)(He,He,u,h),(0,l.A)(Be,Be),(0,l.B)(Be,He,Be);const d=e.getQuaternion(Se);n.center=(0,l.u)(Be,Be,d)}}else{n.center=(0,l.r)(Be,a,c.Cb,(r+t)/2);const e=(0,l.u)(Be,c.Cb,we);(0,l.v)(e,e),n.halfSize=(0,l.r)(je,u,e,(r-t)/2)}return n}function Oe(e,t,r,n,s){const o=t.getQuaternion(xe),a=(0,i.I0)(ze,o),l=t.getHalfSize(ke);for(let i=0;i<8;++i){for(let e=0;e<3;++e)Ne[e]=l[e]*(i&1<<e?-1:1);for(let e=0;e<3;++e){let t=r[e];for(let r=0;r<3;++r)t+=Ne[r]*a[3*r+e];Ie[3*i+e]=t}}(0,m.projectBuffer)(Ie,e,0,Ie,n,0,8),Ce(Le,s)}const Ie=new Array(24),Le=new x.K(Ie,3),Ne=(0,c.vt)(),De=(0,c.vt)(),Fe=(0,c.vt)(),ke=(0,c.vt)(),ze=(0,n.vt)(),Ue=(0,s.vt)(),Ve=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Be=(0,c.vt)(),je=(0,c.vt)(),He=(0,c.vt)(),Ge=(0,c.fA)(-1,-1,-1)},29889:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,C:()=>l});var i=r(45308),n=r(44815),s=r(99785),o=r(67425),a=r(33169);function l(e,t,r,i){const a="polygon"===e.type?s.Wq.CCW_IS_HOLE:s.Wq.NONE,l="polygon"===e.type?e.rings:e.paths,{position:c,outlines:h}=(0,s.oR)(l,!!e.hasZ,a,e.spatialReference),d=(0,n.jh)(c.length),p=(0,o.au)(c,e.spatialReference,0,d,0,c,0,c.length/3,t,r,i),f=null!=p;return{lines:f?u(h,c,d):[],projectionSuccess:f,sampledElevation:p}}function c(e,t){const r="polygon"===e.type?s.Wq.CCW_IS_HOLE:s.Wq.NONE,n="polygon"===e.type?e.rings:e.paths,{position:o,outlines:l}=(0,s.oR)(n,!1,r),c=(0,i.projectBuffer)(o,e.spatialReference,0,o,t,0,o.length/3);for(let i=2;i<o.length;i+=3)o[i]=a.bi;return{lines:c?u(l,o):[],projectionSuccess:c}}function u(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new Array;for(const{index:s,count:o}of e){if(o<=1)continue;const e=3*s,a=3*o;i.push({position:(0,n.l5)(t,3*s,3*o),mapPositions:null!=r?(0,n.l5)(r,e,a):void 0})}return i}},12006:(e,t,r)=>{"use strict";r.d(t,{C:()=>n,s:()=>s});var i=r(80963);function n(e){return s(e)||(0,i.q8)(e)||(0,i.KQ)(e)}function s(e){return(0,i.oT)(e)||(0,i.x1)(e)}},93938:(e,t,r)=>{"use strict";r.d(t,{S:()=>n,b:()=>i});const i={value:.5,readOnly:!0},n={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}}},21255:(e,t,r)=>{"use strict";r.d(t,{DC:()=>o,MQ:()=>a,mi:()=>l});var i=r(3112),n=r(35737),s=r(46571);function o(e){return(0,s.i3)(e)&&e.intersector===i.dz.TERRAIN&&!!e.target}class a extends n.R6{constructor(e,t,r){super(e,t),this.triangleNr=r}}function l(e){return(0,s.i3)(e)&&e.intersector===i.dz.OVERLAY&&!!e.target}},79341:(e,t,r)=>{"use strict";var i;r.d(t,{N:()=>i}),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(i||(i={}))},29898:(e,t,r)=>{"use strict";var i;r.d(t,{A:()=>i}),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.WaterNormal=3]="WaterNormal",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(i||(i={}))},33169:(e,t,r)=>{"use strict";r.d(t,{or:()=>ne,bi:()=>ae,O8:()=>le});var i=r(35143),n=r(54099),s=r(81806),o=r(87663),a=r(30726),l=r(30015),c=r(68134),u=r(41289),h=r(46053),d=(r(76460),r(47249),r(85842)),p=r(34761),f=r(20664),m=r(9392),g=r(64465),y=r(57662),_=r(22955),v=r(19539),b=r(2413),w=r(75507);class x{constructor(){this._extent=(0,b.vt)(),this.resolution=0,this.renderLocalOrigin=(0,w.f)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new S}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,b.cY)(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,b.cY)(this._extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,(0,b.C)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}}class S{constructor(){this.extents=[(0,b.vt)(),(0,b.vt)(),(0,b.vt)()],this.numViews=0}}var T=r(29898);class M{constructor(e,t,r){this._fbos=e,this._format=t,this._name=r}get valid(){return null!=this._handle?.getTexture()}dispose(){this._handle=(0,a.Gz)(this._handle)}get texture(){return this._handle?.getTexture()}bind(e,t,r){this._handle&&this._handle.fbo?.width===t&&this._handle.fbo?.height===r||(this._handle?.release(),this._handle=this._fbos.acquire(t,r,this._name,this._format)),e.unbindTexture(this._handle?.fbo?.colorTexture),e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}}var A=r(16455),C=r(34981);class E{constructor(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:A.N.RGBA_MIPMAP;this.output=r,this.content=i,this.fbo=new M(e,n,t)}get valid(){return this.fbo.valid}}class R{constructor(e){this.targets=[new E(e,"overlay color",C.V.Color,T.A.Color),new E(e,"overlay IM color",C.V.Color,T.A.ColorNoRasterImage),new E(e,"overlay highlight",C.V.Highlight,T.A.Highlight,A.N.RGBA4),new E(e,"overlay water",C.V.Normal,T.A.WaterNormal),new E(e,"overlay occluded",C.V.Color,T.A.Occluded)],(0,s.A)("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new E(e,"overlay oid",C.V.ObjectAndLayerIdColor,T.A.ObjectAndLayerIdColor))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce(((e,t,r)=>t.valid?e|=1<<r:e),0)}}var P=r(33062),O=r(12057),I=r(53070),L=r(58229),N=r(60586),D=r(30988),F=r(97583),k=r(45463),z=r(23187),U=r(77730),V=r(90877),B=r(76044),j=r(40325),H=r(86967),G=r(10773),Z=r(44513),$=r(71011),q=r(80381),W=r(16506),Y=r(42693),X=r(32119),J=r(28584),K=r(93345),Q=r(57162);class ee extends Y.w{initializeProgram(e){return new J.B(e.rctx,ee.shader.get().build(),X.D)}initializePipeline(){return(0,Q.Ey)({blending:(0,Q.ox)(K.dn.ONE,K.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Q.wE})}}ee.shader=new W.$(q.a,(()=>r.e(1747).then(r.bind(r,71747))));var te=r(59752),re=r(98433),ie=r(96673);let ne=class extends N.RW{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new q.O,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new l.A,this._passParameters=new I.T,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new P.A,this.worldToPCSRatio=1,this.events=new n.A,this.longitudeCyclical=null,this.produces=new Map([[U.N.DRAPED_MATERIAL,e=>e!==C.V.Highlight||this.hasHighlights],[U.N.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,t=this.view._stage.renderView,{waterTextures:r,stippleTextures:i,markerTextures:n}=t;this._techniques=new L.I({rctx:this._rctx,viewingMode:g.RT.Local,stippleTextures:i,markerTextures:n,waterTextures:r}),this._renderContext=new z.gE(this._rctx,new V.p(e,this.view.state.viewingMode),null),this.addHandles([(0,c.wB)((()=>r.updating),(()=>this.events.emit("content-changed")),c.pc),(0,c.wB)((()=>this.spatialReference),(e=>this._localOriginFactory=new F.g(e)),c.pc),(0,c.on)((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0))]),this._materials=new D.v(t.textures,this._techniques,(()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed"))),this._bindParameters.slot=U.N.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=G.y.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new $.$p((0,m.fA)(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(te.W6.STAGE,this))}destroy(){this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._debugTextureTechnique=(0,a.Gz)(this._debugTextureTechnique),this._passParameters.texture=(0,a.WD)(this._passParameters.texture),this._techniques=(0,a.pR)(this._techniques),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,o.Bs)(this._renderers,(e=>e.updating))}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMaterialRenderer(e){for(const t of this._renderers.values()){const r=t.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map((e=>e.drapeSource.layer)).filter((e=>!!e))}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,B.B)}createDrapeSourceRenderer(e,t,r){const i=this._renderers.get(e);null!=i&&i.destroy();const n=new t({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles((0,c.wB)((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),n}removeDrapeSourceRenderer(e){if(null==e)return;const t=this._renderers.get(e);null!=t&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&(0,u.bw)(e,(e=>e.drapeTargetType===y.sv.WithoutRasterImage))}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=(0,u.bw)(e,(e=>e.drapeSourceType===y.Om.Features)),this._hasDrapedRasterSource=(0,u.bw)(e,(e=>e.drapeSourceType===y.Om.RasterImage))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._bindParameters.overlayStretch;null==this._overlays&&(this._renderTargets=new R(this.view._stage.renderer.fboCache),this._overlays=[new x,new x]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=(0,a.WD)(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){if(null!=e)return e===T.A.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(T.A.Color):this._renderTargets?.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,(()=>!0))}_processDrapeSources(e,t){let r=!1;for(const[i,n]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=(0,o.Bs)(this._renderers,(e=>e.hasHighlights)),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(te.Bb,(e=>e.updatePolicy===Z.q.SYNC))}get isEmpty(){return!_.b.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,o.Bs)(this._renderers,(e=>!e.isEmpty))}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=le;const t=this._sortedRenderers.some((e=>{let{renderer:t}=e;return t.shouldRender(this._renderContext)}));return this._renderContext.renderOccludedMask=e,t}renders(e){return _.b.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==T.A.Occluded||this._sortedRenderers.some((e=>{let{renderer:t}=e;return t.shouldRender(this._renderContext)}))}get mode(){return this.isEmpty?O.w9.Disabled:this._renderTargets?.getTexture(T.A.WaterNormal)?O.w9.EnabledWithWater:this._renderTargets?.getTexture(T.A.Color)?O.w9.Enabled:O.w9.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach((r=>t=r.updateAnimation(e)||t)),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const e of this._overlays)this.longitudeCyclical?e.setupGeometryViewsCyclical(this.longitudeCyclical):e.setupGeometryViewsDirect();for(const t of this._renderTargets.targets){if(t.content===T.A.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(v.vr.INNER,t,e),i=this._drawTarget(v.vr.OUTER,t,e);(r||i)&&t.fbo.generateMipMap()}}}_drawTarget(e,t,r){const i=this._overlays[e],n=i.canvasGeometries;if(0===n.numViews)return!1;const{alignPixelEnabled:s,contentPixelRatio:o}=r;this._screenToWorldRatio=o*i.mapUnitsPerPixel/this._bindParameters.overlayStretch;const a=t.output;if(this.isEmpty||a===C.V.Highlight&&!this.hasHighlights||a===C.V.Normal&&!this.hasWater||!i.hasSomeSizedView())return!1;const l=this._rctx;if(this._camera.pixelRatio=i.pixelRatio*o,this._renderContext.output=a,this._bindParameters.alignPixelEnabled=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===C.V.Normal?U.N.DRAPED_WATER:U.N.DRAPED_MATERIAL,t.content===T.A.Occluded&&(this._renderContext.renderOccludedMask=le),!this.renders(t.content))return this._renderContext.renderOccludedMask=z.Vr,!1;const c=i.resolution;this._rctx.setViewport(e===v.vr.INNER?0:c,0,c,c);const u=2*i.resolution,h=i.resolution,d=t.fbo;if(d.bind(l,u,h),e===v.vr.INNER&&(l.setClearColor(0,0,0,0),l.clear(K.hn.COLOR_BUFFER_BIT)),_.b.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==T.A.Occluded)for(let p=0;p<n.numViews;p++)this._setViewParameters(n.extents[p],i),this._ensureDebugPatternResources(i.resolution,oe[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll((r=>{let{drapeSource:s,renderer:o}=r;if(t.content===T.A.ColorNoRasterImage&&s.drapeSourceType===y.Om.RasterImage)return;const{fullOpacity:c}=s,p=null!=c&&c<1&&a===C.V.Color?this.bindTemporaryFramebuffer(u,h):null;for(let e=0;e<n.numViews;e++)this._setViewParameters(n.extents[e],i),o.render(this._renderContext);if(p){d.bind(l,u,h),this._overlayParameters.texture=p.getTexture(),this._overlayParameters.opacity=c,this._overlayParameters.overlayIndex=e;const t=this.pluginContext.techniques.acquire(ee);this._rctx.bindTechnique(t,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),t.release(),p.release()}})),l.bindFramebuffer(null),this._renderContext.renderOccludedMask=z.Vr,!0}bindTemporaryFramebuffer(e,t){const r=this.view._stage.renderer.fboCache,i=r.acquire(e,t,"overlay tmp");return r.rctx.unbindTexture(i.fbo?.colorTexture),r.rctx.bindFramebuffer(i.fbo),r.rctx.clear(K.hn.COLOR_BUFFER_BIT),i}async reloadShaders(){await this._techniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:s}of this._sortedRenderers)n=s.intersect?.(e,t,r,i,n)??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const e=this.view.map.allLayers,t=e.length;this._renderers.forEach(((r,i)=>{const n=e.indexOf(i.layer),s=n>=0,o=i.renderGroup??(s?y.O7.MapLayer:y.O7.ViewLayer),a=t*o+(s?n:0);this._sortedRenderers.push(new se(i,r,a))})),this._sortedRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t){const r=this._camera;r.viewport=[0,0,t.resolution,t.resolution],(0,p.v3)(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),(0,p.kN)(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=(0,o.Bs)(this._renderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_ensureDebugPatternResources(e,t){if((0,f.s)(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let i=0;for(let o=0;o<e;o++)for(let t=0;t<e;t++){const n=Math.floor(t/10),s=Math.floor(o/10);n<2||s<2||10*n>e-20||10*s>e-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&n&&1&s?1&t^1&o?0:255:1&n^1&s?0:128)}const n=new ie.R(e);n.samplingMode=K.Cj.NEAREST,this._passParameters.texture=new re.g(this._rctx,n,r);const s=new H.M;s.hasAlpha=!0,this._debugTextureTechnique=this._techniques.acquire(j.e,s)}get test(){}};(0,i._)([(0,h.MZ)()],ne.prototype,"hasHighlights",void 0),(0,i._)([(0,h.MZ)()],ne.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,i._)([(0,h.MZ)()],ne.prototype,"_techniques",void 0),(0,i._)([(0,h.MZ)({constructOnly:!0})],ne.prototype,"view",void 0),(0,i._)([(0,h.MZ)()],ne.prototype,"worldToPCSRatio",void 0),(0,i._)([(0,h.MZ)()],ne.prototype,"spatialReference",void 0),(0,i._)([(0,h.MZ)({type:Boolean,readOnly:!0})],ne.prototype,"updating",null),(0,i._)([(0,h.MZ)()],ne.prototype,"isEmpty",null),(0,i._)([(0,h.MZ)({readOnly:!0})],ne.prototype,"rendersOccludedDraped",null),ne=(0,i._)([(0,d.$)("esri.views.3d.terrain.OverlayRenderer")],ne);class se{constructor(e,t,r){this.drapeSource=e,this.renderer=t,this.index=r}}const oe=[[1,.5,.5],[.5,.5,1]],ae=-2,le=k.m$.OccludeAndTransparent},16475:(e,t,r)=>{"use strict";var i;r.d(t,{X:()=>i}),function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"}(i||(i={}))},54883:(e,t,r)=>{"use strict";r.d(t,{CU:()=>l,EY:()=>u,Me:()=>a,P2:()=>f,SR:()=>o,cf:()=>h,hB:()=>p,nU:()=>m,sH:()=>c,yt:()=>d});var i=r(15941),n=r(2413),s=r(66908);const o=64,a=512,l=2.5,c=(0,i.$8)(i.pq/10),u=2,h=(0,n.vt)();s.n.WebMercatorAuxiliarySphere.getExtent(0,0,0,h);const d=(0,n.vt)([-180,-90,180,90]),p="Cannot extend surface to encompass all layers because it would result in too many root tiles.",f="Surface extent is too large for tile resolution at level 0.",m=4},74110:(e,t,r)=>{"use strict";function i(e){return null!=e&&"type"in e&&"vector-tile"===e.type}function n(e){return null!=e&&"type"in e&&"raster-tile"===e.type}function s(e){return null!=e&&"type"in e&&"tile-texture"===e.type}function o(e){return null!=e&&"type"in e&&"image+type"===e.type}r.d(t,{Cs:()=>s,EM:()=>o,k$:()=>n,kC:()=>i})},66908:(e,t,r)=>{"use strict";r.d(t,{P:()=>m,n:()=>f});r(35238);var i=r(50076),n=(r(81806),r(15941)),s=r(31633),o=r(76797),a=r(13312),l=r(2413),c=r(80963),u=r(45417),h=r(22848),d=r(88235),p=r(19247);class f{constructor(e){const t=f.checkUnsupported(e);if(null!=t)throw t;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=(0,c.EA)(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const i=r.lods.reduce(((e,t)=>(t.level<e.minLod.level&&(e.minLod=t),e.max=Math.max(e.max,t.level),e)),{minLod:r.lods[0],max:-1/0}),n=i.minLod,s=2**n.level;let o=n.resolution*s,a=n.scale*s;this.levels=new Array(i.max+1);for(let l=0;l<this.levels.length;l++)this.levels[l]={resolution:o,scale:a,tileSize:[o*r.size[0],o*r.size[1]]},o/=2,a/=2}clone(){return new f(this.toTileInfo())}toTileInfo(){return new d.A({dpi:this.dpi,origin:new p.A({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(((e,t)=>new h.A({level:t,scale:e.scale,resolution:e.resolution})))})}getExtent(e,t,r,i){const n=this.levels[e],s=n.tileSize[0],o=n.tileSize[1];i[0]=this.origin[0]+r*s,i[2]=this.origin[0]+(r+1)*s,i[3]=this.origin[1]-t*o,i[1]=this.origin[1]-(t+1)*o}convertExtentToRadians(e,t){this._isWebMercator?(t[0]=(0,u.yw)(e[0]),t[1]=(0,u.jg)(e[1]),t[2]=(0,u.yw)(e[2]),t[3]=(0,u.jg)(e[3])):this._isGCS&&(t[0]=(0,n.kU)(e[0]),t[1]=(0,n.kU)(e[1]),t[2]=(0,n.kU)(e[2]),t[3]=(0,n.kU)(e[3]))}getExtentGeometry(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.A;return this.getExtent(e,t,r,g),i.spatialReference=this.spatialReference,i.xmin=g[0],i.ymin=g[1],i.xmax=g[2],i.ymax=g[3],i.zmin=void 0,i.zmax=void 0,i}ensureMaxLod(e){if(null==e)return!1;let t=!1;for(;this.levels.length<=e;){const{resolution:e,scale:r}=this.levels[this.levels.length-1],i=e/2*this.pixelSize;this.levels.push({resolution:e/2,scale:r/2,tileSize:[i,i]}),t=!0}return t}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const t=this.levels[0].scale;return e>=t?0:Math.log(t/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;if(f.checkUnsupported(e))return!1;const r=new f(e);if(!r.spatialReference.equals(this.spatialReference))return!1;if(r.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length-1,r.levels.length-1,t),s=this.levels[i].resolution;let o=.5*s;return!(!(0,n.Sp)(r.origin[0],this.origin[0],o)||!(0,n.Sp)(r.origin[1],this.origin[1],o))&&(o=.5*s/2**i/this.pixelSize*12,(0,n.Sp)(s,r.levels[i].resolution,o))}rootTilesInExtent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;const i=new Array,n=this.levels[0].tileSize;if(null==e||0===n[0]||0===n[1])return i;f.computeRowColExtent(e,n,this.origin,g);let s=g[1],o=g[3],a=g[0],l=g[2];const c=l-a,u=o-s;if(c*u>r){const e=Math.floor(Math.sqrt(r));u>e&&(s=s+Math.floor(.5*u)-Math.floor(.5*e),o=s+e),c>e&&(a=a+Math.floor(.5*c)-Math.floor(.5*e),l=a+e)}for(let h=s;h<o;h++)for(let e=a;e<l;e++)i.push([0,h,e]);return null!=t&&(t[0]=this.origin[0]+a*n[0],t[1]=this.origin[1]-o*n[1],t[2]=this.origin[0]+l*n[0],t[3]=this.origin[1]-s*n[1]),i}static computeRowColExtent(e,t,r,i){const n=.001*(e[2]-e[0]+(e[3]-e[1]));i[0]=Math.max(0,Math.floor((e[0]+n-r[0])/t[0])),i[2]=Math.max(0,Math.ceil((e[2]-n-r[0])/t[0])),i[1]=Math.max(0,Math.floor((r[1]-e[3]+n)/t[1])),i[3]=Math.max(0,Math.ceil((r[1]-e[1]-n)/t[1]))}static isPowerOfTwo(e){const t=e.lods,r=t[0].resolution*2**t[0].level;return!t.some((e=>!(0,n.b6)(e.resolution,r/2**e.level)))}static hasGapInLevels(e){const t=e.lods.map((e=>e.level));t.sort(((e,t)=>e-t));for(let r=1;r<t.length;r++)if(t[r]!==t[0]+r)return!0;return!1}static tileSizeSupported(e){const t=e.size[1];return t===e.size[0]&&!(t&t-1)&&t>=128&&t<=512}static hasOriginPerLODs(e){const t=e.origin;return e.lods.some((e=>null!=e.origin&&(e.origin[0]!==t.x||e.origin[1]!==t.y)))}static getMissingTileInfoError(){return new i.A("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return null==e?m():e.lods.length<1?new i.A("tilingscheme:generic","Tiling scheme must have at least one level"):f.isPowerOfTwo(e)?f.hasGapInLevels(e)?new i.A("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):f.tileSizeSupported(e)?f.hasOriginPerLODs(e)?new i.A("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new i.A("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new i.A("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,t){const r=e[2]-e[0],i=e[3]-e[1],n=(0,s.GA)(t),o=1.2*Math.max(r,i),a=o/256,l=a*n*(96/.0254),c=new f(new d.A({size:[256,256],origin:new p.A({x:e[0]-.5*(o-r),y:e[3]+.5*(o-i)}),lods:[new h.A({level:0,resolution:a,scale:l})],spatialReference:t}));return c.ensureMaxLod(20),c}static makeWebMercatorAuxiliarySphere(e){const t=new f(f.WebMercatorAuxiliarySphereTileInfo);return t.ensureMaxLod(e),t}static makeGCSWithTileSize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16;const i=256/t,n=new f(new d.A({size:[t,t],origin:new p.A({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new h.A({level:0,resolution:.703125*i,scale:295497598.570834*i})]}));return n.ensureMaxLod(r),n}get test(){}}function m(){return new i.A("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}f.WebMercatorAuxiliarySphereTileInfo=new d.A({size:[256,256],origin:new p.A({x:-20037508.342787,y:20037508.342787,spatialReference:a.A.WebMercator}),spatialReference:a.A.WebMercator,lods:[new h.A({level:0,resolution:156543.03392800014,scale:591657527.591555})]}),f.WebMercatorAuxiliarySphere=f.makeWebMercatorAuxiliarySphere(19);const g=(0,l.vt)()},19539:(e,t,r)=>{"use strict";var i,n,s,o;r.d(t,{JG:()=>n,ZY:()=>o,iw:()=>s,vr:()=>i}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(i||(i={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(n||(n={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(s||(s={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(o||(o={}))},4225:(e,t,r)=>{"use strict";r.d(t,{yL:()=>ee,_y:()=>W,T7:()=>E,L8:()=>M,Tn:()=>C,aL:()=>A,BU:()=>P,Uo:()=>Y,GH:()=>R,KE:()=>z,sZ:()=>oe,oX:()=>F,Gk:()=>k,rI:()=>G,fe:()=>B,LC:()=>U,uK:()=>le,HF:()=>ne,Ci:()=>O,mJ:()=>ae,eS:()=>V,E5:()=>H,G3:()=>N,Y4:()=>Z,cU:()=>j,Ec:()=>se,hL:()=>ie,xl:()=>K,XQ:()=>ue,Rz:()=>ce,jj:()=>te,JM:()=>re,n8:()=>$,t6:()=>J,Cs:()=>q,hC:()=>Q,bA:()=>X,bk:()=>T});var i=r(19276),n=r(80963),s=r(31933),o=r(64465),a=r(79341),l=r(74110),c=r(50076),u=r(20664),h=r(9392),d=r(2413),p=r(12006),f=r(54883),m=r(66908);const g=(0,h.vt)(),y=(0,h.vt)(),_=(0,h.vt)(),v=(0,h.vt)();function b(e,t,r,i){(0,u.c)(g,r),g[i]=t[i];const n=(0,u.f)(g,g,t),s=(0,u.f)(y,e,t),o=(0,u.m)(s,n),a=(0,u.m)(n,n);let l;l=o<=0?t:a<=o?r:(0,u.g)(g,t,(0,u.j)(n,n,o/a));const c=(0,u.f)(g,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}const w=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:function(e,t,r,i){if(null==e)return(0,m.P)();const n=e.spatialReference;if(n.isGeographic&&!(0,p.s)(n))return new c.A("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const s=m.n.checkUnsupported(e);if(null!=s)return s;if(null==r)return new c.A("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const o=function(e,t){const r=e.lods,i=r[0].resolution*2**r[0].level,n=[i*e.size[0],i*e.size[1]],s=[e.origin.x,e.origin.y],o=(0,d.VY)(t),a=(0,d.vt)();m.n.computeRowColExtent(o,n,s,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>f.SR){const t=r[0].scale*2**r[0].level;let n=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*t/i;const s=Math.floor(Math.log(n)/Math.log(10));return n=Math.ceil(n/10**s)*10**s,new c.A("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(t).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+n.toLocaleString()+".",{level0Scale:t,suggestedLevel0Scale:n,requiredNumRootTiles:l,allowedNumRootTiles:f.SR})}return null}(e,r);return o||(null==t||n.equals(t)||t.isWGS84&&n.isWebMercator?null:new c.A("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"))},isInsideExtent:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=e.extent;if(null==i)return!1;if(0===r)return(0,d.Uc)(i,t);const n=Math.min(i[2]-i[0],i[3]-i[1]);return(0,d.k$)(i,t,r*n)},tiltToExtentEdge:function(e,t,r){const i=e.extent;if(null==i)return 0;_[0]=i[0],_[1]=i[1],_[2]=r,v[0]=i[2],v[1]=i[3],v[2]=r;let n=1/0,s=1/0;return t[0]<_[0]?n=b(t,_,v,0):t[0]>v[0]&&(n=b(t,v,_,0)),t[1]<_[1]?s=b(t,_,v,1):t[1]>v[1]&&(s=b(t,v,_,1)),Math.min(n,s)}},Symbol.toStringTag,{value:"Module"}));const x=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:function(e,t,r,i){if(null==e)return(0,m.P)();const n=e?.lods.length-1,s=e.spatialReference;if(s.isWebMercator){if(!m.n.makeWebMercatorAuxiliarySphere(n).compatibleWith(e,i))return new c.A("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!(0,p.C)(s))return new c.A("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!m.n.makeGCSWithTileSize(e.spatialReference,e.size[0],n).compatibleWith(e,i))return e.spatialReference.isWGS84?new c.A("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new c.A("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return null==t||e.spatialReference.equals(t)?null:new c.A("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")},isInsideExtent:function(){return!0},tiltToExtentEdge:function(){return 0}},Symbol.toStringTag,{value:"Module"})),S={[o.RT.Global]:x,[o.RT.Local]:w};function T(e,t){e||console.warn("Terrain: "+t)}let M=!1,A=!1;function C(e){A=e,M=M||e}function E(e){M=e}function R(e,t){if(M&&!e){const e=(new Error).stack?.slice(5);throw console.warn("Terrain internal: "+(t??"")+" at "+e),new Error("Assertion failed"+(t?": "+t:""))}}function P(e){return I(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function O(e){return"imagery-tile"===e?.type||"wcs"===e?.type}function I(e){return"imagery-tile-3d"===e?.type}function L(e){return"tile-3d"===e?.type}function N(e){return"vector-tile-3d"===e?.type}function D(e){return"wmts-3d"===e?.type}function F(e){return"elevation-3d"===e?.type}function k(e){return"group"===e?.type}function z(e){return e&&(L(e)||D(e)||I(e)||N(e))}function U(e){return e&&(L(e)||I(e)||N(e)||D(e))}function V(e){return U(e)||F(e)}function B(e){return(0,l.k$)(e?.sourceLayerInfo?.data)}function j(e){return Z(e?.sourceLayerInfo)||!!e?.isVTLBackground}function H(e){return(0,l.Cs)(e?.sourceLayerInfo?.data)}function G(e){const t=e?.sourceLayerInfo?.data;return(0,l.EM)(t)||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData}function Z(e){return(0,l.kC)(e?.data)}function $(e){return null!=e&&"release"in e&&e.release(),null}function q(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function W(e,t,r,i,n){return S[i].checkIfTileInfoSupportedForViewSR(e,r,t,n)}function Y(e,t,r){let n=null,a=null;if("wmts"===e?.type){const o=function(e,t,r){const n=(0,s.r0)(e);if(null!=n){if(!i.A.isCollection(n))return{tileInfo:n.tileInfo,fullExtent:n.fullExtent};{const e=n.find((e=>null==W(e.tileInfo,e.fullExtent,t,r)));if(e)return{tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return{tileInfo:null,fullExtent:null}}(e,t,r);n=o.tileInfo,a=o.fullExtent}else{a=O(e)?e.getCompatibleFullExtent(t):e.fullExtent;const i=r===o.RT.Local;n=O(e)?e.getCompatibleTileInfo(t,a,i):"vector-tile"===e?.type?i&&!X(t)||J.force512VTL?e.tileInfo:e.tileInfo.getCompatibleForVTL(256):e.tileInfo}const l="tilemapCache"in e?e.tilemapCache?.effectiveMaxLOD:void 0;return null!=n&&null!=a&&null==W(n,a,t,r,l)?{tileInfo:n,fullExtent:a}:null}function X(e){return e.isWGS84||e.isWebMercator||(0,n.x1)(e)||!(0,n.B3)(e)}const J={force512VTL:!1};function K(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function Q(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function ee(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:he;return Math.abs(e-t)<r}function te(e){return e===a.N.NORTH_EAST?a.N.SOUTH_WEST:e===a.N.NORTH_WEST?a.N.SOUTH_EAST:e===a.N.SOUTH_WEST?a.N.NORTH_EAST:a.N.NORTH_WEST}function re(e){return e===a.N.NORTH?a.N.SOUTH:e===a.N.EAST?a.N.WEST:e===a.N.SOUTH?a.N.NORTH:a.N.EAST}function ie(e){return e===a.N.NORTH_WEST||e===a.N.SOUTH_WEST}function ne(e){return e===a.N.NORTH_WEST||e===a.N.NORTH_EAST}function se(e){return e===a.N.NORTH_WEST||e===a.N.WEST||e===a.N.SOUTH_WEST}function oe(e){return e===a.N.NORTH_EAST||e===a.N.EAST||e===a.N.SOUTH_EAST}function ae(e){return e===a.N.SOUTH_EAST||e===a.N.SOUTH||e===a.N.SOUTH_WEST}function le(e){return e===a.N.NORTH_EAST||e===a.N.NORTH||e===a.N.NORTH_WEST}const ce=[a.N.NORTH,a.N.EAST,a.N.SOUTH,a.N.WEST],ue=[a.N.NORTH_EAST,a.N.SOUTH_EAST,a.N.SOUTH_WEST,a.N.NORTH_WEST],he=1e-5},9902:(e,t,r)=>{"use strict";r.d(t,{C2:()=>s,D_:()=>a,Ey:()=>c,Ri:()=>d,V$:()=>o,ZH:()=>_,jV:()=>m,kh:()=>y,lR:()=>l,vx:()=>g});var i=r(30015),n=r(16475);class s{constructor(){this._queue=new i.A,this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._queue.clear(),null!=e&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e?.[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}}class o{constructor(){this._q=new i.A}get done(){return 0===this._q.length}reset(e){if(this._q.clear(),null!=e){this._q.pushArray(e);for(let e=0;e<this._q.length;++e){const t=this._q.data[e];t.isLeaf||this._q.pushArray(t.children)}}}next(){return this._q.pop()}}function a(e,t,r){if(null==t?.fullExtent)return!1;const i=t.fullExtent,n=e.extent;if(r){if(n[0]<i.xmin||n[1]<i.ymin||n[2]>i.xmax||n[3]>i.ymax)return!1}else if(i.xmin>n[2]||i.ymin>n[3]||i.xmax<n[0]||i.ymax<n[1])return!1;const s=e.surface.tilingScheme.levels[e.level].scale,o=t.minScale;if(o>0&&s>1.00000001*o)return!1;const a=t.maxScale;return!(a>0&&s<.99999999*a)}function l(e,t){const r=e.lij,i=t.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function c(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null==r||0===r.length?e===n.X.BACK_TO_FRONT?t.sort(u):t.sort(h):t.sort(((t,i)=>function(e,t,r,i){return p(e,i)===p(t,i)?d(e,t,r):e?r:-r}(t,i,e,r)))}function u(e,t){const r=t.screenDepth-e.screenDepth;if(0!==r)return r;const i=e.lij,n=t.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function h(e,t){const r=e.screenDepth-t.screenDepth;if(0!==r)return r;const i=e.lij,n=t.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function d(e,t,r){const i=e.screenDepth,n=t.screenDepth;return i<n?-r:i>n?r:l(e,t)}function p(e,t){for(const r of t)if(e.intersectsExtent(r))return!0;return!1}function f(e,t){const r=e.distanceToPOI-t.distanceToPOI;if(0!==r)return r;const i=e.lij,n=t.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function m(e,t){const r=e.length;for(let i=0;i<r;++i)e.at(i).updateDistanceToPOI(t);e.sort(f)}function g(e,t,r){let i=1,n=0,s=0;for(;e!==t;)if(i*=.5,n*=.5,s*=.5,1&e.lij[2]&&(n+=.5),1&e.lij[1]||(s+=.5),null==(e=e.parent))throw new Error("tile was not a descendant of upsampleTile");r.init(t,n,s,i)}function y(e){for(let t=0;t<e.length;t++){const r=e[t],i=r.parent;if(i)for(let e=0;e<4;e++){const t=i.children[e];if(t&&t!==r)return!0}}return!1}function _(e,t){if(!e||!t||e[0]===t[0])return!1;const r=e[0]<t[0],i=r?e:t,n=r?t:e,s=1<<n[0]-i[0];return Math.floor(n[1]/s)===i[1]&&Math.floor(n[2]/s)===i[2]}},91555:(e,t,r)=>{"use strict";r.d(t,{f5:()=>D,d0:()=>S,Wo:()=>k,em:()=>z});var i=r(35143),n=r(30726),s=r(63919),o=r(44680),a=r(20664),l=r(9392),c=r(43047),u=r(55855),h=r(51990),d=r(29898),p=r(63599),f=r(44493),m=r(13545),g=r(28710),y=r(64839);class _ extends y.Y{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,null!=this._parameterBlocks)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(null==this._parameterBlocks)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}}class v{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function b(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t,r)=>{const i=t._parameterCount??0;if(t._parameterCount=i+1,e.vectorOps){const n=e.vectorOps;Object.defineProperty(t,r,{get(){return this[i]},set(e){const t=this[i];if(null==t)this[i]=e;else{if(n.equals(t,e))return;n.copy(t,e)}this._setDirty()}})}else Object.defineProperty(t,r,{get(){return this[i]},set(t){this[i]!==t&&(e.dispose&&this[i]&&this[i].dispose(),this[i]=t,this._setDirty())}})}}function w(){return(e,t)=>{const r=e._parameterCount??0;e._parameterCount=r+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(r),Object.defineProperty(e,t,{get(){return this[r]},set(e){this[r]!==e&&(this[r]=e,this._setDirty())}})}}var x,S,T=r(89712),M=r(34981),A=r(59046),C=r(27920),E=r(26719),R=r(90235),P=r(81148),O=r(77845),I=r(83490),L=r(10773),N=r(78992);class D extends _{constructor(e,t){super(),this.toMapSpace=t,this.baseColor=(0,u.fA)(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=(0,l.ci)(N.Rk),this.emissiveFactor=(0,l.fA)(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new F,this.componentParameters=new k,this.textureAlphaCutoff=R.H,this.alphaDiscardMode=I.sf.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=P.T.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new f.E;const r=new O.p(e.position),i=(0,o.o8)(e.rotationScale);(0,s.B8)(i,i),(0,s.mg)(i,i),this.transformNormalGlobalFromModel=i,this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=(0,n.Gz)(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return null!=this.baseColorTexture?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return null!=this.metallicRoughnessTexture?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return null!=this.emissionTexture?this.emissionTexture.glTexture:null}get textureOcclusion(){return null!=this.occlusionTexture?this.occlusionTexture.glTexture:null}get textureNormal(){return null!=this.normalTexture?this.normalTexture.glTexture:null}prepareTechnique(e,t,r,i){const n=this._techniqueConfiguration;n.hasVertexColors=i.colors,n.hasNormals=i.hasNormals,n.textureCoordinateType=i.textureCoordinates,n.hasMetallicRoughnessTexture=null!=this.metallicRoughnessTexture,n.hasEmissionTexture=null!=this.emissionTexture,n.hasOcclusionTexture=null!=this.occlusionTexture,n.hasNormalTexture=null!=this.normalTexture,n.transparencyPassType=t.identifier===T.zq.Material&&null!=r.transparencyPassType?r.transparencyPassType:L.y.NONE,n.multipassEnabled=t.identifier===T.zq.Material&&r.multipassEnabled,n.cullAboveGround=t.identifier===T.zq.Material&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?C.W.View:C.W.None,n.hasColorTexture=null!=this.baseColorTexture;const s=this._computeWhichMaterialPass();if(n.blendingEnabled=s===x.Transparent||s===x.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?function(e){return null!=e.overlay?.getTexture(d.A.ColorNoRasterImage)}(r)?function(e){return null!=e.overlay?.getTexture(d.A.WaterNormal)}(r)?f.g.ColorOverlayWithWater:f.g.ColorOverlay:f.g.NoOverlay:f.g.None,n.hasPolygonOffset=this.polygonOffsetEnabled,n.pbrMode=n.integratedMeshMode===f.g.ColorOverlayWithWater?E.A9.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?i.needsNormals&&this.isIntegratedMesh?E.A9.Disabled:E.A9.Schematic:E.A9.Normal:E.A9.Disabled,n.normalType=i.needsNormals?n.hasNormals?A.W.Compressed:A.W.ScreenDerivative:A.W.Ground,n.hasSlicePlane=null!=r.slicePlane&&this.commonMaterialParameters.hasSlicePlane,t.identifier===T.zq.ShadowMap)n.output=M.V.Shadow,n.vertexDiscardMode=g.q.None;else if(t.identifier===T.zq.ViewshedShadowMap)n.output=M.V.ViewshedShadow,n.vertexDiscardMode=g.q.None;else if(t.identifier===T.zq.Highlight)n.output=M.V.Highlight,n.vertexDiscardMode=g.q.None;else{switch(s===x.OpaqueAndTransparent?n.vertexDiscardMode=t.transparent?g.q.Opaque:g.q.Transparent:n.vertexDiscardMode=g.q.None,n.output=t.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,t.output){case M.V.Color:n.receiveAmbientOcclusion=null!=r.ssao,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=null!=r.ssr.lastFrameColor,n.hasCloudsReflections=null!=r.cloudsFade.data;break;case M.V.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(r)}return this._technique=e.releaseAndAcquire(p.e,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return null!=e.weather&&e.weatherVisible&&"snowy"===e.weather.type&&"enabled"===e.weather.snowCover}submit(e,t,r){if(0===this.objectOpacity)return;const i=r.renderable.geometry,n=r.components,s=r.renderable.meta.cameraDepthSquared,o=n.geometryRanges,a=n.highlightRanges,l=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case x.Opaque:e.materialOpaque.submitDraw(this,i,o,s);break;case x.Transparent:e.materialTransparent.submitDraw(this,i,o,s);break;case x.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,i,o,s),e.materialTransparent.submitDraw(this,i,o,s);break;case x.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,i,o,s),function(e){return null!=e.overlay?.getTexture(d.A.Highlight)}(t)&&e.highlightIntegratedMesh.submitDraw(this,i,o,s)}const c=this.componentParameters.castShadows!==S.None;c&&e.shadowMap.submitDraw(this,i,o,s),null!=a&&(e.highlight.submitDraw(this,i,a,s),c&&e.highlightShadowMap.submitDraw(this,i,a,s)),t.viewshedEnabled&&e.viewshedShadowMap.submitDraw(this,i,o,s),c&&null!=l&&e.defaultShadowMap.submitDraw(this,i,l,s)}_computeWhichMaterialPass(){return this.isIntegratedMesh?x.IntegratedMesh:this.objectOpacity<1?x.Transparent:this.componentParameters.opaqueOverride===S.All?x.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===I.sf.Blend||this.alphaDiscardMode===I.sf.MaskBlend?x.Transparent:this.componentParameters.transparent===S.None?x.Opaque:this.componentParameters.transparent===S.All?x.Transparent:x.OpaqueAndTransparent}}(0,i._)([b({vectorOps:c.v})],D.prototype,"baseColor",void 0),(0,i._)([b()],D.prototype,"usePBR",void 0),(0,i._)([b()],D.prototype,"hasParametersFromSource",void 0),(0,i._)([b({vectorOps:a.I})],D.prototype,"mrrFactors",void 0),(0,i._)([b({vectorOps:a.I})],D.prototype,"emissiveFactor",void 0),(0,i._)([b({dispose:!0})],D.prototype,"baseColorTexture",void 0),(0,i._)([b({dispose:!0})],D.prototype,"metallicRoughnessTexture",void 0),(0,i._)([b({dispose:!0})],D.prototype,"emissionTexture",void 0),(0,i._)([b({dispose:!0})],D.prototype,"occlusionTexture",void 0),(0,i._)([b({dispose:!0})],D.prototype,"normalTexture",void 0),(0,i._)([b()],D.prototype,"objectOpacity",void 0),(0,i._)([w()],D.prototype,"commonMaterialParameters",void 0),(0,i._)([w()],D.prototype,"componentParameters",void 0),(0,i._)([b()],D.prototype,"textureAlphaCutoff",void 0),(0,i._)([b()],D.prototype,"alphaDiscardMode",void 0),(0,i._)([b()],D.prototype,"isIntegratedMesh",void 0),(0,i._)([b()],D.prototype,"polygonOffsetEnabled",void 0),(0,i._)([b()],D.prototype,"ellipsoidMode",void 0),(0,i._)([b()],D.prototype,"hasOccludees",void 0),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(x||(x={}));class F extends v{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=I.s2.Back,this.hasSlicePlane=!0}}(0,i._)([b()],F.prototype,"doubleSided",void 0),(0,i._)([b()],F.prototype,"cullFace",void 0),(0,i._)([b()],F.prototype,"hasSlicePlane",void 0);class k extends v{constructor(){super(...arguments),this.externalColor=(0,u.fA)(1,1,1,1),this.externalColorMixMode=h.k5.Multiply,this.castShadows=S.All}get transparent(){return this.externalColor[3]<1?S.All:S.None}get opaqueOverride(){return this.externalColorMixMode===h.k5.Replace&&1===this.externalColor[3]?S.All:S.None}get visible(){return this.externalColor[3]>0?S.All:S.None}get type(){return m.Sg.Uniform}}(0,i._)([b({vectorOps:c.v})],k.prototype,"externalColor",void 0),(0,i._)([b()],k.prototype,"externalColorMixMode",void 0),(0,i._)([b()],k.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(S||(S={}));class z extends v{constructor(){super(...arguments),this.texture=null,this.transparent=S.None,this.opaqueOverride=S.None,this.castShadows=S.None}get type(){return m.Sg.Varying}}(0,i._)([b()],z.prototype,"texture",void 0),(0,i._)([b()],z.prototype,"transparent",void 0),(0,i._)([b()],z.prototype,"opaqueOverride",void 0),(0,i._)([b()],z.prototype,"castShadows",void 0)},63599:(e,t,r)=>{"use strict";r.d(t,{T:()=>_,e:()=>y});var i=r(64465),n=r(44493),s=r(42287),o=r(34981),a=r(16506),l=r(42693),c=r(83490),u=r(60322),h=r(28584),d=r(96643),p=r(10773),f=r(66470),m=r(93345),g=r(57162);class y extends l.w{initializeConfiguration(e,t){t.spherical=e.viewingMode===i.RT.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new h.B(e.rctx,y.shader.get().build(this.configuration),_)}_setPipelineState(e){const t=this.configuration,r=t.integratedMeshMode!==n.g.None,i=e===p.y.NONE,s=e===p.y.FrontFace;return(0,g.Ey)({blending:t.output===o.V.Color&&t.blendingEnabled?i?u.V0:(0,u.ez)(e):null,culling:(0,g.Xt)(t.cullFace),depthTest:{func:(0,u.K_)(e)},depthWrite:i||s?g.kn:null,drawBuffers:t.output===o.V.Depth?{buffers:[m.Hr.NONE]}:(0,u.cl)(e),colorWrite:g.wE,stencilWrite:r||t.hasOccludees?d.v0:null,stencilTest:r?(0,d.ub)(c.dd.IntegratedMeshMaskExcluded):t.hasOccludees?d.qh:null,polygonOffset:i||s?t.hasPolygonOffset?{factor:2,units:2}:null:u.SE})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}y.shader=new a.$(s.C,(()=>r.e(1412).then(r.bind(r,1412))));const _=new Map([[f.r.POSITION,0],[f.r.NORMAL,1],[f.r.NORMALCOMPRESSED,1],[f.r.COLOR,2],[f.r.UV0,3],[f.r.UVREGION,4],[f.r.COMPONENTINDEX,5]])},44493:(e,t,r)=>{"use strict";r.d(t,{E:()=>y,g:()=>i});var i,n=r(35143),s=r(13545),o=r(28710),a=r(34981),l=r(59046),c=r(97808),u=r(27920),h=r(26719),d=r(81148),p=r(24245),f=r(99415),m=r(83490),g=r(10773);!function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"}(i||(i={}));class y extends f.K{constructor(){super(...arguments),this.output=a.V.Color,this.textureCoordinateType=c.q.None,this.componentData=s.Sg.Uniform,this.cullFace=m.s2.Back,this.vertexDiscardMode=o.q.None,this.doubleSidedMode=u.W.WindingOrder,this.alphaDiscardMode=m.sf.Opaque,this.integratedMeshMode=i.None,this.transparencyPassType=g.y.NONE,this.ellipsoidMode=d.T.Earth,this.pbrMode=h.A9.Disabled,this.normalType=l.W.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.hasNormalTextureTransform=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}}(0,n._)([(0,f.W)({count:a.V.COUNT})],y.prototype,"output",void 0),(0,n._)([(0,f.W)({count:c.q.COUNT})],y.prototype,"textureCoordinateType",void 0),(0,n._)([(0,f.W)({count:s.Sg.COUNT})],y.prototype,"componentData",void 0),(0,n._)([(0,f.W)({count:m.s2.COUNT})],y.prototype,"cullFace",void 0),(0,n._)([(0,f.W)({count:o.q.COUNT})],y.prototype,"vertexDiscardMode",void 0),(0,n._)([(0,f.W)({count:u.W.COUNT})],y.prototype,"doubleSidedMode",void 0),(0,n._)([(0,f.W)({count:m.sf.COUNT})],y.prototype,"alphaDiscardMode",void 0),(0,n._)([(0,f.W)({count:i.COUNT})],y.prototype,"integratedMeshMode",void 0),(0,n._)([(0,f.W)({count:g.y.COUNT})],y.prototype,"transparencyPassType",void 0),(0,n._)([(0,f.W)({count:d.T.COUNT})],y.prototype,"ellipsoidMode",void 0),(0,n._)([(0,f.W)({count:h.A9.COUNT})],y.prototype,"pbrMode",void 0),(0,n._)([(0,f.W)({count:l.W.COUNT})],y.prototype,"normalType",void 0),(0,n._)([(0,f.W)()],y.prototype,"spherical",void 0),(0,n._)([(0,f.W)()],y.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,n._)([(0,f.W)()],y.prototype,"hasVertexColors",void 0),(0,n._)([(0,f.W)()],y.prototype,"hasNormals",void 0),(0,n._)([(0,f.W)()],y.prototype,"hasSlicePlane",void 0),(0,n._)([(0,f.W)()],y.prototype,"hasColorTexture",void 0),(0,n._)([(0,f.W)()],y.prototype,"receiveAmbientOcclusion",void 0),(0,n._)([(0,f.W)()],y.prototype,"receiveShadows",void 0),(0,n._)([(0,f.W)()],y.prototype,"blendingEnabled",void 0),(0,n._)([(0,f.W)()],y.prototype,"hasScreenSpaceReflections",void 0),(0,n._)([(0,f.W)()],y.prototype,"hasPolygonOffset",void 0),(0,n._)([(0,f.W)()],y.prototype,"hasMetallicRoughnessTexture",void 0),(0,n._)([(0,f.W)()],y.prototype,"hasEmissionTexture",void 0),(0,n._)([(0,f.W)()],y.prototype,"hasOcclusionTexture",void 0),(0,n._)([(0,f.W)()],y.prototype,"hasNormalTexture",void 0),(0,n._)([(0,f.W)()],y.prototype,"hasOccludees",void 0),(0,n._)([(0,f.W)()],y.prototype,"multipassEnabled",void 0),(0,n._)([(0,f.W)()],y.prototype,"cullAboveGround",void 0),(0,n._)([(0,f.W)()],y.prototype,"hasNormalTextureTransform",void 0),(0,n._)([(0,f.W)()],y.prototype,"hasCloudsReflections",void 0),(0,n._)([(0,f.W)()],y.prototype,"snowCover",void 0),(0,n._)([(0,f.W)()],y.prototype,"objectAndLayerIdColor",void 0),(0,n._)([(0,f.W)({constValue:!1})],y.prototype,"occlusionPass",void 0),(0,n._)([(0,f.W)({constValue:p.c.Draw})],y.prototype,"pbrTextureBindType",void 0),(0,n._)([(0,f.W)({constValue:!0})],y.prototype,"hasSliceHighlight",void 0),(0,n._)([(0,f.W)({constValue:!1})],y.prototype,"hasSliceInVertexProgram",void 0),(0,n._)([(0,f.W)({constValue:!1})],y.prototype,"useCustomDTRExponentForWater",void 0),(0,n._)([(0,f.W)({constValue:!1})],y.prototype,"hasVertexTangents",void 0),(0,n._)([(0,f.W)({constValue:!0})],y.prototype,"supportsTextureAtlas",void 0),(0,n._)([(0,f.W)({constValue:!1})],y.prototype,"highStepCount",void 0),(0,n._)([(0,f.W)({constValue:!1})],y.prototype,"instancedDoublePrecision",void 0),(0,n._)([(0,f.W)({constValue:!1})],y.prototype,"hasModelTransformation",void 0),(0,n._)([(0,f.W)({constValue:!0})],y.prototype,"useFillLights",void 0),(0,n._)([(0,f.W)({constValue:!1})],y.prototype,"objectAndLayerIdColorInstanced",void 0)},13545:(e,t,r)=>{"use strict";r.d(t,{cz:()=>v,Sg:()=>p,B:()=>_,Hi:()=>y});var i=r(4212),n=r(14522),s=r(81806),o=r(59581),a=r(34981),l=r(81449),c=r(20123),u=r(7223),h=r(24245);class d extends u.n{constructor(e,t){super(e,"int",h.c.Draw,((r,i,n)=>r.setUniform1i(e,t(i,n))))}}var p,f=r(64839),m=r(27374),g=r(66470);!function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"}(p||(p={}));const y=429496.7296;function _(e,t){(0,n.U)(e/y*.5+.5,t)}function v(e,t){switch(t.componentData){case p.Varying:return function(e,t){const{vertex:r,fragment:i}=e;r.include(l.W),r.uniforms.add(new m.o("componentColorTex",(e=>e.componentParameters.texture.texture))),e.attributes.add(g.r.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4");const n=t.output===a.V.ObjectAndLayerIdColor;n&&e.varyings.add("vObjectAndLayerIdColor","vec4"),e.include(o.A),r.constants.add("elevationScale","float",2*y),r.constants.add("stride","float",(0,s.A)("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(f.H`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(f.H`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${n?f.H`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:f.H`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(f.H`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?f.H`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}(e,t);case p.Uniform:return function(e,t){const{vertex:r,fragment:i}=e;r.uniforms.add(new c.V("externalColor",(e=>e.componentParameters.externalColor))),i.uniforms.add(new d("externalColorMixMode",(e=>e.componentParameters.externalColorMixMode))),e.varyings.add("vExternalColor","vec4"),r.code.add(f.H`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const n=t.output===a.V.ObjectAndLayerIdColor;i.code.add(f.H`
  void readExternalColor(out vec4 color, out int colorMixMode) {
    color = vExternalColor;
    colorMixMode = externalColorMixMode;
  }

  void outputObjectAndLayerIdColor() {
    ${n?f.H`fragColor = vec4(0,0,0,0);`:""}
 }
`)}(e,t);case p.COUNT:return;default:(0,i.Xb)(t.componentData)}}},59581:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var i=r(51990),n=r(64839);function s(e){e.vertex.code.add(n.H`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${n.H.int(i.k5.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${n.H.int(i.k5.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${n.H.int(i.k5.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${n.H.int(i.k5.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}},28710:(e,t,r)=>{"use strict";r.d(t,{j:()=>o,q:()=>i});var i,n=r(4212),s=r(64839);function o(e,t){const r=e.vertex;switch(r.code.add(s.H`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case i.None:r.code.add(s.H`#define vertexDiscardByOpacity(_opacity_) {}`);break;case i.Opaque:r.code.add(s.H`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case i.Transparent:r.code.add(s.H`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case i.COUNT:break;default:(0,n.Xb)(t.vertexDiscardMode)}}!function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"}(i||(i={}))},16449:(e,t,r)=>{"use strict";r.d(t,{h:()=>o});var i=r(48549),n=r(97808),s=r(66470);function o(e){const t=(0,i.BP)().vec3f(s.r.POSITION);return e.hasNormals&&t.vec2i16(s.r.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===n.q.Default?t.vec2f(s.r.UV0):e.textureCoordinates===n.q.Atlas&&(t.vec2f(s.r.UV0),t.vec4u16(s.r.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(s.r.COLOR,{glNormalized:!0}),t}},89712:(e,t,r)=>{"use strict";r.d(t,{Dh:()=>l,d0:()=>h,eF:()=>u,kR:()=>c,zq:()=>i});var i,n=r(9392),s=r(34981),o=r(55386);class a extends o.Zo{constructor(){super(...arguments),this.slicePlaneLocalOrigin=(0,n.vt)(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}}!function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight",e[e.ViewshedShadowMap=3]="ViewshedShadowMap"}(i||(i={}));class l extends a{constructor(){super(...arguments),this.identifier=i.Material,this.output=s.V.Color,this.transparent=!1}}class c extends a{constructor(){super(...arguments),this.identifier=i.ShadowMap}}class u extends a{constructor(){super(...arguments),this.identifier=i.Highlight}}class h extends a{constructor(){super(...arguments),this.identifier=i.ViewshedShadowMap}}},72412:(e,t,r)=>{"use strict";r.d(t,{Mu:()=>a,i$:()=>c,oD:()=>u,xJ:()=>l});var i=r(34981),n=r(36358),s=r(95756),o=r(64839);function a(e){e.varyings.add("linearDepth","float")}function l(e){e.vertex.uniforms.add(new s.G("nearFar",((e,t)=>t.camera.nearFar)))}function c(e){e.vertex.code.add(o.H`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function u(e,t){const{vertex:r}=e;switch(t.output){case i.V.Color:if(t.receiveShadows)return a(e),void r.code.add(o.H`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case i.V.Shadow:case i.V.ShadowHighlight:case i.V.ShadowExcludeHighlight:case i.V.ViewshedShadow:return e.include(n.em,t),a(e),l(e),c(e),void r.code.add(o.H`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(o.H`void forwardLinearDepth() {}`)}},62423:(e,t,r)=>{"use strict";r.d(t,{r:()=>o});var i=r(65058),n=r(27963),s=r(64839);function o(e){const t=e.fragment;e.include(n.Ir),t.include(i.E),t.code.add(s.H`vec3 normalFromDepth(sampler2D depthMap, vec3 pixelPos, vec2 fragCoord, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
float leftPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(-1, 0), 0).r);
float rightPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(1, 0), 0).r);
float bottomPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, -1), 0).r);
float topPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, 1), 0).r);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`)}},62026:(e,t,r)=>{"use strict";r.d(t,{M:()=>n});var i=r(64839);function n(e){e.vertex.code.add(i.H`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}},73398:(e,t,r)=>{"use strict";r.d(t,{c:()=>s});var i=r(64839),n=r(66470);function s(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.attributes.add(n.r.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(i.H`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?i.H`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}},34981:(e,t,r)=>{"use strict";var i;function n(e){return s(e)||e===i.Depth||e===i.Normal||e===i.ObjectAndLayerIdColor}function s(e){return e===i.Shadow||e===i.ShadowHighlight||e===i.ShadowExcludeHighlight||e===i.ViewshedShadow}function o(e){return f(e)||e===i.Normal}function a(e){return e===i.Highlight||e===i.ObjectAndLayerIdColor}function l(e){return e===i.Color||a(e)}function c(e){return e===i.Color}function u(e){return c(e)||e===i.ObjectAndLayerIdColor}function h(e){return c(e)||e===i.Highlight}function d(e){return h(e)||m(e)}function p(e){return c(e)||a(e)}function f(e){return p(e)||m(e)}function m(e){return e===i.Depth}r.d(t,{MO:()=>f,PJ:()=>s,V:()=>i,XY:()=>o,_o:()=>c,aD:()=>d,cb:()=>n,dX:()=>p,eh:()=>m,i3:()=>l,u5:()=>a,zW:()=>u}),function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.ShadowHighlight=4]="ShadowHighlight",e[e.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",e[e.ViewshedShadow=6]="ViewshedShadow",e[e.Highlight=7]="Highlight",e[e.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",e[e.COUNT=9]="COUNT"}(i||(i={}))},26917:(e,t,r)=>{"use strict";r.d(t,{HQ:()=>d,S4:()=>h,dk:()=>u});var i=r(34761),n=r(13191),s=r(20664),o=r(9392),a=r(72468),l=r(5517),c=r(64839);class u extends c.Y{constructor(e){super(),this.slicePlaneLocalOrigin=e}}function h(e,t){p(e,t,new l.t("slicePlaneOrigin",((e,r)=>y(t,e,r))),new l.t("slicePlaneBasis1",((e,r)=>_(t,e,r,r.slicePlane?.basis1))),new l.t("slicePlaneBasis2",((e,r)=>_(t,e,r,r.slicePlane?.basis2))))}function d(e,t){p(e,t,new a.W("slicePlaneOrigin",((e,r)=>y(t,e,r))),new a.W("slicePlaneBasis1",((e,r)=>_(t,e,r,r.slicePlane?.basis1))),new a.W("slicePlaneBasis2",((e,r)=>_(t,e,r,r.slicePlane?.basis2))))}function p(e,t){if(!t.hasSlicePlane){const r=c.H`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(r),void e.fragment.code.add(r)}for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];t.hasSliceInVertexProgram&&e.vertex.uniforms.add(...i),e.fragment.uniforms.add(...i);const s=c.H`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,o=c.H`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,a=t.hasSliceHighlight?c.H`
        ${o}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:c.H`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(s),e.fragment.code.add(s),e.fragment.code.add(a)}function f(e,t,r){return e.instancedDoublePrecision?(0,s.s)(v,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function m(e,t){return null!=e?(0,s.f)(b,t.origin,e):t.origin}function g(e,t,r){return e.hasSliceTranslatedView?null!=t?(0,i.Tl)(x,r.camera.viewMatrix,t):r.camera.viewMatrix:null}function y(e,t,r){if(null==r.slicePlane)return o.uY;const i=f(e,t,r),n=m(i,r.slicePlane),a=g(e,i,r);return null!=a?(0,s.h)(b,n,a):n}function _(e,t,r,i){if(null==i||null==r.slicePlane)return o.uY;const n=f(e,t,r),a=m(n,r.slicePlane),l=g(e,n,r);return null!=l?((0,s.g)(w,i,a),(0,s.h)(b,a,l),(0,s.h)(w,w,l),(0,s.f)(w,w,b)):i}const v=(0,o.vt)(),b=(0,o.vt)(),w=(0,o.vt)(),x=(0,n.vt)()},59395:(e,t,r)=>{"use strict";r.d(t,{d:()=>s});var i=r(72412),n=r(64839);function s(e){(0,i.i$)(e),e.vertex.code.add(n.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),e.vertex.code.add(n.H`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},45937:(e,t,r)=>{"use strict";r.d(t,{BK:()=>w,nW:()=>v});var i=r(35143),n=r(63919),s=r(44680),o=r(13191),a=r(20664),l=r(9392),c=r(34981),u=r(89299),h=r(3799),d=r(72468),p=r(64839),f=r(72106),m=r(43425),g=r(99415),y=r(66470),_=r(99643);class v extends g.K{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}}(0,i._)([(0,g.W)()],v.prototype,"instancedDoublePrecision",void 0),(0,i._)([(0,g.W)()],v.prototype,"hasModelTransformation",void 0);p.Y;const b=(0,s.vt)();function w(e,t){const r=t.hasModelTransformation,i=t.instancedDoublePrecision;r&&(e.vertex.uniforms.add(new m.X("model",(e=>e.modelTransformation??o.zK))),e.vertex.uniforms.add(new f.k("normalLocalOriginFromModel",(e=>((0,n.Ge)(b,e.modelTransformation??o.zK),b))))),t.instanced&&i&&(e.attributes.add(y.r.INSTANCEMODELORIGINHI,"vec3"),e.attributes.add(y.r.INSTANCEMODELORIGINLO,"vec3"),e.attributes.add(y.r.INSTANCEMODEL,"mat3"),e.attributes.add(y.r.INSTANCEMODELNORMAL,"mat3"));const s=e.vertex;i&&(s.include(u.u,t),s.uniforms.add(new d.W("viewOriginHi",((e,t)=>(0,_.Zo)((0,a.s)(x,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),x))),new d.W("viewOriginLo",((e,t)=>(0,_.jA)((0,a.s)(x,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),x))))),s.code.add(p.H`
    vec3 getVertexInLocalOriginSpace() {
      return ${r?i?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":i?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${i?p.H`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),s.code.add(p.H`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${r?i?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":i?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),t.output===c.V.Normal&&((0,h.S7)(s),s.code.add(p.H`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${r?i?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":i?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),t.hasVertexTangents&&s.code.add(p.H`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${r?i?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":i?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const x=(0,l.vt)()},59046:(e,t,r)=>{"use strict";r.d(t,{W:()=>i,Y:()=>a});var i,n=r(4212),s=r(64839),o=r(66470);function a(e,t){switch(t.normalType){case i.Compressed:e.attributes.add(o.r.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(s.H`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case i.Attribute:e.attributes.add(o.r.NORMAL,"vec3"),e.vertex.code.add(s.H`vec3 normalModel() {
return normal;
}`);break;case i.ScreenDerivative:e.fragment.code.add(s.H`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:(0,n.Xb)(t.normalType);case i.COUNT:case i.Ground:}}!function(e){e[e.Attribute=0]="Attribute",e[e.Compressed=1]="Compressed",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"}(i||(i={}))},90080:(e,t,r)=>{"use strict";r.d(t,{g:()=>o});var i=r(34981),n=r(64839),s=r(66470);function o(e,t){const r=t.output===i.V.ObjectAndLayerIdColor,o=t.objectAndLayerIdColorInstanced;r&&(e.varyings.add("objectAndLayerIdColorVarying","vec4"),o?e.attributes.add(s.r.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):e.attributes.add(s.r.OBJECTANDLAYERIDCOLOR,"vec4")),e.vertex.code.add(n.H`
     void forwardObjectAndLayerIdColor() {
      ${r?o?n.H`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:n.H`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:n.H``} }`),e.fragment.code.add(n.H`
      void outputObjectAndLayerIdColor() {
        ${r?n.H`fragColor = objectAndLayerIdColorVarying;`:n.H``} }`)}},85887:(e,t,r)=>{"use strict";r.d(t,{H:()=>p,W:()=>f});var i=r(72745),n=r(838),s=r(95756),o=r(5517),a=r(66701),l=r(60205),c=r(64839),u=r(66470),h=r(93684);const d=8;function p(e,t){const r=u.r.FEATUREVALUE;e.attributes.add(r,"vec4");const i=e.vertex;i.code.add(c.H`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new s.G("size",(e=>e.size))),t.vvSize?(i.uniforms.add(new o.t("vvSizeMinSize",(e=>e.vvSize.minSize)),new o.t("vvSizeMaxSize",(e=>e.vvSize.maxSize)),new o.t("vvSizeOffset",(e=>e.vvSize.offset)),new o.t("vvSizeFactor",(e=>e.vvSize.factor))),i.code.add(c.H`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(c.H`vec2 getSize(){
return size;
}`),t.vvOpacity?(i.constants.add("vvOpacityNumber","int",d),i.uniforms.add(new l.x("vvOpacityValues",(e=>e.vvOpacity.values),d),new l.x("vvOpacityOpacities",(e=>e.vvOpacity.opacityValues),d)),i.code.add(c.H`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(c.H`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(i.constants.add("vvColorNumber","int",h.p),i.uniforms.add(new l.x("vvColorValues",(e=>e.vvColor.values),h.p),new a.F("vvColorColors",(e=>e.vvColor.colors),h.p)),i.code.add(c.H`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(c.H`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(n.I),e.attributes.add(u.r.PROFILERIGHT,"vec4"),e.attributes.add(u.r.PROFILEUP,"vec4"),e.attributes.add(u.r.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(c.H`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(c.H`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(c.H`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(c.H`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class f extends h.S{constructor(){super(...arguments),this.size=(0,i.fA)(1,1)}}},838:(e,t,r)=>{"use strict";r.d(t,{I:()=>s});var i=r(64839),n=r(66470);function s(e){e.attributes.add(n.r.POSITION,"vec3"),e.vertex.code.add(i.H`vec3 positionModel() { return position; }`)}},3838:(e,t,r)=>{"use strict";r.d(t,{s:()=>u});var i=r(66763),n=r(5517),s=r(21390),o=r(60205),a=r(64839),l=r(66470);const c=8;function u(e,t){const r=e.vertex;r.uniforms.add(new s.m("intrinsicWidth",(e=>e.width))),t.vvSize?(e.attributes.add(l.r.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new n.t("vvSizeMinSize",(e=>e.vvSize.minSize)),new n.t("vvSizeMaxSize",(e=>e.vvSize.maxSize)),new n.t("vvSizeOffset",(e=>e.vvSize.offset)),new n.t("vvSizeFactor",(e=>e.vvSize.factor))),r.code.add(a.H`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(l.r.SIZE,"float"),r.code.add(a.H`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(l.r.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new o.x("vvOpacityValues",(e=>e.vvOpacity.values),c),new o.x("vvOpacityOpacities",(e=>e.vvOpacity.opacityValues),c)),r.code.add(a.H`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(a.H`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.include(i.A,t),e.attributes.add(l.r.COLORFEATUREATTRIBUTE,"float"),r.code.add(a.H`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(e.attributes.add(l.r.COLOR,"vec4"),r.code.add(a.H`vec4 getColor(){
return applyOpacity(color);
}`))}},22148:(e,t,r)=>{"use strict";r.d(t,{K:()=>l});var i=r(59581),n=r(72790),s=r(64839),o=r(66470),a=r(99362);function l(e,t){t.hasSymbolColors?(e.include(i.A),e.attributes.add(o.r.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(s.H`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new n.c("colorMixMode",(e=>a.Um[e.colorMixMode]))),e.vertex.code.add(s.H`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}},97808:(e,t,r)=>{"use strict";r.d(t,{U:()=>a,q:()=>i});var i,n=r(4212),s=r(64839),o=r(66470);function a(e,t){switch(t.textureCoordinateType){case i.Default:return e.attributes.add(o.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(s.H`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case i.Compressed:return e.attributes.add(o.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(s.H`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case i.Atlas:return e.attributes.add(o.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(o.r.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(s.H`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:(0,n.Xb)(t.textureCoordinateType);case i.None:return void e.vertex.code.add(s.H`void forwardTextureCoordinates() {}`);case i.COUNT:return}}!function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.Compressed=3]="Compressed",e[e.COUNT=4]="COUNT"}(i||(i={}))},54478:(e,t,r)=>{"use strict";r.d(t,{c:()=>s});var i=r(64839),n=r(66470);function s(e,t){t.hasVertexColors?(e.attributes.add(n.r.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(i.H`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(i.H`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(i.H`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},55386:(e,t,r)=>{"use strict";r.d(t,{Mh:()=>h,Zo:()=>d,gy:()=>p});var i=r(4212),n=r(44680),s=r(55855),o=r(59046),a=r(36358),l=r(64839),c=r(42759),u=r(72106);function h(e,t){switch(t.normalType){case o.W.Attribute:case o.W.Compressed:e.include(o.Y,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add(new c.h("transformNormalGlobalFromModel",(e=>e.transformNormalGlobalFromModel)),new u.k("transformNormalViewFromGlobal",(e=>e.transformNormalViewFromGlobal))),e.vertex.code.add(l.H`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case o.W.Ground:e.include(a.em,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(l.H`
        void forwardNormal() {
          vNormalWorld = ${t.spherical?l.H`normalize(vPositionWorldCameraRelative);`:l.H`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case o.W.ScreenDerivative:e.vertex.code.add(l.H`void forwardNormal() {}`);break;default:(0,i.Xb)(t.normalType);case o.W.COUNT:}}class d extends a.dO{constructor(){super(...arguments),this.transformNormalViewFromGlobal=(0,n.vt)()}}class p extends a.EM{constructor(){super(...arguments),this.transformNormalGlobalFromModel=(0,n.vt)(),this.toMapSpace=(0,s.vt)()}}},36358:(e,t,r)=>{"use strict";r.d(t,{EM:()=>g,dO:()=>m,em:()=>f});var i=r(44680),n=r(13191),s=r(9392),o=r(838),a=r(89299),l=r(72468),c=r(5517),u=r(64839),h=r(42759),d=r(72106),p=r(43425);function f(e,t){e.include(o.I);const r=e.vertex;r.include(a.u,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),r.uniforms.add(new c.t("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH)),new c.t("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new d.k("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new p.X("transformProjFromView",(e=>e.transformProjFromView)),new h.h("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new l.W("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new l.W("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL))),r.code.add(u.H`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(u.H`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?u.H`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:u.H`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new c.t("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL))),r.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class m extends u.Y{constructor(){super(...arguments),this.transformWorldFromViewTH=(0,s.vt)(),this.transformWorldFromViewTL=(0,s.vt)(),this.transformViewFromCameraRelativeRS=(0,i.vt)(),this.transformProjFromView=(0,n.vt)()}}class g extends u.Y{constructor(){super(...arguments),this.transformWorldFromModelRS=(0,i.vt)(),this.transformWorldFromModelTH=(0,s.vt)(),this.transformWorldFromModelTL=(0,s.vt)()}}},112:(e,t,r)=>{"use strict";r.d(t,{O:()=>n});var i=r(64839);function n(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(i.H`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(i.H`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(i.H`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}},11105:(e,t,r)=>{"use strict";r.d(t,{r:()=>a});var i=r(4212),n=r(97808),s=r(23976),o=r(64839);function a(e,t){switch(e.include(n.U,t),t.textureCoordinateType){case n.q.Default:case n.q.Compressed:return void e.fragment.code.add(o.H`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case n.q.Atlas:return e.include(s.r),void e.fragment.code.add(o.H`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:(0,i.Xb)(t.textureCoordinateType);case n.q.None:case n.q.COUNT:return}}},25530:(e,t,r)=>{"use strict";r.d(t,{G:()=>c,V:()=>h});var i=r(43047),n=r(55855),s=r(69817),o=r(3799),a=r(58350),l=r(64839);function c(e,t){const r=e.vertex;t.hasVerticalOffset?(h(r),t.hasScreenSizePerspective&&(e.include(s.Y6),(0,s.OH)(r),(0,o.yu)(e.vertex,t)),r.code.add(l.H`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?l.H`vec3 worldNormal = normalize(worldPos + localOrigin);`:l.H`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?l.H`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:l.H`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(l.H`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const u=(0,n.vt)();function h(e){e.uniforms.add(new a.E("verticalOffset",((e,t)=>{const{minWorldLength:r,maxWorldLength:n,screenLength:s}=e.verticalOffset,o=Math.tan(.5*t.camera.fovY)/(.5*t.camera.fullViewport[3]),a=t.camera.pixelRatio||1;return(0,i.s)(u,s*a,o,r,n)})))}},15710:(e,t,r)=>{"use strict";r.d(t,{E:()=>v});var i=r(72412),n=r(34981),s=r(26917),o=r(59395),a=r(59046),l=r(90080),c=r(97808),u=r(55386),h=r(49399),d=r(48020),p=r(66763),f=r(55806),m=r(3799),g=r(64839),y=r(70367),_=r(83490);function v(e,t){const{vertex:r,fragment:v}=e,b=t.hasColorTexture&&t.alphaDiscardMode!==_.sf.Opaque;switch(t.output){case n.V.Depth:(0,m.NB)(r,t),e.include(o.d,t),e.include(s.HQ,t),e.include(c.U,t),b&&v.uniforms.add(new y.N("tex",(e=>e.texture))),r.code.add(g.H`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),e.include(f.S,t),v.code.add(g.H`
          void main(void) {
            discardBySlice(vpos);
            ${b?g.H`
                    vec4 texColor = texture(tex, ${t.hasColorTextureTransform?g.H`colorUV`:g.H`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
          }
        `);break;case n.V.Shadow:case n.V.ShadowHighlight:case n.V.ShadowExcludeHighlight:case n.V.ViewshedShadow:case n.V.ObjectAndLayerIdColor:(0,m.NB)(r,t),e.include(o.d,t),e.include(c.U,t),e.include(p.A,t),e.include(h.L,t),e.include(s.HQ,t),e.include(l.g,t),(0,i.xJ)(e),e.varyings.add("depth","float"),b&&v.uniforms.add(new y.N("tex",(e=>e.texture))),r.code.add(g.H`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`),e.include(f.S,t),v.code.add(g.H`
          void main(void) {
            discardBySlice(vpos);
            ${b?g.H`
                    vec4 texColor = texture(tex, ${t.hasColorTextureTransform?g.H`colorUV`:g.H`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${t.output===n.V.ObjectAndLayerIdColor?g.H`outputObjectAndLayerIdColor();`:g.H`outputDepth(depth);`}
          }
        `);break;case n.V.Normal:{(0,m.NB)(r,t),e.include(o.d,t),e.include(a.Y,t),e.include(u.Mh,t),e.include(c.U,t),e.include(p.A,t),b&&v.uniforms.add(new y.N("tex",(e=>e.texture))),t.normalType===a.W.ScreenDerivative&&e.varyings.add("vPositionView","vec3");const i=t.normalType===a.W.Attribute||t.normalType===a.W.Compressed;r.code.add(g.H`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${i?g.H`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:g.H`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),e.include(s.HQ,t),e.include(f.S,t),v.code.add(g.H`
          void main() {
            discardBySlice(vpos);
            ${b?g.H`
                    vec4 texColor = texture(tex, ${t.hasColorTextureTransform?g.H`colorUV`:g.H`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${t.normalType===a.W.ScreenDerivative?g.H`vec3 normal = screenDerivativeNormal(vPositionView);`:g.H`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case n.V.Highlight:(0,m.NB)(r,t),e.include(o.d,t),e.include(c.U,t),e.include(p.A,t),b&&v.uniforms.add(new y.N("tex",(e=>e.texture))),r.code.add(g.H`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),e.include(s.HQ,t),e.include(f.S,t),e.include(d.Qh,t),v.code.add(g.H`
          void main() {
            discardBySlice(vpos);
            ${b?g.H`
                    vec4 texColor = texture(tex, ${t.hasColorTextureTransform?g.H`colorUV`:g.H`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}},98720:(e,t,r)=>{"use strict";r.d(t,{K:()=>s});var i=r(53736),n=r(64839);function s(e){e.uniforms.add(new i.e("alignPixelEnabled",((e,t)=>t.alignPixelEnabled))),e.code.add(n.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(n.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}},40318:(e,t,r)=>{"use strict";r.d(t,{Q:()=>h,R:()=>u});var i=r(25530),n=r(69817),s=r(3799),o=r(58350),a=r(21390),l=r(64839),c=r(66470);const u=.5;function h(e,t){e.include(n.Y6),e.attributes.add(c.r.POSITION,"vec3"),e.attributes.add(c.r.NORMAL,"vec3"),e.attributes.add(c.r.CENTEROFFSETANDDISTANCE,"vec4");const r=e.vertex;(0,s.NB)(r,t),(0,s.yu)(r,t),r.uniforms.add(new o.E("viewport",((e,t)=>t.camera.fullViewport)),new a.m("polygonOffset",(e=>e.shaderPolygonOffset)),new a.m("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,i.V)(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(l.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(l.H`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${t.multipassEnabled?l.H.float(0):l.H`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.draped&&!t.hasVerticalOffset||(0,s.S7)(r),t.draped||(r.uniforms.add(new a.m("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),r.code.add(l.H`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${l.H.float(u)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),t.screenCenterOffsetUnitsEnabled&&(0,s.Nz)(r),t.hasScreenSizePerspective&&(0,n.OH)(r),r.code.add(l.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?l.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled?"":l.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}},38280:(e,t,r)=>{"use strict";r.d(t,{I:()=>o});var i=r(98720),n=r(81993),s=r(64839);function o(e,t){const{vertex:r,fragment:o}=e;r.include(i.K),t.multipassEnabled&&e.varyings.add("depth","float"),r.code.add(s.H`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.include(n.Q,t),o.code.add(s.H`
  void main() {
    fragColor = vec4(1);
    ${t.multipassEnabled?s.H`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}},98521:(e,t,r)=>{"use strict";var i;r.d(t,{D:()=>i}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(i||(i={}))},62374:(e,t,r)=>{"use strict";r.d(t,{y:()=>c});var i=r(98720),n=r(98521),s=r(58350),o=r(21390),a=r(64839),l=r(70367);function c(e){e.vertex.uniforms.add(new o.m("renderTransparentlyOccludedHUD",((e,t)=>t.hudRenderStyle===n.D.Occluded?1:t.hudRenderStyle===n.D.NotOccluded?0:.75)),new s.E("viewport",((e,t)=>t.camera.fullViewport)),new l.N("hudVisibilityTexture",((e,t)=>t.hudVisibility?.getTexture()))),e.vertex.include(i.K),e.vertex.code.add(a.H`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}},32124:(e,t,r)=>{"use strict";var i;r.d(t,{IU:()=>i,aO:()=>s,wy:()=>n}),function(e){e[e.Normal=0]="Normal",e[e.Average=1]="Average",e[e.Lighten=2]="Lighten",e[e.Lighter=3]="Lighter",e[e.Plus=4]="Plus",e[e.Screen=5]="Screen",e[e.ColorDodge=6]="ColorDodge",e[e.Darken=7]="Darken",e[e.Multiply=8]="Multiply",e[e.ColorBurn=9]="ColorBurn",e[e.Overlay=10]="Overlay",e[e.SoftLight=11]="SoftLight",e[e.HardLight=12]="HardLight",e[e.VividLight=13]="VividLight",e[e.Hue=14]="Hue",e[e.Saturation=15]="Saturation",e[e.Luminosity=16]="Luminosity",e[e.Color=17]="Color",e[e.DestinationOver=18]="DestinationOver",e[e.DestinationAtop=19]="DestinationAtop",e[e.DestinationIn=20]="DestinationIn",e[e.DestinationOut=21]="DestinationOut",e[e.SourceAtop=22]="SourceAtop",e[e.SourceIn=23]="SourceIn",e[e.SourceOut=24]="SourceOut",e[e.Xor=25]="Xor",e[e.Difference=26]="Difference",e[e.Exclusion=27]="Exclusion",e[e.Minus=28]="Minus",e[e.Invert=29]="Invert",e[e.Reflect=30]="Reflect",e[e.COUNT=31]="COUNT"}(i||(i={}));const n={normal:i.Normal,average:i.Average,lighten:i.Lighten,lighter:i.Lighter,screen:i.Screen,plus:i.Plus,"color-dodge":i.ColorDodge,darken:i.Darken,multiply:i.Multiply,"color-burn":i.ColorBurn,overlay:i.Overlay,"soft-light":i.SoftLight,"hard-light":i.HardLight,"vivid-light":i.VividLight,hue:i.Hue,saturation:i.Saturation,luminosity:i.Luminosity,color:i.Color,difference:i.Difference,exclusion:i.Exclusion,minus:i.Minus,invert:i.Invert,reflect:i.Reflect,"destination-over":i.DestinationOver,"destination-atop":i.DestinationAtop,"destination-in":i.DestinationIn,"destination-out":i.DestinationOut,"source-atop":i.SourceAtop,"source-in":i.SourceIn,"source-out":i.SourceOut,xor:i.Xor};function s(e){return e===i.DestinationOver||e===i.DestinationAtop||e===i.DestinationIn||e===i.DestinationOut||e===i.SourceAtop||e===i.SourceIn||e===i.SourceOut||e===i.Xor}},49399:(e,t,r)=>{"use strict";r.d(t,{L:()=>o});var i=r(34981),n=r(87572),s=r(64839);function o(e,t){switch(t.output){case i.V.Shadow:case i.V.ShadowHighlight:case i.V.ShadowExcludeHighlight:case i.V.ViewshedShadow:e.fragment.include(n.U),e.fragment.code.add(s.H`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`)}}},48020:(e,t,r)=>{"use strict";r.d(t,{Qh:()=>l,U:()=>o,bO:()=>a});var i=r(55855),n=r(64839),s=r(70367);const o=(0,i.fA)(1,1,0,1),a=(0,i.fA)(1,0,1,1);function l(e){e.fragment.uniforms.add(new s.N("depthTexture",((e,t)=>t.mainDepth))),e.fragment.constants.add("occludedHighlightFlag","vec4",o).add("unoccludedHighlightFlag","vec4",a),e.fragment.code.add(n.H`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}},65058:(e,t,r)=>{"use strict";r.d(t,{D:()=>l,E:()=>c});var i=r(19555),n=r(72745),s=r(81449),o=r(95756),a=r(64839);function l(e){e.include(s.W),e.code.add(a.H`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
return linearDepthFromRGBA(texelFetch(depthTexture, iuv, 0), nearFar);
}`)}function c(e){e.uniforms.add(new o.G("zProjectionMap",((e,t)=>function(e){const t=e.projectionMatrix;return(0,i.hZ)(u,t[14],t[10])}(t.camera)))),e.code.add(a.H`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),e.code.add(a.H`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),e.code.add(a.H`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}const u=(0,n.vt)()},91156:(e,t,r)=>{"use strict";r.d(t,{M:()=>o});var i=r(21390),n=r(64839),s=r(70367);function o(e){e.fragment.uniforms.add(new s.N("u_colormap",(e=>e.u_colormap)),new i.m("u_colormapOffset",(e=>e.colormap.u_colormapOffset)),new i.m("u_colormapMaxIndex",(e=>e.colormap.u_colormapMaxIndex)),new i.m("u_opacity",(e=>e.common.u_opacity))),e.fragment.code.add(n.H`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}},67199:(e,t,r)=>{"use strict";r.d(t,{y:()=>u,p:()=>c});var i=r(95756),n=r(64839),s=r(70367);function o(e){e.fragment.uniforms.add(new s.N("u_transformGrid",(e=>e.u_transformGrid)),new i.G("u_transformSpacing",(e=>e.common.u_transformSpacing)),new i.G("u_targetImageSize",(e=>e.common.u_targetImageSize))),e.fragment.code.add(n.H`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}var a=r(25252),l=r(53736);class c extends a.J{constructor(e,t,r){super(),this.common=e,this.u_image=t,this.u_transformGrid=r}}function u(e,t){e.include(o),e.fragment.uniforms.add(new s.N("u_image",(e=>e.u_image)),new l.e("u_flipY",(e=>e.common.u_flipY)),new l.e("u_applyTransform",(e=>e.common.u_applyTransform)));const{requireBilinearWithNN:r}=t;r&&e.fragment.uniforms.add(new i.G("u_srcImageSize",(e=>e.common.u_srcImageSize))),e.fragment.code.add(n.H`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),r?e.fragment.code.add(n.H`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):e.fragment.code.add(n.H`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}},90011:(e,t,r)=>{"use strict";r.d(t,{o:()=>l});var i=r(54478),n=r(77904),s=r(20123),o=r(19771),a=r(64839);function l(e,t){e.include(i.c,t),e.fragment.include(n.N);const r=e.fragment;r.uniforms.add(new s.V("baseColor",(e=>e.baseColor))),r.uniforms.add(new o.J("objectOpacity",(e=>e.objectOpacity))),t.hasVertexColors?r.code.add(a.H`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(a.H`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(a.H`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}},72937:(e,t,r)=>{"use strict";r.d(t,{W:()=>m});var i=r(44680),n=r(72745),s=r(97808),o=r(11105),a=r(27920),l=r(95756),c=r(64839),u=r(72106),h=r(27374),d=r(70367),p=r(24245),f=r(66470);function m(e,t){const r=e.fragment;t.hasVertexTangents?(e.attributes.add(f.r.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===a.W.WindingOrder?r.code.add(c.H`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(c.H`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(c.H`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),t.textureCoordinateType!==s.q.None&&(e.include(o.r,t),r.uniforms.add(t.pbrTextureBindType===p.c.Pass?new d.N("normalTexture",(e=>e.textureNormal)):new h.o("normalTexture",(e=>e.textureNormal))),t.hasNormalTextureTransform&&(r.uniforms.add(new l.G("scale",(e=>e.scale??n.Un))),r.uniforms.add(new u.k("normalTextureTransformMatrix",(e=>e.normalTextureTransformMatrix??i.zK)))),r.code.add(c.H`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),t.hasNormalTextureTransform&&r.code.add(c.H`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),r.code.add(c.H`return tangentSpace * rawNormal;
}`))}},21372:(e,t,r)=>{"use strict";r.d(t,{f:()=>c});var i=r(4212),n=r(59046),s=r(55386),o=r(36358),a=r(27920),l=r(64839);function c(e,t){const r=e.fragment;switch(t.doubleSidedMode){case a.W.None:r.code.add(l.H`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case a.W.View:e.include(o.em,t),r.code.add(l.H`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case a.W.WindingOrder:r.code.add(l.H`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:(0,i.Xb)(t.doubleSidedMode);case a.W.COUNT:}switch(t.normalType){case n.W.Attribute:case n.W.Compressed:e.include(s.Mh,t),r.code.add(l.H`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case n.W.ScreenDerivative:e.include(o.em,t),r.code.add(l.H`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case n.W.Ground:t.spherical?(e.include(o.em,t),r.code.add(l.H`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(l.H`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),r.code.add(l.H`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:(0,i.Xb)(t.normalType);case n.W.COUNT:}}},50819:(e,t,r)=>{"use strict";r.d(t,{W:()=>h});var i=r(20664),n=r(9392),s=r(43047),o=r(55855),a=r(26719),l=r(5517),c=r(58350),u=r(64839);function h(e,t){const r=e.fragment,n=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===n?(r.uniforms.add(new l.t("lightingAmbientSH0",((e,t)=>(0,i.s)(d,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0])))),r.code.add(u.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===n?(r.uniforms.add(new c.E("lightingAmbientSH_R",((e,t)=>(0,s.s)(p,t.lighting.sh.r[0],t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3]))),new c.E("lightingAmbientSH_G",((e,t)=>(0,s.s)(p,t.lighting.sh.g[0],t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3]))),new c.E("lightingAmbientSH_B",((e,t)=>(0,s.s)(p,t.lighting.sh.b[0],t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3])))),r.code.add(u.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===n&&(r.uniforms.add(new l.t("lightingAmbientSH0",((e,t)=>(0,i.s)(d,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0]))),new c.E("lightingAmbientSH_R1",((e,t)=>(0,s.s)(p,t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3],t.lighting.sh.r[4]))),new c.E("lightingAmbientSH_G1",((e,t)=>(0,s.s)(p,t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3],t.lighting.sh.g[4]))),new c.E("lightingAmbientSH_B1",((e,t)=>(0,s.s)(p,t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3],t.lighting.sh.b[4]))),new c.E("lightingAmbientSH_R2",((e,t)=>(0,s.s)(p,t.lighting.sh.r[5],t.lighting.sh.r[6],t.lighting.sh.r[7],t.lighting.sh.r[8]))),new c.E("lightingAmbientSH_G2",((e,t)=>(0,s.s)(p,t.lighting.sh.g[5],t.lighting.sh.g[6],t.lighting.sh.g[7],t.lighting.sh.g[8]))),new c.E("lightingAmbientSH_B2",((e,t)=>(0,s.s)(p,t.lighting.sh.b[5],t.lighting.sh.b[6],t.lighting.sh.b[7],t.lighting.sh.b[8])))),r.code.add(u.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==a.A9.Normal&&t.pbrMode!==a.A9.Schematic||r.code.add(u.H`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const d=(0,n.vt)(),p=(0,o.vt)()},78264:(e,t,r)=>{"use strict";r.d(t,{n:()=>o});var i=r(64839),n=r(70367),s=r(37958);function o(e,t){const r=e.fragment;t.receiveAmbientOcclusion?(r.uniforms.add(new n.N("ssaoTex",((e,t)=>t.ssao?.getTexture()))),r.constants.add("blurSizePixelsInverse","float",1/s.s),r.code.add(i.H`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(i.H`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}},67799:(e,t,r)=>{"use strict";r.d(t,{a8:()=>f,eU:()=>m,kA:()=>g});var i=r(4212),n=r(50819),s=r(78264),o=r(43557),a=r(42953),l=r(26719),c=r(36324),u=r(53736),h=r(21390),d=r(64839),p=r(4998);function f(e){e.constants.add("ambientBoostFactor","float",p.uH)}function m(e){e.uniforms.add(new h.m("lightingGlobalFactor",((e,t)=>t.lighting.globalFactor)))}function g(e,t){const r=e.fragment;switch(e.include(s.n,t),t.pbrMode!==l.A9.Disabled&&e.include(a.c,t),e.include(n.W,t),e.include(c.p),r.code.add(d.H`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===l.A9.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),f(r),m(r),(0,o.Gc)(r),r.code.add(d.H`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?d.H`normalize(vPosWorld)`:d.H`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),(0,o.O4)(r),r.code.add(d.H`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),t.pbrMode){case l.A9.Disabled:case l.A9.WaterOnIntegratedMesh:case l.A9.Water:e.include(o.qU),r.code.add(d.H`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case l.A9.Normal:case l.A9.Schematic:r.code.add(d.H`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(d.H`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?r.uniforms.add(new u.e("hasFillLights",((e,t)=>t.enableFillLights))):r.constants.add("hasFillLights","bool",!1),r.code.add(d.H`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new h.m("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new h.m("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))),r.code.add(d.H`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(d.H`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode!==l.A9.Schematic||t.hasColorTexture?d.H`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:d.H`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case l.A9.Simplified:case l.A9.TerrainWithWater:e.include(o.qU),r.code.add(d.H`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:(0,i.Xb)(t.pbrMode);case l.A9.COUNT:}}},32925:(e,t,r)=>{"use strict";r.d(t,{v:()=>s,z:()=>n});var i=r(64839);function n(e){e.fragment.code.add(i.H`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function s(e){e.fragment.code.add(i.H`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},94759:(e,t,r)=>{"use strict";r.d(t,{C:()=>n});var i=r(64839);function n(e){e.fragment.code.add(i.H`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}},2443:(e,t,r)=>{"use strict";r.d(t,{q:()=>f,h:()=>m});var i=r(81449),n=r(3799),s=r(58350),o=r(21390),a=r(64839),l=r(70367),c=r(95901),u=r(43047),h=r(55855);function d(e){return null==e?h.uY:4===e.length?e:(0,u.s)(p,e[0],e[1],e[2],1)}const p=(0,h.vt)();function f(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){const r=!(t.draped&&t.stipplePreferContinuous),{vertex:u,fragment:h}=e;h.include(i.W),t.draped||((0,n.yu)(u,t),u.uniforms.add(new o.m("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),u.code.add(a.H`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),e.varyings.add("vStippleDistanceLimits","vec2"),e.varyings.add("vStipplePatternStretch","float"),u.code.add(a.H`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${g};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),u.code.add(a.H`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),u.code.add(a.H`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),(0,n.Nz)(u),u.code.add(a.H`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),h.uniforms.add(new l.N("stipplePatternTexture",(e=>e.stippleTexture)),new o.m("stipplePatternSDFNormalizer",(e=>function(e){return e?(Math.floor(.5*((0,c.GV)(e)-1))+.5)/e.pixelRatio:1}(e.stipplePattern))),new o.m("stipplePatternPixelSizeInv",(e=>1/m(e)))),h.code.add(a.H`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),t.stippleOffColorEnabled?(h.uniforms.add(new s.E("stippleOffColor",(e=>d(e.stippleOffColor)))),h.code.add(a.H`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):h.code.add(a.H`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}(e,t):function(e){e.fragment.code.add(a.H`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}(e)}function m(e){const t=e.stipplePattern;return t?(0,c.GQ)(e.stipplePattern)/t.pixelRatio:1}const g=a.H.float(.4)},43557:(e,t,r)=>{"use strict";r.d(t,{Gc:()=>s,O4:()=>o,qU:()=>a});var i=r(5517),n=r(64839);function s(e){e.uniforms.add(new i.t("mainLightDirection",((e,t)=>t.lighting.mainLight.direction)))}function o(e){e.uniforms.add(new i.t("mainLightIntensity",((e,t)=>t.lighting.mainLight.intensity)))}function a(e){s(e.fragment),o(e.fragment),e.fragment.code.add(n.H`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}},17698:(e,t,r)=>{"use strict";r.d(t,{r:()=>l});var i=r(99443),n=r(3799),s=r(21390),o=r(64839),a=r(50125);function l(e,t){const{vertex:r,constants:l}=e;l.add("markerSizePerLineWidth","float",i.PV),(0,n.Nz)(r),null==r.uniforms.get("markerScale")&&r.constants.add("markerScale","float",1),r.code.add(o.H`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),t.space===a.lM.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new s.m("perRenderPixelRatio",((e,t)=>t.camera.perRenderPixelRatio))),r.code.add(o.H`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}},10708:(e,t,r)=>{"use strict";r.d(t,{H:()=>o,U:()=>a});var i=r(65058),n=r(64839),s=r(70367);function o(e){e.include(i.E),e.uniforms.add(new s.N("geometryDepthTexture",((e,t)=>t.multipassGeometry.depth?.attachment))),e.code.add(n.H`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}class a{}},81993:(e,t,r)=>{"use strict";r.d(t,{Q:()=>o,h:()=>a});var i=r(65058),n=r(64839),s=r(70367);function o(e,t){if(!t.multipassEnabled)return;e.fragment.include(i.E),e.fragment.uniforms.add(new s.N("terrainDepthTexture",((e,t)=>t.multipassTerrain.depth?.attachment)));const r=t.occlusionPass;e.fragment.code.add(n.H`
   ${r?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${r?n.H`return fragmentDepth < linearDepth && depth < 1.0;`:n.H`
          if(fragmentDepth ${t.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}class a{constructor(){this.cullAboveGround=!1}}},2260:(e,t,r)=>{"use strict";r.d(t,{n:()=>n});var i=r(64839);function n(e,t){t.spherical?e.vertex.code.add(i.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(i.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(i.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(i.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},27920:(e,t,r)=>{"use strict";r.d(t,{W:()=>i,r:()=>o});var i,n=r(4212),s=r(64839);function o(e,t){const r=e.fragment;switch(r.code.add(s.H`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case i.None:r.code.add(s.H`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case i.View:r.code.add(s.H`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case i.WindingOrder:r.code.add(s.H`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:(0,n.Xb)(t.doubleSidedMode);case i.COUNT:}}!function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"}(i||(i={}))},42953:(e,t,r)=>{"use strict";r.d(t,{c:()=>a,f:()=>l});var i=r(64839);function n(e){const t=e.fragment.code;t.add(i.H`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(i.H`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(i.H`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var s=r(26719),o=r(36324);function a(e,t){const r=e.fragment.code;e.include(o.p),t.pbrMode!==s.A9.Normal&&t.pbrMode!==s.A9.Schematic&&t.pbrMode!==s.A9.Simplified&&t.pbrMode!==s.A9.TerrainWithWater||(r.add(i.H`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(i.H`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),t.pbrMode!==s.A9.Normal&&t.pbrMode!==s.A9.Schematic||(e.include(n),r.add(i.H`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(i.H`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(i.H`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(i.H`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function l(e,t){const r=e.fragment.code;e.include(o.p),r.add(i.H`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(i.H`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(i.H`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(i.H`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(i.H`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}},26719:(e,t,r)=>{"use strict";r.d(t,{A9:()=>i,_Z:()=>h});var i,n=r(11105),s=r(72468),o=r(5517),a=r(64839),l=r(27374),c=r(70367),u=r(24245);r(75803);!function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.Simplified=5]="Simplified",e[e.TerrainWithWater=6]="TerrainWithWater",e[e.COUNT=7]="COUNT"}(i||(i={}));function h(e,t){const r=e.fragment,h=t.hasMetallicRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===i.Normal&&h&&e.include(n.r,t),t.pbrMode!==i.Schematic)if(t.pbrMode!==i.Disabled){if(t.pbrMode===i.Normal){r.code.add(a.H`vec3 mrr;
vec3 emission;
float occlusion;`);const e=t.pbrTextureBindType;t.hasMetallicRoughnessTexture&&(r.uniforms.add(e===u.c.Pass?new c.N("texMetallicRoughness",(e=>e.textureMetallicRoughness)):new l.o("texMetallicRoughness",(e=>e.textureMetallicRoughness))),r.code.add(a.H`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(r.uniforms.add(e===u.c.Pass?new c.N("texEmission",(e=>e.textureEmissive)):new l.o("texEmission",(e=>e.textureEmissive))),r.code.add(a.H`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),t.hasOcclusionTexture?(r.uniforms.add(e===u.c.Pass?new c.N("texOcclusion",(e=>e.textureOcclusion)):new l.o("texOcclusion",(e=>e.textureOcclusion))),r.code.add(a.H`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(a.H`float getBakedOcclusion() { return 1.0; }`),e===u.c.Pass?r.uniforms.add(new o.t("emissionFactor",(e=>e.emissiveFactor)),new o.t("mrrFactors",(e=>e.mrrFactors))):r.uniforms.add(new s.W("emissionFactor",(e=>e.emissiveFactor)),new s.W("mrrFactors",(e=>e.mrrFactors))),r.code.add(a.H`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${t.hasMetallicRoughnessTexture?a.H`applyMetallnessAndRoughness(${t.hasMetallicRoughnessTextureTransform?a.H`metallicRoughnessUV`:"vuv0"});`:""}

      ${t.hasEmissionTexture?a.H`applyEmission(${t.hasEmissiveTextureTransform?a.H`emissiveUV`:"vuv0"});`:""}

      ${t.hasOcclusionTexture?a.H`applyOcclusion(${t.hasOcclusionTextureTransform?a.H`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else r.code.add(a.H`float getBakedOcclusion() { return 1.0; }`);else r.code.add(a.H`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}},36324:(e,t,r)=>{"use strict";r.d(t,{p:()=>n});var i=r(64839);function n(e){e.vertex.code.add(i.H`const float PI = 3.141592653589793;`),e.fragment.code.add(i.H`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}},47331:(e,t,r)=>{"use strict";r.d(t,{E:()=>u});var i=r(34981),n=r(97808),s=r(11105),o=r(23976),a=r(64839),l=r(27374),c=r(83490);function u(e,t){const r=e.fragment;if(!t.hasColorTexture||t.output!==i.V.Color&&t.alphaDiscardMode===c.sf.Opaque)r.code.add(a.H`vec4 readBaseColorTexture() { return vec4(1.0); }`);else{e.include(s.r,t);const i=t.textureCoordinateType===n.q.Atlas;r.uniforms.add(new l.o("baseColorTexture",(e=>e.texture))),i?(e.include(o.r),r.code.add(a.H`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):r.code.add(a.H`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}}},86279:(e,t,r)=>{"use strict";r.d(t,{Bz:()=>y,G:()=>g,QR:()=>m});var i=r(13191),n=r(9392),s=r(87572),o=r(58350),a=r(72790),l=r(64839),c=r(7223),u=r(24245);class h extends c.n{constructor(e,t,r){super(e,"mat4",u.c.Draw,((r,i,n,s)=>r.setUniformMatrix4fv(e,t(i,n,s))),r)}}var d=r(44640),p=r(70367);l.Y;class f extends l.Y{constructor(){super(...arguments),this.modelTransformation=i.zK}}class m extends f{constructor(){super(...arguments),this.origin=(0,n.vt)()}}function g(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new d.m("shadowMapMatrix",((e,t)=>t.shadowMap.getShadowMapMatrices(e.origin)),4)),_(e))}function y(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new h("shadowMapMatrix",((e,t)=>t.shadowMap.getShadowMapMatrices(e.origin)),4)),_(e))}function _(e){const t=e.fragment;t.include(s.U),t.uniforms.add(new p.N("shadowMap",((e,t)=>t.shadowMap.depthTexture)),new a.c("numCascades",((e,t)=>t.shadowMap.numCascades)),new o.E("cascadeDistances",((e,t)=>t.shadowMap.cascadeDistances))),t.code.add(l.H`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}},48353:(e,t,r)=>{"use strict";r.d(t,{O:()=>i,b:()=>n});const i=3e5,n=5e5},55696:(e,t,r)=>{"use strict";r.d(t,{MU:()=>c,O1:()=>u,QM:()=>h,Sx:()=>l,q2:()=>a});var i=r(44680),n=r(97808),s=r(64839),o=r(72106);function a(e,t){t.hasColorTextureTransform?(e.vertex.uniforms.add(new o.k("colorTextureTransformMatrix",(e=>e.colorTextureTransformMatrix??i.zK))),e.varyings.add("colorUV","vec2"),e.vertex.code.add(s.H`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardColorUV(){}`)}function l(e,t){t.hasNormalTextureTransform&&t.textureCoordinateType!==n.q.None?(e.vertex.uniforms.add(new o.k("normalTextureTransformMatrix",(e=>e.normalTextureTransformMatrix??i.zK))),e.varyings.add("normalUV","vec2"),e.vertex.code.add(s.H`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardNormalUV(){}`)}function c(e,t){t.hasEmissionTextureTransform&&t.textureCoordinateType!==n.q.None?(e.vertex.uniforms.add(new o.k("emissiveTextureTransformMatrix",(e=>e.emissiveTextureTransformMatrix??i.zK))),e.varyings.add("emissiveUV","vec2"),e.vertex.code.add(s.H`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardEmissiveUV(){}`)}function u(e,t){t.hasOcclusionTextureTransform&&t.textureCoordinateType!==n.q.None?(e.vertex.uniforms.add(new o.k("occlusionTextureTransformMatrix",(e=>e.occlusionTextureTransformMatrix??i.zK))),e.varyings.add("occlusionUV","vec2"),e.vertex.code.add(s.H`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardOcclusionUV(){}`)}function h(e,t){t.hasMetallicRoughnessTextureTransform&&t.textureCoordinateType!==n.q.None?(e.vertex.uniforms.add(new o.k("metallicRoughnessTextureTransformMatrix",(e=>e.metallicRoughnessTextureTransformMatrix??i.zK))),e.varyings.add("metallicRoughnessUV","vec2"),e.vertex.code.add(s.H`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardMetallicRoughnessUV(){}`)}},66763:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var i=r(5517),n=r(66701),s=r(60205),o=r(64839),a=r(72106),l=r(66470),c=r(93684);function u(e,t){const{vertex:r,attributes:u}=e;t.hasVvInstancing&&(t.vvSize||t.vvColor)&&u.add(l.r.INSTANCEFEATUREATTRIBUTE,"vec4"),t.vvSize?(r.uniforms.add(new i.t("vvSizeMinSize",(e=>e.vvSize.minSize))),r.uniforms.add(new i.t("vvSizeMaxSize",(e=>e.vvSize.maxSize))),r.uniforms.add(new i.t("vvSizeOffset",(e=>e.vvSize.offset))),r.uniforms.add(new i.t("vvSizeFactor",(e=>e.vvSize.factor))),r.uniforms.add(new a.k("vvSymbolRotationMatrix",(e=>e.vvSymbolRotationMatrix))),r.uniforms.add(new i.t("vvSymbolAnchor",(e=>e.vvSymbolAnchor))),r.code.add(o.H`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(o.H`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?o.H`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(o.H`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(r.constants.add("vvColorNumber","int",c.p),r.uniforms.add(new s.x("vvColorValues",(e=>e.vvColor.values),c.p),new n.F("vvColorColors",(e=>e.vvColor.colors),c.p)),r.code.add(o.H`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${t.hasVvInstancing?o.H`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(o.H`vec4 vvColor() { return vec4(1.0); }`)}},59640:(e,t,r)=>{"use strict";r.d(t,{E:()=>m});var i=r(32925),n=r(94759),s=r(42953),o=r(48353),a=r(65058),l=r(95756),c=r(21390),u=r(64839),h=r(43425),d=r(70367);function p(e,t){const r=e.fragment;r.include(a.E),r.uniforms.add(new l.G("nearFar",((e,t)=>t.camera.nearFar))),r.uniforms.add(new d.N("depthMap",((e,t)=>t.depth?.attachment))),r.uniforms.add(new h.X("proj",((e,t)=>t.camera.projectionMatrix))),r.uniforms.add(new c.m("invResolutionHeight",((e,t)=>1/t.camera.height))),r.uniforms.add(new h.X("reprojectionMatrix",((e,t)=>t.ssr.reprojectionMatrix))),r.code.add(u.H`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}var f=r(24475);function m(e,t){e.include(s.f,t),e.include(n.C),e.include(i.v),t.hasCloudsReflections&&e.include(f.g,t),t.hasScreenSpaceReflections&&e.include(p,t);const r=e.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",o.O).add("ssrHeightFadeEnd","float",o.b).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(u.H`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new c.m("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new c.m("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))),r.code.add(u.H`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&r.code.add(u.H`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?(r.uniforms.add(new h.X("view",((e,t)=>t.camera.viewMatrix)),new d.N("lastFrameColorTexture",((e,t)=>t.ssr.lastFrameColor?.getTexture())),new c.m("fadeFactorSSR",((e,t)=>t.ssr.fadeFactor))),r.code.add(u.H`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(u.H`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?r.code.add(u.H`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(u.H`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(u.H`return waterRenderedColor;
}`)}},82884:(e,t,r)=>{"use strict";r.d(t,{V:()=>d});var i=r(19555),n=r(72745),s=r(43047),o=r(55855),a=r(32925),l=(r(86279),r(95756)),c=r(58350),u=r(64839),h=r(70367);function d(e){e.fragment.uniforms.add(new h.N("texWaveNormal",(e=>e.waveNormal)),new h.N("texWavePerturbation",(e=>e.wavePerturbation)),new c.E("waveParams",(e=>(0,s.s)(p,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset))),new l.G("waveDirection",(e=>(0,i.hZ)(f,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity)))),e.include(a.z),e.fragment.code.add(u.H`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const p=(0,o.vt)(),f=(0,n.vt)()},10909:(e,t,r)=>{"use strict";r.d(t,{z:()=>n});var i=r(64839);function n(e){e.code.add(i.H`
    float lineFactorAtPosition(float value) {
      float pos = value * ${i.H.float(257)};
      if(pos < 0.5 || pos > ${i.H.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}},72702:(e,t,r)=>{"use strict";var i;r.d(t,{Q:()=>i}),function(e){e[e.NotRequired=0]="NotRequired",e[e.Required=1]="Required",e[e.COUNT=2]="COUNT"}(i||(i={}))},4747:(e,t,r)=>{"use strict";var i;r.d(t,{x:()=>i}),function(e){e[e.Composite=0]="Composite",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.GroupBackgroundComposite=3]="GroupBackgroundComposite",e[e.COUNT=4]="COUNT"}(i||(i={}))},12057:(e,t,r)=>{"use strict";r.d(t,{Lg:()=>x,Tv:()=>_,eO:()=>v,w9:()=>i});var i,n=r(55855),s=r(2413),o=r(19539),a=r(29898),l=r(89712),c=r(34981),u=r(43557),h=r(26719),d=r(59640),p=r(20123),f=r(21390),m=r(64839),g=r(70367),y=r(7223);function _(e,t){const{vertex:r,fragment:i}=e;r.uniforms.add(new p.V("overlayTexOffset",((e,t)=>function(e,t){const r=t.overlay?.overlays[o.vr.INNER]?.extent;(0,s.pT)(r)&&(S[0]=e.toMapSpace[0]/(0,s.VL)(r)-r[0]/(0,s.VL)(r),S[1]=e.toMapSpace[1]/(0,s.uJ)(r)-r[1]/(0,s.uJ)(r));const i=t.overlay?.overlays[o.vr.OUTER]?.extent;return(0,s.pT)(i)&&(S[2]=e.toMapSpace[0]/(0,s.VL)(i)-i[0]/(0,s.VL)(i),S[3]=e.toMapSpace[1]/(0,s.uJ)(i)-i[1]/(0,s.uJ)(i)),S}(e,t))),new p.V("overlayTexScale",((e,t)=>function(e,t){const r=t.overlay?.overlays[o.vr.INNER]?.extent;(0,s.pT)(r)&&(S[0]=e.toMapSpace[2]/(0,s.VL)(r),S[1]=e.toMapSpace[3]/(0,s.uJ)(r));const i=t.overlay?.overlays[o.vr.OUTER]?.extent;return(0,s.pT)(i)&&(S[2]=e.toMapSpace[2]/(0,s.VL)(i),S[3]=e.toMapSpace[3]/(0,s.uJ)(i)),S}(e,t)))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new g.N("ovColorTex",((e,t)=>x(e,t)))),w(e,t)}function v(e,t){const{vertex:r,fragment:i}=e;r.uniforms.add(new b("overlayTexOffset"),new b("overlayTexScale")),i.uniforms.add(new f.m("overlayOpacity",(e=>e.overlayOpacity)),new g.N("ovColorTex",((e,t)=>t.overlay?.getTexture(e.overlayContent)))),w(e,t)}!function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"}(i||(i={}));class b extends y.n{constructor(e){super(e,"vec4")}}function w(e,t){t.pbrMode!==h.A9.Water&&t.pbrMode!==h.A9.WaterOnIntegratedMesh&&t.pbrMode!==h.A9.TerrainWithWater||e.include(d.E,t);const{vertex:r,fragment:i}=e;e.varyings.add("vtcOverlay","vec4"),r.code.add(m.H`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(m.H`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(m.H`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(m.H`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),t.pbrMode!==h.A9.Water&&t.pbrMode!==h.A9.WaterOnIntegratedMesh&&t.pbrMode!==h.A9.TerrainWithWater||((0,u.Gc)(i),(0,u.O4)(i),i.code.add(m.H`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function x(e,t){return e.identifier===l.zq.Material&&e.output===c.V.Color?t.overlay?.getTexture(a.A.ColorNoRasterImage):e.identifier===l.zq.Material&&e.output===c.V.ObjectAndLayerIdColor?t.overlay?.getTexture(a.A.ObjectAndLayerIdColor):e.identifier===l.zq.Highlight?t.overlay?.getTexture(a.A.Highlight):null}const S=(0,n.vt)()},65826:(e,t,r)=>{"use strict";var i;r.d(t,{g:()=>i}),function(e){e[e.Off=0]="Off",e[e.On=1]="On",e[e.COUNT=2]="COUNT"}(i||(i={}))},14209:(e,t,r)=>{"use strict";r.d(t,{BK:()=>c,Rq:()=>l});var i=r(86279),n=r(10909),s=r(38918),o=r(64839),a=r(7223);class l extends i.QR{constructor(){super(...arguments),this.overlayOpacity=1}}function c(e,t){const{vertex:r,fragment:i,varyings:a}=e;a.add("vtc","vec2"),r.uniforms.add(new d("texOffsetAndScale")),i.uniforms.add(new p("tex")),i.uniforms.add(new h("textureOpacities"));const l=t.textureFadingEnabled&&!t.renderOccluded;l&&(r.uniforms.add(new d("nextTexOffsetAndScale")),a.add("nvtc","vec2"),i.uniforms.add(new p("texNext")),i.uniforms.add(new h("nextTexOpacities")),i.uniforms.add(new u("fadeFactor")));const c=t.tileBlendInput===s.k.ColorComposite,f=t.tileBlendInput===s.k.GridComposite;f&&i.include(n.z),c&&i.uniforms.add(new h("backgroundColor")),r.code.add(o.H`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${l?o.H`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:o.H``}
  }`),i.code.add(o.H`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${f||c?o.H`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${c?o.H`backgroundColor`:o.H`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:o.H`return color;`}
    }`),l?i.code.add(o.H`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(o.H`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}class u extends a.n{constructor(e){super(e,"float")}}class h extends a.n{constructor(e){super(e,"vec3")}}class d extends a.n{constructor(e){super(e,"vec4")}}class p extends a.n{constructor(e){super(e,"sampler2D")}}},79360:(e,t,r)=>{"use strict";r.d(t,{P:()=>p});r(9392);var i=r(32124),n=r(10909),s=r(72702),o=r(4747),a=r(65826),l=r(64839);function c(e,t){const r=t.blendMode;r!==i.IU.Normal&&(r===i.IU.Reflect&&e.code.add(l.H`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==i.IU.ColorDodge&&r!==i.IU.VividLight||e.code.add(l.H`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==i.IU.ColorBurn&&r!==i.IU.VividLight||e.code.add(l.H`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===i.IU.Overlay&&e.code.add(l.H`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===i.IU.HardLight&&e.code.add(l.H`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===i.IU.SoftLight&&e.code.add(l.H`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===i.IU.VividLight&&e.code.add(l.H`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==i.IU.Hue&&r!==i.IU.Saturation&&r!==i.IU.Color&&r!==i.IU.Luminosity||(e.code.add(l.H`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==i.IU.Hue&&r!==i.IU.Saturation||e.code.add(l.H`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),e.code.add(l.H`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===i.IU.Multiply?l.H`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.Average?l.H`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.Lighten?l.H`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.Darken?l.H`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.Lighter?l.H`return vec4(cl * ol + cb * ob, ol + ob);`:r===i.IU.Plus?l.H`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===i.IU.Minus?l.H`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===i.IU.Screen?l.H`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.Difference?l.H`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.Invert?l.H`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===i.IU.DestinationOver?l.H`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===i.IU.DestinationAtop?l.H`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===i.IU.DestinationOut?l.H`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===i.IU.SourceAtop?l.H`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===i.IU.SourceOut?l.H`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===i.IU.Xor?l.H`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===i.IU.DestinationIn?l.H`return vec4(cb * ob * ol, ol * ob);`:r===i.IU.SourceIn?l.H`return vec4(cl * ol * ob, ol * ob);`:r===i.IU.Hue?l.H`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.Saturation?l.H`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.Color?l.H`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.Luminosity?l.H`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.Exclusion?l.H`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.Reflect?l.H`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.ColorDodge?l.H`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.ColorBurn?l.H`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.Overlay?l.H`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.SoftLight?l.H`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.HardLight?l.H`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===i.IU.VividLight?l.H`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l.H``}
    }
  `))}var u=r(5517),h=r(21390),d=r(70367);l.Y;function p(e,t){const r=t.output===o.x.GridComposite,p=t.output===o.x.ColorComposite,f=t.output===o.x.GroupBackgroundComposite,m=t.output===o.x.Composite,g=t.baseOpacityMode===s.Q.Required,y=e.fragment;g&&y.uniforms.add(new h.m("baseOpacity",(e=>e.baseOpacity))),r?y.include(n.z):p?y.uniforms.add(new u.t("backgroundColor",(e=>e.backgroundColor))):m&&y.uniforms.add(new d.N("fboColor",(e=>e.fboTexture)));const _=t.blendMode!==i.IU.Normal,v=t.premultipliedSource===a.g.On,b=!_&&!v&&(m&&!g||f);y.include(c,t),y.code.add(l.H`
    vec4 getBackground(vec2 uv) {
      return ${g?l.H`baseOpacity *`:""} ${f?l.H`vec4(0.0, 0.0, 0.0, 0.0)`:p?l.H`vec4(backgroundColor, 1.0)`:r?l.H`vec4(gridColor(uv), 1.0)`:l.H`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec2 bgUV, vec4 colorLayer, float opacity) {
      ${_?l.H`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec4 bgColor = getBackground(bgUV);
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:l.H`
          float composeAlpha = colorLayer.a * opacity;
          ${b?l.H`return colorLayer * opacity;`:l.H`
            vec4 bgColor = getBackground(bgUV);
            return bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}},38918:(e,t,r)=>{"use strict";var i;r.d(t,{k:()=>i}),function(e){e[e.LayerOnly=0]="LayerOnly",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.COUNT=3]="COUNT"}(i||(i={}))},25252:(e,t,r)=>{"use strict";r.d(t,{J:()=>l,W:()=>c});var i=r(72745),n=r(95756),s=r(21390),o=r(64839),a=r(66470);class l extends o.Y{constructor(){super(...arguments),this.scale=1,this.offset=i.uY}}function c(e){e.attributes.add(a.r.POSITION,"vec2"),e.attributes.add(a.r.UV0,"vec2"),e.varyings.add("uv","vec2"),e.varyings.add("vuv","vec2"),e.vertex.uniforms.add(new s.m("scale",(e=>e.scale)),new n.G("offset",(e=>e.offset))).code.add(o.H`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}},90235:(e,t,r)=>{"use strict";r.d(t,{H:()=>i,y:()=>n});const i=.1,n=.001},55806:(e,t,r)=>{"use strict";r.d(t,{H:()=>c,S:()=>l});var i=r(54355),n=r(19771),s=r(21390),o=r(64839),a=r(83490);function l(e,t){u(e,t,new s.m("textureAlphaCutoff",(e=>e.textureAlphaCutoff)))}function c(e,t){u(e,t,new n.J("textureAlphaCutoff",(e=>e.textureAlphaCutoff)))}function u(e,t,r){const n=e.fragment;switch(t.alphaDiscardMode!==a.sf.Mask&&t.alphaDiscardMode!==a.sf.MaskBlend||n.uniforms.add(r),t.alphaDiscardMode){case a.sf.Blend:return e.include(i.g);case a.sf.Opaque:n.code.add(o.H`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case a.sf.Mask:n.code.add(o.H`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case a.sf.MaskBlend:e.fragment.code.add(o.H`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}},27963:(e,t,r)=>{"use strict";r.d(t,{Ir:()=>u});var i=r(19555),n=r(72745),s=r(43047),o=r(55855),a=r(95756),l=r(58350),c=r(64839);function u(e){e.fragment.uniforms.add(new l.E("projInfo",((e,t)=>function(e){const t=e.projectionMatrix;return 0===t[11]?(0,s.s)(h,2/(e.fullWidth*t[0]),2/(e.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):(0,s.s)(h,-2/(e.fullWidth*t[0]),-2/(e.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}(t.camera)))),e.fragment.uniforms.add(new a.G("zScale",((e,t)=>function(e){return 0===e.projectionMatrix[11]?(0,i.hZ)(d,0,1):(0,i.hZ)(d,1,0)}(t.camera)))),e.fragment.code.add(c.H`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}const h=(0,o.vt)();const d=(0,n.vt)()},24475:(e,t,r)=>{"use strict";r.d(t,{g:()=>y});var i=r(15941),n=r(14556),s=r(49753),o=r(63401),a=r(89038),l=r(43557),c=r(53736),u=r(5517),h=r(21390),d=r(64839),p=r(43425),f=r(7223),m=r(24245);class g extends f.n{constructor(e,t){super(e,"samplerCube",m.c.Pass,((r,i,n)=>r.bindTexture(e,t(i,n))))}}function y(e){const t=e.fragment;t.uniforms.add(new p.X("rotationMatrixClouds",((e,t)=>t.cloudsFade.parallax.transform)),new p.X("rotationMatrixCloudsCrossFade",((e,t)=>t.cloudsFade.parallaxNew.transform)),new u.t("anchorPosition",((e,t)=>t.cloudsFade.parallax.anchorPointClouds)),new u.t("anchorPositionCrossFade",((e,t)=>t.cloudsFade.parallaxNew.anchorPointClouds)),new h.m("cloudsHeight",(()=>a.k9)),new h.m("radiusCurvatureCorrectionFactor",((e,t)=>t.cloudsFade.parallax.radiusCurvatureCorrectionFactor)),new h.m("totalFadeInOut",((e,t)=>1-t.cloudsFade.opacity)),new h.m("crossFadeAnchorFactor",((e,t)=>(0,i.qE)(t.cloudsFade.fadeFactor,0,1))),new g("cubeMap",((e,t)=>t.cloudsFade.data?.cubeMap?.colorTexture??null)),new c.e("crossFade",((e,t)=>t.cloudsFade.fadeMode===o.OQ.CROSS_FADE)),new c.e("readChannelsRG",((e,t)=>t.cloudsFade.readChannels===s.c.RG)),new c.e("fadeTextureChannels",((e,t)=>t.cloudsFade.renderingStage===s.c2.FADING))),t.constants.add("planetRadius","float",n.$O.radius),t.code.add(d.H`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(d.H`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(d.H`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),(0,l.Gc)(t),(0,l.O4)(t),t.code.add(d.H`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(d.H`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),t.code.add(d.H`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(d.H`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(d.H`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}},80883:(e,t,r)=>{"use strict";r.d(t,{a:()=>n});var i=r(64839);function n(e){e.code.add(i.H`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},54355:(e,t,r)=>{"use strict";r.d(t,{g:()=>s});var i=r(90235),n=r(64839);function s(e){e.fragment.code.add(n.H`
    #define discardOrAdjustAlpha(color) { if (color.a < ${n.H.float(i.y)}) { discard; } }
  `)}},89299:(e,t,r)=>{"use strict";r.d(t,{u:()=>n});var i=r(64839);function n(e,t){let{code:r}=e;t.doublePrecisionRequiresObfuscation?r.add(i.H`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):r.add(i.H`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}},81148:(e,t,r)=>{"use strict";r.d(t,{T:()=>i,V:()=>s});var i,n=r(80963);function s(e){return e&&(0,n.q8)(e)?i.Mars:e&&(0,n.KQ)(e)?i.Moon:i.Earth}!function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"}(i||(i={}))},30041:(e,t,r)=>{"use strict";r.d(t,{$:()=>c,K:()=>u});var i=r(34761),n=r(13191),s=r(9392),o=r(27963),a=r(64839),l=r(43425);class c extends a.Y{constructor(){super(...arguments),this.localOrigin=(0,s.Ul)()}}function u(e){e.include(o.Ir),e.fragment.uniforms.add(new l.X("inverseViewMatrix",((e,t)=>{const r=(0,n.vt)();return(0,i.Tl)(r,t.camera.viewMatrix,e.localOrigin),(0,i.Qw)(r,r)}))),e.fragment.code.add(a.H`vec4 reconstructLocalPosition(vec2 coord, float linearDepth) {
vec4 cameraSpace = vec4(reconstructPosition(coord, linearDepth), 1.0);
return inverseViewMatrix * cameraSpace;
}`)}},77904:(e,t,r)=>{"use strict";r.d(t,{N:()=>o});var i=r(51990),n=r(80883),s=r(64839);function o(e){e.include(n.a),e.code.add(s.H`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${s.H.int(i.k5.Multiply)}) {
        return allMixed;
      }
      if (mode == ${s.H.int(i.k5.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${s.H.int(i.k5.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${s.H.int(i.k5.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${s.H.int(i.k5.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}},87572:(e,t,r)=>{"use strict";r.d(t,{U:()=>n});var i=r(64839);function n(e){e.code.add(i.H`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}},81449:(e,t,r)=>{"use strict";r.d(t,{W:()=>n});var i=r(64839);function n(e){e.code.add(i.H`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}},69817:(e,t,r)=>{"use strict";r.d(t,{OH:()=>c,Y6:()=>a,pM:()=>l});var i=r(20664),n=r(9392),s=r(5517),o=r(64839);function a(e){e.vertex.code.add(o.H`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(o.H`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),e.vertex.code.add(o.H`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(o.H`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(o.H`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(o.H`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function l(e){e.uniforms.add(new s.t("screenSizePerspective",(e=>u(e.screenSizePerspective))))}function c(e){e.uniforms.add(new s.t("screenSizePerspectiveAlignment",(e=>u(e.screenSizePerspectiveAlignment||e.screenSizePerspective))))}function u(e){return(0,i.s)(h,e.parameters.divisor,e.parameters.offset,e.minScaleFactor)}const h=(0,n.vt)()},23976:(e,t,r)=>{"use strict";r.d(t,{r:()=>n});var i=r(64839);function n(e){e.fragment.code.add(i.H`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}},3799:(e,t,r)=>{"use strict";r.d(t,{NB:()=>p,Nz:()=>y,S7:()=>g,yu:()=>d});var i=r(34761),n=r(13191),s=r(20664),o=r(9392),a=r(72468),l=r(5517),c=r(21390),u=r(12216),h=r(43425);function d(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",o.uY):e.uniforms.add(new a.W("cameraPosition",((e,t)=>(0,s.s)(m,t.camera.viewInverseTransposeMatrix[3]-e.origin[0],t.camera.viewInverseTransposeMatrix[7]-e.origin[1],t.camera.viewInverseTransposeMatrix[11]-e.origin[2]))))}function p(e,t){if(!t.instancedDoublePrecision)return void e.uniforms.add(new h.X("proj",((e,t)=>t.camera.projectionMatrix)),new u.S("view",((e,t)=>(0,i.Tl)(f,t.camera.viewMatrix,e.origin))),new a.W("localOrigin",(e=>e.origin)));const r=e=>(0,s.s)(m,e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]);e.uniforms.add(new h.X("proj",((e,t)=>t.camera.projectionMatrix)),new h.X("view",((e,t)=>(0,i.Tl)(f,t.camera.viewMatrix,r(t)))),new l.t("localOrigin",((e,t)=>r(t))))}const f=(0,n.vt)(),m=(0,o.vt)();function g(e){e.uniforms.add(new h.X("viewNormal",((e,t)=>t.camera.viewInverseTransposeMatrix)))}function y(e){e.uniforms.add(new c.m("pixelRatio",((e,t)=>t.camera.pixelRatio/t.overlayStretch)))}},53736:(e,t,r)=>{"use strict";r.d(t,{e:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"bool",n.c.Pass,((r,i,n)=>r.setUniform1b(e,t(i,n))))}}},56289:(e,t,r)=>{"use strict";r.d(t,{t:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"vec2",n.c.Draw,((r,i,n,s)=>r.setUniform2fv(e,t(i,n,s))))}}},95756:(e,t,r)=>{"use strict";r.d(t,{G:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"vec2",n.c.Pass,((r,i,n)=>r.setUniform2fv(e,t(i,n))))}}},72468:(e,t,r)=>{"use strict";r.d(t,{W:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"vec3",n.c.Draw,((r,i,n,s)=>r.setUniform3fv(e,t(i,n,s))))}}},5517:(e,t,r)=>{"use strict";r.d(t,{t:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"vec3",n.c.Pass,((r,i,n)=>r.setUniform3fv(e,t(i,n))))}}},20123:(e,t,r)=>{"use strict";r.d(t,{V:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"vec4",n.c.Draw,((r,i,n)=>r.setUniform4fv(e,t(i,n))))}}},58350:(e,t,r)=>{"use strict";r.d(t,{E:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"vec4",n.c.Pass,((r,i,n)=>r.setUniform4fv(e,t(i,n))))}}},66701:(e,t,r)=>{"use strict";r.d(t,{F:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t,r){super(e,"vec4",n.c.Pass,((r,i,n)=>r.setUniform4fv(e,t(i,n))),r)}}},19771:(e,t,r)=>{"use strict";r.d(t,{J:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"float",n.c.Draw,((r,i,n)=>r.setUniform1f(e,t(i,n))))}}},21390:(e,t,r)=>{"use strict";r.d(t,{m:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"float",n.c.Pass,((r,i,n)=>r.setUniform1f(e,t(i,n))))}}},60205:(e,t,r)=>{"use strict";r.d(t,{x:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t,r){super(e,"float",n.c.Pass,((r,i,n)=>r.setUniform1fv(e,t(i,n))),r)}}},72790:(e,t,r)=>{"use strict";r.d(t,{c:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"int",n.c.Pass,((r,i,n)=>r.setUniform1i(e,t(i,n))))}}},42759:(e,t,r)=>{"use strict";r.d(t,{h:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"mat3",n.c.Draw,((r,i,n)=>r.setUniformMatrix3fv(e,t(i,n))))}}},72106:(e,t,r)=>{"use strict";r.d(t,{k:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"mat3",n.c.Pass,((r,i,n)=>r.setUniformMatrix3fv(e,t(i,n))))}}},12216:(e,t,r)=>{"use strict";r.d(t,{S:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"mat4",n.c.Draw,((r,i,n)=>r.setUniformMatrix4fv(e,t(i,n))))}}},43425:(e,t,r)=>{"use strict";r.d(t,{X:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"mat4",n.c.Pass,((r,i,n)=>r.setUniformMatrix4fv(e,t(i,n))))}}},44640:(e,t,r)=>{"use strict";r.d(t,{m:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t,r){super(e,"mat4",n.c.Pass,((r,i,n)=>r.setUniformMatrix4fv(e,t(i,n))),r)}}},32307:(e,t,r)=>{"use strict";r.d(t,{N5:()=>l});var i=r(50076),n=(r(81806),r(76460)),s=r(24245),o=r(86994);class a{constructor(){this._includedModules=new Map}include(e,t){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,t),e(this.builder,t))}}class l extends a{constructor(){super(...arguments),this.vertex=new h,this.fragment=new h,this.attributes=new d,this.varyings=new p,this.extensions=new f,this.constants=new g,this.outputs=new m}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const t=this.extensions.generateSource(e),r=this.attributes.generateSource(e),i=this.varyings.generateSource(e),n="vertex"===e?this.vertex:this.fragment,s=n.uniforms.generateSource(),o=n.code.generateSource(),a="vertex"===e?_:y,l=this.constants.generateSource().concat(n.constants.generateSource()),c=this.outputs.generateSource(e);return`#version 300 es\n${t.join("\n")}\n\n${a}\n\n${l.join("\n")}\n\n${s.join("\n")}\n\n${r.join("\n")}\n\n${i.join("\n")}\n\n${c.join("\n")}\n\n${o.join("\n")}`}generateBindPass(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const r=e.bind[s.c.Pass];r&&t.set(e.name,r)})),this.fragment.uniforms.entries.forEach((e=>{const r=e.bind[s.c.Pass];r&&t.set(e.name,r)}));const r=Array.from(t.values()),i=r.length;return(t,n)=>{for(let s=0;s<i;++s)r[s](e,t,n)}}generateBindDraw(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const r=e.bind[s.c.Draw];r&&t.set(e.name,r)})),this.fragment.uniforms.entries.forEach((e=>{const r=e.bind[s.c.Draw];r&&t.set(e.name,r)}));const r=Array.from(t.values()),i=r.length;return(t,n,s)=>{for(let o=0;o<i;++o)r[o](e,t,n,s)}}}class c{constructor(e){this._stage=e,this._entries=new Map}add(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const i of t)this._add(i);return this._stage}get(e){return this._entries.get(e)}_add(e){if(null!=e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new i.A(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else n.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((e=>null!=e.arraySize?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`))}get entries(){return Array.from(this._entries.values())}}class u{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}}class h extends a{constructor(){super(...arguments),this.uniforms=new c(this),this.code=new u(this),this.constants=new g}get builder(){return this}}class d{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`in ${e[1]} ${e[0]};`))}}class p{constructor(){this._entries=new Map}add(e,t){this._entries.has(e)&&(0,o.vA)(this._entries.get(e)===t),this._entries.set(e,t)}generateSource(e){const t=new Array;return this._entries.forEach(((r,i)=>t.push("vertex"===e?`out ${r} ${i};`:`in ${r} ${i};`))),t}}class f{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?f.ALLOWLIST_VERTEX:f.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}f.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],f.ALLOWLIST_VERTEX=[];class m{constructor(){this._entries=new Map}add(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=this._entries.get(r);i?(0,o.vA)(i.name===e&&i.type===t,`Fragment shader output location ${r} occupied`):this._entries.set(r,{name:e,type:t})}generateSource(e){if("vertex"===e)return[];0===this._entries.size&&this._entries.set(0,{name:m.DEFAULT_NAME,type:m.DEFAULT_TYPE});const t=new Array;return this._entries.forEach(((e,r)=>t.push(`layout(location = ${r}) out ${e.type} ${e.name};`))),t}}m.DEFAULT_TYPE="vec4",m.DEFAULT_NAME="fragColor";class g{constructor(){this._entries=new Set}add(e,t,r){let i="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":i=g._numberToFloatStr(r);break;case"int":i=g._numberToIntStr(r);break;case"bool":i=r.toString();break;case"vec2":i=`vec2(${g._numberToFloatStr(r[0])},                            ${g._numberToFloatStr(r[1])})`;break;case"vec3":i=`vec3(${g._numberToFloatStr(r[0])},                            ${g._numberToFloatStr(r[1])},                            ${g._numberToFloatStr(r[2])})`;break;case"vec4":i=`vec4(${g._numberToFloatStr(r[0])},                            ${g._numberToFloatStr(r[1])},                            ${g._numberToFloatStr(r[2])},                            ${g._numberToFloatStr(r[3])})`;break;case"ivec2":i=`ivec2(${g._numberToIntStr(r[0])},                             ${g._numberToIntStr(r[1])})`;break;case"ivec3":i=`ivec3(${g._numberToIntStr(r[0])},                             ${g._numberToIntStr(r[1])},                             ${g._numberToIntStr(r[2])})`;break;case"ivec4":i=`ivec4(${g._numberToIntStr(r[0])},                             ${g._numberToIntStr(r[1])},                             ${g._numberToIntStr(r[2])},                             ${g._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${t}(${Array.prototype.map.call(r,(e=>g._numberToFloatStr(e))).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${i};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const y="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",_="precision highp float;\nprecision highp sampler2D;"},27374:(e,t,r)=>{"use strict";r.d(t,{o:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"sampler2D",n.c.Draw,((r,i,n)=>r.bindTexture(e,t(i,n))))}}},70367:(e,t,r)=>{"use strict";r.d(t,{N:()=>s});var i=r(7223),n=r(24245);class s extends i.n{constructor(e,t){super(e,"sampler2D",n.c.Pass,((r,i,n)=>r.bindTexture(e,t(i,n))))}}},7223:(e,t,r)=>{"use strict";r.d(t,{n:()=>n});var i=r(24245);class n{constructor(e,t,r,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(this.name=e,this.type=t,this.arraySize=s,this.bind={[i.c.Pass]:null,[i.c.Draw]:null},n)switch(r){case i.c.Pass:this.bind[i.c.Pass]=n;break;case i.c.Draw:this.bind[i.c.Draw]=n}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}}},64839:(e,t,r)=>{"use strict";r.d(t,{H:()=>n,Y:()=>i});const i=class{};function n(e){let t="";for(let r=0;r<(arguments.length<=1?0:arguments.length-1);r++)t+=e[r]+(r+1<1||arguments.length<=r+1?void 0:arguments[r+1]);return t+=e[e.length-1],t}!function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(n||(n={}))},24245:(e,t,r)=>{"use strict";var i;r.d(t,{c:()=>i}),function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"}(i||(i={}))},16506:(e,t,r)=>{"use strict";r.d(t,{$:()=>i});class i{constructor(e,t){this._module=e,this._loadModule=t}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}},42693:(e,t,r)=>{"use strict";r.d(t,{w:()=>s});var i=r(30726),n=r(93345);class s{constructor(e,t,r){this.release=r,this.initializeConfiguration(e,t),this._configuration=t.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}destroy(){this._program=(0,i.WD)(this._program),this._pipeline=this._configuration=null}reload(e){(0,i.WD)(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return n.WR.TRIANGLES}getPipeline(e,t,r){return this._pipeline}initializeConfiguration(e,t){}}},99415:(e,t,r)=>{"use strict";r.d(t,{K:()=>n,W:()=>s});var i=r(64839);class n extends i.Y{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map((()=>0)):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,t={key:this.key};for(const r of e)t[r]=this[r];return t}}function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t,r)=>{if(t._parameterNames=t._parameterNames??[],t._parameterNames.push(r),null!=e.constValue)Object.defineProperty(t,r,{get:()=>e.constValue});else{const i=t._parameterNames.length-1,n=e.count||2,s=Math.ceil(Math.log2(n)),o=t._parameterBits??[0];let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);t._parameterBits=o;const l=o[a],c=(1<<s)-1<<l;o[a]+=s,Object.defineProperty(t,r,{get(){return this[i]},set(e){if(this[i]!==e&&(this[i]=e,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+e<<l&c,"number"!=typeof e&&"boolean"!=typeof e))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof e)}})}}}},58229:(e,t,r)=>{"use strict";r.d(t,{I:()=>s});var i=r(75941),n=r(99415);class s{constructor(e){this._context=e,this._perConstructorInstances=new i.O,this._frameCounter=0,this._keepAliveFrameCount=a}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear()}acquire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;const r=t.key;let i=this._perConstructorInstances.get(e,r);if(null==i){const n=new e(this._context,t,(()=>this.release(n)));i=new o(n),this._perConstructorInstances.set(e,r,i)}return++i.refCount,i.technique}releaseAndAcquire(e,t,r){if(null!=r){if(t.key===r.key)return r;this.release(r)}return this.acquire(e,t)}release(e){if(null==e||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);null!=t&&(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==a&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,r)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,r))}))}))}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach(((t,r)=>{e.push((async(e,t)=>{const r=t.shader;r&&(await r.reload(),e.forEach((e=>e.technique.reload(this._context))))})(t,r))})),await Promise.all(e)}}class o{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}const a=-1,l=new n.K},77845:(e,t,r)=>{"use strict";r.d(t,{p:()=>o});var i=r(20664),n=r(83755),s=r(9392);class o{constructor(e){this._low=(0,s.vt)(),this._high=(0,s.vt)(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){(0,i.c)(this._low,(0,i.c)(a,e));const t=(0,i.z)(a,e,this._low);(0,i.c)(this._high,t)}get(e){return(0,i.g)(e,this._low,this._high)}getLowScaled(e){return(0,i.j)(e,this._low,1)}}const a=(0,n.vt)()},60586:(e,t,r)=>{"use strict";r.d(t,{B7:()=>o,Ot:()=>c,RW:()=>l,S:()=>h,qo:()=>s,ss:()=>p,tI:()=>u,zo:()=>d});var i=r(91967),n=r(34981);const s={required:[]},o={required:[n.V.Depth]};class a extends i.A{consumes(){return s}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(e){return!1}}class l extends a{}class c extends a{constructor(){super(...arguments),this.drapedPriority=0}}class u extends a{}class h extends a{}function d(e){return"prepareTechnique"in e}function p(e){return"prepareTechniques"in e}},37958:(e,t,r)=>{"use strict";r.d(t,{n:()=>N,s:()=>L});var i=r(35143),n=r(15941),s=r(30726),o=r(68134),a=r(91417),l=r(46053),c=(r(81806),r(76460),r(47249),r(85842)),u=r(19555),h=r(16455),d=r(36451),p=r(48353),f=r(16506),m=r(42693),g=r(32119),y=r(28584),_=r(29228),v=r(57162);class b extends m.w{initializeProgram(e){return new y.B(e.rctx,b.shader.get().build(),g.D)}initializePipeline(){return(0,v.Ey)({colorWrite:v.wE})}}b.shader=new f.$(_.S,(()=>r.e(1538).then(r.bind(r,91538))));var w=r(72745),x=r(64839);class S extends x.Y{constructor(){super(...arguments),this.projScale=1}}class T extends S{constructor(){super(...arguments),this.intensity=1}}class M extends x.Y{}class A extends M{constructor(){super(...arguments),this.blurSize=(0,w.vt)()}}var C=r(51331);class E extends m.w{initializeProgram(e){return new y.B(e.rctx,E.shader.get().build(),g.D)}initializePipeline(){return(0,v.Ey)({colorWrite:v.wE})}}E.shader=new f.$(C.S,(()=>r.e(3185).then(r.bind(r,43185))));var R=r(83490),P=r(93345),O=r(98433),I=r(96673);const L=2;let N=class extends d.A{constructor(e){super(e),this.consumes={required:["normals"]},this.produces="ssao",this.isEnabled=()=>!1,this._enableTime=(0,a.l5)(0),this._passParameters=new T,this._drawParameters=new A}initialize(){const e=Uint8Array.from(atob("eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM"),(e=>e.charCodeAt(0))),t=new I.R;t.wrapMode=P.pF.CLAMP_TO_EDGE,t.pixelFormat=P.Ab.RGB,t.wrapMode=P.pF.REPEAT,t.hasMipmap=!0,t.width=32,t.height=32,this._passParameters.noiseTexture=new O.g(this.renderingContext,t,e),this._ssaoTechnique=this.techniques.acquire(E),this._blurTechnique=this.techniques.acquire(b),this.addHandles((0,o.wB)((()=>this.isEnabled()),(()=>this._enableTime=(0,a.l5)(0))))}destroy(){this._passParameters.noiseTexture=(0,s.WD)(this._passParameters.noiseTexture),this._blurTechnique.release(),this._ssaoTechnique.release()}render(e){const t=this.bindParameters,r=e.find((e=>{let{name:t}=e;return"normals"===t})),i=r?.getTexture(),s=r?.getTexture(P.nI),o=this.fboCache,l=t.camera,c=l.fullViewport[2],d=l.fullViewport[3],f=Math.round(c/L),m=Math.round(d/L);if(!this._ssaoTechnique.compiled||!this._blurTechnique.compiled)return this._enableTime=(0,a.l5)(performance.now()),this.requestRender(),o.acquire(f,m,"ssao",h.N.RED);0===this._enableTime&&(this._enableTime=(0,a.l5)(performance.now()));const g=this.renderingContext,y=this.view.qualitySettings.fadeDuration,_=l.relativeElevation,v=(0,n.qE)((p.b-_)/(p.b-p.O),0,1),b=y>0?Math.min(y,performance.now()-this._enableTime)/y:1,w=b*v;this._passParameters.normalTexture=i,this._passParameters.depthTexture=s,this._passParameters.projScale=1/l.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*D/(0,C.g)(l)**6*w;const x=o.acquire(c,d,"ssao input",h.N.RG);g.unbindTexture(x.fbo.colorTexture),g.bindFramebuffer(x.fbo),g.setViewport(0,0,c,d),g.bindTechnique(this._ssaoTechnique,t,this._passParameters,this._drawParameters),g.screen.draw();const S=o.acquire(f,m,"ssao blur",h.N.RED);g.unbindTexture(S.fbo.colorTexture),g.bindFramebuffer(S.fbo),this._drawParameters.colorTexture=x.getTexture(),(0,u.hZ)(this._drawParameters.blurSize,0,L/d),g.bindTechnique(this._blurTechnique,t,this._passParameters,this._drawParameters),g.setViewport(0,0,f,m),g.screen.draw(),x.release();const T=o.acquire(f,m,"ssao",h.N.RED);return g.unbindTexture(T.fbo.colorTexture),g.bindFramebuffer(T.fbo),g.setViewport(0,0,c,d),g.setClearColor(1,1,1,0),g.clear(P.hn.COLOR_BUFFER_BIT),this._drawParameters.colorTexture=S.getTexture(),(0,u.hZ)(this._drawParameters.blurSize,L/c,0),g.bindTechnique(this._blurTechnique,t,this._passParameters,this._drawParameters),g.setViewport(0,0,f,m),g.screen.draw(),g.setViewport4fv(l.fullViewport),S.release(),b<1&&this.requestRender(R.C7.UPDATE),T}};(0,i._)([(0,l.MZ)()],N.prototype,"consumes",void 0),(0,i._)([(0,l.MZ)()],N.prototype,"produces",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],N.prototype,"techniques",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],N.prototype,"isEnabled",void 0),N=(0,i._)([(0,c.$)("esri.views.3d.webgl-engine.effects.ssao.SSAO")],N);const D=.5},72085:(e,t,r)=>{"use strict";r.d(t,{H:()=>s,a:()=>n});var i=r(91417);class n{constructor(){this.enabled=!0,this._time=(0,i.l5)(0)}get time(){return this._time}advance(e){let{deltaTime:t,fixedTime:r}=e;return null!=r?this._time!==r&&(this._time=r,!0):(this._time=(0,i.l5)(this._time+t),0!==t)}}class s{constructor(e,t){this.deltaTime=e,this.fixedTime=t}}},50468:(e,t,r)=>{"use strict";r.d(t,{K:()=>i,n:()=>n});class i{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;this.data=e,this.size=t,this.stride=r}}class n extends i{constructor(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(e,r,arguments.length>4&&void 0!==arguments[4]?arguments[4]:r),this.indices=t,this.exclusive=i}}},22728:(e,t,r)=>{"use strict";r.d(t,{KV:()=>y,Vc:()=>_,Cr:()=>d,JI:()=>p,jd:()=>h});var i=r(28899);let n;var s;!function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"}(s||(s={}));var o=r(93345),a=r(98433),l=r(27207);let c=null,u=null;async function h(){return null==u&&(n??=(async()=>{const e=await r.e(4027).then(r.bind(r,84027)),t=await e.default({locateFile:e=>(0,i.s)(`esri/libs/basisu/${e}`)});return t.initializeBasis(),t})(),u=n,c=await u),u}function d(e,t){if(null==c)return e.byteLength;const r=new c.BasisFile(new Uint8Array(e)),i=m(r)?f(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),t):0;return r.close(),r.delete(),i}function p(e,t){if(null==c)return e.byteLength;const r=new c.KTX2File(new Uint8Array(e)),i=g(r)?f(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),t):0;return r.close(),r.delete(),i}function f(e,t,r,i,n){const s=(0,l.IB)(t?o.CQ.COMPRESSED_RGBA8_ETC2_EAC:o.CQ.COMPRESSED_RGB8_ETC2),a=n&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(r*i*s*a)}function m(e){return e.getNumImages()>=1&&!e.isUASTC()}function g(e){return e.getFaces()>=1&&e.isETC1S()}async function y(e,t,r){null==c&&(c=await h());const i=new c.BasisFile(new Uint8Array(r));if(!m(i))return null;i.startTranscoding();const n=v(e,t,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),((e,t)=>i.getImageTranscodedSizeInBytes(0,e,t)),((e,t,r)=>i.transcodeImage(r,0,e,t,0,0)));return i.close(),i.delete(),n}async function _(e,t,r){null==c&&(c=await h());const i=new c.KTX2File(new Uint8Array(r));if(!g(i))return null;i.startTranscoding();const n=v(e,t,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),((e,t)=>i.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,r)=>i.transcodeImage(r,e,0,0,t,0,-1,-1)));return i.close(),i.delete(),n}function v(e,t,r,i,n,l,c,u){const{compressedTextureETC:h,compressedTextureS3TC:d}=e.capabilities,[p,f]=h?i?[s.ETC2_RGBA,o.CQ.COMPRESSED_RGBA8_ETC2_EAC]:[s.ETC1_RGB,o.CQ.COMPRESSED_RGB8_ETC2]:d?i?[s.BC3_RGBA,o.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[s.BC1_RGB,o.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT]:[s.RGBA32,o.Ab.RGBA],m=t.hasMipmap?r:Math.min(1,r),g=[];for(let s=0;s<m;s++)g.push(new Uint8Array(c(s,p))),u(s,p,g[s]);return t.internalFormat=f,t.hasMipmap=g.length>1,t.samplingMode=t.hasMipmap?o.Cj.LINEAR_MIPMAP_LINEAR:o.Cj.LINEAR,t.width=n,t.height=l,new a.g(e,t,{type:"compressed",levels:g})}},10209:(e,t,r)=>{"use strict";r.d(t,{k:()=>f});var i=r(13191),n=r(72745),s=r(63401),o=r(33062),a=r(98521),l=r(10708),c=r(81993),u=r(83490),h=r(77730),d=r(10773),p=r(4998);class f{constructor(e,t){this.shadowMap=e,this.slicePlane=t,this.slot=h.N.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=d.y.NONE,this.alignPixelEnabled=!1,this.decorations=u.ID.ON,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new o.A,this._inverseViewport=(0,n.vt)(),this.oldLighting=new p.TA,this.newLighting=new p.TA,this._fadedLighting=new p.TA,this._lighting=this.newLighting,this.ssr=new m,this.multipassEnabled=!1,this.multipassTerrain=new c.h,this.multipassGeometry=new l.U,this.hudRenderStyle=a.D.Occluded,this.cloudsFade=new s.ny,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:t,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(t,r,e),this._lighting=this._fadedLighting)}}class m{constructor(){this.fadeFactor=1,this.reprojectionMatrix=(0,i.vt)()}}},85086:(e,t,r)=>{"use strict";r.d(t,{j:()=>a});var i=r(30015),n=r(20664),s=r(9392),o=r(86994);class a{constructor(e,t,r){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.position=r,this._children=void 0,(0,o.vA)(e.length>=1),(0,o.vA)(3===r.size||4===r.size);const{data:i,size:a,indices:c}=r;(0,o.vA)(c.length%this._numIndexPerPrimitive==0),(0,o.vA)(c.length>=e.length*this._numIndexPerPrimitive);const u=e.length;let h=a*c[this._numIndexPerPrimitive*e[0]];l.clear(),l.push(h);const d=(0,s.fA)(i[h],i[h+1],i[h+2]),p=(0,s.o8)(d);for(let n=0;n<u;++n){const t=this._numIndexPerPrimitive*e[n];for(let e=0;e<this._numIndexPerPrimitive;++e){h=a*c[t+e],l.push(h);let r=i[h];d[0]=Math.min(r,d[0]),p[0]=Math.max(r,p[0]),r=i[h+1],d[1]=Math.min(r,d[1]),p[1]=Math.max(r,p[1]),r=i[h+2],d[2]=Math.min(r,d[2]),p[2]=Math.max(r,p[2])}}this.bbMin=d,this.bbMax=p;const f=(0,n.o)((0,s.vt)(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(p[0]-d[0],p[1]-d[1]),p[2]-d[2]);let m=this.radius*this.radius;for(let n=0;n<l.length;++n){h=l.at(n);const e=i[h]-f[0],t=i[h+1]-f[1],r=i[h+2]-f[2],s=e*e+t*t+r*r;if(s<=m)continue;const o=Math.sqrt(s),a=.5*(o-this.radius);this.radius=this.radius+a,m=this.radius*this.radius;const c=a/o;f[0]+=e*c,f[1]+=t*c,f[2]+=r*c}this.center=f,l.clear()}getChildren(){if(this._children||(0,n.a)(this.bbMin,this.bbMax)<=1)return this._children;const e=(0,n.o)((0,s.vt)(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,r=new Uint8Array(t),i=new Array(8);for(let n=0;n<8;++n)i[n]=0;const{data:o,size:l,indices:c}=this.position;for(let n=0;n<t;++n){let t=0;const s=this._numIndexPerPrimitive*this.primitiveIndices[n];let a=l*c[s],u=o[a],h=o[a+1],d=o[a+2];for(let e=1;e<this._numIndexPerPrimitive;++e){a=l*c[s+e];const t=o[a],r=o[a+1],i=o[a+2];t<u&&(u=t),r<h&&(h=r),i<d&&(d=i)}u<e[0]&&(t|=1),h<e[1]&&(t|=2),d<e[2]&&(t|=4),r[n]=t,++i[t]}let u=0;for(let n=0;n<8;++n)i[n]>0&&++u;if(u<2)return;const h=new Array(8);for(let n=0;n<8;++n)h[n]=i[n]>0?new Uint32Array(i[n]):void 0;for(let n=0;n<8;++n)i[n]=0;for(let n=0;n<t;++n){const e=r[n];h[e][i[e]++]=this.primitiveIndices[n]}this._children=new Array;for(let n=0;n<8;++n)void 0!==h[n]&&this._children.push(new a(h[n],this._numIndexPerPrimitive,this.position));return this._children}static prune(){l.prune()}}const l=new i.A({deallocator:null})},63496:(e,t,r)=>{"use strict";r.d(t,{VR:()=>n,a0:()=>o});var i=r(30015);class n{constructor(){this.adds=new i.A,this.removes=new i.A,this.updates=new i.A({allocator:e=>e||new s,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class s{}class o{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}},73146:(e,t,r)=>{"use strict";r.d(t,{J:()=>n});var i=r(90632);class n{constructor(){this.id=(0,i.c)()}}},87634:(e,t,r)=>{"use strict";var i;r.d(t,{X:()=>i}),function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Mesh=2]="Mesh",e[e.Line=3]="Line",e[e.Point=4]="Point",e[e.Material=5]="Material",e[e.Texture=6]="Texture",e[e.COUNT=7]="COUNT"}(i||(i={}))},32119:(e,t,r)=>{"use strict";r.d(t,{D:()=>n});var i=r(66470);const n=new Map([[i.r.POSITION,0],[i.r.NORMAL,1],[i.r.NORMALCOMPRESSED,1],[i.r.UV0,2],[i.r.COLOR,3],[i.r.COLORFEATUREATTRIBUTE,3],[i.r.SIZE,4],[i.r.TANGENT,4],[i.r.CENTEROFFSETANDDISTANCE,5],[i.r.SYMBOLCOLOR,5],[i.r.FEATUREATTRIBUTE,6],[i.r.INSTANCEFEATUREATTRIBUTE,6],[i.r.INSTANCECOLOR,7],[i.r.OBJECTANDLAYERIDCOLOR,7],[i.r.INSTANCEOBJECTANDLAYERIDCOLOR,7],[i.r.INSTANCEMODEL,8],[i.r.INSTANCEMODELNORMAL,12],[i.r.INSTANCEMODELORIGINHI,11],[i.r.INSTANCEMODELORIGINLO,15]])},11850:(e,t,r)=>{"use strict";r.d(t,{lK:()=>o,u7:()=>a});var i=r(66470),n=r(93345),s=r(21812);new s._(i.r.POSITION,3,n.pe.FLOAT,0,12);const o=[new s._(i.r.POSITION,2,n.pe.FLOAT,0,8)],a=[new s._(i.r.POSITION,2,n.pe.FLOAT,0,16),new s._(i.r.UV0,2,n.pe.FLOAT,8,16)]},48190:(e,t,r)=>{"use strict";r.d(t,{z:()=>n});var i=r(39345);function n(e){const{size:t}=e.definition,r=e.fontString(t);let n=s.get(r);if(!n){const c=(0,i.y)(a,0,0).getContext("2d");e.setFontProperties(c,t);const u=c.measureText(l);n=new o(u.actualBoundingBoxAscent,u.actualBoundingBoxDescent),s.set(r,n)}return n}const s=new Map;class o{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,t){this.maxAscent=e,this.maxDescent=t}}const a={canvas:null},l=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})()},59696:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var i=r(83490);class n{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){this._techniques.release(this._technique)}get technique(){return this._technique}get _stippleTextures(){return this._techniques.constructionContext.stippleTextures}get _markerTextures(){return this._techniques.constructionContext.markerTextures}ensureTechnique(e,t){return this._technique=this._techniques.releaseAndAcquire(e,this._material.getConfiguration(this._output,t),this._technique),this._technique}ensureResources(e){return i.Am.LOADED}}},30988:(e,t,r)=>{"use strict";r.d(t,{v:()=>a});var i=r(76460),n=r(30726),s=r(75941),o=r(86994);class a{constructor(e,t,r,i){this._textures=e,this._techniques=t,this.materialChanged=r,this.requestRender=i,this._id2glMaterialRef=new s.O}dispose(){this._textures.destroy()}acquire(e,t,r){this._ownMaterial(e);const i=e.produces.get(t);if(!i?.(r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(null==n){const t=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:r});n=new l(t),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,t){const r=this._id2glMaterialRef.get(t,e.id);null!=r&&(r.unref(),r.referenced||((0,n.WD)(r.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&i.A.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}class l{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,o.vA)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}},50255:(e,t,r)=>{"use strict";r.d(t,{c:()=>n});var i=r(83490);class n{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}dispose(){this._map.forEach(((e,t)=>{null!=e&&this._repository.release(this._material,t)}))}load(e,t,r){const n=this._material.produces.get(t);if(!n?.(r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,t,r));const s=this._map.get(r);if(null!=s){if(s.ensureResources(e)===i.Am.LOADED)return s;this._repository.requestRender()}return null}}},75803:(e,t,r)=>{"use strict";r.d(t,{N:()=>c,m:()=>l});var i=r(30726),n=r(50346),s=r(64839),o=r(83490),a=r(59696);class l extends a.A{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this._textureId=e.textureId,this._acquire(e.textureId,(e=>this._texture=e)),this._acquire(e.normalTextureId,(e=>this._textureNormal=e)),this._acquire(e.emissiveTextureId,(e=>this._textureEmissive=e)),this._acquire(e.occlusionTextureId,(e=>this._textureOcclusion=e)),this._acquire(e.metallicRoughnessTextureId,(e=>this._textureMetallicRoughness=e))}dispose(){this._texture=(0,i.Gz)(this._texture),this._textureNormal=(0,i.Gz)(this._textureNormal),this._textureEmissive=(0,i.Gz)(this._textureEmissive),this._textureOcclusion=(0,i.Gz)(this._textureOcclusion),this._textureMetallicRoughness=(0,i.Gz)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return 0===this._numLoading?o.Am.LOADED:o.Am.LOADING}get textureBindParameters(){return new c(null!=this._texture?this._texture.glTexture:null,null!=this._textureNormal?this._textureNormal.glTexture:null,null!=this._textureEmissive?this._textureEmissive.glTexture:null,null!=this._textureOcclusion?this._textureOcclusion.glTexture:null,null!=this._textureMetallicRoughness?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){null!=this._texture&&e===this._texture.id||(this._texture=(0,i.Gz)(this._texture),this._textureId=e,this._acquire(this._textureId,(e=>this._texture=e)))}_acquire(e,t){if(null==e)return void t(null);const r=this._textures.acquire(e);if((0,n.$X)(r))return++this._numLoading,void r.then((e=>{if(this._disposed)return(0,i.Gz)(e),void t(null);t(e)})).finally((()=>--this._numLoading));t(r)}}class c extends s.Y{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;super(),this.texture=e,this.textureNormal=t,this.textureEmissive=r,this.textureOcclusion=i,this.textureMetallicRoughness=n,this.scale=s,this.normalTextureTransformMatrix=o}}},51799:(e,t,r)=>{"use strict";r.d(t,{V:()=>x});var i=r(13191),n=r(20664),s=r(38496),o=r(78393);function a(e){if(e.length<o.y9)return Array.from(e);if((0,o.cy)(e))return Float64Array.from(e);if(!("BYTES_PER_ELEMENT"in e))return Array.from(e);switch(e.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(e);case 2:return(0,o.jq)(e)?Uint16Array.from(e):Int16Array.from(e);case 4:return Float32Array.from(e);default:return Float64Array.from(e)}}var l=r(83490),c=r(85086),u=r(73146),h=r(87634),d=r(9392),p=r(45097);const f=(0,d.vt)(),m=(0,d.vt)(),g=(0,d.vt)(),y=(0,d.vt)();var _=r(35416),v=r(86994),b=r(66470),w=r(68967);class x extends u.J{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.X.Mesh,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;super(),this.material=e,this.mapPositions=r,this.type=i,this.objectAndLayerIdColor=n,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of t)this._attributes.set(a,{...l,indices:(0,s.Dg)(l.indices)}),a===b.r.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new x(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach(((e,r)=>{e.exclusive=!1,t._attributes.set(r,e)})),t._boundingInfo=this._boundingInfo,t.transformation=e.transformation||this.transformation,t}get attributes(){return this._attributes}getMutableAttribute(e){let t=this._attributes.get(e);return t&&!t.exclusive&&(t={...t,exclusive:!0,data:a(t.data)},this._attributes.set(e,t)),t}setAttributeData(e,t){const r=this._attributes.get(e);r&&this._attributes.set(e,{...r,exclusive:!0,data:t})}get indexCount(){const e=this._attributes.values().next().value.indices;return e?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===h.X.Mesh?this._computeAttachmentOriginTriangles(e):this.type===h.X.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(null!=this._transformation&&(0,n.h)(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){return function(e,t){if(!e)return!1;const{size:r,data:i,indices:s}=e;(0,n.s)(t,0,0,0),(0,n.s)(y,0,0,0);let o=0,a=0;for(let l=0;l<s.length-2;l+=3){const e=s[l]*r,c=s[l+1]*r,u=s[l+2]*r;(0,n.s)(f,i[e],i[e+1],i[e+2]),(0,n.s)(m,i[c],i[c+1],i[c+2]),(0,n.s)(g,i[u],i[u+1],i[u+2]);const h=(0,p.Q7)(f,m,g);h?((0,n.g)(f,f,m),(0,n.g)(f,f,g),(0,n.j)(f,f,1/3*h),(0,n.g)(t,t,f),o+=h):((0,n.g)(y,y,f),(0,n.g)(y,y,m),(0,n.g)(y,y,g),a+=3)}return(0!==a||0!==o)&&(0!==o?((0,n.j)(t,t,1/o),!0):0!==a&&((0,n.j)(t,y,1/a),!0))}(this.attributes.get(b.r.POSITION),e)}_computeAttachmentOriginLines(e){const t=this.attributes.get(b.r.POSITION);return function(e,t,r){if(!e)return!1;(0,n.s)(r,0,0,0),(0,n.s)(y,0,0,0);let i=0,s=0;const{size:o,data:a,indices:l}=e,c=l.length-1,u=c+(t?2:0);for(let h=0;h<u;h+=2){const e=h<c?h+1:0,t=l[h<c?h:c]*o,u=l[e]*o;f[0]=a[t],f[1]=a[t+1],f[2]=a[t+2],m[0]=a[u],m[1]=a[u+1],m[2]=a[u+2],(0,n.j)(f,(0,n.g)(f,f,m),.5);const d=(0,n.F)(f,m);d>0?((0,n.g)(r,r,(0,n.j)(f,f,d)),i+=d):0===i&&((0,n.g)(y,y,f),s++)}return 0!==i?((0,n.j)(r,r,1/i),!0):0!==s&&((0,n.j)(r,y,1/s),!0)}(t,function(e,t){return!(!("isClosed"in e)||!e.isClosed)&&t.indices.length>2}(this.material.parameters,t),e)}_computeAttachmentOriginPoints(e){return function(e,t){if(!e)return!1;const{size:r,data:i,indices:s}=e;(0,n.s)(t,0,0,0);let o=-1,a=0;for(let n=0;n<s.length;n++){const e=s[n]*r;o!==e&&(t[0]+=i[e],t[1]+=i[e+1],t[2]+=i[e+2],a++),o=e}return a>1&&(0,n.j)(t,t,1/a),a>0}(this.attributes.get(b.r.POSITION),e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(b.r.POSITION);if(!e||0===e.indices.length)return null;const t=this.type===h.X.Mesh?3:1;(0,v.vA)(e.indices.length%t==0,"Indexing error: "+e.indices.length+" not divisible by "+t);const r=(0,s.tM)(e.indices.length/t);return new c.j(r,t,e)}get transformation(){return this._transformation??i.zK}set transformation(e){this._transformation=e&&e!==i.zK?(0,i.o8)(e):null}addHighlight(){const e=new _.X(l.Mg.Highlight);return this.highlights=(0,w.Ci)(this.highlights,e),e}removeHighlight(e){this.highlights=(0,w.PC)(this.highlights,e)}}},62577:(e,t,r)=>{"use strict";r.d(t,{zC:()=>ne,C1:()=>M,EE:()=>J,nW:()=>K,td:()=>P,_B:()=>re,Nq:()=>ee,DJ:()=>W,Y6:()=>q,uX:()=>$,Z8:()=>te,CM:()=>Z,Gj:()=>X,Ho:()=>G,Nb:()=>Q,Xl:()=>oe,xh:()=>ie});var i,n=r(72745),s=r(20664),o=r(83755),a=r(9392),l=r(44815),c=r(75002),u=r(38496),h=r(13927),d=r(95925),p=r(50468);!function(e){e.length=function(e,t){const r=e[t],i=e[t+1],n=e[t+2];return Math.sqrt(r*r+i*i+n*n)},e.normalize=function(e,t){const r=e[t],i=e[t+1],n=e[t+2],s=1/Math.sqrt(r*r+i*i+n*n);e[t]*=s,e[t+1]*=s,e[t+2]*=s},e.scale=function(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r},e.add=function(e,t,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(n=n||e)[s]=e[t]+r[i],n[s+1]=e[t+1]+r[i+1],n[s+2]=e[t+2]+r[i+2]},e.subtract=function(e,t,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(n=n||e)[s]=e[t]-r[i],n[s+1]=e[t+1]-r[i+1],n[s+2]=e[t+2]-r[i+2]}}(i||(i={}));var f=r(87634),m=r(51799),g=r(86994),y=r(66470);const _=i,v=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],b=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],w=[0,0,1,0,1,1,0,1],x=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],S=new Array(36);for(let ce=0;ce<6;ce++)for(let e=0;e<6;e++)S[6*ce+e]=ce;const T=new Array(36);for(let ce=0;ce<6;ce++)T[6*ce]=0,T[6*ce+1]=1,T[6*ce+2]=2,T[6*ce+3]=2,T[6*ce+4]=3,T[6*ce+5]=0;function M(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=v[i][0]*t[0],r[3*i+1]=v[i][1]*t[1],r[3*i+2]=v[i][2]*t[2];return new m.V(e,[[y.r.POSITION,new p.n(r,x,3,!0)],[y.r.NORMAL,new p.n(b,S,3)],[y.r.UV0,new p.n(w,T,2)]])}const A=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],C=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],E=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],R=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function P(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=A[i][0]*t[0],r[3*i+1]=A[i][1]*t[1],r[3*i+2]=A[i][2]*t[2];return new m.V(e,[[y.r.POSITION,new p.n(r,E,3,!0)],[y.r.NORMAL,new p.n(C,R,3)]])}const O=(0,o.fA)(-.5,0,-.5),I=(0,o.fA)(.5,0,-.5),L=(0,o.fA)(0,0,.5),N=(0,o.fA)(0,.5,0),D=(0,o.vt)(),F=(0,o.vt)(),k=(0,o.vt)(),z=(0,o.vt)(),U=(0,o.vt)();(0,s.f)(D,O,N),(0,s.f)(F,O,I),(0,s.b)(k,D,F),(0,s.n)(k,k),(0,s.f)(D,I,N),(0,s.f)(F,I,L),(0,s.b)(z,D,F),(0,s.n)(z,z),(0,s.f)(D,L,N),(0,s.f)(F,L,O),(0,s.b)(U,D,F),(0,s.n)(U,U);const V=[O,I,L,N],B=[0,-1,0,k[0],k[1],k[2],z[0],z[1],z[2],U[0],U[1],U[2]],j=[0,1,2,3,1,0,3,2,1,3,0,2],H=[0,0,0,1,1,1,2,2,2,3,3,3];function G(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=V[i][0]*t[0],r[3*i+1]=V[i][1]*t[1],r[3*i+2]=V[i][2]*t[2];return new m.V(e,[[y.r.POSITION,new p.n(r,j,3,!0)],[y.r.NORMAL,new p.n(B,H,3)]])}function Z(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{uv:!0};const s=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,h=Math.max(3,Math.floor(r)),d=Math.max(2,Math.floor(i)),f=(h+1)*(d+1),g=(0,c.oe)(3*f),_=(0,c.oe)(3*f),v=(0,c.oe)(2*f),b=[];let w=0;for(let c=0;c<=d;c++){const e=[],r=c/d,i=a+r*l,n=Math.cos(i);for(let a=0;a<=h;a++){const l=a/h,c=s+l*o,u=Math.cos(c)*n,d=Math.sin(i),p=-Math.sin(c)*n;g[3*w]=u*t,g[3*w+1]=d*t,g[3*w+2]=p*t,_[3*w]=u,_[3*w+1]=d,_[3*w+2]=p,v[2*w]=l,v[2*w+1]=r,e.push(w),++w}b.push(e)}const x=new Array;for(let c=0;c<d;c++)for(let e=0;e<h;e++){const t=b[c][e],r=b[c][e+1],i=b[c+1][e+1],n=b[c+1][e];0===c?(x.push(t),x.push(i),x.push(n)):c===d-1?(x.push(t),x.push(r),x.push(i)):(x.push(t),x.push(r),x.push(i),x.push(i),x.push(n),x.push(t))}const S=[[y.r.POSITION,new p.n(g,x,3,!0)],[y.r.NORMAL,new p.n(_,x,3,!0)]];return n.uv&&S.push([y.r.UV0,new p.n(v,x,2,!0)]),n.offset&&(S[0][0]=y.r.OFFSET,S.push([y.r.POSITION,new p.n(Float64Array.from(n.offset),(0,u.EH)(x.length),3,!0)])),new m.V(e,S)}function $(e,t,r,i){const n=q(t,r,i);return new m.V(e,n)}function q(e,t,r){const i=e;let n,s;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const e=i*(1+Math.sqrt(5))/2;n=[-i,e,0,i,e,0,-i,-e,0,i,-e,0,0,-i,e,0,i,e,0,-i,-e,0,i,-e,e,0,-i,e,0,i,-e,0,-i,-e,0,i],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<n.length;c+=3)_.scale(n,c,e/_.length(n,c));let o={};function a(t,r){t>r&&([t,r]=[r,t]);const i=t.toString()+"."+r.toString();if(o[i])return o[i];let s=n.length;return n.length+=3,_.add(n,3*t,n,3*r,n,s),_.scale(n,s,e/_.length(n,s)),s/=3,o[i]=s,s}for(let c=0;c<t;c++){const e=s.length,t=new Array(4*e);for(let r=0;r<e;r+=3){const e=s[r],i=s[r+1],n=s[r+2],o=a(e,i),l=a(i,n),c=a(n,e),u=4*r;t[u]=e,t[u+1]=o,t[u+2]=c,t[u+3]=i,t[u+4]=l,t[u+5]=o,t[u+6]=n,t[u+7]=c,t[u+8]=l,t[u+9]=o,t[u+10]=l,t[u+11]=c}s=t,o={}}const l=(0,c.Wz)(n);for(let c=0;c<l.length;c+=3)_.normalize(l,c);return[[y.r.POSITION,new p.n((0,c.Wz)(n),s,3,!0)],[y.r.NORMAL,new p.n(l,s,3,!0)]]}function W(e,t,r,i,s,o,l,c){let h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;const d=r?(0,a.o8)(r):(0,a.vt)(),g=t?(0,a.o8)(t):(0,a.fA)(0,0,1);l??=(0,n.vt)();const _=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],v=null!=s&&2===s.length?s:[1,1],b=(0,u.EH)(1),w=[[y.r.POSITION,new p.n(d,b,3,!0)],[y.r.NORMAL,new p.n(g,b,3,!0)],[y.r.UV0,new p.n(l,b,l.length)],[y.r.COLOR,new p.n(_,b,4,!0)],[y.r.SIZE,new p.n(v,b,2)]];if(null!=o&&(o=[o[0],o[1],o[2],o[3]],w.push([y.r.CENTEROFFSETANDDISTANCE,new p.n(o,b,4)])),c){const e=[c[0],c[1],c[2],c[3]];w.push([y.r.FEATUREATTRIBUTE,new p.n(e,b,4)])}return new m.V(e,w,null,f.X.Point,h)}const Y=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function X(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Y;const r=new Array(12);for(let o=0;o<4;o++)for(let e=0;e<3;e++)r[3*o+e]=t[o][e];const i=[0,1,2,2,3,0],n=[0,0,0,0,0,0],s=[[y.r.POSITION,new p.n(r,i,3,!0)],[y.r.NORMAL,new p.n([0,0,1],n,3,!0)],[y.r.UV0,new p.n([0,0,1,0,1,1,0,1],i,2,!0)],[y.r.COLOR,new p.n([255,255,255,255],n,4,!0)]];return new m.V(e,s)}function J(e,t,r,i,n){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=0;const u=r,h=t;let d=(0,o.fA)(0,l,0),f=(0,o.fA)(0,l+h,0),g=(0,o.fA)(0,-1,0),_=(0,o.fA)(0,1,0);n&&(l=h,f=(0,o.fA)(0,0,0),d=(0,o.fA)(0,l,0),g=(0,o.fA)(0,1,0),_=(0,o.fA)(0,-1,0));const v=[f,d],b=[g,_],w=i+2,x=Math.sqrt(h*h+u*u);if(n)for(let c=i-1;c>=0;c--){const e=c*(2*Math.PI/i),t=(0,o.fA)(Math.cos(e)*u,l,Math.sin(e)*u);v.push(t);const r=(0,o.fA)(h*Math.cos(e)/x,-u/x,h*Math.sin(e)/x);b.push(r)}else for(let c=0;c<i;c++){const e=c*(2*Math.PI/i),t=(0,o.fA)(Math.cos(e)*u,l,Math.sin(e)*u);v.push(t);const r=(0,o.fA)(h*Math.cos(e)/x,u/x,h*Math.sin(e)/x);b.push(r)}const S=new Array,T=new Array;if(s){for(let e=3;e<v.length;e++)S.push(1),S.push(e-1),S.push(e),T.push(0),T.push(0),T.push(0);S.push(v.length-1),S.push(2),S.push(1),T.push(0),T.push(0),T.push(0)}if(a){for(let e=3;e<v.length;e++)S.push(e),S.push(e-1),S.push(0),T.push(e),T.push(e-1),T.push(1);S.push(0),S.push(2),S.push(v.length-1),T.push(1),T.push(2),T.push(b.length-1)}const M=(0,c.oe)(3*w);for(let o=0;o<w;o++)M[3*o]=v[o][0],M[3*o+1]=v[o][1],M[3*o+2]=v[o][2];const A=(0,c.oe)(3*w);for(let o=0;o<w;o++)A[3*o]=b[o][0],A[3*o+1]=b[o][1],A[3*o+2]=b[o][2];const C=[[y.r.POSITION,new p.n(M,S,3,!0)],[y.r.NORMAL,new p.n(A,T,3,!0)]];return new m.V(e,C)}function K(e,t,r,i,n,a,l){const u=n?(0,o.o8)(n):(0,o.fA)(1,0,0),h=a?(0,o.o8)(a):(0,o.fA)(0,0,0);l??=!0;const d=(0,o.vt)();(0,s.n)(d,u);const f=(0,o.vt)();(0,s.j)(f,d,Math.abs(t));const g=(0,o.vt)();(0,s.j)(g,f,-.5),(0,s.g)(g,g,h);const _=(0,o.fA)(0,1,0);Math.abs(1-(0,s.m)(d,_))<.2&&(0,s.s)(_,0,0,1);const v=(0,o.vt)();(0,s.b)(v,d,_),(0,s.n)(v,v),(0,s.b)(_,v,d);const b=2*i+(l?2:0),w=i+(l?2:0),x=(0,c.oe)(3*b),S=(0,c.oe)(3*w),T=(0,c.oe)(2*b),M=new Array(3*i*(l?4:2)),A=new Array(3*i*(l?4:2));l&&(x[3*(b-2)]=g[0],x[3*(b-2)+1]=g[1],x[3*(b-2)+2]=g[2],T[2*(b-2)]=0,T[2*(b-2)+1]=0,x[3*(b-1)]=x[3*(b-2)]+f[0],x[3*(b-1)+1]=x[3*(b-2)+1]+f[1],x[3*(b-1)+2]=x[3*(b-2)+2]+f[2],T[2*(b-1)]=1,T[2*(b-1)+1]=1,S[3*(w-2)]=-d[0],S[3*(w-2)+1]=-d[1],S[3*(w-2)+2]=-d[2],S[3*(w-1)]=d[0],S[3*(w-1)+1]=d[1],S[3*(w-1)+2]=d[2]);const C=(e,t,r)=>{M[e]=t,A[e]=r};let E=0;const R=(0,o.vt)(),P=(0,o.vt)();for(let o=0;o<i;o++){const e=o*(2*Math.PI/i);(0,s.j)(R,_,Math.sin(e)),(0,s.j)(P,v,Math.cos(e)),(0,s.g)(R,R,P),S[3*o]=R[0],S[3*o+1]=R[1],S[3*o+2]=R[2],(0,s.j)(R,R,r),(0,s.g)(R,R,g),x[3*o]=R[0],x[3*o+1]=R[1],x[3*o+2]=R[2],T[2*o]=o/i,T[2*o+1]=0,x[3*(o+i)]=x[3*o]+f[0],x[3*(o+i)+1]=x[3*o+1]+f[1],x[3*(o+i)+2]=x[3*o+2]+f[2],T[2*(o+i)]=o/i,T[2*o+1]=1;const t=(o+1)%i;C(E++,o,o),C(E++,o+i,o),C(E++,t,t),C(E++,t,t),C(E++,o+i,o),C(E++,t+i,t)}if(l){for(let e=0;e<i;e++){const t=(e+1)%i;C(E++,b-2,w-2),C(E++,e,w-2),C(E++,t,w-2)}for(let e=0;e<i;e++){const t=(e+1)%i;C(E++,e+i,w-1),C(E++,b-1,w-1),C(E++,t+i,w-1)}}const O=[[y.r.POSITION,new p.n(x,M,3,!0)],[y.r.NORMAL,new p.n(S,A,3,!0)],[y.r.UV0,new p.n(T,M,2,!0)]];return new m.V(e,O)}function Q(e,t,r,i,n,s){i=i||10,n=null==n||n,(0,g.vA)(t.length>1);const o=[],a=[];for(let l=0;l<i;l++){o.push([0,-l-1,-(l+1)%i-1]);const e=l/i*2*Math.PI;a.push([Math.cos(e)*r,Math.sin(e)*r])}return ee(e,a,t,[[0,0,0]],o,n,s)}function ee(e,t,r,i,n,l){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:(0,o.fA)(0,0,0);const f=t.length,g=(0,c.oe)(r.length*f*3+(6*i.length||0)),_=(0,c.oe)(r.length*f*3+(i?6:0)),v=new Array,b=new Array;let w=0,x=0;const S=(0,a.vt)(),T=(0,a.vt)(),M=(0,a.vt)(),A=(0,a.vt)(),C=(0,a.vt)(),E=(0,a.vt)(),R=(0,a.vt)(),P=(0,a.vt)(),O=(0,a.vt)(),I=(0,a.vt)(),L=(0,a.vt)(),N=(0,a.vt)(),D=(0,a.vt)(),F=(0,h.vt)();(0,s.s)(O,0,1,0),(0,s.f)(T,r[1],r[0]),(0,s.n)(T,T),l?((0,s.g)(P,r[0],u),(0,s.n)(M,P)):(0,s.s)(M,0,0,1),oe(T,M,O,O,C,M,ae),(0,s.c)(A,M),(0,s.c)(N,C);for(let o=0;o<i.length;o++)(0,s.j)(E,C,i[o][0]),(0,s.j)(P,M,i[o][2]),(0,s.g)(E,E,P),(0,s.g)(E,E,r[0]),g[w++]=E[0],g[w++]=E[1],g[w++]=E[2];_[x++]=-T[0],_[x++]=-T[1],_[x++]=-T[2];for(let s=0;s<n.length;s++)v.push(n[s][0]>0?n[s][0]:-n[s][0]-1+i.length),v.push(n[s][1]>0?n[s][1]:-n[s][1]-1+i.length),v.push(n[s][2]>0?n[s][2]:-n[s][2]-1+i.length),b.push(0),b.push(0),b.push(0);let k=i.length;const z=i.length-1;for(let o=0;o<r.length;o++){let e=!1;o>0&&((0,s.c)(S,T),o<r.length-1?((0,s.f)(T,r[o+1],r[o]),(0,s.n)(T,T)):e=!0,(0,s.g)(I,S,T),(0,s.n)(I,I),(0,s.g)(L,r[o-1],A),(0,h.O_)(r[o],I,F),(0,h.Ui)(F,(0,d.LV)(L,S),P)?((0,s.f)(P,P,r[o]),(0,s.n)(M,P),(0,s.b)(C,I,M),(0,s.n)(C,C)):oe(I,A,N,O,C,M,ae),(0,s.c)(A,M),(0,s.c)(N,C)),l&&((0,s.g)(P,r[o],u),(0,s.n)(D,P));for(let i=0;i<f;i++)if((0,s.j)(E,C,t[i][0]),(0,s.j)(P,M,t[i][1]),(0,s.g)(E,E,P),(0,s.n)(R,E),_[x++]=R[0],_[x++]=R[1],_[x++]=R[2],(0,s.g)(E,E,r[o]),g[w++]=E[0],g[w++]=E[1],g[w++]=E[2],!e){const e=(i+1)%f;v.push(k+i),v.push(k+f+i),v.push(k+e),v.push(k+e),v.push(k+f+i),v.push(k+f+e);for(let t=0;t<6;t++){const e=v.length-6;b.push(v[e+t]-z)}}k+=f}const U=r[r.length-1];for(let o=0;o<i.length;o++)(0,s.j)(E,C,i[o][0]),(0,s.j)(P,M,i[o][1]),(0,s.g)(E,E,P),(0,s.g)(E,E,U),g[w++]=E[0],g[w++]=E[1],g[w++]=E[2];const V=x/3;_[x++]=T[0],_[x++]=T[1],_[x++]=T[2];const B=k-f;for(let s=0;s<n.length;s++)v.push(n[s][0]>=0?k+n[s][0]:-n[s][0]-1+B),v.push(n[s][2]>=0?k+n[s][2]:-n[s][2]-1+B),v.push(n[s][1]>=0?k+n[s][1]:-n[s][1]-1+B),b.push(V),b.push(V),b.push(V);const j=[[y.r.POSITION,new p.n(g,v,3,!0)],[y.r.NORMAL,new p.n(_,b,3,!0)]];return new m.V(e,j)}function te(e,t,r,i){(0,g.vA)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,g.vA)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,g.vA)(null==r||r.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,g.vA)(null==r||3===r[0].length,"createPolylineGeometry(): malformed normal");const n=(0,l.jh)(3*t.length),s=new Array(2*(t.length-1));let o=0,a=0;for(let l=0;l<t.length;l++){for(let e=0;e<3;e++)n[o++]=t[l][e];l>0&&(s[a++]=l-1,s[a++]=l)}const h=[[y.r.POSITION,new p.n(n,s,3,!0)]];if(r){const e=(0,c.oe)(3*r.length);let i=0;for(let n=0;n<t.length;n++)for(let t=0;t<3;t++)e[i++]=r[n][t];h.push([y.r.NORMAL,new p.n(e,s,3,!0)])}return i&&h.push([y.r.COLOR,new p.n(i,(0,u.tM)(i.length/4),4)]),new m.V(e,h,null,f.X.Line)}function re(e,t,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const o=new Array(18),a=[[-r,s,n/2],[i,s,n/2],[0,t+s,n/2],[-r,s,-n/2],[i,s,-n/2],[0,t+s,-n/2]];for(let l=0;l<6;l++)o[3*l]=a[l][0],o[3*l+1]=a[l][1],o[3*l+2]=a[l][2];return new m.V(e,[[y.r.POSITION,new p.n(o,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])}function ie(e,t){const r=e.getMutableAttribute(y.r.POSITION).data;for(let i=0;i<r.length;i+=3){const e=r[i],n=r[i+1],o=r[i+2];(0,s.s)(le,e,n,o),(0,s.h)(le,le,t),r[i]=le[0],r[i+1]=le[1],r[i+2]=le[2]}}function ne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;const r=e.attributes,i=r.get(y.r.POSITION).data,n=r.get(y.r.NORMAL).data;if(n){const e=t.getMutableAttribute(y.r.NORMAL).data;for(let t=0;t<n.length;t+=3){const r=n[t+1];e[t+1]=-n[t+2],e[t+2]=r}}if(i){const e=t.getMutableAttribute(y.r.POSITION).data;for(let t=0;t<i.length;t+=3){const r=i[t+1];e[t+1]=-i[t+2],e[t+2]=r}}}function se(e,t,r,i,n){return!(Math.abs((0,s.m)(t,e))>n)&&((0,s.b)(r,e,t),(0,s.n)(r,r),(0,s.b)(i,r,e),(0,s.n)(i,i),!0)}function oe(e,t,r,i,n,s,o){return se(e,t,n,s,o)||se(e,r,n,s,o)||se(e,i,n,s,o)}const ae=.99619469809,le=(0,a.vt)()},9612:(e,t,r)=>{"use strict";r.d(t,{p:()=>i});r(51799);function i(e){return null!=e.mapPositions}},97583:(e,t,r)=>{"use strict";r.d(t,{g:()=>y});r(81806);var i=r(90632),n=r(20664),s=r(9392),o=r(55855),a=r(45308),l=r(50468),c=r(87634),u=r(51799),h=r(75507),d=r(37046),p=r(67737),f=r(66470),m=r(8918),g=r(425);class y{constructor(e){this._originSR=e,this._rootOriginId="root/"+(0,i.c)(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=p.Q.rootOrigin;if(null!=t)return this._origins.set(this._rootOriginId,(0,h.f)(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const r=(0,h.f)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,r),r}const r=this._gridSize,i=Math.round(e[0]/r),s=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${i}/${s}/${o}`;let l=this._origins.get(a);const c=.5*r;if((0,n.f)(_,e,t.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),_[0]<c&&_[1]<c&&_[2]<c){if(l){const t=Math.max(..._);if((0,n.f)(_,e,l.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),Math.max(..._)<t)return l}return t}return l||(l=(0,h.f)(i*r,s*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,o.fA)(1,1,0,1);const r=window.view,i=r._stage,n=t.toString();if(!this._objects.has(n)){this._material=new g.W({width:2,color:t}),i.add(this._material);const e=new m.x(i,{pickable:!1}),r=new d.B({castShadow:!1});i.add(r),e.add(r),this._objects.set(n,r)}const s=this._objects.get(n),h=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=h.length,y=new Array(3*p),_=new Array,v=.5*this._gridSize;for(let o=0;o<p;o++)y[3*o]=e[0]+(1&h[o]?v:-v),y[3*o+1]=e[1]+(2&h[o]?v:-v),y[3*o+2]=e[2]+(4&h[o]?v:-v),o>0&&_.push(o-1,o);(0,a.projectBuffer)(y,this._originSR,0,y,r.renderSpatialReference,0,p);const b=new u.V(this._material,[[f.r.POSITION,new l.n(y,_,3,!0)]],null,c.X.Line);i.add(b),s.addGeometry(b)}get test(){}}const _=(0,s.vt)()},29808:(e,t,r)=>{"use strict";r.d(t,{G7:()=>x,TH:()=>m,hz:()=>_});var i=r(34761),n=r(13191),s=r(20664),o=r(9392),a=r(43047),l=r(55855),c=r(95925),u=r(64465),h=r(3112),d=r(35737),p=r(46571),f=r(97974);const m=1e-5;class g{constructor(e){this.options=new h.H6,this._results=new v,this.transform=new f.dg,this.tolerance=m,this.verticalOffset=null,this._ray=(0,c.vt)(),this._rayEnd=(0,o.vt)(),this._rayBeginTransformed=(0,o.vt)(),this._rayEndTransformed=(0,o.vt)(),this.viewingMode=e??u.RT.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,r){this.resetWithRay((0,c.Cr)(e,t,this._ray),r)}resetWithRay(e,t){this.camera=t,e!==this._ray&&(0,c.C)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===u.RT.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,s.g)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;this.point=t,this.filterPredicate=i,this.tolerance=r??m;const s=(0,f.ou)(this.verticalOffset);if(e&&e.length>0){const t=n?e=>{n(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const r of e){const e=r.getSpatialQueryAccelerator?.();null!=e?(null!=s?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,s):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):r.objects.forAll((e=>t(e)))}}this.sortResults()}intersectObject(e){const t=e.geometries;if(!t)return;const r=e.effectiveTransformation,i=(0,f.ou)(this.verticalOffset);for(const o of t){if(!o.visible)continue;const{material:t,id:a}=o;this.transform.setAndInvalidateLazyTransforms(r,o.transformation),(0,s.h)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,s.h)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;null!=i&&(i.objectTransform=this.transform),t.intersect(o,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((t,r,i,s,o,c)=>{if(t>=0){if(null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const u=s?this._results.hud:this._results,p=s?s=>{const l=new d.B$(e,a,i,c);s.set(h.dz.HUD,l,t,r,n.zK,o)}:n=>n.set(h.dz.OBJECT,{object:e,geometryId:a,triangleNr:i},t,r,l,o);if((null==u.min.drapedLayerOrder||o>=u.min.drapedLayerOrder)&&(null==u.min.dist||t<u.min.dist)&&p(u.min),this.options.store!==h.oH.MIN&&(null==u.max.drapedLayerOrder||o<u.max.drapedLayerOrder)&&(null==u.max.dist||t>u.max.dist)&&p(u.max),this.options.store===h.oH.ALL)if(s){const e=new w(this._ray);p(e),this._results.hud.all.push(e)}else{const e=new b(this._ray);p(e),this._results.all.push(e)}}}))}}sortResults(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._results.all).sort(((e,t)=>e.dist!==t.dist?(e.dist??0)-(t.dist??0):e.drapedLayerOrder!==t.drapedLayerOrder?y(e.drapedLayerOrder,t.drapedLayerOrder):y(e.drapedLayerGraphicOrder,t.drapedLayerGraphicOrder)))}}function y(e,t){return(t??-Number.MAX_VALUE)-(e??-Number.MAX_VALUE)}function _(e){return new g(e)}class v{constructor(){this.min=new b((0,c.vt)()),this.max=new b((0,c.vt)()),this.hud={min:new w((0,c.vt)()),max:new w((0,c.vt)()),all:new Array},this.ground=new b((0,c.vt)()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}class b{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?((0,s.j)(S,this.ray.direction,this.dist),(0,s.l)(S)):null}getIntersectionPoint(e){return!!(0,p.i3)(this)&&((0,s.j)(S,this.ray.direction,this.dist),(0,s.g)(e,this.ray.origin,S),!0)}getTransformedNormal(e){return(0,s.c)(T,this.normal),T[3]=0,(0,a.t)(T,T,this.transformation),(0,s.c)(e,T),(0,s.n)(e,e)}constructor(e){this.intersector=h.dz.OBJECT,this.normal=(0,o.vt)(),this.transformation=(0,n.vt)(),this._ray=(0,c.vt)(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=h.dz.OBJECT,(0,c.C)(e,this._ray)}set(e,t,r,a,l,c,u){this.intersector=e,this.dist=r,(0,s.c)(this.normal,a??o.Cb),(0,i.C)(this.transformation,l??n.zK),this.target=t,this.drapedLayerOrder=c,this.drapedLayerGraphicOrder=u}copy(e){(0,c.C)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,s.c)(this.normal,e.normal),(0,i.C)(this.transformation,e.transformation)}}class w extends b{constructor(){super(...arguments),this.intersector=h.dz.HUD}}function x(e){return new b(e)}const S=(0,o.vt)(),T=(0,l.vt)()},3112:(e,t,r)=>{"use strict";var i,n;r.d(t,{H6:()=>s,dz:()=>i,oH:()=>n}),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL",e[e.TILES3D=8]="TILES3D"}(i||(i={}));class s{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=n.ALL,this.normalRequired=!0}}!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(n||(n={}))},35737:(e,t,r)=>{"use strict";r.d(t,{B$:()=>s,HE:()=>o,R6:()=>a});var i=r(9392);class n{constructor(e,t,r){this.object=e,this.geometryId=t,this.triangleNr=r}}class s extends n{constructor(e,t,r,n){super(e,t,r),this.center=null!=n?(0,i.o8)(n):null}}class o{constructor(e){this.layerUid=e}}class a extends o{constructor(e,t){super(e),this.graphicUid=t}}},75507:(e,t,r)=>{"use strict";r.d(t,{f:()=>s});var i=r(9392);class n{constructor(e,t){this.vec3=e,this.id=t}}function s(e,t,r,s){return new n((0,i.fA)(e,t,r),s)}},45463:(e,t,r)=>{"use strict";r.d(t,{im:()=>d,m$:()=>i,qA:()=>f,sP:()=>p});var i,n=r(9392),s=r(64839),o=r(72085),a=r(83490),l=r(73146),c=r(87634),u=r(32119),h=r(99362);class d extends l.J{constructor(e,t){super(),this.type=c.X.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=u.D,this._pp0=(0,n.fA)(0,0,1),this._pp1=(0,n.fA)(0,0,0),this._parameters=(0,h.qu)(e,t),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,h.MB)(this._parameters,e)&&(this.validateParameters(this._parameters),t&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bindParameters.decorations===a.ID.ON)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository?.materialChanged(this)}queryRenderOccludedState(e){return this.isVisible()&&this.parameters.renderOccluded===e}intersectDraped(e,t,r,i,n,s){return this._pp0[0]=this._pp1[0]=i[0],this._pp0[1]=this._pp1[1]=i[1],this.intersect(e,t,r,this._pp0,this._pp1,n)}}class p extends o.H{constructor(e,t,r){super(t,r),this.camera=e}}!function(e){e[e.None=0]="None",e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"}(i||(i={}));class f extends s.Y{constructor(){super(...arguments),this.renderOccluded=i.Occlude,this.isDecoration=!1}}},57824:(e,t,r)=>{"use strict";var i,n;r.d(t,{k:()=>n,q:()=>i}),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(i||(i={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(n||(n={}))},25672:(e,t,r)=>{"use strict";r.d(t,{Tz:()=>c,_l:()=>l,aT:()=>o,fA:()=>a});var i=r(15941),n=r(20664),s=r(9392);r(75002);function o(e,t,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;const o=1/(Math.abs(r)+Math.abs(i)+Math.abs(n)),a=r*o,l=i*o,c=n<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,h=n<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,d=t*s;e[d]=u(c),e[d+1]=u(h)}function a(e){const t=e.length/3,r=new Int16Array(2*t);let i=0;for(let n=0;n<t;++n)o(r,n,e[i++],e[i++],e[i++]);return r}function l(e,t){const r=e.length/3,i=new Int16Array(2*r);let a=0;const l=(0,s.vt)();for(let s=0;s<r;++s)l[0]=e[a++],l[1]=e[a++],l[2]=e[a++],(0,n.t)(l,l,t),o(i,s,l[0],l[1],l[2]);return i}function c(e,t,r){const i=r*(arguments.length>3&&void 0!==arguments[3]?arguments[3]:2),s=h(t[i]),o=h(t[i+1]),a=1-Math.abs(s)-Math.abs(o);e[2]=a,a<0?(e[0]=(s>=0?1:-1)*(1-Math.abs(o)),e[1]=(o>=0?1:-1)*(1-Math.abs(s))):(e[0]=s,e[1]=o),(0,n.n)(e,e)}function u(e){return(0,i.qE)(Math.round(32767*e),-32767,32767)}function h(e){return(0,i.qE)(e/32767,-1,1)}},37046:(e,t,r)=>{"use strict";r.d(t,{B:()=>g});r(81806);var i=r(34761),n=r(13191),s=r(20664),o=r(9392),a=r(93582),l=r(94966),c=r(83490),u=r(73146),h=r(87634),d=r(35416),p=r(86994),f=r(66470),m=r(68967);class g extends u.J{get geometries(){return this._geometries}get transformation(){return this._transformation??n.zK}set transformation(e){this._transformation=(0,i.C)(this._transformation??(0,n.vt)(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?(0,i.C)(this._shaderTransformation??(0,n.vt)(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.type=h.X.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new y),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){(0,p.vA)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const t=this._geometries.splice(e,1)[0];t&&(this._emit("geometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._emit("attributesChanged",{object:this,geometry:e,attribute:t,sync:r}),(0,f.b)(t)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometries)e.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new d.X(c.Mg.MaskOccludee);for(const t of this._geometries)t.occludees=(0,m.Ci)(t.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometries)t.occludees=(0,m.PC)(t.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new d.X(c.Mg.Highlight);for(const t of this._geometries)t.highlights=(0,m.Ci)(t.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometries)t.highlights=(0,m.PC)(t.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return(0,i.lw)(t,this.transformation,e.transformation)}getCombinedShaderTransformation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,n.vt)();return(0,i.lw)(t,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new _,this._validateBoundingVolume(this._bvWorldSpace,T.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new _,this._validateBoundingVolume(this._bvObjectSpace,T.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,t){const r=t===T.ObjectSpace;for(const i of this._geometries){const t=i.boundingInfo;t&&v(t,e,r?i.transformation:this.getCombinedShaderTransformation(i))}(0,s.o)((0,a.g)(e.bounds),e.min,e.max,.5);for(const i of this._geometries){const t=i.boundingInfo;if(null==t)continue;const n=r?i.transformation:this.getCombinedShaderTransformation(i),o=(0,l.hG)(n);(0,s.h)(S,t.center,n);const c=(0,s.p)(S,(0,a.g)(e.bounds)),u=t.radius*o;e.bounds[3]=Math.max(e.bounds[3],c+u)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,t){this._parentLayer&&this._parentLayer.events.emit(e,t)}get test(){}}class y{constructor(){this.min=(0,o.fA)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,o.fA)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class _ extends y{constructor(){super(...arguments),this.bounds=(0,a.c)()}}function v(e,t,r){const n=e.bbMin,o=e.bbMax;if((0,i.tZ)(r)){const e=(0,s.s)(b,r[12],r[13],r[14]);(0,s.g)(w,n,e),(0,s.g)(x,o,e);for(let r=0;r<3;++r)t.min[r]=Math.min(t.min[r],w[r]),t.max[r]=Math.max(t.max[r],x[r])}else if((0,s.h)(w,n,r),(0,s.e)(n,o))for(let i=0;i<3;++i)t.min[i]=Math.min(t.min[i],w[i]),t.max[i]=Math.max(t.max[i],w[i]);else{(0,s.h)(x,o,r);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],w[e],x[e]),t.max[e]=Math.max(t.max[e],w[e],x[e]);for(let e=0;e<3;++e){(0,s.c)(w,n),(0,s.c)(x,o),w[e]=o[e],x[e]=n[e],(0,s.h)(w,w,r),(0,s.h)(x,x,r);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],w[e],x[e]),t.max[e]=Math.max(t.max[e],w[e],x[e])}}}const b=(0,o.vt)(),w=(0,o.vt)(),x=(0,o.vt)(),S=(0,o.vt)();var T;!function(e){e[e.WorldSpace=0]="WorldSpace",e[e.ObjectSpace=1]="ObjectSpace"}(T||(T={}))},35416:(e,t,r)=>{"use strict";r.d(t,{X:()=>n});var i=r(90632);class n{constructor(e){this.channel=e,this.id=(0,i.c)()}}},94536:(e,t,r)=>{"use strict";r.d(t,{A:()=>B});var i=r(3789),n=r(30015),s=r(20664),o=r(9392),a=r(4763),l=r(95925),c=r(93582),u=r(86994);class h{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,t){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new d,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}destroy(){this._degenerateObjects.clear(),d.clearPool(),E[0]=null,L.prune(),U.prune()}add(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;this._objectCount+=t,this._grow(e,t);const r=d.acquire();for(let i=0;i<t;i++){const t=e[i];this._isDegenerate(t)?this._degenerateObjects.add(t):(r.init(this._root),this._add(t,r))}d.release(r)}remove(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._objectCount-=e.length;const r=d.acquire();for(const i of e){const e=t??(0,c.a)(this.objectToBoundingSphere(i),N);T(e[3])?(r.init(this._root),m(i,e,r)):this._degenerateObjects.delete(i)}d.release(r),this._shrink()}update(e,t){if(!T(t[3])&&this._isDegenerate(e))return;const r=function(e){return E[0]=e,E}(e);this.remove(r,t),this.add(r)}forEachAlongRay(e,t,r){const i=(0,l.LV)(e,t);p(this._root,(e=>{if(!function(e,t){return b((0,c.g)(t.bounds),2*-t.halfSize,O),b((0,c.g)(t.bounds),2*t.halfSize,I),(0,u.O_)(e.origin,e.direction,O,I)}(i,e))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObject(i,e)&&r(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObject(i,e)&&r(e)})),!0}))}forEachAlongRayWithVerticalOffset(e,t,r,i){const n=(0,l.LV)(e,t);p(this._root,(e=>{if(!function(e,t,r){return b((0,c.g)(t.bounds),2*-t.halfSize,O),b((0,c.g)(t.bounds),2*t.halfSize,I),r.applyToMinMax(O,I),(0,u.O_)(e.origin,e.direction,O,I)}(n,e,i))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObjectWithOffset(n,e,i)&&r(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObjectWithOffset(n,e,i)&&r(e)})),!0}))}forEach(e){p(this._root,(t=>{const r=t.node;return r.terminals.forAll(e),null!==r.residents&&r.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>!0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,o=1/0,l=1/0,u=null;const h=x(e,t),d=s=>{if(--n,!i(s))return;const h=this.objectToBoundingSphere(s);if(!(0,a.m7)(r,h))return;const d=S(e,t,(0,c.g)(h)),p=d-h[3],f=d+h[3];p<o&&(o=p,l=f,u=s)};return f(this._root,(i=>{if(n<=0||!(0,a.m7)(r,i.bounds))return!1;if((0,s.j)(P,h,i.halfSize),(0,s.g)(P,P,(0,c.g)(i.bounds)),S(e,t,P)>l)return!1;const o=i.node;return o.terminals.forAll((e=>d(e))),null!==o.residents&&o.residents.forAll((e=>d(e))),!0}),e,t),u}forEachInDepthRange(e,t,r,i,n,o,l){let u=-1/0,d=1/0;const p={setRange:e=>{r===h.DepthOrder.FRONT_TO_BACK?(u=Math.max(u,e.near),d=Math.min(d,e.far)):(u=Math.max(u,-e.far),d=Math.min(d,-e.near))}};p.setRange(i);const m=S(t,r,e),g=x(t,r),y=x(t,-r),_=e=>{if(!l(e))return;const i=this.objectToBoundingSphere(e),s=(0,c.g)(i),h=S(t,r,s)-m,f=h-i[3],g=h+i[3];f>d||g<u||!(0,a.m7)(o,i)||n(e,p)};f(this._root,(e=>{if(!(0,a.m7)(o,e.bounds))return!1;if((0,s.j)(P,g,e.halfSize),(0,s.g)(P,P,(0,c.g)(e.bounds)),S(t,r,P)-m>d)return!1;if((0,s.j)(P,y,e.halfSize),(0,s.g)(P,P,(0,c.g)(e.bounds)),S(t,r,P)-m<u)return!1;const i=e.node;return i.terminals.forAll((e=>_(e))),null!==i.residents&&i.residents.forAll((e=>_(e))),!0}),t,r)}forEachNode(e){p(this._root,(t=>e(t.node,t.bounds,t.halfSize,t.depth)))}forEachNeighbor(e,t){const r=(0,c.b)(t),i=(0,c.g)(t),n=t=>{const n=this.objectToBoundingSphere(t),o=(0,c.b)(n),a=r+o;return!((0,s.a)((0,c.g)(n),i)-a*a<=0)||e(t)};let o=!0;const a=e=>{o&&(o=n(e))};p(this._root,(e=>{const t=(0,c.b)(e.bounds),n=r+t;if((0,s.a)((0,c.g)(e.bounds),i)-n*n>0)return!1;const l=e.node;return l.terminals.forAll(a),o&&null!==l.residents&&l.residents.forAll(a),o})),o&&this.forEachDegenerateObject(a)}_intersectsObject(e,t){const r=this.objectToBoundingSphere(t);return!(r[3]>0)||(0,c.j)(r,e)}_intersectsObjectWithOffset(e,t,r){const i=this.objectToBoundingSphere(t);return!(i[3]>0)||(0,c.j)(r.applyToBoundingSphere(i),e)}_add(e,t){t.advanceTo(this.objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let r=0;r<t.length;r++){const i=d.acquire().init(e);this._add(t.at(r),i),d.release(i)}}_grow(e,t){if(0!==t&&(w(e,t,(e=>this.objectToBoundingSphere(e)),D),T(D[3])&&!this._fitsInsideTree(D)))if(y(this._root.node))(0,c.a)(D,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const e=this._rootBoundsForRootAsSubNode(D);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(D,e):this._growRootAsSubNode(e),d.release(e)}}_rebuildTree(e,t){(0,s.c)((0,c.g)(F),(0,c.g)(t.bounds)),F[3]=t.halfSize,w([e,F],2,(e=>e),k);const r=d.acquire().init(this._root);this._root.initFrom(null,k,k[3]),this._root.increaseHalfSize(1.25),p(r,(e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0))),d.release(r)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return p(this._root,(e=>(r=Math.max(r,e.depth),r+t<=this._maximumDepth))),r+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],r=e;let i=-1/0;const n=this._root.bounds,s=this._root.halfSize;for(let a=0;a<3;a++){const e=n[a]-s-(r[a]-t),o=r[a]+t-(n[a]+s),l=Math.max(0,Math.ceil(e/(2*s))),c=Math.max(0,Math.ceil(o/(2*s)))+1,u=2**Math.ceil(Math.log(l+c)*Math.LOG2E);i=Math.max(i,u),z[a].min=l,z[a].max=c}for(let a=0;a<3;a++){let e=z[a].min,t=z[a].max;const r=(i-(e+t))/2;e+=Math.ceil(r),t+=Math.floor(r);const o=n[a]-s-e*s*2;R[a]=o+(t+e)*s}const o=i*s;return R[3]=o*C,d.acquire().initFrom(null,R,o,0)}_growRootAsSubNode(e){const t=this._root.node;(0,s.c)((0,c.g)(D),(0,c.g)(this._root.bounds)),D[3]=this._root.halfSize,this._root.init(e),e.advanceTo(D,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let r=0,i=0;for(;i<t.length&&null==e;)r=i++,e=t[r];for(;i<t.length;)if(t[i++])return-1;return r}_isDegenerate(e){return!T(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=t[0]-r&&e[0]<=t[0]+r&&e[1]>=t[1]-r&&e[1]<=t[1]+r&&e[2]>=t[2]-r&&e[2]<=t[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:t,_objectCount:r}=this,i=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:t,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:i}}}_nodeToJSON(e){const t=e.children.map((e=>e?this._nodeToJSON(e):null)),r=e.residents?.map((e=>this.objectToBoundingSphere(e))),i=e.terminals?.map((e=>this.objectToBoundingSphere(e)));return{children:t,residents:r,terminals:i}}static fromJSON(e){const t=new h((e=>e),{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return t._objectCount=e.objectCount,t._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),t}}class d{constructor(){this.bounds=(0,c.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.depth;return this.node=null!=e?e:d.createEmptyNode(),t&&(0,c.a)(t,this.bounds),this.halfSize=r,this.depth=i,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*C}advance(e){let t=this.node.children[e];t||(t=d.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const r=M[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!r)return t&&t(this,-1),!1;this.node.residents=null}const i=this._childIndex(e);t&&t(this,i),this.advance(i)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new n.A({shrink:!0}),residents:new n.A({shrink:!0})}}static acquire(){return d._pool.acquire()}static release(e){d._pool.release(e)}static clearPool(){d._pool.prune()}}function p(e,t){let r=d.acquire().init(e);const i=[r];for(;0!==i.length;){if(r=i.pop(),t(r)&&!r.isLeaf())for(let e=0;e<r.node.children.length;e++)r.node.children[e]&&i.push(d.acquire().init(r).advance(e));d.release(r)}}function f(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.DepthOrder.FRONT_TO_BACK,n=d.acquire().init(e);const s=[n];for(function(e,t,r){if(!U.length)for(let i=0;i<8;++i)U.push({index:0,distance:0});for(let i=0;i<8;++i){const r=M[i];U.data[i].index=i,U.data[i].distance=S(e,t,r)}U.sort(((e,t)=>e.distance-t.distance));for(let i=0;i<8;++i)r[i]=U.data[i].index}(r,i,V);0!==s.length;){if(n=s.pop(),t(n)&&!n.isLeaf())for(let e=7;e>=0;--e){const t=V[e];n.node.children[t]&&s.push(d.acquire().init(n).advance(t))}d.release(n)}}function m(e,t,r){L.clear();const i=r.advanceTo(t,((e,t)=>{L.push(e.node),L.push(t)}))?r.node.terminals:r.node.residents;if(i.removeUnordered(e),0===i.length)for(let n=L.length-2;n>=0&&g(L.data[n],L.data[n+1]);n-=2);}function g(e,t){return t>=0&&(e.children[t]=null),!!y(e)&&(null===e.residents&&(e.residents=new n.A({shrink:!0})),!0)}function y(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}function _(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function v(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function b(e,t,r){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function w(e,t,r,i){if(1===t){const t=r(e[0]);(0,c.a)(t,i)}else{O[0]=1/0,O[1]=1/0,O[2]=1/0,I[0]=-1/0,I[1]=-1/0,I[2]=-1/0;for(let i=0;i<t;i++){const t=r(e[i]);T(t[3])&&(_(O,t),v(I,t))}(0,s.o)((0,c.g)(i),O,I,.5),i[3]=Math.max(I[0]-O[0],I[1]-O[1],I[2]-O[2])/2}}function x(e,t){let r,i=1/0;for(let n=0;n<8;++n){const s=S(e,t,A[n]);s<i&&(i=s,r=A[n])}return r}function S(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}function T(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}d._pool=new i.A(d),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(h||(h={}));const M=[(0,o.fA)(-1,-1,-1),(0,o.fA)(1,-1,-1),(0,o.fA)(-1,1,-1),(0,o.fA)(1,1,-1),(0,o.fA)(-1,-1,1),(0,o.fA)(1,-1,1),(0,o.fA)(-1,1,1),(0,o.fA)(1,1,1)],A=[(0,o.fA)(-1,-1,-1),(0,o.fA)(-1,-1,1),(0,o.fA)(-1,1,-1),(0,o.fA)(-1,1,1),(0,o.fA)(1,-1,-1),(0,o.fA)(1,-1,1),(0,o.fA)(1,1,-1),(0,o.fA)(1,1,1)],C=Math.sqrt(3),E=[null];const R=(0,c.c)(),P=(0,o.vt)(),O=(0,o.vt)(),I=(0,o.vt)(),L=new n.A,N=(0,c.c)(),D=(0,c.c)(),F=(0,c.c)(),k=(0,c.c)(),z=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],U=new n.A,V=[0,0,0,0,0,0,0,0],B=h},60322:(e,t,r)=>{"use strict";r.d(t,{K_:()=>p,SE:()=>h,V0:()=>o,XO:()=>c,aB:()=>d,cl:()=>f,ez:()=>l,xt:()=>u});var i=r(10773),n=r(93345),s=r(57162);const o=(0,s.p3)(n.dn.SRC_ALPHA,n.dn.ONE,n.dn.ONE_MINUS_SRC_ALPHA,n.dn.ONE_MINUS_SRC_ALPHA),a=(0,s.p3)(n.dn.ONE,n.dn.ZERO,n.dn.ONE,n.dn.ONE_MINUS_SRC_ALPHA);function l(e){return e===i.y.FrontFace?null:a}function c(e){return e===i.y.FrontFace?s.kn:null}const u=5e5,h={factor:-1,units:-2};function d(e){return e?h:null}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.MT.LESS;return e===i.y.NONE||e===i.y.FrontFace?t:n.MT.LEQUAL}function f(e){return e===i.y.ColorAlpha?{buffers:[n.Nm.COLOR_ATTACHMENT0,n.Nm.COLOR_ATTACHMENT1]}:null}},28584:(e,t,r)=>{"use strict";r.d(t,{B:()=>s});var i=r(30015),n=r(61678);class s{constructor(e,t,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new i.A({deallocator:null}),this._glProgram=e.programCache.acquire(t.generate("vertex"),t.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=t.generateBindPass(this),this.bindDraw=t.generateBindDraw(this),this._fragmentUniforms=(0,n.en)()?t.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,t){this._glProgram.setUniform1i(e,t?1:0)}setUniform1i(e,t){this._glProgram.setUniform1i(e,t)}setUniform1f(e,t){this._glProgram.setUniform1f(e,t)}setUniform2fv(e,t){this._glProgram.setUniform2fv(e,t)}setUniform3fv(e,t){this._glProgram.setUniform3fv(e,t)}setUniform4fv(e,t){this._glProgram.setUniform4fv(e,t)}setUniformMatrix3fv(e,t){this._glProgram.setUniformMatrix3fv(e,t)}setUniformMatrix4fv(e,t){this._glProgram.setUniformMatrix4fv(e,t)}setUniform1fv(e,t){this._glProgram.setUniform1fv(e,t)}setUniform1iv(e,t){this._glProgram.setUniform1iv(e,t)}setUniform2iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform3iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform4iv(e,t){this._glProgram.setUniform4iv(e,t)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(null==t?.glName){const t=this._textures.get(e);return t&&(this._context.bindTexture(null,t.unit),this._freeTextureUnit(t),this._textures.delete(e)),null}let r=this._textures.get(e);return null==r?(r=this._allocTextureUnit(t),this._textures.set(e,r)):r.texture=t,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(t,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)})),this._fragmentUniforms?.forEach((e=>{"sampler2D"!==e.type&&"samplerCube"!==e.type||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)}))}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}},48168:(e,t,r)=>{"use strict";r.d(t,{JG:()=>c,OO:()=>A,Uy:()=>h,Wb:()=>C,Z$:()=>m,d2:()=>E,h7:()=>g,zW:()=>y});var i=r(20664),n=r(9392),s=r(42294),o=r(87634),a=r(86994),l=r(66470);class c{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.isVerticalRay=e,this.normalRequired=t}}const u=(0,s.vt)();function h(e,t,r,n,s,u){if(!e.visible)return;const h=(0,i.z)(O,n,r),d=(e,t,r)=>{u(e,r,t,!1)},f=new c(!1,t.options.normalRequired);if(e.boundingInfo){(0,a.vA)(e.type===o.X.Mesh);const i=t.tolerance;p(e.boundingInfo,r,h,i,s,f,d)}else{const t=e.attributes.get(l.r.POSITION),i=t.indices;_(r,h,0,i.length/3,i,t.data,t.stride,s,f,d)}}const d=(0,n.vt)();function p(e,t,r,n,o,a,l){if(null==e)return;const c=function(e,t){return(0,i.s)(t,1/e[0],1/e[1],1/e[2])}(r,d);if((0,s.Ne)(u,e.bbMin),(0,s.vI)(u,e.bbMax),null!=o&&o.applyToAabb(u),C(u,t,c,n)){const{primitiveIndices:i,position:s}=e,c=i?i.length:s.indices.length/3;if(c>R){const i=e.getChildren();if(void 0!==i){for(const e of i)p(e,t,r,n,o,a,l);return}}!function(e,t,r,i,n,s,o,a,l,c,u){const h=e[0],d=e[1],p=e[2],m=t[0],g=t[1],y=t[2],{normalRequired:_}=c;for(let v=r;v<i;++v){const e=a[v],t=3*e,r=o*n[t];let i=s[r],c=s[r+1],b=s[r+2];const w=o*n[t+1];let S=s[w],T=s[w+1],M=s[w+2];const A=o*n[t+2];let C=s[A],E=s[A+1],R=s[A+2];null!=l&&([i,c,b]=l.applyToVertex(i,c,b,v),[S,T,M]=l.applyToVertex(S,T,M,v),[C,E,R]=l.applyToVertex(C,E,R,v));const O=S-i,I=T-c,L=M-b,N=C-i,D=E-c,F=R-b,k=g*F-D*y,z=y*N-F*m,U=m*D-N*g,V=O*k+I*z+L*U;if(Math.abs(V)<=P)continue;const B=h-i,j=d-c,H=p-b,G=B*k+j*z+H*U;if(V>0){if(G<0||G>V)continue}else if(G>0||G<V)continue;const Z=j*L-I*H,$=H*O-L*B,q=B*I-O*j,W=m*Z+g*$+y*q;if(V>0){if(W<0||G+W>V)continue}else if(W>0||G+W<V)continue;const Y=(N*Z+D*$+F*q)/V;Y>=0&&u(Y,e,_?x(O,I,L,N,D,F,f):null)}}(t,r,0,c,s.indices,s.data,s.stride,i,o,a,l)}}const f=(0,n.vt)();function m(e,t,r,n,s,o,a,l,c){const{data:u,stride:h}=o;_(e,(0,i.z)(O,t,e),r,n,s,u,h,a,l,c)}function g(e,t,r,i,n,s,o,a,l){let c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;const h=e[0],d=e[1],p=e[2],m=t[0],g=t[1],y=t[2];for(let _=r;_<i;++_){const e=u+(c?c[_]:_),t=3*e,r=o*n[t],i=s[r],v=s[r+1],b=s[r+2],w=o*n[t+1],S=s[w],T=s[w+1],M=s[w+2],A=o*n[t+2],C=S-i,E=T-v,R=M-b,O=s[A]-i,I=s[A+1]-v,L=s[A+2]-b,N=g*L-I*y,D=y*O-L*m,F=m*I-O*g,k=C*N+E*D+R*F;if(Math.abs(k)<=P)continue;const z=h-i,U=d-v,V=p-b,B=z*N+U*D+V*F;if(k>0){if(B<0||B>k)continue}else if(B>0||B<k)continue;const j=U*R-E*V,H=V*C-R*z,G=z*E-C*U,Z=m*j+g*H+y*G;if(k>0){if(Z<0||B+Z>k)continue}else if(Z>0||B+Z<k)continue;const $=(O*j+I*H+L*G)/k;$>=0&&l($,e,a?x(C,E,R,O,I,L,f):null)}}function y(e,t,r,i,n,s,o,a,l,c,u){let h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0;const p=e[0],m=e[1],g=e[2],y=t[0],_=t[1],v=t[2];for(let b=r;b<i;++b){const e=d+(h?h[b]:b),t=3*e,r=o*n[t],i=s[r],w=s[r+1],S=s[r+2],T=o*n[t+1],M=s[T],A=s[T+1],C=s[T+2],E=o*n[t+2],R=s[E],O=s[E+1],I=s[E+2],L=S-l,N=a/Math.sqrt(i*i+w*w+L*L),D=i+i*N,F=w+w*N,k=S+L*N,z=C-l,U=a/Math.sqrt(M*M+A*A+z*z),V=M+M*U,B=A+A*U,j=C+z*U,H=I-l,G=a/Math.sqrt(R*R+O*O+H*H),Z=V-D,$=B-F,q=j-k,W=R+R*G-D,Y=O+O*G-F,X=I+H*G-k,J=_*X-Y*v,K=v*W-X*y,Q=y*Y-W*_,ee=Z*J+$*K+q*Q;if(Math.abs(ee)<=P)continue;const te=p-D,re=m-F,ie=g-k,ne=te*J+re*K+ie*Q;if(ee>0){if(ne<0||ne>ee)continue}else if(ne>0||ne<ee)continue;const se=re*q-$*ie,oe=ie*Z-q*te,ae=te*$-Z*re,le=y*se+_*oe+v*ae;if(ee>0){if(le<0||ne+le>ee)continue}else if(le>0||ne+le<ee)continue;const ce=(W*se+Y*oe+X*ae)/ee;ce>=0&&u(ce,e,c?x(Z,$,q,W,Y,X,f):null)}}function _(e,t,r,n,s,o,a,l,c,u){const h=t,d=I,p=Math.abs(h[0]),f=Math.abs(h[1]),m=Math.abs(h[2]),g=p>=f?p>=m?0:2:f>=m?1:2,y=g,_=h[y]<0?2:1,x=(g+_)%3,T=(g+(3-_))%3,M=h[x]/h[y],A=h[T]/h[y],C=1/h[y],E=v,R=b,P=w,{normalRequired:O}=c;for(let v=r;v<n;++v){const t=3*v,r=a*s[t];(0,i.s)(d[0],o[r+0],o[r+1],o[r+2]);const n=a*s[t+1];(0,i.s)(d[1],o[n+0],o[n+1],o[n+2]);const c=a*s[t+2];(0,i.s)(d[2],o[c+0],o[c+1],o[c+2]),l&&((0,i.c)(d[0],l.applyToVertex(d[0][0],d[0][1],d[0][2],v)),(0,i.c)(d[1],l.applyToVertex(d[1][0],d[1][1],d[1][2],v)),(0,i.c)(d[2],l.applyToVertex(d[2][0],d[2][1],d[2][2],v))),(0,i.z)(E,d[0],e),(0,i.z)(R,d[1],e),(0,i.z)(P,d[2],e);const h=E[x]-M*E[y],p=E[T]-A*E[y],f=R[x]-M*R[y],m=R[T]-A*R[y],g=P[x]-M*P[y],_=P[T]-A*P[y],b=g*m-_*f,w=h*_-p*g,I=f*p-m*h;if((b<0||w<0||I<0)&&(b>0||w>0||I>0))continue;const L=b+w+I;if(0===L)continue;const N=b*(C*E[y])+w*(C*R[y])+I*(C*P[y]);if(N*Math.sign(L)<0)continue;const D=N/L;D>=0&&u(D,v,O?S(d):null)}}const v=(0,n.vt)(),b=(0,n.vt)(),w=(0,n.vt)();function x(e,t,r,n,s,o,a){return(0,i.s)(T,e,t,r),(0,i.s)(M,n,s,o),(0,i.b)(a,T,M),(0,i.n)(a,a),a}function S(e){return(0,i.z)(T,e[1],e[0]),(0,i.z)(M,e[2],e[0]),(0,i.b)(f,T,M),(0,i.n)(f,f),f}const T=(0,n.vt)(),M=(0,n.vt)();function A(e,t,r){return(0,i.s)(r,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function C(e,t,r,i){return E(e,t,r,i,1/0)}function E(e,t,r,i,n){const s=(e[0]-i-t[0])*r[0],o=(e[3]+i-t[0])*r[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(e[1]-i-t[1])*r[1],u=(e[4]+i-t[1])*r[1];if(l=Math.min(l,Math.max(c,u)),l<0)return!1;if(a=Math.max(a,Math.min(c,u)),a>l)return!1;const h=(e[2]-i-t[2])*r[2],d=(e[5]+i-t[2])*r[2];return l=Math.min(l,Math.max(h,d)),!(l<0)&&(a=Math.max(a,Math.min(h,d)),!(a>l)&&a<n)}const R=1e3,P=1e-7,O=(0,n.vt)(),I=[(0,n.vt)(),(0,n.vt)(),(0,n.vt)()]},23187:(e,t,r)=>{"use strict";r.d(t,{AZ:()=>c,Vr:()=>u,gE:()=>l});var i=r(91417),n=r(33062),s=r(34981),o=r(10209),a=r(45463);class l{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.rctx=e,this.sliceHelper=r,this.lastFrameCamera=new n.A,this.output=s.V.Color,this.renderOccludedMask=u,this.bindParameters=new o.k(t,null!=r?r.plane:null),this.bindParameters.alignPixelEnabled=!0}}class c extends l{constructor(e,t,r,n){super(e,r,n),this.offscreenRenderingHelper=t,this.sliceHelper=n,this.time=(0,i.l5)(0)}}const u=a.m$.Occlude|a.m$.OccludeAndTransparent|a.m$.OccludeAndTransparentStencil},71118:(e,t,r)=>{"use strict";r.d(t,{n:()=>i,u:()=>a});var i,n=r(81806),s=r(75941),o=r(98476);function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!(0,n.A)("disable-feature:high-quality-idle"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r=new s.O;return e?(r.set(o.M.IDLE,i.Antialiasing,"low"!==t),r.set(o.M.IDLE,i.HighResolutionAtmosphere,"low"!==t),r.set(o.M.IDLE,i.HighQualityTransparency,!0),r.set(o.M.IDLE,i.SSAO,!0),r.set(o.M.IDLE,i.WaterReflection,!0),r.set(o.M.IDLE,i.PhysicalPixelRendering,!0)):(r.set(o.M.ANIMATING,i.HighResolutionShadows,!0),r.set(o.M.ANIMATING,i.HighResolutionViewshed,!0),r.set(o.M.INTERACTING,i.HighResolutionShadows,!0),r.set(o.M.INTERACTING,i.HighResolutionViewshed,!0)),r.set(o.M.IDLE,i.HighResolutionShadows,!0),r.set(o.M.IDLE,i.HighResolutionViewshed,!0),r.set(o.M.IDLE,i.HighResolutionVoxel,!0),r}!function(e){e[e.Antialiasing=0]="Antialiasing",e[e.HighQualityTransparency=1]="HighQualityTransparency",e[e.HighResolutionVoxel=2]="HighResolutionVoxel",e[e.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",e[e.SSAO=4]="SSAO",e[e.WaterReflection=5]="WaterReflection",e[e.HighResolutionShadows=6]="HighResolutionShadows",e[e.HighResolutionViewshed=7]="HighResolutionViewshed",e[e.PhysicalPixelRendering=8]="PhysicalPixelRendering"}(i||(i={}))},442:(e,t,r)=>{"use strict";r.d(t,{$:()=>c});var i=r(90632),n=r(34761),s=r(13191),o=r(20664),a=r(93582),l=r(94966);class c{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.geometry=e,this.screenToWorldRatio=1,this._transformation=(0,s.vt)(),this._shaderTransformation=null,this._boundingSphere=null,this.id=(0,i.c)(),this.layerUid=t.layerUid,this.graphicUid=t.graphicUid,this.castShadow=t.castShadow??!1,null!=t.objectShaderTransformation&&this.objectShaderTransformationChanged(t.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){(0,n.C)(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){null==e?this._shaderTransformation=null:(this._shaderTransformation??=(0,s.vt)(),(0,n.lw)(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(null==this._boundingSphere&&(this._boundingSphere??=(0,a.c)(),(0,o.h)((0,a.g)(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*(0,l.hG)(this.shaderTransformation)),this._boundingSphere):a.N}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}},77730:(e,t,r)=>{"use strict";var i;r.d(t,{N:()=>i}),function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH",e[e.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH",e[e.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",e[e.OPAQUE_ENVIRONMENT=12]="OPAQUE_ENVIRONMENT",e[e.TRANSPARENT_ENVIRONMENT=13]="TRANSPARENT_ENVIRONMENT",e[e.LASERLINES=14]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=15]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=16]="HUD_MATERIAL",e[e.LABEL_MATERIAL=17]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=18]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=19]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=20]="DRAPED_MATERIAL",e[e.DRAPED_WATER=21]="DRAPED_WATER",e[e.VIEWSHED=22]="VIEWSHED",e[e.VOXEL=23]="VOXEL",e[e.MAX_SLOTS=24]="MAX_SLOTS"}(i||(i={}))},90877:(e,t,r)=>{"use strict";r.d(t,{p:()=>R,z:()=>x});var i=r(81806),n=r(15941),s=r(30726),o=r(44680),a=r(34761),l=r(13191),c=r(19555),u=r(72745),h=r(20664),d=r(9392),p=r(43047),f=r(55855),m=r(64465),g=r(16455),y=r(35143),_=r(46053),v=(r(76460),r(47249),r(85842)),b=r(33062);let w=class extends b.A{constructor(){super(...arguments),this._projectionMatrix=(0,l.vt)()}get projectionMatrix(){return this._projectionMatrix}};(0,y._)([(0,_.MZ)()],w.prototype,"_projectionMatrix",void 0),(0,y._)([(0,_.MZ)({readOnly:!0})],w.prototype,"projectionMatrix",null),w=(0,y._)([(0,v.$)("esri.views.3d.webgl-engine.lib.CascadeCamera")],w);var x,S=r(81330),T=r(86994),M=r(93345),A=r(98433);!function(e){e[e.Highlight=0]="Highlight",e[e.ExcludeHighlight=1]="ExcludeHighlight"}(x||(x={}));class C{constructor(){this.camera=new w,this.lightMat=(0,l.vt)()}}class E{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class R{constructor(e,t){this._fbos=e,this._viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new E,this._projectionView=(0,l.vt)(),this._projectionViewInverse=(0,l.vt)(),this._modelViewLight=(0,l.vt)(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,f.vt)(),this._cascades=[new C,new C,new C,new C],this._lastOrigin=null,this._maxTextureWidth=Math.min((0,i.A)("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,p.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=(0,s.Gz)(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=(0,n.qE)(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let e=0;e<this._numCascades;++e)U[e]=this._cascades[e];return U.length=this._numCascades,U}start(e,t,r,i,n){(0,T.vA)(this.enabled);const{near:s,far:o}=function(e){let{near:t,far:r}=e;return t<2&&(t=2),r<2&&(r=2),t>=r&&(t=2,r=4),{near:t,far:r}}(r);this._computeCascadeDistances(s,o,i),this._textureHeight=this._computeTextureHeight(e,n,i),this._setupMatrices(e,t);const{viewMatrix:a,projectionMatrix:l}=e;for(let c=0;c<this._numCascades;++c)this._constructCascade(c,l,a,t);this._lastOrigin=null,this.clear()}finish(){(0,T.vA)(this.enabled),this._handle?.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!(0,h.e)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,d.vt)(),(0,h.c)(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){(0,a.Tl)(V,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)B[16*t+e]=V[e]}}return B}moveSnapshot(e){(0,T.vA)(this.enabled),this._handle?.detachDepth(),this._snapshots[e]?.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){const t=this._handle?.getTexture()?.descriptor;if(!this.enabled||!t)return;this._snapshots[e]?.release();const{width:r,height:i}=t,n=e===x.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(r,i,n,g.N.RGBA4);const s=this._fbos.rctx;this._bindFbo();const o=s.bindTexture(this._snapshots[e]?.getTexture(),A.g.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(M.Ap.TEXTURE_2D,0,0,0,0,0,r,i),s.bindTexture(o,A.g.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){return this.enabled?this._snapshots[e]?.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(M.hn.COLOR_BUFFER_BIT|M.hn.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,t,r){const i=Math.min(window.devicePixelRatio,t)/e.pixelRatio,n=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,s=(0,S.Mv)(Math.floor(Math.max(e.fullWidth,e.fullHeight)*i*n)),o=Math.min(this._maxTextureWidth,this._numCascades*s);return(0,S.uT)(o/this._numCascades)}_ensureFbo(){this._handle?.fbo?.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",g.N.RGBA4)),this._handle?.acquireDepth(g.z.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=(0,s.Gz)(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._handle?.fbo)}_constructCascade(e,t,r,i){const s=this._cascades[e],o=-this._cascadeDistances[e],l=-this._cascadeDistances[e+1],u=(t[10]*o+t[14])/Math.abs(t[11]*o+t[15]),d=(t[10]*l+t[14])/Math.abs(t[11]*l+t[15]);(0,T.vA)(u<d);for(let n=0;n<8;++n){(0,p.s)(O,n%4==0||n%4==3?-1:1,n%4==0||n%4==1?-1:1,n<4?u:d,1);const e=I[n];(0,p.t)(e,O,this._projectionViewInverse),e[0]/=e[3],e[1]/=e[3],e[2]/=e[3]}(0,h.k)(z,I[0]),s.camera.viewMatrix=(0,a.Tl)(P,this._modelViewLight,z);for(let n=0;n<8;++n)(0,h.h)(I[n],I[n],s.camera.viewMatrix);let f=I[0][2],m=I[0][2];for(let n=1;n<8;++n)f=Math.min(f,I[n][2]),m=Math.max(m,I[n][2]);f-=200,m+=200,s.camera.near=-m,s.camera.far=-f,function(e,t,r,i,s){const o=1/I[0][3],a=1/I[4][3];(0,T.vA)(o<a);let l=o+Math.sqrt(o*a);const u=Math.sin((0,n.XM)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));l/=u,function(e,t,r,i,n,s,o,a){(0,c.hZ)(j,0,0);for(let x=0;x<4;++x)(0,c.WQ)(j,j,e[x]);(0,c.hs)(j,j,.25),(0,c.hZ)(H,0,0);for(let x=4;x<8;++x)(0,c.WQ)(H,H,e[x]);(0,c.hs)(H,H,.25),(0,c.Cc)(G[0],e[4],e[5],.5),(0,c.Cc)(G[1],e[5],e[6],.5),(0,c.Cc)(G[2],e[6],e[7],.5),(0,c.Cc)(G[3],e[7],e[4],.5);let l=0,u=(0,c.hG)(G[0],j);for(let x=1;x<4;++x){const e=(0,c.hG)(G[x],j);e<u&&(u=e,l=x)}(0,c.Re)(Z,G[l],e[l+4]);const h=Z[0];let d,p;Z[0]=-Z[1],Z[1]=h,(0,c.Re)($,H,j),(0,c.Om)($,Z)<0&&(0,c.ze)(Z,Z),(0,c.Cc)(Z,Z,$,r),(0,c.S8)(Z,Z),d=p=(0,c.Om)((0,c.Re)(q,e[0],j),Z);for(let x=1;x<8;++x){const t=(0,c.Om)((0,c.Re)(q,e[x],j),Z);t<d?d=t:t>p&&(p=t)}(0,c.C)(i,j),(0,c.hs)(q,Z,d-t),(0,c.WQ)(i,i,q);let f=-1,m=1,g=0,y=0;for(let x=0;x<8;++x){(0,c.Re)(W,e[x],i),(0,c.S8)(W,W);const t=Z[0]*W[1]-Z[1]*W[0];t>0?t>f&&(f=t,g=x):t<m&&(m=t,y=x)}(0,T.MX)(f>0,"leftArea"),(0,T.MX)(m<0,"rightArea"),(0,c.hs)(Y,Z,d),(0,c.WQ)(Y,Y,j),(0,c.hs)(X,Z,p),(0,c.WQ)(X,X,j),J[0]=-Z[1],J[1]=Z[0];const _=(0,T.L)(i,e[y],X,(0,c.WQ)(q,X,J),1,n),v=(0,T.L)(i,e[g],X,q,1,s),b=(0,T.L)(i,e[g],Y,(0,c.WQ)(q,Y,J),1,o),w=(0,T.L)(i,e[y],Y,q,1,a);(0,T.MX)(_,"rayRay"),(0,T.MX)(v,"rayRay"),(0,T.MX)(b,"rayRay"),(0,T.MX)(w,"rayRay")}(I,l,u,L,N,D,F,k),function(e,t,r,i,n){(0,c.Re)(te,r,i),(0,c.hs)(te,te,.5),re[0]=te[0],re[1]=te[1],re[2]=0,re[3]=te[1],re[4]=-te[0],re[5]=0,re[6]=te[0]*te[0]+te[1]*te[1],re[7]=te[0]*te[1]-te[1]*te[0],re[8]=1,re[K(0,2)]=-(0,c.Om)(ee(re,0),e),re[K(1,2)]=-(0,c.Om)(ee(re,1),e);let s=(0,c.Om)(ee(re,0),r)+re[K(0,2)],o=(0,c.Om)(ee(re,1),r)+re[K(1,2)],a=(0,c.Om)(ee(re,0),i)+re[K(0,2)],l=(0,c.Om)(ee(re,1),i)+re[K(1,2)];s=-(s+a)/(o+l),re[K(0,0)]+=re[K(1,0)]*s,re[K(0,1)]+=re[K(1,1)]*s,re[K(0,2)]+=re[K(1,2)]*s,s=1/((0,c.Om)(ee(re,0),r)+re[K(0,2)]),o=1/((0,c.Om)(ee(re,1),r)+re[K(1,2)]),re[K(0,0)]*=s,re[K(0,1)]*=s,re[K(0,2)]*=s,re[K(1,0)]*=o,re[K(1,1)]*=o,re[K(1,2)]*=o,re[K(2,0)]=re[K(1,0)],re[K(2,1)]=re[K(1,1)],re[K(2,2)]=re[K(1,2)],re[K(1,2)]+=1,s=(0,c.Om)(ee(re,1),t)+re[K(1,2)],o=(0,c.Om)(ee(re,2),t)+re[K(2,2)],a=(0,c.Om)(ee(re,1),r)+re[K(1,2)],l=(0,c.Om)(ee(re,2),r)+re[K(2,2)],s=-.5*(s/o+a/l),re[K(1,0)]+=re[K(2,0)]*s,re[K(1,1)]+=re[K(2,1)]*s,re[K(1,2)]+=re[K(2,2)]*s,s=(0,c.Om)(ee(re,1),t)+re[K(1,2)],o=(0,c.Om)(ee(re,2),t)+re[K(2,2)],a=-o/s,re[K(1,0)]*=a,re[K(1,1)]*=a,re[K(1,2)]*=a,n[0]=re[0],n[1]=re[1],n[2]=0,n[3]=re[2],n[4]=re[3],n[5]=re[4],n[6]=0,n[7]=re[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=re[6],n[13]=re[7],n[14]=0,n[15]=re[8]}(L,N,F,k,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}(r,i,f,m,s.camera),(0,a.lw)(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const g=this._textureHeight;s.camera.viewport=[e*g,0,g,g]}_setupMatrices(e,t){(0,a.lw)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,a.B8)(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===m.RT.Global?e.eye:(0,h.s)(z,0,0,1);(0,a.t5)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],r)}_computeCascadeDistances(e,t,r){const i=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor((0,T.kL)(t/e,4)),i);const s=(t-e)/this._numCascades,o=(t/e)**(1/this._numCascades);let a=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=(0,n.Cc)(a,l,this.settings.splitSchemeLambda),a*=o,l+=s}get test(){}}const P=(0,l.vt)(),O=(0,f.vt)(),I=[];for(let ie=0;ie<8;++ie)I.push((0,f.vt)());const L=(0,u.vt)(),N=(0,u.vt)(),D=(0,u.vt)(),F=(0,u.vt)(),k=(0,u.vt)(),z=(0,d.vt)(),U=[],V=(0,l.vt)(),B=l.zK.concat(l.zK,l.zK,l.zK,l.zK),j=(0,u.vt)(),H=(0,u.vt)(),G=[(0,u.vt)(),(0,u.vt)(),(0,u.vt)(),(0,u.vt)()],Z=(0,u.vt)(),$=(0,u.vt)(),q=(0,u.vt)(),W=(0,u.vt)(),Y=(0,u.vt)(),X=(0,u.vt)(),J=(0,u.vt)();function K(e,t){return 3*t+e}const Q=(0,u.vt)();function ee(e,t){return(0,c.hZ)(Q,e[t],e[t+3]),Q}const te=(0,u.vt)(),re=(0,o.vt)()},76044:(e,t,r)=>{"use strict";r.d(t,{B:()=>w});var i=r(35143),n=r(91967),s=(r(81806),r(87663)),o=r(30015),a=r(46053),l=(r(76460),r(47249),r(85842)),c=r(72745),u=r(93582),h=r(21255),d=r(34981),p=r(63496),f=r(29808),m=r(3112),g=r(45463),y=r(57824),_=r(13840),v=r(77730),b=r(74964);let w=class extends n.A{constructor(e){super(e),this._pending=new x,this._changes=new p.VR,this._materialRenderers=new Map,this._sortedMaterialRenderers=new o.A,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach((e=>e.destroy())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return(0,s.Bs)(this._materialRenderers,(e=>0!==e.numGeometries&&!e.queryRenderOccludedState(g.m$.Occlude)))}get isEmpty(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}getMaterialRenderer(e){return this._materialRenderers.get(e)}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=(0,_.$T)(this._changes);let t=!1;return e.forEach(((e,r)=>{let i=this.getMaterialRenderer(r);if(!i&&e.adds.length>0){const e=new b.y({material:r});e.initializeRenderContext(this.rendererContext.pluginContext,this._materials),i=e,this._materialRenderers.set(r,i),t=!0}i&&(i.modify(e),0===i.numGeometries&&(this._materialRenderers.delete(r),i.destroy(),t=!0))})),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),this._hasHighlights=(0,s.Bs)(this._materialRenderers,(e=>{const t=e.produces.get(v.N.DRAPED_MATERIAL);return!!t&&t(d.V.Highlight)})),this._hasWater=(0,s.Bs)(this._materialRenderers,(e=>{const t=e.produces.get(v.N.DRAPED_WATER);return!!t&&t(d.V.Normal)})),this.notifyChange("updating"),!0}addGeometries(e,t){if(0===e.length)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const i=this._pending.empty;for(const n of r)this._pending.adds.add(n);i&&this.notifyChange("updating"),t===y.q.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const r=this._pending.empty,i=this._pending.adds;for(const n of e)i.has(n)?(this._pending.removed.add(n),i.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);r&&!this._pending.empty&&this.notifyChange("updating"),t===y.q.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const r=0===this._changes.updates.length;for(const i of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(i),e.updateType=t}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case y.k.TRANSFORMATION:case y.k.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case y.k.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll((r=>t=!!r.updateAnimation&&r.updateAnimation(e)||t)),t}shouldRender(e){return this._sortedMaterialRenderers.some((t=>t.prepareTechnique(e)))}render(e){this._sortedMaterialRenderers.forAll((t=>{const r=t.prepareTechnique(e);null!=r&&t.renderNode(e,r)}))}intersect(e,t,r,i,n){return this._geometries.forEach((s=>{if(i&&!i(s))return;this._intersectRenderGeometry(s,r,t,0,e,n);const o=this.rendererContext.longitudeCyclical;o&&(s.boundingSphere[0]-s.boundingSphere[3]<o.min&&this._intersectRenderGeometry(s,r,t,o.range,e,n),s.boundingSphere[0]+s.boundingSphere[3]>o.max&&this._intersectRenderGeometry(s,r,t,-o.range,e,n)),n++})),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;for(const t of this._materialRenderers.values())t.drapedPriority=e++,this._sortedMaterialRenderers.push(t);this._sortedMaterialRenderers.sort(((e,t)=>t.materialReference?.renderPriority===e.materialReference?.renderPriority?e.drapedPriority-t.drapedPriority:(t.materialReference?.renderPriority||0)-(e.materialReference?.renderPriority||0)))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,r,i,n,s){if(!e.visible)return;let o=0;i+=e.transformation[12],o=e.transformation[13],S[0]=r[0]-i,S[1]=r[1]-o,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,S,((r,i,o)=>{!function(e,t,r,i,n,s,o){const a=new h.MQ(s,o,t),l=t=>{t.set(m.dz.OVERLAY,a,e.dist,e.normal,e.transformation,r,i)};if((null==n.results.min.drapedLayerOrder||r>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==m.oH.MIN&&(null==n.results.max.drapedLayerOrder||r<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===m.oH.ALL){const e=(0,f.G7)(n.ray);l(e),n.results.all.push(e)}}(t,o,s,e.material.renderPriority,n,e.layerUid,e.graphicUid)}),t)}_notifyGraphicGeometryChanged(e){if(null==this.drapeSource.notifyGraphicGeometryChanged)return;let t;for(const r of e){const e=r.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicGeometryChanged(e),t=e)}}_notifyGraphicVisibilityChanged(e){if(null==this.drapeSource.notifyGraphicVisibilityChanged)return;let t;for(const r of e){const e=r.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(e),t=e)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return null==e.localOrigin&&(e.localOrigin=this._localOriginFactory.getOrigin((0,u.g)(e.boundingSphere))),e}get test(){}};(0,i._)([(0,a.MZ)()],w.prototype,"drapeSource",void 0),(0,i._)([(0,a.MZ)()],w.prototype,"updating",null),(0,i._)([(0,a.MZ)()],w.prototype,"rctx",null),(0,i._)([(0,a.MZ)({constructOnly:!0})],w.prototype,"rendererContext",void 0),(0,i._)([(0,a.MZ)()],w.prototype,"_materials",null),(0,i._)([(0,a.MZ)()],w.prototype,"_localOriginFactory",null),(0,i._)([(0,a.MZ)({readOnly:!0})],w.prototype,"isEmpty",null),(0,i._)([(0,a.MZ)()],w.prototype,"_materialRenderers",void 0),(0,i._)([(0,a.MZ)()],w.prototype,"_geometries",void 0),w=(0,i._)([(0,l.$)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],w);class x{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const S=(0,c.vt)()},96643:(e,t,r)=>{"use strict";r.d(t,{I$:()=>p,Rv:()=>c,a9:()=>d,m:()=>s,mK:()=>f,qh:()=>h,r8:()=>l,sf:()=>o,ub:()=>u,v0:()=>a});var i=r(83490),n=r(93345);const s={func:n.MT.LESS},o={func:n.MT.ALWAYS},a={mask:255},l={mask:0},c=e=>({function:{func:n.MT.NOTEQUAL,ref:e,mask:e},operation:{fail:n.eA.KEEP,zFail:n.eA.KEEP,zPass:n.eA.KEEP}}),u=e=>({function:{func:n.MT.ALWAYS,ref:e,mask:e},operation:{fail:n.eA.KEEP,zFail:n.eA.KEEP,zPass:n.eA.REPLACE}}),h={function:{func:n.MT.ALWAYS,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:n.eA.KEEP,zFail:n.eA.KEEP,zPass:n.eA.ZERO}},d={function:{func:n.MT.ALWAYS,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:n.eA.KEEP,zFail:n.eA.KEEP,zPass:n.eA.REPLACE}},p={function:{func:n.MT.EQUAL,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:n.eA.KEEP,zFail:n.eA.KEEP,zPass:n.eA.KEEP}},f={function:{func:n.MT.NOTEQUAL,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:n.eA.KEEP,zFail:n.eA.KEEP,zPass:n.eA.KEEP}}},39345:(e,t,r)=>{"use strict";function i(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas}r.d(t,{y:()=>i})},70741:(e,t,r)=>{"use strict";r.d(t,{G:()=>l});var i=r(69539),n=r(85504),s=r(76460),o=r(76931),a=r(55855);class l{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=c(e.color),this.haloStyle=function(e){return`rgb(${e.slice(0,3).map((e=>Math.floor(255*e))).toString()})`}(e.halo.color),this.backgroundStyle=0!==e.background.color[3]?c(e.background.color):null}fontString(e){const t=this.definition.font;return`${t.style} ${t.weight} ${e}px ${t.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(e,t){e.font=this.fontString(t),e.textAlign="left",e.textBaseline="alphabetic"}static async fromSymbol(e,t){const r=e?.material?.color,c=i.A.toUnitRGBA(r)??a.uY,h=null!=e.size?(0,o.Lz)(e.size):12,d=e.lineHeight,p=null!=e.background?i.A.toUnitRGBA(e.background.color):a.uY,f={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"},m=e.halo,g=null!=m?.color&&m.size>0?{size:(0,o.Lz)(m.size),color:i.A.toUnitRGBA(m.color)}:{size:0,color:a.uY},y=new l({color:c,size:h,background:{color:p,padding:null!=e.background?[.65*h,.5*h]:[0,0],borderRadius:null!=e.background?h*(6/16):0},lineSpacingFactor:d,font:f,halo:g,pixelRatio:t});if(e.font){let t=!1;const r=y.fontString(h);try{t=(await document.fonts.load(r)).some((e=>!(0,n.NZ)(e)))}catch(_){s.A.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${r}'. Some text symbology may be rendered using the default browser font.`)}if(!t&&!u.has(e.font.family))try{await(0,n.Al)(e.font)}catch(_){}}return y}}function c(e){return`rgba(${e.slice(0,3).map((e=>Math.floor(255*e))).toString()},${e[3]})`}const u=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"])},42510:(e,t,r)=>{"use strict";r.d(t,{Js:()=>l,Xd:()=>a,lV:()=>u});var i=r(15941),n=r(22955),s=r(48190),o=r(39345);const a=1;class l{constructor(e,t,r,i){this.text=e,this._alignment=t,this._parameters=r,this._maxSize=i,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.replaceAll(" ","\xa0").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let t=0;t<this._lines.length-1;t++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const e=(0,o.y)(h,p,p).getContext("2d"),t=this._parameters.definition.pixelRatio,r=this._fontSize*t;this._parameters.setFontProperties(e,r);let i=2*this._haloSize;const n=this._parameters.definition.font;"italic"!==n.style&&"oblique"!==n.style&&"bold"!==n.weight&&"bolder"!==n.weight||(i+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let a=0,l=0,c=0,u=0,d=0;this._lines.forEach(((r,n)=>{const s=e.measureText(r),o=s.width/t,h=o+i;this._textWidths.push(o),this._lineWidths.push(h),a=Math.max(a,h),u=Math.max(u,s.actualBoundingBoxAscent/t),d=Math.max(d,s.actualBoundingBoxDescent/t),0===n&&(l=s.actualBoundingBoxAscent/t),n===this._lines.length-1&&(c=s.actualBoundingBoxDescent/t)}));const f=(0,s.z)(this._parameters),g=Math.max(u,f.maxAscent),y=Math.max(d,f.maxDescent),_=l,v="underline"===this._parameters.definition.font.decoration?y:c,b=a;this._metricsCached=new m(_,v,g,y,b)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*d}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,a)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(null==this._renderPixelRatio){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case u.Left:return this._horizontalPadding;case u.Center:return(this.displayWidth-this._lineWidths[e])/2;case u.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,t,r){e.save();const i=t/=this.renderPixelRatio,s=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;t+=o,r+=a;const l=this._haloSize>0;l&&this._renderHalo(e,i,s,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let n=0;n<this._lines.length;++n){const i=this._lines[n],s=this._getLineXOffset(n);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,i,t+s,r),this._renderLineDecoration(e,t+s,r,this._textWidths[n])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,i,t+this._getLineXOffset(n),r),this._renderLineDecoration(e,t+s,r,this._textWidths[n]),r+=this._lineSpacing}if(n.b.TEXT_SHOW_BASELINE){e.strokeStyle=f,e.setLineDash([2,2]),e.lineWidth=1;let t=s+a;for(let r=0;r<this._lines.length;++r)this._drawLine(e,[i,t],[i+this.displayWidth,t]),t+=this._lineSpacing}if(n.b.TEXT_SHOW_BORDER&&(e.strokeStyle=f,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[i,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const t=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,i,s,t),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("none"===this._parameters.definition.font.decoration||0===i)return;const s=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case"underline":r+=2*s;break;case"line-through":r-=.33*this._midLineAscent}const o=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(s+2*o),e.beginPath(),e.moveTo(this._toRenderUnit(t-o),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(t+i+o),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,t,r,n){t=this._toRenderUnit(t),r=this._toRenderUnit(r);const s=this.renderedWidth,o=this.renderedHeight;0!==n?(n=(0,i.qE)(n,0,Math.floor(o/2)),e.beginPath(),e.moveTo(t,r+n),e.arcTo(t,r,t+n,r,n),e.lineTo(t+s-n,r),e.arcTo(t+s,r,t+s,r+n,n),e.lineTo(t+s,r+o-n),e.arcTo(t+s,r+o,t+s-n,r+o,n),e.lineTo(t+n,r+o),e.arcTo(t,r+o,t,r+o-n,n),e.closePath()):e.rect(t,r,s,o)}_renderHalo(e,t,r,i,n){const s=this.renderedWidth,a=this.renderedHeight,l=(0,o.y)(h,Math.max(s,p),Math.max(a,p)),c=l.getContext("2d");c.clearRect(0,0,s,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,i,n):this._renderHaloNative(c,i,n);let d=n;for(let o=0;o<this._lines.length;++o){const e=this._getLineXOffset(o);this._renderLineDecoration(c,i+e,d,this._textWidths[o],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,s,a,this._toRenderUnit(t),this._toRenderUnit(r),s,a),e.globalAlpha=1}_renderHaloEmulated(e,t,r){for(let i=0;i<this._lines.length;++i){const n=this._lines[i],s=this._getLineXOffset(i);for(const[i,o]of c)this._fillText(e,n,t+s+this._haloSize*i,r+this._haloSize*o);r+=this._lineSpacing}}_renderHaloNative(e,t,r){const i=2*this._haloSize;for(let n=0;n<this._lines.length;++n){const s=this._lines[n],o=this._getLineXOffset(n),a=5,l=.1;for(let n=0;n<a;n++){const c=1-(a-1)*l+n*l;e.lineWidth=this._toRenderUnit(c*i),this._strokeText(e,s,t+o,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,t,r,i){e.fillText(t,this._toRenderUnit(r),this._toRenderUnit(i))}_strokeText(e,t,r,i){e.strokeText(t,this._toRenderUnit(r),this._toRenderUnit(i))}_drawLine(e,t,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(t[0])+.5,this._toRoundedRenderUnit(t[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,t,r){const i=this._toRenderUnit(t[0]),n=this._toRenderUnit(t[1]),s=this._toRenderUnit(r[0]),o=this._toRenderUnit(r[1]),a=Math.floor(i)+.5,l=Math.ceil(i+s)-.5,c=Math.floor(n)+.5,u=Math.ceil(n+o)-.5;e.beginPath(),e.moveTo(a,c),e.lineTo(l,c),e.lineTo(l,u),e.lineTo(a,u),e.lineTo(a,c),e.stroke()}}const c=[];{const e=16;for(let t=0;t<360;t+=360/e)c.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}var u;!function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"}(u||(u={}));const h={canvas:null},d=.2,p=512,f="rgb(255, 0, 255, 0.5)";class m{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,t,r,i,n){this.firstLineAscent=e,this.lastLineDescent=t,this.maxLineAscent=r,this.maxLineDescent=i,this.displayWidth=n}}},25175:(e,t,r)=>{"use strict";r.d(t,{C:()=>x});var i=r(35143),n=r(91967),s=r(54099),o=(r(81806),r(30726)),a=r(90632),l=r(46053),c=(r(76460),r(47249),r(85842)),u=r(43047),h=r(55855),d=r(87634),p=r(67737),f=r(81330),m=r(66470),g=r(59752),y=r(22856),_=r(93345),v=r(98433),b=r(96673);const w=4096;let x=class extends n.A{constructor(e){super(e),this.type=d.X.Texture,this.id=(0,a.c)(),this.events=new s.A,this._glTexture=null,this._atlas=new C(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=(0,o.WD)(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return R=p.G.stableRendering?T:0,[w-T-R,w-T-R-M]}load(e){if(this._glTexture)return this._glTexture;const t=new b.R;return t.wrapMode=_.pF.CLAMP_TO_EDGE,t.samplingMode=_.Cj.LINEAR_MIPMAP_LINEAR,t.hasMipmap=!0,t.preMultiplyAlpha=!0,t.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new v.g(e,t,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(g.W6.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=(0,o.xt)(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=(0,o.WD)(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.width.toString()),this._canvas.setAttribute("height",e.height.toString())}_resizeAtlas(e,t){const{width:r,height:i}=this._atlas;r===e&&i===t||(this._atlas.width=e,this._atlas.height=t,this._glTexture?.resize(e,t),this._glTexture?.updateData(0,0,0,r,i,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach((e=>{const t=this._stageObjects.get(e.textRenderer.key);t?.forEach((t=>S(t,e)))})),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,t,r,i){const n=this._atlas;if(n.width<r||n.height<i)return!1;let s=n.cursors.get(i);if(!s){if(n.height<n.nextY+i)return!1;s=[new E(n.nextY)],n.cursors.set(i,s),n.nextY+=i}let o=s.find((e=>n.width>=e.x+r));if(null==o){if(n.height<n.nextY+i)return!1;o=new E(n.nextY),n.nextY+=i,s.push(o)}return e.setNewPosition(o),this._elements.set(t,e),this._elementsToRender.set(t,e),o.x+=r,!0}_ensureStageObjects(e){const t=this._stageObjects.get(e);if(t)return t;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const r=this._stageObjects.get(e);r?.delete(t)&&(t.geometries[0].setAttributeData(m.r.SIZE,[0,0]),t.geometryVertexAttributeUpdated(t.geometries[0],m.r.SIZE),this._elementsToRender.delete(e))}_processAddition(e){const t=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(t,e);const r=this._atlas,i=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,s=i+T,o=n+T+M;if(!this._addAtlasElement(e,t,s,o)){if(this._canRepack)this._reset();else if(r.width<s){const e=Math.min((0,f.Mv)(Math.max(s,1.5*r.width)),w);this._resizeAtlas(e,r.height)}else{const e=r.nextY+o,t=Math.min((0,f.Mv)(Math.max(e,1.5*r.height)),w);if(t>r.height)this._resizeAtlas(r.width,t);else if(r.width<w){const e=Math.min((0,f.Mv)(1.5*r.width),w);this._resizeAtlas(e,r.height)}}this._elements.set(t,e)}}_renderElement(e){const t=e.commitNewPosition(),r=e.textRenderer;this._ctx.clearRect(t[0]-T,t[1]-T,r.renderedWidth+2*T,r.renderedHeight+2*T),r.render(this._ctx,t[0],t[1]);const i=this._stageObjects.get(r.key);i?.forEach((t=>S(t,e)))}get running(){return this.updating}runTask(e){if(null==this._glTexture)return y.G;for(;this._needsRepack&&(this._canRepack||this._atlas.height<w&&this._atlas.height<w);){this._canRepack=this._needsRepack=!1;const t=this._elements;this._elements=new Map,t.forEach((e=>this._processAddition(e))),e.madeProgress()}if(this._elementsToRender.size>0){for(const[t,r]of this._elementsToRender){if(e.done)break;this._renderElement(r),this._elementsToRender.delete(t),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addTextTexture(e,t){const r=e.key;this._addStageObject(r,t);let i=this._elements.get(r);null==i&&(i=new A(this._atlas,e),this._processAddition(i),this.setDirty()),function(e,t){e.geometries[0].setAttributeData(m.r.SIZE,[t.textRenderer.displayWidth,t.textRenderer.displayHeight]),e.geometryVertexAttributeUpdated(e.geometries[0],m.r.SIZE)}(t,i),S(t,i)}removeTextTexture(e,t){const r=e.key;if(!this._elements.get(r))return;this._removeStageObject(r,t);const i=this._stageObjects.get(r);i&&0!==i.size||this._elements.delete(r),0===i?.size&&this._stageObjects.delete(r),this._canRepack=!0}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};function S(e,t){e.geometries[0].setAttributeData(m.r.UV0,t.uv),e.geometryVertexAttributeUpdated(e.geometries[0],m.r.UV0,!0)}(0,i._)([(0,l.MZ)({constructOnly:!0})],x.prototype,"view",void 0),(0,i._)([(0,l.MZ)({type:Boolean})],x.prototype,"updating",void 0),x=(0,i._)([(0,c.$)("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],x);const T=2,M=2;class A{constructor(e,t){this._atlas=e,this.textRenderer=t,this._uv=(0,h.vt)(),this._newPosition=[0,0]}get uv(){if(null==this._xOffset||null==this._yOffset)return h.uY;const{renderedWidth:e,renderedHeight:t}=this.textRenderer;return(0,u.s)(this._uv,this._xOffset/this._atlas.width,(this._yOffset+t)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}}class C{constructor(e,t){this.width=e,this.height=t,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=R}}class E{constructor(e){this.y=e,this.x=R}}let R=0},96897:(e,t,r)=>{"use strict";r.d(t,{g:()=>V});r(81806);var i=r(50076),n=r(54099),s=r(30726),o=r(50346),a=r(78393),l=r(90534),c=r(49003),u=r(76312),h=r(83490),d=r(22728),p=r(73146),f=r(87634),m=r(76460),g=r(93345),y=r(98433);const _=()=>m.A.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),v=542327876,b=131072,w=4;function x(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const S=x("DXT1"),T=x("DXT3"),M=x("DXT5"),A=31,C=0,E=1,R=2,P=3,O=4,I=7,L=20,N=21;function D(e,t){const r=new Int32Array(e,0,A);if(r[C]!==v)return _().error("Invalid magic number in DDS header"),null;if(!(r[L]&w))return _().error("Unsupported format, must contain a FourCC code"),null;const i=r[N];let n,s;switch(i){case S:n=8,s=g.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case T:n=16,s=g.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case M:n=16,s=g.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return _().error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(i)),null}let o=1,a=r[O],l=r[P];(3&a||3&l)&&(_().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let h,d;r[R]&b&&!1!==t&&(o=Math.max(1,r[I]));let p=r[E]+4;const f=[];for(let m=0;m<o;++m)d=(a+3>>2)*(l+3>>2)*n,h=new Uint8Array(e,p,d),f.push(h),p+=d,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:f},internalFormat:s,width:c,height:u}}var F,k=r(81330),z=r(86994),U=r(96673);class V extends p.J{get parameters(){return this._parameters}constructor(e,t){super(),this._data=e,this.type=f.X.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new n.A,this._parameters={...j,...t},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){null!=e&&(e instanceof HTMLVideoElement?(this.frameUpdate=t=>this._frameUpdate(e,t),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!((0,l.w8)(e.src)||"auto"===e.preload&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const t=!e.paused;if(e.src=e.src,t&&e.autoplay){const t=()=>{e.removeEventListener("canplay",t),e.play()};e.addEventListener("canplay",t)}}}_startPreloadImageElement(e){(0,l.DB)(e.src)||(0,l.w8)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const t=new U.R;return t.wrapMode=this._parameters.wrap??g.pF.REPEAT,t.flipped=!this._parameters.noUnpackFlip,t.samplingMode=this._parameters.mipmap?g.Cj.LINEAR_MIPMAP_LINEAR:g.Cj.LINEAR,t.hasMipmap=!!this._parameters.mipmap,t.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,t.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),t}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.usedMemory||function(e,t){if(null==e)return 0;if((0,a.mw)(e)||(0,a.mg)(e))return t.encoding===h.JS.KTX2_ENCODING?(0,d.JI)(e,!!t.mipmap):t.encoding===h.JS.BASIS_ENCODING?(0,d.Cr)(e,!!t.mipmap):e.byteLength;const{width:r,height:i}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?B(e):t;return(t.mipmap?4/3:1)*r*i*(t.components||4)||0}(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const t=this._data;return null==t?(this._glTexture=new y.g(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),"string"==typeof t?this._loadFromURL(e,t):t instanceof Image?this._loadFromImageElement(e,t):t instanceof HTMLVideoElement?this._loadFromVideoElement(e,t):t instanceof ImageData||t instanceof HTMLCanvasElement?this._loadFromImage(e,t):((0,a.mw)(t)||(0,a.mg)(t))&&this._parameters.encoding===h.JS.DDS_ENCODING?this._loadFromDDSData(e,t):((0,a.mw)(t)||(0,a.mg)(t))&&this._parameters.encoding===h.JS.KTX2_ENCODING?this._loadFromKTX2(e,t):((0,a.mw)(t)||(0,a.mg)(t))&&this._parameters.encoding===h.JS.BASIS_ENCODING?this._loadFromBasis(e,t):(0,a.mg)(t)?this._loadFromPixelData(e,t):(0,a.mw)(t)?this._loadFromPixelData(e,new Uint8Array(t)):null)}_frameUpdate(e,t){return null==this._glTexture||e.readyState<F.HAVE_CURRENT_DATA||t===e.currentTime?t:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,t){return this._glTexture=function(e,t,r){const i=D(r,t.hasMipmap??!1);if(null==i)throw new Error("DDS texture data is null");const{textureData:n,internalFormat:s,width:o,height:a}=i;return t.samplingMode=n.levels.length>1?g.Cj.LINEAR_MIPMAP_LINEAR:g.Cj.LINEAR,t.hasMipmap=n.levels.length>1,t.internalFormat=s,t.width=o,t.height=a,new y.g(e,t,n)}(e,this._createDescriptor(e),t),this._glTexture}_loadFromKTX2(e,t){return this._loadAsync((()=>(0,d.Vc)(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromBasis(e,t){return this._loadAsync((()=>(0,d.KV)(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromPixelData(e,t){(0,z.vA)(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=1===this._parameters.components?g.Ab.LUMINANCE:3===this._parameters.components?g.Ab.RGB:g.Ab.RGBA,r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new y.g(e,r,t),this._glTexture}_loadFromURL(e,t){return this._loadAsync((async r=>{const i=await(0,c.D)(t,{signal:r});return(0,o.Te)(r),this._loadFromImage(e,i)}))}_loadFromImageElement(e,t){return t.complete?this._loadFromImage(e,t):this._loadAsync((async r=>{const i=await(0,u.Sx)(t,t.src,!1,r);return(0,o.Te)(r),this._loadFromImage(e,i)}))}_loadFromVideoElement(e,t){return t.readyState>=F.HAVE_CURRENT_DATA?this._loadFromImage(e,t):this._loadFromVideoElementAsync(e,t)}_loadFromVideoElementAsync(e,t){return this._loadAsync((r=>new Promise(((n,a)=>{const l=()=>{t.removeEventListener("loadeddata",c),t.removeEventListener("error",u),(0,s.xt)(h)},c=()=>{t.readyState>=F.HAVE_CURRENT_DATA&&(l(),n(this._loadFromImage(e,t)))},u=e=>{l(),a(e||new i.A("Failed to load video"))};t.addEventListener("loadeddata",c),t.addEventListener("error",u);const h=(0,o.u7)(r,(()=>u((0,o.NK)())))}))))}_loadFromImage(e,t){let r=t;if(!(r instanceof HTMLVideoElement)){const{maxTextureSize:t}=e.parameters;r=this._parameters.downsampleUncompressed?(0,k.IR)(r,t):(0,k.vM)(r,t)}const i=B(r);this._parameters.width=i.width,this._parameters.height=i.height;const n=this._createDescriptor(e);return n.pixelFormat=3===this._parameters.components?g.Ab.RGB:g.Ab.RGBA,n.width=i.width,n.height=i.height,this._glTexture=new y.g(e,n,r),this._glTexture}_loadAsync(e){const t=new AbortController;this._loadingController=t;const r=e(t.signal);this._loadingPromise=r;const i=()=>{this._loadingController===t&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(i,i),r}unload(){if(this._glTexture=(0,s.WD)(this._glTexture),null!=this._loadingController){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}}function B(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}!function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(F||(F={}));const j={wrap:{s:g.pF.REPEAT,t:g.pF.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1}},13167:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});class i{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}}var n=r(88105),s=r(93345),o=r(98433),a=r(96673);class l{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._rctx=e,this._fieldCount=t,this.textureWidth=4096,this._dirty=!0;const r=new a.R(this.textureWidth,1);r.samplingMode=s.Cj.NEAREST,r.wrapMode=s.pF.CLAMP_TO_EDGE,this._texture=new o.g(this._rctx,r),this._data=new n.XP(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,t,r,i,n,s){const o=e*this._fieldCount+t;this._dirty=!0,this._data.set(o,0,r),this._data.set(o,1,i),this._data.set(o,2,n),this._data.set(o,3,s)}setDataElement(e,t,r,i){const n=e*this._fieldCount+t;this._dirty=!0,this._data.set(n,r,i)}getDataElement(e,t,r){const i=e*this._fieldCount+t;return this._dirty=!0,this._data.get(i,r)}resizeToFit(e){const t=(e+1)*this._fieldCount;if(t>this._data.count){const e=Math.ceil(t/this.textureWidth)*this.textureWidth,r=new n.XP(new ArrayBuffer(4*e));r.typedBuffer.set(this._data.typedBuffer),this._data=r}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,t=this._texture.descriptor.height;this._data.count>e*t&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}}class c{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.textureBuffer=new l(e,t),this._indexManager=new i(65536)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}}class u{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._rctx=e,this._fieldCount=t,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter((e=>0!==e.activeCount||(e.dispose(),!1)))}destroy(){this._buffers.forEach((e=>e.dispose())),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>65536)return null;const t=new c(this._rctx,this._fieldCount);return this._buffers.push(t),t}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}}},40325:(e,t,r)=>{"use strict";r.d(t,{e:()=>u});var i=r(53070),n=r(16506),s=r(42693),o=r(32119),a=r(28584),l=r(93345),c=r(57162);class u extends s.w{initializeProgram(e){return new a.B(e.rctx,u.shader.get().build(),o.D)}initializePipeline(){return this.configuration.hasAlpha?(0,c.Ey)({blending:(0,c.p3)(l.dn.SRC_ALPHA,l.dn.ONE,l.dn.ONE_MINUS_SRC_ALPHA,l.dn.ONE_MINUS_SRC_ALPHA),colorWrite:c.wE}):(0,c.Ey)({colorWrite:c.wE})}}u.shader=new n.$(i.a,(()=>r.e(2553).then(r.bind(r,62553))))},86967:(e,t,r)=>{"use strict";r.d(t,{M:()=>s});var i=r(35143),n=r(99415);class s extends n.K{constructor(){super(...arguments),this.hasAlpha=!1}}(0,i._)([(0,n.W)()],s.prototype,"hasAlpha",void 0)},10773:(e,t,r)=>{"use strict";var i;r.d(t,{y:()=>i}),function(e){e[e.ColorAlpha=0]="ColorAlpha",e[e.FrontFace=1]="FrontFace",e[e.NONE=2]="NONE",e[e.COUNT=3]="COUNT"}(i||(i={}))},44513:(e,t,r)=>{"use strict";var i;r.d(t,{q:()=>i}),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(i||(i={}))},86994:(e,t,r)=>{"use strict";r.d(t,{Cv:()=>h,L:()=>u,MX:()=>l,M_:()=>p,O_:()=>c,kL:()=>d,vA:()=>a,zH:()=>f});var i=r(72745),n=r(43047);const s=(0,r(55855).vt)();class o{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function a(e,t){if(!e){t=t||"Assertion";const e=new Error(t).stack;throw new o(`${t} at ${e}`)}}function l(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))}function c(e,t,r,i){let n,s=(r[0]-e[0])/t[0],o=(i[0]-e[0])/t[0];s>o&&(n=s,s=o,o=n);let a=(r[1]-e[1])/t[1],l=(i[1]-e[1])/t[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(r[2]-e[2])/t[2],u=(i[2]-e[2])/t[2];return c>u&&(n=c,c=u,u=n),!(s>u||c>o)&&(u<o&&(o=u),!(o<0))}function u(e,t,r,n,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,i.vt)();const a=(n[s]-r[s])*(t[0]-e[0])-(n[0]-r[0])*(t[s]-e[s]),l=(n[0]-r[0])*(e[s]-r[s])-(n[s]-r[s])*(e[0]-r[0]);if(0===a)return!1;const c=l/a;return o[0]=e[0]+c*(t[0]-e[0]),o[1]=e[s]+c*(t[s]-e[s]),!0}function h(e,t,r,i,o){s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=1,(0,n.t)(s,s,t),o.length>2&&(o[2]=-s[2]),(0,n.t)(s,s,r),a(0!==s[3]),o[0]=s[0]/s[3],o[1]=s[1]/s[3],o[2]=s[2]/s[3],o[0]=(.5*o[0]+.5)*i[2]+i[0],o[1]=(.5*o[1]+.5)*i[3]+i[1]}function d(e,t){return Math.log(e)/Math.log(t)}function p(e,t,r,i){e[12]=t,e[13]=r,e[14]=i}function f(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}},69008:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var i=r(36911);class n extends i.Z{}},66470:(e,t,r)=>{"use strict";var i;function n(e){return e===i.POSITION}r.d(t,{b:()=>n,r:()=>i}),function(e){e.POSITION="position",e.NORMAL="normal",e.NORMALCOMPRESSED="normalCompressed",e.UV0="uv0",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.PERSPECTIVEDIVIDE="perspectiveDivide",e.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",e.LENGTH="length",e.PREVPOSITION="prevPosition",e.NEXTPOSITION="nextPosition",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.INSTANCEMODELORIGINHI="instanceModelOriginHi",e.INSTANCEMODELORIGINLO="instanceModelOriginLo",e.INSTANCEMODEL="instanceModel",e.INSTANCEMODELNORMAL="instanceModelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMAL2COMPRESSED="normal2Compressed",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude",e.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",e.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"}(i||(i={}))},92290:(e,t,r)=>{"use strict";r.d(t,{S:()=>z});var i=r(35143),n=r(19276),s=r(15941),o=r(30726),a=r(68134),l=r(46053),c=r(81806),u=(r(76460),r(47249),r(85842)),h=r(34761),d=r(13191),p=r(20664),f=r(9392),m=r(34981),g=r(60586),y=r(77730),_=r(16455),v=r(81330),b=r(55855),w=r(33062),x=r(86994);let S=class extends w.A{constructor(){super(...arguments),this.sectionAngles=(0,b.vt)()}get sectionAnglesDeg(){return(0,b.ci)(this.sectionAngles.map((e=>(0,s.KJ)(e))))}set sectionAnglesDeg(e){this.sectionAngles=(0,b.ci)(e.map((e=>(0,s.kU)(e))))}get projectionMatrix(){const e=(0,d.vt)();return(0,h.lK)(e,this.sectionMatrix,this._projectionMatrixInternal)}get sectionMatrix(){const e=this.sectionAngles[0],t=this.sectionAngles[1],r=this.sectionAngles[2],i=this.sectionAngles[3];(0,x.vA)(e<=t),(0,x.vA)(r<=i);const n=2*Math.tan(this.fovX/2),s=2*Math.tan(this.fovY/2),o=Math.tan(e),a=Math.tan(t),l=Math.tan(r),c=a-o,u=Math.tan(i)-l,p=n/c,f=s/u,m=-(o+c/2)/n*2,g=-(l+u/2)/s*2,y=(0,d.vt)();(0,h.kN)(y,[m,g,0]);const _=(0,d.vt)();(0,h.CV)(_,[p,f,1]);const v=(0,d.vt)();return(0,h.lK)(v,_,y)}get _sectionRatioX(){const e=Math.tan(this.sectionAngles[0]),t=Math.tan(this.sectionAngles[1]),r=2*Math.tan(this.fovX/2);return Math.min(1,(t-e)/r)}setViewport(e,t){const r=t*this._sectionRatioX;return this.viewport=[e[0],e[1],r,t],r}};(0,i._)([(0,l.MZ)()],S.prototype,"sectionAngles",void 0),(0,i._)([(0,l.MZ)()],S.prototype,"sectionAnglesDeg",null),(0,i._)([(0,l.MZ)()],S.prototype,"projectionMatrix",null),(0,i._)([(0,l.MZ)()],S.prototype,"sectionMatrix",null),(0,i._)([(0,l.MZ)()],S.prototype,"_sectionRatioX",null),S=(0,i._)([(0,u.$)("esri.views.3d.webgl-engine.lib.ViewshedFaceCamera")],S);var T=r(93345);class M{constructor(){this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.textureSizeMultiple=128,this.toleranceSides=5,this.toleranceBottomTop=10}textureSizeModifier(e){return e?this.textureSizeModHighQuality:this.textureSizeModLowQuality}textureResizeModulo(e){return Math.ceil(e/this.textureSizeMultiple)*this.textureSizeMultiple}}const A=["front","left","right","back","top","bottom"];class C{constructor(e){this._fbos=e,this._enabled=!1,this._faces={},this._textureWidth=0,this._textureHeight=0,this.settings=new M,this._maxTextureWidth=Math.min((0,c.A)("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}get depthTexture(){return this._handle?.getTexture()}get enabled(){return this._enabled}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get isTextureZero(){return 0===this._textureWidth||0===this._textureHeight}get nearFar(){const e=this.faces;return 0===e.length?null:e[0].nearFar}get numActiveFaces(){const e=this._faces;let t=0;return Object.keys(e).forEach((r=>{e[r]&&(t+=1)})),t}get faces(){const e=this._faces,t=[];for(const r of A){const i=e[r];i&&t.push(i)}return t}get atlasRegions(){return this.faces.map((e=>[e.x/this._textureWidth,(e.x+e.width)/this._textureWidth,e.y/this._textureHeight,(e.y+e.height)/this._textureHeight]))}get viewshedProjectionMatrices(){return this.faces.map((e=>e.projectionMatrix))}get viewshedViewMatrices(){return this.faces.map((e=>e.viewMatrix))}_setupFaceCamera(e,t,r,i){const{observerRenderSpace:n,tiltedUpVector:o,targetRenderSpace:a,farDistanceRenderSpace:l,horizontalFieldOfView:c,verticalFieldOfView:u}=t,m=(0,f.vt)();(0,p.z)(m,a,n);const g=(0,f.vt)(),y=(0,f.vt)(),_=(e,t)=>{const r=(0,f.vt)(),i=(0,d.vt)();return(0,h.$0)(i,e,t),(0,p.h)(r,m,i),(0,p.g)(r,n,r),r};let v,b=o;const w=Math.min(90,c),x=Math.min(90,Math.max(0,(c-90)/2));let T=-45,M=45,A=-45,C=45;if(function(e){return!["top","bottom"].includes(e)}(e)){const e=e=>(0,s.qE)(e,-45,45);A=e(-u/2)-this.settings.toleranceBottomTop,C=e(+u/2)+this.settings.toleranceBottomTop}switch(e){case"front":v=a,T=-w/2,M=w/2;break;case"left":v=_(Math.PI/2,o),T=45-x;break;case"right":v=_(-Math.PI/2,o),M=-45+x;break;case"top":v=(0,p.g)(g,n,o),b=(0,p.k)(y,m);break;case"bottom":v=(0,p.z)(g,n,o),b=m;break;case"back":v=_(Math.PI,o)}const E=new S({center:v,eye:n,up:b,far:l});E.sectionAnglesDeg=[T-this.settings.toleranceSides,M+this.settings.toleranceSides,A,C],E.fovY=Math.PI/2;const R=E.setViewport(r,i);return this._faces[e]=E,R}_bindFBO(){const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._handle?.fbo)}_computeActiveFaces(e){const t=new Set,{horizontalFieldOfView:r,verticalFieldOfView:i}=e,n=-i/2,s=i/2;return 0===r||0===i||(n<=45&&s>=-45&&t.add("front"),r>90&&(t.add("left"),t.add("right")),r>270&&t.add("back"),s>45-this.settings.toleranceBottomTop&&t.add("top"),n<-45+this.settings.toleranceBottomTop&&t.add("bottom")),t}_computeBaseTextureSize(e,t,r,i){const n=Math.min(window.devicePixelRatio,t)/e.pixelRatio,s=this.settings.textureSizeModifier(r),o=(0,v.Mv)(Math.floor(Math.max(e.fullWidth,e.fullHeight)*n*s)),a=Math.floor(this._maxTextureWidth/i),l=Math.min(a,o);return(0,v.uT)(l)}_ensureFBO(){const e=this._textureWidth,t=this._textureHeight;this._handle?.fbo?.width===e&&this._handle?.fbo?.height===t||(this._handle?.release(),this._handle=this._fbos.acquire(e,t,"viewshed shadow map",_.N.RGBA4)),this._handle.acquireDepth(_.z.DEPTH16_BUFFER)}clearFBO(){const e=this._fbos.rctx;this._ensureFBO(),this._bindFBO(),e.setClearColor(1,1,1,1),e.clear(T.hn.COLOR_BUFFER_BIT|T.hn.DEPTH_BUFFER_BIT)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._handle=(0,o.Gz)(this._handle)}start(e,t,r,i){if(this._faces={},!this.enabled)return!1;const n=this._computeActiveFaces(t),s=n.size;if(0===s)return!1;const o=this._computeBaseTextureSize(e,i,r,s);if(0===o)return!1;let a=0,l=0,c=0;return A.filter((e=>n.has(e))).forEach((e=>{const r=function(e,t){if(t<4)return 0;const r="front"===e||"left"===e;return 4===t?r?0:1:r||"right"===e?0:1}(e,s);r>l&&(c=Math.max(c,a),a=0),l=r;const i=r*o;a+=this._setupFaceCamera(e,t,[a,i],o)})),c=Math.max(c,a),this._textureWidth=this.settings.textureResizeModulo(c),this._textureHeight=function(e){return e<4?1:2}(s)*o,this.clearFBO(),!0}finish(){this._handle?.detachDepth()}get test(){return{faces:this._faces,faceTypes:A}}}var E=r(27456),R=r(16506),P=r(42693),O=r(32119),I=r(60322),L=r(28584),N=r(57162);class D extends P.w{initializeProgram(e){return new L.B(e.rctx,D.shader.get().build(this.configuration),O.D)}initializePipeline(){return(0,N.Ey)({colorWrite:N.wE,blending:I.V0})}}D.shader=new R.$(E.a,(()=>r.e(8758).then(r.bind(r,28758))));var F=r(99415);class k extends F.K{constructor(){super(...arguments),this.useNormalMap=!0}}(0,i._)([(0,F.W)()],k.prototype,"useNormalMap",void 0);let z=class extends g.RW{get viewshedShadowMap(){return this._viewshedShadowMap}get enabled(){return this._viewsheds.length>0}constructor(e,t){super(e),this._pluginContext=null,this.renderHighQuality=!1,this._parameters=new E.V,this._configuration=new k,this._viewsheds=new n.A,this.produces=new Map([[y.N.VIEWSHED,()=>!0]]),this._renderShadowMap=t}initialize(){this.addHandles((0,a.wB)((()=>this.view.qualitySettings.maximumPixelRatio),(e=>this._maximumPixelRatio=e),a.pc))}destroy(){this.uninitializeRenderContext()}consumes(){return this.enabled?g.B7:g.qo}initializeRenderContext(e){this._pluginContext=e,this._viewshedShadowMap=new C(this.fboCache),this._viewshedShadowMap.enabled=!0}renderNode(e,t,r){const{bindParameters:i,rctx:n}=e;if(!this.enabled||!i.depth||null==r)return;const s=this._setupNormals(r);if(null!=this._technique&&this._configuration.useNormalMap===s||(this._configuration.useNormalMap=s,this._technique=this._pluginContext?.techniques.acquire(D,this._configuration)),this._technique?.compiled)for(const o of this._viewsheds){const t=e.rctx.getBoundFramebufferObject(),r=this._renderViewshedShadowCubeMap(i,o),s=this._viewshedShadowMap;r&&null!=s.depthTexture&&!s.isTextureZero&&(this._setPassParameters(o),e.rctx.bindFramebuffer(t),n.bindTechnique(this._technique,i,this._parameters),n.screen.draw())}else this._pluginContext?.requestRender()}uninitializeRenderContext(){this._pluginContext=null,this._viewshedShadowMap.dispose(),this._technique=(0,o.pR)(this._technique)}updateViewsheds(e){const t=e.removes;null!=t&&(n.A.isCollection(t)?this._viewsheds.removeMany(t):this._viewsheds.remove(t));const r=e.adds;if(null!=r)if(n.A.isCollection(r)){const e=r.filter((e=>!this._viewsheds.includes(e)));this._viewsheds.addMany(e)}else this._viewsheds.includes(r)||this._viewsheds.add(r)}_renderViewshedShadowCubeMap(e,t){const r=this._viewshedShadowMap;if(!r.enabled)return!1;const i=r.start(e.camera,t,this.renderHighQuality,this._maximumPixelRatio);if(i)for(const n of r.faces)this._renderShadowMap(e,n,m.V.ViewshedShadow);return r.finish(),i}_setPassParameters(e){const t=this._parameters,r=this._viewshedShadowMap,i=e.observerRenderSpace;t.localOrigin=i,t.fovs=[(0,s.kU)(e.horizontalFieldOfView),(0,s.kU)(e.verticalFieldOfView)],t.headingAndTilt=[(0,s.kU)(e.heading),(0,s.kU)(e.tiltParallelToSurface)],t.upVector=e.tiltedUpVector;const n=function(e,t){const r=(0,f.vt)();return(0,p.z)(r,e,t)}(e.targetRenderSpace,i);t.targetVector=n,t.shadowMap=r;const o=[],a=[];for(let s=0;s<r.numActiveFaces;s++)(0,h.Tl)(V,r.viewshedViewMatrices[s],i),o.push(...V.flat()),U(r.viewshedProjectionMatrices[s],V,B),a.push(...B.flat());t.viewMatrices=o,t.projectionMatrices=a}_setupNormals(e){const t=e.get("normals"),r=t?.getTexture();return this._parameters.normalTexture=r,null!=r}get test(){return{viewsheds:this._viewsheds}}};function U(e,t,r){const i=(0,f.fA)(.5,.5,.5);return(0,h.kN)(r,i),(0,h.hs)(r,r,i),(0,h.lK)(r,r,e),(0,h.lK)(r,r,t),r}(0,i._)([(0,l.MZ)()],z.prototype,"_pluginContext",void 0),(0,i._)([(0,l.MZ)()],z.prototype,"fboCache",void 0),(0,i._)([(0,l.MZ)()],z.prototype,"view",void 0),(0,i._)([(0,l.MZ)()],z.prototype,"viewshedShadowMap",null),z=(0,i._)([(0,u.$)("esri.views.3d.webgl-engine.lib.Viewshed")],z);const V=(0,d.vt)(),B=(0,d.vt)()},8918:(e,t,r)=>{"use strict";r.d(t,{x:()=>d,r:()=>p});var i=r(54099),n=r(88321),s=r(30726),o=r(30015),a=r(73146),l=r(87634);const c=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];var u=r(94536),h=r(44513);class d extends a.J{get objects(){return this._objects}constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";super(),this.stage=e,this.apiLayerUid=r,this.type=l.X.Layer,this.events=new i.A,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new o.A,this._objectsAdded=new o.A,this._handles=new n.A,this.apiLayerUid=r,this.visible=t?.visible??!0,this.pickable=t?.pickable??!0,this.updatePolicy=t?.updatePolicy??h.q.ASYNC,this._disableOctree=t?.disableOctree??!1,e.add(this);for(const i of c)this._handles.add(this.events.on(i,(t=>e.handleEvent(i,t))))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),null!=this._octree&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),null!=this._octree&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),null!=this._octree&&this._objectsAdded.pushArray(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),null!=this._octree){for(let e=0;e<t.length;)this._objectsAdded.removeUnordered(t[e])?(t[e]=t[t.length-1],t.length-=1):++e;this._octree.remove(t)}}}sync(){this.updatePolicy!==h.q.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){null==this._octree||this._objectsAdded.includes(e)||this._octree.update(e,t)}getSpatialQueryAccelerator(){return null==this._octree&&this._objects.length>50&&!this._disableOctree?(this._octree=new u.A((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=(0,s.pR)(this._octree),this._objectsAdded.clear()}}function p(e){return null!=e&&e.type===l.X.Layer}},83490:(e,t,r)=>{"use strict";var i,n,s,o,a,l,c,u,h;r.d(t,{Am:()=>o,C7:()=>s,ID:()=>u,JS:()=>h,Mg:()=>l,dd:()=>a,it:()=>n,s2:()=>i,sf:()=>c}),function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"}(i||(i={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(n||(n={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(s||(s={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(o||(o={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(a||(a={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(l||(l={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(c||(c={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(u||(u={})),function(e){e.DDS_ENCODING="image/vnd-ms.dds",e.KTX2_ENCODING="image/ktx2",e.BASIS_ENCODING="image/x.basis"}(h||(h={}))},96141:(e,t,r)=>{"use strict";r.d(t,{I$:()=>o,In:()=>u,JS:()=>h,gr:()=>c,vJ:()=>a,wO:()=>l});var i=r(57481),n=r(48549),s=r(66470);const o=(0,n.BP)().vec3f(s.r.POSITION).u16(s.r.COMPONENTINDEX).freeze(),a=(0,n.BP)().vec2u8(s.r.SIDENESS).freeze(),l=(0,i.U)(a),c=(0,n.BP)().vec3f(s.r.POSITION0).vec3f(s.r.POSITION1).vec2i16(s.r.NORMALCOMPRESSED).u16(s.r.COMPONENTINDEX).u8(s.r.VARIANTOFFSET,{glNormalized:!0}).u8(s.r.VARIANTSTROKE).u8(s.r.VARIANTEXTENSION,{glNormalized:!0}).freeze(),u=(0,n.BP)().vec3f(s.r.POSITION0).vec3f(s.r.POSITION1).vec2i16(s.r.NORMALCOMPRESSED).vec2i16(s.r.NORMAL2COMPRESSED).u16(s.r.COMPONENTINDEX).u8(s.r.VARIANTOFFSET,{glNormalized:!0}).u8(s.r.VARIANTSTROKE).u8(s.r.VARIANTEXTENSION,{glNormalized:!0}).freeze(),h=new Map([[s.r.POSITION0,0],[s.r.POSITION1,1],[s.r.COMPONENTINDEX,2],[s.r.VARIANTOFFSET,3],[s.r.VARIANTSTROKE,4],[s.r.VARIANTEXTENSION,5],[s.r.NORMALCOMPRESSED,6],[s.r.NORMAL2COMPRESSED,7],[s.r.SIDENESS,8]])},69413:(e,t,r)=>{"use strict";r.d(t,{T:()=>y,k:()=>_});var i=r(47249),n=r(20664),s=r(9392),o=r(57481),a=r(25672),l=r(96141);class c{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?f:p}write(e,t,r){b.seed=this._edgeHashFunction(r);const i=b.getIntRange(0,255),n=b.getIntRange(0,this.settings.variants-1),s=b.getFloat(),o=255*(.5*function(e,t){return Math.abs(e)**t*Math.sign(e)}(-(1-Math.min(s/.7,1))+Math.max(0,s-.7)/(1-.7),1.2)+.5);e.position0.setVec(t,r.position0),e.position1.setVec(t,r.position1),e.componentIndex.set(t,r.componentIndex),e.variantOffset.set(t,i),e.variantStroke.set(t,n),e.variantExtension.set(t,o)}}const u=new Float32Array(6),h=new Uint32Array(u.buffer),d=new Uint32Array(1);function p(e){return u[0]=e.position0[0],u[1]=e.position0[1],u[2]=e.position0[2],u[3]=e.position1[0],u[4]=e.position1[1],u[5]=e.position1[2],d[0]=31*(31*(31*(31*(31*(166811+h[0])+h[1])+h[2])+h[3])+h[4])+h[5],d[0]}function f(e){const t=u;t[0]=g(e.position0[0]),t[1]=g(e.position0[1]),t[2]=g(e.position0[2]),t[3]=g(e.position1[0]),t[4]=g(e.position1[1]),t[5]=g(e.position1[2]),d[0]=5381;for(let r=0;r<h.length;r++)d[0]=31*d[0]+h[r];return d[0]}const m=1e4;function g(e){return Math.round(e*m)/m}class y{constructor(){this._commonWriter=new c}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return l.gr.createBuffer(e)}write(e,t,r){this._commonWriter.write(e,t,r),(0,n.g)(v,r.faceNormal0,r.faceNormal1),(0,n.n)(v,v);const{typedBuffer:i,typedBufferStride:s}=e.normalCompressed;(0,a.aT)(i,t,v[0],v[1],v[2],s)}}y.Layout=l.gr,y.glLayout=(0,o.U)(l.gr,1);class _{constructor(){this._commonWriter=new c}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return l.In.createBuffer(e)}write(e,t,r){this._commonWriter.write(e,t,r);{const{typedBuffer:i,typedBufferStride:n}=e.normalCompressed;(0,a.aT)(i,t,r.faceNormal0[0],r.faceNormal0[1],r.faceNormal0[2],n)}{const{typedBuffer:i,typedBufferStride:n}=e.normal2Compressed;(0,a.aT)(i,t,r.faceNormal1[0],r.faceNormal1[1],r.faceNormal1[2],n)}}}_.Layout=l.In,_.glLayout=(0,o.U)(l.In,1);const v=(0,s.vt)(),b=new i.A},7150:(e,t,r)=>{"use strict";r.d(t,{K:()=>l});var i=r(15941),n=r(30015),s=r(20664),o=r(9392);const a=-1;function l(e,t,r){const i=e.vertices.position,n=e.vertices.componentIndex,o=m.position0,l=m.position1,h=m.faceNormal0,p=m.faceNormal1,{edges:f,normals:g}=u(e),y=f.length/4,_=t.allocate(y);let v=0;const b=y,S=r?.allocate(b);let M=0,A=0,C=0;d.length=0;for(let a=0;a<y;++a){const e=4*a;i.getVec(f.data[e],o),i.getVec(f.data[e+1],l);const t=d.pushNew();t.index=4*a,t.length=(0,s.p)(o,l)}d.sort(((e,t)=>t.length-e.length));const E=new Array,R=new Array;d.forAll((e=>{let{length:u,index:d}=e;const y=f.data[d],b=f.data[d+1],P=f.data[d+2],O=f.data[d+3],I=O===a;if(i.getVec(y,o),i.getVec(b,l),I){const e=3*P;(0,s.s)(h,g.data[e],g.data[e+1],g.data[e+2]),(0,s.c)(p,h),m.componentIndex=n.get(y),m.cosAngle=(0,s.m)(h,p)}else{let e=3*P;if((0,s.s)(h,g.data[e],g.data[e+1],g.data[e+2]),e=3*O,(0,s.s)(p,g.data[e],g.data[e+1],g.data[e+2]),m.componentIndex=n.get(y),m.cosAngle=(0,s.m)(h,p),function(e,t){return e.cosAngle>t}(m,x))return;m.cosAngle<-.9999&&(0,s.c)(p,h)}A+=u,C++,I||function(e,t){return e.cosAngle<t}(m,T)?(t.write(_,v++,m),E.push(u)):c(m,w)&&(S&&r&&r.write(S,M++,m),R.push(u))}));const P=new Float32Array(E.reverse()),O=new Float32Array(R.reverse()),I=S&&r?{instancesData:S.slice(0,M),lodInfo:{lengths:O}}:void 0;return{regular:{instancesData:_.slice(0,v),lodInfo:{lengths:P}},silhouette:I,averageEdgeLength:A/C}}function c(e,t){const r=(0,i.XM)(e.cosAngle);return(0,s.E)(y,e.position1,e.position0),r*((0,s.m)((0,s.b)(g,e.faceNormal0,e.faceNormal1),y)>0?-1:1)>t}function u(e){const t=e.faces.length/3,r=e.faces,i=e.neighbors,n=e.vertices.position;p.length=f.length=0;for(let o=0;o<t;o++){const e=3*o,t=i[e],l=i[e+1],c=i[e+2],u=r[e],h=r[e+1],d=r[e+2];n.getVec(u,_),n.getVec(h,v),n.getVec(d,b),(0,s.f)(v,v,_),(0,s.f)(b,b,_),(0,s.b)(_,v,b),(0,s.n)(_,_),f.pushArray(_),(t===a||u<h)&&(p.push(u),p.push(h),p.push(o),p.push(t)),(l===a||h<d)&&(p.push(h),p.push(d),p.push(o),p.push(l)),(c===a||d<u)&&(p.push(d),p.push(u),p.push(o),p.push(c))}return{edges:p,normals:f}}class h{constructor(){this.index=0,this.length=0}}const d=new n.A({allocator:e=>e||new h,deallocator:null}),p=new n.A({deallocator:null}),f=new n.A({deallocator:null}),m=new class{constructor(){this.position0=(0,o.vt)(),this.position1=(0,o.vt)(),this.faceNormal0=(0,o.vt)(),this.faceNormal1=(0,o.vt)(),this.componentIndex=0,this.cosAngle=0}},g=(0,o.vt)(),y=(0,o.vt)(),_=(0,o.vt)(),v=(0,o.vt)(),b=(0,o.vt)(),w=(0,i.kU)(4),x=Math.cos(w),S=(0,i.kU)(35),T=Math.cos(S)},8775:(e,t,r)=>{"use strict";r.d(t,{o6:()=>u,HY:()=>g,hx:()=>h,Jb:()=>m});var i=r(77176);function n(e,t,r){const i=t/3,n=new Uint32Array(r+1),s=new Uint32Array(r+1),o=(e,t)=>{e<t?n[e+1]++:s[t+1]++};for(let y=0;y<i;y++){const t=e[3*y],r=e[3*y+1],i=e[3*y+2];o(t,r),o(r,i),o(i,t)}let a=0,l=0;for(let y=0;y<r;y++){const e=n[y+1],t=s[y+1];n[y+1]=a,s[y+1]=l,a+=e,l+=t}const c=new Uint32Array(6*i),u=n[r],h=(e,t,r)=>{if(e<t){const i=n[e+1]++;c[2*i]=t,c[2*i+1]=r}else{const i=s[t+1]++;c[2*u+2*i]=e,c[2*u+2*i+1]=r}};for(let y=0;y<i;y++){const t=e[3*y],r=e[3*y+1],i=e[3*y+2];h(t,r,y),h(r,i,y),h(i,t,y)}const d=(e,t)=>{const r=2*e,i=t-e;for(let n=1;n<i;n++){const e=c[r+2*n],t=c[r+2*n+1];let i=n-1;for(;i>=0&&c[r+2*i]>e;i--)c[r+2*i+2]=c[r+2*i],c[r+2*i+3]=c[r+2*i+1];c[r+2*i+2]=e,c[r+2*i+3]=t}};for(let y=0;y<r;y++)d(n[y],n[y+1]),d(u+s[y],u+s[y+1]);const p=new Int32Array(3*i),f=(t,r)=>t===e[3*r]?0:t===e[3*r+1]?1:t===e[3*r+2]?2:-1,m=(e,t)=>{const r=f(e,t);p[3*t+r]=-1},g=(e,t,r,i)=>{const n=f(e,t);p[3*t+n]=i;const s=f(r,i);p[3*i+s]=t};for(let y=0;y<r;y++){let e=n[y];const t=n[y+1];let r=s[y];const i=s[y+1];for(;e<t&&r<i;){const t=c[2*e],i=c[2*u+2*r];t===i?(g(y,c[2*e+1],i,c[2*u+2*r+1]),e++,r++):t<i?(m(y,c[2*e+1]),e++):(m(i,c[2*u+2*r+1]),r++)}for(;e<t;)m(y,c[2*e+1]),e++;for(;r<i;)m(c[2*u+2*r],c[2*u+2*r+1]),r++}return p}var s=r(48549),o=r(66470),a=r(96141),l=r(69413),c=r(7150);function u(e){const t=h(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return p.updateSettings(e.writerSettings),f.updateSettings(e.writerSettings),(0,c.K)(t,p,f)}function h(e,t,r,s){if(t){const t=n(r,s,e.count);return new d(r,s,t,e)}const o=(0,i.b)(e.buffer,e.stride/4,{originalIndices:r,originalIndicesLength:s}),l=n(o.indices,s,o.uniqueCount);return{faces:o.indices,facesLength:o.indices.length,neighbors:l,vertices:a.I$.createView(o.buffer)}}class d{constructor(e,t,r,i){this.faces=e,this.facesLength=t,this.neighbors=r,this.vertices=i}}const p=new l.T,f=new l.k,m=(0,s.BP)().vec3f(o.r.POSITION0).vec3f(o.r.POSITION1),g=(0,s.BP)().vec3f(o.r.POSITION0).vec3f(o.r.POSITION1).u16(o.r.COMPONENTINDEX)},46702:(e,t,r)=>{"use strict";var i;r.d(t,{x:()=>i}),function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"}(i||(i={}))},22278:(e,t,r)=>{"use strict";r.d(t,{Q:()=>u,T:()=>d});var i=r(32119),n=r(11850),s=r(69008),o=r(76718),a=r(93345),l=r(98433),c=r(96673);function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.lK,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.D,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=null;return u=t===n.u7?new Float32Array([l,l,0,0,c,l,1,0,l,c,0,1,c,c,1,1]):new Float32Array([l,l,c,l,l,c,c,c]),new s.Z(e,r,{geometry:t},{geometry:o.g.createVertex(e,a._U.STATIC_DRAW,u)})}const h=4;function d(e){const t=new c.R(h);return t.samplingMode=a.Cj.NEAREST,new l.g(e,t)}},46571:(e,t,r)=>{"use strict";r.d(t,{$I:()=>c,Q5:()=>l,hH:()=>u,i3:()=>a});var i=r(20664),n=r(9392),s=r(79650),o=r(3112);function a(e){return null!=e?.dist}function l(e){return(t,r,n)=>((0,i.o)(h,t,r,n),!(0,s.e)(e,h))}function c(e){return a(e)&&e.intersector===o.dz.OBJECT&&!!e.target}function u(e){return a(e)&&e.intersector===o.dz.HUD&&!!e.target&&"center"in e.target&&null!=e.target.center}const h=(0,n.vt)()},30310:(e,t,r)=>{"use strict";r.d(t,{FI:()=>p,FV:()=>h,Gy:()=>d,QS:()=>y,SM:()=>g});var i=r(34761),n=r(9392),s=r(42294),o=r(93582),a=r(45270),l=r(21255),c=r(46571),u=r(71488);function h(e,t){return(0,c.$I)(e)||(0,c.hH)(e)?m(e.target?.object,t):(0,l.DC)(e)?t.map?.ground:(0,a.rb)(e)||(0,a.db)(e)||(0,l.mi)(e)||(0,a.Q5)(e)?m(e.target,t):null}function d(e,t){const r=p(e,t);return null!=r&&"graphic"===r.type?r.graphic:null}function p(e,t){if(null==e)return null;if((0,c.$I)(e)||(0,c.hH)(e))return f(e.target?.object,t);if((0,a.rb)(e)){const t=e.target.createGraphic();return{type:"graphic",graphic:t,layer:t.layer}}if((0,a.Q5)(e)){const t=e.target.createVoxelGraphic();return{type:"graphic",graphic:t,layer:t.layer}}if((0,a.W3)(e)){const t=e.target.createTiles3DGraphic();return{type:"graphic",graphic:t,layer:t.layer}}return(0,l.mi)(e)||(0,u.H)(e)?f(e.target,t):(0,a.db)(e)?function(e,t){const r=m(e,t);if(null==r)return null;const i=t.allLayerViews.find((e=>e.layer===r));return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?function(e){return null!=e?{type:"graphic",graphic:e,layer:e.layer}:null}(i.getGraphicFromIntersectorTarget(e)):null}(e.target,t):null}function f(e,t){if(null==e?.graphicUid)return null;const r=m(e,t);if(null==r)return null;if(r===t.graphics)return null==t.graphicsView||"number"!=typeof e.graphicUid?null:t.graphicsView.getHit(e.graphicUid);const i=t.allLayerViews.find((e=>e.layer===r));return!i||i.suspended||null==e.graphicUid?null:"getHit"in i?i.getHit(e.graphicUid):null}function m(e,t){return null==e?.layerUid?null:null!=t.graphicsView&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.allLayers.find((t=>t.uid===e.layerUid))}function g(e,t){if((0,c.$I)(e)||(0,c.hH)(e))return(0,o.b)(e.target.object.boundingVolumeWorldSpace.bounds);if((0,u.H)(e)){(0,i.IL)(_,e.transformation);const t=Math.max(_[0],_[1],_[2]);return e.target.baseBoundingSphere.radius*t}if((0,a.db)(e)){const r=function(e,t){const r=m(e,t);if(null==r)return null;const i=t.allLayerViews.find((e=>e.layer===r));return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(e):null}(e.target,t);return r?.5*(0,s._F)(r):null}return null}function y(e){return!(0,c.$I)(e)&&!(0,c.hH)(e)&&((0,u.H)(e)?e.target.numLodLevels>1:!!(0,a.db)(e))}const _=(0,n.vt)()},71488:(e,t,r)=>{"use strict";r.d(t,{H:()=>a,h:()=>o});var i=r(3112),n=r(35737),s=r(46571);class o extends n.R6{constructor(e,t,r,i,n,s){super(e,t),this.layerUid=e,this.graphicUid=t,this.geometryId=r,this.triangleNr=i,this.baseBoundingSphere=n,this.numLodLevels=s}}function a(e){return(0,s.i3)(e)&&e.intersector===i.dz.LOD&&!!e.target}},12062:(e,t,r)=>{"use strict";r.d(t,{Fe:()=>a,XT:()=>u,hr:()=>o,iC:()=>s,lS:()=>l,n3:()=>c});var i=r(18690),n=r(66470);class s{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.geometry=e,this.textures=t}}class o{constructor(e,t,r){this.components=e,this.minScreenSpaceRadius=t,this.pivotOffset=r;const i=this.geometries;this.numVertices=i.reduce(((e,t)=>e+t.attributes.get(n.r.POSITION).indices.length),0)}get geometries(){return(0,i.Am)(this.components.map((e=>e.geometry)))}}class a{constructor(e){this.levels=e,this.levels.sort(((e,t)=>e.minScreenSpaceRadius===t.minScreenSpaceRadius?e.numVertices-t.numVertices:e.minScreenSpaceRadius-t.minScreenSpaceRadius))}}function l(e){const t=[];return e.levels.forEach((e=>e.components.forEach((e=>t.push(e.geometry.material))))),(0,i.Am)(t)}function c(e){const t=new Array;return e.levels.forEach((e=>e.components.forEach((e=>{null!=e.textures&&t.push(...e.textures)})))),(0,i.Am)(t)}function u(e){const t=new Array;return e.levels.forEach((e=>e.components.forEach((e=>t.push(e.geometry))))),(0,i.Am)(t)}},13840:(e,t,r)=>{"use strict";r.d(t,{$T:()=>o,fS:()=>i,zj:()=>n});var i,n,s=r(63496);function o(e){const t=new Map,r=e=>{let r=t.get(e);return r||(r=new s.a0,t.set(e,r)),r};return e.removes.forAll((e=>{a(e)&&r(e.material).removes.push(e)})),e.adds.forAll((e=>{a(e)&&r(e.material).adds.push(e)})),e.updates.forAll((e=>{a(e.renderGeometry)&&r(e.renderGeometry.material).updates.push(e)})),t}function a(e){return e.geometry.indexCount>=1}!function(e){e[e.Default=0]="Default",e[e.Screenshot=1]="Screenshot",e[e.ObjectAndLayerID=2]="ObjectAndLayerID"}(i||(i={})),function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(n||(n={}))},12028:(e,t,r)=>{"use strict";r.d(t,{M4:()=>o,MD:()=>u,cJ:()=>c,hs:()=>h,m0:()=>l,mt:()=>s});var i=r(15941),n=r(64465);function s(e,t){return new d(e,p,t)}function o(e,t){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:n}=p;return new d(e,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:f.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:f.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:n,minPixelSize:f.minPixelSize},t)}function a(e,t,r){const i=r.parameters;return m.scale=Math.min(i.divisor/(t-i.offset),1),m.factor=function(e){return Math.abs(e*e*e)}(e),m}function l(e,t){return(0,i.Cc)(e*Math.max(t.scale,t.minScaleFactor),e,t.factor)}function c(e,t,r,i){i.scale=function(e,t,r){const i=a(e,t,r);return i.minScaleFactor=0,l(1,i)}(e,t,r),i.factor=0,i.minScaleFactor=r.minScaleFactor}function u(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0];const i=Math.min(Math.max(t.scale,t.minScaleFactor),1);return r[0]=e[0]*i,r[1]=e[1]*i,r}function h(e,t,r,i){return l(e,a(t,r,i))}class d{get minScaleFactor(){return null!=this._fontHeight?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{camera:{distance:0,fovY:0},divisor:0,offset:0},s=arguments.length>4?arguments[4]:void 0;this._viewingMode=e,this._description=t,this._ellipsoidRadius=r,this.parameters=i,this._fontHeight=s,this._viewingMode===n.RT.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new d(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,t,r){const{scaleStart:i,scaleFallOffRange:n}=this._description,{fovY:s,distance:o}=e,a=this._calculateCurvatureDependentParameters(e,t),l=this._coverageCompensation(e,t,a),{tiltAngle:c,scaleFallOffFactor:u}=a,h=Math.sin(c)*o,d=.5*Math.PI-c-s*(.5-i*l),p=h/Math.cos(d),f=d+s*n*l,m=(p-u*(h/Math.cos(f)))/(1-u);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=m,r.divisor=p-m,r}_calculateCurvatureDependentParametersLocal(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g;return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g;const n=this._description.curvatureDependent,s=1+e.distance/t,o=Math.sqrt(s*s-1),[a,l]=[n.min.curvature,n.max.curvature],c=(0,i.qE)((o-a)/(l-a),0,1),[u,h]=[n.min,n.max];return r.tiltAngle=(0,i.Cc)(u.tiltAngle,h.tiltAngle,c),r.scaleFallOffFactor=(0,i.Cc)(u.scaleFallOffFactor,h.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(e,t,r){return(e.fovY-r.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,t,r){const i=t*t,n=r.tiltAngle+.5*Math.PI,{fovY:s,distance:o}=e,a=o*o+i-2*Math.cos(n)*o*t,l=Math.sqrt(a),c=Math.sqrt(a-i);return(Math.acos(c/l)-Math.asin(t/(l/Math.sin(n)))+.5*s)/s}}const p={curvatureDependent:{min:{curvature:(0,i.kU)(10),tiltAngle:(0,i.kU)(12),scaleFallOffFactor:.5},max:{curvature:(0,i.kU)(70),tiltAngle:(0,i.kU)(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},f={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};const m={scale:0,factor:0,minScaleFactor:0},g={tiltAngle:0,scaleFallOffFactor:0}},67737:(e,t,r)=>{"use strict";r.d(t,{G:()=>i,Q:()=>n});const i={stableRendering:!1},n={rootOrigin:null}},81330:(e,t,r)=>{"use strict";r.d(t,{IR:()=>a,Mv:()=>s,uT:()=>o,vM:()=>l});var i=r(50076);const n=16;function s(e){return Math.ceil(e/n)*n}function o(e){return Math.floor(e/n)*n}function a(e,t){let r=e.width*e.height;if(r<4096)return e instanceof ImageData?u(e):e;let i=e.width,n=e.height;do{i=Math.ceil(i/2),n=Math.ceil(n/2),r=i*n}while(r>1048576||null!=t&&(i>t||n>t));return c(e,i,n)}function l(e,t){const r=Math.max(e.width,e.height);if(r<=t)return e;const i=t/r;return c(e,Math.round(e.width*i),Math.round(e.height*i))}function c(e,t,r){if(e instanceof ImageData)return c(u(e),t,r);const i=document.createElement("canvas");return i.width=t,i.height=r,i.getContext("2d").drawImage(e,0,0,i.width,i.height),i}function u(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");if(null==r)throw new i.A("Failed to create 2d context from HTMLCanvasElement");return r.putImageData(e,0,0),t}},97974:(e,t,r)=>{"use strict";r.d(t,{XG:()=>y,dd:()=>v,dg:()=>d,fo:()=>b,ou:()=>m});var i=r(63919),n=r(44680),s=r(34761),o=r(13191),a=r(20664),l=r(9392),c=r(93582),u=r(64465),h=r(59231);class d{constructor(){this._transform=(0,o.vt)(),this._transformInverse=new p({value:this._transform},s.B8,o.vt),this._transformInverseTranspose=new p(this._transformInverse,s.mg,o.vt),this._transformTranspose=new p({value:this._transform},s.mg,o.vt),this._transformInverseRotation=new p({value:this._transform},i.dR,n.vt)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){(0,s.C)(this._transform,e)}multiplyTransform(e){(0,s.lw)(this._transform,this._transform,e)}set(e){(0,s.C)(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this._invalidateLazyTransforms()}}class p{constructor(e,t,r){this._original=e,this._update=t,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}const f=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.offset=e,this.sphere=(0,c.c)(),this.tmpVertex=(0,l.vt)()}applyToVertex(e,t,r){const i=this.objectTransform.transform,n=(0,a.s)(w,e,t,r),s=(0,a.h)(n,n,i),o=this.offset/(0,a.l)(s);(0,a.r)(s,s,s,o);const l=this.objectTransform.inverse;return(0,a.h)(this.tmpVertex,s,l),this.tmpVertex}applyToMinMax(e,t){const r=this.offset/(0,a.l)(e);(0,a.r)(e,e,e,r);const i=this.offset/(0,a.l)(t);(0,a.r)(t,t,t,i)}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const t=(0,a.l)((0,c.g)(e)),r=this.offset/t;return(0,a.r)((0,c.g)(this.sphere),(0,c.g)(e),(0,c.g)(e),r),this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}};function m(e){return null!=e?(f.offset=e,f):null}const g=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=(0,l.vt)(),this._tmpMbs=(0,c.c)(),this._tmpObb=new h.ab,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=(0,a.l)(e)}applyToVertex(e,t,r){const i=(0,a.s)(w,e,t,r),n=(0,a.s)(x,e,t,r+this.componentLocalOriginLength),s=this._totalOffset/(0,a.l)(n);return(0,a.r)(this._tmpVertex,i,n,s),this._tmpVertex}applyToAabb(e){const t=this.componentLocalOriginLength,r=e[0],i=e[1],n=e[2]+t,s=e[3],o=e[4],a=e[5]+t,l=Math.abs(r),c=Math.abs(i),u=Math.abs(n),h=Math.abs(s),d=Math.abs(o),p=Math.abs(a),f=.5*(1+Math.sign(r*s))*Math.min(l,h),m=.5*(1+Math.sign(i*o))*Math.min(c,d),g=.5*(1+Math.sign(n*a))*Math.min(u,p),y=Math.max(l,h),_=Math.max(c,d),v=Math.max(u,p),b=Math.sqrt(f*f+m*m+g*g),w=Math.sign(l+r),x=Math.sign(c+i),S=Math.sign(u+n),T=Math.sign(h+s),M=Math.sign(d+o),A=Math.sign(p+a),C=this._totalOffset;if(b<C)return e[0]-=(1-w)*C,e[1]-=(1-x)*C,e[2]-=(1-S)*C,e[3]+=T*C,e[4]+=M*C,e[5]+=A*C,e;const E=C/Math.sqrt(y*y+_*_+v*v),R=C/b,P=R-E,O=-P;return e[0]+=r*(w*O+R),e[1]+=i*(x*O+R),e[2]+=n*(S*O+R),e[3]+=s*(T*P+E),e[4]+=o*(M*P+E),e[5]+=a*(A*P+E),e}applyToMbs(e){const t=(0,a.l)((0,c.g)(e)),r=this._totalOffset/t;return(0,a.r)((0,c.g)(this._tmpMbs),(0,c.g)(e),(0,c.g)(e),r),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/t,this._tmpMbs}applyToObb(e){return(0,h.gm)(e,this._totalOffset,this._totalOffset,u.RT.Global,this._tmpObb),this._tmpObb}};function y(e){return null!=e?(g.offset=e,g):null}const _=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.offset=e,this.tmpVertex=(0,l.vt)()}applyToVertex(e,t,r){const i=(0,a.s)(w,e,t,r),n=(0,a.g)(x,i,this.localOrigin),s=this.offset/(0,a.l)(n);return(0,a.r)(this.tmpVertex,i,n,s),this.tmpVertex}applyToAabb(e){const t=S,r=T,i=M;for(let a=0;a<3;++a)t[a]=e[0+a]+this.localOrigin[a],r[a]=e[3+a]+this.localOrigin[a],i[a]=t[a];const n=this.applyToVertex(t[0],t[1],t[2]);for(let a=0;a<3;++a)e[a]=n[a],e[a+3]=n[a];const s=t=>{const r=this.applyToVertex(t[0],t[1],t[2]);for(let i=0;i<3;++i)e[i]=Math.min(e[i],r[i]),e[i+3]=Math.max(e[i+3],r[i])};for(let a=1;a<8;++a){for(let e=0;e<3;++e)i[e]=a&1<<e?r[e]:t[e];s(i)}let o=0;for(let a=0;a<3;++a)t[a]*r[a]<0&&(o|=1<<a);if(0!==o&&7!==o)for(let a=0;a<8;++a)if(!(o&a)){for(let e=0;e<3;++e)i[e]=o&1<<e?0:a&1<<e?t[e]:r[e];s(i)}for(let a=0;a<3;++a)e[a]-=this.localOrigin[a],e[a+3]-=this.localOrigin[a];return e}};function v(e){return null!=e?(_.offset=e,_):null}const b="terrain",w=(0,l.vt)(),x=(0,l.vt)(),S=(0,l.vt)(),T=(0,l.vt)(),M=(0,l.vt)()},71011:(e,t,r)=>{"use strict";r.d(t,{$p:()=>n,Qx:()=>o,_y:()=>s,e_:()=>a});var i=r(9392);class n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.vt)();this.intensity=e}}class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.vt)(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,i.fA)(.57735,.57735,.57735);this.intensity=e,this.direction=t}}class o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.vt)(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,i.fA)(.57735,.57735,.57735),r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this.intensity=e,this.direction=t,this.castShadows=r,this.specularStrength=n,this.environmentStrength=s}}class a{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},4998:(e,t,r)=>{"use strict";r.d(t,{TA:()=>M,uH:()=>T});var i=r(15941),n=r(20664),s=r(9392),o=r(71011);function a(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t[i];return r}function l(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t;return r}function c(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]+t[i];return r}function u(e){return(e+1)*(e+1)}function h(e,t,r){const i=e[0],n=e[1],s=e[2],o=r||[];return o.length=u(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*s,o[3]=.4886025119*n),t>=2&&(o[4]=1.09254843059*i*n,o[5]=1.09254843059*n*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*i*s,o[8]=.54627421529*(i*i-n*n)),o}function d(e,t){const r=u(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let n=0;n<r;n++)i.r[n]=i.g[n]=i.b[n]=0;return i}function p(e,t){const r=function(e){return(0,i.qE)(Math.floor(Math.sqrt(e)-1),0,2)}(t.r.length);for(const i of e)(0,n.k)(b,i.direction),h(b,r,_),a(_,w),l(_,i.intensity[0],v),c(t.r,v),l(_,i.intensity[1],v),c(t.g,v),l(_,i.intensity[2],v),c(t.b,v);return t}function f(e,t){h(b,0,_);for(const r of e)t.r[0]+=_[0]*w[0]*r.intensity[0]*4*Math.PI,t.g[0]+=_[0]*w[0]*r.intensity[1]*4*Math.PI,t.b[0]+=_[0]*w[0]*r.intensity[2]*4*Math.PI;return t}const m=[],g=[],y=[],_=[0],v=[0],b=(0,s.vt)(),w=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class x{constructor(){this.color=(0,s.vt)(),this.intensity=1}}class S{constructor(){this.direction=(0,s.vt)(),this.ambient=new x,this.diffuse=new x}}const T=.4;class M{constructor(){this._shOrder=2,this._legacy=new S,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new o.e_,this._mainLight=new o.Qx((0,s.vt)(),(0,s.fA)(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){(function(e,t,r,i){d(t,i),(0,n.s)(r.intensity,0,0,0);let s=!1;const a=m,l=g,u=y;a.length=0,l.length=0,u.length=0;for(const c of e)c instanceof o.Qx&&!s?((0,n.c)(r.direction,c.direction),(0,n.c)(r.intensity,c.intensity),r.specularStrength=c.specularStrength,r.environmentStrength=c.environmentStrength,r.castShadows=c.castShadows,s=!0):c instanceof o.Qx||c instanceof o._y?a.push(c):c instanceof o.$p?l.push(c):c instanceof o.e_&&u.push(c);p(a,i),f(l,i);for(const n of u)c(i.r,n.r),c(i.g,n.g),c(i.b,n.b)})(e,this._shOrder,this._mainLight,this._sphericalHarmonics),(0,n.c)(this._legacy.direction,this._mainLight.direction);const t=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,(0,n.j)(this._legacy.diffuse.color,this._mainLight.intensity,t),(0,n.c)(A,this._legacy.diffuse.color),(0,n.j)(A,A,T*this.globalFactor),(0,n.g)(this._legacy.ambient.color,this._legacy.ambient.color,A)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),(0,n.c)(this._mainLight.direction,e.mainLight.direction),(0,n.c)(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,t,r){if((0,n.o)(this._mainLight.intensity,e.mainLight.intensity,t.mainLight.intensity,r),this._mainLight.environmentStrength=(0,i.Cc)(e.mainLight.environmentStrength,t.mainLight.environmentStrength,r),this._mainLight.specularStrength=(0,i.Cc)(e.mainLight.specularStrength,t.mainLight.specularStrength,r),(0,n.c)(this._mainLight.direction,t.mainLight.direction),this._mainLight.castShadows=t.mainLight.castShadows,this.globalFactor=(0,i.Cc)(e.globalFactor,t.globalFactor,r),this.noonFactor=(0,i.Cc)(e.noonFactor,t.noonFactor,r),e.sh.r.length===t.sh.r.length)for(let n=0;n<t.sh.r.length;n++)this._sphericalHarmonics.r[n]=(0,i.Cc)(e.sh.r[n],t.sh.r[n],r),this._sphericalHarmonics.g[n]=(0,i.Cc)(e.sh.g[n],t.sh.g[n],r),this._sphericalHarmonics.b[n]=(0,i.Cc)(e.sh.b[n],t.sh.b[n],r);else for(let i=0;i<t.sh.r.length;i++)this._sphericalHarmonics.r[i]=t.sh.r[i],this._sphericalHarmonics.g[i]=t.sh.g[i],this._sphericalHarmonics.b[i]=t.sh.b[i]}}const A=(0,s.vt)()},76956:(e,t,r)=>{"use strict";r.d(t,{v:()=>P});var i=r(81806),n=r(55855),s=r(48549),o=r(34981),a=r(83490),l=r(59696),c=r(60322),u=r(77730),h=r(66470),d=r(82809),p=r(63928),f=r(93684),m=r(16506),g=r(42693),y=r(32119),_=r(28584),v=r(96643),b=r(10773),w=r(37923),x=r(93345),S=r(57162);f.S;class T extends g.w{initializeProgram(e){return new _.B(e.rctx,T.shader.get().build(this.configuration),y.D)}_createPipeline(e,t){const r=this.configuration,i=e===b.y.NONE,n=e===b.y.FrontFace;return(0,S.Ey)({blending:r.output===o.V.Color&&r.transparent?i?c.V0:(0,c.ez)(e):null,culling:(0,S.Xt)(r.cullFace),depthTest:r.draped?null:{func:(0,c.K_)(e)},depthWrite:r.draped?null:(i||n)&&r.writeDepth?S.kn:null,drawBuffers:r.output===o.V.Depth?{buffers:[x.Hr.NONE]}:(0,c.cl)(e),colorWrite:S.wE,stencilWrite:r.hasOccludees?v.v0:null,stencilTest:r.hasOccludees?t?v.a9:v.qh:null,polygonOffset:i||n?r.polygonOffset?M:null:(0,c.aB)(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}T.shader=new m.$(w.C,(()=>r.e(5837).then(r.bind(r,35837))));const M={factor:1,units:1};var A=r(35143),C=r(99415),E=r(92656);class R extends E.E{constructor(){super(...arguments),this.output=o.V.Color,this.cullFace=a.s2.None,this.transparencyPassType=b.y.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1}}(0,A._)([(0,C.W)({count:o.V.COUNT})],R.prototype,"output",void 0),(0,A._)([(0,C.W)({count:a.s2.COUNT})],R.prototype,"cullFace",void 0),(0,A._)([(0,C.W)({count:b.y.COUNT})],R.prototype,"transparencyPassType",void 0),(0,A._)([(0,C.W)()],R.prototype,"hasSlicePlane",void 0),(0,A._)([(0,C.W)()],R.prototype,"hasVertexColors",void 0),(0,A._)([(0,C.W)()],R.prototype,"transparent",void 0),(0,A._)([(0,C.W)()],R.prototype,"polygonOffset",void 0),(0,A._)([(0,C.W)()],R.prototype,"enableOffset",void 0),(0,A._)([(0,C.W)()],R.prototype,"writeDepth",void 0),(0,A._)([(0,C.W)()],R.prototype,"hasOccludees",void 0),(0,A._)([(0,C.W)()],R.prototype,"multipassEnabled",void 0),(0,A._)([(0,C.W)()],R.prototype,"cullAboveGround",void 0),(0,A._)([(0,C.W)()],R.prototype,"objectAndLayerIdColorInstanced",void 0),(0,A._)([(0,C.W)()],R.prototype,"vvColor",void 0),(0,A._)([(0,C.W)()],R.prototype,"draped",void 0),(0,A._)([(0,C.W)({constValue:!1})],R.prototype,"occlusionPass",void 0),(0,A._)([(0,C.W)({constValue:!0})],R.prototype,"hasVvInstancing",void 0),(0,A._)([(0,C.W)({constValue:!1})],R.prototype,"vvSize",void 0),(0,A._)([(0,C.W)({constValue:!1})],R.prototype,"vvOpacity",void 0);class P extends p.W{constructor(e){super(e,new I),this.supportsEdges=!0,this.produces=new Map([[u.N.OPAQUE_MATERIAL,e=>e===o.V.Highlight||(0,o.zW)(e)&&!this._isTransparent],[u.N.OPAQUE_NO_SSAO_DEPTH,e=>(0,o.eh)(e)&&this.parameters.writeLinearDepth&&!this._isTransparent],[u.N.TRANSPARENT_MATERIAL,e=>(0,o.zW)(e)&&this._isTransparent&&this.parameters.writeDepth],[u.N.TRANSPARENT_NO_SSAO_DEPTH,e=>(0,o.eh)(e)&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[u.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>((0,o.zW)(e)||(0,o.eh)(e)&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[u.N.DRAPED_MATERIAL,e=>(0,o.i3)(e)]]),this._configuration=new R}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<c.xt,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}createGLMaterial(e){return new O(e)}createBufferWriter(){const e=(0,s.BP)().vec3f(h.r.POSITION);return(0,i.A)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(h.r.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(h.r.COLORFEATUREATTRIBUTE):e.vec4u8(h.r.COLOR),new d.Z(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class O extends l.A{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===o.V.Color&&this._updateOccludeeState(e),this.ensureTechnique(T,e)}}class I extends f.S{constructor(){super(...arguments),this.color=n.uY,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=a.s2.None,this.hasOccludees=!1,this.draped=!1}}},82809:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var i=r(66470),n=r(52757);class s{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get(i.r.POSITION).indices.length}write(e,t,r,i,s){(0,n.SA)(r,this.vertexBufferLayout,e,t,i,s)}}},86401:(e,t,r)=>{"use strict";r.d(t,{Ci:()=>s,Dq:()=>l,dB:()=>a,zK:()=>o});var i=r(48549),n=r(66470);const s=(0,i.BP)().vec3f(n.r.POSITION),o=(0,i.BP)().vec3f(n.r.POSITION).vec2f(n.r.UV0),a=(0,i.BP)().vec3f(n.r.POSITION).vec4u8(n.r.COLOR),l=(0,i.BP)().vec3f(n.r.POSITION).vec2f(n.r.UV0).vec4u8(n.r.OBJECTANDLAYERIDCOLOR)},65131:(e,t,r)=>{"use strict";r.d(t,{$U:()=>I});var i=r(81806),n=r(20664),s=r(9392),o=r(64465),a=r(48549),l=r(34981),c=r(59046),u=r(27920),h=r(26719),d=r(83490),p=r(75803),f=r(45463),m=r(60322),g=r(48168),y=r(77730),_=r(66470),v=r(97974),b=r(82809),w=r(99362),x=r(37267),S=r(35143),T=r(97808),M=r(99415),A=r(10773),C=r(92656);class E extends C.E{constructor(){super(...arguments),this.output=l.V.Color,this.alphaDiscardMode=d.sf.Opaque,this.doubleSidedMode=u.W.None,this.pbrMode=h.A9.Disabled,this.cullFace=d.s2.None,this.transparencyPassType=A.y.NONE,this.normalType=c.W.Attribute,this.textureCoordinateType=T.q.None,this.customDepthTest=d.it.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}}(0,S._)([(0,M.W)({count:l.V.COUNT})],E.prototype,"output",void 0),(0,S._)([(0,M.W)({count:d.sf.COUNT})],E.prototype,"alphaDiscardMode",void 0),(0,S._)([(0,M.W)({count:u.W.COUNT})],E.prototype,"doubleSidedMode",void 0),(0,S._)([(0,M.W)({count:h.A9.COUNT})],E.prototype,"pbrMode",void 0),(0,S._)([(0,M.W)({count:d.s2.COUNT})],E.prototype,"cullFace",void 0),(0,S._)([(0,M.W)({count:A.y.COUNT})],E.prototype,"transparencyPassType",void 0),(0,S._)([(0,M.W)({count:c.W.COUNT})],E.prototype,"normalType",void 0),(0,S._)([(0,M.W)({count:T.q.COUNT})],E.prototype,"textureCoordinateType",void 0),(0,S._)([(0,M.W)({count:d.it.COUNT})],E.prototype,"customDepthTest",void 0),(0,S._)([(0,M.W)()],E.prototype,"spherical",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasVertexColors",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasSymbolColors",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasVerticalOffset",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasSlicePlane",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasSliceHighlight",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasColorTexture",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasMetallicRoughnessTexture",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasEmissionTexture",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasOcclusionTexture",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasNormalTexture",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasScreenSizePerspective",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasVertexTangents",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasOccludees",void 0),(0,S._)([(0,M.W)()],E.prototype,"multipassEnabled",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasModelTransformation",void 0),(0,S._)([(0,M.W)()],E.prototype,"offsetBackfaces",void 0),(0,S._)([(0,M.W)()],E.prototype,"vvSize",void 0),(0,S._)([(0,M.W)()],E.prototype,"vvColor",void 0),(0,S._)([(0,M.W)()],E.prototype,"receiveShadows",void 0),(0,S._)([(0,M.W)()],E.prototype,"receiveAmbientOcclusion",void 0),(0,S._)([(0,M.W)()],E.prototype,"textureAlphaPremultiplied",void 0),(0,S._)([(0,M.W)()],E.prototype,"instanced",void 0),(0,S._)([(0,M.W)()],E.prototype,"instancedColor",void 0),(0,S._)([(0,M.W)()],E.prototype,"objectAndLayerIdColorInstanced",void 0),(0,S._)([(0,M.W)()],E.prototype,"instancedDoublePrecision",void 0),(0,S._)([(0,M.W)()],E.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,S._)([(0,M.W)()],E.prototype,"writeDepth",void 0),(0,S._)([(0,M.W)()],E.prototype,"transparent",void 0),(0,S._)([(0,M.W)()],E.prototype,"enableOffset",void 0),(0,S._)([(0,M.W)()],E.prototype,"cullAboveGround",void 0),(0,S._)([(0,M.W)()],E.prototype,"snowCover",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasColorTextureTransform",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasEmissionTextureTransform",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasNormalTextureTransform",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasOcclusionTextureTransform",void 0),(0,S._)([(0,M.W)()],E.prototype,"hasMetallicRoughnessTextureTransform",void 0),(0,S._)([(0,M.W)({constValue:!1})],E.prototype,"occlusionPass",void 0),(0,S._)([(0,M.W)({constValue:!0})],E.prototype,"hasVvInstancing",void 0),(0,S._)([(0,M.W)({constValue:!1})],E.prototype,"useCustomDTRExponentForWater",void 0),(0,S._)([(0,M.W)({constValue:!1})],E.prototype,"supportsTextureAtlas",void 0),(0,S._)([(0,M.W)({constValue:!0})],E.prototype,"useFillLights",void 0);var R=r(16506),P=r(35249);class O extends x.R5{initializeConfiguration(e,t){super.initializeConfiguration(e,t),t.hasMetallicRoughnessTexture=!1,t.hasEmissionTexture=!1,t.hasOcclusionTexture=!1,t.hasNormalTexture=!1,t.hasModelTransformation=!1,t.normalType=c.W.Attribute,t.doubleSidedMode=u.W.WindingOrder,t.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,O.shader)}}O.shader=new R.$(P.R,(()=>r.e(7919).then(r.bind(r,77919))));class I extends f.im{constructor(e){super(e,D),this.supportsEdges=!0,this.produces=new Map([[y.N.OPAQUE_MATERIAL,e=>((0,l.XY)(e)||(0,l.PJ)(e))&&!this.parameters.transparent],[y.N.TRANSPARENT_MATERIAL,e=>((0,l.XY)(e)||(0,l.PJ)(e))&&this.parameters.transparent&&this.parameters.writeDepth],[y.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>((0,l.XY)(e)||(0,l.PJ)(e))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._configuration=new E,this._vertexBufferLayout=function(e){const t=(0,a.BP)().vec3f(_.r.POSITION);return e.normalType===c.W.Compressed?t.vec2i16(_.r.NORMALCOMPRESSED,{glNormalized:!0}):t.vec3f(_.r.NORMAL),e.hasVertexTangents&&t.vec4f(_.r.TANGENT),(e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId)&&t.vec2f(_.r.UV0),e.hasVertexColors&&t.vec4u8(_.r.COLOR),e.hasSymbolColors&&t.vec4u8(_.r.SYMBOLCOLOR),(0,i.A)("enable-feature:objectAndLayerId-rendering")&&t.vec4u8(_.r.OBJECTANDLAYERIDCOLOR),t}(this.parameters)}isVisibleForOutput(e){return e!==l.V.Shadow&&e!==l.V.ShadowExcludeHighlight&&e!==l.V.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||0===e.layerOpacity)return!1;const{hasInstancedColor:t,hasVertexColors:r,hasSymbolColors:i,vvColor:n}=e,s="replace"===e.colorMixMode,o=e.opacity>0,a=e.externalColor&&e.externalColor[3]>0,l=t||n||i;return r&&l?s||o:r?s?a:o:l?s||o:s?a:o}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,null!=this.parameters.customDepthTest&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?d.s2.None:this.parameters.cullFace,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=null!=this.parameters.modelTransformation,e===l.V.Color&&(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=u.W.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?u.W.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?u.W.WindingOrder:u.W.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=this.parameters.receiveAmbientOcclusion&&null!=t.ssao,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?h.A9.Schematic:h.A9.Normal:h.A9.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<m.xt,this._configuration.snowCover=this.hasSnowCover(t),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return null!=e.weather&&e.weatherVisible&&"snowy"===e.weather.type&&"enabled"===e.weather.snowCover}intersect(e,t,r,i,s,a){if(null!=this.parameters.verticalOffset){const e=r.camera;(0,n.s)(B,t[12],t[13],t[14]);let a=null;switch(r.viewingMode){case o.RT.Global:a=(0,n.n)(U,B);break;case o.RT.Local:a=(0,n.c)(U,z)}let l=0;const c=(0,n.f)(j,B,e.eye),u=(0,n.l)(c),h=(0,n.j)(c,c,1/u);let d=null;this.parameters.screenSizePerspective&&(d=(0,n.m)(a,h)),l+=(0,w.kE)(e,u,this.parameters.verticalOffset,d??0,this.parameters.screenSizePerspective),(0,n.j)(a,a,l),(0,n.t)(V,a,r.transform.inverseRotation),i=(0,n.f)(F,i,V),s=(0,n.f)(k,s,V)}(0,g.Uy)(e,r,i,s,(0,v.ou)(r.verticalOffset),a)}createGLMaterial(e){return new L(e)}createBufferWriter(){return new b.Z(this._vertexBufferLayout)}}class L extends p.m{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===l.V.Color&&(this._updateShadowState(e),this._updateOccludeeState(e));const t=this._material.parameters;this.updateTexture(t.textureId);const r=e.camera.viewInverseTransposeMatrix;return(0,n.s)(t.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(t.treeRendering?O:x.R5,e)}}class N extends x.uD{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const D=new N;const F=(0,s.vt)(),k=(0,s.vt)(),z=(0,s.fA)(0,0,1),U=(0,s.vt)(),V=(0,s.vt)(),B=(0,s.vt)(),j=(0,s.vt)()},50791:(e,t,r)=>{"use strict";r.d(t,{T:()=>i});const i=2.1},92656:(e,t,r)=>{"use strict";r.d(t,{E:()=>a});var i=r(35143),n=r(45937),s=r(24245),o=r(99415);class a extends n.nW{}(0,i._)([(0,o.W)({constValue:!0})],a.prototype,"hasSliceHighlight",void 0),(0,i._)([(0,o.W)({constValue:!1})],a.prototype,"hasSliceInVertexProgram",void 0),(0,i._)([(0,o.W)({constValue:s.c.Pass})],a.prototype,"pbrTextureBindType",void 0)},16699:(e,t,r)=>{"use strict";r.d(t,{P:()=>s});var i=r(9392),n=r(55386);class s extends n.gy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.vt)();super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}}},84248:(e,t,r)=>{"use strict";r.d(t,{R:()=>q});var i=r(81806),n=r(15941),s=r(63919),o=r(44680),a=r(34761),l=r(13191),c=r(72745),u=r(20664),h=r(9392),d=r(55855);function p(e){return function(e){return e instanceof Float32Array&&e.length>=16}(e)||function(e){return Array.isArray(e)&&e.length>=16}(e)}var f=r(2413),m=r(88105),g=r(63048),y=r(22955),_=r(48549),v=r(34981),b=r(40318),w=r(75803),x=r(45463),S=r(77730),T=r(12028),M=r(86994),A=r(66470),C=r(96791),E=r(52757),R=r(99362),P=r(19061),O=r(64465),I=r(16506),L=r(42693),N=r(32119),D=r(60322),F=r(28584),k=r(10773),z=r(93345),U=r(57162);class V extends L.w{initializeConfiguration(e,t){t.spherical=e.viewingMode===O.RT.Global}initializeProgram(e){return new F.B(e.rctx,V.shader.get().build(this.configuration),N.D)}initializePipeline(){const e=this.configuration.transparencyPassType,t=this.configuration,r=e===k.y.NONE,i=e===k.y.FrontFace,n=this.configuration.hasPolygonOffset?B:null,s=t.draped?null:(r||i)&&t.output!==v.V.Highlight&&(t.depthEnabled||t.occlusionPass)?U.kn:null;return(0,U.Ey)({blending:t.output===v.V.Color||t.output===v.V.Highlight?r?j:(0,D.ez)(e):null,depthTest:t.draped?null:{func:z.MT.LEQUAL},depthWrite:s,drawBuffers:(0,D.cl)(e),colorWrite:U.wE,polygonOffset:n})}get primitiveType(){return this.configuration.occlusionPass?z.WR.POINTS:z.WR.TRIANGLES}}V.shader=new I.$(P.H,(()=>r.e(271).then(r.bind(r,60271))));const B={factor:0,units:-4},j=(0,U.ox)(z.dn.ONE,z.dn.ONE_MINUS_SRC_ALPHA);var H=r(35143),G=r(99415),Z=r(92656);class $ extends Z.E{constructor(){super(...arguments),this.output=v.V.Color,this.transparencyPassType=k.y.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}(0,H._)([(0,G.W)({count:v.V.COUNT})],$.prototype,"output",void 0),(0,H._)([(0,G.W)({count:k.y.COUNT})],$.prototype,"transparencyPassType",void 0),(0,H._)([(0,G.W)()],$.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,H._)([(0,G.W)()],$.prototype,"spherical",void 0),(0,H._)([(0,G.W)()],$.prototype,"occlusionTestEnabled",void 0),(0,H._)([(0,G.W)()],$.prototype,"signedDistanceFieldEnabled",void 0),(0,H._)([(0,G.W)()],$.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,H._)([(0,G.W)()],$.prototype,"vvSize",void 0),(0,H._)([(0,G.W)()],$.prototype,"vvColor",void 0),(0,H._)([(0,G.W)()],$.prototype,"hasVerticalOffset",void 0),(0,H._)([(0,G.W)()],$.prototype,"hasScreenSizePerspective",void 0),(0,H._)([(0,G.W)()],$.prototype,"debugDrawLabelBorder",void 0),(0,H._)([(0,G.W)()],$.prototype,"hasSlicePlane",void 0),(0,H._)([(0,G.W)()],$.prototype,"hasPolygonOffset",void 0),(0,H._)([(0,G.W)()],$.prototype,"depthEnabled",void 0),(0,H._)([(0,G.W)()],$.prototype,"pixelSnappingEnabled",void 0),(0,H._)([(0,G.W)()],$.prototype,"draped",void 0),(0,H._)([(0,G.W)()],$.prototype,"multipassEnabled",void 0),(0,H._)([(0,G.W)()],$.prototype,"cullAboveGround",void 0),(0,H._)([(0,G.W)()],$.prototype,"occlusionPass",void 0),(0,H._)([(0,G.W)()],$.prototype,"objectAndLayerIdColorInstanced",void 0),(0,H._)([(0,G.W)({constValue:!0})],$.prototype,"hasSliceInVertexProgram",void 0),(0,H._)([(0,G.W)({constValue:!1})],$.prototype,"hasVvInstancing",void 0);class q extends x.im{constructor(e){super(e,new fe),this._configuration=new $,this.produces=new Map([[S.N.HUD_MATERIAL,e=>(0,v.dX)(e)&&!this.parameters.drawInSecondSlot],[S.N.LABEL_MATERIAL,e=>(0,v.dX)(e)&&this.parameters.drawInSecondSlot],[S.N.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[S.N.DRAPED_MATERIAL,e=>(0,v.dX)(e)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===S.N.OCCLUSION_PIXELS&&this.parameters.occlusionTest,e===v.V.Color&&(this._configuration.debugDrawLabelBorder=!!y.b.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,r,i,n,o){if(!(r.options.selectionMode&&r.options.hud&&e.visible&&r.point))return;const l=this.parameters,c=r.point,d=r.camera;let{scaleX:p,scaleY:f}=this._getScreenScale(e);p*=d.pixelRatio,f*=d.pixelRatio,(0,s.z0)(ie,t),e.attributes.has(A.r.FEATUREATTRIBUTE)&&function(e){const t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+r*r+i*i),h=1/Math.sqrt(n*n+s*s+o*o),d=1/Math.sqrt(a*a+l*l+c*c);e[0]=t*u,e[1]=r*u,e[2]=i*u,e[3]=n*h,e[4]=s*h,e[5]=o*h,e[6]=a*d,e[7]=l*d,e[8]=c*d}(ie);const m=e.attributes.get(A.r.POSITION),g=e.attributes.get(A.r.SIZE),y=e.attributes.get(A.r.NORMAL),_=e.attributes.get(A.r.CENTEROFFSETANDDISTANCE);(0,M.vA)(m.size>=3);const v=(0,P.c)(l),b="screen"===this.parameters.centerOffsetUnits;for(let s=0;s<m.data.length/m.size;s++){const e=s*m.size;(0,u.s)(K,m.data[e],m.data[e+1],m.data[e+2]),(0,u.h)(K,K,t);const i=s*g.size;de[0]=g.data[i]*p,de[1]=g.data[i+1]*f,(0,u.h)(K,K,d.viewMatrix);const n=s*_.size;if((0,u.s)(oe,_.data[n],_.data[n+1],_.data[n+2]),!b&&(K[0]+=oe[0],K[1]+=oe[1],0!==oe[2])){const e=oe[2];(0,u.n)(oe,K),(0,u.f)(K,K,(0,u.j)(oe,oe,e))}const w=s*y.size;if((0,u.s)(Q,y.data[w],y.data[w+1],y.data[w+2]),Y(Q,ie,d,ce),this._applyVerticalOffsetTransformationView(K,ce,d,J),d.applyProjection(K,ee),ee[0]>-1){b&&(oe[0]||oe[1])&&(ee[0]+=oe[0]*d.pixelRatio,0!==oe[1]&&(ee[1]+=(0,T.m0)(oe[1],J.factorAlignment)*d.pixelRatio),d.unapplyProjection(ee,K)),ee[0]+=this.parameters.screenOffset[0]*d.pixelRatio,ee[1]+=this.parameters.screenOffset[1]*d.pixelRatio,ee[0]=Math.floor(ee[0]),ee[1]=Math.floor(ee[1]),(0,T.MD)(de,J.factor,de);const e=ue*d.pixelRatio;let t=0;if(l.textureIsSignedDistanceField&&(t=l.outlineSize*d.pixelRatio/2),X(c,ee[0],ee[1],de,e,t,l,v)){const e=r.ray;if((0,u.h)(re,K,(0,a.B8)(se,d.viewMatrix)),ee[0]=c[0],ee[1]=c[1],d.unprojectFromRenderScreen(ee,K)){const t=(0,h.vt)();(0,u.c)(t,e.direction);const r=1/(0,u.l)(t);(0,u.j)(t,t,r),o((0,u.p)(e.origin,K)*r,t,-1,!0,1,re)}}}}}intersectDraped(e,t,r,i,n,s){const o=e.attributes.get(A.r.POSITION),a=e.attributes.get(A.r.SIZE),l=this.parameters,c=(0,P.c)(l);let{scaleX:u,scaleY:h}=this._getScreenScale(e);u*=e.screenToWorldRatio,h*=e.screenToWorldRatio;const d=he*e.screenToWorldRatio;for(let p=0;p<o.data.length/o.size;p++){const t=p*o.size,r=o.data[t],f=o.data[t+1],m=p*a.size;de[0]=a.data[m]*u,de[1]=a.data[m+1]*h;let g=0;l.textureIsSignedDistanceField&&(g=l.outlineSize*e.screenToWorldRatio/2),X(i,r,f,de,d,g,l,c)&&n(s.dist,s.normal,-1,!1)}}createBufferWriter(){return new ye(this)}_updateScaleInfo(e,t,r){const i=this.parameters;null!=i.screenSizePerspective?(0,T.cJ)(r,t,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),null!=i.screenSizePerspectiveAlignment?(0,T.cJ)(r,t,i.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,t,r,i,n,s,o){const a=Y(t,r,n,ce);return this._applyVerticalGroundOffsetView(e,a,n,o),this._applyVerticalOffsetTransformationView(o,a,n,s),this._applyPolygonOffsetView(o,a,i[3],n,o),this._applyCenterOffsetView(o,i,o),o}applyShaderOffsetsNDC(e,t,r,i,n){return this._applyCenterOffsetNDC(e,t,r,i),null!=n&&(0,u.c)(n,i),this._applyPolygonOffsetNDC(i,t,r,i),i}_applyPolygonOffsetView(e,t,r,i,s){const o=i.aboveGround?1:-1;let a=Math.sign(r);0===a&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return(0,u.c)(s,e);const c=(0,n.qE)(Math.abs(t.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/i.viewport[2];return(0,u.j)(s,e,l>0?h:1/h),s}_applyVerticalGroundOffsetView(e,t,r,i){const n=(0,u.l)(e),s=r.aboveGround?1:-1,o=r.computeRenderPixelSizeAtDist(n)*b.R,a=(0,u.j)(K,t.normal,s*o);return(0,u.g)(i,e,a),i}_applyVerticalOffsetTransformationView(e,t,r,i){const n=this.parameters;if(!n.verticalOffset?.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const r=(0,u.l)(e);this._updateScaleInfo(i,r,t.cosAngle)}else i.factor.scale=1,i.factorAlignment.scale=1;return e}const s=(0,u.l)(e),o=n.screenSizePerspectiveAlignment??n.screenSizePerspective,a=(0,R.kE)(r,s,n.verticalOffset,t.cosAngle,o);return this._updateScaleInfo(i,s,t.cosAngle),(0,u.j)(t.normal,t.normal,a),(0,u.g)(e,e,t.normal)}_applyCenterOffsetView(e,t,r){const i="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,u.c)(r,e),i&&(r[0]+=t[0],r[1]+=t[1],t[2]&&((0,u.n)(Q,r),(0,u.g)(r,r,(0,u.j)(Q,Q,t[2])))),r}_applyCenterOffsetNDC(e,t,r,i){const n="screen"!==this.parameters.centerOffsetUnits;return i!==e&&(0,u.c)(i,e),n||(i[0]+=t[0]/r.fullWidth*2,i[1]+=t[1]/r.fullHeight*2),i}_applyPolygonOffsetNDC(e,t,r,i){const n=this.parameters.shaderPolygonOffset;if(e!==i&&(0,u.c)(i,e),n){const e=r.aboveGround?1:-1,s=e*Math.sign(t[3]);i[2]-=(s||e)*n}return i}createGLMaterial(e){return new W(e)}calculateRelativeScreenBounds(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,f.vt)();return function(e,t,r,i){i[0]=e.anchorPosition[0]*-t[0]+e.screenOffset[0]*r,i[1]=e.anchorPosition[1]*-t[1]+e.screenOffset[1]*r}(this.parameters,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e){const t=e.attributes.get(A.r.FEATUREATTRIBUTE);if(null==t)return{scaleX:1,scaleY:1};const r=(0,d.ci)(t.data,le),[i,n]=(0,g.VC)(ae,this.parameters,r);return{scaleX:i,scaleY:n}}}class W extends w.m{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(V,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}function Y(e,t,r,i){return p(t)&&(t=(0,s.z0)(ne,t)),(0,u.t)(i.normal,e,t),(0,u.h)(i.normal,i.normal,r.viewInverseTransposeMatrix),i.cosAngle=(0,u.m)(te,pe),i}function X(e,t,r,i,n,s,o,a){let l=t-n-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*n,u=r-n-(a[1]>0?i[1]*a[1]:0),h=u+i[1]+2*n;const d=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&null!=d&&(l+=i[0]*d[0],u+=i[1]*d[1],c-=i[0]*(1-d[2]),h-=i[1]*(1-d[3]),l-=s,c+=s,u-=s,h+=s),e[0]>l&&e[0]<c&&e[1]>u&&e[1]<h}const J=new C.D,K=(0,h.vt)(),Q=(0,h.vt)(),ee=(0,d.vt)(),te=(0,h.vt)(),re=(0,h.vt)(),ie=(0,o.vt)(),ne=(0,o.vt)(),se=(0,l.vt)(),oe=(0,h.vt)(),ae=(0,h.vt)(),le=(0,d.vt)(),ce={normal:te,cosAngle:0},ue=1,he=2,de=[0,0],pe=(0,h.fA)(0,0,1);class fe extends w.N{constructor(){super(...arguments),this.renderOccluded=x.m$.Occlude,this.isDecoration=!1,this.color=(0,d.fA)(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=(0,c.fA)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,d.fA)(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1}}const me=(0,_.BP)().vec3f(A.r.POSITION).vec3f(A.r.NORMAL).vec2f(A.r.UV0).vec4u8(A.r.COLOR).vec2f(A.r.SIZE).vec4f(A.r.CENTEROFFSETANDDISTANCE).vec4f(A.r.FEATUREATTRIBUTE),ge=me.clone().vec4u8(A.r.OBJECTANDLAYERIDCOLOR);class ye{constructor(e){this._material=e,this.vertexBufferLayout=(0,i.A)("enable-feature:objectAndLayerId-rendering")?ge:me}elementCount(e){return 6*e.attributes.get(A.r.POSITION).indices.length}write(e,t,r,i,n){(0,E.Hk)(r.attributes.get(A.r.POSITION),e,i.position,n,6),(0,E.p1)(r.attributes.get(A.r.NORMAL),t,i.normal,n,6);const s=r.attributes.get(A.r.UV0).data;let o,a,l,c;if(null==s||s.length<4){const e=this._material.parameters;o=0,a=0,l=e.texCoordScale[0],c=e.texCoordScale[1]}else o=s[0],a=s[1],l=s[2],c=s[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);let u=r.attributes.get(A.r.POSITION).indices.length,h=n;const d=i.uv0;for(let m=0;m<u;++m)d.set(h,0,o),d.set(h,1,a),h++,d.set(h,0,l),d.set(h,1,a),h++,d.set(h,0,l),d.set(h,1,c),h++,d.set(h,0,l),d.set(h,1,c),h++,d.set(h,0,o),d.set(h,1,c),h++,d.set(h,0,o),d.set(h,1,a),h++;(0,E.tb)(r.attributes.get(A.r.COLOR),4,i.color,n,6);const{data:p,indices:f}=r.attributes.get(A.r.SIZE);u=f.length;const g=i.size;h=n;for(let m=0;m<u;++m){const e=p[2*f[m]],t=p[2*f[m]+1];for(let r=0;r<6;++r)g.set(h,0,e),g.set(h,1,t),h++}if(r.attributes.get(A.r.CENTEROFFSETANDDISTANCE)?(0,E.Ut)(r.attributes.get(A.r.CENTEROFFSETANDDISTANCE),i.centerOffsetAndDistance,n,6):(0,E.Pq)(i.centerOffsetAndDistance,n,6*u),r.attributes.get(A.r.FEATUREATTRIBUTE)?(0,E.Ut)(r.attributes.get(A.r.FEATUREATTRIBUTE),i.featureAttribute,n,6):(0,E.Pq)(i.featureAttribute,n,6*u),null!=r.objectAndLayerIdColor){const e=r.attributes.get(A.r.POSITION)?.indices;if(e){const t=e.length,s=i.getField(A.r.OBJECTANDLAYERIDCOLOR,m.XP);(0,E.tH)(r.objectAndLayerIdColor,s,t,n,6)}}}}},60561:(e,t,r)=>{"use strict";r.d(t,{i:()=>M});var i=r(20664),n=r(9392),s=r(48549),o=r(34981),a=r(75803),l=r(45463),c=r(77730),u=r(66470),h=r(93684),d=r(16506),p=r(42693),f=r(60322),m=r(28584),g=r(96643),y=r(10773),_=r(88849),v=r(50125),b=r(93345),w=r(57162);const x=new Map([[u.r.POSITION,0],[u.r.PREVPOSITION,1],[u.r.UV0,2],[u.r.NORMAL,3],[u.r.COLOR,4],[u.r.COLORFEATUREATTRIBUTE,4],[u.r.SIZE,5],[u.r.SIZEFEATUREATTRIBUTE,5],[u.r.OPACITYFEATUREATTRIBUTE,6]]);class S extends p.w{initializeProgram(e){return new m.B(e.rctx,S.shader.get().build(this.configuration),x)}_makePipelineState(e,t){const r=this.configuration,i=e===y.y.NONE;return(0,w.Ey)({blending:r.output===o.V.Color?i?f.V0:(0,f.ez)(e):null,depthTest:r.space===v.lM.Draped?null:{func:(0,f.K_)(e)},depthWrite:r.space===v.lM.Draped?null:i?r.writeDepth?w.kn:null:(0,f.XO)(e),drawBuffers:r.output===o.V.Depth?{buffers:[b.Hr.NONE]}:(0,f.cl)(e),colorWrite:w.wE,stencilWrite:r.hasOccludees?g.v0:null,stencilTest:r.hasOccludees?t?g.a9:g.qh:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=(0,w.Ey)({blending:f.V0,depthTest:g.sf,depthWrite:null,colorWrite:w.wE,stencilWrite:null,stencilTest:g.mK}),this._occluderPipelineOpaque=(0,w.Ey)({blending:f.V0,depthTest:g.sf,depthWrite:null,colorWrite:w.wE,stencilWrite:g.r8,stencilTest:g.I$}),this._occluderPipelineMaskWrite=(0,w.Ey)({blending:null,depthTest:g.m,depthWrite:null,colorWrite:null,stencilWrite:g.v0,stencilTest:g.a9})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,t,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}S.shader=new d.$(_.L,(()=>r.e(6419).then(r.bind(r,66419))));var T=r(46259);class M extends l.im{constructor(e){super(e,new C),this.produces=new Map([[c.N.OPAQUE_MATERIAL,e=>e===o.V.Highlight||(0,o._o)(e)&&this.parameters.renderOccluded===l.m$.OccludeAndTransparentStencil],[c.N.OPAQUE_NO_SSAO_DEPTH,e=>(0,o.eh)(e)],[c.N.OCCLUDER_MATERIAL,e=>(0,o.aD)(e)&&this.parameters.renderOccluded===l.m$.OccludeAndTransparentStencil],[c.N.TRANSPARENT_OCCLUDER_MATERIAL,e=>(0,o.aD)(e)&&this.parameters.renderOccluded===l.m$.OccludeAndTransparentStencil],[c.N.TRANSPARENT_MATERIAL,e=>(0,o._o)(e)&&this.parameters.writeDepth],[c.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>(0,o._o)(e)&&!this.parameters.writeDepth],[c.N.DRAPED_MATERIAL,e=>e===o.V.Color||e===o.V.Highlight]]),this._vertexAttributeLocations=x,this._configuration=new v.Dt,this._layout=this.createLayout()}getConfiguration(e,t){return this._configuration.output=e,this._configuration.space=t.slot===c.N.DRAPED_MATERIAL?v.lM.Draped:this.parameters.worldSpace?v.lM.World:v.lM.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==T.x.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===l.m$.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=(0,s.BP)().vec3f(u.r.POSITION).vec3f(u.r.PREVPOSITION).vec2f(u.r.UV0);return this.parameters.worldSpace&&e.vec3f(u.r.NORMAL),this.parameters.vvSize?e.f32(u.r.SIZEFEATUREATTRIBUTE):e.f32(u.r.SIZE),this.parameters.vvColor?e.f32(u.r.COLORFEATUREATTRIBUTE):e.vec4f(u.r.COLOR),this.parameters.vvOpacity&&e.f32(u.r.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new E(this._layout,this.parameters)}createGLMaterial(e){return new A(e)}}class A extends a.m{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextures.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const t=this._material.parameters.markerPrimitive;return t!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextures.swap(t,this._markerPrimitive)}),this._markerPrimitive=t),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(S,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===o.V.Color&&this._updateOccludeeState(e),this._updateParameters(e)}}class C extends h.S{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=T.x.BUTT,this.anchor=v.kJ.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}}class E{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t}elementCount(){return"begin-end"===this._parameters.placement?12:6}write(e,t,r,n,s){const o=r.attributes.get(u.r.POSITION).data,a=o.length/3;let l=[1,0,0];const c=r.attributes.get(u.r.NORMAL);this._parameters.worldSpace&&null!=c&&(l=c.data);let h=1,d=0;this._parameters.vvSize?d=r.attributes.get(u.r.SIZEFEATUREATTRIBUTE).data[0]:r.attributes.has(u.r.SIZE)&&(h=r.attributes.get(u.r.SIZE).data[0]);let p=[1,1,1,1],f=0;this._parameters.vvColor?f=r.attributes.get(u.r.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(u.r.COLOR)&&(p=r.attributes.get(u.r.COLOR).data);let m=0;this._parameters.vvOpacity&&(m=r.attributes.get(u.r.OPACITYFEATUREATTRIBUTE).data[0]);const g=new Float32Array(n.buffer);let y=s*(this.vertexBufferLayout.stride/4);const _=(e,t,r,i)=>{if(g[y++]=e[0],g[y++]=e[1],g[y++]=e[2],g[y++]=t[0],g[y++]=t[1],g[y++]=t[2],g[y++]=r[0],g[y++]=r[1],this._parameters.worldSpace&&(g[y++]=l[0],g[y++]=l[1],g[y++]=l[2]),this._parameters.vvSize?g[y++]=d:g[y++]=h,this._parameters.vvColor)g[y++]=f;else{const e=Math.min(4*i,p.length-4);g[y++]=p[e],g[y++]=p[e+1],g[y++]=p[e+2],g[y++]=p[e+3]}this._parameters.vvOpacity&&(g[y++]=m)};let v;!function(e){e[e.ASCENDING=1]="ASCENDING",e[e.DESCENDING=-1]="DESCENDING"}(v||(v={}));const b=(t,r)=>{const n=(0,i.s)(R,o[3*t],o[3*t+1],o[3*t+2]),s=P;let l=t+r;do{(0,i.s)(s,o[3*l],o[3*l+1],o[3*l+2]),l+=r}while((0,i.G)(n,s)&&l>=0&&l<a);e&&((0,i.h)(n,n,e),(0,i.h)(s,s,e)),_(n,s,[-1,-1],t),_(n,s,[1,-1],t),_(n,s,[1,1],t),_(n,s,[-1,-1],t),_(n,s,[1,1],t),_(n,s,[-1,1],t)},w=this._parameters.placement;"begin"!==w&&"begin-end"!==w||b(0,v.ASCENDING),"end"!==w&&"begin-end"!==w||b(a-1,v.DESCENDING)}}const R=(0,n.vt)(),P=(0,n.vt)()},30250:(e,t,r)=>{"use strict";var i;r.d(t,{O:()=>i}),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"}(i||(i={}))},73999:(e,t,r)=>{"use strict";r.d(t,{f:()=>n});var i=r(90632);class n{constructor(e,t,r){this._createTexture=e,this._parametersKey=t,this._repository=new Map,this._orphanCache=r.newCache(`procedural-texture-repository:${(0,i.c)()}`,(e=>e.dispose()))}destroy(){for(const[e,{texture:t}]of this._repository)t.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r=this._acquire(e);return this.release(t),r}release(e){if(null==e)return;const t=this._parametersKey(e),r=this._repository.get(t);if(r&&(r.refCount--,0===r.refCount)){this._repository.delete(t);const{texture:e}=r,i=e.usedMemory;this._orphanCache.put(t,e,i)}}_acquire(e){if(null==e)return null;const t=this._parametersKey(e),r=this._repository.get(t);if(r)return r.refCount++,r.texture;const i=this._orphanCache.pop(t)??this._createTexture(e),n=new s(i);return this._repository.set(t,n),i}}class s{constructor(e){this.texture=e,this.refCount=1}}},425:(e,t,r)=>{"use strict";r.d(t,{W:()=>k});var i=r(81806),n=r(76460),s=r(15941),o=r(76931),a=r(19555),l=r(20664),c=r(9392),u=r(55855),h=r(4763),d=r(44230),p=r(13927),f=r(48549),m=r(34981),g=r(59696),y=r(45463),_=r(77730),v=r(86994),b=r(66470),w=r(93684),x=r(50125),S=r(14623),T=r(16506),M=r(42693),A=r(60322),C=r(28584),E=r(96643),R=r(10773),P=r(93345),O=r(57162);const I=new Map([[b.r.POSITION,0],[b.r.PREVPOSITION,1],[b.r.NEXTPOSITION,2],[b.r.SUBDIVISIONFACTOR,3],[b.r.UV0,4],[b.r.COLOR,5],[b.r.COLORFEATUREATTRIBUTE,5],[b.r.SIZE,6],[b.r.SIZEFEATUREATTRIBUTE,6],[b.r.OPACITYFEATUREATTRIBUTE,7],[b.r.OBJECTANDLAYERIDCOLOR,8]]);class L extends M.w{initializeProgram(e){return new C.B(e.rctx,L.shader.get().build(this.configuration),I)}_makePipelineState(e,t){const r=this.configuration,i=e===R.y.NONE,n=e===R.y.FrontFace,s=(0,m.cb)(r.output);return(0,O.Ey)({blending:r.output===m.V.Color?i?A.V0:(0,A.ez)(e):null,depthTest:{func:(0,A.K_)(e)},depthWrite:i?r.writeDepth||s?O.kn:null:(0,A.XO)(e),drawBuffers:r.output===m.V.Depth?{buffers:[P.Hr.NONE]}:(0,A.cl)(e),colorWrite:O.wE,stencilWrite:r.hasOccludees?E.v0:null,stencilTest:r.hasOccludees?t?E.a9:E.qh:null,polygonOffset:i||n?r.hasPolygonOffset?N:null:A.SE})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset?N:null;this._occluderPipelineTransparent=(0,O.Ey)({blending:A.V0,polygonOffset:t,depthTest:E.sf,depthWrite:null,colorWrite:O.wE,stencilWrite:null,stencilTest:E.mK,drawBuffers:e.output===m.V.Depth?{buffers:[P.Hr.NONE]}:null}),this._occluderPipelineOpaque=(0,O.Ey)({blending:A.V0,polygonOffset:t,depthTest:E.sf,depthWrite:null,colorWrite:O.wE,stencilWrite:E.r8,stencilTest:E.I$,drawBuffers:e.output===m.V.Depth?{buffers:[P.Hr.NONE]}:null}),this._occluderPipelineMaskWrite=(0,O.Ey)({blending:null,polygonOffset:t,depthTest:E.m,depthWrite:null,colorWrite:null,stencilWrite:E.v0,stencilTest:E.a9,drawBuffers:e.output===m.V.Depth?{buffers:[P.Hr.NONE]}:null})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?P.WR.LINES:P.WR.TRIANGLE_STRIP}getPipeline(e,t,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}L.shader=new T.$(S.R,(()=>r.e(1721).then(r.bind(r,61721))));const N={factor:0,units:-4};var D,F=r(46259);!function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"}(D||(D={}));class k extends y.im{constructor(e){super(e,new U),this._configuration=new F.Q,this.produces=new Map([[_.N.OPAQUE_MATERIAL,e=>e===m.V.Highlight||e===m.V.ObjectAndLayerIdColor||e===m.V.Color&&this.parameters.renderOccluded===y.m$.OccludeAndTransparentStencil],[_.N.OPAQUE_NO_SSAO_DEPTH,e=>(0,m.eh)(e)],[_.N.OCCLUDER_MATERIAL,e=>(0,m.MO)(e)&&this.parameters.renderOccluded===y.m$.OccludeAndTransparentStencil],[_.N.TRANSPARENT_OCCLUDER_MATERIAL,e=>(0,m.MO)(e)&&this.parameters.renderOccluded===y.m$.OccludeAndTransparentStencil],[_.N.TRANSPARENT_MATERIAL,e=>e===m.V.Color&&this.parameters.writeDepth&&this.parameters.renderOccluded!==y.m$.OccludeAndTransparentStencil],[_.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>e===m.V.Color&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==y.m$.OccludeAndTransparentStencil],[_.N.DRAPED_MATERIAL,e=>(0,m.i3)(e)]]),this._vertexAttributeLocations=I}getConfiguration(e,t){this._configuration.output=e,this._configuration.draped=t.slot===_.N.DRAPED_MATERIAL;const r=null!=this.parameters.stipplePattern&&e!==m.V.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&null!=this.parameters.stippleOffColor,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=null!=this.parameters.markerParameters&&function(e){return e.anchor===x.kJ.Tip&&e.hideOnShortSegments&&"begin-end"===e.placement&&e.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&null!=this.parameters.innerColor,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===y.m$.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,t,r,i,n,o){if(!r.options.selectionMode)return;const a=e.attributes.get(b.r.POSITION).data,l=e.attributes.get(b.r.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const t=e.attributes.get(b.r.SIZEFEATUREATTRIBUTE).data[0];c*=(0,s.qE)(this.parameters.vvSize.offset[0]+t*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=i[0],h=i[1],d=(c/2+4)*e.screenToWorldRatio;let p=Number.MAX_VALUE,f=0;for(let m=0;m<a.length-5;m+=3){const e=a[m],t=a[m+1],r=u-e,i=h-t,n=a[m+3]-e,o=a[m+4]-t,l=(0,s.qE)((n*r+o*i)/(n*n+o*o),0,1),c=n*l-r,d=o*l-i,g=c*c+d*d;g<p&&(p=g,f=m/3)}p<d*d&&n(o.dist,o.normal,f,!1)}intersect(e,t,r,i,o,c){if(!r.options.selectionMode||!e.visible)return;if(!(0,v.zH)(t))return void n.A.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const u=e.attributes,f=u.get(b.r.POSITION).data;let m=this.parameters.width;if(this.parameters.vvSize){const e=u.get(b.r.SIZEFEATUREATTRIBUTE).data[0];m*=(0,s.qE)(this.parameters.vvSize.offset[0]+e*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else u.has(b.r.SIZE)&&(m*=u.get(b.r.SIZE).data[0]);const g=r.camera,y=q;(0,a.C)(y,r.point);const _=m*g.pixelRatio/2+4*g.pixelRatio;(0,l.s)(ie[0],y[0]-_,y[1]+_,0),(0,l.s)(ie[1],y[0]+_,y[1]+_,0),(0,l.s)(ie[2],y[0]+_,y[1]-_,0),(0,l.s)(ie[3],y[0]-_,y[1]-_,0);for(let n=0;n<4;n++)if(!g.unprojectFromRenderScreen(ie[n],ne[n]))return;(0,p.Cr)(g.eye,ne[0],ne[1],se),(0,p.Cr)(g.eye,ne[1],ne[2],oe),(0,p.Cr)(g.eye,ne[2],ne[3],ae),(0,p.Cr)(g.eye,ne[3],ne[0],le);let w=Number.MAX_VALUE,x=0;const S=j(this.parameters,u)?f.length-2:f.length-5;for(let n=0;n<S;n+=3){H[0]=f[n]+t[12],H[1]=f[n+1]+t[13],H[2]=f[n+2]+t[14];const e=(n+3)%f.length;if(G[0]=f[e]+t[12],G[1]=f[e+1]+t[13],G[2]=f[e+2]+t[14],(0,p.mN)(se,H)<0&&(0,p.mN)(se,G)<0||(0,p.mN)(oe,H)<0&&(0,p.mN)(oe,G)<0||(0,p.mN)(ae,H)<0&&(0,p.mN)(ae,G)<0||(0,p.mN)(le,H)<0&&(0,p.mN)(le,G)<0)continue;if(g.projectToRenderScreen(H,W),g.projectToRenderScreen(G,Y),W[2]<0&&Y[2]>0){(0,l.f)(Z,H,G);const e=g.frustum,t=-(0,p.mN)(e[h.FB.NEAR],H)/(0,l.m)(Z,(0,p.Qj)(e[h.FB.NEAR]));(0,l.j)(Z,Z,t),(0,l.g)(H,H,Z),g.projectToRenderScreen(H,W)}else if(W[2]>0&&Y[2]<0){(0,l.f)(Z,G,H);const e=g.frustum,t=-(0,p.mN)(e[h.FB.NEAR],G)/(0,l.m)(Z,(0,p.Qj)(e[h.FB.NEAR]));(0,l.j)(Z,Z,t),(0,l.g)(G,G,Z),g.projectToRenderScreen(G,Y)}else if(W[2]<0&&Y[2]<0)continue;W[2]=0,Y[2]=0;const r=(0,d.kb)((0,d.Cr)(W,Y,K),y);r<w&&(w=r,(0,l.c)(X,H),(0,l.c)(J,G),x=n/3)}const T=r.rayBegin,M=r.rayEnd;if(w<_*_){let e=Number.MAX_VALUE;if((0,d.ld)((0,d.Cr)(X,J,K),(0,d.Cr)(T,M,Q),$)){(0,l.f)($,$,T);const t=(0,l.l)($);(0,l.j)($,$,1/t),e=t/(0,l.p)(T,M)}c(e,$,x,!1)}}get _layout(){const e=(0,f.BP)().vec3f(b.r.POSITION).vec3f(b.r.PREVPOSITION).vec3f(b.r.NEXTPOSITION).f32(b.r.SUBDIVISIONFACTOR).vec2f(b.r.UV0);return this.parameters.vvSize?e.f32(b.r.SIZEFEATUREATTRIBUTE):e.f32(b.r.SIZE),this.parameters.vvColor?e.f32(b.r.COLORFEATUREATTRIBUTE):e.vec4f(b.r.COLOR),this.parameters.vvOpacity&&e.f32(b.r.OPACITYFEATUREATTRIBUTE),(0,i.A)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(b.r.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new V(this._layout,this.parameters)}createGLMaterial(e){return new z(e)}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0),null!=e.markerParameters&&(e.markerScale=e.markerParameters.width/e.width)}}class z extends g.A{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===m.V.Color&&this._updateOccludeeState(e);const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(t,this._stipplePattern)}),this._stipplePattern=t),this.ensureTechnique(L,e)}}class U extends w.S{constructor(){super(...arguments),this.width=0,this.color=u.Un,this.join="miter",this.cap=F.x.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class V{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t,this.numJoinSubdivisions=0;const r=t.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=S.r+r}}_isClosed(e){return j(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=e.attributes.get(b.r.POSITION).indices.length/2+1,r=this._isClosed(e);let i=r?2:4;return i+=((r?t:t-1)-(r?0:1))*(2*this.numJoinSubdivisions+4),i+=2,this._parameters.wireframe&&(i=2+4*(i-2)),i}write(e,t,r,n,s){const o=ee,a=te,c=re,u=r.attributes.get(b.r.POSITION),h=u.indices,d=u.data.length/3,p=r.attributes.get(b.r.DISTANCETOSTART)?.data;h&&h.length!==2*(d-1)&&console.warn("RibbonLineMaterial does not support indices");const f=r.attributes.get(b.r.SIZEFEATUREATTRIBUTE)?.data[0]??r.attributes.get(b.r.SIZE)?.data[0]??1;let m=[1,1,1,1],g=0;const y=this.vertexBufferLayout.fields.has(b.r.COLORFEATUREATTRIBUTE);y?g=r.attributes.get(b.r.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(b.r.COLOR)&&(m=r.attributes.get(b.r.COLOR).data);const _=(0,i.A)("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null,v=this.vertexBufferLayout.fields.has(b.r.OPACITYFEATUREATTRIBUTE),w=v?r.attributes.get(b.r.OPACITYFEATUREATTRIBUTE).data[0]:0,x=new Float32Array(n.buffer),S=(0,i.A)("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,T=this.vertexBufferLayout.stride/4;let M=s*T;const A=M;let C=0;const E=p?(e,t,r)=>C=p[r]:(e,t,r)=>C+=(0,l.p)(e,t),R=(0,i.A)("enable-feature:objectAndLayerId-rendering"),P=(e,t,r,i,n,s,o)=>{if(x[M++]=t[0],x[M++]=t[1],x[M++]=t[2],x[M++]=e[0],x[M++]=e[1],x[M++]=e[2],x[M++]=r[0],x[M++]=r[1],x[M++]=r[2],x[M++]=i,x[M++]=o,x[M++]=n,x[M++]=f,y)x[M++]=g;else{const e=Math.min(4*s,m.length-4);x[M++]=m[e],x[M++]=m[e+1],x[M++]=m[e+2],x[M++]=m[e+3]}v&&(x[M++]=w),R&&(null!=_&&(S[4*M]=_[0],S[4*M+1]=_[1],S[4*M+2]=_[2],S[4*M+3]=_[3]),M++)};M+=T,(0,l.s)(a,u.data[0],u.data[1],u.data[2]),e&&(0,l.h)(a,a,e);const O=this._isClosed(r);if(O){const t=u.data.length-3;(0,l.s)(o,u.data[t],u.data[t+1],u.data[t+2]),e&&(0,l.h)(o,o,e)}else(0,l.s)(c,u.data[3],u.data[4],u.data[5]),e&&(0,l.h)(c,c,e),P(a,a,c,1,D.LEFT_CAP_START,0,0),P(a,a,c,1,D.RIGHT_CAP_START,0,0),(0,l.c)(o,a),(0,l.c)(a,c);const I=O?0:1,L=O?d:d-1;for(let i=I;i<L;i++){const t=(i+1)%d*3;(0,l.s)(c,u.data[t],u.data[t+1],u.data[t+2]),e&&(0,l.h)(c,c,e),E(o,a,i),P(o,a,c,0,D.LEFT_JOIN_END,i,C),P(o,a,c,0,D.RIGHT_JOIN_END,i,C);const r=this.numJoinSubdivisions;for(let e=0;e<r;++e){const t=(e+1)/(r+1);P(o,a,c,t,D.LEFT_JOIN_END,i,C),P(o,a,c,t,D.RIGHT_JOIN_END,i,C)}P(o,a,c,1,D.LEFT_JOIN_START,i,C),P(o,a,c,1,D.RIGHT_JOIN_START,i,C),(0,l.c)(o,a),(0,l.c)(a,c)}O?((0,l.s)(c,u.data[3],u.data[4],u.data[5]),e&&(0,l.h)(c,c,e),C=E(o,a,L),P(o,a,c,0,D.LEFT_JOIN_END,I,C),P(o,a,c,0,D.RIGHT_JOIN_END,I,C)):(C=E(o,a,L),P(o,a,a,0,D.LEFT_CAP_END,L,C),P(o,a,a,0,D.RIGHT_CAP_END,L,C)),B(x,A+T,x,A,T),M=B(x,M-T,x,M,T),this._parameters.wireframe&&this._addWireframeVertices(n,A,M,T)}_addWireframeVertices(e,t,r,i){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),s=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,r-t);let o=0;const a=e=>o=B(s,e,n,o,i);for(let l=0;l<s.length-1;l+=2*i)a(l),a(l+2*i),a(l+1*i),a(l+2*i),a(l+1*i),a(l+3*i)}}function B(e,t,r,i,n){for(let s=0;s<n;s++)r[i++]=e[t++];return i}function j(e,t){return!!e.isClosed&&t.get(b.r.POSITION).indices.length>2}const H=(0,c.vt)(),G=(0,c.vt)(),Z=(0,c.vt)(),$=(0,c.vt)(),q=(0,c.vt)(),W=(0,o.r_)(),Y=(0,o.r_)(),X=(0,c.vt)(),J=(0,c.vt)(),K=(0,d.vt)(),Q=(0,d.vt)(),ee=(0,c.vt)(),te=(0,c.vt)(),re=(0,c.vt)(),ie=[(0,o.r_)(),(0,o.r_)(),(0,o.r_)(),(0,o.r_)()],ne=[(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)()],se=(0,p.vt)(),oe=(0,p.vt)(),ae=(0,p.vt)(),le=(0,p.vt)()},96791:(e,t,r)=>{"use strict";r.d(t,{D:()=>i});class i{constructor(){this.factor=new n,this.factorAlignment=new n}}class n{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}},63928:(e,t,r)=>{"use strict";r.d(t,{W:()=>s});var i=r(45463),n=r(48168);class s extends i.im{intersect(e,t,r,i,s,o){return(0,n.Uy)(e,r,i,s,void 0,o)}}},93684:(e,t,r)=>{"use strict";r.d(t,{S:()=>s,p:()=>o});var i=r(63048),n=r(45463);class s extends i.Gd{constructor(){super(...arguments),this.renderOccluded=n.m$.Occlude,this.isDecoration=!1}}const o=8},99362:(e,t,r)=>{"use strict";r.d(t,{MB:()=>l,Um:()=>u,kE:()=>o,qu:()=>a});var i=r(18690),n=r(15941),s=r(12028);function o(e,t,r,i,o){let a=(r.screenLength||0)*e.pixelRatio;null!=o&&(a=(0,s.hs)(a,i,t,o));const l=a*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return(0,n.qE)(l*t,r.minWorldLength||0,null!=r.maxWorldLength?r.maxWorldLength:1/0)}function a(e,t){const r=t?a(t):{};for(const i in e){let t=e[i];t?.forEach&&(t=c(t)),null==t&&i in r||(r[i]=t)}return r}function l(e,t){let r=!1;for(const n in t){const s=t[n];void 0!==s&&(Array.isArray(s)?null===e[n]?(e[n]=s.slice(),r=!0):(0,i.yo)(e[n],s)&&(r=!0):e[n]!==s&&(r=!0,e[n]=s))}return r}function c(e){const t=[];return e.forEach((e=>t.push(e))),t}const u={multiply:1,ignore:2,replace:3,tint:4}},52757:(e,t,r)=>{"use strict";r.d(t,{Hk:()=>d,Pq:()=>h,SA:()=>g,Ut:()=>u,p1:()=>p,tH:()=>m,tb:()=>f,uO:()=>a,zC:()=>y});var i=r(34761),n=r(88105),s=r(86994),o=r(66470);function a(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const{data:n,indices:s}=e,o=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(r*=a,1===i)for(let c=0;c<l;++c)o[r]=n[s[c]],r+=a;else for(let c=0;c<l;++c){const e=n[s[c]];for(let t=0;t<i;t++)o[r]=e,r+=a}}function l(e,t,r){const{data:i,indices:n}=e,s=t.typedBuffer,o=t.typedBufferStride,a=n.length;r*=o;for(let l=0;l<a;++l){const e=2*n[l];s[r]=i[e],s[r+1]=i[e+1],r+=o}}function c(e,t,r,i){const{data:n,indices:s}=e,o=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(r*=a,null==i||1===i)for(let c=0;c<l;++c){const e=3*s[c];o[r]=n[e],o[r+1]=n[e+1],o[r+2]=n[e+2],r+=a}else for(let c=0;c<l;++c){const e=3*s[c];for(let t=0;t<i;++t)o[r]=n[e],o[r+1]=n[e+1],o[r+2]=n[e+2],r+=a}}function u(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const{data:n,indices:s}=e,o=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(r*=a,1===i)for(let c=0;c<l;++c){const e=4*s[c];o[r]=n[e],o[r+1]=n[e+1],o[r+2]=n[e+2],o[r+3]=n[e+3],r+=a}else for(let c=0;c<l;++c){const e=4*s[c];for(let t=0;t<i;++t)o[r]=n[e],o[r+1]=n[e+1],o[r+2]=n[e+2],o[r+3]=n[e+3],r+=a}}function h(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride;t*=n;for(let s=0;s<r;++s)i[t]=0,i[t+1]=0,i[t+2]=0,i[t+3]=0,t+=n}function d(e,t,r,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(!t)return void c(e,r,n,s);const{data:o,indices:a}=e,l=r.typedBuffer,u=r.typedBufferStride,h=a.length,d=t[0],p=t[1],f=t[2],m=t[4],g=t[5],y=t[6],_=t[8],v=t[9],b=t[10],w=t[12],x=t[13],S=t[14];n*=u;let T=0,M=0,A=0;const C=(0,i.tZ)(t)?e=>{T=o[e]+w,M=o[e+1]+x,A=o[e+2]+S}:e=>{const t=o[e],r=o[e+1],i=o[e+2];T=d*t+m*r+_*i+w,M=p*t+g*r+v*i+x,A=f*t+y*r+b*i+S};if(1===s)for(let i=0;i<h;++i)C(3*a[i]),l[n]=T,l[n+1]=M,l[n+2]=A,n+=u;else for(let i=0;i<h;++i){C(3*a[i]);for(let e=0;e<s;++e)l[n]=T,l[n+1]=M,l[n+2]=A,n+=u}}function p(e,t,r,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(!t)return void c(e,r,n,s);const{data:o,indices:a}=e,l=t,u=r.typedBuffer,h=r.typedBufferStride,d=a.length,p=l[0],f=l[1],m=l[2],g=l[4],y=l[5],_=l[6],v=l[8],b=l[9],w=l[10],x=!(0,i.ut)(l),S=1e-6,T=1-S;n*=h;let M=0,A=0,C=0;const E=(0,i.tZ)(l)?e=>{M=o[e],A=o[e+1],C=o[e+2]}:e=>{const t=o[e],r=o[e+1],i=o[e+2];M=p*t+g*r+v*i,A=f*t+y*r+b*i,C=m*t+_*r+w*i};if(1===s)if(x)for(let i=0;i<d;++i){E(3*a[i]);const e=M*M+A*A+C*C;if(e<T&&e>S){const t=1/Math.sqrt(e);u[n]=M*t,u[n+1]=A*t,u[n+2]=C*t}else u[n]=M,u[n+1]=A,u[n+2]=C;n+=h}else for(let i=0;i<d;++i)E(3*a[i]),u[n]=M,u[n+1]=A,u[n+2]=C,n+=h;else for(let i=0;i<d;++i){if(E(3*a[i]),x){const e=M*M+A*A+C*C;if(e<T&&e>S){const t=1/Math.sqrt(e);M*=t,A*=t,C*=t}}for(let e=0;e<s;++e)u[n]=M,u[n+1]=A,u[n+2]=C,n+=h}}function f(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const{data:s,indices:o}=e,a=r.typedBuffer,l=r.typedBufferStride,c=o.length;if(i*=l,t!==s.length||4!==t)if(1!==n)if(4!==t)for(let u=0;u<c;++u){const e=3*o[u];for(let t=0;t<n;++t)a[i]=s[e],a[i+1]=s[e+1],a[i+2]=s[e+2],a[i+3]=255,i+=l}else for(let u=0;u<c;++u){const e=4*o[u];for(let t=0;t<n;++t)a[i]=s[e],a[i+1]=s[e+1],a[i+2]=s[e+2],a[i+3]=s[e+3],i+=l}else{if(4===t){for(let e=0;e<c;++e){const t=4*o[e];a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=s[t+3],i+=l}return}for(let e=0;e<c;++e){const t=3*o[e];a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=255,i+=l}}else{a[i]=s[0],a[i+1]=s[1],a[i+2]=s[2],a[i+3]=s[3];const e=new Uint32Array(r.typedBuffer.buffer,r.start),t=l/4,o=e[i/=4];i+=t;const u=c*n;for(let r=1;r<u;++r)e[i]=o,i+=t}}function m(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const s=t.typedBuffer,o=t.typedBufferStride;if(i*=o,1===n)for(let a=0;a<r;++a)s[i]=e[0],s[i+1]=e[1],s[i+2]=e[2],s[i+3]=e[3],i+=o;else for(let a=0;a<r;++a)for(let t=0;t<n;++t)s[i]=e[0],s[i+1]=e[1],s[i+2]=e[2],s[i+3]=e[3],i+=o}function g(e,t,r,i,s,a){for(const l of t.fields.keys()){const t=e.attributes.get(l),c=t?.indices;if(t&&c)y(l,t,r,i,s,a);else if(l===o.r.OBJECTANDLAYERIDCOLOR&&null!=e.objectAndLayerIdColor){const t=e.attributes.get(o.r.POSITION)?.indices;if(t){const r=t.length,i=s.getField(l,n.XP);m(e.objectAndLayerIdColor,i,r,a)}}}}function y(e,t,r,a,c,h){switch(e){case o.r.POSITION:{(0,s.vA)(3===t.size);const i=c.getField(e,n.xs);(0,s.vA)(!!i,`No buffer view for ${e}`),i&&d(t,r,i,h);break}case o.r.NORMAL:{(0,s.vA)(3===t.size);const r=c.getField(e,n.xs);(0,s.vA)(!!r,`No buffer view for ${e}`),r&&p(t,a,r,h);break}case o.r.NORMALCOMPRESSED:{(0,s.vA)(2===t.size);const r=c.getField(e,n.mJ);(0,s.vA)(!!r,`No buffer view for ${e}`),r&&l(t,r,h);break}case o.r.UV0:{(0,s.vA)(2===t.size);const r=c.getField(e,n.gH);(0,s.vA)(!!r,`No buffer view for ${e}`),r&&l(t,r,h);break}case o.r.COLOR:case o.r.SYMBOLCOLOR:{const r=c.getField(e,n.XP);(0,s.vA)(!!r,`No buffer view for ${e}`),(0,s.vA)(3===t.size||4===t.size),!r||3!==t.size&&4!==t.size||f(t,t.size,r,h);break}case o.r.COLORFEATUREATTRIBUTE:{const r=c.getField(e,n.Y$);(0,s.vA)(!!r,`No buffer view for ${e}`),(0,s.vA)(1===t.size),r&&1===t.size&&function(e,t,r){const{data:i,indices:n}=e,s=t.typedBuffer,o=t.typedBufferStride,a=n.length,l=i[0];r*=o;for(let c=0;c<a;++c)s[r]=l,r+=o}(t,r,h);break}case o.r.TANGENT:{(0,s.vA)(4===t.size);const o=c.getField(e,n.Eq);(0,s.vA)(!!o,`No buffer view for ${e}`),o&&function(e,t,r,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(!t)return void u(e,r,n,s);const{data:o,indices:a}=e,l=t,c=r.typedBuffer,h=r.typedBufferStride,d=a.length,p=l[0],f=l[1],m=l[2],g=l[4],y=l[5],_=l[6],v=l[8],b=l[9],w=l[10],x=!(0,i.ut)(l),S=1e-6,T=1-S;if(n*=h,1===s)for(let i=0;i<d;++i){const e=4*a[i],t=o[e],r=o[e+1],s=o[e+2],l=o[e+3];let u=p*t+g*r+v*s,d=f*t+y*r+b*s,M=m*t+_*r+w*s;if(x){const e=u*u+d*d+M*M;if(e<T&&e>S){const t=1/Math.sqrt(e);u*=t,d*=t,M*=t}}c[n]=u,c[n+1]=d,c[n+2]=M,c[n+3]=l,n+=h}else for(let i=0;i<d;++i){const e=4*a[i],t=o[e],r=o[e+1],l=o[e+2],u=o[e+3];let d=p*t+g*r+v*l,M=f*t+y*r+b*l,A=m*t+_*r+w*l;if(x){const e=d*d+M*M+A*A;if(e<T&&e>S){const t=1/Math.sqrt(e);d*=t,M*=t,A*=t}}for(let i=0;i<s;++i)c[n]=d,c[n+1]=M,c[n+2]=A,c[n+3]=u,n+=h}}(t,r,o,h);break}case o.r.PROFILERIGHT:case o.r.PROFILEUP:case o.r.PROFILEVERTEXANDNORMAL:case o.r.FEATUREVALUE:{(0,s.vA)(4===t.size);const r=c.getField(e,n.Eq);(0,s.vA)(!!r,`No buffer view for ${e}`),r&&u(t,r,h)}}}},35925:(e,t,r)=>{"use strict";r.d(t,{Xq:()=>a,wk:()=>o});const i={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},n={dash:i.dash,"dash-dot":[...i.dash,...i.dot],dot:i.dot,"long-dash":i["long-dash"],"long-dash-dot":[...i["long-dash"],...i.dot],"long-dash-dot-dot":[...i["long-dash"],...i.dot,...i.dot],none:null,"short-dash":i["short-dash"],"short-dash-dot":[...i["short-dash"],...i["short-dot"]],"short-dash-dot-dot":[...i["short-dash"],...i["short-dot"],...i["short-dot"]],"short-dot":i["short-dot"],solid:null},s=8;function o(e){return{pattern:[e,e],pixelRatio:2}}function a(e){return null!=e&&"style"===e.type?function(e){return null!=e?function(e,t){return null==e?e:{pattern:e.slice(),pixelRatio:t}}(n[e],s):null}(e.style):null}},78992:(e,t,r)=>{"use strict";r.d(t,{Jr:()=>s,Rk:()=>a,d_:()=>c,mX:()=>l,me:()=>o});var i=r(20664),n=r(9392);function s(e){let{normalTexture:t,metallicRoughnessTexture:r,metallicFactor:s,roughnessFactor:o,emissiveTexture:a,emissiveFactor:l,occlusionTexture:c}=e;return null==t&&null==r&&null==a&&(null==l||(0,i.e)(l,n.uY))&&null==c&&(null==o||1===o)&&(null==s||1===s)}function o(e){let{normalTexture:t,metallicRoughnessTexture:r,metallicFactor:s,roughnessFactor:o,emissiveTexture:a,emissiveFactor:l,occlusionTexture:c}=e;return null==t&&null==r&&null==a&&(null==l||(0,i.e)(l,n.uY))&&null==c&&(null==o||1===o)&&(null==s||1===s||0===s)}const a=[1,1,.5],l=[0,.6,.2],c=[0,1,.2]},74964:(e,t,r)=>{"use strict";r.d(t,{y:()=>D});var i=r(35143),n=r(18690),s=(r(81806),r(87663)),o=r(15941),a=r(30726),l=r(75941),c=r(30015),u=r(46053),h=(r(76460),r(85842)),d=r(34761),p=r(13191),f=r(57481),m=r(34981),g=r(60586),y=r(50255),_=r(57824),v=r(77730),b=r(86994),w=r(16699);class x{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.from=e,this.to=t}get numElements(){return this.to-this.from}}function S(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let r=!0;for(;r;){r=!1;for(let i=0;i<e.length;++i){const n=e.data[i],s=t.get(n.to);if(!s)return;n.to=s.to,t.delete(s.from),e.removeUnordered(s),r=!0}}}class T extends x{constructor(e,t,r){super(t,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return null!=this.geometry.highlights&&this.isVisible}get hasOccludees(){return null!=this.geometry.occludees}}class M{constructor(){this.first=0,this.count=0}}class A{constructor(){this._numElements=0,this._instances=new Map,this.holes=new c.A({allocator:e=>e||new x,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=C(),this.drawCommandsHighlight=C(),this.drawCommandsOccludees=C(),this.drawCommandsShadowHighlightRest=C()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,r){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,i.from=t,i.to=r,this._numElements+=i.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const t=this.drawCommandsDefault.pushNew(),r=this.holes.front();return null!=this.vao&&1===this.holes.length&&r.to===Math.floor(this.vao.byteSize/e)?(t.first=0,void(t.count=r.from)):(t.first=1/0,t.count=0,this._instances.forEach((e=>{t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}const t=Array.from(this._instances.values()).sort(((e,t)=>e.from===t.from?e.to-t.to:e.from-t.from));for(const r of t)r.isVisible&&(E(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),E(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function C(){return new c.A({allocator:e=>e||new M,deallocator:e=>e})}function E(e,t){const r=e.back();if(null==r){const r=e.pushNew();return r.first=t.from,void(r.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(r,t)){const e=t.from-r.first+t.numElements;r.count=e}else{const r=e.pushNew();r.first=t.from,r.count=t.numElements}}class R{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach((e=>e.vao.dispose())),this.buffers.length=0}findBuffer(e){return this.buffers.find((t=>t.instances.has(e)))}}var P=r(23859),O=r(69008),I=r(76718),L=r(93345);class N{constructor(e,t,r){this._rctx=e,this._locations=t,this._layout=r,this._cache=new P.I(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const t=e.toString();let r=this._cache.pop(t);return r||(r=new O.Z(this._rctx,this._locations,{geometry:this._layout},{geometry:I.g.createVertex(this._rctx,L._U.STATIC_DRAW)}),r.vertexBuffers.geometry.setSize(e),r)}deleteVao(e){if(null==e)return;const t=e.byteSize.toString();this._cache.put(t,e)}}let D=class extends g.Ot{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._produces=new Map,this.drapedPriority=0}destroy(){this._glMaterials=(0,a.WD)(this._glMaterials),this._dataByOrigin.forEach((e=>e.dispose())),this._dataByOrigin.clear(),this._vaoCache=(0,a.WD)(this._vaoCache)}initialize(){this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!(0===this._dataByOrigin.size||!(t!==m.V.Highlight&&t!==m.V.ShadowHighlight||this._hasHighlights))&&e(t)))}))}get produces(){return this._produces}initializeRenderContext(e,t){const{rctx:r}=e.renderContext;this._glMaterials=new y.c(this.material,t??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new N(r,this.material.vertexAttributeLocations,(0,f.U)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get materialReference(){return this.material}get numGeometries(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.instances.size),0))),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.vao.usedMemory),0))),e}forEachGeometry(e){this._dataByOrigin.forEach((t=>t.buffers.forEach((t=>t.instances.forEach((t=>e(t.geometry)))))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const t=this._bufferWriter;if(null===t)return;const r=t.vertexBufferLayout.stride/4;for(const i of e){const e=i.renderGeometry,n=this._dataByOrigin.get(e.localOrigin.id),s=n?.findBuffer(e.id);if(null==s)return;const o=s.instances.get(e.id);if(i.updateType&(_.k.GEOMETRY|_.k.TRANSFORMATION)){const i=W(t.elementCount(o.geometry.geometry)*r),n=t.vertexBufferLayout.createView(i.buffer);this._writeGeometry(e,n,0),s.vao.vertexBuffers.geometry.setSubData(i,o.from*r,0,o.numElements*r)}i.updateType&(_.k.HIGHLIGHT|_.k.OCCLUDEE|_.k.VISIBILITY)&&(s.drawCommandsDirty=!0)}}_computeDeltas(e,t){const r=new l.O;for(const i of e){const e=i.localOrigin;if(null==e)continue;let t=r.get(e.id,null);null==t&&(t=new F(e.vec3),r.set(e.id,null,t)),t.changes.push(i)}for(const i of t){const e=i.localOrigin;if(null==e)continue;const t=this._dataByOrigin.get(e.id),n=t?.findBuffer(i.id);if(null==n)continue;let s=r.get(e.id,n);null==s&&(s=new F(e.vec3),r.set(e.id,n,s)),s.changes.push(i)}return r}_addAndRemoveGeometries(e,t){if(null===this._bufferWriter||null===this._vaoCache)return;const{_bufferWriter:r,_dataByOrigin:i}=this,s=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,t);o.forEach(((e,t)=>{const a=e.get(null),l=null!=a?a.changes:[];o.delete(t,null);let c=i.get(t);if(e.forEach(((e,a)=>{if(o.delete(t,a),null==a)return void(0,b.vA)(!1,"No VAO for removed geometries");if(a.instances.size===e.changes.length)return this._vaoCache.deleteVao(a.vao),(0,n.Xy)(c.buffers,a),void(0===c.buffers.length&&0===l.length&&i.delete(t));const u=a.numElements,h=a.vao.byteSize/4,d=l.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),p=e.changes.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),f=Math.min((u+d-p)*s,$),m=f>h;f>j&&f<h/2?(e.changes.forEach((e=>{let{id:t}=e;return a.deleteInstance(t)})),a.instances.forEach((e=>{let{geometry:t}=e;return l.push(t)})),this._vaoCache.deleteVao(a.vao),(0,n.Xy)(c.buffers,a)):m?this._applyAndRebuild(a,l,e):this._applyRemoves(a,e)})),l.length>0)for(null==c&&(c=new R(a.origin),i.set(t,c)),c.buffers.forEach((e=>this._applyAdds(e,l)));l.length>0;)c.buffers.push(this._applyAndRebuild(new A,l,null))}))}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.buffers.forEach((e=>{e.drawCommandsDirty&&(e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,(0,s.Bs)(e.instances,(t=>(e.updateDrawState(t),e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees))),e.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||e.hasHighlights,this._hasOccludees=this._hasOccludees||e.hasOccludees}))}))}_applyAndRebuild(e,t,r){if(null!=r)for(const p of r.changes)e.deleteInstance(p.id);const i=this._bufferWriter,n=i.vertexBufferLayout.stride,s=n/4,o=Math.floor($/s);let a=e.numElements;for(;t.length>0;){const r=t.pop(),n=i.elementCount(r.geometry);if(a+n>o&&a>0){t.push(r);break}a+=n;const s=new T(r,0,0);(0,b.vA)(null==e.instances.get(r.id)),e.addInstance(r.id,s)}const l=a*s,c=W(l),u=i.vertexBufferLayout.createView(c.buffer);let h=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach(((t,r)=>{this._writeGeometry(t.geometry,u,h);const n=h;h+=i.elementCount(t.geometry.geometry),e.updateInstance(r,n,h),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Y(l)),e.vao.vertexBuffers.geometry.setSubData(c,0,0,h*s),e.holes.clear();const d=e.holes.pushNew();return d.from=h,d.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,t){if(0===t.changes.length||null===this._bufferWriter)return;for(const o of t.changes){const t=o.id,r=e.instances.get(t);if(!r)continue;e.deleteInstance(t);const i=B.back();if(i){if(i.to===r.from){i.to=r.to;continue}if(i.from===r.to){i.from=r.from;continue}}const n=B.pushNew();n.from=r.from,n.to=r.to}S(B);const r=this._bufferWriter.vertexBufferLayout.stride/4,i=B.reduce(((e,t)=>Math.max(e,t.numElements)),0)*r,n=W(i);n.fill(0,0,i);const s=e.vao.vertexBuffers.geometry;B.forAll((e=>s.setSubData(n,e.from*r,0,e.numElements*r))),e.holes.pushArray(B.data,B.length),B.forAll(((e,t)=>B.data[t]=null)),B.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(0===t.length||null===this._bufferWriter)return;if(!function(e){return null!=e.vao}(e))return void this._applyAndRebuild(e,t,null);const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4,s=e.numElements,o=t.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),a=Math.min((s+o)*i,$),l=4*a;if(e.vao.byteSize<Y($-j)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,t,null);S(e.holes);const c=new Array;for(const n of t){const t=r.elementCount(n.geometry),i=k(e.holes,t);c.push(i)}const u=e.vao.vertexBuffers.geometry;let h=0,d=0,p=0;const f=W(a),m=r.vertexBufferLayout.createView(f.buffer);t.forEach(((t,n)=>{const s=c[n];if(null==s)return;if(p!==s){const e=p-d;e>0&&u.setSubData(f,d*i,0,e*i),d=s,h=0}const o=r.elementCount(t.geometry);this._writeGeometry(t,m,h),h+=o,p=s+o;const a=new T(t,s,s+o);(0,b.vA)(null==e.instances.get(t.id)),e.addInstance(t.id,a),e.drawCommandsDirty=!0}));const g=p-d;g>0&&u.setSubData(f,d*i,0,g*i),(0,n.$i)(t,((e,t)=>null==c[t]))}_writeGeometry(e,t,r){if(null===this._bufferWriter)return;const i=e.localOrigin.vec3;(0,b.M_)(z,-i[0],-i[1],-i[2]);const n=(0,d.lw)(U,z,e.transformation);(0,d.B8)(V,n),(0,d.mg)(V,V),this._bufferWriter.write(n,V,e.geometry,t,r)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:t,bindParameters:r}=e,i=this.material.produces.get(r.slot);if(!i?.(t))return null;const n=t===m.V.Highlight||t===m.V.ShadowHighlight;if(n&&!this._hasHighlights)return null;const s=t===m.V.ShadowExcludeHighlight,o=!(n||s);for(const a of this._dataByOrigin.values())for(const i of a.buffers){if(n&&!i.hasHighlights)continue;const a=(n?i.drawCommandsHighlight:s&&i.needsMultipleCommands()?i.drawCommandsShadowHighlightRest:i.drawCommandsDefault)||null,l=o&&i.drawCommandsOccludees||null;if(a?.length||l?.length){const i=this._glMaterials.load(e.rctx,r.slot,t),n=null!=i?i.beginSlot(r):null;if(null!=n)return n}}return null}renderNode(e,t){const{output:r,bindParameters:i}=e,n=r===m.V.Highlight||r===m.V.ShadowHighlight,s=r===m.V.ShadowExcludeHighlight,o=!(n||s),a=i.slot===v.N.OCCLUDER_MATERIAL,l=i.slot===v.N.TRANSPARENT_OCCLUDER_MATERIAL,c=e.rctx;c.runAppleAmdDriverHelper(),c.bindTechnique(t,i,this.material.parameters);for(const u of this._dataByOrigin.values())for(const e of u.buffers){if(n&&!e.hasHighlights)continue;const r=(n?e.drawCommandsHighlight:s&&e.needsMultipleCommands()?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,h=o&&e.drawCommandsOccludees||null;(r?.length||h?.length)&&(t.program.bindDraw(new w.P(u.origin),i,this.material.parameters),t.ensureAttributeLocations(e.vao),c.bindVAO(e.vao),r?.length&&(c.setPipelineState(t.getPipeline(!1,a,l)),r.forAll((e=>c.drawArrays(t.primitiveType,e.first,e.count)))),h?.length&&(c.setPipelineState(t.getPipeline(!0,a,l)),h.forAll((e=>c.drawArrays(t.primitiveType,e.first,e.count)))))}}get test(){}};(0,i._)([(0,u.MZ)({constructOnly:!0})],D.prototype,"material",void 0),D=(0,i._)([(0,h.$)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],D);class F{constructor(e){this.origin=e,this.changes=new Array}}function k(e,t){let r;if(!e.some((e=>!(e.numElements<t)&&(r=e,!0))))return null;const i=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),i}const z=(0,p.vt)(),U=(0,p.vt)(),V=(0,p.vt)(),B=new c.A({allocator:e=>e||new x,deallocator:null}),j=65536,H=4*j,G=1024,Z=16777216,$=Z/4;let q=new Float32Array(j);function W(e){return q.length<e&&(q=new Float32Array(e)),q}function Y(e){const t=4*e;return t<=G?G:t<H?(0,o.cU)(t):Math.max(Math.min(Math.ceil(1.5*t/H)*H,Z),t)}},68967:(e,t,r)=>{"use strict";r.d(t,{Ci:()=>s,PC:()=>o,Vk:()=>a});var i=r(9392),n=r(99643);function s(e,t){return null==e&&(e=[]),e.push(t),e}function o(e,t){if(null==e)return null;const r=e.filter((e=>e!==t));return 0===r.length?null:r}function a(e,t,r,i,s){l[0]=e.get(t,0),l[1]=e.get(t,1),l[2]=e.get(t,2),(0,n.jS)(l,c,3),r.set(s,0,c[0]),i.set(s,0,c[1]),r.set(s,1,c[2]),i.set(s,1,c[3]),r.set(s,2,c[4]),i.set(s,2,c[5])}const l=(0,i.vt)(),c=new Float32Array(6)},95901:(e,t,r)=>{"use strict";r.d(t,{GQ:()=>h,GV:()=>d,Ry:()=>l});var i=r(14522),n=r(73999),s=r(93345),o=r(98433),a=r(96673);function l(e,t){return new n.f((t=>{const{encodedData:r,textureSize:i}=c(t),n=new a.R;return n.internalFormat=s.Ab.RGBA,n.width=i,n.height=1,n.wrapMode=s.pF.REPEAT,new o.g(e,n,r)}),(e=>`${e.pattern.join(",")}-r${e.pixelRatio}`),t)}function c(e){const t=u(e),r=1/e.pixelRatio,n=h(e),s=d(e),o=(Math.floor(.5*(s-1))+.5)*r,a=[];let l=1;for(const i of t){for(let e=0;e<i;e++){const t=l*(Math.min(e,i-1-e)+.5)*r/o*.5+.5;a.push(t)}l=-l}const c=Math.round(t[0]/2),p=[...a.slice(c),...a.slice(0,c)],f=new Uint8Array(4*n);let m=0;for(const u of p)(0,i.U)(u,f,m),m+=4;return{encodedData:f,textureSize:n}}function u(e){return e.pattern.map((t=>Math.round(t*e.pixelRatio)))}function h(e){if(null==e)return 1;const t=u(e);return Math.floor(t.reduce(((e,t)=>e+t)))}function d(e){return u(e).reduce(((e,t)=>Math.max(e,t)))}},37267:(e,t,r)=>{"use strict";r.d(t,{R5:()=>A,V:()=>M,uD:()=>T});var i=r(9392),n=r(55855),s=r(64465),o=r(34981),a=r(59046),l=r(97808),c=r(55386),u=r(90235),h=r(16506),d=r(42693),p=r(83490),f=r(32119),m=r(45463),g=r(60322),y=r(28584),_=r(96643),v=r(10773),b=r(78992),w=r(68745),x=r(93345),S=r(57162);class T extends c.Zo{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=(0,i.ci)(b.Rk),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=p.s2.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=(0,i.fA)(0,0,0),this.instancedDoublePrecision=!1,this.normalType=a.W.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=(0,i.fA)(.2,.2,.2),this.diffuse=(0,i.fA)(.8,.8,.8),this.externalColor=(0,n.fA)(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=(0,i.vt)(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=p.it.Less,this.textureAlphaMode=p.sf.Blend,this.textureAlphaCutoff=u.H,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=m.m$.Occlude,this.isDecoration=!1}}class M extends c.gy{constructor(){super(...arguments),this.origin=(0,i.vt)(),this.slicePlaneLocalOrigin=this.origin}}class A extends d.w{initializeConfiguration(e,t){t.spherical=e.viewingMode===s.RT.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,t.textureCoordinateType=t.hasColorTexture||t.hasMetallicRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture||t.hasNormalTexture?l.q.Default:l.q.None,t.objectAndLayerIdColorInstanced=t.instanced}initializeProgram(e){return this._initializeProgram(e,A.shader)}_initializeProgram(e,t){return new y.B(e.rctx,t.get().build(this.configuration),f.D)}_makePipeline(e,t){const r=this.configuration,i=e===v.y.NONE,n=e===v.y.FrontFace;return(0,S.Ey)({blending:r.output===o.V.Color&&r.transparent?i?g.V0:(0,g.ez)(e):null,culling:E(r)?(0,S.Xt)(r.cullFace):null,depthTest:{func:(0,g.K_)(e,C(r.customDepthTest))},depthWrite:(i||n)&&r.writeDepth?S.kn:null,drawBuffers:r.output===o.V.Depth?{buffers:[x.Hr.NONE]}:(0,g.cl)(e),colorWrite:S.wE,stencilWrite:r.hasOccludees?_.v0:null,stencilTest:r.hasOccludees?t?_.a9:_.qh:null,polygonOffset:i||n?null:(0,g.aB)(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}function C(e){return e===p.it.Lequal?x.MT.LEQUAL:x.MT.LESS}function E(e){return e.cullFace!==p.s2.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}A.shader=new h.$(w.D,(()=>r.e(3727).then(r.bind(r,23727))))},50125:(e,t,r)=>{"use strict";r.d(t,{Dt:()=>u,kJ:()=>n,lM:()=>i});var i,n,s=r(35143),o=r(34981),a=r(99415),l=r(10773),c=r(92656);!function(e){e[e.Draped=0]="Draped",e[e.Screen=1]="Screen",e[e.World=2]="World",e[e.COUNT=3]="COUNT"}(i||(i={})),function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(n||(n={}));class u extends c.E{constructor(){super(...arguments),this.output=o.V.Color,this.transparencyPassType=l.y.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=i.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=n.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===i.Draped}}(0,s._)([(0,a.W)({count:o.V.COUNT})],u.prototype,"output",void 0),(0,s._)([(0,a.W)({count:l.y.COUNT})],u.prototype,"transparencyPassType",void 0),(0,s._)([(0,a.W)()],u.prototype,"occluder",void 0),(0,s._)([(0,a.W)()],u.prototype,"hasSlicePlane",void 0),(0,s._)([(0,a.W)()],u.prototype,"writeDepth",void 0),(0,s._)([(0,a.W)({count:i.COUNT})],u.prototype,"space",void 0),(0,s._)([(0,a.W)()],u.prototype,"hideOnShortSegments",void 0),(0,s._)([(0,a.W)()],u.prototype,"hasCap",void 0),(0,s._)([(0,a.W)({count:n.COUNT})],u.prototype,"anchor",void 0),(0,s._)([(0,a.W)()],u.prototype,"hasTip",void 0),(0,s._)([(0,a.W)()],u.prototype,"vvSize",void 0),(0,s._)([(0,a.W)()],u.prototype,"vvColor",void 0),(0,s._)([(0,a.W)()],u.prototype,"vvOpacity",void 0),(0,s._)([(0,a.W)()],u.prototype,"hasOccludees",void 0),(0,s._)([(0,a.W)()],u.prototype,"multipassEnabled",void 0),(0,s._)([(0,a.W)()],u.prototype,"cullAboveGround",void 0),(0,s._)([(0,a.W)({constValue:!1})],u.prototype,"occlusionPass",void 0),(0,s._)([(0,a.W)({constValue:!0})],u.prototype,"hasVvInstancing",void 0),(0,s._)([(0,a.W)({constValue:!0})],u.prototype,"hasSliceTranslatedView",void 0)},46259:(e,t,r)=>{"use strict";r.d(t,{Q:()=>c,x:()=>i});var i,n=r(35143),s=r(34981),o=r(99415),a=r(10773),l=r(92656);!function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"}(i||(i={}));class c extends l.E{constructor(){super(...arguments),this.output=s.V.Color,this.capType=i.BUTT,this.transparencyPassType=a.y.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}}(0,n._)([(0,o.W)({count:s.V.COUNT})],c.prototype,"output",void 0),(0,n._)([(0,o.W)({count:i.COUNT})],c.prototype,"capType",void 0),(0,n._)([(0,o.W)({count:a.y.COUNT})],c.prototype,"transparencyPassType",void 0),(0,n._)([(0,o.W)()],c.prototype,"occluder",void 0),(0,n._)([(0,o.W)()],c.prototype,"hasSlicePlane",void 0),(0,n._)([(0,o.W)()],c.prototype,"hasPolygonOffset",void 0),(0,n._)([(0,o.W)()],c.prototype,"writeDepth",void 0),(0,n._)([(0,o.W)()],c.prototype,"draped",void 0),(0,n._)([(0,o.W)()],c.prototype,"stippleEnabled",void 0),(0,n._)([(0,o.W)()],c.prototype,"stippleOffColorEnabled",void 0),(0,n._)([(0,o.W)()],c.prototype,"stipplePreferContinuous",void 0),(0,n._)([(0,o.W)()],c.prototype,"roundJoins",void 0),(0,n._)([(0,o.W)()],c.prototype,"applyMarkerOffset",void 0),(0,n._)([(0,o.W)()],c.prototype,"vvSize",void 0),(0,n._)([(0,o.W)()],c.prototype,"vvColor",void 0),(0,n._)([(0,o.W)()],c.prototype,"vvOpacity",void 0),(0,n._)([(0,o.W)()],c.prototype,"falloffEnabled",void 0),(0,n._)([(0,o.W)()],c.prototype,"innerColorEnabled",void 0),(0,n._)([(0,o.W)()],c.prototype,"hasOccludees",void 0),(0,n._)([(0,o.W)()],c.prototype,"multipassEnabled",void 0),(0,n._)([(0,o.W)()],c.prototype,"cullAboveGround",void 0),(0,n._)([(0,o.W)()],c.prototype,"wireframe",void 0),(0,n._)([(0,o.W)()],c.prototype,"objectAndLayerIdColorInstanced",void 0),(0,n._)([(0,o.W)({constValue:!1})],c.prototype,"occlusionPass",void 0),(0,n._)([(0,o.W)({constValue:!0})],c.prototype,"hasVvInstancing",void 0),(0,n._)([(0,o.W)({constValue:!0})],c.prototype,"hasSliceTranslatedView",void 0)},50578:(e,t,r)=>{"use strict";r.d(t,{o:()=>i,q:()=>o});var i,n=r(35143),s=r(99415);!function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold",e[e.COUNT=2]="COUNT"}(i||(i={}));class o extends s.K{constructor(){super(...arguments),this.visualization=i.Gradient,this.bandsEnabled=!1}}(0,n._)([(0,s.W)({count:i.COUNT})],o.prototype,"visualization",void 0),(0,n._)([(0,s.W)()],o.prototype,"bandsEnabled",void 0)},28014:(e,t,r)=>{"use strict";r.d(t,{E7:()=>_,gP:()=>i,s0:()=>n,zP:()=>v});var i,n,s=r(13545),o=r(59046),a=r(89299),l=r(81449),c=r(72468),u=r(5517),h=r(21390),d=r(64839),p=r(42759),f=r(72106),m=r(43425),g=r(27374),y=r(66470);function _(e,t){const r=e.vertex;r.include(l.W),e.include(o.Y,t),r.uniforms.add(new h.m("distanceFalloffFactor",(e=>e.distanceFalloffFactor))),r.code.add(d.H`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new g.o("componentDataTex",(e=>e.componentDataTexture))),e.attributes.add(y.r.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*s.Hi),r.code.add(d.H`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
      vec3 normal = normalModel();
      vec3 normal2 = ${t.silhouette?d.H`decompressNormal(normal2Compressed)`:d.H`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),t.legacy?r.code.add(d.H`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new p.h("transformNormalGlobalFromModel",(e=>e.transformNormalGlobalFromModel))),r.code.add(d.H`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(y.r.NORMAL2COMPRESSED,"vec2"),r.code.add(d.H`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):r.code.add(d.H`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),t.legacy?r.code.add(d.H`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(a.u,t),r.uniforms.add(new f.k("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new p.h("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new c.W("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL)),new c.W("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new u.t("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new u.t("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH))),r.code.add(d.H`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?d.H`normalize(transformWorldFromModelTL + rotatedModelPosition);`:d.H`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new m.X("transformProjFromView",((e,t)=>t.camera.projectionMatrix))),r.code.add(d.H`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(d.H`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function v(e){return e===i.Sketch||e===i.Mixed}!function(e){e[e.Solid=0]="Solid",e[e.Sketch=1]="Sketch",e[e.Mixed=2]="Mixed",e[e.COUNT=3]="COUNT"}(i||(i={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.SILHOUETTE=1]="SILHOUETTE"}(n||(n={}))},33062:(e,t,r)=>{"use strict";r.d(t,{A:()=>M});var i=r(35143),n=r(91967),s=r(76460),o=r(15941),a=r(76931),l=r(46053),c=(r(81806),r(47249),r(85842)),u=r(34761),h=r(13191),d=r(19555),p=r(72745),f=r(20664),m=r(9392),g=r(43047),y=r(55855),_=r(4763),v=r(95925),b=r(96190),w=r(64465);var x,S=r(13840);let T=x=class extends n.A{constructor(e){super(e),this._ray=(0,v.vt)(),this._viewport=(0,y.fA)(0,0,1,1),this._padding=(0,y.fA)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,p.fA)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,h.vt)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,h.vt)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,h.vt)(),this._frustumDirty=!0,this._frustum=(0,_.vt)(),this._fullViewport=(0,y.vt)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,m.vt)(),this._up=(0,m.vt)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get rows(){return this._rows}set rows(e){this._rows=Math.max(1,e)}get columns(){return this._columns}set columns(e){this._columns=Math.max(1,e)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,f.f)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,u.C)(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,f.s)((0,m.vt)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,f.s)((0,m.vt)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,f.s)((0,m.vt)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,g.b)((0,y.vt)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,g.e)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=(0,g.b)((0,y.vt)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,g.e)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[S.zj.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[S.zj.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[S.zj.RIGHT]+this._padding[S.zj.LEFT]}set fullWidth(e){this.width=e-(this._padding[S.zj.RIGHT]+this._padding[S.zj.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[S.zj.TOP]+this._padding[S.zj.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[S.zj.TOP]+this._padding[S.zj.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[S.zj.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[S.zj.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,g.a)(this._padding,e)||(this._viewport[0]+=e[S.zj.LEFT]-this._padding[S.zj.LEFT],this._viewport[1]+=e[S.zj.BOTTOM]-this._padding[S.zj.BOTTOM],this._viewport[2]-=e[S.zj.RIGHT]+e[S.zj.LEFT]-(this._padding[S.zj.RIGHT]+this._padding[S.zj.LEFT]),this._viewport[3]-=e[S.zj.TOP]+e[S.zj.BOTTOM]-(this._padding[S.zj.TOP]+this._padding[S.zj.BOTTOM]),(0,g.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,u.lw)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,u.B8)((0,h.vt)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,h.vt)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}(this._fov,this.width,this.height)}set fovX(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}(this._fov,this.width,this.height)}set fovY(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,f.p)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,u.B8)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,u.mg)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2)*2,i=r*this._aspect,n=r/this.rows,s=i/this.columns,o=-i/2+this.column*s,a=o+s,l=-r/2+this.row*n,c=l+n,d=(0,u.$h)((0,h.vt)(),o*(1+2*this._padding[S.zj.LEFT]/e),a*(1+2*this._padding[S.zj.RIGHT]/e),l*(1+2*this._padding[S.zj.BOTTOM]/t),c*(1+2*this._padding[S.zj.TOP]/t),this.near,this.far),p=this._get("projectionMatrix");return p&&(0,u.aI)(p,d)?p:d}copyFrom(e){(0,f.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,g.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,g.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,d.C)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,u.C)(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,_.C)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,u.C)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,g.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new x).copyFrom(this)}equals(e){return(0,f.e)(this.eye,e.eye)&&(0,f.e)(this.center,e.center)&&(0,f.e)(this.up,e.up)&&(0,g.a)(this._viewport,e.viewport)&&(0,g.a)(this._padding,e.padding)&&(0,d.t2)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,g.d)(e.screenPadding,this.screenPadding)>=t||(0,g.d)(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;(0,f.z)(E,e.eye,e.center),(0,f.z)(R,this.eye,this.center);const r=(0,f.m)(E,R),i=(0,f.x)(E),n=(0,f.x)(R),s=5e-4;return r*r>=(1-1e-10)*i*n&&(0,f.w)(e.eye,this.eye)<Math.max(i,n)*s*s}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,b.gr)(this.viewForward,(0,f.f)(E,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.gs)();return e[0]=(this.padding[S.zj.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[S.zj.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e[0]=this.padding[S.zj.LEFT]+this.width*t,e[1]=this.padding[S.zj.BOTTOM]+this.height*r,e[2]=.5,e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t){e!==A&&(0,f.c)(A,e),A[3]=1,(0,g.t)(A,A,this.projectionMatrix);const r=Math.abs(A[3]);(0,f.j)(A,A,1/r);const i=this.fullViewport;t[0]=(0,o.Cc)(0,i[0]+i[2],.5+.5*A[0]),t[1]=(0,o.Cc)(0,i[1]+i[3],.5+.5*A[1]),t[2]=.5*(A[2]+1),t[3]=r}unapplyProjection(e,t){const r=this.fullViewport;A[0]=(e[0]/(r[0]+r[2])*2-1)*e[3],A[1]=(e[1]/(r[1]+r[3])*2-1)*e[3],A[2]=(2*e[2]-1)*e[3],A[3]=e[3],null!=this.inverseProjectionMatrix&&((0,g.t)(A,A,this.inverseProjectionMatrix),t[0]=A[0],t[1]=A[1],t[2]=A[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,P),this.renderToScreen(P,t),t}projectToRenderScreen(e,t){if(A[0]=e[0],A[1]=e[1],A[2]=e[2],A[3]=1,(0,g.t)(A,A,this.viewProjectionMatrix),0===A[3])return null;const r=A;(0,f.j)(r,r,1/Math.abs(A[3]));const i=this.fullViewport,n=(0,o.Cc)(0,i[0]+i[2],.5+.5*r[0]),s=(0,o.Cc)(0,i[1]+i[3],.5+.5*r[1]);return"x"in t?(t.x=n,t.y=s):(t[0]=n,t[1]=s,t.length>2&&(t[2]=.5*(r[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,P),t)}unprojectFromRenderScreen(e,t){if((0,u.lw)(C,this.projectionMatrix,this.viewMatrix),!(0,u.B8)(C,C))return null;const r=this.fullViewport;return A[0]=2*(e[0]-r[0])/r[2]-1,A[1]=2*(e[1]-r[1])/r[3]-1,A[2]=2*e[2]-1,A[3]=1,(0,g.t)(A,A,C),0===A[3]?null:(t[0]=A[0]/A[3],t[1]=A[1]/A[3],t[2]=A[2]/A[3],t)}constrainWindowSize(e,t,r,i){const n=e*this.pixelRatio,s=t*this.pixelRatio,o=Math.max(n-r/2,0),a=Math.max(this.fullHeight-s-i/2,0),l=-Math.min(n-r/2,0),c=-Math.min(this.fullHeight-s-i/2,0),u=r-l- -Math.min(this.fullWidth-n-r/2,0),h=i-c- -Math.min(s-i/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(h)]}computeUp(e){e===w.RT.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=i,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=i}_computeUpGlobal(){(0,f.f)(E,this.center,this.eye);const e=(0,f.l)(this.center);e<1?((0,f.s)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,f.m)(E,this.center))>.9999*(0,f.l)(E)*e||((0,f.b)(this._up,E,this.center),(0,f.b)(this._up,this._up,E),(0,f.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,f.E)(E,this.eye,this.center),Math.abs(E[2])<=.9999&&((0,f.j)(E,E,E[2]),(0,f.s)(this._up,-E[0],-E[1],1-E[2]),(0,f.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,f.e)(e,t)||((0,f.c)(t,e),this._markViewDirty(),r.length&&this.notifyChange(r)):s.A.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,_.ui)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,u.t5)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,i._)([(0,l.MZ)()],T.prototype,"_viewport",void 0),(0,i._)([(0,l.MZ)()],T.prototype,"_padding",void 0),(0,i._)([(0,l.MZ)()],T.prototype,"_fov",void 0),(0,i._)([(0,l.MZ)()],T.prototype,"_nearFar",void 0),(0,i._)([(0,l.MZ)()],T.prototype,"_viewDirty",void 0),(0,i._)([(0,l.MZ)()],T.prototype,"_viewMatrix",void 0),(0,i._)([(0,l.MZ)()],T.prototype,"_pixelRatio",void 0),(0,i._)([(0,l.MZ)()],T.prototype,"pixelRatio",null),(0,i._)([(0,l.MZ)()],T.prototype,"row",void 0),(0,i._)([(0,l.MZ)()],T.prototype,"column",void 0),(0,i._)([(0,l.MZ)()],T.prototype,"_rows",void 0),(0,i._)([(0,l.MZ)()],T.prototype,"rows",null),(0,i._)([(0,l.MZ)()],T.prototype,"_columns",void 0),(0,i._)([(0,l.MZ)()],T.prototype,"columns",null),(0,i._)([(0,l.MZ)()],T.prototype,"eye",null),(0,i._)([(0,l.MZ)()],T.prototype,"center",null),(0,i._)([(0,l.MZ)()],T.prototype,"_center",void 0),(0,i._)([(0,l.MZ)()],T.prototype,"up",null),(0,i._)([(0,l.MZ)()],T.prototype,"_up",void 0),(0,i._)([(0,l.MZ)()],T.prototype,"viewMatrix",null),(0,i._)([(0,l.MZ)({readOnly:!0})],T.prototype,"viewForward",null),(0,i._)([(0,l.MZ)({readOnly:!0})],T.prototype,"viewUp",null),(0,i._)([(0,l.MZ)({readOnly:!0})],T.prototype,"viewRight",null),(0,i._)([(0,l.MZ)({readOnly:!0})],T.prototype,"nearFar",null),(0,i._)([(0,l.MZ)()],T.prototype,"near",null),(0,i._)([(0,l.MZ)()],T.prototype,"far",null),(0,i._)([(0,l.MZ)()],T.prototype,"viewport",null),(0,i._)([(0,l.MZ)({readOnly:!0})],T.prototype,"screenViewport",null),(0,i._)([(0,l.MZ)({readOnly:!0})],T.prototype,"screenPadding",null),(0,i._)([(0,l.MZ)()],T.prototype,"x",null),(0,i._)([(0,l.MZ)()],T.prototype,"y",null),(0,i._)([(0,l.MZ)()],T.prototype,"width",null),(0,i._)([(0,l.MZ)()],T.prototype,"height",null),(0,i._)([(0,l.MZ)()],T.prototype,"fullWidth",null),(0,i._)([(0,l.MZ)()],T.prototype,"fullHeight",null),(0,i._)([(0,l.MZ)({readOnly:!0})],T.prototype,"_aspect",null),(0,i._)([(0,l.MZ)()],T.prototype,"padding",null),(0,i._)([(0,l.MZ)({readOnly:!0})],T.prototype,"projectionMatrix",null),(0,i._)([(0,l.MZ)({readOnly:!0})],T.prototype,"inverseProjectionMatrix",null),(0,i._)([(0,l.MZ)()],T.prototype,"fov",null),(0,i._)([(0,l.MZ)()],T.prototype,"fovX",null),(0,i._)([(0,l.MZ)()],T.prototype,"fovY",null),(0,i._)([(0,l.MZ)()],T.prototype,"viewInverseTransposeMatrix",null),(0,i._)([(0,l.MZ)({readOnly:!0})],T.prototype,"_projectionMatrixInternal",null),(0,i._)([(0,l.MZ)()],T.prototype,"relativeElevation",void 0),T=x=(0,i._)([(0,c.$)("esri.views.3d.webgl.RenderCamera")],T);const M=T,A=(0,y.vt)(),C=(0,h.vt)(),E=(0,m.vt)(),R=(0,m.vt)(),P=(0,a.r_)()},36451:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var i=r(35143),n=r(91967),s=r(50076),o=r(68134),a=r(46053),l=r(85842),c=r(83490);let u=class extends n.A{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces="composite-color",this._context=null,this._dirty=!0}initialize(){this.addHandles([(0,o.wB)((()=>this.view.ready),(e=>{e&&this.view._stage?.renderer.addRenderNode(this)}),o.Vh)])}destroy(){this.view._stage?.renderer?.removeRenderNode(this)}render(){throw new s.A("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}acquireOutputFramebuffer(){const e=this._frameBuffer?.getTexture()?.descriptor,t=this.view._stage.renderer.fboCache.acquire(e?.width??640,e?.height??480,this.produces);return t.fbo?.initializeAndBind(),t}bindRenderTarget(){return this._frameBuffer?.fbo?.initializeAndBind(),this._frameBuffer}requestRender(e){e===c.C7.UPDATE&&this.view._stage?.renderView.requestRender(e),this._dirty=!0}resetWebGLState(){this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(this._frameBuffer?.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this._context.bindParameters}get renderingContext(){return this.view._stage.renderView.renderingContext}updateAnimation(){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e,t){this._context=t,this._frameBuffer=e.find((e=>{let{name:t}=e;return t===this.produces}));try{return this.render(e)}finally{this._frameBuffer=null}}};(0,i._)([(0,a.MZ)({constructOnly:!0})],u.prototype,"view",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],u.prototype,"consumes",void 0),(0,i._)([(0,a.MZ)()],u.prototype,"produces",void 0),u=(0,i._)([(0,l.$)("esri.views.3d.webgl.RenderNode")],u);const h=u},16455:(e,t,r)=>{"use strict";var i,n;r.d(t,{N:()=>i,z:()=>n}),function(e){e[e.RED=0]="RED",e[e.RG=1]="RG",e[e.RGBA4=2]="RGBA4",e[e.RGBA=3]="RGBA",e[e.RGBA_MIPMAP=4]="RGBA_MIPMAP",e[e.R16F=5]="R16F",e[e.RGBA16F=6]="RGBA16F"}(i||(i={})),function(e){e[e.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",e[e.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(n||(n={}))},64465:(e,t,r)=>{"use strict";var i;function n(e){return"global"===e?i.Global:i.Local}function s(e){return e===i.Global?"global":"local"}r.d(t,{RT:()=>i,_s:()=>s,yX:()=>n}),function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"}(i||(i={}))},64921:(e,t,r)=>{"use strict";var i;r.d(t,{w:()=>i}),function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(i||(i={}))},89196:(e,t,r)=>{"use strict";r.d(t,{l:()=>n});r(81806),r(76460);class i{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const t=e.modifiers;for(const r of this.keyModifiers)if(!t.has(r))return!1;return!0}}class n{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const e of t)this._incomingEventMatches.push(e.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((e=>e.eventType))),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback((e=>this._handleEvent(e))),e.setUninstallCallback((()=>this._onUninstall())),this._manager=e)}onUninstall(){}registerIncoming(e,t,r){let n;"function"==typeof t?(r=t,n=[]):n=t||[];const o="string"==typeof e?new i(e,n):e,a=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},l=e=>{const t=this._incoming[e.match.eventType];if(t){const r=t.indexOf(e);t.splice(r,1),a(),this._manager&&this._manager.updateDependencies()}},c=new s(o,r,{onPause:l,onRemove:l,onResume:e=>{const t=this._incoming[e.match.eventType];t&&!t.includes(e)&&(t.push(e),a(),this._manager&&this._manager.updateDependencies())}});let u=this._incoming[o.eventType];return u||(u=[],this._incoming[o.eventType]=u),u.push(c),a(),this._manager&&this._manager.updateDependencies(),c}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new o(e,{onEmit:(e,t,r,i)=>{this._manager?.emit(e.eventType,t,r,i)},onRemove:e=>{delete this._outgoing[e.eventType],this._manager?.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){this._manager?.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager?.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){const t=this._incoming[e.type];if(t)for(const r of t)if(r.match.matches(e)&&(r.callback?.(e),e.shouldStopPropagation()))break}}class s{constructor(e,t,r){this.match=e,this._callback=t,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class o{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,r){this._removed||this._handler.onEmit(this,e,t,r)}remove(){this._removed=!0,this._handler.onRemove(this)}}},57308:(e,t,r)=>{"use strict";r.d(t,{e:()=>m,o:()=>_});var i=r(35143),n=r(91967),s=(r(81806),r(76460)),o=r(59649),a=r(46053),l=(r(47249),r(85842)),c=r(48606),u=r(41036),h=r(89196);class d extends h.l{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",(e=>{this._update(e.data)}))}_update(e){const t="touch"===e.native.pointerType?"touch":"mouse",{x:r,y:i}=e;t===this._value&&this._x===r&&this._y===i||(this._value=t,this._x=r,this._y=i,this._onChange(t,r,i))}}var p=r(75540);class f extends h.l{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=(0,p.v)(!1),this._onPointerAdd=e=>{let{data:t}=e;"touch"===t.pointerType&&(this._activeTouchPointerIds.add(t.native.pointerId),this._update())},this._onPointerRemove=e=>{let{data:t}=e;"touch"===t.pointerType&&(this._activeTouchPointerIds.delete(t.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}}let m=class extends n.A{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=u.i,this._latestPointerType="mouse",this._propertiesPool=new c.M({latestPointerLocation:v},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some((e=>e.handler.hasPendingInputs))}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.INTERNAL;if(this._nameToGroup[e])return;if(0===t.length)return;const i={name:e,handlers:t.map((e=>({handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null})))};this._nameToGroup[e]=i;for(let n=i.handlers.length-1;n>=0;n--){const e=i.handlers[n];this._handlers.push(e),e.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(t,r,i,n,s)=>{this._emitInputEvent(e.priorityIndex+1,t,r,i,s,n)},setPointerCapture:(t,r)=>{this._setPointerCapture(i,e,t,r)},setEventCallback:t=>{e.eventCallback=t},setUninstallCallback:t=>{e.uninstallCallback=t},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach((e=>{e.removed=!0,e.uninstallCallback?.()})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):s.A.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return void 0!==this._nameToGroup[e]}isModifierKeyDown(e){return this._activeKeyModifiers&&this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const e=this._handlers[r];e.priorityIndex=r,this._handlersPriority.push(e)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const i=this._handlersPriority[r];i.priorityIndex=r;let n=i.handler.hasSideEffects;if(!n)for(const t of i.handler.outgoingEventTypes)if(e.has(t)){n=!0;break}if(n)for(const r of i.handler.incomingEventMatches){e.add(r.eventType);for(const e of r.keyModifiers)(0,u.p)(e)||t.add(e)}i.active=n}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,r){this._latestPointerType=e;const i=this._get("latestPointerLocation");if(null==i||i.x!==t||i.y!==r){const e=this._propertiesPool.get("latestPointerLocation");e.x=t,e.y=r,this._set("latestPointerLocation",e)}}_onEventReceived(e,t){if("pointer-capture-lost"===e){const e=t;this._pointerCaptures.delete(e.native.pointerId)}this._updateKeyModifiers(e,t);const r=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,i=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,r,i)}_updateKeyModifiers(e,t){if(!t)return;let r=!1;const i=()=>{if(!r){const e=new Set;this._activeKeyModifiers.forEach((t=>{e.add(t)})),this._activeKeyModifiers=e,r=!0}},n=(e,t)=>{t&&!this._activeKeyModifiers.has(e)?(i(),this._activeKeyModifiers.add(e)):!t&&this._activeKeyModifiers.has(e)&&(i(),this._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){const r=t.key;this._keyModifiers.has(r)&&n(r,"key-down"===e)}const s=t.native;n("Alt",!(!s||!s.altKey)),n("Control",!(!s||!s.ctrlKey)),n("Ctrl",!(!s||!s.ctrlKey)),n("Shift",!(!s||!s.shiftKey)),n("Meta",!(!s||!s.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new d(((e,t,r)=>this._setLatestPointer(e,t,r))),this._multiTouchHandler=new f,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],_.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,_.INTERNAL)}_setPointerCapture(e,t,r,i){const n=e.name+"-"+t.priorityIndex,s=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,s),i?(s.add(n),1===s.size&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):s.has(n)&&(s.delete(n),0===s.size&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter((e=>!e.removed)),this.updateDependencies()}_emitInputEventFromSource(e,t,r,i){this._emitInputEvent(0,e,t,r,i)}_emitInputEvent(e,t,r,i,n,s){const o=void 0!==i?i:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=void 0!==n&&n,l={event:new g(t,r,o,s||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new o.A,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:t,priorityIndex:r}=e.events.pop(),i=t.data?.eventId;if(null==i||!this._stoppedPropagationEventIds.has(i))for(e.currentHandler=this._handlersPriority[r];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback?.(t),t.shouldStopPropagation()){null!=i&&this._stoppedPropagationEventIds.add(i);break}if(t.shouldPausePropagation((()=>this._continuePropagation())))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new o.A;t.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)t.push(r.events.pop());r.events=t,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const e of t.handler.incomingEventMatches){if(r.eventType!==e.eventType)continue;const t=r.keyModifiers.filter((t=>e.keyModifiers.includes(t)));if(t.length===r.keyModifiers.length!==(t.length===e.keyModifiers.length))return r.keyModifiers.length>e.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const r of e){let e=0;for(;e<t.length&&this._compareHandlerPriority(r,t[e])>=0;)e++;t.splice(e,0,r)}return t}get debug(){const e=e=>{const t=this._setPointerCapture;this._setPointerCapture=()=>{},e(),this._setPointerCapture=t};return{injectEvent:(t,r)=>{e((()=>{this._onEventReceived(t,r)}))},disablePointerCapture:e}}};(0,i._)([(0,a.MZ)({readOnly:!0})],m.prototype,"hasPendingInputs",null),(0,i._)([(0,a.MZ)({constructOnly:!0})],m.prototype,"eventSource",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],m.prototype,"recognizers",void 0),(0,i._)([(0,a.MZ)()],m.prototype,"_latestPointerType",void 0),(0,i._)([(0,a.MZ)()],m.prototype,"latestPointerType",null),(0,i._)([(0,a.MZ)()],m.prototype,"multiTouchActive",null),(0,i._)([(0,a.MZ)({readOnly:!0})],m.prototype,"latestPointerLocation",void 0),(0,i._)([(0,a.MZ)()],m.prototype,"_paused",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],m.prototype,"updating",null),m=(0,i._)([(0,l.$)("esri.views.input.InputManager")],m);class g{constructor(e,t,r,i,n){this.type=e,this.data=t,this.timestamp=r,this.modifiers=i,this.cancelable=n,this._propagationState=y.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=y.STOPPED}shouldStopPropagation(){return!!(this._propagationState&y.STOPPED)}async(e){this._propagationState|=y.PAUSED;const t=(e,t)=>{this._propagationState&=~y.PAUSED;const r=this._resumeCallback;if(this._resumeCallback=null,r&&r(),t)throw e;return e};return("function"==typeof e?e():e).then((e=>t(e,!1)),(e=>t(e,!0)))}shouldPausePropagation(e){return!!(this._propagationState&y.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}}var y;!function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"}(y||(y={}));const _={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};const v=class{}},71732:(e,t,r)=>{"use strict";r.d(t,{XF:()=>h,mu:()=>l});r(81806);var i=r(54901),n=r(15941),s=r(76931),o=r(89196),a=r(57308);r(64921);const l=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],c={};function u(e){return!!c[e]}l.forEach((e=>{c[e]=!0}));class h{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(((e,t)=>{let{handler:r,priority:i}=e;return this.inputManager?.installHandlers(t,[r],i)}))}disconnect(){this.inputManager&&this._handlers.forEach(((e,t)=>this.inputManager?.uninstallHandlers(t))),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,t,r,n){const s=Array.isArray(e)?e:e.split(",");if(!function(e){for(const t of e)if(!u(t))return!1;return!0}(s))return s.some(u)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,l;Array.isArray(t)?l=t:(o=t,l=[]),"function"==typeof r?o=r:n=r,n=null!=n?n:a.o.DEFAULT;const c=this._createUniqueGroupName(),h=new d(this.view,s,l,o);this._handlers.set(c,{handler:h,priority:n});for(const i of s){const e=this._handlerCounts.get(i)||0;this._handlerCounts.set(i,e+1)}return this.inputManager&&this.inputManager.installHandlers(c,[h],n),(0,i.hA)((()=>this._removeHandler(c,s)))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,t){if(this._handlers.has(e)){this._handlers.delete(e);for(const e of t){const t=this._handlerCounts.get(e);void 0===t||(1===t?this._handlerCounts.delete(e):this._handlerCounts.set(e,t-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}}class d extends o.l{constructor(e,t,r,i){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of t)switch(n){case"click":this.registerIncoming("click",r,(t=>i(m(e,t))));break;case"double-click":this.registerIncoming("double-click",r,(t=>i(g(e,t))));break;case"immediate-click":this.registerIncoming("immediate-click",r,(t=>i(y(e,t))));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,(t=>i(_(e,t))));break;case"hold":this.registerIncoming("hold",r,(t=>i(v(e,t))));break;case"drag":this.registerIncoming("drag",r,(e=>{const t=this._wrapDrag(e);t&&i(t)}));break;case"key-down":this.registerIncoming("key-down",r,(e=>i(w(e))));break;case"key-up":this.registerIncoming("key-up",r,(e=>i(x(e))));break;case"pointer-down":this.registerIncoming("pointer-down",r,(e=>i(S(e,"pointer-down"))));break;case"pointer-move":this.registerIncoming("pointer-move",r,(e=>i(S(e,"pointer-move"))));break;case"pointer-up":this.registerIncoming("pointer-up",r,(e=>i(S(e,"pointer-up"))));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,(e=>i(T(e))));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,(e=>i(M(e))));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,(e=>i(S(e,"pointer-enter"))));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,(e=>i(S(e,"pointer-leave"))));break;case"gamepad":this.registerIncoming("gamepad",r,(e=>{i(A(e))}));break;case"focus":this.registerIncoming("focus",r,(e=>{i(p(e))}));break;case"blur":this.registerIncoming("blur",r,(e=>{i(f(e))}))}}_wrapDrag(e){const t=e.data,{x:r,y:i}=t.center,{action:s,pointerType:o,button:a}=t;if("start"===s&&(this._latestDragStart=t),!this._latestDragStart)return;const l=t.pointer.native,c=t.buttons,{cancelable:u,timestamp:h}=e,d={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return"end"===s&&(this._latestDragStart=void 0),{type:"drag",action:s,x:r,y:i,origin:d,pointerType:o,button:a,buttons:c,radius:t.radius,angle:(0,n.KJ)(t.angle),native:l,timestamp:h,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}}function p(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function f(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function m(e,t){const{pointerType:r,button:i,buttons:n,x:o,y:a,native:l,eventId:c}=t.data,{cancelable:u,timestamp:h}=t;return{type:"click",pointerType:r,button:i,buttons:n,x:o,y:a,native:l,timestamp:h,screenPoint:(0,s.tc)(o,a),mapPoint:b(e,o,a),eventId:c,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function g(e,t){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:u}=t;return{type:"double-click",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:u,mapPoint:b(e,s,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function y(e,t){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:u,timestamp:h}=t;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:h,mapPoint:b(e,s,o),eventId:l,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function _(e,t){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:u,timestamp:h}=t;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:h,mapPoint:b(e,s,o),eventId:l,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function v(e,t){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a}=t.data,{cancelable:l,timestamp:c}=t;return{type:"hold",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:c,mapPoint:b(e,s,o),cancelable:l,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function b(e,t,r){return e.toMap((0,s.tc)(t,r),{exclude:[]})}function w(e){const{key:t,repeat:r,native:i}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-down",key:t,repeat:r,native:i,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function x(e){const{key:t,native:r}=e.data,{cancelable:i,timestamp:n}=e;return{type:"key-up",key:t,native:r,timestamp:n,cancelable:i,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function S(e,t){const{x:r,y:i,button:n,buttons:s,native:o,eventId:a}=e.data,l=o.pointerId,c=o.pointerType,{cancelable:u,timestamp:h}=e;return{type:t,x:r,y:i,pointerId:l,pointerType:c,button:n,buttons:s,native:o,timestamp:h,eventId:a,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function T(e){const{x:t,y:r,buttons:i,native:n,eventId:s}=e.data.currentEvent,{button:o}=e.data.startEvent,a=e.data.startEvent.native.pointerId,l=e.data.startEvent.native.pointerType,c=e.data.action,u={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:h,timestamp:d}=e;return{type:"pointer-drag",x:t,y:r,pointerId:a,pointerType:l,button:o,buttons:i,action:c,origin:u,native:n,timestamp:d,eventId:s,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function M(e){const{cancelable:t,data:r,timestamp:i}=e,{x:n,y:s,deltaY:o,native:a}=r;return{type:"mouse-wheel",x:n,y:s,deltaY:o,native:a,timestamp:i,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function A(e){const{action:t,state:r,device:i}=e.data,{cancelable:n,timestamp:s}=e,{buttons:o,axes:a}=r;return{type:"gamepad",device:i,timestamp:s,action:t,buttons:o,axes:a,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}},41036:(e,t,r)=>{"use strict";r.d(t,{i:()=>i,p:()=>s});const i=(0,r(81806).A)("mac")?"Meta":"Control",n=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),s=e=>n.has(e)},76336:(e,t,r)=>{"use strict";var i,n,s;r.d(t,{PK:()=>i,SJ:()=>s,p7:()=>n}),function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"}(i||(i={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(n||(n={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(s||(s={}))},80544:(e,t,r)=>{"use strict";r.d(t,{e:()=>u});r(81806);var i=r(30726),n=r(50346),s=r(59649),o=r(67993),a=r(52394),l=r(75540);class c{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}class u{constructor(e){this._schedule=null,this._task=null,this._deferreds=new o.A,this._controllers=new o.A,this._processingItems=new o.A,this._pausedSignal=(0,l.v)(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new s.A(e.peeker),this.process=e.process;const t=e.scheduler;e.priority&&t&&(this._task=t.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=(0,i.xt)(this._schedule),this._task=(0,i.xt)(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach((t=>e.push(t))),this._controllers.clear(),e.forEach((e=>e.abort())),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach(((t,r)=>e(r)))}get(e){const t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,t){const r=this.get(e);if(r)return r;const i=new AbortController;let s=null;t&&(s=(0,n.u7)(t,(()=>i.abort())));const o=()=>{a.remove(),null!=s&&s.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},a=(0,n.NY)(i.signal,(()=>{const t=this._processingItems.get(e);t&&t.controller.abort(),o(),l.reject((0,n.NK)())})),l=(0,n.Tw)();return this._deferreds.set(e,l),this._controllers.set(e,i),l.promise.then(o,o),this._queue.push(e),this._scheduleNext(),l.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject((0,n.NK)("Removed from queue")),this._removeItem(e)),e}reset(){const e=[];this._processingItems.forEach((t=>e.push(t))),this._processingItems.clear();for(const t of e)this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=(0,a._)((()=>{this._schedule=null,this._next()})))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(null==e)return;let t;const r=new AbortController,i=new c(e,r);this._processingItems.set(e,i);try{t=this.process(e,r.signal)}catch(s){this._processError(i,s)}(0,n.$X)(t)?(i.promise=t,t.then((e=>this._processResult(i,e)),(e=>this._processError(i,e)))):this._processResult(i,t)}get test(){}}},98476:(e,t,r)=>{"use strict";var i;r.d(t,{M:()=>i}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(i||(i={}))},59752:(e,t,r)=>{"use strict";r.d(t,{Bb:()=>C,W6:()=>i,mj:()=>y,nu:()=>E});var i,n=r(88321),s=(r(81806),r(76460)),o=r(30726),a=r(32634),l=r(30015),c=r(50346),u=r(68134),h=r(75540),d=r(91417),p=r(84031),f=r(5551),m=r(98476),g=r(22856);function y(){return new M.Scheduler}!function(e){e.RESOURCE_CONTROLLER_IMMEDIATE="immediate",e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.LOD_RENDERER="LoD renderer",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="clouds generator",e[e.NONE=0]="NONE",e[e.TEST_PRIO=1]="TEST_PRIO"}(i||(i={}));const _=new Map([[i.RESOURCE_CONTROLLER_IMMEDIATE,0],[i.RESOURCE_CONTROLLER,4],[i.SLIDE,0],[i.STREAM_DATA_LOADER,0],[i.ELEVATION_QUERY,0],[i.TERRAIN_SURFACE,1],[i.SURFACE_GEOMETRY_UPDATES,1],[i.LOD_RENDERER,2],[i.GRAPHICS_CORE,2],[i.I3S_CONTROLLER,2],[i.POINT_CLOUD_LAYER,2],[i.FEATURE_TILE_FETCHER,2],[i.OVERLAY,4],[i.STAGE,4],[i.GRAPHICS_DECONFLICTOR,4],[i.FILTER_VISIBILITY,4],[i.SCALE_VISIBILITY,4],[i.FRUSTUM_VISIBILITY,4],[i.CLOUDS_GENERATOR,4],[i.POINT_OF_INTEREST_FREQUENT,6],[i.POINT_OF_INTEREST_INFREQUENT,30],[i.LABELER,8],[i.FEATURE_QUERY_ENGINE,8],[i.FEATURE_TILE_TREE,16],[i.FEATURE_TILE_TREE_ACTIVE,0],[i.ELEVATION_ALIGNMENT,12],[i.ELEVATION_ALIGNMENT_SCENE,14],[i.TEXT_TEXTURE_ATLAS,12],[i.TEXTURE_UNLOAD,12],[i.LINE_OF_SIGHT_TOOL,16],[i.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[i.SNAPPING,0],[i.SHADOW_ACCUMULATOR,30]]);function v(e){return _.has(e)?_.get(e):"number"==typeof e?e:1}const b=(0,d.l5)(6.5),w=(0,d.l5)(1),x=(0,d.l5)(30),S=(0,d.l5)(1e3/30),T=(0,d.l5)(100);var M,A;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,h.v)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new a.A("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=m.M.INTERACTING,this._tasks=new l.A,this._runQueue=new l.A,this._load=0,this._idleStateCallbacks=new l.A,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,u.wB)((()=>f.A.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),u.Vh);for(const e of Object.keys(i))this.performanceInfo.tasks.set(i[e],new a.A(i[e]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,o.xt)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())})))}registerTask(e,r){const i=new t(this,e,r);return this._tasks.push(i),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new a.A(e)),i}registerIdleStateCallbacks(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),this.state===m.M.IDLE&&this._idleUpdatesStartFired&&r.idleBegin();const i=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){i._idleUpdatesStartFired&&(r.idleEnd(),i._state===m.M.IDLE&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==m.M.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}updateBudget(e){++this._frameNumber;let t=b,r=e.frameDuration,i=w;switch(this.state){case m.M.IDLE:t=(0,d.l5)(0),r=(0,d.l5)(Math.max(T,e.frameDuration)),i=x;break;case m.M.INTERACTING:r=(0,d.l5)(Math.max(S,e.frameDuration));case m.M.ANIMATING:}return r=(0,d.l5)(r-e.elapsedFrameTime-t),this.state!==m.M.IDLE&&r<w&&!this._forceTask?(this._forceTask=!0,!1):(r=(0,d.l5)(Math.max(r,i)),this._budget.reset(r,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case m.M.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case m.M.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset((0,d.l5)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return A.SCHEDULED;let t=A.IDLE;return this._tasks.forAll((r=>{r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?t=A.READY:t!==A.READY&&(t=A.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((r=>{r.name===e&&(t+=r.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,r)=>{t+=e>1?` ${e}x ${r}`:` ${r}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((r=>{r.needsUpdate&&0!==r.schedulePriority&&0!==r.basePriority&&r.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,r.basePriority),1===r.schedulePriority?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const r=this._budget.now(),n=this._runQueue.pop();this._budget.resetProgress();try{n.task.runTask(this._budget)===g.G&&(n.blockFrame=this._frameNumber)}catch(t){s.A.getLogger("esri.views.support.Scheduler").error(`Exception in task "${n.name}"`,t),n.blockFrame=this._frameNumber}!this._budget.hasProgressed&&n.blockFrame!==this._frameNumber&&n.needsUpdate&&(n.name,i.I3S_CONTROLLER,n.blockFrame=this._frameNumber),n.schedulePriority=n.basePriority;const o=this._budget.now()-r;if(n.runtime+=o,this._frameTaskTimes.set(n.priority,this._frameTaskTimes.get(n.priority)+o),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(i))this._frameTaskTimes.set(i[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,r){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new p.T,this._handles=new n.A,this._basePriority=v(t),this.schedulePriority=this._basePriority,this._task=(0,h.v)(null!=r?r:this._queue),this._handles.add((0,u.z7)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(C),this._scheduler.removeTask(this),this.schedule=E.schedule,this.reschedule=E.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=v(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,r){return this._queue.push(e,t,r)}reschedule(e,t,r){return this._queue.unshift(e,t,r)}processQueue(e){return this._queue.runTask(e)}}class r{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=m.M.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=r}(M||(M={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(A||(A={}));const C=(()=>{const e=new M.Budget;return e.enabled=!1,e})();const E=new class{remove(){}processQueue(){}schedule(e,t,r){try{if((0,c.G4)(t)){const e=(0,c.NK)();return r?Promise.resolve(r(e)):Promise.reject(e)}return(0,c.z7)(e(C))}catch(i){return Promise.reject(i)}}reschedule(e,t,r){return this.schedule(e,t,r)}}},22856:(e,t,r)=>{"use strict";r.d(t,{G:()=>i});const i=Symbol("Yield")},5551:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var i=r(35143),n=r(91967),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842));let a=class extends n.A{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,i._)([(0,s.MZ)()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=(0,i._)([(0,o.$)("esri.views.support.debugFlags")],a);const l=new a},29772:(e,t,r)=>{"use strict";r.d(t,{Ce:()=>f,NH:()=>p,Of:()=>y,Qc:()=>_,Xg:()=>h,cL:()=>w,e5:()=>g,ll:()=>m,sT:()=>b,vp:()=>v});var i,n=r(24648),s=r(31633),o=r(20664),a=r(9392),l=r(14487),c=r(80963),u=r(41868);function h(e){return d(e,i.Horizontal)}function d(e,t){const{hasZ:r,spatialReference:o}=e,a=(0,u.l)(o);let l=0;const c=(0,s._H)(a);if(null==c)return null;const h=t===i.Direct?v:b;for(const i of e.paths){if(i.length<2)continue;const e=i.length-1;for(let t=0;t<e;++t){const e=i[t];S[0]=e[0],S[1]=e[1],S[2]=r?e[2]:0;const n=i[t+1];T[0]=n[0],T[1]=n[1],T[2]=r?n[2]:0;const s=h(S,T,o);if(null==s)return null;l+=s.value}}return(0,n.d_)(l,c)}function p(e,t){const{spatialReference:r}=e;return(0,c.aI)(r,t.spatialReference)?(S[0]=e.x,S[1]=e.y,S[2]=e.hasZ?e.z:0,T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,function(e,t,r){const i=x(e,t,r);return null!=i?{direct:(0,n.d_)(i.direct,i.unit),horizontal:(0,n.d_)(i.horizontal,i.unit),vertical:(0,n.d_)(i.vertical,i.unit)}:null}(S,T,r)):null}function f(e,t){const{spatialReference:r}=e;return(0,c.aI)(r,t.spatialReference)?(S[0]=e.x,S[1]=e.y,S[2]=e.hasZ?e.z:0,T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,v(S,T,r)):null}function m(e,t){const{spatialReference:r}=e;return(0,c.aI)(r,t.spatialReference)?(S[0]=e.x,S[1]=e.y,S[2]=e.hasZ?e.z:0,T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,b(S,T,r)):null}function g(e,t){const{spatialReference:r}=e;return(0,c.aI)(r,t.spatialReference)?(S[0]=e.x,S[1]=e.y,S[2]=e.hasZ?e.z:0,T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,w(S,T,r)):null}function y(e){return null!=e?_(e.hasZ?e.z:0,e.spatialReference):null}function _(e,t){const r=(0,s.mq)(t);return null!=r?(0,n.d_)(e??0,r):null}function v(e,t,r){const s=x(e,t,r,i.Direct);return null!=s?(0,n.d_)(s.direct,s.unit):null}function b(e,t,r){const s=x(e,t,r,i.Horizontal);return null!=s?(0,n.d_)(s.horizontal,s.unit):null}function w(e,t,r){const s=x(e,t,r,i.Vertical);return null!=s?(0,n.d_)(s.verticalSigned,s.unit):null}function x(e,t,r,n){const a=(0,u.l)(r),c=(0,s._H)(a);if(null==c)return null;const h=t[2]-e[2];if(n===i.Vertical)return{verticalSigned:h,unit:c};if(!(0,l.F)(e,r,M,a)||!(0,l.F)(t,r,A,a))return null;if(n===i.Direct)return{direct:(0,o.p)(A,M),unit:c};if((0,o.s)(C,e[0],e[1],t[2]),!(0,l.F)(C,r,C,a))return null;const d=(0,o.p)(C,A);return n===i.Horizontal?{horizontal:d,unit:c}:{direct:(0,o.p)(A,M),horizontal:d,vertical:Math.abs(h),unit:c}}!function(e){e[e.Direct=0]="Direct",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"}(i||(i={}));const S=(0,a.vt)(),T=(0,a.vt)(),M=(0,a.vt)(),A=(0,a.vt)(),C=(0,a.vt)()},90992:(e,t,r)=>{"use strict";function i(e){return e&&"function"==typeof e.highlight}function n(e){return e&&"function"==typeof e.maskOccludee}function s(e,t,r){return null==e||e>=r&&(0===t||e<=t)}function o(e,t){if(t&&e){const{minScale:r,maxScale:i}=e;if(a(r,i))return s(t,r,i)}return!0}function a(e,t){return null!=e&&e>0||null!=t&&t>0}function l(e){return!e?.minScale||!e.maxScale||e.minScale>=e.maxScale}r.d(t,{E5:()=>o,JU:()=>s,Of:()=>i,Uk:()=>n,WK:()=>a,g7:()=>l})},41868:(e,t,r)=>{"use strict";r.d(t,{l:()=>o});var i=r(34111),n=r(98510),s=r(80963);function o(e){return(0,s.B3)(e)?(0,s.oT)(e)||(0,s.K8)(e)||(0,s.x1)(e)||(0,i.jA)(e)?n.Y0:e:(0,n.lO)(e)}},11500:(e,t,r)=>{"use strict";r.d(t,{FV:()=>l,Uo:()=>o,ZV:()=>n,sC:()=>s,xB:()=>a});r(81806);var i=r(76931);function n(e){return(0,i.tc)(e.x,e.y)}function s(e){return(0,i.gs)(e.x,e.y)}function o(e,t){const r=(e instanceof HTMLElement?e:e.surface)?.getBoundingClientRect();return r?(0,i.tc)(t.clientX-r.left,t.clientY-r.top):(0,i.tc)(0,0)}function a(e,t){return t instanceof Event?o(e,t):n(t)}function l(e){if(e instanceof Event)return!0;if("object"==typeof e&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}},59801:(e,t,r)=>{"use strict";r.d(t,{M:()=>s});var i=r(34038),n=r(64465);function s(e,t){return null!=e&&(null==t||(t===n.RT.Local?!e.isGeographic||e.isWGS84||e.wkid===i.Y.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===i.Y.CGCS2000||e.wkid===i.Y.GCSMARS2000||e.wkid===i.Y.GCSMARS2000_SPHERE||e.wkid===i.Y.GCSMOON2000))}},76718:(e,t,r)=>{"use strict";r.d(t,{g:()=>c});var i=r(18690),n=(r(81806),r(76460)),s=r(78393),o=r(61678),a=r(93345);const l=()=>n.A.getLogger("esri.views.webgl.BufferObject");class c{static createIndex(e,t,r){return new c(e,a.NZ.ELEMENT_ARRAY_BUFFER,t,r)}static createVertex(e,t,r){return new c(e,a.NZ.ARRAY_BUFFER,t,r)}static createUniform(e,t,r){return new c(e,a.NZ.UNIFORM_BUFFER,t,r)}static createPixelPack(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a._U.STREAM_READ,r=arguments.length>2?arguments[2]:void 0;const i=new c(e,a.NZ.PIXEL_PACK_BUFFER,t);return r&&i.setSize(r),i}static createPixelUnpack(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a._U.STREAM_DRAW,r=arguments.length>2?arguments[2]:void 0;return new c(e,a.NZ.PIXEL_UNPACK_BUFFER,t,r)}static createTransformFeedback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a._U.STATIC_DRAW,r=arguments.length>2?arguments[2]:void 0;const i=new c(e,a.NZ.TRANSFORM_FEEDBACK_BUFFER,t);return i.setSize(r),i}constructor(e,t,r,i){this._context=e,this.bufferType=t,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(a.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,o.Y2)(this._context.gl),i&&this.setData(i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER?this._indexType===a.pe.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===a.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.vt.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case a.pe.UNSIGNED_SHORT:e*=2;break;case a.pe.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&((0,s.jq)(e)&&(t/=2,this._indexType=a.pe.UNSIGNED_SHORT),(0,s.XJ)(e)&&(t/=4,this._indexType=a.pe.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const i=this._context.gl;null!=t?i.bufferData(this.bufferType,t,this.usage):i.bufferData(this.bufferType,e,this.usage),(0,o.Y2)(i),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,t,r,i){if(!e)return;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:s}=this._context;s.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,r,i-r),(0,o.Y2)(s),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(r<0||n<0)return;const s=function(e){return(0,i.Xj)(e)}(e)?e.BYTES_PER_ELEMENT:1;if(s*((r??0)+(n??0))>e.byteLength)return;t+s*(n??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===a.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.NZ.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(a.NZ.TRANSFORM_FEEDBACK_BUFFER,t,e,r,n),this._context.unbindBuffer(a.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.NZ.COPY_READ_BUFFER),o.getBufferSubData(a.NZ.COPY_READ_BUFFER,t,e,r,n),this._context.unbindBuffer(a.NZ.COPY_READ_BUFFER))}async getSubDataAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;await this._context.clientWaitAsync(),this.getSubData(e,t,r,i)}}},12331:(e,t,r)=>{"use strict";r.d(t,{H:()=>d,T:()=>f});r(81806);var i=r(76460),n=r(30726),s=r(76718),o=r(61678),a=r(93345),l=r(89179),c=r(62881),u=r(98433);const h=()=>i.A.getLogger("esri.views.webgl.FramebufferObject");class d{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(a.vt.FramebufferObject,this);const i=p(t)?t:new u.g(this._context,t);if(this._colorAttachments.set(a.Nm.COLOR_ATTACHMENT0,i),this._validateTextureDescriptor(i.descriptor),this._validateColorAttachmentPoint(a.Nm.COLOR_ATTACHMENT0),null!=r)if(function(e){return p(e)||null!=e&&"pixelFormat"in e}(r))this._depthStencilTexture=p(r)?r:new u.g(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const e=function(e){return null!=e&&"type"in e&&e.type===l.p.RenderBuffer}(r)?r:new c.l(this._context,r);this._depthStencilBuffer=e,this._validateRenderBufferDescriptor(e.descriptor)}}dispose(){if(0===this._colorAttachments.size&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach(((e,t)=>this.detachColorTexture(t)?.dispose())),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(a.vt.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){const e=this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0);return e?.descriptor?.width??0}get height(){const e=this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0);return e?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce(((e,t)=>{let[r,i]=t;return e+i.usedMemory}),this.depthStencil?.usedMemory??0)}getColorTexture(e){const t=this._colorAttachments.get(e);return t&&p(t)?t:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Nm.COLOR_ATTACHMENT0;if(!e)return;this._validateColorAttachmentPoint(t);const r=e.descriptor;this._validateTextureDescriptor(r),this.detachColorTexture(t)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,t)),this._colorAttachments.set(t,e)}detachColorTexture(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.Nm.COLOR_ATTACHMENT0;const t=this._colorAttachments.get(e);if(t){if(this._initialized){const t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(t)}return this._colorAttachments.delete(e),t}}setColorTextureTarget(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Nm.COLOR_ATTACHMENT0;const r=this._colorAttachments.get(t);r&&this._framebufferTexture2D(r.glName,t,e)}attachDepthStencil(e){if(e)switch(e.type){case l.p.Texture:return this._attachDepthStencilTexture(e);case l.p.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(null==e)return;const t=e.descriptor;t.pixelFormat!==a.Ab.DEPTH_STENCIL&&t.pixelFormat!==a.Ab.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),t.dataType!==a.ld.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(t),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,a.nI)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){const e=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,a.nI),this._context.bindFramebuffer(e)}return this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(null==e)return;const t=e.descriptor;if(this._validateRenderBufferDescriptor(t),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(t);r.framebufferRenderbuffer(a.R.FRAMEBUFFER,i,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(a.R.FRAMEBUFFER,i,r.RENDERBUFFER,null),this._context.bindFramebuffer(t)}return this._depthStencilBuffer=null,e}copyToTexture(e,t,r,i,n,s,o){(e<0||t<0||n<0||s<0)&&console.error("Offsets cannot be negative!"),(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!");const l=o.descriptor;o.descriptor.target!==a.Ap.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(null==l?.width||null==l?.height||e+r>this.width||t+i>this.height||n+r>l.width||s+i>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(o,u.g.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(u.g.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(a.Ap.TEXTURE_2D,0,n,s,e,t,r,i),c.bindTexture(h,u.g.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,t,r,i,n,s,o){(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,r,i,n,s,o)}async readPixelsAsync(e,t,r,i,n,o,l){const{gl:c}=this._context,u=s.g.createPixelPack(this._context,a._U.STREAM_READ,l.byteLength);this._context.bindBuffer(u),this._context.bindFramebuffer(this),c.readPixels(e,t,r,i,n,o,0),this._context.unbindBuffer(a.NZ.PIXEL_PACK_BUFFER),await u.getSubDataAsync(l),u.dispose()}resize(e,t){if(this.width===e&&this.height===t)return;const r={width:e,height:t};f(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach((e=>e.resize(r.width,r.height))),this._depthStencilTexture?.resize(r.width,r.height),this._initialized&&(f(r,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.R.FRAMEBUFFER;const t=this._context.gl;if(this._initialized)return void t.bindFramebuffer(e,this.glName);this._glName&&t.deleteFramebuffer(this._glName);const r=t.createFramebuffer();if(t.bindFramebuffer(e,r),this._colorAttachments.forEach(((t,r)=>this._framebufferTexture2D(t.glName,r,m(t),e))),this._depthStencilBuffer){const r=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(e,r,t.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,t.DEPTH_STENCIL_ATTACHMENT,m(this._depthStencilTexture),e);(0,o.en)()&&t.checkFramebufferStatus(e)!==t.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Nm.COLOR_ATTACHMENT0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.Ap.TEXTURE_2D,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.R.FRAMEBUFFER,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this._context.gl.framebufferTexture2D(i,t,r,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const t=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(a.R.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthStencilBuffer=(0,n.WD)(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=(0,n.WD)(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==a.Ap.TEXTURE_2D&&e.target!==a.Ap.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),f(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){f(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case a.yQ.DEPTH_COMPONENT16:case a.yQ.DEPTH_COMPONENT24:case a.yQ.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case a.yQ.DEPTH24_STENCIL8:case a.yQ.DEPTH32F_STENCIL8:case a.yQ.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case a.yQ.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(-1===d._MAX_COLOR_ATTACHMENTS){const{gl:e}=this._context;d._MAX_COLOR_ATTACHMENTS=e.getParameter(e.MAX_COLOR_ATTACHMENTS)}const t=e-a.Nm.COLOR_ATTACHMENT0;t+1>d._MAX_COLOR_ATTACHMENTS&&i.A.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${t+1}. Implementation supports up to ${d._MAX_COLOR_ATTACHMENTS} color attachments`)}}function p(e){return null!=e&&"type"in e&&e.type===l.p.Texture}function f(e,t){const r=Math.max(e.width,e.height);if(r>t){h().warn(`Resizing FBO attachment size ${e.width}x${e.height} to device limit ${t}`);const i=t/r;return e.width=Math.round(e.width*i),e.height=Math.round(e.height*i),!1}return!0}function m(e){return e.descriptor.target===a.Ap.TEXTURE_CUBE_MAP?a.Ap.TEXTURE_CUBE_MAP_POSITIVE_X:a.Ap.TEXTURE_2D}d._MAX_COLOR_ATTACHMENTS=-1},89179:(e,t,r)=>{"use strict";var i;r.d(t,{p:()=>i}),function(e){e[e.Texture=0]="Texture",e[e.RenderBuffer=1]="RenderBuffer"}(i||(i={}))},44488:(e,t,r)=>{"use strict";r.d(t,{B:()=>N});r(81806);var i=r(61678),n=r(93345);const s=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],o={enableCache:!1};var a=r(35363),l=999,c=9999,u=0,h=1,d=2,p=3,f=4,m=5,g=6,y=7,_=8,v=9,b=10,w=11,x=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function S(){var e,t,r,i=0,n=0,s=l,o=[],S=[],T=1,M=0,A=0,C=!1,E=!1,R="";return function(e){return S=[],null!==e?O(e.replace?e.replace(/\r\n/g,"\n"):e):(o.length&&P(o.join("")),s=b,P("(eof)"),S)};function P(e){e.length&&S.push({type:x[s],data:e,position:A,line:T,column:M})}function O(t){var o;for(i=0,r=(R+=t).length;e=R[i],i<r;){switch(o=i,s){case u:i=D();break;case h:case d:i=N();break;case p:i=F();break;case f:i=U();break;case w:i=z();break;case m:i=V();break;case c:i=B();break;case v:i=L();break;case l:i=I()}o!==i&&("\n"===R[o]?(M=0,++T):++M)}return n+=i,R=R.slice(i),S}function I(){return o=o.length?[]:o,"/"===t&&"*"===e?(A=n+i-1,s=u,t=e,i+1):"/"===t&&"/"===e?(A=n+i-1,s=h,t=e,i+1):"#"===e?(s=d,A=n+i,i):/\s/.test(e)?(s=v,A=n+i,i):(C=/\d/.test(e),E=/[^\w_]/.test(e),A=n+i,s=C?f:E?p:c,i)}function L(){return/[^\s]/g.test(e)?(P(o.join("")),s=l,i):(o.push(e),t=e,i+1)}function N(){return"\r"!==e&&"\n"!==e||"\\"===t?(o.push(e),t=e,i+1):(P(o.join("")),s=l,i)}function D(){return"/"===e&&"*"===t?(o.push(e),P(o.join("")),s=l,i+1):(o.push(e),t=e,i+1)}function F(){if("."===t&&/\d/.test(e))return s=m,i;if("/"===t&&"*"===e)return s=u,i;if("/"===t&&"/"===e)return s=h,i;if("."===e&&o.length){for(;k(o););return s=m,i}if(";"===e||")"===e||"("===e){if(o.length)for(;k(o););return P(e),s=l,i+1}var r=2===o.length&&"="!==e;if(/[\w_\d\s]/.test(e)||r){for(;k(o););return s=l,i}return o.push(e),t=e,i+1}function k(e){for(var t,r,i=0;;){if(t=a.o.indexOf(e.slice(0,e.length+i).join("")),r=a.o[t],-1===t){if(i--+e.length>0)continue;r=e.slice(0,1).join("")}return P(r),A+=r.length,(o=o.slice(r.length)).length}}function z(){return/[^a-fA-F0-9]/.test(e)?(P(o.join("")),s=l,i):(o.push(e),t=e,i+1)}function U(){return"."===e||/[eE]/.test(e)?(o.push(e),s=m,t=e,i+1):"x"===e&&1===o.length&&"0"===o[0]?(s=w,o.push(e),t=e,i+1):/[^\d]/.test(e)?(P(o.join("")),s=l,i):(o.push(e),t=e,i+1)}function V(){return"f"===e&&(o.push(e),t=e,i+=1),/[eE]/.test(e)||"-"===e&&/[eE]/.test(t)?(o.push(e),t=e,i+1):/[^\d]/.test(e)?(P(o.join("")),s=l,i):(o.push(e),t=e,i+1)}function B(){if(/[^\d\w_]/.test(e)){var r=o.join("");return s=a.l.indexOf(r)>-1?_:a.b.indexOf(r)>-1?y:g,P(o.join("")),s=l,i}return o.push(e),t=e,i+1}}function T(e){return function(e){var t=S(),r=[];return(r=r.concat(t(e))).concat(t(null))}(e)}const M=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function A(e,t){for(let r=t-1;r>=0;r--){const t=e[r];if("whitespace"!==t.type&&"block-comment"!==t.type){if("keyword"!==t.type)break;if("attribute"===t.data||"in"===t.data)return!0}}return!1}function C(e,t,r,i){i=i||r;for(const n of e)if("ident"===n.type&&n.data===r)return i in t?t[i]++:t[i]=0,C(e,t,i+"_"+t[i],i);return r}function E(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"afterVersion";function i(e,t){for(let r=t;r<e.length;r++){const t=e[r];if("operator"===t.type&&";"===t.data)return r}return null}const n={data:"\n",type:"whitespace"},s=t=>t<e.length&&/[^\r\n]$/.test(e[t].data);let o=function(e){let t=-1,n=0,s=-1;for(let o=0;o<e.length;o++){const a=e[o];if("preprocessor"===a.type&&(/#(if|ifdef|ifndef)\s+.+/.test(a.data)?++n:/#endif\s*.*/.test(a.data)&&--n),"afterVersion"!==r&&"afterPrecision"!==r||"preprocessor"===a.type&&a.data.startsWith("#version")&&(s=Math.max(s,o)),"afterPrecision"===r&&"keyword"===a.type&&"precision"===a.data){const t=i(e,o);if(null===t)throw new Error("precision statement not followed by any semicolons!");s=Math.max(s,t)}t<s&&0===n&&(t=o)}return t+1}(e);s(o-1)&&e.splice(o++,0,n);for(const a of t)e.splice(o++,0,a);s(o-1)&&s(o)&&e.splice(o,0,n)}function R(e,t,r){E(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:arguments.length>3&&void 0!==arguments[3]?arguments[3]:"lowp"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function P(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"lowp";E(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function O(e,t){let r,i,n=-1;for(let s=t;s<e.length;s++){const t=e[s];if("operator"===t.type&&("["===t.data&&(r=s),"]"===t.data)){i=s;break}"integer"===t.type&&(n=parseInt(t.data,10))}return r&&i&&e.splice(r,i-r+1),n}function I(e,t){if(e.startsWith("#version 300"))return e;const r=function(e){return o.enableCache?L.get(e):null}(e);if(null!=r)return r;const i=T(e);if("300 es"===function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"100",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"300 es";const i=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of e)if("preprocessor"===n.type){const e=i.exec(n.data);if(e){const i=e[1].replaceAll(/\s{2,}/g," ");if(i===r)return i;if(i===t)return n.data="#version "+r,t;throw new Error("unknown glsl version: "+i)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:"\n"}),null}(i,"100","300 es"))return e;let a=null,l=null;const c={},u={};for(let o=0;o<i.length;++o){const e=i[o];switch(e.type){case"keyword":t===n.Co.VERTEX_SHADER&&"attribute"===e.data?e.data="in":"varying"===e.data&&(e.data=t===n.Co.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(e.data.trim())&&(e.data=e.data.replaceAll(/(2D|Cube|EXT)/g,"")),t===n.Co.FRAGMENT_SHADER&&"gl_FragColor"===e.data&&(a||(a=C(i,c,"fragColor"),R(i,a,"vec4")),e.data=a),t===n.Co.FRAGMENT_SHADER&&"gl_FragData"===e.data){const t=O(i,o+1),r=C(i,c,"fragData");P(i,r,"vec4",t,"mediump"),e.data=r}else t===n.Co.FRAGMENT_SHADER&&"gl_FragDepthEXT"===e.data&&(l||(l=C(i,c,"gl_FragDepth")),e.data=l);break;case"ident":if(s.includes(e.data)){if(t===n.Co.VERTEX_SHADER&&A(i,o))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");e.data in u||(u[e.data]=C(i,c,e.data)),e.data=u[e.data]}}}for(let n=i.length-1;n>=0;--n){const e=i[n];if("preprocessor"===e.type){const t=e.data.match(/#extension\s+(.*):/);if(t?.[1]&&M.has(t[1].trim())){const e=i[n+1];i.splice(n,e&&"whitespace"===e.type?2:1)}const r=e.data.match(/#ifdef\s+(.*)/);r?.[1]&&M.has(r[1].trim())&&(e.data="#if 1");const s=e.data.match(/#ifndef\s+(.*)/);s?.[1]&&M.has(s[1].trim())&&(e.data="#if 0")}}return function(e,t){return o.enableCache&&L.set(e,t),t}(e,function(e){return e.map((e=>"eof"!==e.type?e.data:"")).join("")}(i))}const L=new Map;class N{constructor(e,t,r,s){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Map,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];this._context=e,this._locations=s,this._uniformBlockBindings=o,this._transformFeedbackVaryings=a,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),0===t.length&&console.error("Shaders source should not be empty!"),t=I(t,n.Co.VERTEX_SHADER),r=I(r,n.Co.FRAGMENT_SHADER),this._vShader=D(this._context,n.Co.VERTEX_SHADER,t),this._fShader=D(this._context,n.Co.FRAGMENT_SHADER,r),k.enabled&&(this._linesOfCode=t.match(/\n/g).length+r.match(/\n/g).length+2,this._context.instanceCounter.increment(n.vt.LinesOfCode,this._vShader,this._linesOfCode)),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(n.vt.Shader,this),(0,i.Xc)()&&(this.vertexShader=t,this.fragmentShader=r),this.usedMemory=t.length+r.length;const l=this._context.gl,c=l.createProgram();l.attachShader(c,this._vShader),l.attachShader(c,this._fShader),this._locations.forEach(((e,t)=>l.bindAttribLocation(c,e,t))),this._transformFeedbackVaryings?.length&&l.transformFeedbackVaryings(c,this._transformFeedbackVaryings,l.SEPARATE_ATTRIBS),l.linkProgram(c),(0,i.Xc)()&&!l.getProgramParameter(c,l.LINK_STATUS)&&console.error(`Could not link shader\nvalidated: ${l.getProgramParameter(c,l.VALIDATE_STATUS)}, gl error ${l.getError()}, vertex: ${l.getShaderParameter(this._vShader,l.COMPILE_STATUS)}, fragment: ${l.getShaderParameter(this._fShader,l.COMPILE_STATUS)}, info log: ${l.getProgramInfoLog(c)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[i,n]of this._uniformBlockBindings){const e=l.getUniformBlockIndex(c,i);e<4294967295&&l.uniformBlockBinding(c,e,n)}this._glName=c,this._context.instanceCounter.increment(n.vt.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==e||null==this.glName?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,t=this._context.instanceCounter;this._nameToUniformLocation.forEach((e=>e&&t.decrement(n.vt.Uniform,e))),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(t.decrement(n.vt.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,t.decrement(n.vt.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,t.decrement(n.vt.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const t=this._nameToUniformLocation.get(e);if(void 0!==t)return t;if(this.glName){const t=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,t),t&&this._context.instanceCounter.increment(n.vt.Uniform,t),t}return null}hasUniform(e){return null!=this._getUniformLocation(e)}setUniform1i(e,t){const r=this._nameToUniform1.get(e);void 0!==r&&t===r||(this._context.gl.uniform1i(this._getUniformLocation(e),t),this._nameToUniform1.set(e,t))}setUniform1iv(e,t){F(this._nameToUniform1v,e,t)&&this._context.gl.uniform1iv(this._getUniformLocation(e),t)}setUniform2iv(e,t){F(this._nameToUniform2,e,t)&&this._context.gl.uniform2iv(this._getUniformLocation(e),t)}setUniform3iv(e,t){F(this._nameToUniform3,e,t)&&this._context.gl.uniform3iv(this._getUniformLocation(e),t)}setUniform4iv(e,t){F(this._nameToUniform4,e,t)&&this._context.gl.uniform4iv(this._getUniformLocation(e),t)}setUniform1f(e,t){const r=this._nameToUniform1.get(e);void 0!==r&&t===r||(this._context.gl.uniform1f(this._getUniformLocation(e),t),this._nameToUniform1.set(e,t))}setUniform1fv(e,t){F(this._nameToUniform1v,e,t)&&this._context.gl.uniform1fv(this._getUniformLocation(e),t)}setUniform2f(e,t,r){const i=this._nameToUniform2.get(e);void 0===i?(this._context.gl.uniform2f(this._getUniformLocation(e),t,r),this._nameToUniform2.set(e,[t,r])):t===i[0]&&r===i[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),t,r),i[0]=t,i[1]=r)}setUniform2fv(e,t){F(this._nameToUniform2,e,t)&&this._context.gl.uniform2fv(this._getUniformLocation(e),t)}setUniform3f(e,t,r,i){const n=this._nameToUniform3.get(e);void 0===n?(this._context.gl.uniform3f(this._getUniformLocation(e),t,r,i),this._nameToUniform3.set(e,[t,r,i])):t===n[0]&&r===n[1]&&i===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),t,r,i),n[0]=t,n[1]=r,n[2]=i)}setUniform3fv(e,t){const r=this._getUniformLocation(e);null!=r&&F(this._nameToUniform3,e,t)&&this._context.gl.uniform3fv(r,t)}setUniform4f(e,t,r,i,n){const s=this._nameToUniform4.get(e);void 0===s?(this._context.gl.uniform4f(this._getUniformLocation(e),t,r,i,n),this._nameToUniform4.set(e,[t,r,i,n])):void 0!==s&&t===s[0]&&r===s[1]&&i===s[2]&&n===s[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),t,r,i,n),s[0]=t,s[1]=r,s[2]=i,s[3]=n)}setUniform4fv(e,t){const r=this._getUniformLocation(e);null!=r&&F(this._nameToUniform4,e,t)&&this._context.gl.uniform4fv(r,t)}setUniformMatrix3fv(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this._getUniformLocation(e);null!=i&&F(this._nameToUniformMatrix3,e,t)&&this._context.gl.uniformMatrix3fv(i,r,t)}setUniformMatrix4fv(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this._getUniformLocation(e);null!=i&&F(this._nameToUniformMatrix4,e,t)&&this._context.gl.uniformMatrix4fv(i,r,t)}stop(){}}function D(e,t,r){const s=e.gl,o=s.createShader(t);return s.shaderSource(o,r),s.compileShader(o),(0,i.Xc)()&&!s.getShaderParameter(o,s.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===n.Co.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(s.getShaderInfoLog(o)),console.error(function(e){let t=2;return e.replaceAll("\n",(()=>"\n"+function(e){return e>=1e3?e.toString():("  "+e).slice(-3)}(t++)+":"))}(r))),o}function F(e,t,r){const i=e.get(t);if(!i)return e.set(t,Array.from(r)),!0;const n=r.length;if(i.length!==n)return e.set(t,Array.from(r)),!0;for(let s=0;s<n;++s){const e=r[s];if(i[s]!==e){for(i[s]=e;s<n;++s)i[s]=r[s];return!0}}return!1}const k={enabled:!1}},62881:(e,t,r)=>{"use strict";r.d(t,{l:()=>o});var i=r(93345),n=r(89179),s=r(88800);class o{constructor(e,t){this._context=e,this._descriptor=t,this.type=n.p.RenderBuffer,this._context.instanceCounter.increment(i.vt.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:o,internalFormat:a,multisampled:l}=t;l?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,a,s,o):r.renderbufferStorage(r.RENDERBUFFER,a,s,o),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,t=this._context.parameters.maxSamples;return e?Math.min(e,t):t}get usedMemory(){return(0,s.e)(this._descriptor)}resize(e,t){const r=this._descriptor;if(r.width===e&&r.height===t)return;r.width=e,r.height=t;const i=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):i.renderbufferStorage(i.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(i.vt.Renderbuffer,this),this._context=null)}}},88800:(e,t,r)=>{"use strict";r.d(t,{e:()=>s,q:()=>n});var i=r(27207);class n{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;this.internalFormat=e,this.width=t,this.height=r,this.multisampled=!1,this.samples=1}}function s(e){return e.width<=0||e.height<=0||null==e.internalFormat?0:e.width*e.height*(0,i.IB)(e.internalFormat)}},98433:(e,t,r)=>{"use strict";r.d(t,{g:()=>c});var i=r(50076),n=(r(81806),r(61678)),s=r(93345),o=r(89179),a=r(96673);class l extends a.R{constructor(e,t){switch(super(),this.context=e,Object.assign(this,t),this.internalFormat){case s.H0.R16F:case s.H0.R16I:case s.H0.R16UI:case s.H0.R32F:case s.H0.R32I:case s.H0.R32UI:case s.H0.R8_SNORM:case s.H0.R8:case s.H0.R8I:case s.H0.R8UI:this.pixelFormat=s.Ab.RED}}static validate(e,t){return new l(e,t)}}let c=class e{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.type=o.p.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=t;else{const r=l.validate(e,t);if(!r)throw new i.A("Texture descriptor invalid");this._descriptor=r}this._descriptor.target===s.Ap.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return(0,a.e)(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(s.vt.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,t){const r=this._descriptor;if(r.width!==e||r.height!==t){if(this._wasImmutablyAllocated)throw new i.A("Immutable textures can't be resized!");r.width=e,r.height=t,this._descriptor.target===s.Ap.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(let t=s.Ap.TEXTURE_CUBE_MAP_POSITIVE_X;t<=s.Ap.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(e,t)}setData(e){this._setData(e)}_setData(t,r){if(!this._descriptor.context?.gl)return;const o=this._descriptor.context.gl;(0,n.Y2)(o),this._glName||(this._glName=o.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(s.vt.Texture,this)),void 0===t&&(t=null);const a=this._descriptor,l=r??a.target,c=m(l);null===t&&(a.width=a.width||4,a.height=a.height||4,c&&(a.depth=a.depth??1));const y=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),u(a),this._configurePixelStorage(),(0,n.Y2)(o);const _=this._deriveInternalFormat();if(f(t)){let e="width"in t?t.width:t.codedWidth,r="height"in t?t.height:t.codedHeight;const i=1;t instanceof HTMLVideoElement&&(e=t.videoWidth,r=t.videoHeight),a.width&&a.height,c&&a.depth,a.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,_,a.hasMipmap,e,r,i),this._texImage(l,0,_,e,r,i,t),(0,n.Y2)(o),a.hasMipmap&&this.generateMipmap(),a.width||(a.width=e),a.height||(a.height=r),c&&!a.depth&&(a.depth=i)}else{const{width:e,height:r,depth:u}=a;if(null==e||null==r)throw new i.A("Width and height must be specified!");if(c&&null==u)throw new i.A("Depth must be specified!");if(a.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,_,a.hasMipmap,e,r,u),p(t)){const n=t.levels,c=g(l,e,r,u),h=Math.min(c-1,n.length-1);o.texParameteri(a.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,h);const d=_;if(!function(e){return e in s.CQ}(d))throw new i.A("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel(((e,t,r,i)=>{const s=n[Math.min(e,n.length-1)];this._compressedTexImage(l,e,d,t,r,i,s)}),h)}else this._texImage(l,0,_,e,r,u,t),(0,n.Y2)(o),a.hasMipmap&&this.generateMipmap()}h(o,this._descriptor),d(o,this._descriptor),function(e,t){const r=e.capabilities.textureFilterAnisotropic;if(!r)return;e.gl.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy??1)}(this._descriptor.context,this._descriptor),(0,n.Y2)(o),this._descriptor.context.bindTexture(y,e.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,r,n,s,o,a){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,u=this._deriveInternalFormat(),{context:h,pixelFormat:d,dataType:m,target:g,isImmutable:y}=c;if(y&&!this._wasImmutablyAllocated)throw new i.A("Cannot update immutable texture before allocation!");const _=h.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES,!0);(r<0||n<0||r+s>c.width||n+o>c.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=h;l&&v.pixelStorei(v.UNPACK_SKIP_ROWS,l),f(a)?v.texSubImage2D(g,t,r,n,s,o,d,m,a):p(a)?v.compressedTexSubImage2D(g,t,r,n,s,o,u,a.levels[t]):v.texSubImage2D(g,t,r,n,s,o,d,m,a),l&&v.pixelStorei(v.UNPACK_SKIP_ROWS,0),h.bindTexture(_,e.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,r,n,s,o,a,l,c){c||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const u=this._descriptor,h=this._deriveInternalFormat(),{context:d,pixelFormat:f,dataType:g,isImmutable:y,target:_}=u;if(y&&!this._wasImmutablyAllocated)throw new i.A("Cannot update immutable texture before allocation!");m(_)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=d.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);d.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),(r<0||n<0||s<0||r+o>u.width||n+a>u.height||s+l>u.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:b}=d;if(p(c))c=c.levels[t],b.compressedTexSubImage3D(_,t,r,n,s,o,a,l,h,c);else{const e=c;b.texSubImage3D(_,t,r,n,s,o,a,l,f,g,e)}d.bindTexture(v,e.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new i.A("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,u(t)}t.samplingMode===s.Cj.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=s.Cj.LINEAR_MIPMAP_NEAREST):t.samplingMode===s.Cj.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=s.Cj.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(t.target),this._descriptor.context.bindTexture(r,e.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new i.A("Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,u(e)}e.samplingMode===s.Cj.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=s.Cj.LINEAR):e.samplingMode===s.Cj.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=s.Cj.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,u(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor,t=e.context.gl;this._samplingModeDirty&&(h(t,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(d(t,e),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===s.Ab.DEPTH_STENCIL&&(this._descriptor.internalFormat=s.Ab.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case s.ld.FLOAT:switch(this._descriptor.pixelFormat){case s.Ab.RGBA:return this._descriptor.internalFormat=s.H0.RGBA32F;case s.Ab.RGB:return this._descriptor.internalFormat=s.H0.RGB32F;default:throw new i.A("Unable to derive format")}case s.ld.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case s.Ab.RGBA:return this._descriptor.internalFormat=s.H0.RGBA8;case s.Ab.RGB:return this._descriptor.internalFormat=s.H0.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===s.Ab.DEPTH_STENCIL?s.Ab.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:t,flipped:r,preMultiplyAlpha:i}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i?1:0)}_texStorage(e,t,r,n,o,a){const{gl:l}=this._descriptor.context;if(!function(e){return e in s.H0}(t))throw new i.A("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const c=r?g(e,n,o,a):1;if(m(e)){if(null==a)throw new i.A("Missing depth dimension for 3D texture upload");l.texStorage3D(e,c,t,n,o,a)}else l.texStorage2D(e,c,t,n,o);this._wasImmutablyAllocated=!0}_texImage(e,t,r,n,s,o,a){const l=this._descriptor.context.gl,c=m(e),{isImmutable:u,pixelFormat:h,dataType:d}=this._descriptor;if(u){if(null!=a){const r=a;if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,t,0,0,0,n,s,o,h,d,r)}else l.texSubImage2D(e,t,0,0,n,s,h,d,r)}}else{const u=a;if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.texImage3D(e,t,r,n,s,o,0,h,d,u)}else l.texImage2D(e,t,r,n,s,0,h,d,u)}}_compressedTexImage(e,t,r,n,s,o,a){const l=this._descriptor.context.gl,c=m(e);if(this._descriptor.isImmutable){if(null!=a)if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,t,0,0,0,n,s,o,r,a)}else l.compressedTexSubImage2D(e,t,0,0,n,s,r,a)}else if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,t,r,n,s,o,0,a)}else l.compressedTexImage2D(e,t,r,n,s,0,a)}_forEachMipmapLevel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,{width:r,height:n,depth:o,hasMipmap:a,target:l}=this._descriptor;const c=l===s.Ap.TEXTURE_3D;if(null==r||null==n||c&&null==o)throw new i.A("Missing texture dimensions for mipmap calculation");for(let i=0;e(i,r,n,o),a&&(1!==r||1!==n||c&&1!==o)&&!(i>=t);++i)r=Math.max(1,r>>1),n=Math.max(1,n>>1),c&&(o=Math.max(1,o>>1))}};function u(e){(null!=e.width&&e.width<0||null!=e.height&&e.height<0||null!=e.depth&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function h(e,t){let r=t.samplingMode,i=t.samplingMode;r===s.Cj.LINEAR_MIPMAP_NEAREST||r===s.Cj.LINEAR_MIPMAP_LINEAR?(r=s.Cj.LINEAR,t.hasMipmap||(i=s.Cj.LINEAR)):r!==s.Cj.NEAREST_MIPMAP_NEAREST&&r!==s.Cj.NEAREST_MIPMAP_LINEAR||(r=s.Cj.NEAREST,t.hasMipmap||(i=s.Cj.NEAREST)),e.texParameteri(t.target,e.TEXTURE_MAG_FILTER,r),e.texParameteri(t.target,e.TEXTURE_MIN_FILTER,i)}function d(e,t){"number"==typeof t.wrapMode?(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode.t))}function p(e){return null!=e&&"type"in e&&"compressed"===e.type}function f(e){return null!=e&&!p(e)&&!function(e){return null!=e&&"byteLength"in e}(e)}function m(e){return e===s.Ap.TEXTURE_3D||e===s.Ap.TEXTURE_2D_ARRAY}function g(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=Math.max(t,r);return e===s.Ap.TEXTURE_3D&&(n=Math.max(n,i)),Math.round(Math.log(n)/Math.LN2)+1}c.TEXTURE_UNIT_FOR_UPDATES=0},96673:(e,t,r)=>{"use strict";r.d(t,{R:()=>s,e:()=>o});var i=r(93345),n=r(27207);class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;this.width=e,this.height=t,this.target=i.Ap.TEXTURE_2D,this.pixelFormat=i.Ab.RGBA,this.dataType=i.ld.UNSIGNED_BYTE,this.samplingMode=i.Cj.LINEAR,this.wrapMode=i.pF.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}}function o(e){return e.width<=0||e.height<=0?0:Math.round(e.width*e.height*(e.hasMipmap?4/3:1)*(null==e.internalFormat?4:(0,n.IB)(e.internalFormat)))}},27207:(e,t,r)=>{"use strict";r.d(t,{Hi:()=>c,IB:()=>u,WH:()=>o,mT:()=>a,yu:()=>l});r(81806);var i=r(61678),n=r(93345),s=r(32880);function o(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function a(e,t){return e.vertexBuffers[t].usedMemory/function(e){return e[0].stride}(e.layout[t])}function l(e,t,r,n){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const l=e.gl;e.bindBuffer(r);for(const c of n){const r=t.get(c.name);if(void 0===r){console.warn(`There is no location for vertex attribute '${c.name}' defined.`);continue}const n=a*c.stride;if(c.count<=4)l.vertexAttribPointer(r,c.count,c.type,c.normalized,c.stride,c.offset+n),l.enableVertexAttribArray(r),c.divisor>0&&e.gl.vertexAttribDivisor(r,c.divisor);else if(9===c.count)for(let t=0;t<3;t++)l.vertexAttribPointer(r+t,3,c.type,c.normalized,c.stride,c.offset+12*t+n),l.enableVertexAttribArray(r+t),c.divisor>0&&e.gl.vertexAttribDivisor(r+t,c.divisor);else if(16===c.count)for(let t=0;t<4;t++)l.vertexAttribPointer(r+t,4,c.type,c.normalized,c.stride,c.offset+16*t+n),l.enableVertexAttribArray(r+t),c.divisor>0&&e.gl?.vertexAttribDivisor(r+t,c.divisor);else console.error("Unsupported vertex attribute element count: "+c.count);if((0,i.en)()){const t=o(e),r=(0,s._)(c.type),i=c.offset,a=Math.round(r/i)!==r/i?`. Offset not a multiple of stride. DataType requires ${r} bytes, but descriptor has an offset of ${i}`:"";t&&console.error(`Unable to bind vertex attribute "${c.name}" with baseInstanceOffset ${n}${a}:`,t,c)}}}function c(e,t,r,i){const s=e.gl;e.bindBuffer(r);for(const n of i){const r=t.get(n.name);if(n.count<=4)s.disableVertexAttribArray(r),n.divisor&&n.divisor>0&&e.gl?.vertexAttribDivisor(r,0);else if(9===n.count)for(let t=0;t<3;t++)s.disableVertexAttribArray(r+t),n.divisor&&n.divisor>0&&e.gl?.vertexAttribDivisor(r+t,0);else if(16===n.count)for(let t=0;t<4;t++)s.disableVertexAttribArray(r+t),n.divisor&&n.divisor>0&&e.gl?.vertexAttribDivisor(r+t,0);else console.error("Unsupported vertex attribute element count: "+n.count)}e.unbindBuffer(n.NZ.ARRAY_BUFFER)}function u(e){switch(e){case n.Ab.ALPHA:case n.Ab.LUMINANCE:case n.Ab.RED:case n.Ab.RED_INTEGER:case n.H0.R8:case n.H0.R8I:case n.H0.R8UI:case n.H0.R8_SNORM:case n.yQ.STENCIL_INDEX8:return 1;case n.Ab.LUMINANCE_ALPHA:case n.Ab.RG:case n.Ab.RG_INTEGER:case n.H0.RGBA4:case n.H0.R16F:case n.H0.R16I:case n.H0.R16UI:case n.H0.RG8:case n.H0.RG8I:case n.H0.RG8UI:case n.H0.RG8_SNORM:case n.H0.RGB565:case n.H0.RGB5_A1:case n.yQ.DEPTH_COMPONENT16:return 2;case n.Ab.DEPTH_COMPONENT:case n.Ab.RGB:case n.Ab.RGB_INTEGER:case n.H0.RGB8:case n.H0.RGB8I:case n.H0.RGB8UI:case n.H0.RGB8_SNORM:case n.H0.SRGB8:case n.yQ.DEPTH_COMPONENT24:return 3;case n.Ab.DEPTH_STENCIL:case n.Ab.DEPTH24_STENCIL8:case n.Ab.RGBA:case n.Ab.RGBA_INTEGER:case n.H0.RGBA8:case n.H0.R32F:case n.H0.R11F_G11F_B10F:case n.H0.RG16F:case n.H0.R32I:case n.H0.R32UI:case n.H0.RG16I:case n.H0.RG16UI:case n.H0.RGBA8I:case n.H0.RGBA8UI:case n.H0.RGBA8_SNORM:case n.H0.SRGB8_ALPHA8:case n.H0.RGB9_E5:case n.H0.RGB10_A2UI:case n.H0.RGB10_A2:case n.yQ.DEPTH_STENCIL:case n.yQ.DEPTH_COMPONENT32F:case n.yQ.DEPTH24_STENCIL8:return 4;case n.yQ.DEPTH32F_STENCIL8:return 5;case n.H0.RGB16F:case n.H0.RGB16I:case n.H0.RGB16UI:return 6;case n.H0.RG32F:case n.H0.RG32I:case n.H0.RG32UI:case n.H0.RGBA16F:case n.H0.RGBA16I:case n.H0.RGBA16UI:return 8;case n.H0.RGB32F:case n.H0.RGB32I:case n.H0.RGB32UI:return 12;case n.H0.RGBA32F:case n.H0.RGBA32I:case n.H0.RGBA32UI:return 16;case n.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT:case n.CQ.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case n.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT:case n.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case n.CQ.COMPRESSED_R11_EAC:case n.CQ.COMPRESSED_SIGNED_R11_EAC:case n.CQ.COMPRESSED_RGB8_ETC2:case n.CQ.COMPRESSED_SRGB8_ETC2:case n.CQ.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case n.CQ.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case n.CQ.COMPRESSED_RG11_EAC:case n.CQ.COMPRESSED_SIGNED_RG11_EAC:case n.CQ.COMPRESSED_RGBA8_ETC2_EAC:case n.CQ.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}},36911:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var i=r(76460),n=r(30726),s=r(78393),o=r(93345),a=r(27207);const l=()=>i.A.getLogger("esri.views.webgl.VertexArrayObject");let c=class{constructor(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._context=e,this._locations=t,this._layout=r,this._buffers=i,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce(((e,t)=>e+this._buffers[t].usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*s.zQ}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const e in this._buffers)this._buffers[e]?.dispose(),delete this._buffers[e];this._indexBuffer=(0,n.WD)(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(o.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(o.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:r}=this;e||l().error("Vertex buffer dictionary is empty!");const i=this._context.gl;for(const n in e){const r=e[n];r||l().error("Vertex buffer is uninitialized!");const i=t[n];i||l().error("Vertex element descriptor is empty!"),(0,a.yu)(this._context,this._locations,r,i)}null!=r&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},21812:(e,t,r)=>{"use strict";r.d(t,{_:()=>i});class i{constructor(e,t,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;this.name=e,this.count=t,this.type=r,this.offset=i,this.stride=n,this.normalized=s,this.divisor=o}}},9685:(e,t,r)=>{"use strict";r.d(t,{C:()=>s});var i=r(28007);let n;function s(){return n||(n=function(){const e=new o,t=function(e){if("undefined"==typeof WebGL2RenderingContext)return null;const t=document.createElement("canvas");if(!t)return null;let r=(0,i.q)(t,{failIfMajorPerformanceCaveat:!0});if(null==r&&(r=(0,i.q)(t),null!=r&&(e.majorPerformanceCaveat=!0)),null==r)return r;e.available=!0,e.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const n=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return n&&(e.supportsHighPrecisionFragment=n.precision>0),r}(e);return null==t||(e.supportsColorBufferFloat=null!==t.getExtension("EXT_color_buffer_float"),e.supportsColorBufferFloatBlend=null!==t.getExtension("EXT_float_blend"),e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||null!==t.getExtension("EXT_color_buffer_half_float")),e}()),n}class o{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}},61678:(e,t,r)=>{"use strict";r.d(t,{Ns:()=>a,Xc:()=>c,Y2:()=>u,en:()=>l});var i=r(50076),n=r(81806),s=r(76460);const o=()=>s.A.getLogger("esri.views.webgl.checkWebGLError");const a=!!(0,n.A)("enable-feature:webgl-debug");function l(){return a}function c(){return a}function u(e){if(l()){const t=e.getError();if(t){const r=function(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(e,t),n=(new Error).stack;o().error(new i.A("webgl-error","WebGL error occurred",{message:r,stack:n}))}}}},28007:(e,t,r)=>{"use strict";function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.getContext("webgl2",t)||null}r.d(t,{q:()=>i})},99643:(e,t,r)=>{"use strict";function i(e,t,r){for(let i=0;i<r;++i)t[2*i]=e[i],t[2*i+1]=e[i]-t[2*i]}function n(e,t){const r=e.length;for(let i=0;i<r;++i)o[0]=e[i],t[i]=o[0];return t}function s(e,t){const r=e.length;for(let i=0;i<r;++i)o[0]=e[i],o[1]=e[i]-o[0],t[i]=o[1];return t}r.d(t,{Zo:()=>n,jA:()=>s,jS:()=>i});const o=new Float32Array(2)},93345:(e,t,r)=>{"use strict";var i,n,s,o,a,l,c,u,h,d,p,f,m,g,y,_,v,b,w,x;r.d(t,{Ab:()=>g,Ac:()=>c,Ap:()=>m,CQ:()=>E,Cj:()=>p,Co:()=>w,H0:()=>y,Hr:()=>A,MT:()=>h,NZ:()=>a,Nm:()=>M,R:()=>x,Tb:()=>o,WR:()=>n,Y7:()=>l,_U:()=>b,dn:()=>s,eA:()=>d,hn:()=>i,ld:()=>_,nI:()=>C,pF:()=>f,pe:()=>u,sS:()=>I,tx:()=>L,vt:()=>T,xM:()=>S,yQ:()=>v}),function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"}(i||(i={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(n||(n={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(s||(s={})),function(e){e[e.ADD=32774]="ADD",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(o||(o={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(a||(a={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(l||(l={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(c||(c={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.HALF_FLOAT=5131]="HALF_FLOAT"}(u||(u={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(h||(h={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(d||(d={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(p||(p={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(f||(f={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(m||(m={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(g||(g={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(y||(y={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(_||(_={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(v||(v={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(b||(b={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(w||(w={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(x||(x={}));const S=33984;var T,M,A;!function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.TransformFeedback=7]="TransformFeedback",e[e.Sync=8]="Sync",e[e.UNCOUNTED=9]="UNCOUNTED",e[e.LinesOfCode=9]="LinesOfCode",e[e.Uniform=10]="Uniform",e[e.COUNT=11]="COUNT"}(T||(T={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(M||(M={})),function(e){e[e.NONE=0]="NONE",e[e.BACK=1029]="BACK"}(A||(A={}));const C=33306;var E,R,P,O,I,L,N;!function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"}(E||(E={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(R||(R={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(P||(P={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(O||(O={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(I||(I={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(L||(L={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(N||(N={}))},32880:(e,t,r)=>{"use strict";r.d(t,{_:()=>n});var i=r(93345);function n(e){switch(e){case i.pe.BYTE:case i.pe.UNSIGNED_BYTE:return 1;case i.pe.SHORT:case i.pe.UNSIGNED_SHORT:case i.pe.HALF_FLOAT:return 2;case i.pe.FLOAT:case i.pe.INT:case i.pe.UNSIGNED_INT:return 4}}},57162:(e,t,r)=>{"use strict";r.d(t,{Ey:()=>w,Ms:()=>H,PI:()=>a,Xt:()=>c,hG:()=>l,kn:()=>u,ox:()=>s,p3:()=>o,wE:()=>h});var i=r(83490),n=r(93345);function s(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.Tb.ADD,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0,0];return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function o(e,t,r,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n.Tb.ADD,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n.Tb.ADD,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0,0,0];return{srcRgb:e,srcAlpha:t,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:o,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const a={face:n.Y7.BACK,mode:n.Ac.CCW},l={face:n.Y7.FRONT,mode:n.Ac.CCW},c=e=>e===i.s2.Back?a:e===i.s2.Front?l:null,u={zNear:0,zFar:1},h={r:!0,g:!0,b:!0,a:!0};function d(e){return T.intern(e)}function p(e){return A.intern(e)}function f(e){return E.intern(e)}function m(e){return P.intern(e)}function g(e){return I.intern(e)}function y(e){return N.intern(e)}function _(e){return F.intern(e)}function v(e){return z.intern(e)}function b(e){return V.intern(e)}function w(e){return j.intern(e)}class x{constructor(e,t){this._makeKey=e,this._makeRef=t,this._interns=new Map}intern(e){if(!e)return null;const t=this._makeKey(e),r=this._interns;return r.has(t)||r.set(t,this._makeRef(e)),r.get(t)??null}}function S(e){return"["+e.join(",")+"]"}const T=new x(M,(e=>({__tag:"Blending",...e})));function M(e){return e?S([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const A=new x(C,(e=>({__tag:"Culling",...e})));function C(e){return e?S([e.face,e.mode]):null}const E=new x(R,(e=>({__tag:"PolygonOffset",...e})));function R(e){return e?S([e.factor,e.units]):null}const P=new x(O,(e=>({__tag:"DepthTest",...e})));function O(e){return e?S([e.func]):null}const I=new x(L,(e=>({__tag:"StencilTest",...e})));function L(e){return e?S([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const N=new x(D,(e=>({__tag:"DepthWrite",...e})));function D(e){return e?S([e.zNear,e.zFar]):null}const F=new x(k,(e=>({__tag:"ColorWrite",...e})));function k(e){return e?S([e.r,e.g,e.b,e.a]):null}const z=new x(U,(e=>({__tag:"StencilWrite",...e})));function U(e){return e?S([e.mask]):null}const V=new x(B,(e=>({__tag:"DrawBuffers",...e})));function B(e){return e?S(e.buffers):null}const j=new x((function(e){return e?S([M(e.blending),C(e.culling),R(e.polygonOffset),O(e.depthTest),L(e.stencilTest),D(e.depthWrite),k(e.colorWrite),U(e.stencilWrite),B(e.drawBuffers)]):null}),(e=>({blending:d(e.blending),culling:p(e.culling),polygonOffset:f(e.polygonOffset),depthTest:m(e.depthTest),stencilTest:g(e.stencilTest),depthWrite:y(e.depthWrite),colorWrite:_(e.colorWrite),stencilWrite:v(e.stencilWrite),drawBuffers:b(e.drawBuffers)})));class H{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,t,r,i){return(r||e!==t)&&(i(e),this._pipelineInvalid=!0),e}}},61701:(e,t,r)=>{"use strict";var i;r.d(t,{X:()=>i}),function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"}(i||(i={}))},2183:(e,t,r)=>{"use strict";r.d(t,{D:()=>s,p:()=>n});var i=r(40565);function n(e){const t=(0,i.Vr)(100*(1-e));return Math.max(0,Math.min(t,100))}function s(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}},8837:(e,t,r)=>{"use strict";r.d(t,{CJ:()=>p});var i=r(50076),n=r(53084),s=r(48611),o=r(22382),a=r(31933);const l=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),c=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function u(e,t){if(t.restrictedWebMapWriting){const r=function(e){return"basemap"===e.layerContainerType?l:"operational-layers"===e.layerContainerType?c:null}(t);return null==r||r.has(e.type)&&!(0,a.Ov)(e)}return!0}function h(e,t){"maxScale"in e&&(t.maxScale=(0,o.B)(e.maxScale)??void 0),"minScale"in e&&(t.minScale=(0,o.B)(e.minScale)??void 0)}function d(e,t){if(function(e,t){if(t)if((0,a.Ov)(e)){const r=(0,s.wc)("featureCollection.layers",t),i=r?.[0]?.layerDefinition;i&&h(e,i)}else"group"!==e.type&&h(e,t)}(e,t),t&&(t.id=e.id,"blendMode"in e&&(t.blendMode=e.blendMode,"normal"===t.blendMode&&delete t.blendMode),t.opacity=(0,o.B)(e.opacity)??void 0,t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&"wmts"!==e.type))if((0,a.Ov)(e)){const r=t.featureCollection;r&&(r.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function p(e,t,r){if(!e.persistenceEnabled)return null;if(!("write"in e)||!e.write)return r?.messages&&r.messages.push(new i.A("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if((0,a.Ov)(e)&&!e.isTable)t=e.resourceInfo;else if(u(e,r)){const t={};return e.write(t,r)?t:null}return null!=t&&d(e,t=(0,n.o8)(t)),t}},25329:(e,t,r)=>{"use strict";r.d(t,{A:()=>z});var i=r(35143),n=(r(11265),r(63241)),s=r(30113),o=r(54099),a=r(79053),l=(r(81806),r(53084)),c=r(76460),u=r(30726),h=r(91291),d=r(50346),p=r(68134),f=r(49723),m=r(46053),g=r(21403),y=r(85842),_=r(99486),v=r(94151),b=r(26452);r(48396);const w={handleInterceptedEvent:(e,t,r,i)=>(e.scheduleRender(),t.properties[`on${i.type}`].apply(t.properties.bind||r,[i]))},x={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{"-"===t.charAt(0)?e.style.setProperty(t,r):e.style[t]=r}},S=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e;return t.forEach(((e,n)=>{const s=i?.children?((e,t)=>e.find(t))(i.children,(t=>t.domNode===e)):void 0;r&&!s&&n!==t.length-1||(i=s)})),i};var T=r(77666),M=r(83008),A=r(73319);const C=new Set;var E,R=r(14656),P=r(76099),O=r(38042),I=r(63860);let L=0;function N(e,t){const r=Object.prototype.hasOwnProperty;for(const i in t)r.call(t,i)&&r.call(e,i)&&(null!=e[i]&&null!=t[i]&&"object"==typeof e[i]&&"object"==typeof t[i]?N(e[i],t[i]):e[i]=t[i]);return e}const D=(e=>{let t;const r={...w,...e},i=(e=>({...x,...e}))(r),n=i.performanceLogger;let s,o=!0,a=!1;const l=[],c=[],u=(e,s,o)=>{let a;i.eventHandlerInterceptor=(e,i,s,o)=>function(e){let i;n("domEvent",e);const s=((e,t)=>{const r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r})(e.currentTarget,a.domNode),o=s.some((e=>customElements.get(e?.tagName?.toLowerCase())));if(e.eventPhase!==Event.CAPTURING_PHASE&&o){const t=e.composedPath(),r=t.slice(t.indexOf(e.currentTarget),t.indexOf(a.domNode)).reverse();i=S(a.getLastRender(),r,!0)}else s.reverse(),i=S(a.getLastRender(),s);let l;return i&&(l=r.handleInterceptedEvent(t,i,this,e)),n("domEventProcessed",e),l},r.postProcessProjectionOptions?.(i);const u=o();a=e(s,u,i),i.eventHandlerInterceptor=void 0,l.push(a),c.push(o),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(a,u)};let h=()=>{if(s=void 0,o){o=!1,n("renderStart",void 0);for(let e=0;e<l.length;e++){const t=c[e]();n("rendered",void 0),l[e].update(t),n("patched",void 0)}n("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(h=r.modifyDoRenderImplementation(h,l,c)),t={renderNow:h,scheduleRender:()=>{s||a||(s=requestAnimationFrame(h))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),a=!0},resume:()=>{a=!1,o=!0,t.scheduleRender()},append:(e,t)=>{u(b.t.append,e,t)},insertBefore:(e,t)=>{u(b.t.insertBefore,e,t)},merge:(e,t)=>{u(b.t.merge,e,t)},replace:(e,t)=>{u(b.t.replace,e,t)},detach:e=>{for(let t=0;t<c.length;t++)if(c[t]===e)return c.splice(t,1),l.splice(t,1)[0];throw new Error("renderFunction was not found")}},t})({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,r=/capture$/i;e.eventHandlerInterceptor=(e,i,n,s)=>{const o=t?.(e,i,n,s),a=r.test(e);if(!((e=e.replace(r,"")).toLowerCase()in n)||a){const t=e[2].toLowerCase()+e.slice(3),r=e=>o?.call(n,e);n.addEventListener(t,r,a);const i=()=>n.removeEventListener(t,r,a),l=s.afterRemoved;s.afterRemoved=e=>{l?.(e),i()}}return o}},handleInterceptedEvent(e,t,r,i){const{eventPhase:n,type:s}=i,o=n===Event.CAPTURING_PHASE;let a=`on${s}${o?"capture":""}`;const l=t.properties;(l&&a in l||(a=`on${s[0].toUpperCase()}${s.slice(1)}${o?"Capture":""}`,l&&a in l))&&((0,R.Sh)(),e.scheduleRender(),l[a].call(l.bind||r,i))}});let F=!1,k=class extends((0,h.g)(o.A.EventedAccessor)){constructor(e,t){super(e,t),this._attached=!1,this._projector=D,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=(0,d.sg)((async()=>{if(this._messageBundleProps?.length){const e=await Promise.allSettled(this._messageBundleProps.map((async e=>{let{bundlePath:t,propertyName:r}=e;if(this.destroyed)return;let i=await(0,I.ud)(t);this.uiStrings&&Object.keys(this.uiStrings)&&(i=N((0,l.o8)(i),this.uiStrings)),this[r]=i})));if(this.destroyed)return;for(const t of e)"rejected"===t.status&&c.A.getLogger(this).error("widget-intl:locale-error",this.declaredClass,t.reason)}await this.loadLocale()})),(0,T.V)();const r="esri-widget-uid-"+(0,f.lk)(),i=this.render.bind(this);this._trackingTarget=new v.r((()=>{this.autoRenderingEnabled&&this.scheduleRender()}));const n=()=>({vnodeSelector:"div",properties:{key:`${r}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),s=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const e=i()??n(),t=e.properties??={};if(t.key??=r,(0,M.b)(e.vnodeSelector)){if(!this.visible)return n()}else this.visible?t.styles||(t.styles={}):(t.class="",t.styles={display:"none"}),t.styles.display??="";let s=0;return e.children?.forEach((e=>{(0,M.b)(e.vnodeSelector)||(e.properties??={},e.properties.key??=`${this.id}--${s++}`)})),(0,M.d)(this,e)};this.render=()=>{if(F)return s();let e=(0,R.rE)(this)??null;if(e)return e;this._trackingTarget.clear(),F=!0;try{e=(0,_.a)(this._trackingTarget,s)}catch(t){throw c.A.getLogger(this).error(t),t}finally{F=!1}return e&&(0,R.$U)(this,e),e};const o=this.beforeFirstRender();o?this._resourcesFetch=o.then((()=>{this._readyForTrueRender=!0,this._postInitialize()})):(this._resourcesFetch=Promise.resolve().then((()=>{this._postInitialize()})),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),function(e){C.add(e),e.finally((()=>C.delete(e)))}(this._resourcesFetch)}normalizeCtorArgs(e,t){const r={...e};return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){const e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then((()=>{})).catch(d.jH):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||((0,u.pR)(this._trackingTarget),(0,u.pR)(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,(0,R.Qw)(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return(0,s.$H)(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+L++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(E=A.x,A.D)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||((0,R.Qw)(this),this._projector.scheduleRender())}own(e){(0,n.eO)(c.A.getLogger(this),"`Widget.own()` is deprecated in favor of 'Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(e)}classes(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return P.Ly.apply(this,t)}renderNow(){(0,R.Qw)(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles((0,p.wB)((()=>this.viewModel),((e,t)=>{t&&this.removeHandles("delegated-events"),e&&(0,a.wb)(e)&&this.addHandles(this._delegatedEventNames.map((t=>(0,a.on)(e,t,(e=>{this.emit(t,e)})))),"delegated-events")}),p.pc)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(d.jH),this.scheduleRender()};this.addHandles([(0,O.oQ)(e),(0,p.wB)((()=>this.uiStrings),e),(0,p.z7)((()=>this.container),(e=>{this.destroyed||this._attach(e)}),{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};k[E]=!0,(0,i._)([(0,m.MZ)()],k.prototype,"_readyForTrueRender",void 0),(0,i._)([(0,m.MZ)({value:null})],k.prototype,"container",null),(0,i._)([(0,g.w)("container")],k.prototype,"castContainer",null),(0,i._)([(0,m.MZ)()],k.prototype,"icon",null),(0,i._)([(0,m.MZ)()],k.prototype,"id",null),(0,i._)([(0,m.MZ)()],k.prototype,"label",null),(0,i._)([(0,m.MZ)()],k.prototype,"renderable",null),(0,i._)([(0,m.MZ)()],k.prototype,"uiStrings",void 0),(0,i._)([(0,m.MZ)()],k.prototype,"viewModel",void 0),(0,i._)([(0,m.MZ)({value:!0})],k.prototype,"visible",null),(0,i._)([(0,m.MZ)()],k.prototype,"key",void 0),(0,i._)([(0,m.MZ)()],k.prototype,"children",void 0),(0,i._)([(0,m.MZ)()],k.prototype,"afterCreate",void 0),(0,i._)([(0,m.MZ)()],k.prototype,"afterUpdate",void 0),(0,i._)([(0,m.MZ)()],k.prototype,"afterRemoved",void 0),k=(0,i._)([(0,y.$)("esri.widgets.Widget")],k);const z=k},79535:(e,t,r)=>{"use strict";r.d(t,{R:()=>a});var i=r(35143),n=r(30726),s=r(46053),o=(r(81806),r(76460),r(47249),r(85842));const a=e=>{let t=class extends e{constructor(){super(...arguments),this.goToOverride=null,this.view=null}callGoTo(e){const{view:t}=this;return(0,n.Lw)(t),this.goToOverride?this.goToOverride(t,e):t.goTo(e.target,e.options)}};return(0,i._)([(0,s.MZ)()],t.prototype,"goToOverride",void 0),(0,i._)([(0,s.MZ)()],t.prototype,"view",void 0),t=(0,i._)([(0,o.$)("esri.widgets.support.GoTo")],t),t}},77666:(e,t,r)=>{"use strict";r.d(t,{V:()=>h,W:()=>d});var i=r(24282),n=r(72669),s=r(32811),o=r(77816);function a(){const{classList:e}=document.body,t=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>e.contains(i.d)||e.contains(i.a)&&t?"dark":"light",n=e=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:e}})),s=e=>{o!==e&&n(e),o=e};let o=r();n(o),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>s(e.matches?"dark":"light"))),new MutationObserver((()=>s(r()))).observe(document.body,{attributes:!0,attributeFilter:["class"]})}(function(){(0,s.i)()&&("interactive"===document.readyState?a():document.addEventListener("DOMContentLoaded",(()=>a()),{once:!0})),(0,n.s)()})();var l=r(28899),c=(r(81806),r(90534));let u;function h(){try{(0,o.OX)(".")}catch{(0,o.Qu)((0,c.s2)((0,l.s)(u)))}}function d(e){const t=[];for(const r of Object.keys(e))customElements.get(`calcite-${r}`)||t.push(e[r]?.());return t.length>0?Promise.all(t):null}u="components/assets"},11571:(e,t,r)=>{"use strict";function i(e){return"number"==typeof e}function n(e){return"string"==typeof e||e instanceof String}r.d(t,{E:()=>i,K:()=>n})},20639:(e,t,r)=>{"use strict";r.d(t,{UE:()=>u,Xi:()=>c,gz:()=>h});r(11265),r(81806),r(50076),r(15941);var i=r(30726),n=(r(65256),r(67478),r(11571)),s=r(24241);r(38042);new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]);const o="yyyy-MM-dd";var a;!function(e){e.HM="HH:mm",e.HMS="HH:mm:ss",e.HMS_MS="HH:mm:ss.SSS"}(a||(a={}));const l=[a.HMS_MS,a.HMS,a.HM,"TT"];new Set(["date-only","time-only","timestamp-offset"]);function c(e){if(!e||!(0,n.K)(e))return null;const t=s.c9.fromFormat(e,o);return t.isValid?t:null}function u(e){return e&&(0,n.K)(e)?(0,i.Pb)(l,(t=>{const r=s.c9.fromFormat(e,t);return r.isValid?r:null}))??null:null}function h(e){if(!e||!(0,n.K)(e))return null;const t=s.c9.fromISO(e);return t.isValid?t:null}},20459:(e,t,r)=>{"use strict";r.d(t,{$:()=>n});var i=r(76099);function n(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${String(t)}'`);return{value:s(e[t])}}}function s(e){return function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];!function(e){const t=e?.type;return e instanceof KeyboardEvent||"keyup"===t||"keydown"===t||"keypress"===t}(t)?e.call(this,t,...n):(0,i.OU)(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click())}}},63582:(e,t,r)=>{"use strict";function i(e){return(t,r)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:r})}}r.d(t,{G:()=>i})},12254:(e,t,r)=>{"use strict";function i(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const r=t._delegatedEventNames,i=Array.isArray(e)?e:function(e){return e.split(",").map((e=>e.trim()))}(e);r.push(...i)}}r.d(t,{U:()=>i})},98108:(e,t,r)=>{"use strict";r.d(t,{D:()=>i});const i={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"}},54761:(e,t,r)=>{"use strict";r.d(t,{K:()=>a,w:()=>l});var i=r(83008),n=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},s=function(e,t){for(var r=0,i=e.length;r<i;r++){var o=e[r];Array.isArray(o)?s(o,t):null!=o&&!1!==o&&(o.hasOwnProperty("vnodeSelector")||(o=n(o)),t.push(o))}},o=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(1===r.length&&"string"==typeof r[0])return{vnodeSelector:e,properties:t||void 0,children:void 0,text:r[0],domNode:null};var n=[];return s(r,n),{vnodeSelector:e,properties:t||void 0,children:n,text:void 0,domNode:null}};function a(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),s=2;s<r;s++)n[s-2]=arguments[s];return"function"!=typeof e||(0,i.b)(e)?o(e,t,...n):e(t,...n)}function l(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t}},83008:(e,t,r)=>{"use strict";r.d(t,{b:()=>d,d:()=>l});var i=r(54901),n=r(73319);const s=[],o={},a=new WeakMap;function l(e,t){let r=t.children;if(r?.length)for(let n=0;n<r.length;++n)r[n]=l(e,r[n]);else r=s;const i=t.vnodeSelector;if(d(i)){const n=t.properties||o,s=n.key||i;return{vnodeSelector:"div",properties:{key:s,afterCreate:c,afterUpdate:u,afterRemoved:h,parentWidget:e,widgetConstructor:i,widgetProperties:{...n,key:s,children:r}},children:void 0,text:void 0,domNode:null}}return t}function c(e,t,r,s){let{parentWidget:o,widgetConstructor:l,widgetProperties:c}=s;const u=new l(c);u.container=e,a.set(e,u),u.afterCreate?.(u,e),o.addHandles((0,i.hA)((()=>h(e)))),queueMicrotask((()=>{u[n.D].projector.renderNow()}))}function u(e,t,r,i){let{widgetProperties:n}=i;const s=a.get(e);s&&(s.set(n),s.afterUpdate?.(s,e))}function h(e){const t=a.get(e);t&&(t.afterRemoved?.(t,e),t.destroy(),a.delete(e))}function d(e){return"function"==typeof e&&e[n.x]}},15062:(e,t,r)=>{"use strict";r.d(t,{T:()=>i});const i={checkMark:"esri-icon-check-mark",close:"esri-icon-close",collapse:"esri-icon-collapse",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",handleVertical:"esri-icon-handle-vertical",icon:"esri-icon",left:"esri-icon-left",loadingIndicator:"esri-icon-loading-indicator",locateCircled:"esri-icon-locate-circled",minus:"esri-icon-minus",noticeTriangle:"esri-icon-notice-triangle",pause:"esri-icon-pause",play:"esri-icon-play",plus:"esri-icon-plus",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",search:"esri-icon-search",swap:"esri-icon-swap",table:"esri-icon-table",trash:"esri-icon-trash",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomToObject:"esri-icon-zoom-to-object"}},73319:(e,t,r)=>{"use strict";r.d(t,{D:()=>n,x:()=>i});const i=Symbol("widget"),n=Symbol("widget-test-data")},14656:(e,t,r)=>{"use strict";r.d(t,{$U:()=>o,Qw:()=>a,Sh:()=>n,rE:()=>s});const i=new Map;function n(){i.clear()}function s(e){return i.get(e)}function o(e,t){i.set(e,t)}function a(e){i.delete(e)}},76099:(e,t,r)=>{"use strict";r.d(t,{Ly:()=>pe,N_:()=>me,OU:()=>we,V8:()=>fe,yH:()=>be,W5:()=>ve,cA:()=>ge});var i=function(){return i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)},n={exports:{}},s={},o={exports:{}},a={};function l(){var e={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1};return e}var c=/javascript\s*\:/gim;a.whiteList=l(),a.getDefaultWhiteList=l,a.onAttr=function(e,t,r){},a.onIgnoreAttr=function(e,t,r){},a.safeAttrValue=function(e,t){return c.test(t)?"":t};var u={indexOf:function(e,t){var r,i;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var i,n;if(Array.prototype.forEach)return e.forEach(t,r);for(i=0,n=e.length;i<n;i++)t.call(r,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},h=u;var d=function(e,t){";"!==(e=h.trimRight(e))[e.length-1]&&(e+=";");var r=e.length,i=!1,n=0,s=0,o="";function a(){if(!i){var r=h.trim(e.slice(n,s)),a=r.indexOf(":");if(-1!==a){var l=h.trim(r.slice(0,a)),c=h.trim(r.slice(a+1));if(l){var u=t(n,o.length,l,c,r);u&&(o+=u+"; ")}}}n=s+1}for(;s<r;s++){var l=e[s];if("/"===l&&"*"===e[s+1]){var c=e.indexOf("*/",s+2);if(-1===c)break;n=(s=c+1)+1,i=!1}else"("===l?i=!0:")"===l?i=!1:";"===l?i||a():"\n"===l&&a()}return h.trim(o)},p=a,f=d;function m(e){return void 0===e||null===e}function g(e){(e=function(e){var t={};for(var r in e)t[r]=e[r];return t}(e||{})).whiteList=e.whiteList||p.whiteList,e.onAttr=e.onAttr||p.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||p.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||p.safeAttrValue,this.options=e}g.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,r=t.whiteList,i=t.onAttr,n=t.onIgnoreAttr,s=t.safeAttrValue;return f(e,(function(e,t,o,a,l){var c=r[o],u=!1;if(!0===c?u=c:"function"===typeof c?u=c(a):c instanceof RegExp&&(u=c.test(a)),!0!==u&&(u=!1),a=s(o,a)){var h,d={position:t,sourcePosition:e,source:l,isWhite:u};return u?m(h=i(o,a,d))?o+":"+a:h:m(h=n(o,a,d))?void 0:h}}))};var y=g;!function(e,t){var r=a,i=y;for(var n in(t=e.exports=function(e,t){return new i(t).process(e)}).FilterCSS=i,r)t[n]=r[n]}(o,o.exports);var _=o.exports,v={indexOf:function(e,t){var r,i;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var i,n;if(Array.prototype.forEach)return e.forEach(t,r);for(i=0,n=e.length;i<n;i++)t.call(r,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1}},b=_.FilterCSS,w=_.getDefaultWhiteList,x=v;function S(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var T=new b;function M(e){return e.replace(A,"&lt;").replace(C,"&gt;")}var A=/</g,C=/>/g,E=/"/g,R=/&quot;/g,P=/&#([a-zA-Z0-9]*);?/gim,O=/&colon;?/gim,I=/&newline;?/gim,L=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,N=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,D=/u\s*r\s*l\s*\(.*/gi;function F(e){return e.replace(E,"&quot;")}function k(e){return e.replace(R,'"')}function z(e){return e.replace(P,(function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))}))}function U(e){return e.replace(O,":").replace(I," ")}function V(e){for(var t="",r=0,i=e.length;r<i;r++)t+=e.charCodeAt(r)<32?" ":e.charAt(r);return x.trim(t)}function B(e){return e=V(e=U(e=z(e=k(e))))}function j(e){return e=M(e=F(e))}s.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},s.getDefaultWhiteList=S,s.onTag=function(e,t,r){},s.onIgnoreTag=function(e,t,r){},s.onTagAttr=function(e,t,r){},s.onIgnoreTagAttr=function(e,t,r){},s.safeAttrValue=function(e,t,r,i){if(r=B(r),"href"===t||"src"===t){if("#"===(r=x.trim(r)))return"#";if("http://"!==r.substr(0,7)&&"https://"!==r.substr(0,8)&&"mailto:"!==r.substr(0,7)&&"tel:"!==r.substr(0,4)&&"data:image/"!==r.substr(0,11)&&"ftp://"!==r.substr(0,6)&&"./"!==r.substr(0,2)&&"../"!==r.substr(0,3)&&"#"!==r[0]&&"/"!==r[0])return""}else if("background"===t){if(L.lastIndex=0,L.test(r))return""}else if("style"===t){if(N.lastIndex=0,N.test(r))return"";if(D.lastIndex=0,D.test(r)&&(L.lastIndex=0,L.test(r)))return"";!1!==i&&(r=(i=i||T).process(r))}return r=j(r)},s.escapeHtml=M,s.escapeQuote=F,s.unescapeQuote=k,s.escapeHtmlEntities=z,s.escapeDangerHtml5Entities=U,s.clearNonPrintableCharacter=V,s.friendlyAttrValue=B,s.escapeAttrValue=j,s.onIgnoreTagStripAll=function(){return""},s.StripTagBody=function(e,t){"function"!==typeof t&&(t=function(){});var r=!Array.isArray(e),i=[],n=!1;return{onIgnoreTag:function(s,o,a){if(function(t){return!!r||-1!==x.indexOf(e,t)}(s)){if(a.isClosing){var l="[/removed]",c=a.position+10;return i.push([!1!==n?n:a.position,c]),n=!1,l}return n||(n=a.position),"[removed]"}return t(s,o,a)},remove:function(e){var t="",r=0;return x.forEach(i,(function(i){t+=e.slice(r,i[0]),r=i[1]})),t+=e.slice(r)}}},s.stripCommentTag=function(e){for(var t="",r=0;r<e.length;){var i=e.indexOf("\x3c!--",r);if(-1===i){t+=e.slice(r);break}t+=e.slice(r,i);var n=e.indexOf("--\x3e",i);if(-1===n)break;r=n+3}return t},s.stripBlankChar=function(e){var t=e.split("");return t=t.filter((function(e){var t=e.charCodeAt(0);return 127!==t&&(!(t<=31)||(10===t||13===t))})),t.join("")},s.cssFilter=T,s.getDefaultCSSWhiteList=w;var H={},G=v;function Z(e){var t,r=G.spaceIndex(e);return t=-1===r?e.slice(1,-1):e.slice(1,r+1),"/"===(t=G.trim(t).toLowerCase()).slice(0,1)&&(t=t.slice(1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),t}function $(e){return"</"===e.slice(0,2)}var q=/[^a-zA-Z0-9\\_:.-]/gim;function W(e,t){for(;t<e.length;t++){var r=e[t];if(" "!==r)return"="===r?t:-1}}function Y(e,t){for(;t<e.length;t++){var r=e[t];if(" "!==r)return"'"===r||'"'===r?t:-1}}function X(e,t){for(;t>0;t--){var r=e[t];if(" "!==r)return"="===r?t:-1}}function J(e){return function(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]}(e)?e.substr(1,e.length-2):e}H.parseTag=function(e,t,r){var i="",n=0,s=!1,o=!1,a=0,l=e.length,c="",u="";e:for(a=0;a<l;a++){var h=e.charAt(a);if(!1===s){if("<"===h){s=a;continue}}else if(!1===o){if("<"===h){i+=r(e.slice(n,a)),s=a,n=a;continue}if(">"===h){i+=r(e.slice(n,s)),c=Z(u=e.slice(s,a+1)),i+=t(s,i.length,c,u,$(u)),n=a+1,s=!1;continue}if('"'===h||"'"===h)for(var d=1,p=e.charAt(a-d);""===p.trim()||"="===p;){if("="===p){o=h;continue e}p=e.charAt(a-++d)}}else if(h===o){o=!1;continue}}return n<e.length&&(i+=r(e.substr(n))),i},H.parseAttr=function(e,t){var r=0,i=0,n=[],s=!1,o=e.length;function a(e,r){if(!((e=(e=G.trim(e)).replace(q,"").toLowerCase()).length<1)){var i=t(e,r||"");i&&n.push(i)}}for(var l=0;l<o;l++){var c,u=e.charAt(l);if(!1!==s||"="!==u)if(!1===s||l!==i)if(/\s|\n|\t/.test(u)){if(e=e.replace(/\s|\n|\t/g," "),!1===s){if(-1===(c=W(e,l))){a(G.trim(e.slice(r,l))),s=!1,r=l+1;continue}l=c-1;continue}if(-1===(c=X(e,l-1))){a(s,J(G.trim(e.slice(r,l)))),s=!1,r=l+1;continue}}else;else{if(-1===(c=e.indexOf(u,l+1)))break;a(s,G.trim(e.slice(i+1,c))),s=!1,r=(l=c)+1}else s=e.slice(r,l),r=l+1,i='"'===e.charAt(r)||"'"===e.charAt(r)?r:Y(e,l+1)}return r<e.length&&(!1===s?a(e.slice(r)):a(s,J(G.trim(e.slice(r))))),G.trim(n.join(" "))};var K=_.FilterCSS,Q=s,ee=H,te=ee.parseTag,re=ee.parseAttr,ie=v;function ne(e){return void 0===e||null===e}function se(e){(e=function(e){var t={};for(var r in e)t[r]=e[r];return t}(e||{})).stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Q.onIgnoreTagStripAll),e.whiteList||e.allowList?e.whiteList=function(e){var t={};for(var r in e)Array.isArray(e[r])?t[r.toLowerCase()]=e[r].map((function(e){return e.toLowerCase()})):t[r.toLowerCase()]=e[r];return t}(e.whiteList||e.allowList):e.whiteList=Q.whiteList,e.onTag=e.onTag||Q.onTag,e.onTagAttr=e.onTagAttr||Q.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Q.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Q.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Q.safeAttrValue,e.escapeHtml=e.escapeHtml||Q.escapeHtml,this.options=e,!1===e.css?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new K(e.css))}se.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,r=t.whiteList,i=t.onTag,n=t.onIgnoreTag,s=t.onTagAttr,o=t.onIgnoreTagAttr,a=t.safeAttrValue,l=t.escapeHtml,c=this.cssFilter;t.stripBlankChar&&(e=Q.stripBlankChar(e)),t.allowCommentTag||(e=Q.stripCommentTag(e));var u=!1;t.stripIgnoreTagBody&&(u=Q.StripTagBody(t.stripIgnoreTagBody,n),n=u.onIgnoreTag);var h=te(e,(function(e,t,u,h,d){var p={sourcePosition:e,position:t,isClosing:d,isWhite:Object.prototype.hasOwnProperty.call(r,u)},f=i(u,h,p);if(!ne(f))return f;if(p.isWhite){if(p.isClosing)return"</"+u+">";var m=function(e){var t=ie.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var r="/"===(e=ie.trim(e.slice(t+1,-1)))[e.length-1];return r&&(e=ie.trim(e.slice(0,-1))),{html:e,closing:r}}(h),g=r[u],y=re(m.html,(function(e,t){var r=-1!==ie.indexOf(g,e),i=s(u,e,t,r);return ne(i)?r?(t=a(u,e,t,c))?e+'="'+t+'"':e:ne(i=o(u,e,t,r))?void 0:i:i}));return h="<"+u,y&&(h+=" "+y),m.closing&&(h+=" /"),h+=">"}return ne(f=n(u,h,p))?l(h):f}),l);return u&&(h=u.remove(h)),h};var oe=se;!function(e,t){var r=s,i=H,n=oe;function o(e,t){return new n(t).process(e)}(t=e.exports=o).filterXSS=o,t.FilterXSS=n,function(){for(var e in r)t[e]=r[e];for(var n in i)t[n]=i[n]}(),"undefined"!==typeof self&&"undefined"!==typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=e.exports)}(n,n.exports);var ae=n.exports,le=function(){function e(e,t){var r,n=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],details:["style"],div:["align","style","aria-label","aria-hidden"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=i(i({},ae.getDefaultCSSWhiteList()),{flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,"line-height":!0,"justify-content":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(e,t,r,i){return"a"===e&&"href"===t||("img"===e||"source"===e)&&"src"===t?n.sanitizeUrl(r):ae.safeAttrValue(e,t,r,i)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"},e&&!t?r=e:e&&t?((r=Object.create(this.arcgisFilterOptions)).css={whiteList:this.arcgisCSSWhiteList},Object.keys(e).forEach((function(t){if("whiteList"===t)r.whiteList=n._extendObjectOfArrays([n.arcgisWhiteList,e.whiteList||{}]);else if("css"===t){var i=e.css.whiteList;null!=i&&e.css instanceof Object&&Object.keys(i).forEach((function(e){return r.css.whiteList[e]=i[e]}))}else r[t]=e[t]}))):((r=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList,r.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=r,this._xssFilter=new ae.FilterXSS(r)}return e.prototype.sanitize=function(e,t){switch(void 0===t&&(t={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,t);default:if(t.allowUndefined&&"undefined"===typeof e)return;return null}},e.prototype.sanitizeUrl=function(e,t){var r=(null!==t&&void 0!==t?t:{}).isProtocolRequired,i=void 0===r||r,n=this._trim(e.substring(0,e.indexOf(":"))),s="/"===e,o=/^#/.test(e),a=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return s||o||a?ae.escapeAttrValue(e):n||i?"":ae.escapeAttrValue("https://".concat(e))},e.prototype.sanitizeHTMLAttribute=function(e,t,r,i){return"function"===typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(e,t,r,i):ae.safeAttrValue(e,t,r,i)},e.prototype.validate=function(e,t){void 0===t&&(t={});var r=this.sanitize(e,t);return{isValid:e===r,sanitized:r}},e.prototype.encodeHTML=function(e){var t=this;return String(e).replace(/[&<>"'\/]/g,(function(e){return t._entityMap[e]}))},e.prototype.encodeAttrValue=function(e){var t=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,(function(r,i){return t.test(r)?r:"&#x".concat(Number(e.charCodeAt(i)).toString(16),";")}))},e.prototype._extendObjectOfArrays=function(e){var t={};return e.forEach((function(e){Object.keys(e).forEach((function(r){Array.isArray(e[r])&&Array.isArray(t[r])?t[r]=t[r].concat(e[r]):t[r]=e[r]}))})),t},e.prototype._iterateOverObject=function(e,t){var r=this;void 0===t&&(t={});try{var i=!1,n=void 0;if(Array.isArray(e))n=e.reduce((function(e,n){var s=r.validate(n,t);return s.isValid?e.concat([n]):(i=!0,e.concat([s.sanitized]))}),[]);else{if(!function(e){if("object"!==typeof e||null===e)return!1;if("[object Object]"!==Object.prototype.toString.call(e))return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e)){if(t.allowUndefined&&"undefined"===typeof e)return;return null}n=Object.keys(e).reduce((function(n,s){var o=e[s],a=r.validate(o,t);return a.isValid?n[s]=o:(i=!0,n[s]=a.sanitized),n}),{})}return i?n:e}catch(s){return null}},e.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},e}(),ce=r(11373),ue=r(54901),he=(r(81806),r(76460),r(68134)),de=r(14656);function pe(){const e=ce.A.acquire();for(let r=0;r<arguments.length;r++){const t=r<0||arguments.length<=r?void 0:arguments[r],i=typeof t;if("string"===i)e.push(t);else if(Array.isArray(t))e.push.apply(e,t);else if("object"===i)for(const r in t)t[r]&&e.push(r)}const t=e.join(" ");return ce.A.release(e),t}(()=>{const e=new Map,t=new ResizeObserver((t=>{(0,de.Sh)();for(const r of t)e.get(r.target)?.(r)})),r=(r,i,n)=>(e.set(r,i),t.observe(r,n),(0,ue.hA)((()=>{t.unobserve(r),e.delete(r)})))})();function fe(e){const t=e?.closest("[dir]");return null!==t&&t instanceof HTMLElement&&"rtl"===t.dir||"rtl"===document.dir}function me(e){this[e.getAttribute("data-node-ref")]=null}function ge(e){this[e.getAttribute("data-node-ref")]=e}const ye=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"].reduce(((e,t)=>(e[t]=[],e)),{}),_e=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],ve=new le({whiteList:ye,onTagAttr:(e,t,r)=>{const i=`${t}="${r}"`;if(_e.includes(t))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function be(e,t){const r=e.getBoundingClientRect(),i=t.getBoundingClientRect(),n=r.top+r.height,s=i.top+i.height,o=r.top,a=i.top;(n>s||o<a)&&e.scrollIntoView({block:"end"})}function we(e){return"Enter"===e||" "===e}},32811:(e,t,r)=>{"use strict";r.d(t,{g:()=>s,i:()=>n});var i=r(77816);const n=()=>i.L2.isBrowser&&"undefined"!==typeof navigator&&"undefined"!==typeof window&&"undefined"!==typeof location&&"undefined"!==typeof document&&window.location===location&&window.document===document;function s(){if(!n())return"";const e=navigator.userAgentData;return e?.brands?e.brands.map((e=>{let{brand:t,version:r}=e;return`${t}/${r}`})).join(" "):navigator.userAgent}},72669:(e,t,r)=>{"use strict";r.d(t,{f:()=>s,l:()=>a,s:()=>h});var i=r(77816);const n=globalThis.calciteConfig,s=n?.focusTrapStack||[],o=i.L2.isTesting&&i.L2.isBrowser,a=n?.logLevel||(o?"error":"info"),l="2.12.1",c="2024-09-04",u="eae5049";function h(){if(n&&n.version)return;console.info(`Using Calcite Components ${l} [Date: ${c}, Revision: ${u}]`);const e=n||globalThis.calciteConfig||{};Object.defineProperty(e,"version",{value:l,writable:!1}),globalThis.calciteConfig=e}},24282:(e,t,r)=>{"use strict";r.d(t,{C:()=>s,D:()=>o,a:()=>i,d:()=>n});const i="calcite-mode-auto",n="calcite-mode-dark",s={autoMode:i,darkMode:n,lightMode:"calcite-mode-light",rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"},o={filter:250,nextTick:0,resize:150,reposition:100}},77816:(e,t,r)=>{"use strict";r.d(t,{L2:()=>a,FK:()=>zt,wt:()=>C,xr:()=>ae,lh:()=>ge,$x:()=>lt,OX:()=>G,h:()=>se,w$:()=>kt,gv:()=>j,Qu:()=>Z});var i,n={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,formAssociated:!1,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0,experimentalSlotFixes:!1},s="app",o=Object.defineProperty,a={isDev:!!n.isDev,isBrowser:!0,isServer:!1,isTesting:!!n.isTesting},l=n.hotModuleReplacement?window.__STENCIL_HOSTREFS__||(window.__STENCIL_HOSTREFS__=new WeakMap):new WeakMap,c=e=>l.get(e),u=(e,t)=>{const r={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return n.isDev&&(r.$renderCount$=0),n.method&&n.lazyLoad&&(r.$onInstancePromise$=new Promise((e=>r.$onInstanceResolve$=e))),n.asyncLoading&&(r.$onReadyPromise$=new Promise((e=>r.$onReadyResolve$=e)),e["s-p"]=[],e["s-rc"]=[]),l.set(e,r)},h=(e,t)=>t in e,d=(e,t)=>(i||console.error)(e,t),p=n.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],f=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return console.error(...p,...t)},m=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return console.warn(...p,...t)},g=new Map,y=new Map,_=[],v="s-id",b="sty-id",w="c-id",x="slot-fb{display:contents}slot-fb[hidden]{display:none}",S="http://www.w3.org/1999/xlink",T=["formAssociatedCallback","formResetCallback","formDisabledCallback","formStateRestoreCallback"],M="undefined"!==typeof window?window:{},A=M.document||{head:{}},C=M.HTMLElement||class{},E={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,r,i)=>e.addEventListener(t,r,i),rel:(e,t,r,i)=>e.removeEventListener(t,r,i),ce:(e,t)=>new CustomEvent(e,t)},R=n.shadowDom,P=(()=>{let e=!1;try{A.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch(t){}return e})(),O=!!n.constructableCSS&&(()=>{try{return new CSSStyleSheet,"function"===typeof(new CSSStyleSheet).replaceSync}catch(e){}return!1})(),I=0,L=!1,N=[],D=[],F=[],k=(e,t)=>r=>{e.push(r),L||(L=!0,t&&4&E.$flags$?B(V):E.raf(V))},z=e=>{for(let r=0;r<e.length;r++)try{e[r](performance.now())}catch(t){d(t)}e.length=0},U=(e,t)=>{let r=0,i=0;for(;r<e.length&&(i=performance.now())<t;)try{e[r++](i)}catch(n){d(n)}r===e.length?e.length=0:0!==r&&e.splice(0,r)},V=()=>{if(n.asyncQueue&&I++,z(N),n.asyncQueue){const e=2===(6&E.$flags$)?performance.now()+14*Math.ceil(.1*I):1/0;U(D,e),U(F,e),D.length>0&&(F.push(...D),D.length=0),(L=N.length+D.length+F.length>0)?E.raf(V):I=0}else z(D),(L=N.length>0)&&E.raf(V)},B=e=>(e=>Promise.resolve(e))().then(e),j=k(N,!1),H=k(D,!0),G=e=>{const t=new URL(e,E.$resourcesUrl$);return t.origin!==M.location.origin?t.href:t.pathname},Z=e=>E.$resourcesUrl$=e,$={},q=e=>"object"===(e=typeof e)||"function"===e;function W(e){var t,r,i;return null!=(i=null==(r=null==(t=e.head)?void 0:t.querySelector('meta[name="csp-nonce"]'))?void 0:r.getAttribute("content"))?i:void 0}((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})({},{err:()=>X,map:()=>J,ok:()=>Y,unwrap:()=>te,unwrapErr:()=>re});var Y=e=>({isOk:!0,isErr:!1,value:e}),X=e=>({isOk:!1,isErr:!0,value:e});function J(e,t){if(e.isOk){const r=t(e.value);return r instanceof Promise?r.then((e=>Y(e))):Y(r)}if(e.isErr){const t=e.value;return X(t)}throw"should never get here"}var K,Q,ee,te=e=>{if(e.isOk)return e.value;throw e.value},re=e=>{if(e.isErr)return e.value;throw e.value},ie=0,ne=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(n.profile&&performance.mark){const r=`st:${e}:${t}:${ie++}`;return performance.mark(r),()=>performance.measure(`[Stencil] ${e}() <${t}>`,r)}return()=>{}},se=function(e,t){let r=null,i=null,s=null,o=!1,a=!1;const l=[],c=t=>{for(let i=0;i<t.length;i++)r=t[i],Array.isArray(r)?c(r):null!=r&&"boolean"!==typeof r&&((o="function"!==typeof e&&!q(r))?r=String(r):n.isDev&&"function"!==typeof e&&void 0===r.$flags$&&f("vNode passed as children has unexpected type.\nMake sure it's using the correct h() function.\nEmpty objects can also be the cause, look for JSX comments that became objects."),o&&a?l[l.length-1].$text$+=r:l.push(o?oe(null,r):r),a=o)};for(var u=arguments.length,h=new Array(u>2?u-2:0),d=2;d<u;d++)h[d-2]=arguments[d];if(c(h),t&&(n.isDev&&"input"===e&&de(t),n.vdomKey&&t.key&&(i=t.key),n.slotRelocation&&t.name&&(s=t.name),n.vdomClass)){const e=t.className||t.class;e&&(t.class="object"!==typeof e?e:Object.keys(e).filter((t=>e[t])).join(" "))}if(n.isDev&&l.some(le)&&f("The <Host> must be the single root component. Make sure:\n- You are NOT using hostData() and <Host> in the same component.\n- <Host> is used once, and it's the single root component of the render() function."),n.vdomFunctional&&"function"===typeof e)return e(null===t?{}:t,l,ce);const p=oe(e,null);return p.$attrs$=t,l.length>0&&(p.$children$=l),n.vdomKey&&(p.$key$=i),n.slotRelocation&&(p.$name$=s),p},oe=(e,t)=>{const r={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return n.vdomAttribute&&(r.$attrs$=null),n.vdomKey&&(r.$key$=null),n.slotRelocation&&(r.$name$=null),r},ae={},le=e=>e&&e.$tag$===ae,ce={forEach:(e,t)=>e.map(ue).forEach(t),map:(e,t)=>e.map(ue).map(t).map(he)},ue=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),he=e=>{if("function"===typeof e.vtag){const t={...e.vattrs};return e.vkey&&(t.key=e.vkey),e.vname&&(t.name=e.vname),se(e.vtag,t,...e.vchildren||[])}const t=oe(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},de=e=>{const t=Object.keys(e),r=t.indexOf("value");if(-1===r)return;const i=t.indexOf("type"),n=t.indexOf("min"),s=t.indexOf("max"),o=t.indexOf("step");(r<i||r<n||r<s||r<o)&&m('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},pe=(e,t,r,i,s,o,a)=>{let l,c,u,h;if(1===o.nodeType){if(l=o.getAttribute(w),l&&(c=l.split("."),c[0]!==a&&"0"!==c[0]||(u={$flags$:0,$hostId$:c[0],$nodeId$:c[1],$depth$:c[2],$index$:c[3],$tag$:o.tagName.toLowerCase(),$elm$:o,$attrs$:null,$children$:null,$key$:null,$name$:null,$text$:null},t.push(u),o.removeAttribute(w),e.$children$||(e.$children$=[]),e.$children$[u.$index$]=u,e=u,i&&"0"===u.$depth$&&(i[u.$index$]=u.$elm$))),o.shadowRoot)for(h=o.shadowRoot.childNodes.length-1;h>=0;h--)pe(e,t,r,i,s,o.shadowRoot.childNodes[h],a);for(h=o.childNodes.length-1;h>=0;h--)pe(e,t,r,i,s,o.childNodes[h],a)}else if(8===o.nodeType)c=o.nodeValue.split("."),c[1]!==a&&"0"!==c[1]||(l=c[0],u={$flags$:0,$hostId$:c[1],$nodeId$:c[2],$depth$:c[3],$index$:c[4],$elm$:o,$attrs$:null,$children$:null,$key$:null,$name$:null,$tag$:null,$text$:null},"t"===l?(u.$elm$=o.nextSibling,u.$elm$&&3===u.$elm$.nodeType&&(u.$text$=u.$elm$.textContent,t.push(u),o.remove(),e.$children$||(e.$children$=[]),e.$children$[u.$index$]=u,i&&"0"===u.$depth$&&(i[u.$index$]=u.$elm$))):u.$hostId$===a&&("s"===l?(u.$tag$="slot",c[5]?o["s-sn"]=u.$name$=c[5]:o["s-sn"]="",o["s-sr"]=!0,n.shadowDom&&i&&(u.$elm$=A.createElement(u.$tag$),u.$name$&&u.$elm$.setAttribute("name",u.$name$),o.parentNode.insertBefore(u.$elm$,o),o.remove(),"0"===u.$depth$&&(i[u.$index$]=u.$elm$)),r.push(u),e.$children$||(e.$children$=[]),e.$children$[u.$index$]=u):"r"===l&&(n.shadowDom&&i?o.remove():n.slotRelocation&&(s["s-cr"]=o,o["s-cn"]=!0))));else if(e&&"style"===e.$tag$){const t=oe(null,o.textContent);t.$elm$=o,t.$index$="0",e.$children$=[t]}},fe=(e,t)=>{if(1===e.nodeType){let r=0;if(e.shadowRoot)for(;r<e.shadowRoot.childNodes.length;r++)fe(e.shadowRoot.childNodes[r],t);for(r=0;r<e.childNodes.length;r++)fe(e.childNodes[r],t)}else if(8===e.nodeType){const r=e.nodeValue.split(".");"o"===r[0]&&(t.set(r[1]+"."+r[2],e),e.nodeValue="",e["s-en"]=r[3])}},me=e=>_.map((t=>t(e))).find((e=>!!e)),ge=(e,t,r)=>{const i=(e=>n.lazyLoad?c(e).$hostElement$:e)(e);return{emit:e=>(n.isDev&&!i.isConnected&&m(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),ye(i,t,{bubbles:!!(4&r),composed:!!(2&r),cancelable:!!(1&r),detail:e}))}},ye=(e,t,r)=>{const i=E.ce(t,r);return e.dispatchEvent(i),i},_e=new WeakMap,ve=(e,t,r)=>{let i=y.get(e);O&&r?(i=i||new CSSStyleSheet,"string"===typeof i?i=t:i.replaceSync(t)):i=t,y.set(e,i)},be=(e,t,r)=>{var i;const s=xe(t,r),o=y.get(s);if(!n.attachStyles)return s;if(e=11===e.nodeType?e:A,o)if("string"===typeof o){e=e.head||e;let r,a=_e.get(e);if(a||_e.set(e,a=new Set),!a.has(s)){if(n.hydrateClientSide&&e.host&&(r=e.querySelector(`[${b}="${s}"]`)))r.innerHTML=o;else{r=A.createElement("style"),r.innerHTML=o;const a=null!=(i=E.$nonce$)?i:W(A);null!=a&&r.setAttribute("nonce",a),(n.hydrateServerSide||n.hotModuleReplacement)&&2&t.$flags$&&r.setAttribute(b,s);(!(1&t.$flags$)||1&t.$flags$&&"HEAD"!==e.nodeName)&&e.insertBefore(r,e.querySelector("link"))}4&t.$flags$&&(r.innerHTML+=x),a&&a.add(s)}}else n.constructableCSS&&!e.adoptedStyleSheets.includes(o)&&(e.adoptedStyleSheets=[...e.adoptedStyleSheets,o]);return s},we=e=>{const t=e.$cmpMeta$,r=e.$hostElement$,i=t.$flags$,s=ne("attachStyles",t.$tagName$),o=be(n.shadowDom&&R&&r.shadowRoot?r.shadowRoot:r.getRootNode(),t,e.$modeName$);(n.shadowDom||n.scoped)&&n.cssAnnotations&&10&i&&2&i&&(r["s-sc"]=o,r.classList.add(o+"-h"),n.scoped&&2&i&&r.classList.add(o+"-s")),s()},xe=(e,t)=>"sc-"+(n.mode&&t&&32&e.$flags$?e.$tagName$+"-"+t:e.$tagName$),Se=(e,t,r,i,s,o)=>{if(r!==i){let l=h(e,t),c=t.toLowerCase();if(n.vdomClass&&"class"===t){const t=e.classList,n=Me(r),s=Me(i);t.remove(...n.filter((e=>e&&!s.includes(e)))),t.add(...s.filter((e=>e&&!n.includes(e))))}else if(n.vdomStyle&&"style"===t){if(n.updatable)for(const t in r)i&&null!=i[t]||(!n.hydrateServerSide&&t.includes("-")?e.style.removeProperty(t):e.style[t]="");for(const t in i)r&&i[t]===r[t]||(!n.hydrateServerSide&&t.includes("-")?e.style.setProperty(t,i[t]):e.style[t]=i[t])}else if(n.vdomKey&&"key"===t);else if(n.vdomRef&&"ref"===t)i&&i(e);else if(!n.vdomListener||(n.lazyLoad?l:e.__lookupSetter__(t))||"o"!==t[0]||"n"!==t[1]){if(n.vdomPropOrAttr){const u=q(i);if((l||u&&null!==i)&&!s)try{if(e.tagName.includes("-"))e[t]=i;else{const n=null==i?"":i;"list"===t?l=!1:null!=r&&e[t]==n||(e[t]=n)}}catch(a){}let h=!1;n.vdomXlink&&c!==(c=c.replace(/^xlink\:?/,""))&&(t=c,h=!0),null==i||!1===i?!1===i&&""!==e.getAttribute(t)||(n.vdomXlink&&h?e.removeAttributeNS(S,t):e.removeAttribute(t)):(!l||4&o||s)&&!u&&(i=!0===i?"":i,n.vdomXlink&&h?e.setAttributeNS(S,t,i):e.setAttribute(t,i))}}else if(t="-"===t[2]?t.slice(3):h(M,c)?c.slice(2):c[2]+t.slice(3),r||i){const n=t.endsWith(Ae);t=t.replace(Ce,""),r&&E.rel(e,t,r,n),i&&E.ael(e,t,i,n)}}},Te=/\s/,Me=e=>e?e.split(Te):[],Ae="Capture",Ce=new RegExp(Ae+"$"),Ee=(e,t,r)=>{const i=11===t.$elm$.nodeType&&t.$elm$.host?t.$elm$.host:t.$elm$,s=e&&e.$attrs$||$,o=t.$attrs$||$;if(n.updatable)for(const n of Re(Object.keys(s)))n in o||Se(i,n,s[n],void 0,r,t.$flags$);for(const n of Re(Object.keys(o)))Se(i,n,s[n],o[n],r,t.$flags$)};function Re(e){return e.includes("ref")?[...e.filter((e=>"ref"!==e)),"ref"]:e}var Pe=!1,Oe=!1,Ie=!1,Le=!1,Ne=(e,t,r,i)=>{var s;const o=t.$children$[r];let a,l,c,u=0;if(n.slotRelocation&&!Pe&&(Ie=!0,"slot"===o.$tag$&&(K&&i.classList.add(K+"-s"),o.$flags$|=o.$children$?2:1)),n.isDev&&o.$elm$&&f(`The JSX ${null!==o.$text$?`"${o.$text$}" text`:`"${o.$tag$}" element`} node should not be shared within the same renderer. The renderer caches element lookups in order to improve performance. However, a side effect from this is that the exact same JSX node should not be reused. For more information please see https://stenciljs.com/docs/templating-jsx#avoid-shared-jsx-nodes`),n.vdomText&&null!==o.$text$)a=o.$elm$=A.createTextNode(o.$text$);else if(n.slotRelocation&&1&o.$flags$)a=o.$elm$=n.isDebug||n.hydrateServerSide?Ke(o):A.createTextNode("");else{n.svg&&!Le&&(Le="svg"===o.$tag$),a=o.$elm$=n.svg?A.createElementNS(Le?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",!Pe&&n.slotRelocation&&2&o.$flags$?"slot-fb":o.$tag$):A.createElement(!Pe&&n.slotRelocation&&2&o.$flags$?"slot-fb":o.$tag$),n.svg&&Le&&"foreignObject"===o.$tag$&&(Le=!1),n.vdomAttribute&&Ee(null,o,Le);if(!!a.getRootNode().querySelector("body")&&n.scoped&&(e=>null!=e)(K)&&a["s-si"]!==K&&a.classList.add(a["s-si"]=K),n.scoped&&Xe(a,i),o.$children$)for(u=0;u<o.$children$.length;++u)l=Ne(e,o,u,a),l&&a.appendChild(l);n.svg&&("svg"===o.$tag$?Le=!1:"foreignObject"===a.tagName&&(Le=!0))}return a["s-hn"]=ee,n.slotRelocation&&3&o.$flags$&&(a["s-sr"]=!0,a["s-cr"]=Q,a["s-sn"]=o.$name$||"",a["s-rf"]=null==(s=o.$attrs$)?void 0:s.ref,c=e&&e.$children$&&e.$children$[r],c&&c.$tag$===o.$tag$&&e.$elm$&&(n.experimentalSlotFixes?De(e.$elm$):Fe(e.$elm$,!1))),a},De=e=>{E.$flags$|=1;const t=e.closest(ee.toLowerCase());if(null!=t){const r=Array.from(t.childNodes).find((e=>e["s-cr"])),i=Array.from(e.childNodes);for(const e of r?i.reverse():i)null!=e["s-sh"]&&(We(t,e,null!=r?r:null),e["s-sh"]=void 0,Ie=!0)}E.$flags$&=-2},Fe=(e,t)=>{E.$flags$|=1;const r=Array.from(e.childNodes);if(e["s-sr"]&&n.experimentalSlotFixes){let t=e;for(;t=t.nextSibling;)t&&t["s-sn"]===e["s-sn"]&&t["s-sh"]===ee&&r.push(t)}for(let i=r.length-1;i>=0;i--){const e=r[i];e["s-hn"]!==ee&&e["s-ol"]&&(We(Be(e),e,Ve(e)),e["s-ol"].remove(),e["s-ol"]=void 0,e["s-sh"]=void 0,Ie=!0),t&&Fe(e,t)}E.$flags$&=-2},ke=(e,t,r,i,s,o)=>{let a,l=n.slotRelocation&&e["s-cr"]&&e["s-cr"].parentNode||e;for(n.shadowDom&&l.shadowRoot&&l.tagName===ee&&(l=l.shadowRoot);s<=o;++s)i[s]&&(a=Ne(null,r,s,e),a&&(i[s].$elm$=a,We(l,a,n.slotRelocation?Ve(t):t)))},ze=(e,t,r)=>{for(let i=t;i<=r;++i){const t=e[i];if(t){const e=t.$elm$;qe(t),e&&(n.slotRelocation&&(Oe=!0,e["s-ol"]?e["s-ol"].remove():Fe(e,!0)),e.remove())}}},Ue=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.$tag$===t.$tag$&&(n.slotRelocation&&"slot"===e.$tag$?(!("$nodeId$"in e)||!r||8===e.$elm$.nodeType)&&e.$name$===t.$name$:!(n.vdomKey&&!r)||e.$key$===t.$key$)},Ve=e=>e&&e["s-ol"]||e,Be=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,je=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=t.$elm$=e.$elm$,s=e.$children$,o=t.$children$,a=t.$tag$,l=t.$text$;let c;n.vdomText&&null!==l?n.vdomText&&n.slotRelocation&&(c=i["s-cr"])?c.parentNode.textContent=l:n.vdomText&&e.$text$!==l&&(i.data=l):(n.svg&&(Le="svg"===a||"foreignObject"!==a&&Le),(n.vdomAttribute||n.reflect)&&(n.slot&&"slot"===a&&!Pe?n.experimentalSlotFixes&&e.$name$!==t.$name$&&(t.$elm$["s-sn"]=t.$name$||"",De(t.$elm$.parentElement)):Ee(e,t,Le)),n.updatable&&null!==s&&null!==o?function(e,t,r,i){let s,o,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=0,c=0,u=0,h=0,d=t.length-1,p=t[0],f=t[d],m=i.length-1,g=i[0],y=i[m];for(;l<=d&&c<=m;)if(null==p)p=t[++l];else if(null==f)f=t[--d];else if(null==g)g=i[++c];else if(null==y)y=i[--m];else if(Ue(p,g,a))je(p,g,a),p=t[++l],g=i[++c];else if(Ue(f,y,a))je(f,y,a),f=t[--d],y=i[--m];else if(Ue(p,y,a))!n.slotRelocation||"slot"!==p.$tag$&&"slot"!==y.$tag$||Fe(p.$elm$.parentNode,!1),je(p,y,a),We(e,p.$elm$,f.$elm$.nextSibling),p=t[++l],y=i[--m];else if(Ue(f,g,a))!n.slotRelocation||"slot"!==p.$tag$&&"slot"!==y.$tag$||Fe(f.$elm$.parentNode,!1),je(f,g,a),We(e,f.$elm$,p.$elm$),f=t[--d],g=i[++c];else{if(u=-1,n.vdomKey)for(h=l;h<=d;++h)if(t[h]&&null!==t[h].$key$&&t[h].$key$===g.$key$){u=h;break}n.vdomKey&&u>=0?(o=t[u],o.$tag$!==g.$tag$?s=Ne(t&&t[c],r,u,e):(je(o,g,a),t[u]=void 0,s=o.$elm$),g=i[++c]):(s=Ne(t&&t[c],r,c,e),g=i[++c]),s&&(n.slotRelocation?We(Be(p.$elm$),s,Ve(p.$elm$)):We(p.$elm$.parentNode,s,p.$elm$))}l>d?ke(e,null==i[m+1]?null:i[m+1].$elm$,r,i,c,m):n.updatable&&c>m&&ze(t,l,d)}(i,s,t,o,r):null!==o?(n.updatable&&n.vdomText&&null!==e.$text$&&(i.textContent=""),ke(i,null,t,o,0,o.length-1)):!r&&n.updatable&&null!==s&&ze(s,0,s.length-1),n.svg&&Le&&"svg"===a&&(Le=!1))},He=e=>{const t=e.childNodes;for(const r of t)if(1===r.nodeType){if(r["s-sr"]){const e=r["s-sn"];r.hidden=!1;for(const i of t)if(i!==r)if(i["s-hn"]!==r["s-hn"]||""!==e){if(1===i.nodeType&&(e===i.getAttribute("slot")||e===i["s-sn"])||3===i.nodeType&&e===i["s-sn"]){r.hidden=!0;break}}else if(1===i.nodeType||3===i.nodeType&&""!==i.textContent.trim()){r.hidden=!0;break}}He(r)}},Ge=[],Ze=e=>{let t,r,i;for(const s of e.childNodes){if(s["s-sr"]&&(t=s["s-cr"])&&t.parentNode){r=t.parentNode.childNodes;const e=s["s-sn"];for(i=r.length-1;i>=0;i--)if(t=r[i],!t["s-cn"]&&!t["s-nr"]&&t["s-hn"]!==s["s-hn"]&&(!n.experimentalSlotFixes||!t["s-sh"]||t["s-sh"]!==s["s-hn"]))if($e(t,e)){let r=Ge.find((e=>e.$nodeToRelocate$===t));Oe=!0,t["s-sn"]=t["s-sn"]||e,r?(r.$nodeToRelocate$["s-sh"]=s["s-hn"],r.$slotRefNode$=s):(t["s-sh"]=s["s-hn"],Ge.push({$slotRefNode$:s,$nodeToRelocate$:t})),t["s-sr"]&&Ge.map((e=>{$e(e.$nodeToRelocate$,t["s-sn"])&&(r=Ge.find((e=>e.$nodeToRelocate$===t)),r&&!e.$slotRefNode$&&(e.$slotRefNode$=r.$slotRefNode$))}))}else Ge.some((e=>e.$nodeToRelocate$===t))||Ge.push({$nodeToRelocate$:t})}1===s.nodeType&&Ze(s)}},$e=(e,t)=>1===e.nodeType?null===e.getAttribute("slot")&&""===t||e.getAttribute("slot")===t:e["s-sn"]===t||""===t,qe=e=>{n.vdomRef&&(e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(qe))},We=(e,t,r)=>{const i=null==e?void 0:e.insertBefore(t,r);return n.scoped&&Xe(t,e),i},Ye=e=>{const t=[];return e&&t.push(...e["s-scs"]||[],e["s-si"],e["s-sc"],...Ye(e.parentElement)),t},Xe=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var i;if(e&&t&&1===e.nodeType){const n=new Set(Ye(t).filter(Boolean));if(n.size&&(null==(i=e.classList)||i.add(...e["s-scs"]=[...n]),e["s-ol"]||r))for(const t of Array.from(e.childNodes))Xe(t,e,!0)}},Je=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var i,s,o,a,l;const c=e.$hostElement$,u=e.$cmpMeta$,h=e.$vnode$||oe(null,null),d=le(t)?t:se(null,null,t);if(ee=c.tagName,n.isDev&&Array.isArray(t)&&t.some(le))throw new Error(`The <Host> must be the single root component.\nLooks like the render() function of "${ee.toLowerCase()}" is returning an array that contains the <Host>.\n\nThe render() function should look like this instead:\n\nrender() {\n  // Do not return an array\n  return (\n    <Host>{content}</Host>\n  );\n}\n  `);if(n.reflect&&u.$attrsToReflect$&&(d.$attrs$=d.$attrs$||{},u.$attrsToReflect$.map((e=>{let[t,r]=e;return d.$attrs$[r]=c[t]}))),r&&d.$attrs$)for(const n of Object.keys(d.$attrs$))c.hasAttribute(n)&&!["key","ref","style","class"].includes(n)&&(d.$attrs$[n]=c[n]);if(d.$tag$=null,d.$flags$|=4,e.$vnode$=d,d.$elm$=h.$elm$=n.shadowDom&&c.shadowRoot||c,(n.scoped||n.shadowDom)&&(K=c["s-sc"]),Pe=R&&0!==(1&u.$flags$),n.slotRelocation&&(Q=c["s-cr"],Oe=!1),je(h,d,r),n.slotRelocation){if(E.$flags$|=1,Ie){Ze(d.$elm$);for(const e of Ge){const t=e.$nodeToRelocate$;if(!t["s-ol"]){const e=n.isDebug||n.hydrateServerSide?Qe(t):A.createTextNode("");e["s-nr"]=t,We(t.parentNode,t["s-ol"]=e,t)}}for(const e of Ge){const t=e.$nodeToRelocate$,l=e.$slotRefNode$;if(l){const e=l.parentNode;let r=l.nextSibling;if(!n.experimentalSlotFixes||r&&1===r.nodeType){let n=null==(i=t["s-ol"])?void 0:i.previousSibling;for(;n;){let i=null!=(s=n["s-nr"])?s:null;if(i&&i["s-sn"]===t["s-sn"]&&e===i.parentNode){for(i=i.nextSibling;i===t||(null==i?void 0:i["s-sr"]);)i=null==i?void 0:i.nextSibling;if(!i||!i["s-nr"]){r=i;break}}n=n.previousSibling}}(!r&&e!==t.parentNode||t.nextSibling!==r)&&t!==r&&(n.experimentalSlotFixes||t["s-hn"]||!t["s-ol"]||(t["s-hn"]=t["s-ol"].parentNode.nodeName),We(e,t,r),1===t.nodeType&&(t.hidden=null!=(o=t["s-ih"])&&o)),t&&"function"===typeof l["s-rf"]&&l["s-rf"](t)}else 1===t.nodeType&&(r&&(t["s-ih"]=null!=(a=t.hidden)&&a),t.hidden=!0)}}Oe&&He(d.$elm$),E.$flags$&=-2,Ge.length=0}if(n.experimentalScopedSlotChanges&&2&u.$flags$)for(const n of d.$elm$.childNodes)n["s-hn"]===ee||n["s-sh"]||(r&&null==n["s-ih"]&&(n["s-ih"]=null!=(l=n.hidden)&&l),n.hidden=!0);Q=void 0},Ke=e=>A.createComment(`<slot${e.$name$?' name="'+e.$name$+'"':""}> (host=${ee.toLowerCase()})`),Qe=e=>A.createComment("org-location for "+(e.localName?`<${e.localName}> (host=${e["s-hn"]})`:`[${e.textContent}]`)),et=(e,t)=>{n.asyncLoading&&t&&!e.$onRenderResolve$&&t["s-p"]&&t["s-p"].push(new Promise((t=>e.$onRenderResolve$=t)))},tt=(e,t)=>{if(n.taskQueue&&n.updatable&&(e.$flags$|=16),n.asyncLoading&&4&e.$flags$)return void(e.$flags$|=512);et(e,e.$ancestorComponent$);const r=()=>rt(e,t);return n.taskQueue?H(r):r()},rt=(e,t)=>{const r=e.$hostElement$,i=ne("scheduleUpdate",e.$cmpMeta$.$tagName$),s=n.lazyLoad?e.$lazyInstance$:r;if(!s)throw new Error(`Can't render component <${r.tagName.toLowerCase()} /> with invalid Stencil runtime! Make sure this imported component is compiled with a \`externalRuntime: true\` flag. For more information, please refer to https://stenciljs.com/docs/custom-elements#externalruntime`);let o;return t?(n.lazyLoad&&n.hostListener&&(e.$flags$|=256,e.$queuedListeners$&&(e.$queuedListeners$.map((e=>{let[t,r]=e;return ut(s,t,r)})),e.$queuedListeners$=void 0)),ht(r,"componentWillLoad"),n.cmpWillLoad&&(o=ut(s,"componentWillLoad"))):(ht(r,"componentWillUpdate"),n.cmpWillUpdate&&(o=ut(s,"componentWillUpdate"))),ht(r,"componentWillRender"),n.cmpWillRender&&(o=it(o,(()=>ut(s,"componentWillRender")))),i(),it(o,(()=>st(e,s,t)))},it=(e,t)=>nt(e)?e.then(t).catch((e=>{console.error(e),t()})):t(),nt=e=>e instanceof Promise||e&&e.then&&"function"===typeof e.then,st=async(e,t,r)=>{var i;const s=e.$hostElement$,o=ne("update",e.$cmpMeta$.$tagName$),a=s["s-rc"];n.style&&r&&we(e);const l=ne("render",e.$cmpMeta$.$tagName$);if(n.isDev&&(e.$flags$|=1024),n.hydrateServerSide?await ot(e,t,s,r):ot(e,t,s,r),n.isDev&&(e.$renderCount$=void 0===e.$renderCount$?1:e.$renderCount$+1,e.$flags$&=-1025),n.hydrateServerSide)try{pt(s),r&&(1&e.$cmpMeta$.$flags$?s["s-en"]="":2&e.$cmpMeta$.$flags$&&(s["s-en"]="c"))}catch(c){d(c,s)}if(n.asyncLoading&&a&&(a.map((e=>e())),s["s-rc"]=void 0),l(),o(),n.asyncLoading){const t=null!=(i=s["s-p"])?i:[],r=()=>at(e);0===t.length?r():(Promise.all(t).then(r),e.$flags$|=4,t.length=0)}else at(e)},ot=(e,t,r,i)=>{const s=!!n.allRenderFn,o=!!n.lazyLoad,a=!!n.taskQueue,l=!!n.updatable;try{if(t=(s||t.render)&&t.render(),l&&a&&(e.$flags$&=-17),(l||o)&&(e.$flags$|=2),n.hasRenderFn||n.reflect)if(n.vdomRender||n.reflect){if(n.hydrateServerSide)return Promise.resolve(t).then((t=>Je(e,t,i)));Je(e,t,i)}else{const i=r.shadowRoot;1&e.$cmpMeta$.$flags$?i.textContent=t:r.textContent=t}}catch(c){d(c,e.$hostElement$)}return null},at=e=>{const t=e.$cmpMeta$.$tagName$,r=e.$hostElement$,i=ne("postUpdate",t),s=n.lazyLoad?e.$lazyInstance$:r,o=e.$ancestorComponent$;n.cmpDidRender&&(n.isDev&&(e.$flags$|=1024),ut(s,"componentDidRender"),n.isDev&&(e.$flags$&=-1025)),ht(r,"componentDidRender"),64&e.$flags$?(n.cmpDidUpdate&&(n.isDev&&(e.$flags$|=1024),ut(s,"componentDidUpdate"),n.isDev&&(e.$flags$&=-1025)),ht(r,"componentDidUpdate"),i()):(e.$flags$|=64,n.asyncLoading&&n.cssAnnotations&&dt(r),n.cmpDidLoad&&(n.isDev&&(e.$flags$|=2048),ut(s,"componentDidLoad"),n.isDev&&(e.$flags$&=-2049)),ht(r,"componentDidLoad"),i(),n.asyncLoading&&(e.$onReadyResolve$(r),o||ct(t))),n.method&&n.lazyLoad&&e.$onInstanceResolve$(r),n.asyncLoading&&(e.$onRenderResolve$&&(e.$onRenderResolve$(),e.$onRenderResolve$=void 0),512&e.$flags$&&B((()=>tt(e,!1))),e.$flags$&=-517)},lt=e=>{if(n.updatable&&(a.isBrowser||a.isTesting)){const t=c(e),r=t.$hostElement$.isConnected;return r&&2===(18&t.$flags$)&&tt(t,!1),r}return!1},ct=e=>{n.cssAnnotations&&dt(A.documentElement),n.asyncQueue&&(E.$flags$|=2),B((()=>ye(M,"appload",{detail:{namespace:s}}))),n.profile&&performance.measure&&performance.measure(`[Stencil] ${s} initial load (by ${e})`,"st:app:start")},ut=(e,t,r)=>{if(e&&e[t])try{return e[t](r)}catch(i){d(i)}},ht=(e,t)=>{n.lifecycleDOMEvents&&ye(e,"stencil_"+t,{bubbles:!0,composed:!0,detail:{namespace:s}})},dt=e=>{var t,r;return n.hydratedClass?e.classList.add(null!=(t=n.hydratedSelectorName)?t:"hydrated"):n.hydratedAttribute?e.setAttribute(null!=(r=n.hydratedSelectorName)?r:"hydrated",""):void 0},pt=e=>{const t=e.children;if(null!=t)for(let r=0,i=t.length;r<i;r++){const e=t[r];"function"===typeof e.connectedCallback&&e.connectedCallback(),pt(e)}},ft=(e,t,r,i)=>{const s=c(e);if(n.lazyLoad&&!s)throw new Error(`Couldn't find host element for "${i.$tagName$}" as it is unknown to this Stencil runtime. This usually happens when integrating a 3rd party Stencil component with another Stencil component or application. Please reach out to the maintainers of the 3rd party Stencil component or report this on the Stencil Discord server (https://chat.stenciljs.com) or comment on this similar [GitHub issue](https://github.com/ionic-team/stencil/issues/5457).`);const o=n.lazyLoad?s.$hostElement$:e,a=s.$instanceValues$.get(t),l=s.$flags$,u=n.lazyLoad?s.$lazyInstance$:o;var h,p;h=r,p=i.$members$[t][0],r=null==h||q(h)?h:n.propBoolean&&4&p?"false"!==h&&(""===h||!!h):n.propNumber&&2&p?parseFloat(h):n.propString&&1&p?String(h):h;const f=Number.isNaN(a)&&Number.isNaN(r);if((!n.lazyLoad||!(8&l)||void 0===a)&&(r!==a&&!f)&&(s.$instanceValues$.set(t,r),n.isDev&&(1024&s.$flags$?m(`The state/prop "${t}" changed during rendering. This can potentially lead to infinite-loops and other bugs.`,"\nElement",o,"\nNew value",r,"\nOld value",a):2048&s.$flags$&&m(`The state/prop "${t}" changed during "componentDidLoad()", this triggers extra re-renders, try to setup on "componentWillLoad()"`,"\nElement",o,"\nNew value",r,"\nOld value",a)),!n.lazyLoad||u)){if(n.watchCallback&&i.$watchers$&&128&l){const e=i.$watchers$[t];e&&e.map((e=>{try{u[e](r,a,t)}catch(i){d(i,o)}}))}if(n.updatable&&2===(18&l)){if(n.cmpShouldUpdate&&u.componentShouldUpdate&&!1===u.componentShouldUpdate(r,a,t))return;tt(s,!1)}}},mt=(e,t,r)=>{var i,s;const o=e.prototype;if(n.formAssociated&&64&t.$flags$&&1&r&&T.forEach((e=>Object.defineProperty(o,e,{value(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=c(this),o=n.lazyLoad?s.$hostElement$:this,a=n.lazyLoad?s.$lazyInstance$:o;if(a){const t=a[e];"function"===typeof t&&t.call(a,...r)}else s.$onReadyPromise$.then((t=>{const i=t[e];"function"===typeof i&&i.call(t,...r)}))}}))),n.member&&t.$members$||n.watchCallback&&(t.$watchers$||e.watchers)){n.watchCallback&&e.watchers&&!t.$watchers$&&(t.$watchers$=e.watchers);const a=Object.entries(null!=(i=t.$members$)?i:{});if(a.map((e=>{let[i,[s]]=e;(n.prop||n.state)&&(31&s||(!n.lazyLoad||2&r)&&32&s)?Object.defineProperty(o,i,{get(){return e=i,c(this).$instanceValues$.get(e);var e},set(e){if(n.isDev){const e=c(this);0===(1&r)&&0===(e&&8&e.$flags$)&&0!==(31&s)&&0===(1024&s)&&m(`@Prop() "${i}" on <${t.$tagName$}> is immutable but was modified from within the component.\nMore information: https://stenciljs.com/docs/properties#prop-mutability`)}ft(this,i,e,t)},configurable:!0,enumerable:!0}):n.lazyLoad&&n.method&&1&r&&64&s&&Object.defineProperty(o,i,{value(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;const s=c(this);return null==(n=null==s?void 0:s.$onInstancePromise$)?void 0:n.then((()=>{var e;return null==(e=s.$lazyInstance$)?void 0:e[i](...t)}))}})})),n.observeAttribute&&(!n.lazyLoad||1&r)){const r=new Map;o.attributeChangedCallback=function(e,i,s){E.jmp((()=>{var a;const l=r.get(e);if(this.hasOwnProperty(l))s=this[l],delete this[l];else{if(o.hasOwnProperty(l)&&"number"===typeof this[l]&&this[l]==s)return;if(null==l){const r=c(this),o=null==r?void 0:r.$flags$;if(o&&!(8&o)&&128&o&&s!==i){const o=n.lazyLoad?r.$hostElement$:this,l=n.lazyLoad?r.$lazyInstance$:o,c=null==(a=t.$watchers$)?void 0:a[e];null==c||c.forEach((t=>{null!=l[t]&&l[t].call(l,s,i,e)}))}return}}this[l]=(null!==s||"boolean"!==typeof this[l])&&s}))},e.observedAttributes=Array.from(new Set([...Object.keys(null!=(s=t.$watchers$)?s:{}),...a.filter((e=>{let[t,r]=e;return 15&r[0]})).map((e=>{let[i,s]=e;var o;const a=s[1]||i;return r.set(a,i),n.reflect&&512&s[0]&&(null==(o=t.$attrsToReflect$)||o.push([i,a])),a}))]))}}return e},gt=async(e,t,i,s)=>{let o;if(0===(32&t.$flags$)){t.$flags$|=32;const c=i.$lazyBundleId$;if((n.lazyLoad||n.hydrateClientSide)&&c){const e=((e,t,i)=>{const s=e.$tagName$.replace(/-/g,"_"),o=e.$lazyBundleId$;if(n.isDev&&"string"!==typeof o)return void f(`Trying to lazily load component <${e.$tagName$}> with style mode "${t.$modeName$}", but it does not exist.`);if(!o)return;const a=!n.hotModuleReplacement&&g.get(o);return a?a[s]:r(29976)(`./${o}.entry.js${n.hotModuleReplacement&&i?"?s-hmr="+i:""}`).then((e=>(n.hotModuleReplacement||g.set(o,e),e[s])),d)})(i,t,s);if(e&&"then"in e){const r=(a=`st:load:${i.$tagName$}:${t.$modeName$}`,l=`[Stencil] Load module for <${i.$tagName$}>`,n.profile&&performance.mark?(0===performance.getEntriesByName(a,"mark").length&&performance.mark(a),()=>{0===performance.getEntriesByName(l,"measure").length&&performance.measure(l,a)}):()=>{});o=await e,r()}else o=e;if(!o)throw new Error(`Constructor for "${i.$tagName$}#${t.$modeName$}" was not found`);n.member&&!o.isProxied&&(n.watchCallback&&(i.$watchers$=o.watchers),mt(o,i,2),o.isProxied=!0);const c=ne("createInstance",i.$tagName$);n.member&&(t.$flags$|=8);try{new o(t)}catch(h){d(h)}n.member&&(t.$flags$&=-9),n.watchCallback&&(t.$flags$|=128),c(),yt(t.$lazyInstance$)}else{o=e.constructor;const r=e.localName;customElements.whenDefined(r).then((()=>t.$flags$|=128))}if(n.style&&o&&o.style){let s;"string"===typeof o.style?s=o.style:n.mode&&"string"!==typeof o.style&&(t.$modeName$=me(e),t.$modeName$&&(s=o.style[t.$modeName$]),n.hydrateServerSide&&t.$modeName$&&e.setAttribute("s-mode",t.$modeName$));const a=xe(i,t.$modeName$);if(!y.has(a)){const e=ne("registerStyles",i.$tagName$);!n.hydrateServerSide&&n.shadowDom&&n.shadowDomShim&&8&i.$flags$&&(s=await r.e(8505).then(r.bind(r,48505)).then((e=>e.scopeCss(s,a)))),ve(a,s,!!(1&i.$flags$)),e()}}}var a,l;const c=t.$ancestorComponent$,u=()=>tt(t,!0);n.asyncLoading&&c&&c["s-rc"]?c["s-rc"].push(u):u()},yt=e=>{n.lazyLoad&&n.connectedCallback&&ut(e,"connectedCallback")},_t=e=>{if(0===(1&E.$flags$)){const t=c(e),r=t.$cmpMeta$,i=ne("connectedCallback",r.$tagName$);if(n.hostListenerTargetParent&&Ut(e,t,r.$listeners$,!0),1&t.$flags$)Ut(e,t,r.$listeners$,!1),(null==t?void 0:t.$lazyInstance$)?yt(t.$lazyInstance$):(null==t?void 0:t.$onReadyPromise$)&&t.$onReadyPromise$.then((()=>yt(t.$lazyInstance$)));else{let i;if(t.$flags$|=1,n.hydrateClientSide&&(i=e.getAttribute(v),i)){if(n.shadowDom&&R&&1&r.$flags$){const t=n.mode?be(e.shadowRoot,r,e.getAttribute("s-mode")):be(e.shadowRoot,r);e.classList.remove(t+"-h",t+"-s")}((e,t,r,i)=>{const s=ne("hydrateClient",t),o=e.shadowRoot,a=[],l=n.shadowDom&&o?[]:null,c=i.$vnode$=oe(t,null);E.$orgLocNodes$||fe(A.body,E.$orgLocNodes$=new Map),e[v]=r,e.removeAttribute(v),pe(c,a,[],l,e,e,r),a.map((e=>{const r=e.$hostId$+"."+e.$nodeId$,i=E.$orgLocNodes$.get(r),n=e.$elm$;i&&R&&""===i["s-en"]&&i.parentNode.insertBefore(n,i.nextSibling),o||(n["s-hn"]=t,i&&(n["s-ol"]=i,n["s-ol"]["s-nr"]=n)),E.$orgLocNodes$.delete(r)})),n.shadowDom&&o&&l.map((e=>{e&&o.appendChild(e)})),s()})(e,r.$tagName$,i,t)}if(n.slotRelocation&&!i&&(n.hydrateServerSide||(n.slot||n.shadowDom)&&12&r.$flags$)&&vt(e),n.asyncLoading){let r=e;for(;r=r.parentNode||r.host;)if(n.hydrateClientSide&&1===r.nodeType&&r.hasAttribute("s-id")&&r["s-p"]||r["s-p"]){et(t,t.$ancestorComponent$=r);break}}n.prop&&!n.hydrateServerSide&&r.$members$&&Object.entries(r.$members$).map((t=>{let[r,[i]]=t;if(31&i&&e.hasOwnProperty(r)){const t=e[r];delete e[r],e[r]=t}})),n.initializeNextTick?B((()=>gt(e,t,r))):gt(e,t,r)}i()}},vt=e=>{const t=e["s-cr"]=A.createComment(n.isDebug?`content-ref (host=${e.localName})`:"");t["s-cn"]=!0,We(e,t,e.firstChild)},bt=e=>{n.lazyLoad&&n.disconnectedCallback&&ut(e,"disconnectedCallback"),n.cmpDidUnload&&ut(e,"componentDidUnload")},wt=async e=>{if(0===(1&E.$flags$)){const t=c(e);n.hostListener&&t.$rmListeners$&&(t.$rmListeners$.map((e=>e())),t.$rmListeners$=void 0),n.lazyLoad?(null==t?void 0:t.$lazyInstance$)?bt(t.$lazyInstance$):(null==t?void 0:t.$onReadyPromise$)&&t.$onReadyPromise$.then((()=>bt(t.$lazyInstance$))):bt(e)}},xt=(e,t)=>{St(e),Tt(e),Ct(e),At(e),Pt(e),Et(e),Rt(e),Ot(e),It(e,t),Mt(e)},St=e=>{const t=e.cloneNode;e.cloneNode=function(e){const r=this,i=!!n.shadowDom&&(r.shadowRoot&&R),s=t.call(r,!!i&&e);if(n.slot&&!i&&e){let e,t,i=0;const o=["s-id","s-cr","s-lr","s-rc","s-sc","s-p","s-cn","s-sr","s-sn","s-hn","s-ol","s-nr","s-si","s-rf","s-scs"];for(;i<r.childNodes.length;i++)e=r.childNodes[i]["s-nr"],t=o.every((e=>!r.childNodes[i][e])),e&&(n.appendChildSlotFix&&s.__appendChild?s.__appendChild(e.cloneNode(!0)):s.appendChild(e.cloneNode(!0))),t&&s.appendChild(r.childNodes[i].cloneNode(!0))}return s}},Tt=e=>{e.__appendChild=e.appendChild,e.appendChild=function(e){const t=e["s-sn"]=Nt(e),r=Dt(this.childNodes,t,this.tagName);if(r){const i=Ft(r,t),n=i[i.length-1],s=We(n.parentNode,e,n.nextSibling);return He(this),s}return this.__appendChild(e)}},Mt=e=>{e.__removeChild=e.removeChild,e.removeChild=function(e){if(e&&"undefined"!==typeof e["s-sn"]){const t=Dt(this.childNodes,e["s-sn"],this.tagName);if(t){const r=Ft(t,e["s-sn"]).find((t=>t===e));if(r)return r.remove(),void He(this)}}return this.__removeChild(e)}},At=e=>{const t=e.prepend;e.prepend=function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];r.forEach((e=>{"string"===typeof e&&(e=this.ownerDocument.createTextNode(e));const r=e["s-sn"]=Nt(e),i=Dt(this.childNodes,r,this.tagName);if(i){const t=document.createTextNode("");t["s-nr"]=e,i["s-cr"].parentNode.__appendChild(t),e["s-ol"]=t;const n=Ft(i,r)[0];return We(n.parentNode,e,n.nextSibling)}return 1===e.nodeType&&e.getAttribute("slot")&&(e.hidden=!0),t.call(this,e)}))}},Ct=e=>{e.append=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach((e=>{"string"===typeof e&&(e=this.ownerDocument.createTextNode(e)),this.appendChild(e)}))}},Et=e=>{const t=e.insertAdjacentHTML;e.insertAdjacentHTML=function(e,r){if("afterbegin"!==e&&"beforeend"!==e)return t.call(this,e,r);const i=this.ownerDocument.createElement("_");let n;if(i.innerHTML=r,"afterbegin"===e)for(;n=i.firstChild;)this.prepend(n);else if("beforeend"===e)for(;n=i.firstChild;)this.append(n)}},Rt=e=>{e.insertAdjacentText=function(e,t){this.insertAdjacentHTML(e,t)}},Pt=e=>{const t=e.insertAdjacentElement;e.insertAdjacentElement=function(e,r){return"afterbegin"!==e&&"beforeend"!==e?t.call(this,e,r):"afterbegin"===e?(this.prepend(r),r):"beforeend"===e?(this.append(r),r):r}},Ot=e=>{const t=Object.getOwnPropertyDescriptor(Node.prototype,"textContent");Object.defineProperty(e,"__textContent",t),n.experimentalScopedSlotChanges?Object.defineProperty(e,"textContent",{get(){return" "+Lt(this.childNodes).map((e=>{var t,r;const i=[];let n=e.nextSibling;for(;n&&n["s-sn"]===e["s-sn"];)3!==n.nodeType&&1!==n.nodeType||i.push(null!=(r=null==(t=n.textContent)?void 0:t.trim())?r:""),n=n.nextSibling;return i.filter((e=>""!==e)).join(" ")})).filter((e=>""!==e)).join(" ")+" "},set(e){Lt(this.childNodes).forEach((t=>{let r=t.nextSibling;for(;r&&r["s-sn"]===t["s-sn"];){const e=r;r=r.nextSibling,e.remove()}if(""===t["s-sn"]){const r=this.ownerDocument.createTextNode(e);r["s-sn"]="",We(t.parentElement,r,t.nextSibling)}else t.remove()}))}}):Object.defineProperty(e,"textContent",{get(){var e;const t=Dt(this.childNodes,"",this.tagName);return 3===(null==(e=null==t?void 0:t.nextSibling)?void 0:e.nodeType)?t.nextSibling.textContent:t?t.textContent:this.__textContent},set(e){var t;const r=Dt(this.childNodes,"",this.tagName);if(3===(null==(t=null==r?void 0:r.nextSibling)?void 0:t.nodeType))r.nextSibling.textContent=e;else if(r)r.textContent=e;else{this.__textContent=e;const t=this["s-cr"];t&&We(this,t,this.firstChild)}}})},It=(e,t)=>{class r extends Array{item(e){return this[e]}}if(8&t.$flags$){const t=e.__lookupGetter__("childNodes");Object.defineProperty(e,"children",{get(){return this.childNodes.map((e=>1===e.nodeType))}}),Object.defineProperty(e,"childElementCount",{get:()=>e.children.length}),Object.defineProperty(e,"childNodes",{get(){const e=t.call(this);if(0===(1&E.$flags$)&&2&c(this).$flags$){const t=new r;for(let r=0;r<e.length;r++){const i=e[r]["s-nr"];i&&t.push(i)}return t}return r.from(e)}})}},Lt=e=>{const t=[];for(const r of Array.from(e))r["s-sr"]&&t.push(r),t.push(...Lt(r.childNodes));return t},Nt=e=>e["s-sn"]||1===e.nodeType&&e.getAttribute("slot")||"",Dt=(e,t,r)=>{let i,n=0;for(;n<e.length;n++){if(i=e[n],i["s-sr"]&&i["s-sn"]===t&&i["s-hn"]===r)return i;if(i=Dt(i.childNodes,t,r),i)return i}return null},Ft=(e,t)=>{const r=[e];for(;(e=e.nextSibling)&&e["s-sn"]===t;)r.push(e);return r},kt=(e,t)=>{const r={$flags$:t[0],$tagName$:t[1]};n.member&&(r.$members$=t[2]),n.hostListener&&(r.$listeners$=t[3]),n.watchCallback&&(r.$watchers$=e.$watchers$),n.reflect&&(r.$attrsToReflect$=[]),n.shadowDom&&!R&&1&r.$flags$&&(r.$flags$|=8),n.experimentalSlotFixes?n.scoped&&2&r.$flags$&&xt(e.prototype,r):(n.slotChildNodesFix&&It(e.prototype,r),n.cloneNodeFix&&St(e.prototype),n.appendChildSlotFix&&Tt(e.prototype),n.scopedSlotTextContentFix&&2&r.$flags$&&Ot(e.prototype));const i=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){u(this,r)},connectedCallback(){const e=c(this);Ut(this,e,r.$listeners$,!1),_t(this),n.connectedCallback&&i&&i.call(this)},disconnectedCallback(){wt(this),n.disconnectedCallback&&s&&s.call(this)},__attachShadow(){if(R)if(this.shadowRoot){if("open"!==this.shadowRoot.mode)throw new Error(`Unable to re-use existing shadow root for ${r.$tagName$}! Mode is set to ${this.shadowRoot.mode} but Stencil only supports open shadow roots.`)}else n.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(16&r.$flags$)}):this.attachShadow({mode:"open"});else this.shadowRoot=this}}),e.is=r.$tagName$,mt(e,r,3)},zt=(e,t)=>t,Ut=(e,t,r,i)=>{n.hostListener&&r&&(n.hostListenerTargetParent&&(r=i?r.filter((e=>{let[t]=e;return 32&t})):r.filter((e=>{let[t]=e;return!(32&t)}))),r.map((r=>{let[i,s,o]=r;const a=n.hostListenerTarget?Bt(e,i):e,l=Vt(t,o),c=jt(i);E.ael(a,s,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push((()=>E.rel(a,s,l,c)))})))},Vt=(e,t)=>r=>{var i;try{n.lazyLoad?256&e.$flags$?null==(i=e.$lazyInstance$)||i[t](r):(e.$queuedListeners$=e.$queuedListeners$||[]).push([t,r]):e.$hostElement$[t](r)}catch(s){d(s)}},Bt=(e,t)=>n.hostListenerTargetDocument&&4&t?A:n.hostListenerTargetWindow&&8&t?M:n.hostListenerTargetBody&&16&t?A.body:n.hostListenerTargetParent&&32&t&&e.parentElement?e.parentElement:e,jt=e=>P?{passive:0!==(1&e),capture:0!==(2&e)}:0!==(2&e)},24241:(e,t,r)=>{"use strict";r.d(t,{c9:()=>hi,mQ:()=>ie,oh:()=>j,bo:()=>F});class i extends Error{}class n extends i{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class s extends i{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class o extends i{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class a extends i{}class l extends i{constructor(e){super(`Invalid unit ${e}`)}}class c extends i{}class u extends i{constructor(){super("Zone is an abstract class")}}const h="numeric",d="short",p="long",f={year:h,month:h,day:h},m={year:h,month:d,day:h},g={year:h,month:d,day:h,weekday:d},y={year:h,month:p,day:h},_={year:h,month:p,day:h,weekday:p},v={hour:h,minute:h},b={hour:h,minute:h,second:h},w={hour:h,minute:h,second:h,timeZoneName:d},x={hour:h,minute:h,second:h,timeZoneName:p},S={hour:h,minute:h,hourCycle:"h23"},T={hour:h,minute:h,second:h,hourCycle:"h23"},M={hour:h,minute:h,second:h,hourCycle:"h23",timeZoneName:d},A={hour:h,minute:h,second:h,hourCycle:"h23",timeZoneName:p},C={year:h,month:h,day:h,hour:h,minute:h},E={year:h,month:h,day:h,hour:h,minute:h,second:h},R={year:h,month:d,day:h,hour:h,minute:h},P={year:h,month:d,day:h,hour:h,minute:h,second:h},O={year:h,month:d,day:h,weekday:d,hour:h,minute:h},I={year:h,month:p,day:h,hour:h,minute:h,timeZoneName:d},L={year:h,month:p,day:h,hour:h,minute:h,second:h,timeZoneName:d},N={year:h,month:p,day:h,weekday:p,hour:h,minute:h,timeZoneName:p},D={year:h,month:p,day:h,weekday:p,hour:h,minute:h,second:h,timeZoneName:p};class F{get type(){throw new u}get name(){throw new u}get ianaName(){return this.name}get isUniversal(){throw new u}offsetName(e,t){throw new u}formatOffset(e,t){throw new u}offset(e){throw new u}equals(e){throw new u}get isValid(){throw new u}}let k=null;class z extends F{static get instance(){return null===k&&(k=new z),k}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,t){let{format:r,locale:i}=t;return Je(e,r,i)}formatOffset(e,t){return tt(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return"system"===e.type}get isValid(){return!0}}let U={};const V={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};let B={};class j extends F{static create(e){return B[e]||(B[e]=new j(e)),B[e]}static resetCache(){B={},U={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(t){return!1}}constructor(e){super(),this.zoneName=e,this.valid=j.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,t){let{format:r,locale:i}=t;return Je(e,r,i,this.name)}formatOffset(e,t){return tt(this.offset(e),t)}offset(e){const t=new Date(e);if(isNaN(t))return NaN;const r=(i=this.name,U[i]||(U[i]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:i,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),U[i]);var i;let[n,s,o,a,l,c,u]=r.formatToParts?function(e,t){const r=e.formatToParts(t),i=[];for(let n=0;n<r.length;n++){const{type:e,value:t}=r[n],s=V[e];"era"===e?i[s]=t:Pe(s)||(i[s]=parseInt(t,10))}return i}(r,t):function(e,t){const r=e.format(t).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,n,s,o,a,l,c,u]=i;return[o,n,s,a,l,c,u]}(r,t);"BC"===a&&(n=1-Math.abs(n));let h=+t;const d=h%1e3;return h-=d>=0?d:1e3+d,(qe({year:n,month:s,day:o,hour:24===l?0:l,minute:c,second:u,millisecond:0})-h)/6e4}equals(e){return"iana"===e.type&&e.name===this.name}get isValid(){return this.valid}}let H={};let G={};function Z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=JSON.stringify([e,t]);let i=G[r];return i||(i=new Intl.DateTimeFormat(e,t),G[r]=i),i}let $={};let q={};let W=null;let Y={};function X(e,t,r,i){const n=e.listingMode();return"error"===n?null:"en"===n?r(t):i(t)}class J{constructor(e,t,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:i,floor:n,...s}=r;if(!t||Object.keys(s).length>0){const t={useGrouping:!1,...r};r.padTo>0&&(t.minimumIntegerDigits=r.padTo),this.inf=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=JSON.stringify([e,t]);let i=$[r];return i||(i=new Intl.NumberFormat(e,t),$[r]=i),i}(e,t)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}return Ue(this.floor?Math.floor(e):He(e,3),this.padTo)}}class K{constructor(e,t,r){let i;if(this.opts=r,this.originalZone=void 0,this.opts.timeZone)this.dt=e;else if("fixed"===e.zone.type){const t=e.offset/60*-1,r=t>=0?`Etc/GMT+${t}`:`Etc/GMT${t}`;0!==e.offset&&j.create(r).valid?(i=r,this.dt=e):(i="UTC",this.dt=0===e.offset?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else"system"===e.zone.type?this.dt=e:"iana"===e.zone.type?(this.dt=e,i=e.zone.name):(i="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||i,this.dtf=Z(t,n)}format(){return this.originalZone?this.formatToParts().map((e=>{let{value:t}=e;return t})).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map((e=>{if("timeZoneName"===e.type){const t=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...e,value:t}}return e})):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class Q{constructor(e,t,r){this.opts={style:"long",...r},!t&&Le()&&(this.rtf=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{base:r,...i}=t,n=JSON.stringify([e,i]);let s=q[n];return s||(s=new Intl.RelativeTimeFormat(e,t),q[n]=s),s}(e,r))}format(e,t){return this.rtf?this.rtf.format(e,t):function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"always",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=-1===["hours","minutes","seconds"].indexOf(e);if("auto"===r&&s){const r="days"===e;switch(t){case 1:return r?"tomorrow":`next ${n[e][0]}`;case-1:return r?"yesterday":`last ${n[e][0]}`;case 0:return r?"today":`this ${n[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=1===a,c=n[e],u=i?l?c[1]:c[2]||c[1]:l?n[e][0]:e;return o?`${a} ${u} ago`:`in ${a} ${u}`}(t,e,this.opts.numeric,"long"!==this.opts.style)}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}}const ee={firstDay:1,minimalDays:4,weekend:[6,7]};class te{static fromOpts(e){return te.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=e||fe.defaultLocale,o=s||(n?"en-US":W||(W=(new Intl.DateTimeFormat).resolvedOptions().locale,W)),a=t||fe.defaultNumberingSystem,l=r||fe.defaultOutputCalendar,c=ke(i)||fe.defaultWeekSettings;return new te(o,a,l,c,s)}static resetCache(){W=null,G={},$={},q={}}static fromObject(){let{locale:e,numberingSystem:t,outputCalendar:r,weekSettings:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return te.create(e,t,r,i)}constructor(e,t,r,i,n){const[s,o,a]=function(e){const t=e.indexOf("-x-");-1!==t&&(e=e.substring(0,t));const r=e.indexOf("-u-");if(-1===r)return[e];{let t,n;try{t=Z(e).resolvedOptions(),n=e}catch(i){const s=e.substring(0,r);t=Z(s).resolvedOptions(),n=s}const{numberingSystem:s,calendar:o}=t;return[n,s,o]}}(e);this.locale=s,this.numberingSystem=t||o||null,this.outputCalendar=r||a||null,this.weekSettings=i,this.intl=function(e,t,r){return r||t?(e.includes("-u-")||(e+="-u"),r&&(e+=`-ca-${r}`),t&&(e+=`-nu-${t}`),e):e}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){var e;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(e=this).numberingSystem||"latn"===e.numberingSystem)&&("latn"===e.numberingSystem||!e.locale||e.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),t=(null===this.numberingSystem||"latn"===this.numberingSystem)&&(null===this.outputCalendar||"gregory"===this.outputCalendar);return e&&t?"en":"intl"}clone(e){return e&&0!==Object.getOwnPropertyNames(e).length?te.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,ke(e.weekSettings)||this.weekSettings,e.defaultToEN||!1):this}redefaultToEN(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.clone({...e,defaultToEN:!0})}redefaultToSystem(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.clone({...e,defaultToEN:!1})}months(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return X(this,e,ot,(()=>{const r=t?{month:e,day:"numeric"}:{month:e},i=t?"format":"standalone";return this.monthsCache[i][e]||(this.monthsCache[i][e]=function(e){const t=[];for(let r=1;r<=12;r++){const i=hi.utc(2009,r,1);t.push(e(i))}return t}((e=>this.extract(e,r,"month")))),this.monthsCache[i][e]}))}weekdays(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return X(this,e,ut,(()=>{const r=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},i=t?"format":"standalone";return this.weekdaysCache[i][e]||(this.weekdaysCache[i][e]=function(e){const t=[];for(let r=1;r<=7;r++){const i=hi.utc(2016,11,13+r);t.push(e(i))}return t}((e=>this.extract(e,r,"weekday")))),this.weekdaysCache[i][e]}))}meridiems(){return X(this,void 0,(()=>ht),(()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[hi.utc(2016,11,13,9),hi.utc(2016,11,13,19)].map((t=>this.extract(t,e,"dayperiod")))}return this.meridiemCache}))}eras(e){return X(this,e,mt,(()=>{const t={era:e};return this.eraCache[e]||(this.eraCache[e]=[hi.utc(-40,1,1),hi.utc(2017,1,1)].map((e=>this.extract(e,t,"era")))),this.eraCache[e]}))}extract(e,t,r){const i=this.dtFormatter(e,t).formatToParts().find((e=>e.type.toLowerCase()===r));return i?i.value:null}numberFormatter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new J(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new K(e,this.intl,t)}relFormatter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Q(this.intl,this.isEnglish(),e)}listFormatter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=JSON.stringify([e,t]);let i=H[r];return i||(i=new Intl.ListFormat(e,t),H[r]=i),i}(this.intl,e)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:Ne()?function(e){let t=Y[e];if(!t){const r=new Intl.Locale(e);t="getWeekInfo"in r?r.getWeekInfo():r.weekInfo,Y[e]=t}return t}(this.locale):ee}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let re=null;class ie extends F{static get utcInstance(){return null===re&&(re=new ie(0)),re}static instance(e){return 0===e?ie.utcInstance:new ie(e)}static parseSpecifier(e){if(e){const t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new ie(Ke(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${tt(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${tt(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return tt(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return"fixed"===e.type&&e.fixed===this.fixed}get isValid(){return!0}}class ne extends F{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function se(e,t){if(Pe(e)||null===e)return t;if(e instanceof F)return e;if(function(e){return"string"===typeof e}(e)){const r=e.toLowerCase();return"default"===r?t:"local"===r||"system"===r?z.instance:"utc"===r||"gmt"===r?ie.utcInstance:ie.parseSpecifier(r)||j.create(e)}return Oe(e)?ie.instance(e):"object"===typeof e&&"offset"in e&&"function"===typeof e.offset?e:new ne(e)}let oe,ae=()=>Date.now(),le="system",ce=null,ue=null,he=null,de=60,pe=null;class fe{static get now(){return ae}static set now(e){ae=e}static set defaultZone(e){le=e}static get defaultZone(){return se(le,z.instance)}static get defaultLocale(){return ce}static set defaultLocale(e){ce=e}static get defaultNumberingSystem(){return ue}static set defaultNumberingSystem(e){ue=e}static get defaultOutputCalendar(){return he}static set defaultOutputCalendar(e){he=e}static get defaultWeekSettings(){return pe}static set defaultWeekSettings(e){pe=ke(e)}static get twoDigitCutoffYear(){return de}static set twoDigitCutoffYear(e){de=e%100}static get throwOnInvalid(){return oe}static set throwOnInvalid(e){oe=e}static resetCaches(){te.resetCache(),j.resetCache()}}class me{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const ge=[0,31,59,90,120,151,181,212,243,273,304,334],ye=[0,31,60,91,121,152,182,213,244,274,305,335];function _e(e,t){return new me("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function ve(e,t,r){const i=new Date(Date.UTC(e,t-1,r));e<100&&e>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const n=i.getUTCDay();return 0===n?7:n}function be(e,t,r){return r+(Ge(e)?ye:ge)[t-1]}function we(e,t){const r=Ge(e)?ye:ge,i=r.findIndex((e=>e<t));return{month:i+1,day:t-r[i]}}function xe(e,t){return(e-t+7)%7+1}function Se(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const{year:i,month:n,day:s}=e,o=be(i,n,s),a=xe(ve(i,n,s),r);let l,c=Math.floor((o-a+14-t)/7);return c<1?(l=i-1,c=Ye(l,t,r)):c>Ye(i,t,r)?(l=i+1,c=1):l=i,{weekYear:l,weekNumber:c,weekday:a,...rt(e)}}function Te(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const{weekYear:i,weekNumber:n,weekday:s}=e,o=xe(ve(i,1,t),r),a=Ze(i);let l,c=7*n+s-o-7+t;c<1?(l=i-1,c+=Ze(l)):c>a?(l=i+1,c-=Ze(i)):l=i;const{month:u,day:h}=we(l,c);return{year:l,month:u,day:h,...rt(e)}}function Me(e){const{year:t,month:r,day:i}=e;return{year:t,ordinal:be(t,r,i),...rt(e)}}function Ae(e){const{year:t,ordinal:r}=e,{month:i,day:n}=we(t,r);return{year:t,month:i,day:n,...rt(e)}}function Ce(e,t){if(!Pe(e.localWeekday)||!Pe(e.localWeekNumber)||!Pe(e.localWeekYear)){if(!Pe(e.weekday)||!Pe(e.weekNumber)||!Pe(e.weekYear))throw new a("Cannot mix locale-based week fields with ISO-based week fields");return Pe(e.localWeekday)||(e.weekday=e.localWeekday),Pe(e.localWeekNumber)||(e.weekNumber=e.localWeekNumber),Pe(e.localWeekYear)||(e.weekYear=e.localWeekYear),delete e.localWeekday,delete e.localWeekNumber,delete e.localWeekYear,{minDaysInFirstWeek:t.getMinDaysInFirstWeek(),startOfWeek:t.getStartOfWeek()}}return{minDaysInFirstWeek:4,startOfWeek:1}}function Ee(e){const t=Ie(e.year),r=ze(e.month,1,12),i=ze(e.day,1,$e(e.year,e.month));return t?r?!i&&_e("day",e.day):_e("month",e.month):_e("year",e.year)}function Re(e){const{hour:t,minute:r,second:i,millisecond:n}=e,s=ze(t,0,23)||24===t&&0===r&&0===i&&0===n,o=ze(r,0,59),a=ze(i,0,59),l=ze(n,0,999);return s?o?a?!l&&_e("millisecond",n):_e("second",i):_e("minute",r):_e("hour",t)}function Pe(e){return"undefined"===typeof e}function Oe(e){return"number"===typeof e}function Ie(e){return"number"===typeof e&&e%1===0}function Le(){try{return"undefined"!==typeof Intl&&!!Intl.RelativeTimeFormat}catch(e){return!1}}function Ne(){try{return"undefined"!==typeof Intl&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch(e){return!1}}function De(e,t,r){if(0!==e.length)return e.reduce(((e,i)=>{const n=[t(i),i];return e&&r(e[0],n[0])===e[0]?e:n}),null)[1]}function Fe(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function ke(e){if(null==e)return null;if("object"!==typeof e)throw new c("Week settings must be an object");if(!ze(e.firstDay,1,7)||!ze(e.minimalDays,1,7)||!Array.isArray(e.weekend)||e.weekend.some((e=>!ze(e,1,7))))throw new c("Invalid week settings");return{firstDay:e.firstDay,minimalDays:e.minimalDays,weekend:Array.from(e.weekend)}}function ze(e,t,r){return Ie(e)&&e>=t&&e<=r}function Ue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;let r;return r=e<0?"-"+(""+-e).padStart(t,"0"):(""+e).padStart(t,"0"),r}function Ve(e){return Pe(e)||null===e||""===e?void 0:parseInt(e,10)}function Be(e){return Pe(e)||null===e||""===e?void 0:parseFloat(e)}function je(e){if(!Pe(e)&&null!==e&&""!==e){const t=1e3*parseFloat("0."+e);return Math.floor(t)}}function He(e,t){const r=10**t;return(arguments.length>2&&void 0!==arguments[2]&&arguments[2]?Math.trunc:Math.round)(e*r)/r}function Ge(e){return e%4===0&&(e%100!==0||e%400===0)}function Ze(e){return Ge(e)?366:365}function $e(e,t){const r=function(e,t){return e-t*Math.floor(e/t)}(t-1,12)+1;return 2===r?Ge(e+(t-r)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function qe(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(e.year,e.month-1,e.day)),+t}function We(e,t,r){return-xe(ve(e,1,t),r)+t-1}function Ye(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=We(e,t,r),n=We(e+1,t,r);return(Ze(e)-i+n)/7}function Xe(e){return e>99?e:e>fe.twoDigitCutoffYear?1900+e:2e3+e}function Je(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const n=new Date(e),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(s.timeZone=i);const o={timeZoneName:t,...s},a=new Intl.DateTimeFormat(r,o).formatToParts(n).find((e=>"timezonename"===e.type.toLowerCase()));return a?a.value:null}function Ke(e,t){let r=parseInt(e,10);Number.isNaN(r)&&(r=0);const i=parseInt(t,10)||0;return 60*r+(r<0||Object.is(r,-0)?-i:i)}function Qe(e){const t=Number(e);if("boolean"===typeof e||""===e||Number.isNaN(t))throw new c(`Invalid unit value ${e}`);return t}function et(e,t){const r={};for(const i in e)if(Fe(e,i)){const n=e[i];if(void 0===n||null===n)continue;r[t(i)]=Qe(n)}return r}function tt(e,t){const r=Math.trunc(Math.abs(e/60)),i=Math.trunc(Math.abs(e%60)),n=e>=0?"+":"-";switch(t){case"short":return`${n}${Ue(r,2)}:${Ue(i,2)}`;case"narrow":return`${n}${r}${i>0?`:${i}`:""}`;case"techie":return`${n}${Ue(r,2)}${Ue(i,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function rt(e){return function(e,t){return t.reduce(((t,r)=>(t[r]=e[r],t)),{})}(e,["hour","minute","second","millisecond"])}const it=["January","February","March","April","May","June","July","August","September","October","November","December"],nt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],st=["J","F","M","A","M","J","J","A","S","O","N","D"];function ot(e){switch(e){case"narrow":return[...st];case"short":return[...nt];case"long":return[...it];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const at=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],lt=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],ct=["M","T","W","T","F","S","S"];function ut(e){switch(e){case"narrow":return[...ct];case"short":return[...lt];case"long":return[...at];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const ht=["AM","PM"],dt=["Before Christ","Anno Domini"],pt=["BC","AD"],ft=["B","A"];function mt(e){switch(e){case"narrow":return[...ft];case"short":return[...pt];case"long":return[...dt];default:return null}}function gt(e,t){let r="";for(const i of e)i.literal?r+=i.val:r+=t(i.val);return r}const yt={D:f,DD:m,DDD:y,DDDD:_,t:v,tt:b,ttt:w,tttt:x,T:S,TT:T,TTT:M,TTTT:A,f:C,ff:R,fff:I,ffff:N,F:E,FF:P,FFF:L,FFFF:D};class _t{static create(e){return new _t(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}static parseFormat(e){let t=null,r="",i=!1;const n=[];for(let s=0;s<e.length;s++){const o=e.charAt(s);"'"===o?(r.length>0&&n.push({literal:i||/^\s+$/.test(r),val:r}),t=null,r="",i=!i):i||o===t?r+=o:(r.length>0&&n.push({literal:/^\s+$/.test(r),val:r}),r=o,t=o)}return r.length>0&&n.push({literal:i||/^\s+$/.test(r),val:r}),n}static macroTokenToFormatOpts(e){return yt[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem());return this.systemLoc.dtFormatter(e,{...this.opts,...t}).format()}dtFormatter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.loc.dtFormatter(e,{...this.opts,...t})}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.opts.forceSimple)return Ue(e,t);const r={...this.opts};return t>0&&(r.padTo=t),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,t){const r="en"===this.loc.listingMode(),i=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,n=(t,r)=>this.loc.extract(e,t,r),s=t=>e.isOffsetFixed&&0===e.offset&&t.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,t.format):"",o=()=>r?function(e){return ht[e.hour<12?0:1]}(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),a=(t,i)=>r?function(e,t){return ot(t)[e.month-1]}(e,t):n(i?{month:t}:{month:t,day:"numeric"},"month"),l=(t,i)=>r?function(e,t){return ut(t)[e.weekday-1]}(e,t):n(i?{weekday:t}:{weekday:t,month:"long",day:"numeric"},"weekday"),c=t=>{const r=_t.macroTokenToFormatOpts(t);return r?this.formatWithSystemDefault(e,r):t},u=t=>r?function(e,t){return mt(t)[e.year<0?0:1]}(e,t):n({era:t},"era");return gt(_t.parseFormat(t),(t=>{switch(t){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return s({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return s({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return s({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return o();case"d":return i?n({day:"numeric"},"day"):this.num(e.day);case"dd":return i?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":case"E":return this.num(e.weekday);case"ccc":return l("short",!0);case"cccc":return l("long",!0);case"ccccc":return l("narrow",!0);case"EEE":return l("short",!1);case"EEEE":return l("long",!1);case"EEEEE":return l("narrow",!1);case"L":return i?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return i?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return a("short",!0);case"LLLL":return a("long",!0);case"LLLLL":return a("narrow",!0);case"M":return i?n({month:"numeric"},"month"):this.num(e.month);case"MM":return i?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return a("short",!1);case"MMMM":return a("long",!1);case"MMMMM":return a("narrow",!1);case"y":return i?n({year:"numeric"},"year"):this.num(e.year);case"yy":return i?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return i?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return i?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return u("short");case"GG":return u("long");case"GGGGG":return u("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return c(t)}}))}formatDurationFromString(e,t){const r=e=>{switch(e[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},i=_t.parseFormat(t),n=i.reduce(((e,t)=>{let{literal:r,val:i}=t;return r?e:e.concat(i)}),[]);return gt(i,(e=>t=>{const i=r(t);return i?this.num(e.get(i),t.length):t})(e.shiftTo(...n.map(r).filter((e=>e)))))}}const vt=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function bt(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const i=t.reduce(((e,t)=>e+t.source),"");return RegExp(`^${i}$`)}function wt(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return e=>t.reduce(((t,r)=>{let[i,n,s]=t;const[o,a,l]=r(e,s);return[{...i,...o},a||n,l]}),[{},null,1]).slice(0,2)}function xt(e){if(null==e)return[null,null];for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(const[n,s]of r){const t=n.exec(e);if(t)return s(t)}return[null,null]}function St(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(e,r)=>{const i={};let n;for(n=0;n<t.length;n++)i[t[n]]=Ve(e[r+n]);return[i,null,r+n]}}const Tt=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Mt=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,At=RegExp(`${Mt.source}${`(?:${Tt.source}?(?:\\[(${vt.source})\\])?)?`}`),Ct=RegExp(`(?:T${At.source})?`),Et=St("weekYear","weekNumber","weekDay"),Rt=St("year","ordinal"),Pt=RegExp(`${Mt.source} ?(?:${Tt.source}|(${vt.source}))?`),Ot=RegExp(`(?: ${Pt.source})?`);function It(e,t,r){const i=e[t];return Pe(i)?r:Ve(i)}function Lt(e,t){return[{hours:It(e,t,0),minutes:It(e,t+1,0),seconds:It(e,t+2,0),milliseconds:je(e[t+3])},null,t+4]}function Nt(e,t){const r=!e[t]&&!e[t+1],i=Ke(e[t+1],e[t+2]);return[{},r?null:ie.instance(i),t+3]}function Dt(e,t){return[{},e[t]?j.create(e[t]):null,t+1]}const Ft=RegExp(`^T?${Mt.source}$`),kt=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function zt(e){const[t,r,i,n,s,o,a,l,c]=e,u="-"===t[0],h=l&&"-"===l[0],d=function(e){return void 0!==e&&(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||e&&u)?-e:e};return[{years:d(Be(r)),months:d(Be(i)),weeks:d(Be(n)),days:d(Be(s)),hours:d(Be(o)),minutes:d(Be(a)),seconds:d(Be(l),"-0"===l),milliseconds:d(je(c),h)}]}const Ut={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Vt(e,t,r,i,n,s,o){const a={year:2===t.length?Xe(Ve(t)):Ve(t),month:nt.indexOf(r)+1,day:Ve(i),hour:Ve(n),minute:Ve(s)};return o&&(a.second=Ve(o)),e&&(a.weekday=e.length>3?at.indexOf(e)+1:lt.indexOf(e)+1),a}const Bt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function jt(e){const[,t,r,i,n,s,o,a,l,c,u,h]=e,d=Vt(t,n,i,r,s,o,a);let p;return p=l?Ut[l]:c?0:Ke(u,h),[d,new ie(p)]}const Ht=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Gt=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Zt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function $t(e){const[,t,r,i,n,s,o,a]=e;return[Vt(t,n,i,r,s,o,a),ie.utcInstance]}function qt(e){const[,t,r,i,n,s,o,a]=e;return[Vt(t,a,r,i,n,s,o),ie.utcInstance]}const Wt=bt(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Ct),Yt=bt(/(\d{4})-?W(\d\d)(?:-?(\d))?/,Ct),Xt=bt(/(\d{4})-?(\d{3})/,Ct),Jt=bt(At),Kt=wt((function(e,t){return[{year:It(e,t),month:It(e,t+1,1),day:It(e,t+2,1)},null,t+3]}),Lt,Nt,Dt),Qt=wt(Et,Lt,Nt,Dt),er=wt(Rt,Lt,Nt,Dt),tr=wt(Lt,Nt,Dt);const rr=wt(Lt);const ir=bt(/(\d{4})-(\d\d)-(\d\d)/,Ot),nr=bt(Pt),sr=wt(Lt,Nt,Dt);const or="Invalid Duration",ar={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},lr={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6},...ar},cr=365.2425,ur=30.436875,hr={years:{quarters:4,months:12,weeks:52.1775,days:cr,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:4.3481250000000005,days:ur,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3},...ar},dr=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],pr=dr.slice(0).reverse();function fr(e,t){const r={values:arguments.length>2&&void 0!==arguments[2]&&arguments[2]?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new yr(r)}function mr(e,t){let r=t.milliseconds??0;for(const i of pr.slice(1))t[i]&&(r+=t[i]*e[i].milliseconds);return r}function gr(e,t){const r=mr(e,t)<0?-1:1;dr.reduceRight(((i,n)=>{if(Pe(t[n]))return i;if(i){const s=t[i]*r,o=e[n][i],a=Math.floor(s/o);t[n]+=a*r,t[i]-=a*o*r}return n}),null),dr.reduce(((r,i)=>{if(Pe(t[i]))return r;if(r){const n=t[r]%1;t[r]-=n,t[i]+=n*e[r][i]}return i}),null)}class yr{constructor(e){const t="longterm"===e.conversionAccuracy||!1;let r=t?hr:lr;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||te.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,t){return yr.fromObject({milliseconds:e},t)}static fromObject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null==e||"object"!==typeof e)throw new c("Duration.fromObject: argument expected to be an object, got "+(null===e?"null":typeof e));return new yr({values:et(e,yr.normalizeUnit),loc:te.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(Oe(e))return yr.fromMillis(e);if(yr.isDuration(e))return e;if("object"===typeof e)return yr.fromObject(e);throw new c(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){const[r]=function(e){return xt(e,[kt,zt])}(e);return r?yr.fromObject(r,t):yr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){const[r]=function(e){return xt(e,[Ft,rr])}(e);return r?yr.fromObject(r,t):yr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)throw new c("need to specify a reason the Duration is invalid");const r=e instanceof me?e:new me(e,t);if(fe.throwOnInvalid)throw new o(r);return new yr({invalid:r})}static normalizeUnit(e){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e?e.toLowerCase():e];if(!t)throw new l(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={...t,floor:!1!==t.round&&!1!==t.floor};return this.isValid?_t.create(this.loc,r).formatDurationFromString(this,e):or}toHuman(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isValid)return or;const t=dr.map((t=>{const r=this.values[t];return Pe(r)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:t.slice(0,-1)}).format(r)})).filter((e=>e));return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(t)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return 0!==this.years&&(e+=this.years+"Y"),0===this.months&&0===this.quarters||(e+=this.months+3*this.quarters+"M"),0!==this.weeks&&(e+=this.weeks+"W"),0!==this.days&&(e+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(e+="T"),0!==this.hours&&(e+=this.hours+"H"),0!==this.minutes&&(e+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(e+=He(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===e&&(e+="T0S"),e}toISOTime(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isValid)return null;const t=this.toMillis();if(t<0||t>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1};return hi.fromMillis(t,{zone:"UTC"}).toISOTime(e)}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?mr(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const t=yr.fromDurationLike(e),r={};for(const i of dr)(Fe(t.values,i)||Fe(this.values,i))&&(r[i]=t.get(i)+this.get(i));return fr(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const t=yr.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;const t={};for(const r of Object.keys(this.values))t[r]=Qe(e(this.values[r],r));return fr(this,{values:t},!0)}get(e){return this[yr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;return fr(this,{values:{...this.values,...et(e,yr.normalizeUnit)}})}reconfigure(){let{locale:e,numberingSystem:t,conversionAccuracy:r,matrix:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return fr(this,{loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:i,conversionAccuracy:r})}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return gr(this.matrix,e),fr(this,{values:e},!0)}rescale(){if(!this.isValid)return this;return fr(this,{values:function(e){const t={};for(const[r,i]of Object.entries(e))0!==i&&(t[r]=i);return t}(this.normalize().shiftToAll().toObject())},!0)}shiftTo(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(!this.isValid)return this;if(0===t.length)return this;t=t.map((e=>yr.normalizeUnit(e)));const i={},n={},s=this.toObject();let o;for(const a of dr)if(t.indexOf(a)>=0){o=a;let e=0;for(const r in n)e+=this.matrix[r][a]*n[r],n[r]=0;Oe(s[a])&&(e+=s[a]);const t=Math.trunc(e);i[a]=t,n[a]=(1e3*e-1e3*t)/1e3}else Oe(s[a])&&(n[a]=s[a]);for(const a in n)0!==n[a]&&(i[o]+=a===o?n[a]:n[a]/this.matrix[o][a]);return gr(this.matrix,i),fr(this,{values:i},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const t of Object.keys(this.values))e[t]=0===this.values[t]?0:-this.values[t];return fr(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid)return!1;if(!this.loc.equals(e.loc))return!1;for(const i of dr)if(t=this.values[i],r=e.values[i],!(void 0===t||0===t?void 0===r||0===r:t===r))return!1;var t,r;return!0}}const _r="Invalid Interval";class vr{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)throw new c("need to specify a reason the Interval is invalid");const r=e instanceof me?e:new me(e,t);if(fe.throwOnInvalid)throw new s(r);return new vr({invalid:r})}static fromDateTimes(e,t){const r=di(e),i=di(t),n=function(e,t){return e&&e.isValid?t&&t.isValid?t<e?vr.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null:vr.invalid("missing or invalid end"):vr.invalid("missing or invalid start")}(r,i);return null==n?new vr({start:r,end:i}):n}static after(e,t){const r=yr.fromDurationLike(t),i=di(e);return vr.fromDateTimes(i,i.plus(r))}static before(e,t){const r=yr.fromDurationLike(t),i=di(e);return vr.fromDateTimes(i.minus(r),i)}static fromISO(e,t){const[r,i]=(e||"").split("/",2);if(r&&i){let e,n,s,o;try{e=hi.fromISO(r,t),n=e.isValid}catch(i){n=!1}try{s=hi.fromISO(i,t),o=s.isValid}catch(i){o=!1}if(n&&o)return vr.fromDateTimes(e,s);if(n){const r=yr.fromISO(i,t);if(r.isValid)return vr.after(e,r)}else if(o){const e=yr.fromISO(r,t);if(e.isValid)return vr.before(s,e)}}return vr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"milliseconds";return this.isValid?this.toDuration(e).get(e):NaN}count(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"milliseconds",t=arguments.length>1?arguments[1]:void 0;if(!this.isValid)return NaN;const r=this.start.startOf(e,t);let i;return i=t?.useLocaleWeeks?this.end.reconfigure({locale:r.locale}):this.end,i=i.startOf(e,t),Math.floor(i.diff(r,e).get(e))+(i.valueOf()!==this.end.valueOf())}hasSame(e){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,e))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return!!this.isValid&&this.s>e}isBefore(e){return!!this.isValid&&this.e<=e}contains(e){return!!this.isValid&&(this.s<=e&&this.e>e)}set(){let{start:e,end:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.isValid?vr.fromDateTimes(e||this.s,t||this.e):this}splitAt(){if(!this.isValid)return[];for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const i=t.map(di).filter((e=>this.contains(e))).sort(((e,t)=>e.toMillis()-t.toMillis())),n=[];let{s:s}=this,o=0;for(;s<this.e;){const e=i[o]||this.e,t=+e>+this.e?this.e:e;n.push(vr.fromDateTimes(s,t)),s=t,o+=1}return n}splitBy(e){const t=yr.fromDurationLike(e);if(!this.isValid||!t.isValid||0===t.as("milliseconds"))return[];let r,{s:i}=this,n=1;const s=[];for(;i<this.e;){const e=this.start.plus(t.mapUnits((e=>e*n)));r=+e>+this.e?this.e:e,s.push(vr.fromDateTimes(i,r)),i=r,n+=1}return s}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return!!this.isValid&&+this.e===+e.s}abutsEnd(e){return!!this.isValid&&+e.e===+this.s}engulfs(e){return!!this.isValid&&(this.s<=e.s&&this.e>=e.e)}equals(e){return!(!this.isValid||!e.isValid)&&(this.s.equals(e.s)&&this.e.equals(e.e))}intersection(e){if(!this.isValid)return this;const t=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return t>=r?null:vr.fromDateTimes(t,r)}union(e){if(!this.isValid)return this;const t=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return vr.fromDateTimes(t,r)}static merge(e){const[t,r]=e.sort(((e,t)=>e.s-t.s)).reduce(((e,t)=>{let[r,i]=e;return i?i.overlaps(t)||i.abutsStart(t)?[r,i.union(t)]:[r.concat([i]),t]:[r,t]}),[[],null]);return r&&t.push(r),t}static xor(e){let t=null,r=0;const i=[],n=e.map((e=>[{time:e.s,type:"s"},{time:e.e,type:"e"}])),s=Array.prototype.concat(...n).sort(((e,t)=>e.time-t.time));for(const o of s)r+="s"===o.type?1:-1,1===r?t=o.time:(t&&+t!==+o.time&&i.push(vr.fromDateTimes(t,o.time)),t=null);return vr.merge(i)}difference(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return vr.xor([this].concat(t)).map((e=>this.intersection(e))).filter((e=>e&&!e.isEmpty()))}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:_r}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.isValid?_t.create(this.s.loc.clone(t),e).formatInterval(this):_r}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:_r}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:_r}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:_r}toFormat(e){let{separator:t=" \u2013 "}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:_r}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):yr.invalid(this.invalidReason)}mapEndpoints(e){return vr.fromDateTimes(e(this.s),e(this.e))}}class br{static hasDST(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fe.defaultZone;const t=hi.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return j.isValidZone(e)}static normalizeZone(e){return se(e,fe.defaultZone)}static getStartOfWeek(){let{locale:e=null,locObj:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t||te.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek(){let{locale:e=null,locObj:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t||te.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays(){let{locale:e=null,locObj:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t||te.create(e)).getWeekendDays().slice()}static months(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"long",{locale:t=null,numberingSystem:r=null,locObj:i=null,outputCalendar:n="gregory"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(i||te.create(t,r,n)).months(e)}static monthsFormat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"long",{locale:t=null,numberingSystem:r=null,locObj:i=null,outputCalendar:n="gregory"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(i||te.create(t,r,n)).months(e,!0)}static weekdays(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"long",{locale:t=null,numberingSystem:r=null,locObj:i=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(i||te.create(t,r,null)).weekdays(e)}static weekdaysFormat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"long",{locale:t=null,numberingSystem:r=null,locObj:i=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(i||te.create(t,r,null)).weekdays(e,!0)}static meridiems(){let{locale:e=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return te.create(e).meridiems()}static eras(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"short",{locale:t=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return te.create(t,null,"gregory").eras(e)}static features(){return{relative:Le(),localeWeek:Ne()}}}function wr(e,t){const r=e=>e.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(t)-r(e);return Math.floor(yr.fromMillis(i).as("days"))}function xr(e,t,r,i){let[n,s,o,a]=function(e,t,r){const i=[["years",(e,t)=>t.year-e.year],["quarters",(e,t)=>t.quarter-e.quarter+4*(t.year-e.year)],["months",(e,t)=>t.month-e.month+12*(t.year-e.year)],["weeks",(e,t)=>{const r=wr(e,t);return(r-r%7)/7}],["days",wr]],n={},s=e;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,n[l]=c(e,t),a=s.plus(n),a>t?(n[l]--,(e=s.plus(n))>t&&(a=e,n[l]--,e=s.plus(n))):e=a);return[e,n,a,o]}(e,t,r);const l=t-n,c=r.filter((e=>["hours","minutes","seconds","milliseconds"].indexOf(e)>=0));0===c.length&&(o<t&&(o=n.plus({[a]:1})),o!==n&&(s[a]=(s[a]||0)+l/(o-n)));const u=yr.fromObject(s,i);return c.length>0?yr.fromMillis(l,i).shiftTo(...c).plus(u):u}const Sr={arab:"[\u0660-\u0669]",arabext:"[\u06f0-\u06f9]",bali:"[\u1b50-\u1b59]",beng:"[\u09e6-\u09ef]",deva:"[\u0966-\u096f]",fullwide:"[\uff10-\uff19]",gujr:"[\u0ae6-\u0aef]",hanidec:"[\u3007|\u4e00|\u4e8c|\u4e09|\u56db|\u4e94|\u516d|\u4e03|\u516b|\u4e5d]",khmr:"[\u17e0-\u17e9]",knda:"[\u0ce6-\u0cef]",laoo:"[\u0ed0-\u0ed9]",limb:"[\u1946-\u194f]",mlym:"[\u0d66-\u0d6f]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0b66-\u0b6f]",tamldec:"[\u0be6-\u0bef]",telu:"[\u0c66-\u0c6f]",thai:"[\u0e50-\u0e59]",tibt:"[\u0f20-\u0f29]",latn:"\\d"},Tr={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Mr=Sr.hanidec.replace(/[\[|\]]/g,"").split("");function Ar(e){let{numberingSystem:t}=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new RegExp(`${Sr[t||"latn"]}${r}`)}const Cr="missing Intl.DateTimeFormat.formatToParts support";function Er(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e;return{regex:e,deser:e=>{let[r]=e;return t(function(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let r=0;r<e.length;r++){const i=e.charCodeAt(r);if(-1!==e[r].search(Sr.hanidec))t+=Mr.indexOf(e[r]);else for(const e in Tr){const[r,n]=Tr[e];i>=r&&i<=n&&(t+=i-r)}}return parseInt(t,10)}return t}(r))}}}const Rr=`[ ${String.fromCharCode(160)}]`,Pr=new RegExp(Rr,"g");function Or(e){return e.replace(/\./g,"\\.?").replace(Pr,Rr)}function Ir(e){return e.replace(/\./g,"").replace(Pr," ").toLowerCase()}function Lr(e,t){return null===e?null:{regex:RegExp(e.map(Or).join("|")),deser:r=>{let[i]=r;return e.findIndex((e=>Ir(i)===Ir(e)))+t}}}function Nr(e,t){return{regex:e,deser:e=>{let[,t,r]=e;return Ke(t,r)},groups:t}}function Dr(e){return{regex:e,deser:e=>{let[t]=e;return t}}}const Fr={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};let kr=null;function zr(e,t){return Array.prototype.concat(...e.map((e=>function(e,t){if(e.literal)return e;const r=Vr(_t.macroTokenToFormatOpts(e.val),t);return null==r||r.includes(void 0)?e:r}(e,t))))}function Ur(e,t,r){const i=zr(_t.parseFormat(r),e),n=i.map((t=>function(e,t){const r=Ar(t),i=Ar(t,"{2}"),n=Ar(t,"{3}"),s=Ar(t,"{4}"),o=Ar(t,"{6}"),a=Ar(t,"{1,2}"),l=Ar(t,"{1,3}"),c=Ar(t,"{1,6}"),u=Ar(t,"{1,9}"),h=Ar(t,"{2,4}"),d=Ar(t,"{4,6}"),p=e=>{return{regex:RegExp((t=e.val,t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:e=>{let[t]=e;return t},literal:!0};var t},f=(f=>{if(e.literal)return p(f);switch(f.val){case"G":return Lr(t.eras("short"),0);case"GG":return Lr(t.eras("long"),0);case"y":return Er(c);case"yy":case"kk":return Er(h,Xe);case"yyyy":case"kkkk":return Er(s);case"yyyyy":return Er(d);case"yyyyyy":return Er(o);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return Er(a);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return Er(i);case"MMM":return Lr(t.months("short",!0),1);case"MMMM":return Lr(t.months("long",!0),1);case"LLL":return Lr(t.months("short",!1),1);case"LLLL":return Lr(t.months("long",!1),1);case"o":case"S":return Er(l);case"ooo":case"SSS":return Er(n);case"u":return Dr(u);case"uu":return Dr(a);case"uuu":case"E":case"c":return Er(r);case"a":return Lr(t.meridiems(),0);case"EEE":return Lr(t.weekdays("short",!1),1);case"EEEE":return Lr(t.weekdays("long",!1),1);case"ccc":return Lr(t.weekdays("short",!0),1);case"cccc":return Lr(t.weekdays("long",!0),1);case"Z":case"ZZ":return Nr(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return Nr(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return Dr(/[a-z_+-/]{1,256}?/i);case" ":return Dr(/[^\S\n\r]/);default:return p(f)}})(e)||{invalidReason:Cr};return f.token=e,f}(t,e))),s=n.find((e=>e.invalidReason));if(s)return{input:t,tokens:i,invalidReason:s.invalidReason};{const[e,r]=function(e){return[`^${e.map((e=>e.regex)).reduce(((e,t)=>`${e}(${t.source})`),"")}$`,e]}(n),s=RegExp(e,"i"),[o,l]=function(e,t,r){const i=e.match(t);if(i){const e={};let t=1;for(const n in r)if(Fe(r,n)){const s=r[n],o=s.groups?s.groups+1:1;!s.literal&&s.token&&(e[s.token.val[0]]=s.deser(i.slice(t,t+o))),t+=o}return[i,e]}return[i,{}]}(t,s,r),[c,u,h]=l?function(e){let t,r=null;return Pe(e.z)||(r=j.create(e.z)),Pe(e.Z)||(r||(r=new ie(e.Z)),t=e.Z),Pe(e.q)||(e.M=3*(e.q-1)+1),Pe(e.h)||(e.h<12&&1===e.a?e.h+=12:12===e.h&&0===e.a&&(e.h=0)),0===e.G&&e.y&&(e.y=-e.y),Pe(e.u)||(e.S=je(e.u)),[Object.keys(e).reduce(((t,r)=>{const i=(e=>{switch(e){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(r);return i&&(t[i]=e[r]),t}),{}),r,t]}(l):[null,null,void 0];if(Fe(l,"a")&&Fe(l,"H"))throw new a("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:i,regex:s,rawMatches:o,matches:l,result:c,zone:u,specificOffset:h}}}function Vr(e,t){if(!e)return null;const r=_t.create(t,e).dtFormatter((kr||(kr=hi.fromMillis(1555555555555)),kr)),i=r.formatToParts(),n=r.resolvedOptions();return i.map((t=>function(e,t,r){const{type:i,value:n}=e;if("literal"===i){const e=/^\s+$/.test(n);return{literal:!e,val:e?" ":n}}const s=t[i];let o=i;"hour"===i&&(o=null!=t.hour12?t.hour12?"hour12":"hour24":null!=t.hourCycle?"h11"===t.hourCycle||"h12"===t.hourCycle?"hour12":"hour24":r.hour12?"hour12":"hour24");let a=Fr[o];if("object"===typeof a&&(a=a[s]),a)return{literal:!1,val:a}}(t,e,n)))}const Br="Invalid DateTime",jr=864e13;function Hr(e){return new me("unsupported zone",`the zone "${e.name}" is not supported`)}function Gr(e){return null===e.weekData&&(e.weekData=Se(e.c)),e.weekData}function Zr(e){return null===e.localWeekData&&(e.localWeekData=Se(e.c,e.loc.getMinDaysInFirstWeek(),e.loc.getStartOfWeek())),e.localWeekData}function $r(e,t){const r={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new hi({...r,...t,old:r})}function qr(e,t,r){let i=e-60*t*1e3;const n=r.offset(i);if(t===n)return[i,t];i-=60*(n-t)*1e3;const s=r.offset(i);return n===s?[i,n]:[e-60*Math.min(n,s)*1e3,Math.max(n,s)]}function Wr(e,t){const r=new Date(e+=60*t*1e3);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function Yr(e,t,r){return qr(qe(e),t,r)}function Xr(e,t){const r=e.o,i=e.c.year+Math.trunc(t.years),n=e.c.month+Math.trunc(t.months)+3*Math.trunc(t.quarters),s={...e.c,year:i,month:n,day:Math.min(e.c.day,$e(i,n))+Math.trunc(t.days)+7*Math.trunc(t.weeks)},o=yr.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=qe(s);let[l,c]=qr(a,r,e.zone);return 0!==o&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function Jr(e,t,r,i,n,s){const{setZone:o,zone:a}=r;if(e&&0!==Object.keys(e).length||t){const i=t||a,n=hi.fromObject(e,{...r,zone:i,specificOffset:s});return o?n:n.setZone(a)}return hi.invalid(new me("unparsable",`the input "${n}" can't be parsed as ${i}`))}function Kr(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.isValid?_t.create(te.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(e,t):null}function Qr(e,t){const r=e.c.year>9999||e.c.year<0;let i="";return r&&e.c.year>=0&&(i+="+"),i+=Ue(e.c.year,r?6:4),t?(i+="-",i+=Ue(e.c.month),i+="-",i+=Ue(e.c.day)):(i+=Ue(e.c.month),i+=Ue(e.c.day)),i}function ei(e,t,r,i,n,s){let o=Ue(e.c.hour);return t?(o+=":",o+=Ue(e.c.minute),0===e.c.millisecond&&0===e.c.second&&r||(o+=":")):o+=Ue(e.c.minute),0===e.c.millisecond&&0===e.c.second&&r||(o+=Ue(e.c.second),0===e.c.millisecond&&i||(o+=".",o+=Ue(e.c.millisecond,3))),n&&(e.isOffsetFixed&&0===e.offset&&!s?o+="Z":e.o<0?(o+="-",o+=Ue(Math.trunc(-e.o/60)),o+=":",o+=Ue(Math.trunc(-e.o%60))):(o+="+",o+=Ue(Math.trunc(e.o/60)),o+=":",o+=Ue(Math.trunc(e.o%60)))),s&&(o+="["+e.zone.ianaName+"]"),o}const ti={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},ri={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},ii={ordinal:1,hour:0,minute:0,second:0,millisecond:0},ni=["year","month","day","hour","minute","second","millisecond"],si=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],oi=["year","ordinal","hour","minute","second","millisecond"];function ai(e){switch(e.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return function(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new l(e);return t}(e)}}function li(e,t){const r=se(t.zone,fe.defaultZone),i=te.fromObject(t),n=fe.now();let s,o;if(Pe(e.year))s=n;else{for(const r of ni)Pe(e[r])&&(e[r]=ti[r]);const t=Ee(e)||Re(e);if(t)return hi.invalid(t);const i=r.offset(n);[s,o]=Yr(e,i,r)}return new hi({ts:s,zone:r,loc:i,o:o})}function ci(e,t,r){const i=!!Pe(r.round)||r.round,n=(e,n)=>{e=He(e,i||r.calendary?0:2,!0);return t.loc.clone(r).relFormatter(r).format(e,n)},s=i=>r.calendary?t.hasSame(e,i)?0:t.startOf(i).diff(e.startOf(i),i).get(i):t.diff(e,i).get(i);if(r.unit)return n(s(r.unit),r.unit);for(const o of r.units){const e=s(o);if(Math.abs(e)>=1)return n(e,o)}return n(e>t?-0:0,r.units[r.units.length-1])}function ui(e){let t,r={};return e.length>0&&"object"===typeof e[e.length-1]?(r=e[e.length-1],t=Array.from(e).slice(0,e.length-1)):t=Array.from(e),[r,t]}class hi{constructor(e){const t=e.zone||fe.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new me("invalid input"):null)||(t.isValid?null:Hr(t));this.ts=Pe(e.ts)?fe.now():e.ts;let i=null,n=null;if(!r){if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[i,n]=[e.old.c,e.old.o];else{const e=t.offset(this.ts);i=Wr(this.ts,e),r=Number.isNaN(i.year)?new me("invalid input"):null,i=r?null:i,n=r?null:e}}this._zone=t,this.loc=e.loc||te.create(),this.invalid=r,this.weekData=null,this.localWeekData=null,this.c=i,this.o=n,this.isLuxonDateTime=!0}static now(){return new hi({})}static local(){const[e,t]=ui(arguments),[r,i,n,s,o,a,l]=t;return li({year:r,month:i,day:n,hour:s,minute:o,second:a,millisecond:l},e)}static utc(){const[e,t]=ui(arguments),[r,i,n,s,o,a,l]=t;return e.zone=ie.utcInstance,li({year:r,month:i,day:n,hour:s,minute:o,second:a,millisecond:l},e)}static fromJSDate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=function(e){return"[object Date]"===Object.prototype.toString.call(e)}(e)?e.valueOf():NaN;if(Number.isNaN(r))return hi.invalid("invalid input");const i=se(t.zone,fe.defaultZone);return i.isValid?new hi({ts:r,zone:i,loc:te.fromObject(t)}):hi.invalid(Hr(i))}static fromMillis(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Oe(e))return e<-jr||e>jr?hi.invalid("Timestamp out of range"):new hi({ts:e,zone:se(t.zone,fe.defaultZone),loc:te.fromObject(t)});throw new c(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Oe(e))return new hi({ts:1e3*e,zone:se(t.zone,fe.defaultZone),loc:te.fromObject(t)});throw new c("fromSeconds requires a numerical input")}static fromObject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=e||{};const r=se(t.zone,fe.defaultZone);if(!r.isValid)return hi.invalid(Hr(r));const i=te.fromObject(t),n=et(e,ai),{minDaysInFirstWeek:s,startOfWeek:o}=Ce(n,i),l=fe.now(),c=Pe(t.specificOffset)?r.offset(l):t.specificOffset,u=!Pe(n.ordinal),h=!Pe(n.year),d=!Pe(n.month)||!Pe(n.day),p=h||d,f=n.weekYear||n.weekNumber;if((p||u)&&f)throw new a("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(d&&u)throw new a("Can't mix ordinal dates with month/day");const m=f||n.weekday&&!p;let g,y,_=Wr(l,c);m?(g=si,y=ri,_=Se(_,s,o)):u?(g=oi,y=ii,_=Me(_)):(g=ni,y=ti);let v=!1;for(const a of g){Pe(n[a])?n[a]=v?y[a]:_[a]:v=!0}const b=m?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=Ie(e.weekYear),n=ze(e.weekNumber,1,Ye(e.weekYear,t,r)),s=ze(e.weekday,1,7);return i?n?!s&&_e("weekday",e.weekday):_e("week",e.weekNumber):_e("weekYear",e.weekYear)}(n,s,o):u?function(e){const t=Ie(e.year),r=ze(e.ordinal,1,Ze(e.year));return t?!r&&_e("ordinal",e.ordinal):_e("year",e.year)}(n):Ee(n),w=b||Re(n);if(w)return hi.invalid(w);const x=m?Te(n,s,o):u?Ae(n):n,[S,T]=Yr(x,c,r),M=new hi({ts:S,zone:r,o:T,loc:i});return n.weekday&&p&&e.weekday!==M.weekday?hi.invalid("mismatched weekday",`you can't specify both a weekday of ${n.weekday} and a date of ${M.toISO()}`):M}static fromISO(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[r,i]=function(e){return xt(e,[Wt,Kt],[Yt,Qt],[Xt,er],[Jt,tr])}(e);return Jr(r,i,t,"ISO 8601",e)}static fromRFC2822(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[r,i]=function(e){return xt(function(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(e),[Bt,jt])}(e);return Jr(r,i,t,"RFC 2822",e)}static fromHTTP(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[r,i]=function(e){return xt(e,[Ht,$t],[Gt,$t],[Zt,qt])}(e);return Jr(r,i,t,"HTTP",t)}static fromFormat(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(Pe(e)||Pe(t))throw new c("fromFormat requires an input string and a format");const{locale:i=null,numberingSystem:n=null}=r,s=te.fromOpts({locale:i,numberingSystem:n,defaultToEN:!0}),[o,a,l,u]=function(e,t,r){const{result:i,zone:n,specificOffset:s,invalidReason:o}=Ur(e,t,r);return[i,n,s,o]}(s,e,t);return u?hi.invalid(u):Jr(o,a,r,`format ${t}`,e,l)}static fromString(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return hi.fromFormat(e,t,r)}static fromSQL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[r,i]=function(e){return xt(e,[ir,Kt],[nr,sr])}(e);return Jr(r,i,t,"SQL",e)}static invalid(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)throw new c("need to specify a reason the DateTime is invalid");const r=e instanceof me?e:new me(e,t);if(fe.throwOnInvalid)throw new n(r);return new hi({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=Vr(e,te.fromObject(t));return r?r.map((e=>e?e.val:null)).join(""):null}static expandFormat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return zr(_t.parseFormat(e),te.fromObject(t)).map((e=>e.val)).join("")}get(e){return this[e]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Gr(this).weekYear:NaN}get weekNumber(){return this.isValid?Gr(this).weekNumber:NaN}get weekday(){return this.isValid?Gr(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?Zr(this).weekday:NaN}get localWeekNumber(){return this.isValid?Zr(this).weekNumber:NaN}get localWeekYear(){return this.isValid?Zr(this).weekYear:NaN}get ordinal(){return this.isValid?Me(this.c).ordinal:NaN}get monthShort(){return this.isValid?br.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?br.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?br.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?br.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,t=6e4,r=qe(this.c),i=this.zone.offset(r-e),n=this.zone.offset(r+e),s=this.zone.offset(r-i*t),o=this.zone.offset(r-n*t);if(s===o)return[this];const a=r-s*t,l=r-o*t,c=Wr(a,s),u=Wr(l,o);return c.hour===u.hour&&c.minute===u.minute&&c.second===u.second&&c.millisecond===u.millisecond?[$r(this,{ts:a}),$r(this,{ts:l})]:[this]}get isInLeapYear(){return Ge(this.year)}get daysInMonth(){return $e(this.year,this.month)}get daysInYear(){return this.isValid?Ze(this.year):NaN}get weeksInWeekYear(){return this.isValid?Ye(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?Ye(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{locale:t,numberingSystem:r,calendar:i}=_t.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:r,outputCalendar:i}}toUTC(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.setZone(ie.instance(e),t)}toLocal(){return this.setZone(fe.defaultZone)}setZone(e){let{keepLocalTime:t=!1,keepCalendarTime:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((e=se(e,fe.defaultZone)).equals(this.zone))return this;if(e.isValid){let i=this.ts;if(t||r){const t=e.offset(this.ts),r=this.toObject();[i]=Yr(r,t,e)}return $r(this,{ts:i,zone:e})}return hi.invalid(Hr(e))}reconfigure(){let{locale:e,numberingSystem:t,outputCalendar:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return $r(this,{loc:this.loc.clone({locale:e,numberingSystem:t,outputCalendar:r})})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=et(e,ai),{minDaysInFirstWeek:r,startOfWeek:i}=Ce(t,this.loc),n=!Pe(t.weekYear)||!Pe(t.weekNumber)||!Pe(t.weekday),s=!Pe(t.ordinal),o=!Pe(t.year),l=!Pe(t.month)||!Pe(t.day),c=o||l,u=t.weekYear||t.weekNumber;if((c||s)&&u)throw new a("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&s)throw new a("Can't mix ordinal dates with month/day");let h;n?h=Te({...Se(this.c,r,i),...t},r,i):Pe(t.ordinal)?(h={...this.toObject(),...t},Pe(t.day)&&(h.day=Math.min($e(h.year,h.month),h.day))):h=Ae({...Me(this.c),...t});const[d,p]=Yr(h,this.o,this.zone);return $r(this,{ts:d,o:p})}plus(e){if(!this.isValid)return this;return $r(this,Xr(this,yr.fromDurationLike(e)))}minus(e){if(!this.isValid)return this;return $r(this,Xr(this,yr.fromDurationLike(e).negate()))}startOf(e){let{useLocaleWeeks:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isValid)return this;const r={},i=yr.normalizeUnit(e);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0}if("weeks"===i)if(t){const e=this.loc.getStartOfWeek(),{weekday:t}=this;t<e&&(r.weekNumber=this.weekNumber-1),r.weekday=e}else r.weekday=1;if("quarters"===i){const e=Math.ceil(this.month/3);r.month=3*(e-1)+1}return this.set(r)}endOf(e,t){return this.isValid?this.plus({[e]:1}).startOf(e,t).minus(1):this}toFormat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.isValid?_t.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):Br}toLocaleString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.isValid?_t.create(this.loc.clone(t),e).formatDateTime(this):Br}toLocaleParts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.isValid?_t.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO(){let{format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:r=!1,includeOffset:i=!0,extendedZone:n=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isValid)return null;const s="extended"===e;let o=Qr(this,s);return o+="T",o+=ei(this,s,t,r,i,n),o}toISODate(){let{format:e="extended"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.isValid?Qr(this,"extended"===e):null}toISOWeekDate(){return Kr(this,"kkkk-'W'WW-c")}toISOTime(){let{suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:r=!0,includePrefix:i=!1,extendedZone:n=!1,format:s="extended"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.isValid?(i?"T":"")+ei(this,"extended"===s,t,e,r,n):null}toRFC2822(){return Kr(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return Kr(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Qr(this,!0):null}toSQLTime(){let{includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:r=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i="HH:mm:ss.SSS";return(t||e)&&(r&&(i+=" "),t?i+="z":e&&(i+="ZZ")),Kr(this,i,!0)}toSQL(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():Br}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isValid)return{};const t={...this.c};return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"milliseconds",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.isValid||!e.isValid)return yr.invalid("created by diffing an invalid DateTime");const i={locale:this.locale,numberingSystem:this.numberingSystem,...r},n=(a=t,Array.isArray(a)?a:[a]).map(yr.normalizeUnit),s=e.valueOf()>this.valueOf(),o=xr(s?this:e,s?e:this,n,i);var a;return s?o.negate():o}diffNow(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"milliseconds",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.diff(hi.now(),e,t)}until(e){return this.isValid?vr.fromDateTimes(this,e):this}hasSame(e,t,r){if(!this.isValid)return!1;const i=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(t,r)<=i&&i<=n.endOf(t,r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isValid)return null;const t=e.base||hi.fromObject({},{zone:this.zone}),r=e.padding?this<t?-e.padding:e.padding:0;let i=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(i=e.unit,n=void 0),ci(t,this.plus(r),{...e,numeric:"always",units:i,unit:n})}toRelativeCalendar(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.isValid?ci(e.base||hi.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(!t.every(hi.isDateTime))throw new c("min requires all arguments be DateTimes");return De(t,(e=>e.valueOf()),Math.min)}static max(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(!t.every(hi.isDateTime))throw new c("max requires all arguments be DateTimes");return De(t,(e=>e.valueOf()),Math.max)}static fromFormatExplain(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{locale:i=null,numberingSystem:n=null}=r;return Ur(te.fromOpts({locale:i,numberingSystem:n,defaultToEN:!0}),e,t)}static fromStringExplain(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return hi.fromFormatExplain(e,t,r)}static get DATE_SHORT(){return f}static get DATE_MED(){return m}static get DATE_MED_WITH_WEEKDAY(){return g}static get DATE_FULL(){return y}static get DATE_HUGE(){return _}static get TIME_SIMPLE(){return v}static get TIME_WITH_SECONDS(){return b}static get TIME_WITH_SHORT_OFFSET(){return w}static get TIME_WITH_LONG_OFFSET(){return x}static get TIME_24_SIMPLE(){return S}static get TIME_24_WITH_SECONDS(){return T}static get TIME_24_WITH_SHORT_OFFSET(){return M}static get TIME_24_WITH_LONG_OFFSET(){return A}static get DATETIME_SHORT(){return C}static get DATETIME_SHORT_WITH_SECONDS(){return E}static get DATETIME_MED(){return R}static get DATETIME_MED_WITH_SECONDS(){return P}static get DATETIME_MED_WITH_WEEKDAY(){return O}static get DATETIME_FULL(){return I}static get DATETIME_FULL_WITH_SECONDS(){return L}static get DATETIME_HUGE(){return N}static get DATETIME_HUGE_WITH_SECONDS(){return D}}function di(e){if(hi.isDateTime(e))return e;if(e&&e.valueOf&&Oe(e.valueOf()))return hi.fromJSDate(e);if(e&&"object"===typeof e)return hi.fromObject(e);throw new c(`Unknown datetime argument: ${e}, of type ${typeof e}`)}}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,r),s.exports}r.m=e,(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;r.t=function(i,n){if(1&n&&(i=this(i)),8&n)return i;if("object"===typeof i&&i){if(4&n&&i.__esModule)return i;if(16&n&&"function"===typeof i.then)return i}var s=Object.create(null);r.r(s);var o={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&i;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>o[e]=()=>i[e]));return o.default=()=>i,r.d(s,o),s}})(),r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,i)=>(r.f[i](e,t),t)),[])),r.u=e=>"static/js/"+e+"."+{78:"5480d3b4",126:"a05d7c88",156:"90306a2c",183:"acf37bfc",216:"35490219",225:"f8ee2911",239:"f8ac38cc",260:"5bb300a1",271:"78209d06",289:"6cf3b472",339:"5b7e4d8f",373:"8c3db71a",388:"c9f0ad29",438:"1630dfd0",440:"0e50831e",530:"9966b98d",550:"2a3766a3",623:"e8e47e2f",698:"7f21410b",709:"a40c205b",740:"7043c11a",765:"cbd0e818",792:"81063011",797:"014924e0",803:"2ffe0eac",904:"1a1814c5",920:"4c76710e",964:"40227eb3",982:"1c252af6",998:"a346eedc",1014:"73443c7a",1043:"eab14f8a",1047:"63e2f1f9",1109:"71627d83",1145:"d820c090",1167:"98aa47cb",1174:"73edb28c",1264:"d79f31e9",1297:"58dbc491",1307:"27d2cf20",1316:"b767fae1",1338:"190a5f04",1348:"b9765d3f",1365:"b2926dc5",1412:"3f613317",1414:"10ce3ead",1521:"a0b2afc0",1533:"f98f4016",1538:"c2571c7a",1625:"996a1e1f",1669:"5d84077c",1693:"b140e958",1721:"10e2f033",1734:"6a9ea4cc",1747:"0d7043d2",1830:"8d7c1d39",1835:"7a046e0d",1845:"27759185",1869:"b346dd43",1877:"e69ee0f0",1967:"bddfd45f",1985:"623ca192",1988:"37bafa0e",1993:"cdb7eab9",2003:"f0899236",2010:"fbbf55b7",2015:"e2304a3c",2028:"ea9f97a4",2043:"0ab61ed5",2111:"ebf9474d",2127:"c1e2e7ce",2148:"f792323d",2165:"308492df",2180:"290559bd",2205:"e234571e",2218:"6492dcdc",2225:"799c20a4",2229:"1cc08676",2339:"faced3fc",2362:"fbaaffad",2381:"2519a53f",2400:"3dc04bd3",2484:"b4058b54",2487:"ca9119ab",2520:"6b729f84",2544:"cb89cd07",2551:"94e2906a",2553:"3c210dd1",2583:"756f3cec",2585:"c5e85580",2593:"da11993a",2602:"91a59a86",2612:"cee91033",2623:"f3ed404f",2635:"aabafc34",2650:"36e69bb3",2665:"051027d0",2671:"c4943e07",2712:"c484ceb7",2713:"0a72f5ef",2777:"6d349c2e",2785:"74c04075",2797:"25926207",2818:"bce3c45b",2825:"2ff0843d",2866:"bbca48d6",2882:"aae8e548",2914:"bc4f8c9e",2925:"a56481fe",2946:"a3715f19",2951:"933441f5",2998:"4f4c38e8",3035:"5c1ee076",3065:"ac42d1e5",3078:"40ebeaaa",3106:"c4969bdb",3141:"a1aaa4b2",3146:"59de1b9a",3185:"dda9a25d",3218:"0494d50b",3245:"59ee259f",3263:"79ff4d37",3311:"104ef5b3",3318:"9da864ad",3337:"19b5fc24",3391:"5e1190de",3409:"5c83d8cb",3418:"a3bb6219",3431:"5f7edddc",3451:"217ba61f",3454:"c4ec9d26",3532:"2aa8e469",3537:"053c2906",3547:"1d9eba81",3555:"570591b1",3571:"6585b8b9",3617:"6a8d19aa",3620:"810d2ae2",3669:"b7c1e56c",3727:"82812627",3744:"b45c5256",3761:"fa652121",3778:"c0b0d895",3814:"db7303ce",3863:"f7393bf1",3874:"0ddc3b39",3875:"72fca547",3884:"593e333f",3993:"cdbed892",4001:"bd63a2ac",4027:"27d73d4d",4038:"1812a4ad",4050:"2d4f71a0",4075:"27f4dbe4",4088:"ba0de7b7",4113:"624ffe66",4176:"b12b0780",4279:"fb7ffba0",4337:"2c837e10",4369:"f620e19d",4374:"3642c84d",4397:"0860b1e1",4412:"e9115022",4458:"aa570f16",4476:"5c12f5d4",4489:"4060f941",4508:"8dcea8fe",4515:"426e32d1",4552:"8821ac39",4610:"a6718a15",4621:"a564df32",4679:"ff5d42a7",4713:"528a3ba2",4748:"575343a8",4795:"0ff48da0",4825:"128e8980",4884:"3e7afd90",4912:"0fdf4712",4933:"7ab68f81",4959:"5263ac69",4961:"8e5d49d7",5012:"0ff4e5bc",5016:"37f77b2c",5028:"1f9c6f4d",5039:"0b17d0ce",5044:"cd7b7ed7",5047:"ece972e0",5078:"13db28f0",5276:"4c515837",5288:"b7a916c7",5294:"079c372d",5295:"1f551dfa",5297:"9fcb1dc9",5303:"c434c4fa",5338:"0cf11377",5355:"1838347a",5370:"ca41ddc0",5376:"908b7b29",5454:"f8406eeb",5526:"23f24078",5556:"aeacd4b9",5562:"9d8c8eca",5617:"2ee37d64",5624:"2de72dfb",5665:"d5e72837",5674:"3bfe5c3c",5721:"f1c15924",5751:"608b6a01",5795:"695f5987",5811:"7e554a1c",5837:"e7e6165f",5840:"b1aa6588",5849:"d23b7f43",5908:"549c96f9",5955:"b4d9d7ad",5977:"e755769b",5995:"61e0d2e4",6037:"bf0f699d",6083:"a543e29f",6095:"8fa56eb0",6108:"7f459d33",6128:"fdca5589",6130:"d7d4666f",6203:"7a6117a3",6244:"ce7805a5",6246:"172a7575",6272:"bc160eee",6280:"fa3574ff",6289:"60ccf522",6333:"5337dcb8",6349:"5e5d788d",6382:"d30b9c27",6406:"0a458470",6419:"85d7ff7f",6427:"f08cd5aa",6443:"bcf4b9a0",6453:"3fde110a",6454:"3857ed27",6570:"c8aae53e",6588:"acc9fb81",6603:"fa8d172f",6688:"70192893",6785:"704e5351",6790:"38585438",6799:"15d2c774",6810:"6ea028f1",6814:"62517938",6821:"b2455b5a",6834:"c09d915b",6868:"93787a3e",6922:"1db6d4df",6964:"ce834aae",6999:"aba6a7e2",7004:"5674905f",7005:"53e4a23e",7028:"d9cc4f3f",7078:"62d61880",7118:"8088aa87",7119:"328a1cb8",7131:"bd85277f",7137:"0f6f3c7b",7179:"f250839d",7194:"3fd7acba",7216:"a838918c",7236:"80e4f139",7258:"3f7ff508",7307:"9329fb2b",7318:"a1fe2635",7359:"657d4a25",7385:"93a24da8",7416:"fb22f6ff",7421:"5bb3c717",7440:"b5b02c23",7480:"f786b81a",7567:"df67ea85",7628:"671b5b77",7657:"35579e91",7689:"d04e67b5",7751:"593c978a",7802:"aca74851",7814:"a2b62a03",7834:"00ba89f3",7855:"3a6b1d46",7858:"8e5340a0",7874:"77691a44",7879:"82c03cd1",7910:"266f2985",7919:"60ddcbc2",7928:"bb8a4998",7943:"44d9a2c2",8001:"33d1554c",8036:"e584032c",8108:"6f478239",8193:"fd89dcc4",8255:"8d8db273",8266:"fca981ed",8300:"0dc973ea",8320:"bc47aa2a",8333:"e192879b",8341:"5cf95377",8347:"8758a82a",8357:"fd0e5f94",8376:"f563a55c",8391:"d0031c2f",8430:"05e6fcb6",8459:"1eea5681",8479:"c3ccbb16",8490:"c064acca",8505:"44f78dc7",8560:"277ee23e",8655:"b1e07ce8",8675:"3a679f34",8723:"3b2866d0",8758:"6cbd1e75",8777:"435cf065",8860:"edb1c967",8896:"72fbc11d",8897:"8836e0af",8984:"77b65d35",8996:"e45ee828",9005:"4cf8b16d",9030:"b80f5ab8",9031:"6f0063fe",9032:"ef5c23a9",9034:"b0b54219",9051:"a15133b4",9078:"7240f33d",9086:"66e36702",9104:"a1154e06",9119:"db717c02",9122:"16438110",9154:"27cdba5c",9184:"e2105c2d",9185:"d4b158ca",9233:"5a195352",9291:"f062dabf",9367:"4737638f",9379:"bc5ded19",9398:"aa961842",9420:"fa9e5270",9435:"a4b052ec",9437:"9af5fe18",9492:"72f48c97",9495:"6bc0622d",9546:"5ef3f4cf",9571:"2be3eba1",9616:"be69312e",9625:"c8aee4cf",9637:"e235b0df",9639:"6dbc37e0",9729:"0f28ea4d",9766:"79984f8e",9831:"a55e909c",9833:"9b989716",9844:"8b25d151",9845:"2641f731",9850:"21d8250b",9873:"2d9b6bfa",9879:"21150f63",9942:"bb8745d9",9975:"b15c86e5",9983:"f37c64cf"}[e]+".chunk.js",r.miniCssF=e=>{},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="personal-website:";r.l=(i,n,s,o)=>{if(e[i])e[i].push(n);else{var a,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==i||h.getAttribute("data-webpack")==t+s){a=h;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.setAttribute("data-webpack",t+s),a.src=i),e[i]=[n];var d=(t,r)=>{a.onerror=a.onload=null,clearTimeout(p);var n=e[i];if(delete e[i],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach((e=>e(r))),t)return t(r)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}}})(),r.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="/",(()=>{var e={8792:0};r.f.j=(t,i)=>{var n=r.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var s=new Promise(((r,i)=>n=e[t]=[r,i]));i.push(n[2]=s);var o=r.p+r.u(t),a=new Error;r.l(o,(i=>{if(r.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var s=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,n[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{var n,s,o=i[0],a=i[1],l=i[2],c=0;if(o.some((t=>0!==e[t]))){for(n in a)r.o(a,n)&&(r.m[n]=a[n]);if(l)l(r)}for(t&&t(i);c<o.length;c++)s=o[c],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0},i=self.webpackChunkpersonal_website=self.webpackChunkpersonal_website||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";var e,t=r(65043),i=r.t(t,2),n=r(84391);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},s.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const o="popstate";function a(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function l(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(r){}}}function c(e,t){return{usr:e.state,key:e.key,idx:t}}function u(e,t,r,i){return void 0===r&&(r=null),s({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?d(t):t,{state:r,key:t&&t.key||i||Math.random().toString(36).substr(2,8)})}function h(e){let{pathname:t="/",search:r="",hash:i=""}=e;return r&&"?"!==r&&(t+="?"===r.charAt(0)?r:"?"+r),i&&"#"!==i&&(t+="#"===i.charAt(0)?i:"#"+i),t}function d(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}function p(t,r,i,n){void 0===n&&(n={});let{window:l=document.defaultView,v5Compat:d=!1}=n,p=l.history,f=e.Pop,m=null,g=y();function y(){return(p.state||{idx:null}).idx}function _(){f=e.Pop;let t=y(),r=null==t?null:t-g;g=t,m&&m({action:f,location:b.location,delta:r})}function v(e){let t="null"!==l.location.origin?l.location.origin:l.location.href,r="string"===typeof e?e:h(e);return r=r.replace(/ $/,"%20"),a(t,"No window.location.(origin|href) available to create URL for href: "+r),new URL(r,t)}null==g&&(g=0,p.replaceState(s({},p.state,{idx:g}),""));let b={get action(){return f},get location(){return t(l,p)},listen(e){if(m)throw new Error("A history only accepts one active listener");return l.addEventListener(o,_),m=e,()=>{l.removeEventListener(o,_),m=null}},createHref:e=>r(l,e),createURL:v,encodeLocation(e){let t=v(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,r){f=e.Push;let n=u(b.location,t,r);i&&i(n,t),g=y()+1;let s=c(n,g),o=b.createHref(n);try{p.pushState(s,"",o)}catch(a){if(a instanceof DOMException&&"DataCloneError"===a.name)throw a;l.location.assign(o)}d&&m&&m({action:f,location:b.location,delta:1})},replace:function(t,r){f=e.Replace;let n=u(b.location,t,r);i&&i(n,t),g=y();let s=c(n,g),o=b.createHref(n);p.replaceState(s,"",o),d&&m&&m({action:f,location:b.location,delta:0})},go:e=>p.go(e)};return b}var f;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(f||(f={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function m(e,t,r){return void 0===r&&(r="/"),g(e,t,r,!1)}function g(e,t,r,i){let n=P(("string"===typeof t?d(t):t).pathname||"/",r);if(null==n)return null;let s=y(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let r=e.length===t.length&&e.slice(0,-1).every(((e,r)=>e===t[r]));return r?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(s);let o=null;for(let a=0;null==o&&a<s.length;++a){let e=R(n);o=C(s[a],e,i)}return o}function y(e,t,r,i){void 0===t&&(t=[]),void 0===r&&(r=[]),void 0===i&&(i="");let n=(e,n,s)=>{let o={relativePath:void 0===s?e.path||"":s,caseSensitive:!0===e.caseSensitive,childrenIndex:n,route:e};o.relativePath.startsWith("/")&&(a(o.relativePath.startsWith(i),'Absolute route path "'+o.relativePath+'" nested under path "'+i+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),o.relativePath=o.relativePath.slice(i.length));let l=D([i,o.relativePath]),c=r.concat(o);e.children&&e.children.length>0&&(a(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+l+'".'),y(e.children,t,c,l)),(null!=e.path||e.index)&&t.push({path:l,score:A(l,e.index),routesMeta:c})};return e.forEach(((e,t)=>{var r;if(""!==e.path&&null!=(r=e.path)&&r.includes("?"))for(let i of _(e.path))n(e,t,i);else n(e,t)})),t}function _(e){let t=e.split("/");if(0===t.length)return[];let[r,...i]=t,n=r.endsWith("?"),s=r.replace(/\?$/,"");if(0===i.length)return n?[s,""]:[s];let o=_(i.join("/")),a=[];return a.push(...o.map((e=>""===e?s:[s,e].join("/")))),n&&a.push(...o),a.map((t=>e.startsWith("/")&&""===t?"/":t))}const v=/^:[\w-]+$/,b=3,w=2,x=1,S=10,T=-2,M=e=>"*"===e;function A(e,t){let r=e.split("/"),i=r.length;return r.some(M)&&(i+=T),t&&(i+=w),r.filter((e=>!M(e))).reduce(((e,t)=>e+(v.test(t)?b:""===t?x:S)),i)}function C(e,t,r){void 0===r&&(r=!1);let{routesMeta:i}=e,n={},s="/",o=[];for(let a=0;a<i.length;++a){let e=i[a],l=a===i.length-1,c="/"===s?t:t.slice(s.length)||"/",u=E({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),h=e.route;if(!u&&l&&r&&!i[i.length-1].route.index&&(u=E({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!u)return null;Object.assign(n,u.params),o.push({params:n,pathname:D([s,u.pathname]),pathnameBase:F(D([s,u.pathnameBase])),route:h}),"/"!==u.pathnameBase&&(s=D([s,u.pathnameBase]))}return o}function E(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[r,i]=function(e,t,r){void 0===t&&(t=!1);void 0===r&&(r=!0);l("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let i=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,r)=>(i.push({paramName:t,isOptional:null!=r}),r?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(i.push({paramName:"*"}),n+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?n+="\\/*$":""!==e&&"/"!==e&&(n+="(?:(?=\\/|$))");let s=new RegExp(n,t?void 0:"i");return[s,i]}(e.path,e.caseSensitive,e.end),n=t.match(r);if(!n)return null;let s=n[0],o=s.replace(/(.)\/+$/,"$1"),a=n.slice(1);return{params:i.reduce(((e,t,r)=>{let{paramName:i,isOptional:n}=t;if("*"===i){let e=a[r]||"";o=s.slice(0,s.length-e.length).replace(/(.)\/+$/,"$1")}const l=a[r];return e[i]=n&&!l?void 0:(l||"").replace(/%2F/g,"/"),e}),{}),pathname:s,pathnameBase:o,pattern:e}}function R(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return l(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function P(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,i=e.charAt(r);return i&&"/"!==i?null:e.slice(r)||"/"}function O(e,t,r,i){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(i)+"].  Please separate it out to the `to."+r+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function I(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function L(e,t){let r=I(e);return t?r.map(((e,t)=>t===r.length-1?e.pathname:e.pathnameBase)):r.map((e=>e.pathnameBase))}function N(e,t,r,i){let n;void 0===i&&(i=!1),"string"===typeof e?n=d(e):(n=s({},e),a(!n.pathname||!n.pathname.includes("?"),O("?","pathname","search",n)),a(!n.pathname||!n.pathname.includes("#"),O("#","pathname","hash",n)),a(!n.search||!n.search.includes("#"),O("#","search","hash",n)));let o,l=""===e||""===n.pathname,c=l?"/":n.pathname;if(null==c)o=r;else{let e=t.length-1;if(!i&&c.startsWith("..")){let t=c.split("/");for(;".."===t[0];)t.shift(),e-=1;n.pathname=t.join("/")}o=e>=0?t[e]:"/"}let u=function(e,t){void 0===t&&(t="/");let{pathname:r,search:i="",hash:n=""}="string"===typeof e?d(e):e,s=r?r.startsWith("/")?r:function(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?r.length>1&&r.pop():"."!==e&&r.push(e)})),r.length>1?r.join("/"):"/"}(r,t):t;return{pathname:s,search:k(i),hash:z(n)}}(n,o),h=c&&"/"!==c&&c.endsWith("/"),p=(l||"."===c)&&r.endsWith("/");return u.pathname.endsWith("/")||!h&&!p||(u.pathname+="/"),u}const D=e=>e.join("/").replace(/\/\/+/g,"/"),F=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),k=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",z=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function U(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const V=["post","put","patch","delete"],B=(new Set(V),["get",...V]);new Set(B),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function j(){return j=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},j.apply(this,arguments)}const H=t.createContext(null);const G=t.createContext(null);const Z=t.createContext(null);const $=t.createContext(null);const q=t.createContext({outlet:null,matches:[],isDataRoute:!1});const W=t.createContext(null);function Y(){return null!=t.useContext($)}function X(){return Y()||a(!1),t.useContext($).location}function J(e){t.useContext(Z).static||t.useLayoutEffect(e)}function K(){let{isDataRoute:e}=t.useContext(q);return e?function(){let{router:e}=le(oe.UseNavigateStable),r=ue(ae.UseNavigateStable),i=t.useRef(!1);return J((()=>{i.current=!0})),t.useCallback((function(t,n){void 0===n&&(n={}),i.current&&("number"===typeof t?e.navigate(t):e.navigate(t,j({fromRouteId:r},n)))}),[e,r])}():function(){Y()||a(!1);let e=t.useContext(H),{basename:r,future:i,navigator:n}=t.useContext(Z),{matches:s}=t.useContext(q),{pathname:o}=X(),l=JSON.stringify(L(s,i.v7_relativeSplatPath)),c=t.useRef(!1);return J((()=>{c.current=!0})),t.useCallback((function(t,i){if(void 0===i&&(i={}),!c.current)return;if("number"===typeof t)return void n.go(t);let s=N(t,JSON.parse(l),o,"path"===i.relative);null==e&&"/"!==r&&(s.pathname="/"===s.pathname?r:D([r,s.pathname])),(i.replace?n.replace:n.push)(s,i.state,i)}),[r,n,l,o,e])}()}function Q(e,r){let{relative:i}=void 0===r?{}:r,{future:n}=t.useContext(Z),{matches:s}=t.useContext(q),{pathname:o}=X(),a=JSON.stringify(L(s,n.v7_relativeSplatPath));return t.useMemo((()=>N(e,JSON.parse(a),o,"path"===i)),[e,a,o,i])}function ee(r,i,n,s){Y()||a(!1);let{navigator:o}=t.useContext(Z),{matches:l}=t.useContext(q),c=l[l.length-1],u=c?c.params:{},h=(c&&c.pathname,c?c.pathnameBase:"/");c&&c.route;let p,f=X();if(i){var g;let e="string"===typeof i?d(i):i;"/"===h||(null==(g=e.pathname)?void 0:g.startsWith(h))||a(!1),p=e}else p=f;let y=p.pathname||"/",_=y;if("/"!==h){let e=h.replace(/^\//,"").split("/");_="/"+y.replace(/^\//,"").split("/").slice(e.length).join("/")}let v=m(r,{pathname:_});let b=se(v&&v.map((e=>Object.assign({},e,{params:Object.assign({},u,e.params),pathname:D([h,o.encodeLocation?o.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?h:D([h,o.encodeLocation?o.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),l,n,s);return i&&b?t.createElement($.Provider,{value:{location:j({pathname:"/",search:"",hash:"",state:null,key:"default"},p),navigationType:e.Pop}},b):b}function te(){let e=function(){var e;let r=t.useContext(W),i=ce(ae.UseRouteError),n=ue(ae.UseRouteError);if(void 0!==r)return r;return null==(e=i.errors)?void 0:e[n]}(),r=U(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,n="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:n};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},r),i?t.createElement("pre",{style:s},i):null,null)}const re=t.createElement(te,null);class ie extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(q.Provider,{value:this.props.routeContext},t.createElement(W.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ne(e){let{routeContext:r,match:i,children:n}=e,s=t.useContext(H);return s&&s.static&&s.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=i.route.id),t.createElement(q.Provider,{value:r},n)}function se(e,r,i,n){var s;if(void 0===r&&(r=[]),void 0===i&&(i=null),void 0===n&&(n=null),null==e){var o;if(!i)return null;if(i.errors)e=i.matches;else{if(!(null!=(o=n)&&o.v7_partialHydration&&0===r.length&&!i.initialized&&i.matches.length>0))return null;e=i.matches}}let l=e,c=null==(s=i)?void 0:s.errors;if(null!=c){let e=l.findIndex((e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id])));e>=0||a(!1),l=l.slice(0,Math.min(l.length,e+1))}let u=!1,h=-1;if(i&&n&&n.v7_partialHydration)for(let t=0;t<l.length;t++){let e=l[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(h=t),e.route.id){let{loaderData:t,errors:r}=i,n=e.route.loader&&void 0===t[e.route.id]&&(!r||void 0===r[e.route.id]);if(e.route.lazy||n){u=!0,l=h>=0?l.slice(0,h+1):[l[0]];break}}}return l.reduceRight(((e,n,s)=>{let o,a=!1,d=null,p=null;var f;i&&(o=c&&n.route.id?c[n.route.id]:void 0,d=n.route.errorElement||re,u&&(h<0&&0===s?(f="route-fallback",!1||he[f]||(he[f]=!0),a=!0,p=null):h===s&&(a=!0,p=n.route.hydrateFallbackElement||null)));let m=r.concat(l.slice(0,s+1)),g=()=>{let r;return r=o?d:a?p:n.route.Component?t.createElement(n.route.Component,null):n.route.element?n.route.element:e,t.createElement(ne,{match:n,routeContext:{outlet:e,matches:m,isDataRoute:null!=i},children:r})};return i&&(n.route.ErrorBoundary||n.route.errorElement||0===s)?t.createElement(ie,{location:i.location,revalidation:i.revalidation,component:d,error:o,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()}),null)}var oe=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(oe||{}),ae=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(ae||{});function le(e){let r=t.useContext(H);return r||a(!1),r}function ce(e){let r=t.useContext(G);return r||a(!1),r}function ue(e){let r=function(){let e=t.useContext(q);return e||a(!1),e}(),i=r.matches[r.matches.length-1];return i.route.id||a(!1),i.route.id}const he={};i.startTransition;function de(e){a(!1)}function pe(r){let{basename:i="/",children:n=null,location:s,navigationType:o=e.Pop,navigator:l,static:c=!1,future:u}=r;Y()&&a(!1);let h=i.replace(/^\/*/,"/"),p=t.useMemo((()=>({basename:h,navigator:l,static:c,future:j({v7_relativeSplatPath:!1},u)})),[h,u,l,c]);"string"===typeof s&&(s=d(s));let{pathname:f="/",search:m="",hash:g="",state:y=null,key:_="default"}=s,v=t.useMemo((()=>{let e=P(f,h);return null==e?null:{location:{pathname:e,search:m,hash:g,state:y,key:_},navigationType:o}}),[h,f,m,g,y,_,o]);return null==v?null:t.createElement(Z.Provider,{value:p},t.createElement($.Provider,{children:n,value:v}))}function fe(e){let{children:t,location:r}=e;return ee(me(t),r)}new Promise((()=>{}));t.Component;function me(e,r){void 0===r&&(r=[]);let i=[];return t.Children.forEach(e,((e,n)=>{if(!t.isValidElement(e))return;let s=[...r,n];if(e.type===t.Fragment)return void i.push.apply(i,me(e.props.children,s));e.type!==de&&a(!1),e.props.index&&e.props.children&&a(!1);let o={id:e.props.id||s.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(o.children=me(e.props.children,s)),i.push(o)})),i}var ge=r(97950),ye=r.t(ge,2);function _e(){return _e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},_e.apply(this,arguments)}function ve(e,t){if(null==e)return{};var r,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const be=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"];try{window.__reactRouterVersion="6"}catch(ZN){}new Map;const we=i.startTransition;ye.flushSync,i.useId;function xe(e){let{basename:r,children:i,future:n,window:s}=e,o=t.useRef();var a;null==o.current&&(o.current=(void 0===(a={window:s,v5Compat:!0})&&(a={}),p((function(e,t){let{pathname:r="/",search:i="",hash:n=""}=d(e.location.hash.substr(1));return r.startsWith("/")||r.startsWith(".")||(r="/"+r),u("",{pathname:r,search:i,hash:n},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){let r=e.document.querySelector("base"),i="";if(r&&r.getAttribute("href")){let t=e.location.href,r=t.indexOf("#");i=-1===r?t:t.slice(0,r)}return i+"#"+("string"===typeof t?t:h(t))}),(function(e,t){l("/"===e.pathname.charAt(0),"relative pathnames are not supported in hash history.push("+JSON.stringify(t)+")")}),a)));let c=o.current,[f,m]=t.useState({action:c.action,location:c.location}),{v7_startTransition:g}=n||{},y=t.useCallback((e=>{g&&we?we((()=>m(e))):m(e)}),[m,g]);return t.useLayoutEffect((()=>c.listen(y)),[c,y]),t.createElement(pe,{basename:r,children:i,location:f.location,navigationType:f.action,navigator:c,future:n})}const Se="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Te=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Me=t.forwardRef((function(e,r){let i,{onClick:n,relative:s,reloadDocument:o,replace:l,state:c,target:u,to:d,preventScrollReset:p,unstable_viewTransition:f}=e,m=ve(e,be),{basename:g}=t.useContext(Z),y=!1;if("string"===typeof d&&Te.test(d)&&(i=d,Se))try{let e=new URL(window.location.href),t=d.startsWith("//")?new URL(e.protocol+d):new URL(d),r=P(t.pathname,g);t.origin===e.origin&&null!=r?d=r+t.search+t.hash:y=!0}catch(ZN){}let _=function(e,r){let{relative:i}=void 0===r?{}:r;Y()||a(!1);let{basename:n,navigator:s}=t.useContext(Z),{hash:o,pathname:l,search:c}=Q(e,{relative:i}),u=l;return"/"!==n&&(u="/"===l?n:D([n,l])),s.createHref({pathname:u,search:c,hash:o})}(d,{relative:s}),v=function(e,r){let{target:i,replace:n,state:s,preventScrollReset:o,relative:a,unstable_viewTransition:l}=void 0===r?{}:r,c=K(),u=X(),d=Q(e,{relative:a});return t.useCallback((t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,i)){t.preventDefault();let r=void 0!==n?n:h(u)===h(d);c(e,{replace:r,state:s,preventScrollReset:o,relative:a,unstable_viewTransition:l})}}),[u,c,d,n,s,i,e,o,a,l])}(d,{replace:l,state:c,target:u,preventScrollReset:p,relative:s,unstable_viewTransition:f});return t.createElement("a",_e({},m,{href:i||_,onClick:y||o?n:function(e){n&&n(e),e.defaultPrevented||v(e)},ref:r,target:u}))}));var Ae,Ce;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Ae||(Ae={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Ce||(Ce={}));var Ee=r(70579);const Re=function(){let e=X();return(0,Ee.jsx)("header",{children:(0,Ee.jsx)("nav",{children:(0,Ee.jsx)("ul",{children:[{path:"/",label:"Home"},{path:"/about",label:"About Me"},{path:"/contact",label:"Contact"}].map(((t,r)=>(0,Ee.jsx)("li",{children:(0,Ee.jsx)(Me,{className:t.path===e.pathname?"active":"",to:t.path,children:t.label})},r)))})})})};const Pe=function(e){let{children:t}=e;return(0,Ee.jsx)("section",{className:"container",children:(0,Ee.jsx)("div",{className:"card-outline main-content",children:t})})};const Oe=function(e){let{link:t,linkName:r}=e;return(0,Ee.jsx)("li",{children:(0,Ee.jsx)("a",{className:"link",href:t,target:"_blank",children:r})})};const Ie=function(e){let{name:t,link:r,title:i}=e;return(0,Ee.jsxs)("div",{className:"interest",children:[(0,Ee.jsx)("h3",{children:i}),(0,Ee.jsx)("ul",{className:"remove-ul-bullet-point",children:(0,Ee.jsx)(Oe,{link:r,linkName:t})})]})};const Le=function(){return(0,Ee.jsx)("div",{className:"interests-list",children:[{name:"Code Samples",link:"https://github.com/fernandowski",title:"GitHub"},{name:"LinkedIn",link:"https://www.linkedin.com/in/fernando-lopez-04474984/",title:"Social Media"}].map((e=>{let{name:t,link:r,title:i}=e;return(0,Ee.jsx)(Ie,{name:t,link:r,title:i})}))})};const Ne=function(){return(0,Ee.jsx)(Pe,{children:(0,Ee.jsx)("section",{className:"about-me-container",children:(0,Ee.jsx)(Le,{})})})};const De=function(){const[e,r]=(0,t.useState)(!1);return(0,Ee.jsx)(Pe,{children:(0,Ee.jsx)("section",{className:"contact-me-container",children:e?(0,Ee.jsx)("h3",{children:"We will be in touch."}):(0,Ee.jsxs)("div",{className:"form-container",children:[(0,Ee.jsx)("div",{className:"form-header",children:(0,Ee.jsx)("h3",{children:"Let's Get in Touch"})}),(0,Ee.jsxs)("form",{className:"form",onSubmit:()=>{r(!0)},children:[(0,Ee.jsxs)("div",{className:"form-control-group",children:[(0,Ee.jsx)("label",{htmlFor:"email",children:" Email: "}),(0,Ee.jsx)("input",{type:"email",id:"email"})]}),(0,Ee.jsxs)("div",{className:"form-control-group",children:[(0,Ee.jsx)("label",{htmlFor:"text-area",children:"Message:"}),(0,Ee.jsx)("textarea",{id:"text-area"})]}),(0,Ee.jsx)("div",{className:"submit-button-container",children:(0,Ee.jsx)("button",{className:"submit-button",type:"submit",children:"Submit"})})]})]})})})};const Fe=function(){return(0,Ee.jsx)(Pe,{children:(0,Ee.jsxs)("div",{className:"personal-info-card",children:[(0,Ee.jsxs)("div",{className:"personal-info-description",children:[(0,Ee.jsx)("h1",{children:"Welcome to My Personal Website"}),(0,Ee.jsx)("p",{children:"I'm Fernando, a developer who enjoys working on different projects and kind of technologies. Thanks for arriving at my page to learn more about me."})]}),(0,Ee.jsx)("div",{className:"photo-container",children:(0,Ee.jsx)("div",{className:"personal-photo"})})]})})};var ke,ze=r(35143),Ue=r(55171),Ve=r(194),Be=r(69539),je=r(19276),He=r(3975),Ge=r(4212),Ze=r(50076),$e=r(42553),qe=r(53084),We=r(49304),Ye=r(27741),Xe=r(76460),Je=r(30726),Ke=r(50346),Qe=r(46053),et=r(40565),tt=r(85842),rt=r(17707),it=r(81806),nt=(r(47249),r(6409));let st=ke=class extends $e.oY{constructor(e){super(e),this.type="none"}clone(){return new ke({type:this.type})}};(0,ze._)([(0,nt.e)({none:"none",stayAbove:"stay-above"})],st.prototype,"type",void 0),st=ke=(0,ze._)([(0,tt.$)("esri.ground.NavigationConstraint")],st);var ot,at=r(2183);let lt=ot=class extends((0,$e.Te)(We.A)){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new je.A;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"!==e.type&&"base-elevation"!==e.type&&Xe.A.getLogger(this).error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)};this.addHandles([this.layers.on("after-add",(e=>t(e.item))),this.layers.on("after-remove",(e=>(e=>{e.parent=null})(e.item)))])}initialize(){this.when().catch((e=>{(0,Ke.zf)(e)||Xe.A.getLogger(this).error("#load()","Failed to load ground",e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)(0,Je.pR)(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",(0,He.V)(e,this._get("layers")))}writeLayers(e,t,r,i){const n=[];e?(i={...i,layerContainerType:"ground"},e.forEach((e=>{if("write"in e){const t={};(0,Ge.GB)(e)().write(t,i)&&n.push(t)}else i?.messages&&i.messages.push(new Ze.A("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in the ground`,{layer:e}))})),t.layers=n):t.layers=n}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return(0,Ye.g)(this,(e=>{e(this.layers)}))}async queryElevation(e,t){await this.load({signal:t?.signal});const{ElevationQuery:i}=await r.e(3571).then(r.bind(r,3571));(0,Ke.Te)(t);const n=new i,s=this.layers.filter(ct).toArray();return n.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t?.signal});const{ElevationQuery:i}=await r.e(3571).then(r.bind(r,3571));(0,Ke.Te)(t);const n=new i,s=this.layers.filter(ct).toArray();return n.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:(0,qe.o8)(this.surfaceColor),navigationConstraint:(0,qe.o8)(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new ot({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,i){const n=t?.origin||"web-scene",s=t?.portal||null,o=t?.url||null,{populateOperationalLayers:a}=await r.e(239).then(r.bind(r,60239));(0,Ke.Te)(i);const l=[];if(e.layers&&Array.isArray(e.layers)){const t={context:{origin:n,url:o,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};l.push(a(this.layers,e.layers,t))}await Promise.allSettled(l)}};function ct(e){return"elevation"===e.type||function(e){return e&&"createElevationSampler"in e}(e)}(0,ze._)([(0,Qe.MZ)({json:{read:!1}})],lt.prototype,"layers",null),(0,ze._)([(0,rt.K)("layers")],lt.prototype,"writeLayers",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],lt.prototype,"resourceInfo",void 0),(0,ze._)([(0,Qe.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:et.jz,read:{reader:at.D,source:"transparency"},write:{writer:(e,t)=>{t.transparency=(0,at.p)(e)},target:"transparency"}}})],lt.prototype,"opacity",void 0),(0,ze._)([(0,Qe.MZ)({type:Be.A,json:{type:[et.jz],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],lt.prototype,"surfaceColor",void 0),(0,ze._)([(0,Qe.MZ)({type:st,json:{write:!0}})],lt.prototype,"navigationConstraint",void 0),lt=ot=(0,ze._)([(0,tt.$)("esri.Ground")],lt);const ut=lt;var ht=r(91967),dt=r(73763),pt=r(54099),ft=r(21403),mt=r(54901),gt=r(68134);const yt=new WeakMap;function _t(e){return!e.destroyed&&(yt.has(e)||e.addHandles([(0,gt.wB)((()=>{const t=e.parent;return!(!t||!("type"in t))&&("catalog-dynamic-group"===t.type||_t(t))}),(t=>yt.set(e,t)),gt.pc),(0,mt.hA)((()=>yt.delete(e)))]),yt.get(e))}var vt=r(31933);function bt(e){return!(!function(e){return"object"==typeof e&&null!=e&&"loaded"in e&&!0===e.loaded&&"type"in e}(e)||!(0,vt.BR)(e)?.operations?.supportsEditing||"editingEnabled"in e&&!(0,vt.tk)(e)||_t(e))}var wt=r(86300),xt=r(10425);const St={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};var Tt=r(71671),Mt=r(45730);let At=class extends((0,Mt.l)((0,Tt.Q)(pt.A.EventedMixin(ht.A)))){constructor(e){super(e),this.allLayers=new dt.A({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:e=>"layers"in e?e.layers:null}),this.allTables=(0,xt.Z)(this),this.basemap=null,this.editableLayers=new dt.A({getCollections:()=>[this.allLayers],itemFilterFunction:bt}),this.ground=new ut,this._basemapCache=(0,wt.VC)()}destroy(){(0,wt.jj)(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=(0,Je.pR)(this.basemap),(0,Je.pR)(this.ground),this._set("ground",null)}castBasemap(e){return(0,wt.dp)(e,this._basemapCache)}castGround(e){return function(e){let t=null;"string"==typeof e?e in St?t=new ut({resourceInfo:{data:{layers:[St[e]]}}}):Xe.A.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`):t=(0,et.dp)(ut,e);return t}(e)??this._get("ground")}findLayerById(e){return this.allLayers.find((t=>t.id===e))}findTableById(e){return this.allTables.find((t=>t.id===e))}};(0,ze._)([(0,Qe.MZ)({readOnly:!0,dependsOn:[]})],At.prototype,"allLayers",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],At.prototype,"allTables",void 0),(0,ze._)([(0,Qe.MZ)({type:Ve.default,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],At.prototype,"basemap",void 0),(0,ze._)([(0,ft.w)("basemap")],At.prototype,"castBasemap",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],At.prototype,"editableLayers",void 0),(0,ze._)([(0,Qe.MZ)({type:ut,nonNullable:!0})],At.prototype,"ground",void 0),(0,ze._)([(0,ft.w)("ground")],At.prototype,"castGround",null),(0,ze._)([(0,Qe.MZ)()],At.prototype,"undoRedo",void 0),At=(0,ze._)([(0,tt.$)("esri.Map")],At);const Ct=At;var Et,Rt=r(30358),Pt=r(35238),Ot=r(19902);let It=Et=class extends $e.oY{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new Et({rotation:this.rotation,scale:this.scale,targetGeometry:null!=this.targetGeometry?this.targetGeometry.clone():null,camera:null!=this.camera?this.camera.clone():null})}};(0,ze._)([(0,Qe.MZ)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Nt}}}}})],It.prototype,"rotation",void 0),(0,ze._)([(0,ft.w)("rotation")],It.prototype,"castRotation",null),(0,ze._)([(0,Qe.MZ)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Nt}}}}})],It.prototype,"scale",void 0),(0,ze._)([(0,Qe.MZ)({types:Pt.yR,json:{read:Ot.rS,write:!0,origins:{"web-scene":{read:Ot.rS,write:{overridePolicy:Nt}}}}})],It.prototype,"targetGeometry",void 0),(0,ze._)([(0,Qe.MZ)({type:Rt.A,json:{write:!0}})],It.prototype,"camera",void 0),It=Et=(0,ze._)([(0,tt.$)("esri.Viewpoint")],It);const Lt=It;function Nt(){return{enabled:!this.camera}}var Dt=r(18690),Ft=r(77717),kt=r(91291),zt=r(90534),Ut=r(28379),Vt=r(6527),Bt=r(13312),jt=r(83475),Ht=r(70652),Gt=r(72945);let Zt=class extends $e.oY{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],Zt.prototype,"facilityIdField",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],Zt.prototype,"layerId",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],Zt.prototype,"nameField",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],Zt.prototype,"siteIdField",void 0),(0,ze._)([(0,Qe.MZ)({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Zt.prototype,"sublayerId",void 0),Zt=(0,ze._)([(0,tt.$)("esri.layers.support.FacilityLayerInfo")],Zt);const $t=Zt;let qt=class extends $e.oY{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],qt.prototype,"facilityIdField",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],qt.prototype,"layerId",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],qt.prototype,"levelIdField",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],qt.prototype,"levelNumberField",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],qt.prototype,"longNameField",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],qt.prototype,"shortNameField",void 0),(0,ze._)([(0,Qe.MZ)({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],qt.prototype,"sublayerId",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],qt.prototype,"verticalOrderField",void 0),qt=(0,ze._)([(0,tt.$)("esri.layers.support.LevelLayerInfo")],qt);const Wt=qt;let Yt=class extends $e.oY{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],Yt.prototype,"layerId",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],Yt.prototype,"nameField",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],Yt.prototype,"siteIdField",void 0),(0,ze._)([(0,Qe.MZ)({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Yt.prototype,"sublayerId",void 0),Yt=(0,ze._)([(0,tt.$)("esri.layers.support.SiteLayerInfo")],Yt);const Xt=Yt;let Jt=class extends $e.oY{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};(0,ze._)([(0,Qe.MZ)({type:Wt,json:{write:!0}})],Jt.prototype,"levelLayer",void 0),(0,ze._)([(0,Qe.MZ)({type:$t,json:{write:!0}})],Jt.prototype,"facilityLayer",void 0),(0,ze._)([(0,Qe.MZ)({type:Xt,json:{write:!0}})],Jt.prototype,"siteLayer",void 0),Jt=(0,ze._)([(0,tt.$)("esri.support.MapFloorInfo")],Jt);const Kt=Jt;var Qt=r(69098),er=r(45802);let tr=class extends((0,Qt.O)($e.oY)){constructor(e){super(e),this.expression=null,this.returnType="string",this.title=null}};(0,ze._)([(0,Qe.MZ)({type:String,json:{write:{isRequired:!0}}})],tr.prototype,"expression",void 0),(0,ze._)([(0,Qe.MZ)({type:["number","string"],json:{write:!0}})],tr.prototype,"returnType",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],tr.prototype,"title",void 0),tr=(0,ze._)([(0,tt.$)("esri.webdoc.geotriggersInfo.ExpressionInfo")],tr);const rr=tr,ir=new er.J({deviceLocation:"device-location"});let nr=class extends((0,Qt.O)($e.oY)){constructor(e){super(e),this.filterExpression=null,this.type="device-location"}};(0,ze._)([(0,Qe.MZ)({type:rr,json:{write:!0}})],nr.prototype,"filterExpression",void 0),(0,ze._)([(0,Qe.MZ)({type:ir.apiValues,readOnly:!0,json:{type:ir.jsonValues,read:ir.read,write:ir.write}})],nr.prototype,"type",void 0),nr=(0,ze._)([(0,tt.$)("esri.webdoc.geotriggersInfo.DeviceLocationFeed")],nr);const sr=nr;let or=class extends((0,Qt.O)($e.oY)){constructor(e){super(e),this.geometry=null,this.where=null}};(0,ze._)([(0,Qe.MZ)({types:Pt.yR,json:{read:Ot.rS,write:!0}})],or.prototype,"geometry",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],or.prototype,"where",void 0),or=(0,ze._)([(0,tt.$)("esri.webdoc.geotriggersInfo.FeatureFilter")],or);const ar=or;let lr=class extends((0,Qt.O)($e.oY)){constructor(e){super(e),this.layerId=null,this.layerUrl=null,this.type="feature-layer"}};(0,ze._)([(0,Qe.MZ)({type:String,json:{write:{overridePolicy(){return{isRequired:null===this.layerUrl}}}}})],lr.prototype,"layerId",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:{overridePolicy(){return{isRequired:null===this.layerId}}}}})],lr.prototype,"layerUrl",void 0),(0,ze._)([(0,nt.e)({featureLayer:"feature-layer"},{readOnly:!0})],lr.prototype,"type",void 0),lr=(0,ze._)([(0,tt.$)("esri.webdoc.geotriggersInfo.FeatureLayerSource")],lr);const cr=lr;let ur=class extends((0,Qt.O)($e.oY)){constructor(e){super(e),this.fenceSource=null,this.filter=null,this.bufferDistance=null,this.type="features"}};(0,ze._)([(0,Qe.MZ)({type:cr,json:{write:{isRequired:!0}}})],ur.prototype,"fenceSource",void 0),(0,ze._)([(0,Qe.MZ)({type:ar,json:{write:!0}})],ur.prototype,"filter",void 0),(0,ze._)([(0,Qe.MZ)({type:Number,json:{write:!0}})],ur.prototype,"bufferDistance",void 0),(0,ze._)([(0,nt.e)({features:"features"},{readOnly:!0})],ur.prototype,"type",void 0),ur=(0,ze._)([(0,tt.$)("esri.webdoc.geotriggersInfo.FeatureFenceParameters")],ur);const hr=ur;let dr=class extends((0,Qt.O)($e.oY)){constructor(e){super(e),this.type="fence"}};(0,ze._)([(0,nt.e)({fence:"fence"},{readOnly:!0})],dr.prototype,"type",void 0),dr=(0,ze._)([(0,tt.$)("esri.webdoc.geotriggersInfo.Geotrigger")],dr);const pr=dr;let fr=class extends((0,Qt.O)($e.oY)){constructor(e){super(e),this.expressionInfo=null,this.requestedActions=null}};(0,ze._)([(0,Qe.MZ)({type:rr,json:{write:!0}})],fr.prototype,"expressionInfo",void 0),(0,ze._)([(0,Qe.MZ)({type:[String],json:{write:!0}})],fr.prototype,"requestedActions",void 0),fr=(0,ze._)([(0,tt.$)("esri.webdoc.geotriggersInfo.GeotriggerNotificationOptions")],fr);const mr=fr,gr=new er.J({enterContainsAndExitDoesNotContain:"enter-contains-and-exit-does-not-contain",enterContainsAndExitDoesNotIntersect:"enter-contains-and-exit-does-not-intersect",enterIntersectsAndExitDoesNotIntersect:"enter-intersects-and-exit-does-not-intersect"}),yr=new er.J({useGeometry:"use-geometry",useGeometryWithAccuracy:"use-geometry-with-accuracy"}),_r=new er.J({enter:"enter",enterOrExit:"enter-or-exit",exit:"exit"});let vr=class extends pr{constructor(e){super(e),this.enterExitRule="enter-contains-and-exit-does-not-intersect",this.feed=null,this.feedAccuracyMode="use-geometry",this.fenceNotificationRule=null,this.fenceParameters=null,this.name=null,this.notificationOptions=null,this.type="fence"}};(0,ze._)([(0,nt.e)(gr)],vr.prototype,"enterExitRule",void 0),(0,ze._)([(0,Qe.MZ)({type:sr,json:{write:{isRequired:!0}}})],vr.prototype,"feed",void 0),(0,ze._)([(0,nt.e)(yr)],vr.prototype,"feedAccuracyMode",void 0),(0,ze._)([(0,Qe.MZ)({type:_r.apiValues,json:{type:_r.jsonValues,read:_r.read,write:{writer:_r.write,isRequired:!0}}})],vr.prototype,"fenceNotificationRule",void 0),(0,ze._)([(0,Qe.MZ)({type:hr,json:{write:{isRequired:!0}}})],vr.prototype,"fenceParameters",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],vr.prototype,"name",void 0),(0,ze._)([(0,Qe.MZ)({type:mr,json:{write:!0}})],vr.prototype,"notificationOptions",void 0),(0,ze._)([(0,nt.e)({fence:"fence"},{readOnly:!0})],vr.prototype,"type",void 0),vr=(0,ze._)([(0,tt.$)("esri.webdoc.geotriggersInfo.FenceGeotrigger")],vr);const br={base:pr,key:"type",typeMap:{fence:vr}};let wr=class extends((0,Qt.O)($e.oY)){constructor(e){super(e),this.geotriggers=null}};(0,ze._)([(0,Qe.MZ)({types:[br],json:{write:{isRequired:!0}}})],wr.prototype,"geotriggers",void 0),wr=(0,ze._)([(0,tt.$)("esri.webdoc.GeotriggersInfo")],wr);const xr=wr;var Sr,Tr=r(61701);let Mr=Sr=class extends $e.oY{constructor(e){super(e),this.activeRange=null,this.currentRangeExtent=null,this.fullRangeExtent=null}clone(){return new Sr((0,qe.o8)({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))}};(0,ze._)([(0,Qe.MZ)({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],Mr.prototype,"activeRange",void 0),(0,ze._)([(0,Qe.MZ)({type:[Number],json:{write:!0}})],Mr.prototype,"currentRangeExtent",void 0),(0,ze._)([(0,Qe.MZ)({type:[Number],json:{write:!0}})],Mr.prototype,"fullRangeExtent",void 0),Mr=Sr=(0,ze._)([(0,tt.$)("esri.webdoc.RangeInfo")],Mr);const Ar=Mr;var Cr;let Er=Cr=class extends $e.oY{constructor(e){super(e),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new Cr((0,qe.o8)({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};(0,ze._)([(0,Qe.MZ)({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],Er.prototype,"enabled",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],Er.prototype,"longNames",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],Er.prototype,"minimized",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],Er.prototype,"pinnedLevels",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{read:{source:"site"},write:{target:"site"}}})],Er.prototype,"site",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],Er.prototype,"facility",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{read:{source:"level"},write:{target:"level"}}})],Er.prototype,"level",void 0),Er=Cr=(0,ze._)([(0,tt.$)("esri.webdoc.widgets.FloorFilter")],Er);const Rr=Er;var Pr;const Or=new er.J({slider:"slider",picker:"picker"});let Ir=Pr=class extends $e.oY{constructor(e){super(e),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new Pr({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};(0,ze._)([(0,Qe.MZ)({type:Or.apiValues,nonNullable:!0,json:{type:Or.jsonValues,default:null,read:{reader:Or.read},write:{isRequired:!0,writer:Or.write}}})],Ir.prototype,"interactionMode",void 0),(0,ze._)([(0,Qe.MZ)({type:et.jz,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const e=null!=this.stopInterval;return{enabled:!e,isRequired:!e}}}}})],Ir.prototype,"numStops",void 0),(0,ze._)([(0,Qe.MZ)({type:Number,json:{write:{overridePolicy(){return{isRequired:null==this.numStops}}}}})],Ir.prototype,"stopInterval",void 0),Ir=Pr=(0,ze._)([(0,tt.$)("esri.webdoc.widgets.Range")],Ir);const Lr=Ir;var Nr,Dr=r(82111),Fr=r(53666),kr=r(48611),zr=r(90115);let Ur=Nr=class extends $e.oY{constructor(e){super(e),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(e){if(!e)return;const t=null!=e[0]?new Date(e[0]):null,r=null!=e[1]?new Date(e[1]):null;return new Dr.A({start:t,end:r})}writeCurrentTimeExtent(e,t,r){e&&(0,kr.sM)(r,[null!=e.start?e.start.getTime():null,null!=e.end?e.end.getTime():null],t)}readFullTimeExtent(e,t){const r=t.properties;if(!r)return;const i=null!=r.endTime?new Date(r.endTime):null,n=null!=r.startTime?new Date(r.startTime):null;return new Dr.A({start:n,end:i})}writeFullTimeExtent(e,t){if(!e)return;const r=t.properties=t.properties||{},i=e.end,n=e.start;i&&(r.endTime=null!=i?i.getTime():null),n&&(r.startTime=null!=n?n.getTime():null)}readStopInterval(e,t,r){return e?Fr.A.fromJSON({value:e.interval,unit:e.units},r):null}writeStopInterval(e,t,r,i){if(!e)return;const n=e.toJSON(i);(0,kr.sM)("properties.timeStopInterval",{interval:n.value,units:n.unit},t)}readStops(e){return e?.length?e.map((e=>new Date(e))):null}writeStops(e,t,r){e?.length&&(0,kr.sM)(r,e.map((e=>e.getTime())),t)}clone(){return new Nr((0,qe.o8)({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};(0,ze._)([(0,Qe.MZ)({type:Dr.A,json:{type:[[et.jz,et.Uv]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],Ur.prototype,"currentTimeExtent",void 0),(0,ze._)([(0,Ut.w)("currentTimeExtent")],Ur.prototype,"readCurrentTimeExtent",null),(0,ze._)([(0,rt.K)("currentTimeExtent")],Ur.prototype,"writeCurrentTimeExtent",null),(0,ze._)([(0,Qe.MZ)({type:Dr.A,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],Ur.prototype,"fullTimeExtent",void 0),(0,ze._)([(0,Ut.w)("fullTimeExtent")],Ur.prototype,"readFullTimeExtent",null),(0,ze._)([(0,rt.K)("fullTimeExtent")],Ur.prototype,"writeFullTimeExtent",null),(0,ze._)([(0,Qe.MZ)({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],Ur.prototype,"loop",void 0),(0,ze._)([(0,Qe.MZ)({type:et.jz,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){const e=!!this.stopInterval,t=!!this.stops?.length,r=!(e||t);return{enabled:r,isRequired:r}}}}})],Ur.prototype,"numStops",void 0),(0,ze._)([(0,Qe.MZ)({type:[1,2],nonNullable:!0,json:{type:et.jz,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],Ur.prototype,"numThumbs",void 0),(0,ze._)([(0,Qe.MZ)({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],Ur.prototype,"stopDelay",void 0),(0,ze._)([(0,Qe.MZ)({type:Fr.A,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:zr.j.jsonValues.filter((e=>"esriTimeUnitsUnknown"!==e))}},overridePolicy(){const e=null!=this.numStops,t=!!this.stops?.length;return{enabled:!t,isRequired:!(e||t)}}}}})],Ur.prototype,"stopInterval",void 0),(0,ze._)([(0,Ut.w)("stopInterval")],Ur.prototype,"readStopInterval",null),(0,ze._)([(0,rt.K)("stopInterval")],Ur.prototype,"writeStopInterval",null),(0,ze._)([(0,Qe.MZ)({type:[Date],json:{type:[et.jz],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:null==this.numStops&&!this.stopInterval}}}}})],Ur.prototype,"stops",void 0),(0,ze._)([(0,Ut.w)("stops")],Ur.prototype,"readStops",null),(0,ze._)([(0,rt.K)("stops")],Ur.prototype,"writeStops",null),Ur=Nr=(0,ze._)([(0,tt.$)("esri.webdoc.widgets.TimeSlider")],Ur);const Vr=Ur;var Br;let jr=Br=class extends $e.oY{constructor(e){super(e),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new Br((0,qe.o8)({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};(0,ze._)([(0,Qe.MZ)({type:Lr,json:{write:!0}})],jr.prototype,"range",void 0),(0,ze._)([(0,Qe.MZ)({type:Vr,json:{write:!0}})],jr.prototype,"timeSlider",void 0),(0,ze._)([(0,Qe.MZ)({type:Rr,json:{write:!0}})],jr.prototype,"floorFilter",void 0),jr=Br=(0,ze._)([(0,tt.$)("esri.webdoc.Widgets")],jr);const Hr=jr,Gr={width:600,height:400},Zr=1.5;var $r=r(45417),qr=r(65308),Wr=r(79942),Yr=r(71334),Xr=r(70414);function Jr(e,t){return t.resourceInfo?Kr(t,t.resourceInfo,{origin:e.origin}):t.portalItem?.id?async function(e,t,i){if(await i.load().catch((t=>{throw new Ze.A(`${e.name}:load-portal-item`,"Failed to load portal item",{error:t})})),i.type!==e.itemType)throw new Ze.A(`${e.name}:invalid-portal-item`,`Invalid portal item type '${i.type}', expected '${e.itemType}'`,{type:i.type});const n=await i.fetchData();t.resourceInfo=n;const s=(0,Wr.v)(i,e.origin);await function(e,t,r,i){const n=function(e,t){const r=e.parseVersion(t.version||"",e.name);return e.currentVersion.validate(r),t.version=`${r.major}.${r.minor}`,t}(e,r);return t.read(n,i),Kr(t,n,i)}(e,t,n,s),t.resourceReferences={portalItem:i,paths:s.readResourcePaths};const o=await async function(e,t,i){const n=e?.viewpoint?.targetGeometry;if(n)return null;const s=await async function(e,t,i){const n=e?.spatialReference,s=t?.extent;if(!n||!s)return null;if(n.isWGS84)return s.clone();if(n.isWebMercator)return(0,$r.Gh)(s);const{getGeometryServiceURL:o}=await Promise.resolve().then(r.bind(r,39483));try{const e=await o(t),r=new Xr.A({geometries:[s],outSpatialReference:n});return(await(0,Yr.C)(e,r))[0]}catch(a){i.error("Error projecting item's extent:",a)}return null}(e,t,i);return s?new Lt({targetGeometry:s}):null}(t.initialViewProperties,i,Xe.A.getLogger(t));if(o){const r=t.initialViewProperties?.clone()??e.createInitialViewProperties();r.viewpoint=o,t.initialViewProperties=r}}(e,t,t.portalItem):Promise.resolve()}function Kr(e,t,i){const n={context:{...i,layerContainerType:"operational-layers"}};return e.portalItem&&(n.context.portal=e.portalItem.portal||qr.A.getDefault()),r.e(239).then(r.bind(r,60239)).then((r=>{let{populateOperationalLayers:i}=r;const s=[],o=t.operationalLayers;o?.length&&s.push(i(e.layers,o,n));const a={...n,context:{...n.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"},l=t.tables;return l?.length&&s.push(i(e.tables,l,a)),Promise.allSettled(s).then((()=>{}))}))}var Qr=r(8837);function ei(e){return{enabled:!!e?.length}}var ti,ri=r(6127);let ii=ti=class extends $e.oY{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new ti({exactMatch:this.exactMatch,type:this.type,name:this.name})}};(0,ze._)([(0,Qe.MZ)({type:Boolean,json:{write:!0}})],ii.prototype,"exactMatch",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],ii.prototype,"name",void 0),(0,ze._)([(0,nt.e)(ri.m)],ii.prototype,"type",void 0),ii=ti=(0,ze._)([(0,tt.$)("esri.webdoc.applicationProperties.SearchLayerField")],ii);const ni=ii;var si;let oi=si=class extends $e.oY{constructor(e){super(e),this.field=null,this.id=null,this.subLayer=null}clone(){return new si((0,qe.o8)({field:this.field,id:this.id,subLayer:this.subLayer}))}};(0,ze._)([(0,Qe.MZ)({type:ni,json:{write:{isRequired:!0}}})],oi.prototype,"field",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:{isRequired:!0}}})],oi.prototype,"id",void 0),(0,ze._)([(0,Qe.MZ)({type:et.jz,json:{write:!0}})],oi.prototype,"subLayer",void 0),oi=si=(0,ze._)([(0,tt.$)("esri.webdoc.applicationProperties.SearchLayer")],oi);const ai=oi;var li;let ci=li=class extends $e.oY{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new li({exactMatch:this.exactMatch,type:this.type,name:this.name})}};(0,ze._)([(0,Qe.MZ)({type:Boolean,json:{write:!0}})],ci.prototype,"exactMatch",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],ci.prototype,"name",void 0),(0,ze._)([(0,nt.e)(ri.m)],ci.prototype,"type",void 0),ci=li=(0,ze._)([(0,tt.$)("esri.webdoc.applicationProperties.SearchTableField")],ci);const ui=ci;var hi;let di=hi=class extends $e.oY{constructor(e){super(e),this.field=null,this.id=null}clone(){return new hi((0,qe.o8)({field:this.field,id:this.id}))}};(0,ze._)([(0,Qe.MZ)({type:ui,json:{write:{isRequired:!0}}})],di.prototype,"field",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:{isRequired:!0}}})],di.prototype,"id",void 0),di=hi=(0,ze._)([(0,tt.$)("esri.webdoc.applicationProperties.SearchTable")],di);const pi=di;var fi;const mi=je.A.ofType(ai),gi=je.A.ofType(pi);let yi=fi=class extends $e.oY{constructor(e){super(e),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new mi,this.tables=new gi}readAddressSearchEnabled(e){return!e}writeAddressSearchEnabled(e,t,r){t[r]=!e}clone(){return new fi((0,qe.o8)({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};(0,ze._)([(0,Qe.MZ)({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],yi.prototype,"addressSearchEnabled",void 0),(0,ze._)([(0,Ut.w)("addressSearchEnabled")],yi.prototype,"readAddressSearchEnabled",null),(0,ze._)([(0,rt.K)("addressSearchEnabled")],yi.prototype,"writeAddressSearchEnabled",null),(0,ze._)([(0,Qe.MZ)({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],yi.prototype,"enabled",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],yi.prototype,"hintText",void 0),(0,ze._)([(0,Qe.MZ)({type:mi,json:{write:{overridePolicy:ei},origins:{"web-scene":{write:{isRequired:!0}}}}})],yi.prototype,"layers",void 0),(0,ze._)([(0,Qe.MZ)({type:gi,json:{read:!0,write:{overridePolicy:ei}}})],yi.prototype,"tables",void 0),yi=fi=(0,ze._)([(0,tt.$)("esri.webdoc.applicationProperties.Search")],yi);const _i=yi;var vi;let bi=vi=class extends $e.oY{constructor(e){super(e),this.search=null}clone(){return new vi((0,qe.o8)({search:this.search}))}};(0,ze._)([(0,Qe.MZ)({type:_i,json:{write:!0}})],bi.prototype,"search",void 0),bi=vi=(0,ze._)([(0,tt.$)("esri.webdoc.applicationProperties.Viewing")],bi);const wi=bi;var xi;let Si=xi=class extends $e.oY{constructor(e){super(e),this.editing=null,this.offline=null,this.viewing=null}clone(){return new xi((0,qe.o8)({editing:this.editing,offline:this.offline,viewing:this.viewing}))}};(0,ze._)([(0,Qe.MZ)({json:{write:!0}})],Si.prototype,"editing",void 0),(0,ze._)([(0,Qe.MZ)({json:{write:!0}})],Si.prototype,"offline",void 0),(0,ze._)([(0,Qe.MZ)({type:wi,json:{write:!0}})],Si.prototype,"viewing",void 0),Si=xi=(0,ze._)([(0,tt.$)("esri.webmap.ApplicationProperties")],Si);const Ti=Si;var Mi=r(5632);var Ai;let Ci=Ai=class extends $e.oY{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return function(e){return!!e&&/^https:\/\/.*/i.test(e)}(this.url)}get isDataURI(){return function(e){return!!e&&/data:([-\w]+\/[-+\w.]+)?(;?\w+=[-\w]+)*(;base64)?,.*/gu.test(e)}(this.url)}clone(){return new Ai({url:this.url})}};(0,ze._)([(0,Qe.MZ)({type:String,json:{write:{isRequired:!0}}})],Ci.prototype,"url",void 0),(0,ze._)([(0,Qe.MZ)()],Ci.prototype,"isSecureUrl",null),(0,ze._)([(0,Qe.MZ)()],Ci.prototype,"isDataURI",null),Ci=Ai=(0,ze._)([(0,tt.$)("esri.webdoc.support.SlideThumbnail")],Ci);const Ei={type:Dr.A,json:{read:{source:"timeExtent",reader:e=>e?Array.isArray(e)?Dr.A.fromArray(e):Dr.A.fromJSON(e):null},write:{writer:(e,t,r,i)=>{e&&(e.isEmpty?i?.messages&&i.messages.push(new Ze.A("invalid-timeExtent","TimeExtent cannot be empty")):t[r]=e.toArray())},target:{timeExtent:{type:[[et.jz,et.Uv]]}}}}};var Ri;let Pi=Ri=class extends((0,Mi.sA)($e.oY)){constructor(e){super(e),this.name=null,this.thumbnail=new Ci,this.timeExtent=null}castThumbnail(e){return"string"==typeof e?new Ci({url:e}):(0,et.dp)(Ci,e)}set viewpoint(e){const{targetGeometry:t,scale:r}=e;null!=t&&"point"===t.type&&null==r&&Xe.A.getLogger(this).warn("Bookmark.viewpoint should include 'scale' when its targetGeometry is a point.",e),this._set("viewpoint",e)}readViewpoint(e,t){const{extent:r,viewpoint:i}=t;return Lt.fromJSON(i||{targetGeometry:r})}writeViewpoint(e,t,r,i){if(!e)return;const{targetGeometry:n}=e;if(null==n||"extent"===n.type)null!=n&&(t.extent=n.toJSON()),t[r]=e.toJSON();else{const e="Bookmark.viewpoint cannot be written to JSON when the viewpoint's targetGeometry is not an extent.";i?.messages?i.messages.push(new Ze.A("property:unsupported",e)):Xe.A.getLogger(this).error(e)}}clone(){return new Ri((0,qe.o8)({name:this.name,thumbnail:this.thumbnail,timeExtent:this.timeExtent,viewpoint:this.viewpoint}))}};(0,ze._)([(0,Qe.MZ)({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],Pi.prototype,"name",void 0),(0,ze._)([(0,Qe.MZ)({type:Ci,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.url)})}}})],Pi.prototype,"thumbnail",void 0),(0,ze._)([(0,ft.w)("thumbnail")],Pi.prototype,"castThumbnail",null),(0,ze._)([(0,Qe.MZ)(Ei)],Pi.prototype,"timeExtent",void 0),(0,ze._)([(0,Qe.MZ)({type:Lt,nonNullable:!0,json:{write:!0}})],Pi.prototype,"viewpoint",null),(0,ze._)([(0,Ut.w)("viewpoint",["extent","viewpoint"])],Pi.prototype,"readViewpoint",null),(0,ze._)([(0,rt.K)("viewpoint")],Pi.prototype,"writeViewpoint",null),Pi=Ri=(0,ze._)([(0,tt.$)("esri.webmap.Bookmark")],Pi);const Oi=Pi;var Ii,Li=r(67478);let Ni=Ii=class extends $e.oY{constructor(e){super(e),this.color=new Be.A([0,0,0,1])}clone(){return new Ii((0,qe.o8)({color:this.color}))}};(0,ze._)([(0,Qe.MZ)({type:Be.A,json:{write:!0}})],Ni.prototype,"color",void 0),Ni=Ii=(0,ze._)([(0,tt.$)("esri.webmap.background.ColorBackground")],Ni);const Di=Ni;let Fi=class extends((0,Qt.O)(ht.A)){constructor(e){super(e),this.background=null,this.rangeInfo=null,this.spatialReference=null,this.timeZone=Li.qU,this.viewpoint=null}};(0,ze._)([(0,Qe.MZ)({type:Di})],Fi.prototype,"background",void 0),(0,ze._)([(0,Qe.MZ)({type:Ar})],Fi.prototype,"rangeInfo",void 0),(0,ze._)([(0,Qe.MZ)({type:Bt.A})],Fi.prototype,"spatialReference",void 0),(0,ze._)([(0,Qe.MZ)({nonNullable:!0})],Fi.prototype,"timeZone",void 0),(0,ze._)([(0,Qe.MZ)({type:Lt})],Fi.prototype,"viewpoint",void 0),Fi=(0,ze._)([(0,tt.$)("esri.webmap.InitialViewProperties")],Fi);const ki=Fi;var zi=r(19898);class Ui extends zi.R{constructor(e,t){super(e,t,"webmap")}}const Vi=new Ui(2,31),Bi="web-map",ji=je.A.ofType(Oi),Hi=je.A.ofType(jt.default),Gi=new Map([["image/jpeg","jpeg"],["image/jpg","jpg"],["image/png","png"],["image/gif","gif"]]),Zi=Gt.mm.JSAPI,$i={currentVersion:Vi,createInitialViewProperties:()=>new ki,parseVersion:Ui.parse,itemType:"Web Map",name:"webmap",origin:Bi};let qi=class extends((0,Ft.P)(We.A.LoadableMixin((0,kt.g)(Ct)))){constructor(e){super(e),this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1,this._thumbnailFilename=null,this._updateFromPromise=null,this.resourceReferences={portalItem:null,paths:[]},this.applicationProperties=null,this.bookmarks=new ji,this.floorInfo=null,this.geotriggersInfo=null,this.initialViewProperties=new ki,this.ipsInfo=null,this.portalItem=null,this.presentation=null,this.sourceVersion=null,this.widgets=null,this.utilityNetworks=null,this._debouncedSaveOperations=(0,Ke.sg)((async(e,t,i)=>{const{save:n,saveAs:s}=await r.e(339).then(r.bind(r,20339));switch(e){case Tr.X.SAVE:return n($i,this,t);case Tr.X.SAVE_AS:return s($i,this,i,t)}})),this.authoringApp=this.authoringAppVersion=null,this._isAuthoringAppSetByUser=this._isAuthoringAppVersionSetByUser=!1}destroy(){if(this.portalItem=(0,Je.pR)(this.portalItem),this.utilityNetworks){const e=this.utilityNetworks.removeAll();for(const t of e)t.destroy();this.utilityNetworks.destroy()}}initialize(){if(this.when().catch((e=>{Xe.A.getLogger(this).error("#load()","Failed to load web map",e)})),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(ZN){return void this.addResolvingPromise(Promise.reject(ZN))}this.read(e)}}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp=Zi}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=Ue.rE}readInitialViewProperties(e,t){const r=new ki;t.background&&(r.background=Di.fromJSON(t.background));const i=t.initialState?.viewpoint;return i&&(i.rotation&&Ui.parse(t.version||"","webmap").lessThan(2,20)&&"ArcGIS Pro"===t.authoringApp&&(i.rotation*=-1),r.viewpoint=Lt.fromJSON(i)),t.mapRangeInfo&&(r.rangeInfo=Ar.fromJSON(t.mapRangeInfo)),t.spatialReference&&(r.spatialReference=Bt.A.fromJSON(t.spatialReference)),t.timeZone&&(r.timeZone=t.timeZone),r}writeInitialViewProperties(e,t,r,i){e&&(e.background?.color&&(t.background=e.background.write({},i)),e.viewpoint&&(t.initialState={viewpoint:e.viewpoint.write({},i)}),e.rangeInfo&&(t.mapRangeInfo=e.rangeInfo.toJSON(i)),e.spatialReference&&(t.spatialReference=e.spatialReference.write({},i)),t.timeZone=e.timeZone)}writeLayers(e,t,r,i){t[r]=this._writeLayers(e,i,"operational-layers")}readSourceVersion(e,t){const[r,i]=t.version.split(".");return new Ui(parseInt(r,10),parseInt(i,10))}writeSourceVersion(e,t,r){t[r]=`${Vi.major}.${Vi.minor}`}writeTables(e,t,r,i){const n=this._writeLayers(e,i,"tables");n.length&&(t[r]=n)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl||null}set thumbnailUrl(e){e?(this._override("thumbnailUrl",e),this._thumbnailFilename=this._generateCustomThumbnailFilename(e)):this._clearThumbnailOverride()}get updatingFromView(){return!!this._updateFromPromise}load(e){return this.addResolvingPromise(Jr($i,this)),Promise.resolve(this)}loadAll(){return(0,Ye.g)(this,(e=>{e(this.ground,this.basemap,this.layers,this.tables)}))}read(e,t){t={...t,origin:Bi};const r=this._getAuthoringPropsState();(0,Vt.t)(this,e,(t=>super.read(e,t)),t),this._restoreAuthoringPropsFromState(r)}write(e,t){if("loaded"!==this.loadStatus){const e=new Ze.A("webmap:not-loaded","Web map must be loaded before it can be serialized");throw Xe.A.getLogger(this).error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),e}return this._removeDanglingLayerRefs(),t={...t,origin:Bi,restrictedWebMapWriting:!0,webmap:this},super.write(e,t)}async save(e){return this._debouncedSaveOperations(Tr.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(Tr.X.SAVE_AS,t,e)}async updateFrom(e,t){const r=this._updateFromInternal(e,t);this._updateFromPromise=r,await r,r===this._updateFromPromise&&(this._updateFromPromise=null)}getLayerJSONFromResourceInfo(e){const t=this.resourceInfo;return this._collectAllLayersJSON([...t?.baseMap?.baseMapLayers||[],...t?.operationalLayers||[],...this.basemap?.resourceInfo?.data?.baseMapLayers||[]]).find((t=>t.id===e.id))}async updateItemThumbnail(){this.thumbnailUrl&&this._isOverridden("thumbnailUrl")&&(await(this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename})),this._clearThumbnailOverride())}getThumbnailState(){let e=this.thumbnailUrl;return e&&(e=this._isOverridden("thumbnailUrl")?e:(0,zt.rs)(e,"w","8192")),{thumbnailUrl:e,filename:this._thumbnailFilename}}restoreThumbnailFromState(e){this.thumbnailUrl=e.thumbnailUrl,this._thumbnailFilename=e.filename}_collectAllLayersJSON(e){return e.reduce(((e,t)=>(e.push(t),"GroupLayer"===t.layerType&&(e=e.concat(this._collectAllLayersJSON(t.layers||[]))),e)),[])}_writeLayers(e,t,r){return t={...t,layerContainerType:r},e.map((e=>(0,Qr.CJ)(e,"tables"===r?null:this.getLayerJSONFromResourceInfo(e),t))).filter(Dt.Ru).toArray()}_validateJSON(e){const t=Ui.parse(e.version||"","webmap");return Vi.validate(t),e.version=`${t.major}.${t.minor}`,e}_removeDanglingLayerRefs(){const e=this.applicationProperties,t=e?.viewing?.search,r=e=>this.allLayers.some((t=>t.id===e));if(t?.layers&&(t.layers=t.layers.filter((e=>r(e.id)))),t?.tables&&(t.tables=t.tables.filter((e=>this.tables.some((t=>t.id===e.id))))),e){const t=e.editing?.locationTracking;t?.info&&!r(t.info.layerId)&&(e.editing=null)}const i=this.presentation?.slides;i&&i.forEach((e=>{e.visibleLayers&&(e.visibleLayers=e.visibleLayers.filter((e=>r(e.id))))}))}async _updateFromInternal(e,t){if(t??={},await(0,gt.C_)((()=>e.ready)),this._updateInitialViewProperties(e,t),e.map===this)for(const r of e.allLayerViews)"visible"in r&&"visible"in r.layer&&r._isOverridden("visible")&&(r.layer.visible=r.visible),"featureEffect"in r&&"featureEffect"in r.layer&&r._isOverridden("featureEffect")&&(r.layer.featureEffect=r.featureEffect);await this._updateThumbnailUrl(e,t)}_updateInitialViewProperties(e,t){if(t.backgroundExcluded||(this.initialViewProperties.background=e.background?.clone()),this.initialViewProperties.spatialReference=e.spatialReference?.clone(),this.initialViewProperties.timeZone=e.timeZone,t.viewpointExcluded||(this.initialViewProperties.viewpoint=new Lt({rotation:e.rotation,scale:t.scalePreserved?e.scale:null,targetGeometry:this._getViewExtent(e)})),!t.widgetsExcluded)for(const r of e.persistableViewModels)r.updateWebDocument(this)}_getViewExtent(e){const t=e.center.clone().normalize(),r=e.extent.clone(),i=r.width/2;return r.xmin=t.x-i,r.xmax=t.x+i,r}async _updateThumbnailUrl(e,t){if(t.thumbnailExcluded)return;const r=function(e,t){t=t||Gr;let{width:r,height:i}=t;const n=r/i;return n<Zr?i=r/Zr:n>Zr&&(r=i*Zr),r>e.width&&(i*=e.width/r,r=e.width),i>e.height&&(r*=e.height/i,i=e.height),{width:Math.round(r),height:Math.round(i)}}(e,t.thumbnailSize),i=await e.takeScreenshot({format:"png",width:r.width,height:r.height});this._setAutoGeneratedThumbnail(i.dataUrl)}_setAutoGeneratedThumbnail(e){this.thumbnailUrl=e,this._thumbnailFilename=null}_clearThumbnailOverride(){this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),this._thumbnailFilename=null}_generateCustomThumbnailFilename(e){if((0,zt.DB)(e)){const t=(0,zt.r$)(e),r=t?.mediaType,i=r&&Gi.get(r.toLowerCase())||null,n=`thumbnail${Date.now()}`;return i?`${n}.${i}`:n}return null}_getAuthoringPropsState(){return{authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}}_restoreAuthoringPropsFromState(e){e.isAuthoringAppSetByUser?this.authoringApp=e.authoringApp:this._isAuthoringAppSetByUser=!1,e.isAuthoringAppVersionSetByUser?this.authoringAppVersion=e.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1}static fromJSON(e){const t=e;if(!t)throw new Ze.A("webmap:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:t})}};qi.VERSION=Vi,(0,ze._)([(0,Qe.MZ)()],qi.prototype,"_updateFromPromise",void 0),(0,ze._)([(0,Qe.MZ)({type:Ti,json:{write:!0}})],qi.prototype,"applicationProperties",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],qi.prototype,"authoringApp",null),(0,ze._)([(0,rt.K)("authoringApp")],qi.prototype,"writeAuthoringApp",null),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],qi.prototype,"authoringAppVersion",null),(0,ze._)([(0,rt.K)("authoringAppVersion")],qi.prototype,"writeAuthoringAppVersion",null),(0,ze._)([(0,Qe.MZ)({type:ji,json:{write:{overridePolicy:e=>({enabled:!!(e&&e.length>0),ignoreOrigin:!0})}}})],qi.prototype,"bookmarks",void 0),(0,ze._)([(0,Qe.MZ)({type:Kt,json:{name:"mapFloorInfo",write:!0}})],qi.prototype,"floorInfo",void 0),(0,ze._)([(0,Qe.MZ)({type:xr,json:{write:!0}})],qi.prototype,"geotriggersInfo",void 0),(0,ze._)([(0,Qe.MZ)({type:ki,nonNullable:!0,json:{read:{source:["background","initialState.viewpoint","mapRangeInfo","spatialReference","timeZone"]},write:{ignoreOrigin:!0,target:{background:{type:Di},"initialState.viewpoint":{type:Lt},mapRangeInfo:{type:Ar},spatialReference:{type:Bt.A},"timeZone:":{type:String}}}}})],qi.prototype,"initialViewProperties",void 0),(0,ze._)([(0,Ut.w)("initialViewProperties")],qi.prototype,"readInitialViewProperties",null),(0,ze._)([(0,rt.K)("initialViewProperties")],qi.prototype,"writeInitialViewProperties",null),(0,ze._)([(0,Qe.MZ)({json:{write:!0,name:"mapIPSInfo"}})],qi.prototype,"ipsInfo",void 0),(0,ze._)([(0,Qe.MZ)({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],qi.prototype,"layers",void 0),(0,ze._)([(0,rt.K)("layers")],qi.prototype,"writeLayers",null),(0,ze._)([(0,Qe.MZ)({type:Ht.default})],qi.prototype,"portalItem",void 0),(0,ze._)([(0,Qe.MZ)({json:{write:!0}})],qi.prototype,"presentation",void 0),(0,ze._)([(0,Qe.MZ)()],qi.prototype,"resourceInfo",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0,type:Ui,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],qi.prototype,"sourceVersion",void 0),(0,ze._)([(0,Ut.w)("sourceVersion")],qi.prototype,"readSourceVersion",null),(0,ze._)([(0,rt.K)("sourceVersion")],qi.prototype,"writeSourceVersion",null),(0,ze._)([(0,Qe.MZ)({json:{read:!1,write:{ignoreOrigin:!0}}})],qi.prototype,"tables",void 0),(0,ze._)([(0,rt.K)("tables")],qi.prototype,"writeTables",null),(0,ze._)([(0,Qe.MZ)()],qi.prototype,"thumbnailUrl",null),(0,ze._)([(0,Qe.MZ)()],qi.prototype,"updatingFromView",null),(0,ze._)([(0,Qe.MZ)({type:Hr,json:{write:!0}})],qi.prototype,"widgets",void 0),(0,ze._)([(0,Qe.MZ)({type:Hi,json:{read:!0,write:!0}})],qi.prototype,"utilityNetworks",void 0),qi=(0,ze._)([(0,tt.$)("esri.WebMap")],qi);var Wi=r(30113),Yi=r(79053),Xi=r(44892),Ji=r(52394),Ki=r(76931),Qi=r(16783),en=r(49140),tn=r(39314);function rn(e,t){const r=(0,tn.oY)(e),i=(0,tn.oY)(t),n=r.store,s=i.store,o=i.metadata;for(const a in o){const t=o[a],r=n.originOf(a),i=s.originOf(a);if(!t.readOnly&&i!==en.Gr.DEFAULTS)if(r===en.Gr.DEFAULTS)e.set(a,s.get(a));else{const e=n.get(a),t=s.get(a);e&&t&&t instanceof ht.A&&e instanceof ht.A&&e instanceof t.constructor&&rn(e,t)}}}var nn=r(9392),sn=r(5364),on=r(91605),an=r(9624),ln=r(50840),cn=r(64232),un=r(2413),hn=r(79650),dn=r(88954),pn=r(68002);let fn=class extends sn.X{constructor(e){super(e),this.addHandles(this.on("before-add",(e=>{null!=e.item&&e.item.parent===this.owner&&(Xe.A.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),e.preventDefault())})))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};fn=(0,ze._)([(0,tt.$)("esri.support.AnalysesCollection")],fn);var mn=r(11373);const gn={widthBreakpoint:{getValue(e){const t=e.viewSize[0],r=e.breakpoints,i=this.values;return t<=r.xsmall?i.xsmall:t<=r.small?i.small:t<=r.medium?i.medium:t<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],r=e.breakpoints,i=this.values;return t<=r.xsmall?i.xsmall:t<=r.small?i.small:t<=r.medium?i.medium:t<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,r=t[0],i=t[1],n=this.values;return i>=r?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},yn={xsmall:544,small:768,medium:992,large:1200};function _n(e,t){return t?gn[e].valueToClassName[t].split(" "):[]}const vn=e=>{let t=class extends e{constructor(){super(...arguments),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=yn}initialize(){this.addHandles((0,gt.wB)((()=>[this.breakpoints,this.size]),(()=>this._updateClassNames()),gt.Vh))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(e){if(e!==this._get("breakpoints")){if(!function(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}(e)){const t=JSON.stringify(yn,null,2);console.warn("provided breakpoints are not valid, using defaults:"+t),e=yn}this._set("breakpoints",{...e})}}_updateClassNames(){if(!this.container)return;const e=mn.A.acquire(),t=mn.A.acquire();let r,i=!1;for(r in gn){const n=this[r],s=gn[r].getValue({viewSize:this.size,breakpoints:this.breakpoints});n!==s&&(i=!0,this[r]=s,_n(r,n).forEach((e=>t.push(e))),_n(r,s).forEach((t=>e.push(t))))}i&&(this._applyClassNameChanges(e,t),mn.A.release(e),mn.A.release(t))}_applyClassNameChanges(e,t){const r=this.container;r&&(t.forEach((e=>r.classList.remove(e))),e.forEach((e=>r.classList.add(e))))}_removeActiveClassNames(){const e=this.container;if(!e)return;let t;for(t in gn)_n(t,this[t]).forEach((t=>e.classList.remove(t)))}};return(0,ze._)([(0,Qe.MZ)()],t.prototype,"breakpoints",null),(0,ze._)([(0,Qe.MZ)()],t.prototype,"orientation",void 0),(0,ze._)([(0,Qe.MZ)()],t.prototype,"widthBreakpoint",void 0),(0,ze._)([(0,Qe.MZ)()],t.prototype,"heightBreakpoint",void 0),t=(0,ze._)([(0,tt.$)("esri.views.BreakpointsOwner")],t),t};var bn=r(19451),wn=(r(27347),r(48396));let xn=class extends ht.A{constructor(){super(...arguments),this.items=new je.A,this._watchUpdatingTracking=new bn.U,this._callbacks=new Map,this._projector=(0,wn.F)(),this._hiddenProjector=(0,wn.F)()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange((()=>this.items),(e=>{for(const t of e.added){const e=()=>t.render();this._callbacks.set(t,e),this._projector.append(this.surface,e)}for(const t of e.removed){const e=this._projector.detach(this._callbacks.get(t));this.surface.removeChild(e.domNode),this._callbacks.delete(t)}}))}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach((e=>this._projector.detach(e))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,r=this._hiddenProjector;let i;const n=()=>(i=e.render(),i);r.append(t,n),r.renderNow();const s={left:0,top:0,right:0,bottom:0};if(i?.domNode){const e=i.domNode.getBoundingClientRect();s.left=e.left,s.top=e.top,s.right=e.right,s.bottom=e.bottom}for(r.detach(n);t.firstChild;)t.removeChild(t.firstChild);return s}overlaps(e,t){const r=this.computeBoundingRect(e),i=this.computeBoundingRect(t);return Math.max(r.left,i.left)<=Math.min(r.right,i.right)&&Math.max(r.top,i.top)<=Math.min(r.bottom,i.bottom)}get hasVisibleItems(){return this.items.some((e=>e.visible))}async prepare(){await document.fonts.load(this._fontString()).catch((()=>{}))}renderCanvas(e,t){const r=!!t?.disableDecorations;if(!this.items.some((e=>e.visible&&!(r&&e.isDecoration))))return;const i=e.getContext("2d");i.save(),i.font=this._fontString(),this.items.forEach((e=>{r&&e.isDecoration||(i.save(),e.renderCanvas(i),i.restore())})),i.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};(0,ze._)([(0,Qe.MZ)({readOnly:!0})],xn.prototype,"surface",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],xn.prototype,"items",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],xn.prototype,"needsRender",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],xn.prototype,"_watchUpdatingTracking",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],xn.prototype,"updating",null),xn=(0,ze._)([(0,tt.$)("esri.views.overlay.ViewOverlay")],xn);const Sn=xn,Tn=[0,0];function Mn(e){e&&((0,Wi.Ie)(e),e.parentNode&&e.parentNode.removeChild(e))}const An=750,Cn=e=>{let t=class extends e{constructor(){super(...arguments),this._freqInfo={freq:16,time:An},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([(0,gt.wB)((()=>this.cursor),(e=>{const{surface:t}=this;t&&t.setAttribute("data-cursor",e)})),(0,gt.wB)((()=>this.navigating),(e=>{const{surface:t}=this;t&&t.setAttribute("data-navigating",e.toString())}))])}initialize(){this.addHandles([(0,gt.wB)((()=>this.ui),((e,t)=>this._handleUIChange(e,t)),gt.Vh),this.on("focus",(()=>this.notifyChange("focused"))),this.on("blur",(()=>this.notifyChange("focused")))])}destroy(){this.destroyed||(this.ui=(0,Je.pR)(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(e){const t=this._get("container"),r=(0,Wi.$H)(e);if(r||"string"!=typeof e||Xe.A.getLogger(this).error("#container",`element with id '${e}' not found`),t===r)return;if(this._stopMeasuring(),t&&(t.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(Mn(this.root),this._set("root",null)),this.userContent&&((0,Wi.yC)(this.userContent,t),Mn(this.userContent),this._set("userContent",null))),!r)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);r.classList.add("esri-view");const i=document.createElement("div");i.className="esri-view-user-storage",(0,Wi.yC)(r,i),r.appendChild(i),this._set("userContent",i);const n=document.createElement("div");n.className="esri-view-root",r.insertBefore(n,r.firstChild),this._set("root",n);const s=document.createElement("div");s.className="esri-view-surface",s.setAttribute("role","application"),s.tabIndex=0,n.appendChild(s),this._set("surface",s);const o=new Sn;n.appendChild(o.surface),this._set("overlay",o),this.addHandles((0,gt.wB)((()=>o.needsRender),(e=>{e&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=(0,Ji.mg)({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=(0,Je.xt)(this._overlayRenderTaskHandle)}))),this.forceDOMReadyCycle(),this._set("container",r),this._startMeasuring()}get focused(){const e=document.activeElement===this.surface;return document.hasFocus()&&e}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(e,t,r){const i=this.position;return e-=i?i[0]:0,t-=i?i[1]:0,r?(r[0]=e,r[1]=t):r=[e,t],r}containerToPage(e,t,r){const i=this.position;return e+=i?i[0]:0,t+=i?i[1]:0,r?(r[0]=e,r[1]=t):r=[e,t],r}_handleUIChange(e,t){this.removeHandles("ui"),t&&t!==e&&t.destroy(),e&&(e.view=this,this.addHandles((0,gt.wB)((()=>this.root),(t=>{e.container=t?function(e){const t=document.createElement("div");return e.appendChild(t),t}(t):null}),gt.Vh),"ui")),this._set("ui",e)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const e=this._freqInfo;e.freq=16,e.time=An,this.addHandles([(0,Yi.on)(window,"resize",(()=>{e.freq=16,e.time=An})),(0,Ji.mg)({prepare:e=>{const t=this._measure(),r=this._freqInfo;if(r.time+=e.deltaTime,t&&(r.freq=16,this._get("resizing")||this._set("resizing",!0)),r.time<r.freq)return;r.time=0;const i=this._position();r.freq=i||t?16:Math.min(An,2*r.freq),!t&&r.freq>=512&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const e=this.container,t=e?e.clientWidth:0,r=e?e.clientHeight:0;if(0===t||0===r)return this.suspended||this._set("suspended",!0),!1;const i=this.width,n=this.height;return t===i&&r===n?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",r),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:i,oldHeight:n,width:t,height:r}),!0)}_position(){const e=this.container,t=this.position,r=e&&function(e){const t=(e.ownerDocument||window.document).defaultView,r=e.getBoundingClientRect();return Tn[0]=r.left+(t?.pageXOffset??0),Tn[1]=r.top+(t?.pageYOffset??0),Tn}(e);return!!r&&(!t||r[0]!==t[0]||r[1]!==t[1])&&(this._set("position",[r[0],r[1]]),!0)}forceDOMReadyCycle(){}};return(0,ze._)([(0,Qe.MZ)()],t.prototype,"container",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],t.prototype,"focused",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],t.prototype,"height",void 0),(0,ze._)([(0,Qe.MZ)()],t.prototype,"messagesCommon",void 0),(0,ze._)([(0,Qe.MZ)({type:Sn})],t.prototype,"overlay",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],t.prototype,"position",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],t.prototype,"resizing",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],t.prototype,"root",void 0),(0,ze._)([(0,Qe.MZ)({value:null,readOnly:!0})],t.prototype,"size",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],t.prototype,"surface",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],t.prototype,"suspended",void 0),(0,ze._)([(0,Qe.MZ)()],t.prototype,"ui",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],t.prototype,"userContent",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],t.prototype,"width",void 0),(0,ze._)([(0,Qe.MZ)()],t.prototype,"widthBreakpoint",void 0),t=(0,ze._)([(0,tt.$)("esri.views.DOMContainer")],t),t};var En=r(22310),Rn=r(11352),Pn=r(96138),On=r(54883);let In=class extends pt.A.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=On.sH}initialize(){this.view.basemapTerrain.on("elevation-change",(()=>this.emit("changed",{})))}get extent(){const e=this.view.basemapTerrain;if(null==e?.extent||null==e.spatialReference)return null;const t=(0,un.w1)(e.extent,e.spatialReference);return t.zmin=e.visibleElevationBounds.min,t.zmax=e.visibleElevationBounds.max,t}get spatialReference(){return this.view.basemapTerrain?.spatialReference??Bt.A.WGS84}elevationAt(e,t){if(null==this.extent||!(0,Rn.lB)(this.extent,e,t)){const r=null!=this.extent?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return Xe.A.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${r})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,t,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(e){return(0,Pn.VR)(e.clone(),this)}};(0,ze._)([(0,Qe.MZ)({readOnly:!0})],In.prototype,"demResolution",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],In.prototype,"extent",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],In.prototype,"noDataValue",void 0),(0,ze._)([(0,Qe.MZ)()],In.prototype,"spatialReference",null),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],In.prototype,"view",void 0),In=(0,ze._)([(0,tt.$)("esri.views.support.GroundViewElevationSampler")],In);const Ln=In;let Nn=class extends ht.A{constructor(e){super(e),this.view=null,this.layerViews=new je.A}initialize(){this.addHandles((0,gt.z7)((()=>this.view?.map?.ground),(e=>e.load()))),this.addHandles(this.layerViews.on("after-changes",(()=>this._layerViewsAfterChangesHandler())))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?"2d"===this.view.type?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Ln({view:this.view}):null:null}get extent(){const e=this.view;return e&&"2d"!==e.type&&e.ready?(0,En.w1)(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some((e=>e.updating))}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map((e=>(0,gt.wB)((()=>e.updating),(()=>this._updateUpdating()),gt.OH))).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Nn.prototype,"elevationSampler",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Nn.prototype,"extent",null),(0,ze._)([(0,Qe.MZ)({type:Boolean,readOnly:!0})],Nn.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Nn.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({type:je.A,readOnly:!0})],Nn.prototype,"layerViews",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Nn.prototype,"suspended",null),Nn=(0,ze._)([(0,tt.$)("esri.views.GroundView")],Nn);const Dn=Nn;var Fn=r(98773),kn=r(63241),zn=r(57308);function Un(e){return null!=e&&"open"in e&&"declaredClass"in e}function Vn(e){return null!=e&&"declaredClass"in e&&"dockOptions"in e}const Bn=e=>{let t=class extends e{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([(0,gt.wB)((()=>[this.ui,this.popup]),((e,t)=>{let[r,i]=e;const n="popup";if(t){const[e,r]=t;e&&Un(r)&&(r.view=null,Vn(r)&&e.remove(r,n))}r&&Un(i)&&(i.view=this,Vn(i)&&r.add(i,{key:n,position:"manual",internal:!0}))}),gt.Vh),this.on("click",(e=>{this.popup&&this.popupEnabled&&("mouse"!==e.pointerType||0===e.button)&&(Un(this.popup)?this.popup.viewModel.handleViewClick(e):e.async((async()=>{await this.setupPopup(),Un(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(e)})))}),zn.o.WIDGET)]),(0,gt.C_)((()=>this.ready&&this.popupEnabled&&!this.updating)).then((()=>{Promise.all([r.e(9122),r.e(792)]).then(r.bind(r,70792))}))}destroy(){this.destroyed||this.closePopup()}async openPopup(e){if(Un(this.popup))return this.popup.open(e);try{if(await this.setupPopup(),!this.popup)return void Xe.A.getLogger(this).error(new Ze.A("view:null-popup","Popup is null and can't be opened"));this.popup.open(e)}catch{}}closePopup(){this._popupSetupTask?.abort(),Un(this.popup)&&this.popup.close()}async fetchPopupFeatures(e,t){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(e,t),t)}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!Un(this.popup))return this._popupSetupTask=(0,Fn.UT)((async e=>{const{default:t}=await Promise.all([r.e(9122),r.e(792)]).then(r.bind(r,70792));if((0,Ke.Te)(e),!this.popup||Un(this.popup))return;const i=this.popup;delete i.open,delete i.close,this.popup=new t(i)})),this._popupSetupTask.promise}async _popupHitsToFeatures(e,t){let{location:r,hits:i}=e;const n=[],s=[];let o=!1;const a=(0,Ke.YL)(t,(0,it.A)("popup-view-fetch-timeout")??Hn),l=e=>{const t=s.at(-1);return t&&t.layerView===e&&!o?t:(e=>{const t=new jn(e);return s.push(t),n.push(t.promise),t})(e)};for(const u of i)"graphic"in u?(l(u.layerView).graphics.push(u.graphic),o=!1):(n.push(u.layerView.fetchPopupFeaturesAtLocation(u.mapPoint,a)),o=!0);s.map((e=>e.resolve(a)));const c=(0,Ke.nA)(n).then((e=>e.filter((e=>!!e)).flat()));return{pendingFeatures:n,allGraphicsPromise:c,location:r}}async _getPopupHits(e,t){const{hits:r,location:i}=await this.popupHitTest(e);(0,Ke.Te)(t);const n=[];for(const s of r)if("graphic"in s){if(this._isValidPopupGraphic(s.graphic,t)){const e=this._isValidPopupGraphicsLayerView(s.layerView)?s.layerView:void 0;n.push({graphic:s.graphic,layerView:e})}}else this._isValidPopupLocationLayerView(s.layerView)&&n.push({mapPoint:s.mapPoint,layerView:s.layerView});return{hits:n,location:i}}_isValidPopupGraphic(e,t){return e&&!!e.getEffectivePopupTemplate(t?.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(e){return!e||(!("layer"in e)||!e.suspended)&&"fetchPopupFeaturesFromGraphics"in e}_isValidPopupLocationLayerView(e){return(!("layer"in e)||!e.suspended)&&"fetchPopupFeaturesAtLocation"in e}};return(0,ze._)([(0,Qe.MZ)({cast(e){return!e||Un(e)||"object"==typeof e&&(e.open=e=>((0,kn.io)(Xe.A.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(e)),e.close=()=>((0,kn.io)(Xe.A.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),e}})],t.prototype,"popup",void 0),(0,ze._)([(0,Qe.MZ)()],t.prototype,"popupEnabled",void 0),t=(0,ze._)([(0,tt.$)("esri.views.PopupView")],t),t};class jn{constructor(e){this.layerView=e,this._resolver=(0,Ke.Tw)(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:t,graphics:r,_resolver:i}=this;if(!t)return i.resolve(r),i.promise;let n;return t.fetchPopupFeaturesFromGraphics(r,e).catch((e=>(n=e,null))).then((e=>{e?i.resolve(e):i.reject(n)})),i.promise}}const Hn=5e3;var Gn=r(88321),Zn=r(76797),$n=r(80963),qn=r(64519);let Wn=class extends ht.A{constructor(e){super(e),this.view=null,this.baseLayerViews=new je.A,this.referenceLayerViews=new je.A,this._loadingHandle=(0,gt.wB)((()=>this.view?.map?.basemap),(e=>{e&&e.load().catch((()=>{}))}),gt.Vh)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){if(this.view?.suspended)return!1;const e=this.view?.map?.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some((e=>e.updating))||this.referenceLayerViews.some((e=>e.updating)))}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Wn.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Wn.prototype,"baseLayerViews",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Wn.prototype,"referenceLayerViews",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Wn.prototype,"suspended",null),(0,ze._)([(0,Qe.MZ)({type:Boolean,readOnly:!0})],Wn.prototype,"updating",null),Wn=(0,ze._)([(0,tt.$)("esri.views.BasemapView")],Wn);var Yn=r(87663),Xn=r(17879);function Jn(e){return null!=e&&"object"==typeof e&&"layerViews"in e}class Kn{constructor(e,t,r){this.layer=e,this.view=t,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=(0,Ke.Tw)(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,(0,Ke.u7)(this._controller.signal,(()=>{const t=new Ze.A("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(t)}))}tryRecycle(e){if(!this.done||!this.layerView||!function(e){return"tryRecycleWith"in e}(this.layerView))return null;const t=this.layer.type,r=this._controller.signal;for(let i=0;i<e.length;i++){const n=e[i];if(n.type!==t)continue;const s=this.layerView.tryRecycleWith(n,{signal:r});if(s){e.splice(i,1),this.layer=n;const t=this.layerView,r=t.view;return this.promise=Promise.race([s.then((()=>((0,Ke.Te)(this._controller.signal),n.emit("layerview-destroy",{view:r,layerView:t}),r.emit("layerview-destroy",{view:r,layerView:t}),n.emit("layerview-create",{view:r,layerView:t}),r.emit("layerview-create",{view:r,layerView:t}),t))),new Promise(((e,t)=>(0,Ke.u7)(this._controller.signal,(()=>t((0,Ke.NK)())))))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:t,view:r}=this;t.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:t,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:r}=this;this._map=r.map;try{let n,s;if(await t.load({signal:e}),t.prefetchResources&&await t.prefetchResources({signal:e}),function(e){return"createLayerView"in e&&null!=e.createLayerView}(t))n=await t.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new Ze.A("layer:view-not-supported","No layerview implementation was found");const i=await this.layerViewImporter.importLayerView(t);(0,Ke.Te)(e),n="default"in i?new i.default({layer:t,view:r}):new i({layer:t,view:r})}const o=()=>{s=(0,Je.xt)(s),n.destroyed||n.destroy(),n.layer=null,n.parent=null,n.view=null,this.done=!0};s=(0,Ke.u7)(e,o),(0,Ke.Te)(e);try{await n.when()}catch(i){throw o(),i}const a=this._map?.allLayers?.includes(t);if(!a)return o(),void this._deferred.reject(new Ze.A("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t}));this.layerView=n,t.emit("layerview-create",{view:r,layerView:n}),r.emit("layerview-create",{layer:t,layerView:n}),this.done=!0,this._deferred.resolve(n)}catch(i){t.emit("layerview-create-error",{view:r,error:i}),r.emit("layerview-create-error",{layer:t,error:i}),this.done=!0,this._deferred.reject(new Ze.A("layerview:create-error","layerview creation failed",{layer:t,error:i}))}}}let Qn=class extends ht.A{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new bn.U,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const e=this.view.map?.allLayers;if(e)for(const t of e)this.layerViewImporter.hasLayerViewModule(t)&&this.layerViewImporter.importLayerView(t)},this._reschedule=()=>this.destroyed?Promise.reject():(null==this._workPromise&&(this._workPromise=(0,Ke.Tw)(),this._workPromise.promise.catch((()=>{}))),this.removeHandles("reschedule"),this.addHandles((0,Ji._)(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;const e=this.view.map;if(this._map!==e&&(this.clear(),this._map=e),null==this._workPromise)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const t=new Set,r=[],i=this.view.ready,n=e=>{if(null!=e)for(const s of e)if(s){t.add(s);const e=this._layerLayerViewInfoMap.get(s);e&&i?e.start():e||this._recyclingInfoMap.has(s)||r.push(s),"layers"in s&&s.layers&&n(s.layers)}};for(const o of this._rootCollectionNames)n((0,Xn.Jt)(this,o));for(const[o,a]of this._layerLayerViewInfoMap)if(!t.has(o)){this._layerLayerViewInfoMap.delete(a.layer);const e=a.tryRecycle(r);e?(this.notifyChange("updating"),this._recyclingInfoMap.set(a.layer,a),e.then((()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(a.layer),this._layerLayerViewInfoMap.set(a.layer,a),this._reschedule()})).catch((()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(a.layer),a.destroy(),this._reschedule()}))):a.destroy()}for(const[o,a]of this._recyclingInfoMap)t.has(o)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(a.layer),a.destroy());for(const o of r)this._createLayerView(o);this._refreshCollections();const s=[e?.ground?.layers,e?.basemap?.baseLayers,e?.basemap?.referenceLayers,e?.layers].filter((e=>!!e));t.forEach((e=>"layers"in e&&s.push(e.layers))),this.addHandles(s.map((e=>this._watchUpdatingTracking.addOnCollectionChange((()=>e),this._reschedule))),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([(0,gt.on)((()=>this.view?.map?.allLayers),"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),(0,gt.wB)((()=>{const e=this.view,t=e?.map;return[t?.basemap,t?.ground,t?.layers,e?.ready]}),(()=>this._reschedule()),gt.pc)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),(0,xt.X)(this._recyclingInfoMap),(0,xt.X)(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,null!=this._workPromise&&(this._workPromise.reject((0,Ke.NK)()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return null!=this._workPromise||this._watchUpdatingTracking.updating||(0,Yn.Bs)(this._layerLayerViewInfoMap,(e=>!e.done))||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){this.destroyed||((0,xt.X)(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new Ze.A("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}isCreatingLayerViewsForLayer(e,t){this.commitProperty("updatingRemaining");const r=this._layerLayerViewInfoMap.get(e);if(!r?.done)return!0;const i=r.layerView;return!(!i||!t||i.parent===t)||!!(r.done&&i&&"layers"in e&&e.layers?.length)&&e.layers.some((e=>this.isCreatingLayerViewsForLayer(e,i)))}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners((0,Xn.Jt)(this,e),(0,Xn.Jt)(this,t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,r){if(!e||!t)return void(t&&t.removeAll());let i=0;for(const n of e){const e=this._layerLayerViewInfoMap.get(n);if(!e?.layerView)continue;const s=e.layerView;s.layer=n,s.parent=r,t.at(i)!==s&&t.splice(i,0,s),"layers"in n&&Jn(s)&&this._populateLayerViewsOwners(n.layers,s.layerViews,s),i+=1}i<t.length&&t.splice(i,t.length)}_createLayerView(e){e.load().catch((()=>{})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new Kn(e,this.view,this.layerViewImporter);t.promise.then((()=>this._refreshCollections()),(t=>{t&&((0,Ke.zf)(t)||"cancelled:layerview-create"===t.name)||Xe.A.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:t}),this._refreshCollections()})),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};(0,ze._)([(0,Qe.MZ)()],Qn.prototype,"_workPromise",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Qn.prototype,"_watchUpdatingTracking",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Qn.prototype,"_layersToLayerViews",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Qn.prototype,"_rootCollectionNames",null),(0,ze._)([(0,Qe.MZ)()],Qn.prototype,"layerViewImporter",void 0),(0,ze._)([(0,Qe.MZ)()],Qn.prototype,"supportsGround",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Qn.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Qn.prototype,"updatingRemaining",null),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Qn.prototype,"view",void 0),Qn=(0,ze._)([(0,tt.$)("esri.views.LayerViewManager")],Qn);const es=Qn;let ts=class extends ht.A{constructor(e){super(e),this.factor=1.5,this.offset=(0,Ki.tc)(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};(0,ze._)([(0,Qe.MZ)({type:Number})],ts.prototype,"factor",void 0),(0,ze._)([(0,Qe.MZ)({nonNullable:!0})],ts.prototype,"offset",void 0),(0,ze._)([(0,Qe.MZ)()],ts.prototype,"position",void 0),(0,ze._)([(0,Qe.MZ)({type:Number,range:{min:0}})],ts.prototype,"size",void 0),(0,ze._)([(0,Qe.MZ)()],ts.prototype,"maskUrl",void 0),(0,ze._)([(0,Qe.MZ)()],ts.prototype,"maskEnabled",void 0),(0,ze._)([(0,Qe.MZ)()],ts.prototype,"overlayUrl",void 0),(0,ze._)([(0,Qe.MZ)()],ts.prototype,"overlayEnabled",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],ts.prototype,"version",null),(0,ze._)([(0,Qe.MZ)({type:Boolean})],ts.prototype,"visible",void 0),ts=(0,ze._)([(0,tt.$)("esri.views.Magnifier")],ts);const rs=ts;var is=r(67993),ns=r(41289),ss=r(68295);function os(e){return!!(null!=e&&"object"==typeof e&&"createQuery"in e&&e.createQuery&&"on"in e&&e.on)}let as=class extends pt.A.EventedAccessor{constructor(e){super(e),this._selectionMap=new is.A,this._sources=new je.A,this._trashCan=[],this._layerEditHandles=new je.A,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([(0,gt.wB)((()=>[this.view,this.showHighlight]),(()=>this._refreshVisualization())),(0,gt.on)((()=>this.sources),"change",(e=>{const t=this._selectionMap;for(const r of e.removed)t.delete(r);this._refreshListeners(),this._refreshVisualization()}),{onListenerAdd:()=>this._refreshListeners()})]);const e=new je.A;this.view.when().then((()=>{this.view.map&&(this.view.map.allLayers.flatten((e=>"sublayers"in e&&e.sublayers?e.sublayers:null)).forEach((t=>{(os(t)&&!(0,vt.F2)(t)||(0,vt.Sv)(t))&&e.add(t)})),this.sources=e)}))}destroy(){this._layerEditHandles.drain(Je.xt)}get selections(){return Array.from(this._selectionMap.entries()).map((e=>{const[t,r]=e;return{layer:t,selection:[...r.selection]}}))}get count(){let e=0;for(const t of this._selectionMap.values())e+=t.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){(0,He.V)(e,this._sources)}async getSelectedFeatures(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layerView";const{view:i,selections:n}=this,s=(void 0!==e?n.filter((t=>e.includes(t.layer))):n).filter((e=>e.selection.length>0)).map((async e=>{const{layer:n,selection:s}=e,o=(0,vt.Sv)(n)?n.parent:n;if(null==o||!cs(o))return null;if("layer"===r)return hs(o,s,t);if(ls(o))return null;const a=await i.whenLayerView(o).catch((()=>null));return a?hs(a,s,t):null}));return(await Promise.all(s)).filter((e=>null!=e))}updateSelection(e){const t=new Map;for(const[n,s]of this._selectionMap)t.set(n,[...s.selection]);let r=!1;const i=e.current.concat(e.added);for(const n of i){const e=n.sourceLayer,i=n.getObjectId();if(this.sources.includes(e)&&(os(e)||(0,vt.Sv)(e))&&null!==i){const n=(0,Yn.tE)(t,e,(()=>[]));n.includes(i)||(n.push(i),r=!0)}}for(const n of e.removed){const e=n.sourceLayer,i=n.getObjectId();if(this.sources.includes(e)&&(os(e)||(0,vt.Sv)(e))&&null!==i){const n=t.get(e),s=n?.indexOf(i);void 0!==s&&s>=0&&(n?.splice(s,1),r=!0)}}if(r){const{_selectionMap:e,_trashCan:r}=this,i=[];for(const[n,s]of t){const t=e.get(n);void 0!==t&&r.push(t),e.set(n,{selection:s}),i.push({layer:n,selection:s,...(0,Dt.iv)(void 0!==t?t.selection:[],s)})}this._onSelectionChange(i)}}setSelection(e,t){this._setSelection(e,t)}getSelection(e){const t=this._selectionMap.get(e);return t?.selection}appendToSelection(e,t){const r=this._selectionMap.get(e),i=void 0!==r?[...r.selection]:[];for(const n of t)i.includes(n)||i.push(n);this._setSelection(e,i)}removeFromSelection(e,t){const r=this._selectionMap.get(e);if(!r)return;const i=[];for(const n of r.selection)t.includes(n)||i.push(n);this._setSelection(e,i)}toggleInSelection(e,t){const r=this._selectionMap.get(e);if(!r||0===r.selection.length)return void this._setSelection(e,t);const i=new Set(r.selection),n=new Set(t),s=(0,ns.BT)(i,n);this._setSelection(e,Array.from(s))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const t=[];for(const[r,i]of this._selectionMap.entries())t.push({layer:r,added:[],removed:[...i.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(t)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){if(null==this.view||null==this.sources)return;for(this._vizTaskId++;this._trashCan.length>0;){const e=this._trashCan.pop();e?.highlightHandle?.remove()}const{sources:e,view:t,_selectionMap:r,showHighlight:i}=this,n=this._vizTaskId;for(const s of e){const e=r.get(s),o=(0,vt.Sv)(s)?s.parent:s;if(null!=o&&cs(o)){if(ls(o))continue;t.whenLayerView(o).then((t=>{e?.highlightHandle?.remove(),null!=e&&i&&n===this._vizTaskId&&"highlight"in t&&"function"==typeof t.highlight&&e.selection.length>0&&(e.highlightHandle=t.highlight(e.selection,"selection"))})).catch((()=>{e?.highlightHandle?.remove()}))}}}_refreshListeners(){this._layerEditHandles.drain(Je.xt);for(const e of this.sources){const t=(0,vt.Sv)(e)?e.parent:e;if(null!=t&&os(t)){const r=t.on("edits",(t=>{this._handleEditChanges(t,e)}));this._layerEditHandles.push(r)}}}_handleEditChanges(e,t){if(void 0!==e.deletedFeatures&&e.deletedFeatures.length>0&&this._selectionMap.has(t)){const r=e.deletedFeatures.filter((e=>null==e.error)).map((e=>e.objectId)).filter(Dt.Ru);this.removeFromSelection(t,r)}}_setSelection(e,t){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const r=this._selectionMap.get(e);if(void 0===r||!us(r,{selection:t})){void 0!==r&&this._trashCan.push(r),this._selectionMap.set(e,{selection:[...t]});const i={layer:e,selection:[...t],...(0,Dt.iv)(void 0!==r?r.selection:[],t)};this._onSelectionChange([i])}}};(0,ze._)([(0,Qe.MZ)({readOnly:!0,nonNullable:!0})],as.prototype,"selections",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0,nonNullable:!0})],as.prototype,"count",null),(0,ze._)([(0,Qe.MZ)({constructOnly:!0,nonNullable:!0})],as.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0,nonNullable:!0})],as.prototype,"hasSelection",null),(0,ze._)([(0,Qe.MZ)()],as.prototype,"showHighlight",void 0),(0,ze._)([(0,Qe.MZ)()],as.prototype,"sources",null),as=(0,ze._)([(0,tt.$)("esri.views.SelectionManager")],as);const ls=e=>(0,vt.Sv)(e)?!0===e.parent?.isTable:e.isTable,cs=e=>void 0!==e?.when,us=(e,t)=>{if(null==e&&null==t)return!0;if(null!=e&&null==t||null==e&&null!=t)return!1;if(null!=e&&null!=t&&null!=e.selection&&null!=t.selection){const r=[...e.selection],i=[...t.selection];if(r.length!==i.length)return!1;r.sort(),i.sort();for(let e=0;e<r.length;e++)if(r[e]!==i[e])return!1}return!0},hs=async function(e,t){let r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if((e=>void 0!==e.layer)(e)){const n=e;r=void 0===n?null:await n.queryFeatures(new ss.A({...i,objectIds:t})).then((t=>({data:t,layer:e.layer})))}else{const n=e;r=void 0===n?null:await n.queryFeatures(new ss.A({...i,objectIds:t})).then((e=>({data:e,layer:n})))}return r},ds=as;let ps=class extends((0,Qt.O)(ht.A)){constructor(e){super(e),this.accentColor=new Be.A([255,127,0]),this.textColor=new Be.A([255,255,255])}};(0,ze._)([(0,Qe.MZ)({type:Be.A,nonNullable:!0})],ps.prototype,"accentColor",void 0),(0,ze._)([(0,Qe.MZ)({type:Be.A,nonNullable:!0})],ps.prototype,"textColor",void 0),ps=(0,ze._)([(0,tt.$)("esri.views.Theme")],ps);const fs=ps;var ms=r(50176),gs=r(71732),ys=r(76336);function _s(e){return[e.on("before-add",(t=>{const r=t.item;if(null==r||e.includes(r))return Xe.A.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();r.onAdd()})),e.on("after-remove",(e=>{const t=e.item;t.active&&(t.view.activeTool=null),t.destroy()}))]}function vs(e){return e.visible&&null!=e.getEditableFlag&&e.getEditableFlag(ys.PK.USER)&&e.getEditableFlag(ys.PK.MANAGER)}var bs=r(85361),ws=r(15941),xs=r(11500);class Ss{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,t){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":As(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!Cs(e))break;const i=(0,xs.ZV)(e),n=Ms(i,e.pointerType,t.forEachTool);if(null==n)break;const s=n.manipulator,o=n.tool;null==s||null==o||!s.interactive||s.grabbable&&s.grabbableForEvent(e)||!s.grabbing||s.dragging||this._releaseManipulatorBeforeDragging(s,e,t),null!=s&&null!=o&&s.interactive&&s.grabbable&&s.grabbableForEvent(e)&&!s.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:s,tool:o,start:i,pointerType:e.pointerType}),1===this._grabbedManipulators.size&&null==t.activeTool&&(this._revertToNullActiveTool=!0,t.setActiveTool(n.tool)),s.grabbing=!0,s.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:i}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!Cs(e))break;const i=this._grabbedManipulators.get(e.pointerId),n=i?.manipulator,s=i?.tool;if(null==n||null==s)break;const o=(0,xs.ZV)(e);o.x=(0,ws.qE)(o.x,0,t.view.width),o.y=(0,ws.qE)(o.y,0,t.view.height);const a=i.start,l=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":"update"!==e.action&&1!==this._grabbedManipulators.size||(n.dragging=!0,l?n.events.emit("drag",{action:"update",start:a,screenPoint:o}):n.events.emit("drag",{action:"start",start:a,screenPoint:o,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:s,manipulator:n,start:a}));break;case"end":n.dragging=!1,l&&n.events.emit("drag",{action:"end",start:a,screenPoint:o}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}r();break}case"immediate-click":{const i=(0,xs.ZV)(e),n=Ms(i,e.pointerType,t.forEachTool);if(function(e){return!!e.native.shiftKey}(e)||t.forEachTool((e=>{if((null==n||n.tool!==e||e.automaticManipulatorSelection)&&e.manipulators){let t=!1;e.manipulators.forEach((e=>{let{manipulator:r}=e;r.selected&&(r.selected=!1,t=!0)})),t&&e.onManipulatorSelectionChanged&&e.onManipulatorSelectionChanged()}})),null==n)break;const{manipulator:s,tool:o}=n;if(!s.interactive)break;s.selectable&&o.automaticManipulatorSelection&&(s.selected=!s.selected,o.onManipulatorSelectionChanged&&o.onManipulatorSelectionChanged());const a=e.native.shiftKey;s.events.emit("immediate-click",{screenPoint:i,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),Es(s,r);break}case"click":{const i=(0,xs.ZV)(e),n=Ms(i,e.pointerType,t.forEachTool),s=n?.manipulator;if(null==s||!s.interactive)break;const o=e.native.shiftKey;s.events.emit(e.type,{screenPoint:i,button:e.button,pointerType:e.pointerType,shiftKey:o}),r();break}case"double-click":{const i=(0,xs.ZV)(e),n=Ms(i,e.pointerType,t.forEachTool),s=null!=n?n.manipulator:null;if(null==s||!s.interactive)break;const o=e.native.shiftKey;s.events.emit("double-click",{screenPoint:i,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:r}),Es(s,r);break}case"immediate-double-click":{const i=(0,xs.ZV)(e),n=Ms(i,e.pointerType,t.forEachTool),s=null!=n?n.manipulator:null;if(null==s||!s.interactive)break;const o=e.native.shiftKey;s.events.emit("immediate-double-click",{screenPoint:i,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:r}),Es(s,r);break}}this._onFocusChange(t.forEachTool)}_releaseManipulatorBeforeDragging(e,t,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:(0,xs.ZV)(t)}),this._grabbedManipulators.forEach(((t,r)=>{let{manipulator:i}=t;i===e&&this._grabbedManipulators.delete(r)})),this._afterManipulatorRelease(r.setActiveTool)}_handlePointerEnd(e,t){const r=this._grabbedManipulators.get(e.pointerId)?.manipulator;null!=r&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:(0,xs.ZV)(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(t.setActiveTool))}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=Ts(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=Ts(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const t=new Set,r=new Set;this._grabbedManipulators.forEach((e=>{let{tool:r}=e;t.add(r)})),this._hoveredManipulators.forEach((e=>{let{tool:t}=e;r.add(t)})),e((e=>{e.hasGrabbedManipulators=t.has(e),e.hasHoveredManipulators=r.has(e);const i=this._grabbedManipulators.values(),n=(0,bs.I6)(i,(t=>{let{tool:r}=t;return r===e}));e.firstGrabbedManipulator=null!=n?n.manipulator:null}))}clearPointers(e,t){let{forEachTool:r,setActiveTool:i}=t,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3?arguments[3]:void 0;const o=(t,r)=>t===e&&(null==s||s===r);this._grabbedManipulators.forEach(((e,t)=>{let{tool:r,manipulator:i,pointerType:n}=e;o(r,i)&&(this._grabbedManipulators.delete(t),i.grabbing=!1,i.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:n}))})),this._draggedManipulators.forEach(((e,t)=>{let{tool:r,manipulator:i}=e;o(r,i)&&(this._draggedManipulators.delete(t),i.dragging=!1,i.events.emit("drag",{action:"cancel"}))})),n&&this._hoveredManipulators.forEach(((e,t)=>{let{tool:r,manipulator:i}=e;o(r,i)&&(this._hoveredManipulators.delete(t),i.hovering=!1)})),this._afterManipulatorRelease(i),this._onFocusChange(r)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach(((t,r)=>{this._updateHoveredStateForPointerAtScreenPosition((0,Ki.tc)(t.x,t.y),r,t.pointerType,e)}))}handleHoverEvent(e,t){"pointer-up"!==e.type&&"immediate-click"!==e.type&&"pointer-move"!==e.type||!As(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition((0,xs.ZV)(e),e.pointerId,e.pointerType,t)}_updateHoveredStateForPointerAtScreenPosition(e,t,r,i){let n=Ms(e,r,i);const s=this._hoveredManipulators.get(t)?.manipulator;null==n||n.manipulator.interactive||(n=null),null!=n&&s===n.manipulator||(null!=s&&(s.hovering=!1),null!=n?(n.manipulator.hovering=!0,this._hoveredManipulators.set(t,n)):this._hoveredManipulators.delete(t),this._onFocusChange(i))}_afterManipulatorRelease(e){0===this._grabbedManipulators.size&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}}function Ts(e){let t=null;return(0,Yn.Bs)(e,(e=>{let{manipulator:r}=e;return!(null==r||!r.interactive)&&(r.grabbing&&r.grabCursor?(t=r.grabCursor,!0):!!r.cursor&&(t=r.cursor,!0))})),t}function Ms(e,t,r){let i=null;return r((r=>{if(null==r.manipulators||!vs(r))return!1;const n=r.manipulators.intersect(e,t);return null!=n&&(i={tool:r,manipulator:n},!0)})),i}function As(e){return"mouse"===e}function Cs(e){return"mouse"!==e.pointerType||0===e.button}function Es(e,t){e?.consumesClicks&&t()}const Rs="attached",Ps="tools";let Os=class extends ht.A{constructor(e){super(e),this._updatingHandles=new bn.U,this._clock=ms.p,this._manipulatorState=new Ss,this.tools=new je.A,this.cursor=null,this._interacting=!1,this._interactingTimeout=1e3,this._interactingTimeoutHandle=null,this._forEachTool=e=>{for(const t of this.tools.items)if(e(t))return}}initialize(){this.addHandles([this.view.on(gs.mu,(e=>{this._handleInputEvent(e)}),zn.o.TOOL),..._s(this.tools),this.tools.on("before-add",(e=>{let{item:t}=e;this._updateToolEditableFlag(t)})),this.tools.on("before-remove",(e=>{let{item:t}=e;this._manipulatorState.clearPointers(t,this._manipulatorStateEventArgs),this._updateCursor()})),this.tools.on("change",(()=>{this._refreshToolWatchers()}))])}destroy(){this.activeTool=null,this.tools.drain((e=>e.destroy())),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(null!=e&&!this.view.ready)return void Xe.A.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),null!=t&&t.deactivate(),null!=e&&e.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const e=vs(r);null!=this.activeTool&&e||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!e)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some((e=>e.updating))}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=(0,Je.xt)(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout((()=>this._interacting=!1),this._interactingTimeout)}attach(){"3d"===this.view.type?this.addHandles([(0,gt.wB)((()=>{const{state:e}=this.view;return"camera"in e&&e.camera}),(()=>this._forEachManipulator((e=>e.onViewChange())))),this.view.elevationProvider?.on("elevation-change",(e=>this._forEachManipulator((t=>t.onElevationChange(e)))))],Rs):this.addHandles((0,gt.wB)((()=>this.view.extent),(()=>this._forEachManipulator((e=>e.onViewChange())))))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(Rs),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool((t=>{t.manipulators&&t.manipulators.forEach((r=>{let{manipulator:i}=r;return e(i,t)}))}))}_handleInputEvent(e){let t=!1;const r={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};null!=this.activeTool?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool((e=>{!t&&e.visible&&e.handleInputEvent(r)})),!t&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),t||null==this.activeTool||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor(),"pointer-move"===e.type&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(Ps),this._forEachTool((e=>{if(e instanceof ht.A){const t=(0,gt.wB)((()=>[e.cursor,e.visible,e.editable]),(()=>{vs(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}));this.addHandles(t,Ps)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",(t=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,t.item.manipulator)})),e.manipulators.on("change",(()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}))],Ps)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(ys.PK.MANAGER,null==this.activeTool||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;null==e&&this._forEachTool((t=>!(null==t.cursor||!t.visible)&&(e=t.cursor,!0))),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter((t=>(null==e||t!==e)&&!t.created&&t.removeIncompleteOnCancel)).forEach((e=>{this.tools.remove(e)}))}get test(){}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0,nonNullable:!0})],Os.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({value:null})],Os.prototype,"activeTool",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0,type:je.A})],Os.prototype,"tools",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Os.prototype,"cursor",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Os.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)()],Os.prototype,"_interacting",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Os.prototype,"interacting",null),Os=(0,ze._)([(0,tt.$)("esri.views.ToolViewManager")],Os);let Is=class extends ht.A{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown","standard"===e.mapping?this._detectedDeviceType="standard":Ns.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return null!=this.nativeIndex&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Ds[this.deviceType]}};(0,ze._)([(0,Qe.MZ)({nonNullable:!0,readOnly:!0})],Is.prototype,"nativeIndex",void 0),(0,ze._)([(0,Qe.MZ)({type:String,readOnly:!0})],Is.prototype,"deviceType",null),(0,ze._)([(0,Qe.MZ)({type:Number,readOnly:!0})],Is.prototype,"axisThreshold",null),Is=(0,ze._)([(0,tt.$)("esri.views.input.gamepad.GamepadInputDevice")],Is);const Ls=Is,Ns=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Ds={standard:.15,spacemouse:.025,unknown:0};let Fs=class extends ht.A{constructor(){super(...arguments),this.devices=new je.A,this.enabledFocusMode="document"}};(0,ze._)([(0,Qe.MZ)({type:je.A.ofType(Ls),readOnly:!0})],Fs.prototype,"devices",void 0),(0,ze._)([(0,Qe.MZ)({type:["document","view","none"]})],Fs.prototype,"enabledFocusMode",void 0),Fs=(0,ze._)([(0,tt.$)("esri.views.input.gamepad.GamepadSettings")],Fs);const ks=Fs;let zs=class extends ht.A{constructor(){super(...arguments),this.gamepad=new ks}};(0,ze._)([(0,Qe.MZ)({readOnly:!0})],zs.prototype,"gamepad",void 0),zs=(0,ze._)([(0,tt.$)("esri.views.input.Input")],zs);const Us=zs;var Vs=r(17555);let Bs=class extends ht.A{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};(0,ze._)([(0,Qe.MZ)({type:Boolean,nonNullable:!0})],Bs.prototype,"enabled",void 0),(0,ze._)([(0,Qe.MZ)({type:Ls})],Bs.prototype,"device",void 0),(0,ze._)([(0,Qe.MZ)({type:["pan","zoom"],nonNullable:!0})],Bs.prototype,"mode",void 0),(0,ze._)([(0,Qe.MZ)({type:["forward-down","forward-up"],nonNullable:!0})],Bs.prototype,"tiltDirection",void 0),(0,ze._)([(0,Qe.MZ)({type:Number,nonNullable:!0})],Bs.prototype,"velocityFactor",void 0),Bs=(0,ze._)([(0,tt.$)("esri.views.navigation.gamepad.GamepadSettings")],Bs);const js=Bs;let Hs=class extends ht.A{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new js,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!(0,Vs.O)()}};(0,ze._)([(0,Qe.MZ)({type:Boolean})],Hs.prototype,"browserTouchPanEnabled",void 0),(0,ze._)([(0,Qe.MZ)({type:js,nonNullable:!0})],Hs.prototype,"gamepad",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean})],Hs.prototype,"momentumEnabled",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean})],Hs.prototype,"mouseWheelZoomEnabled",void 0),Hs=(0,ze._)([(0,tt.$)("esri.views.navigation.Navigation")],Hs);const Gs=Hs;var Zs=r(47700),$s=r(64465);let qs,Ws=null;async function Ys(e){Ws||(Ws=Promise.resolve().then(r.bind(r,39483)).then((e=>qs=e))),await Ws,(0,Ke.Te)(e)}async function Xs(e,t,r,i){if(!e)return null;const n=e.spatialReference;return(0,an.isLoaded)()||(0,an.canProjectWithoutEngine)(n,t)?(0,an.project)(e,t):qs?qs.projectGeometry(e,t,r,i):(await Promise.race([Ys(i),(0,an.load)(i)]),Xs(e,t,r,i))}let Js=class extends ht.A{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=(0,Je.DC)(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return null==this.userSpatialReference||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){const e=this.map?.(),t=[];return null!=this.priorityCollection&&t.push(this.priorityCollection),t.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;let r=null;for(const n of e){const e=this._getSupportedSpatialReferences(n);if(e.length>0){const t=this._narrowDownSpatialReferenceCandidates(r,e);null!=t&&(r=t)}if(null!=r&&1===r.length)break}if(t&&(null==r||1!==r.length))return{updating:!0};const i=this._pickSpatialReferenceCandidate(r);return{spatialReference:i?.spatialReference??null,viewingMode:i?.viewingMode??null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:this.map?.()?.basemap,layers:this.map?.()?.basemap?.baseLayers},{layers:this.map?.()?.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const t=e[0].tileInfo;return{tileInfo:t?.spatialReference.equals(this.spatialReference)?t:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const r of e)if((0,Zs.jI)(r)){const e=(0,Zs.zy)(r);if(e)return{heightModelInfo:e,vcsWkid:r.spatialReference?.vcsWkid,latestVcsWkid:r.spatialReference?.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,r=[];for(const i of e.layers){const e="fullExtents"in i&&i.fullExtents||(null!=i.fullExtent?[i.fullExtent]:[]),t=this.requiresExtentInSpatialReference?null:e[0],n=e.find((e=>e.spatialReference.equals(this.spatialReference)))??t;if(n)return{candidates:[{extent:n,layer:i}],updating:!1};if(this._getSupportedSpatialReferences(i).length>0)for(const s of e)r.push({extent:s,layer:i})}return{candidates:r,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(null==e||0===e.length)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),i=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&i.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:null!=this._projectExtentTask.task&&!this._projectExtentTask.task.finished}:(null!=this._projectExtentTask.task&&(this._projectExtentTask.task=(0,Je.DC)(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:i.clone(),task:(0,Fn.UT)((async e=>{try{const t=await Xs(r.extent,i,"portalItem"in r.layer?r.layer.portalItem:void 0,e);this._projectExtentTask={...this._projectExtentTask,task:null,output:t}}catch(t){if((0,Ke.G4)(e))return;this._projectExtentTask={...this._projectExtentTask,task:null}}}))},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(null==e)return t;const r=new Array;for(const i of e)for(const e of t){if(!i.spatialReference.equals(e.spatialReference))continue;const t=Qs(i.viewingMode,e.viewingMode);if(!1!==t){r.push({spatialReference:i.spatialReference,viewingMode:t});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return null==e||e.length<1?t?{spatialReference:t,viewingMode:null}:null:(null!=t&&e.length>1&&e.some((e=>{let{spatialReference:r}=e;return r.equals(t)}))&&(e=e.filter((e=>{let{spatialReference:r}=e;return r.equals(t)}))),e.length>1&&e.some((e=>{let{viewingMode:t}=e;return t!==$s.RT.Local}))&&(e=e.filter((e=>{let{viewingMode:t}=e;return t!==$s.RT.Local}))),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===t.length)return[];const r=[];for(const i of t){const t=this.getSpatialReferenceSupport(i,e);if(null!=t){const e=t.constraints??[{spatialReference:i,viewingMode:null}];for(const{spatialReference:t,viewingMode:i}of e)this.requiresExtentInSpatialReference&&null!=this.userSpatialReference&&!t.equals(this.userSpatialReference)||r.push({spatialReference:t,viewingMode:i})}}return r}_pickExtentCandidate(e){const t=this.spatialReference;return e.find((e=>{let{extent:r}=e;return t.equals(r.spatialReference)}))||e[0]}_collectLayers(e){if("loaded"!==this._loadMaybe(this.map?.()))return{layers:[],updating:!0};const t=new Ks;for(const r of e)if(this._collectCollection(r,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&null!=e.loadStatus?"not-loaded"===e.loadStatus?(e.load().catch((e=>{(0,Ke.zf)(e)||console.log(e)})),"loading"):e.loadStatus:"loaded"}};(0,ze._)([(0,Qe.MZ)()],Js.prototype,"required",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Js.prototype,"map",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Js.prototype,"getSpatialReferenceSupport",void 0),(0,ze._)([(0,Qe.MZ)()],Js.prototype,"defaultSpatialReference",void 0),(0,ze._)([(0,Qe.MZ)()],Js.prototype,"userSpatialReference",void 0),(0,ze._)([(0,Qe.MZ)()],Js.prototype,"sourcePreloadCount",void 0),(0,ze._)([(0,Qe.MZ)()],Js.prototype,"priorityCollection",void 0),(0,ze._)([(0,Qe.MZ)()],Js.prototype,"requiresExtentInSpatialReference",void 0),(0,ze._)([(0,Qe.MZ)()],Js.prototype,"suspended",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Js.prototype,"ready",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Js.prototype,"heightModelInfoReady",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Js.prototype,"spatialReference",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Js.prototype,"extent",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Js.prototype,"heightModelInfo",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Js.prototype,"vcsWkid",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Js.prototype,"latestVcsWkid",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Js.prototype,"viewingMode",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Js.prototype,"tileInfo",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Js.prototype,"mapCollections",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Js.prototype,"_allLayers",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Js.prototype,"_spatialReferenceTask",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Js.prototype,"_tileInfoTask",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Js.prototype,"_heightModelInfoTask",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Js.prototype,"_extentCandidatesTask",null),(0,ze._)([(0,Qe.MZ)()],Js.prototype,"_extentTask",null),(0,ze._)([(0,Qe.MZ)()],Js.prototype,"_projectExtentTask",void 0),Js=(0,ze._)([(0,tt.$)("esri.views.support.DefaultsFromMap")],Js);class Ks{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}}function Qs(e,t){return null!=e?null!=t?e===t&&e:e:t}var eo;let to=eo=class extends(pt.A.EventedMixin((0,kt.g)(ht.A))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.handles=new Gn.A,this.updatingHandles=new bn.U,this.allLayerViews=new dt.A({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:io}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new qn.Y,this.analyses=new fn,this.typeSpecificPreconditionsReady=!0,this.layerViews=new je.A,this.magnifier=new rs,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Us,this.navigation=new Gs,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new gs.XF(this),this.persistableViewModels=new je.A,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add((0,gt.wB)((()=>this.preconditionsReady),(e=>{const t=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,eo.views.add(this)):(this._lockedSpatialReference=null,eo.views.remove(this)),this.notifyChange("spatialReference"),!e&&t)this.toolViewManager?.detach(),null!=this.analysisViewManager&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown();else if(e&&!t){try{this._startup()}catch(r){return void queueMicrotask((()=>{this.fatalError=new Ze.A("startup-error",null,r)}))}null!=this.analysisViewManager&&this.analysisViewManager.attach(),this.toolViewManager.attach()}}),gt.OH))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then((()=>(this._isValid=!0,(0,gt.C_)((()=>this.ready)))))),this.basemapView=new Wn({view:this}),this.layerViewManager=new es({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new Os({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new ds({view:this}),this.addHandles([(0,gt.wB)((()=>this.initialExtentRequired),(e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e}),gt.pc),(0,gt.wB)((()=>this.ready),(e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)}),gt.OH),(0,gt.wB)((()=>this._userSpatialReference),(e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)}),gt.pc)])}_setupSpatialReferenceLogger(){let e=null;this.addHandles([(0,gt.wB)((()=>this.defaultsFromMap?.ready),(t=>{const r=this.map?.allLayers.length>0;if(t&&!this.spatialReference&&r){if(null!=e)return;const t=(0,mt.hA)((()=>e=(0,Je.DC)(e)));e=(0,Fn.UT)((async t=>{try{await(0,Ke.Pl)(this.spatialReferenceWarningDelay,null,t)}catch{return}finally{e=null}Xe.A.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})),this.addHandles(t,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")}),{sync:!0})])}destroy(){this.destroyed||(eo.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=(0,Je.pR)(this.graphics),this.analyses=(0,Je.pR)(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),(0,Je.pR)(this.analysisViewManager),this.toolViewManager=(0,Je.pR)(this.toolViewManager),this.layerViewManager=(0,Je.pR)(this.layerViewManager),this.selectionManager=(0,Je.pR)(this.selectionManager),this.basemapView=(0,Je.pR)(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach((e=>e.destroy())),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=(0,Je.pR)(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return Xe.A.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(e){this.toolViewManager&&(this.toolViewManager.activeTool=e)}get animation(){return this._get("animation")}set animation(e){this._set("animation",e)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Js({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(e,t)=>this.getSpatialReferenceSupport(e,t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(e){this._set("extent",e)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||We.A.isLoadable(this.map)&&!this.map.loaded||0===this.width||0===this.height||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(e){e!==this._get("map")&&(e?.destroyed&&(Xe.A.getLogger(this).warn("#map","The provided map is already destroyed",{map:e}),e=null),We.A.isLoadable(e)&&e.load().catch((()=>{})),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",e))}get spatialReference(){const e=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(e&&this.defaultsFromMap?.required?.heightModelInfo){const t=e.clone();return t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,t}return e}set spatialReference(e){const t=!(0,$n.aI)(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??Li.qU}set timeZone(e){const t=new Set(["etc/utc","etc/gmt","gmt"]),r=new Set(Intl.supportedValuesOf("timeZone").map((e=>e.toLowerCase())));this._userTimeZone=e,e===Li.qU||e===Li.L5||t.has(e.toLowerCase())||r.has(e.toLowerCase())||Xe.A.getLogger(this).warn("#timeZone",`the parsed value '${e}' may not be a valid IANA time zone`)}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){return this.toolViewManager?.cursor??this._cursor??"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new fs}whenLayerView(e){return this.layerViewManager?.whenLayerView(e)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}getDefaultTimeZone(){return null}importLayerView(e){throw new Ze.A("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return null!=this.getSpatialReferenceSupport(e)}when(e,t){return this.isResolved()&&!this.ready&&Xe.A.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&((0,gt.z7)((()=>this.destroyed||!1===this.preconditionsReady),(()=>this._readyCycleForced=!1),{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};to.views=new je.A,(0,ze._)([(0,Qe.MZ)()],to.prototype,"_userSpatialReference",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"activeTool",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"allLayerViews",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"groundView",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"animation",null),(0,ze._)([(0,Qe.MZ)()],to.prototype,"basemapView",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"center",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"_defaultsFromMapSettings",null),(0,ze._)([(0,Qe.MZ)()],to.prototype,"defaultsFromMap",null),(0,ze._)([(0,Qe.MZ)()],to.prototype,"fatalError",void 0),(0,ze._)([(0,Qe.MZ)({type:Zn.A})],to.prototype,"extent",null),(0,ze._)([(0,Qe.MZ)((0,sn.C)(qn.Y,"graphics"))],to.prototype,"graphics",void 0),(0,ze._)([(0,Qe.MZ)((0,sn.C)(fn,"analyses"))],to.prototype,"analyses",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0,type:on.A})],to.prototype,"heightModelInfo",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"interacting",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"navigating",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],to.prototype,"preconditionsReady",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"typeSpecificPreconditionsReady",void 0),(0,ze._)([(0,Qe.MZ)({type:je.A,readOnly:!0})],to.prototype,"layerViews",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"resolution",null),(0,ze._)([(0,Qe.MZ)({type:rs})],to.prototype,"magnifier",void 0),(0,ze._)([(0,Qe.MZ)({value:null,type:Ct})],to.prototype,"map",null),(0,ze._)([(0,Qe.MZ)()],to.prototype,"padding",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"ready",void 0),(0,ze._)([(0,Qe.MZ)({type:Bt.A})],to.prototype,"spatialReference",null),(0,ze._)([(0,Qe.MZ)()],to.prototype,"spatialReferenceWarningDelay",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"stationary",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"supportsGround",void 0),(0,ze._)([(0,Qe.MZ)({type:Dr.A})],to.prototype,"timeExtent",void 0),(0,ze._)([(0,Qe.MZ)({type:String,nonNullable:!0})],to.prototype,"timeZone",null),(0,ze._)([(0,Qe.MZ)()],to.prototype,"tools",null),(0,ze._)([(0,Qe.MZ)()],to.prototype,"toolViewManager",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"type",void 0),(0,ze._)([(0,Qe.MZ)({type:Number})],to.prototype,"scale",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"updating",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"initialExtentRequired",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"initialExtent",null),(0,ze._)([(0,Qe.MZ)()],to.prototype,"cursor",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"input",void 0),(0,ze._)([(0,Qe.MZ)({type:Gs,nonNullable:!0})],to.prototype,"navigation",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"layerViewManager",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"analysisViewManager",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"selectionManager",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"width",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"height",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"resizing",void 0),(0,ze._)([(0,Qe.MZ)({value:null,readOnly:!0})],to.prototype,"size",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"suspended",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"viewEvents",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],to.prototype,"persistableViewModels",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"_isValid",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"_readyCycleForced",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"_lockedSpatialReference",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"_userTimeZone",void 0),(0,ze._)([(0,Qe.MZ)()],to.prototype,"_lockedTimeZone",void 0),(0,ze._)([(0,Qe.MZ)({type:fs})],to.prototype,"theme",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0,type:fs})],to.prototype,"effectiveTheme",null),to=eo=(0,ze._)([(0,tt.$)("esri.views.View")],to);const ro=to;function io(e){return e.layerViews}let no=class extends kt.Z{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=(0,Ke.Tw)(),this.addResolvingPromise(this._resolver.promise)}get done(){return"finished"===this.state||"stopped"===this.state}stop(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),this._resolver?.reject(new Ze.A("ViewAnimation stopped")))}finish(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),this._resolver?.resolve())}update(e,t){t||(t=(0,Ke.$X)(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};(0,ze._)([(0,Qe.MZ)({readOnly:!0})],no.prototype,"done",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0,type:String})],no.prototype,"state",void 0),(0,ze._)([(0,Qe.MZ)()],no.prototype,"target",void 0),no=(0,ze._)([(0,tt.$)("esri.views.ViewAnimation")],no),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(no||(no={}));const so=no,oo=()=>Promise.all([r.e(1414),r.e(5751)]).then(r.bind(r,15751)),ao=()=>r.e(7628).then(r.bind(r,7628)),lo={"base-dynamic":()=>Promise.all([r.e(183),r.e(3431)]).then(r.bind(r,63431)),"base-elevation":ao,"base-tile":oo,"bing-maps":oo,"building-scene":()=>Promise.all([r.e(7216),r.e(3620),r.e(9122),r.e(2003),r.e(1047),r.e(9154),r.e(5370),r.e(6128),r.e(4279),r.e(3141),r.e(1967),r.e(9942),r.e(7236),r.e(8036),r.e(2010)]).then(r.bind(r,68383)),catalog:()=>r.e(5295).then(r.bind(r,55295)),"catalog-dynamic-group":()=>r.e(3035).then(r.bind(r,13035)),"catalog-footprint":()=>Promise.all([r.e(7216),r.e(3620),r.e(9122),r.e(2003),r.e(1047),r.e(9154),r.e(5370),r.e(6128),r.e(2400)]).then(r.bind(r,82400)),csv:()=>Promise.all([r.e(7216),r.e(3620),r.e(9122),r.e(2003),r.e(1047),r.e(9154),r.e(5370),r.e(6128),r.e(2381)]).then(r.bind(r,42381)),dimension:()=>r.e(5303).then(r.bind(r,65303)),elevation:ao,feature:()=>Promise.all([r.e(7216),r.e(3620),r.e(9122),r.e(2003),r.e(1047),r.e(9154),r.e(5370),r.e(6128),r.e(6427)]).then(r.bind(r,86427)),geojson:()=>Promise.all([r.e(7216),r.e(3620),r.e(9122),r.e(2003),r.e(1047),r.e(9154),r.e(5370),r.e(6128),r.e(5044)]).then(r.bind(r,75044)),graphics:()=>Promise.all([r.e(9154),r.e(4508)]).then(r.bind(r,42208)),group:()=>r.e(2339).then(r.bind(r,92339)),imagery:()=>Promise.all([r.e(183),r.e(5556)]).then(r.bind(r,25556)),"integrated-mesh":()=>Promise.all([r.e(7216),r.e(3620),r.e(9122),r.e(2003),r.e(1047),r.e(9154),r.e(5370),r.e(6128),r.e(4279),r.e(3141),r.e(1967),r.e(9942),r.e(7119)]).then(r.bind(r,47119)),"integrated-mesh-3dtiles":()=>r.e(9766).then(r.bind(r,99766)),"line-of-sight":()=>r.e(2925).then(r.bind(r,72925)),"map-image":()=>Promise.all([r.e(183),r.e(1414),r.e(3761)]).then(r.bind(r,3761)),media:()=>Promise.all([r.e(2612),r.e(4912),r.e(3454),r.e(225)]).then(r.bind(r,40225)),"ogc-feature":()=>Promise.all([r.e(7216),r.e(3620),r.e(9122),r.e(2003),r.e(1047),r.e(9154),r.e(5370),r.e(6128),r.e(4038)]).then(r.bind(r,4038)),"open-street-map":oo,"oriented-imagery":()=>Promise.all([r.e(7216),r.e(3620),r.e(9122),r.e(2003),r.e(1047),r.e(9154),r.e(5370),r.e(6128),r.e(6427)]).then(r.bind(r,86427)),"point-cloud":()=>Promise.all([r.e(4279),r.e(1869),r.e(7318)]).then(r.bind(r,37318)),voxel:()=>r.e(3669).then(r.bind(r,53669)),route:()=>Promise.all([r.e(9154),r.e(1297),r.e(3778)]).then(r.bind(r,86662)),scene:e=>null==e.profile||"mesh-pyramids"===e.profile?Promise.all([r.e(7216),r.e(3620),r.e(9122),r.e(2003),r.e(1047),r.e(9154),r.e(5370),r.e(6128),r.e(4279),r.e(3141),r.e(1967),r.e(9942),r.e(8036),r.e(9031),r.e(8001)]).then(r.bind(r,28001)):Promise.all([r.e(7216),r.e(3620),r.e(9122),r.e(2003),r.e(1047),r.e(9154),r.e(5370),r.e(6128),r.e(4279),r.e(3141),r.e(1967),r.e(9031),r.e(9637)]).then(r.bind(r,48476)),stream:()=>Promise.all([r.e(7216),r.e(3620),r.e(9122),r.e(2003),r.e(1047),r.e(9154),r.e(5370),r.e(5995),r.e(7179)]).then(r.bind(r,47179)),tile:oo,"imagery-tile":()=>Promise.all([r.e(9844),r.e(9291)]).then(r.bind(r,49291)),"vector-tile":()=>Promise.all([r.e(8376),r.e(6785)]).then(r.bind(r,6785)),wcs:()=>Promise.all([r.e(9844),r.e(9291)]).then(r.bind(r,49291)),"web-tile":oo,wfs:()=>Promise.all([r.e(7216),r.e(3620),r.e(9122),r.e(2003),r.e(1047),r.e(9154),r.e(5370),r.e(6128),r.e(9495)]).then(r.bind(r,9495)),wms:()=>Promise.all([r.e(183),r.e(6108)]).then(r.bind(r,86108)),wmts:()=>r.e(4412).then(r.bind(r,84412)),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};const co=e=>null!=lo[e.type],uo=e=>{const t=lo[e.type];if(null==t)throw function(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",r=t.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new Ze.A(`${r}:view-not-supported`,`${t} is not supported in 3D`)}(e);return t(e)},ho="analyses-owner-handles";var po,fo;!function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"}(po||(po={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(fo||(fo={}));let mo=class extends ht.A{constructor(e){super(e),this._allAnalysisViews=new je.A,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=go(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null},viewshed:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject((0,Ke.NK)("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject((0,Ke.NK)()),this._attachedToViewResolver=go()}get updating(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some((e=>e.updating))}get testInfo(){}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(null==t||t.state.list===fo.REMOVED)throw new Ze.A("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),ho)}_disconnectOwners(){this.removeHandles(ho),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const i of e)this._addAnalysis(i);const t=e.on("after-add",(e=>this._addAnalysis(e.item))),r=e.on("after-remove",(e=>this._removeAnalysis(e.item)));return(0,mt.hA)((()=>{t.remove(),r.remove();for(const t of e)this._removeAnalysis(t)}))}_addAnalysis(e){const t=this._items.get(e);if(null==t){const t={state:{view:po.PENDING,list:fo.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,t),t.createAnalysisViewTask=(0,Fn.UT)((e=>this._createAnalysisViewPromise(t,e)))}else t.state.list=fo.ADDED}_removeAnalysis(e){const t=this._items.get(e);null!=t?(t.state.list=fo.REMOVED,this._scheduleUpdate()):Xe.A.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){null==this._scheduledUpdateHandle&&(this._scheduledUpdateHandle=(0,Ji._)((()=>this._update())))}_update(){this._scheduledUpdateHandle=(0,Je.xt)(this._scheduledUpdateHandle),this._items.forEach((e=>{if(e.state.list===fo.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case po.PENDING:e.createAnalysisViewTask=(0,Je.DC)(e.createAnalysisViewTask);break;case po.CREATED:null!=e.view&&(this._allAnalysisViews.remove(e.view),e.view=(0,Je.pR)(e.view),e.createAnalysisViewTask=null)}}))}async _createAnalysisViewPromise(e,t){const r=e.analysis,i=r.type,n=this._analysisModules[i];if(this._creatingViewCount+=1,null==n.module)try{n.module=await this._loadAnalysisModule(i)}catch(o){throw this._creatingViewCount-=1,o}if((0,Ke.G4)(t))throw this._creatingViewCount-=1,(0,Ke.NK)("AnalysisView creation aborted");const s=new n.module.default({analysis:r,view:this.view});try{await s.when()}catch(o){throw this._creatingViewCount-=1,o}if((0,Ke.G4)(t))throw this._creatingViewCount-=1,s.destroy(),(0,Ke.NK)("AnalysisView creation aborted");return e.view=s,e.state.view=po.CREATED,this._allAnalysisViews.add(s),this._creatingViewCount-=1,s}_loadAnalysisModule(e){switch(e){case"area-measurement":return Promise.all([r.e(2612),r.e(9833),r.e(4912),r.e(3065),r.e(4748),r.e(6349)]).then(r.bind(r,24346));case"dimension":return Promise.all([r.e(2612),r.e(9833),r.e(5849),r.e(1307),r.e(4912),r.e(3065),r.e(8333),r.e(3454),r.e(3555),r.e(3218)]).then(r.bind(r,23218));case"direct-line-measurement":return Promise.all([r.e(2612),r.e(4912),r.e(3065),r.e(4748),r.e(3532)]).then(r.bind(r,13532));case"line-of-sight":return Promise.all([r.e(9833),r.e(5849),r.e(1307),r.e(3874)]).then(r.bind(r,65553));case"slice":return Promise.all([r.e(4279),r.e(9833),r.e(5849),r.e(7236),r.e(530),r.e(7137)]).then(r.bind(r,17141));case"viewshed":return Promise.all([r.e(2612),r.e(9833),r.e(5849),r.e(1307),r.e(8333),r.e(6999),r.e(8255)]).then(r.bind(r,87027))}}};function go(){const e=(0,Ke.Tw)();return e.promise.catch((()=>{})),e}(0,ze._)([(0,Qe.MZ)()],mo.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],mo.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)()],mo.prototype,"_allAnalysisViews",void 0),(0,ze._)([(0,Qe.MZ)()],mo.prototype,"_creatingViewCount",void 0),mo=(0,ze._)([(0,tt.$)("esri.views.3d.analysis.AnalysisViewManager3D")],mo);const yo=mo;var _o=r(14556),vo=r(94966);let bo=class extends ht.A{constructor(e){super(e),this.collision=new To,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===$s.RT.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==$s.RT.Local?this._set("altitude",e):Xe.A.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?(0,ws.qE)(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const r=this.tilt(e);return(0,ws.qE)(t,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===$s.RT.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:So;return r.min=xo.min,r.max=e,r}}_createDefaultTiltLocal(){const e=this.collision.enabled?(0,vo.su)([[4e3,xo.max],[1e4,(0,ws.kU)(88)],[6e6,(0,ws.kU)(88)]]):()=>xo.max;return function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:So;return r.min=xo.min,r.max=e(t),r}}_createDefaultTiltGlobal(){const e=this.collision.enabled?(0,vo.su)([[4e3,xo.max],[5e4,(0,ws.kU)(88)],[6e6,(0,ws.kU)(88)],[2e7,xo.min]]):(0,vo.su)([[3e5,xo.max],[3e6,(0,ws.kU)(88)],[6e6,(0,ws.kU)(88)],[2e7,xo.min]]);return function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:So;return r.min=xo.min,r.max=e(t),r}}};(0,ze._)([(0,Qe.MZ)()],bo.prototype,"altitude",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],bo.prototype,"collision",void 0),(0,ze._)([(0,Qe.MZ)()],bo.prototype,"distance",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],bo.prototype,"minimumPoiDistance",void 0),(0,ze._)([(0,Qe.MZ)()],bo.prototype,"tilt",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],bo.prototype,"mode",void 0),bo=(0,ze._)([(0,tt.$)("esri.views.3d.state.Constraints")],bo);const wo=function(e){return{min:-2e5,max:4*e.radius}}(_o.$O),xo={min:(0,ws.kU)(.5),max:(0,ws.kU)(179.5)},So={min:0,max:0};let To=class extends ht.A{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};(0,ze._)([(0,Qe.MZ)({type:Boolean})],To.prototype,"enabled",void 0),(0,ze._)([(0,Qe.MZ)({type:Number})],To.prototype,"elevationMargin",void 0),To=(0,ze._)([(0,tt.$)("esri.views.3d.state.Constraints.CollisionConstraint")],To);let Mo=class extends Qt.P{constructor(){super(...arguments),this.min=wo.min,this.max=wo.max}};(0,ze._)([(0,Qe.MZ)({type:Number})],Mo.prototype,"min",void 0),(0,ze._)([(0,Qe.MZ)({type:Number})],Mo.prototype,"max",void 0),Mo=(0,ze._)([(0,tt.$)("esri.views.3d.constraints.AltitudeConstraint")],Mo);let Ao=class extends Qt.P{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){"auto"===this.mode&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};(0,ze._)([(0,Qe.MZ)({type:Number,value:1e-8})],Ao.prototype,"near",null),(0,ze._)([(0,ft.w)("near")],Ao.prototype,"castNear",null),(0,ze._)([(0,Qe.MZ)({type:Number,value:1e-8})],Ao.prototype,"far",null),(0,ze._)([(0,ft.w)("far")],Ao.prototype,"castFar",null),(0,ze._)([(0,Qe.MZ)({type:["auto","manual"]})],Ao.prototype,"mode",void 0),Ao=(0,ze._)([(0,tt.$)("esri.views.3d.constraints.ClipDistanceConstraint")],Ao);const Co={min:(0,ws.KJ)(xo.min),max:(0,ws.KJ)(xo.max)};let Eo=class extends Qt.P{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return(0,ws.qE)(e,Co.min,Co.max)}autoUpdate(e){"auto"===this.mode&&this._get("max")!==e&&this._set("max",e)}};(0,ze._)([(0,Qe.MZ)({type:["auto","manual"]})],Eo.prototype,"mode",void 0),(0,ze._)([(0,Qe.MZ)({type:Number,value:Co.max})],Eo.prototype,"max",null),(0,ze._)([(0,ft.w)("max")],Eo.prototype,"castMax",null),Eo=(0,ze._)([(0,tt.$)("esri.views.3d.constraints.TiltConstraint")],Eo);let Ro=class extends Qt.P{constructor(){super(...arguments),this.tilt=new Eo,this.altitude=new Mo,this.clipDistance=new Ao}};var Po;(0,ze._)([(0,Qe.MZ)({type:Eo})],Ro.prototype,"tilt",void 0),(0,ze._)([(0,Qe.MZ)({type:Mo})],Ro.prototype,"altitude",void 0),(0,ze._)([(0,Qe.MZ)({type:Ao})],Ro.prototype,"clipDistance",void 0),Ro=(0,ze._)([(0,tt.$)("esri.views.3d.constraints.Constraints")],Ro);let Oo=Po=class extends $e.oY{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return null!=t.datetime&&new Date(t.datetime)||null}writeDate(e,t,r){t[r]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,r){e&&(t[r]=e)}writeDisplayUTCOffset(e,t){null!=e&&(t.displayUTCOffset=e)}clone(){return new Po(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};return null!=this.date&&(e.date=new Date(this.date.getTime())),e}};(0,ze._)([(0,Qe.MZ)({readOnly:!0,type:["sun"],json:{write:!0}})],Oo.prototype,"type",void 0),(0,ze._)([(0,Qe.MZ)({type:Date,json:{type:Number,write:{target:"datetime"}}})],Oo.prototype,"date",void 0),(0,ze._)([(0,Ut.w)("date",["datetime"])],Oo.prototype,"readDate",null),(0,ze._)([(0,rt.K)("date")],Oo.prototype,"writeDate",null),(0,ze._)([(0,Qe.MZ)({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Oo.prototype,"directShadowsEnabled",void 0),(0,ze._)([(0,Ut.w)("directShadowsEnabled",["directShadows"])],Oo.prototype,"readDirectShadowsEnabled",null),(0,ze._)([(0,rt.K)("directShadowsEnabled")],Oo.prototype,"writedirectShadowsEnabled",null),(0,ze._)([(0,Qe.MZ)({type:Number,json:{write:!0}})],Oo.prototype,"displayUTCOffset",void 0),(0,ze._)([(0,rt.K)("displayUTCOffset")],Oo.prototype,"writeDisplayUTCOffset",null),Oo=Po=(0,ze._)([(0,tt.$)("esri.webscene.SunLighting")],Oo);const Io=Oo;var Lo;let No=Lo=class extends(pt.A.EventedMixin(Io)){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=(new Date).getFullYear(),r=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new Lo(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){null!=e&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const r=Lo.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let i=null;null!=e&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(e.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime()))));const n=Lo.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==n&&(Do.target=this,Do.timezoneOffset=n,this.emit("timezone-will-change",Do),Do.target=null),null!=e)return isNaN(e.getTime())||i!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new Lo({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return null!=e.date&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};(0,ze._)([(0,Qe.MZ)({type:Boolean})],No.prototype,"cameraTrackingEnabled",void 0),(0,ze._)([(0,Qe.MZ)({type:Date})],No.prototype,"defaultDate",null),(0,ze._)([(0,Qe.MZ)({type:Date})],No.prototype,"date",null),No=Lo=(0,ze._)([(0,tt.$)("esri.views.3d.environment.SunLighting")],No),function(e){e.calculateTimezoneOffset=function(e){let{hours:t,minutes:r,seconds:i}=e;return Math.round(t+r/60+i/3600)}}(No||(No={}));const Do={target:null,timezoneOffset:0},Fo=No;var ko;let zo=ko=class extends $e.oY{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new ko(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};(0,ze._)([(0,Qe.MZ)({readOnly:!0,type:["virtual"],json:{write:!0}})],zo.prototype,"type",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],zo.prototype,"directShadowsEnabled",void 0),zo=ko=(0,ze._)([(0,tt.$)("esri.webscene.VirtualLighting")],zo);const Uo=zo;var Vo;let Bo=Vo=class extends(pt.A.EventedMixin(Uo)){constructor(e){super(e),this.cameraTrackingEnabled=!0}clone(){return new Vo({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(e){return new Vo(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};(0,ze._)([(0,Qe.MZ)({type:Boolean})],Bo.prototype,"cameraTrackingEnabled",void 0),Bo=Vo=(0,ze._)([(0,tt.$)("esri.views.3d.environment.VirtualLighting")],Bo);const jo=Bo,Ho={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Fo,virtual:jo}};var Go;let Zo=Go=class extends ht.A{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new Go({quality:this.quality})}};(0,ze._)([(0,Qe.MZ)({type:["low","high"],value:"low"})],Zo.prototype,"quality",null),Zo=Go=(0,ze._)([(0,tt.$)("esri.views.3d.environment.SceneViewAtmosphere")],Zo);var $o=r(68814),qo=r(89038);const Wo={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Io,virtual:Uo}};let Yo=class extends $e.oY{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};(0,ze._)([(0,Qe.MZ)({readOnly:!0,json:{read:!1}})],Yo.prototype,"type",void 0),Yo=(0,ze._)([(0,tt.$)("esri.webscene.background.Background")],Yo);const Xo=Yo;var Jo;const Ko={...r(85192).E,nonNullable:!0};let Qo=Jo=class extends Xo{constructor(e){super(e),this.type="color",this.color=new Be.A([0,0,0,1])}clone(){return new Jo(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};(0,ze._)([(0,nt.e)({color:"color"},{readOnly:!0})],Qo.prototype,"type",void 0),(0,ze._)([(0,Qe.MZ)(Ko)],Qo.prototype,"color",void 0),Qo=Jo=(0,ze._)([(0,tt.$)("esri.webscene.background.ColorBackground")],Qo);const ea=Qo,ta={base:Xo,key:"type",typeMap:{color:ea}};const ra={types:ta,json:{read:function(e){return(t,r,i)=>{if(!t)return t;for(const n in e.typeMap)if(t.type===n){const r=new e.typeMap[n];return r.read(t,i),r}}}(ta),write:{overridePolicy:(e,t,r)=>({enabled:!r?.isPresentation})}}};var ia;const na=(e,t,r)=>({enabled:!r?.isPresentation});let sa=ia=class extends $e.oY{constructor(e){super(e),this.lighting=new Io,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){(0,qo.TJ)(e?.type,Xe.A.getLogger(this))&&this._set("weather",e)}clone(){return new ia(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&"virtual"===this.lighting.type?Uo.prototype.clone.call(this.lighting):Io.prototype.clone.call(this.lighting),background:(0,qe.o8)(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};(0,ze._)([(0,Qe.MZ)({types:Wo,nonNullable:!0,json:{write:!0}})],sa.prototype,"lighting",void 0),(0,ze._)([(0,Qe.MZ)(ra)],sa.prototype,"background",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:na}}})],sa.prototype,"atmosphereEnabled",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:na}}})],sa.prototype,"starsEnabled",void 0),(0,ze._)([(0,Qe.MZ)({types:qo.eM,nonNullable:!0,json:{write:!0},value:new $o.A})],sa.prototype,"weather",null),sa=ia=(0,ze._)([(0,tt.$)("esri.webscene.Environment")],sa);const oa=sa;var aa;let la=aa=class extends oa{constructor(e){super(e),this.atmosphere=new Zo,this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}destroy(){this.atmosphere.destroy()}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new aa({...t,lighting:t.lighting?"virtual"===t.lighting.type?jo.fromWebsceneLighting(t.lighting):Fo.fromWebsceneLighting(t.lighting):void 0})}castLighting(e){return this._convertLightingWithDestroy(e)}applyLighting(e){this.lighting=this._convertLightingWithDestroy(e)}_convertLightingWithDestroy(e){const t=this._convertLighting(e);return t!==e&&this.addHandles((0,mt.DQ)(t)),t}_convertLighting(e){return e?e instanceof Fo||e instanceof jo?e:e instanceof Io?this.lighting&&"virtual"!==this.lighting.type?this.lighting.cloneWithWebsceneLighting(e):new Fo({...e.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):e instanceof Uo?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(e):new jo({...e.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):(0,et.aq)(Ho,e):new Fo}clone(){return new aa({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:(0,qe.o8)(this.background)})}cloneWithWebsceneEnvironment(e){return new aa({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:(0,qe.o8)(this.background),...e.cloneConstructProperties(),lighting:this._getLighting(e)})}_getLighting(e){switch(e.lighting.type){case"sun":return this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(e.lighting):Fo.fromWebsceneLighting(e.lighting);case"virtual":return this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(e.lighting):jo.fromWebsceneLighting(e.lighting);default:return(0,Ge.Xb)(e.lighting),Fo.fromWebsceneLighting(e.lighting)}}};(0,ze._)([(0,Qe.MZ)({type:Zo,json:{read:!1},nonNullable:!0})],la.prototype,"atmosphere",void 0),(0,ze._)([(0,Qe.MZ)({nonNullable:!0})],la.prototype,"lighting",void 0),(0,ze._)([(0,ft.w)("lighting")],la.prototype,"castLighting",null),la=aa=(0,ze._)([(0,tt.$)("esri.views.3d.environment.SceneViewEnvironment")],la);const ca=la;var ua,ha=r(24648),da=r(20664),pa=r(34111);!function(e){e[e.Realistic=0]="Realistic",e[e.Local=1]="Local",e[e.Mars=2]="Mars",e[e.None=3]="None"}(ua||(ua={}));var fa=r(59784),ma=r(19555),ga=r(43047),ya=r(55855),_a=r(45462),va=r(72745),ba=r(60071),wa=r(64839),xa=r(16506),Sa=r(42693),Ta=r(32119),Ma=r(28584),Aa=r(93345),Ca=r(57162);class Ea extends wa.Y{constructor(){super(...arguments),this.heightParameters=(0,ya.vt)(),this.radii=(0,va.vt)(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=(0,va.vt)(),this.backgroundColor=(0,nn.vt)()}}class Ra extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,Ra.shader.get().build(this.configuration),Ta.D)}initializePipeline(){return this.configuration.reduced?(0,Ca.Ey)({blending:(0,Ca.ox)(Aa.dn.ONE,Aa.dn.ZERO),depthTest:{func:Aa.MT.ALWAYS},colorWrite:Ca.wE}):this.configuration.haze?(0,Ca.Ey)({blending:(0,Ca.p3)(Aa.dn.ONE,Aa.dn.ZERO,Aa.dn.ONE_MINUS_SRC_COLOR,Aa.dn.ONE),colorWrite:Ca.wE}):(0,Ca.Ey)({blending:(0,Ca.ox)(Aa.dn.SRC_ALPHA,Aa.dn.ONE_MINUS_SRC_ALPHA),depthTest:{func:Aa.MT.LEQUAL},colorWrite:Ca.wE})}}Ra.shader=new xa.$(ba.C,(()=>r.e(4679).then(r.bind(r,94679))));var Pa=r(99415);class Oa extends Pa.K{constructor(){super(...arguments),this.haze=!1}}(0,ze._)([(0,Pa.W)()],Oa.prototype,"haze",void 0);class Ia extends Oa{constructor(){super(...arguments),this.reduced=!1}}(0,ze._)([(0,Pa.W)()],Ia.prototype,"reduced",void 0);var La=r(16455),Na=r(11850),Da=r(22278),Fa=r(81330),ka=r(78677);class za extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,za.shader.get().build(this.configuration),Ta.D)}initializePipeline(){return this.configuration.haze?(0,Ca.Ey)({blending:(0,Ca.p3)(Aa.dn.ONE,Aa.dn.ZERO,Aa.dn.ONE_MINUS_SRC_COLOR,Aa.dn.ONE),depthTest:{func:Aa.MT.ALWAYS},colorWrite:Ca.wE}):(0,Ca.Ey)({blending:(0,Ca.ox)(Aa.dn.SRC_ALPHA,Aa.dn.ONE_MINUS_SRC_ALPHA),depthTest:{func:Aa.MT.ALWAYS},colorWrite:Ca.wE})}}za.shader=new xa.$(ka.a,(()=>r.e(2583).then(r.bind(r,12583))));class Ua{constructor(e,t){this._view=e,this._context=t,this.type=ua.Realistic,this._handles=new Gn.A,this._compositingPassParameters=new ka.A,this._passParameters=new Ea,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=_o.$O.radius,this._fadeHaze=0,this._updateRadius(_o.$O.radius);const r=this._context.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([(0,gt.wB)((()=>this._view?.basemapTerrain?.rootTileElevationBounds),(()=>this._view?.basemapTerrain?this._updateRootTileElevationBounds():null)),(0,gt.wB)((()=>this._view?.basemapTerrain?.visibleElevationBounds),(()=>this._view?.basemapTerrain?this._updateVisibleElevationBounds():null)),(0,gt.wB)((()=>this._view?.environment.background),(e=>{const t=e instanceof ea?(0,fa.QP)(e.color):ya.uY;(0,da.s)(this._passParameters.backgroundColor,t[0]*t[3],t[1]*t[3],t[2]*t[3])}),gt.pc)]);const i=new Ia;i.haze=!1,this._atmosphereTechnique=this._context.techniques.acquire(Ra,i),this._compositingTechnique=this._context.techniques.acquire(za,i),i.haze=!0,this._atmosphereHazeTechnique=this._context.techniques.acquire(Ra,i),this._compositingHazeTechnique=this._context.techniques.acquire(za,i),i.reduced=!0,i.haze=!1,this._atmosphereReducedTechnique=this._context.techniques.acquire(Ra,i),i.haze=!0,this._atmosphereHazeReducedTechnique=this._context.techniques.acquire(Ra,i),this._vao=(0,Da.Q)(r,Na.u7)}destroy(){this._handles.destroy(),this._compositingTechnique.release(),this._compositingHazeTechnique.release(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,t){this._render(e,t?this._atmosphereTechnique:this._atmosphereReducedTechnique,t,!1)}renderHaze(e,t,r){this._fadeHaze=t,this._render(e,r?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,r,!0)}_render(e,t,r,i){const n=e.bindParameters.mainDepth;if(!n)return;this._update(e.bindParameters.camera),this._passParameters.depthTexture=n;const s=e.rctx.bindTechnique(t,e.bindParameters,this._passParameters),o=e.offscreenRenderingHelper;if(r)o.renderDepthDetached((()=>this._renderCommon(s,e)));else{const t=e.rctx.getViewport(),r=(0,da.l)(e.bindParameters.camera.eye)-_o.$O.radius;let a;if(r<_a.yv){const e=Math.min(1,Math.max(0,r/_a.yv));a=i?(0,ws.Cc)(.4,.5,e):(0,ws.Cc)(.2,.3,e)}else{const e=Math.min(1,Math.max(0,(r-_a.yv)/(15*_a.yv)));a=i?(0,ws.Cc)(.5,1,e):(0,ws.Cc)(.3,.6,e)}const l=(0,Fa.Mv)(Math.round(a*e.bindParameters.camera.fullViewport[2])),c=(0,Fa.Mv)(Math.round(a*e.bindParameters.camera.fullViewport[3]));e.rctx.setViewport(0,0,l,c);const u=o.renderToCachedFBO(null,i?"chapman haze":"chapman",(()=>this._renderCommon(s,e)),[0,0,0,1],La.N.RGBA,null,l,c);e.rctx.setViewport(t.x,t.y,t.width,t.height),this._compositingPassParameters.color=u.getTexture(),this._compositingPassParameters.depth=n;const h=i?this._compositingHazeTechnique:this._compositingTechnique;e.rctx.bindTechnique(h,e.bindParameters,this._compositingPassParameters),o.renderDepthDetached((()=>e.rctx.screen.draw())),u.release()}}_renderCommon(e,t){null!=this._vao&&(t.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),t.rctx.drawArrays(Aa.WR.TRIANGLE_STRIP,0,4))}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=_o.$O.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=function(e){return e*Math.cos(Math.PI/16/16)}(_o.$O.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,(0,ma.hZ)(this._passParameters.radii,e,e+_a.yv),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-_a.UP)*_a.UP)}_update(e){if(!e)return;const t=(0,da.q)(e.eye),r=Math.sqrt(t),i=t-this._passParameters.radii[1]*this._passParameters.radii[1],n=(0,ws.qE)((r-this._passParameters.radii[0])/_a.yv,0,1);(0,ga.s)(this._passParameters.heightParameters,r,t,i,n),this._passParameters.altitudeFade=(0,_a.GF)(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=(0,ws.Cc)((0,ws.Cc)(.6,1,(0,ws.TF)(9500,10500,r-_o.$O.radius)),1,this._fadeHaze)}}var Va=r(2565);class Ba extends Sa.w{constructor(e){super(e,new Pa.K,(()=>this.destroy()))}initializeProgram(e){return new Ma.B(e.rctx,Ba.shader.get().build(),Ta.D)}initializePipeline(){return(0,Ca.Ey)({blending:(0,Ca.p3)(Aa.dn.ONE,Aa.dn.ZERO,Aa.dn.SRC_ALPHA,Aa.dn.ONE),depthTest:{func:Aa.MT.LEQUAL},colorWrite:Ca.wE})}}Ba.shader=new xa.$(Va.C,(()=>r.e(6037).then(r.bind(r,86037))));let ja=class extends ht.A{constructor(e){super(e),this._technique=new Ba(e),this._vao=(0,Da.Q)(e.rctx)}destroy(){this._technique=(0,Je.Gz)(this._technique),this._vao=(0,Je.WD)(this._vao)}render(e){if(!this._technique.compiled)return void this.requestRender();const t=e.bindParameters.cloudsFade;if(null==this._vao||null==t.data)return;const r=e.rctx.bindTechnique(this._technique,e.bindParameters,Ha);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Aa.WR.TRIANGLE_STRIP,0,4)}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],ja.prototype,"rctx",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],ja.prototype,"viewingMode",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],ja.prototype,"planetRadius",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],ja.prototype,"requestRender",void 0),ja=(0,ze._)([(0,tt.$)("esri.views.3d.environment.CloudsComposition")],ja);const Ha=new wa.Y;var Ga=r(49753),Za=r(63919),$a=r(34761),qa=r(13191),Wa=r(83755),Ya=r(16619),Xa=r(63401),Ja=r(46141);class Ka extends Sa.w{constructor(e,t){super(e,t,(()=>this.destroy()))}initializeProgram(e){return new Ma.B(e.rctx,Ka.shader.get().build(this.configuration),Ta.D)}initializePipeline(){return(0,Ca.Ey)({blending:(0,Ca.ox)(Aa.dn.CONSTANT_COLOR,Aa.dn.ONE_MINUS_CONSTANT_COLOR,Aa.Tb.ADD,this.configuration.writeTextureChannels===Ga.c.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Aa.MT.LEQUAL},colorWrite:Ca.wE})}}Ka.shader=new xa.$(Ya.a,(()=>r.e(6603).then(r.bind(r,96603))));var Qa=r(60645),el=r(80573),tl=r(39033),rl=r(89426);class il extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,il.shader.get().build(this.configuration),Ta.D)}initializePipeline(){return(0,Ca.Ey)({blending:this.configuration.mode===tl.L.Full?(0,Ca.ox)(Aa.dn.ONE,Aa.dn.ZERO):(0,Ca.p3)(Aa.dn.ZERO,Aa.dn.ONE,Aa.dn.ONE,Aa.dn.ZERO),depthTest:{func:Aa.MT.ALWAYS},colorWrite:Ca.wE})}}il.shader=new xa.$(el.a,(()=>r.e(2205).then(r.bind(r,12205))));var nl=r(12331),sl=r(96673);let ol=class extends ht.A{constructor(e){super(e),this._needsRender=!0,this._passParameters=new el.N,this._fbo=new nl.H(e.context.renderContext.rctx,new sl.R(rl.jj)),this._vao=(0,Da.Q)(e.context.renderContext.rctx)}get _techniques(){return this.context.techniques}get textureAtlas(){return null!=this._texture?null!=this._weatherMapTechnique&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(tl.L.WeatherMap)):null!=this._fullTechnique&&this._fullTechnique.compiled&&(this._texture=this._render(tl.L.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||((0,ma.C)(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=(0,Je.Gz)(this._fullTechniqueCached),this._weatherMapTechniqueCached=(0,Je.Gz)(this._weatherMapTechniqueCached),this._fbo=(0,Je.WD)(this._fbo),this._vao=(0,Je.WD)(this._vao)}get _fullTechnique(){if(null==this._fullTechniqueCached){const e=new tl.F;e.mode=tl.L.Full,this._fullTechniqueCached=this._techniques.acquire(il,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(null==this._weatherMapTechniqueCached){const e=new tl.F;e.mode=tl.L.WeatherMap,this._weatherMapTechniqueCached=this._techniques.acquire(il,e)}return this._weatherMapTechniqueCached}_render(e){if(null==this._vao||null==this._fbo)return null;const t=e===tl.L.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,i=r.getViewport();r.setViewport(0,0,rl.jj,rl.jj),r.bindFramebuffer(this._fbo);const n=r.bindTechnique(t,null,this._passParameters);return r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(i.x,i.y,i.width,i.height),this._needsRender=!1,this._fbo.colorTexture}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],ol.prototype,"context",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],ol.prototype,"_techniques",null),ol=(0,ze._)([(0,tt.$)("esri.views.3d.environment.NoiseTextureAtlas")],ol);var al=r(10209),ll=r(59752),cl=r(22856);let ul=class extends ht.A{constructor(e){super(e),this._techniques=new Array,this._techniqueConfiguration=new Qa.H,this._bindParameters=new al.k(null,null),this._passParameters=new Ya.C,this._weatherTile=(0,va.vt)(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=(0,ws.Cc)(Ja.n.default.coverage[0],Ja.n.default.coverage[1],.5),this.density=(0,ws.Cc)(Ja.n.default.density[0],Ja.n.default.density[1],.5),this.absorption=(0,ws.Cc)(Ja.n.default.absorption[0],Ja.n.default.absorption[1],.5),this.cloudSize=(0,ws.Cc)(Ja.n.default.cloudSize[0],Ja.n.default.cloudSize[1],.5),this.detailSize=(0,ws.Cc)(Ja.n.default.detailSize[0],Ja.n.default.detailSize[1],.5),this.smoothness=(0,ws.Cc)(Ja.n.default.smoothness[0],Ja.n.default.smoothness[1],.5),this.cloudHeight=(0,ws.Cc)(Ja.n.default.cloudHeight[0],Ja.n.default.cloudHeight[1],.5),this.raymarchingSteps=Ja.n.default.raymarchingSteps,this._viewMatrix=(0,qa.vt)(),this._dirty=!1,this.running=!1,this._vao=(0,Da.Q)(e.context.renderContext.rctx)}_getTechnique(e){const t=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=t===Ga.c.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=t,this._techniqueConfiguration.steps=e,this._techniques[r]=new Ka({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;if(null==e||null==t)return;(0,ma.hZ)(this._weatherTile,(e+90)/180,(t+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let i=0,n=0;if(null!=this.view.environment&&"virtual"!==this.view.environment.lighting.type&&null!=this.view.environment.lighting.date){const e=new Date(this.view.environment.lighting.date);e.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),i=31*e.getUTCMonth()+e.getUTCDate(),n=e.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+i)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),(0,ma.aI)(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=(0,pa.tO)(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this.addHandles([this.view.resourceController.scheduler.registerTask(ll.W6.CLOUDS_GENERATOR,this),(0,gt.wB)((()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps]),(()=>this.setDirty()),gt.Vh)])}destroy(){this._techniques.forEach((e=>(0,Je.Gz)(e))),this._frameBufferCube=(0,Je.WD)(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=(0,Je.pR)(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Qa.p.SIXTEEN:return 1;case Qa.p.HUNDRED:return 4;case Qa.p.COUNT:case Qa.p.TWOHUNDRED:return 8}}get usedMemory(){return(this._frameBufferCube?.usedMemory??0)+(this._passParameters.noiseTexture?.textureAtlas?.usedMemory??0)}_ensureNoiseTexture(){return this._passParameters.noiseTexture??=new ol({context:this.context}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile),null!=this._passParameters.noiseTexture.textureAtlas}_ensureFrameBufferCube(e){if(null==this._frameBufferCube){const t=new sl.R(e);t.target=Aa.Ap.TEXTURE_CUBE_MAP,t.wrapMode=Aa.pF.CLAMP_TO_EDGE,this._frameBufferCube=new nl.H(this.context.renderContext.rctx,t)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=(0,Je.WD)(this._frameBufferCube)}applyPreset(e,t){const r=e.median,i=e=>{const i=(0,ws.Cc)(e[0],e[1],r);return t<.5?(0,ws.Cc)(e[0],i,2*t):(0,ws.Cc)(i,e[1],2*(t-.5))};this.coverage=i(e.coverage),this.density=i(e.density),this.absorption=i(e.absorption),this.cloudSize=i(e.cloudSize),this.detailSize=i(e.detailSize),this.smoothness=i(e.smoothness),this.cloudHeight=i(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){0===this._faceIndex&&0===this._tileIndex&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),(0,ma.C)(this._passParameters.weatherTile,this._weatherTile));const t=this._getTechnique(this._passParameters.raymarchingSteps);if(!t.compiled)return cl.G;if(this.context.renderContext.bindParameters.cloudsFade.fadeMode===Xa.OQ.CROSS_FADE||!this._ensureNoiseTexture())return cl.G;0===this._faceIndex&&0===this._tileIndex&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Ga.c2.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=hl[this._faceIndex],i=dl[this._faceIndex];(0,$a.xI)(this._viewMatrix,pl,r,i),(0,Za.z0)(this._passParameters.viewMatrix,this._viewMatrix);const n=this.context.renderContext.rctx,s=n.bindTechnique(t,this._bindParameters,this._passParameters);n.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const o=n.getViewport(),a=t.configuration.cubeMapSize,l=a/this._tilesPerFace,c=this._tileIndex*l;n.setViewport(0,c,a,l);const u=this._ensureFrameBufferCube(a);n.bindFramebuffer(u);const h=Aa.Ap.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return u.setColorTextureTarget(h),n.gl.drawArrays(n.gl.TRIANGLE_STRIP,0,4),n.gl.flush(),n.setViewport(o.x,o.y,o.width,o.height),this.requestRender(),++this._tileIndex,4===this._faceIndex&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Ga.c2.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),cl.G}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],ul.prototype,"context",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],ul.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],ul.prototype,"requestRender",void 0),(0,ze._)([(0,Qe.MZ)()],ul.prototype,"coverage",void 0),(0,ze._)([(0,Qe.MZ)()],ul.prototype,"density",void 0),(0,ze._)([(0,Qe.MZ)()],ul.prototype,"absorption",void 0),(0,ze._)([(0,Qe.MZ)()],ul.prototype,"cloudSize",void 0),(0,ze._)([(0,Qe.MZ)()],ul.prototype,"detailSize",void 0),(0,ze._)([(0,Qe.MZ)()],ul.prototype,"smoothness",void 0),(0,ze._)([(0,Qe.MZ)()],ul.prototype,"cloudHeight",void 0),(0,ze._)([(0,Qe.MZ)()],ul.prototype,"raymarchingSteps",void 0),(0,ze._)([(0,Qe.MZ)()],ul.prototype,"running",void 0),ul=(0,ze._)([(0,tt.$)("esri.views.3d.environment.CloudsGenerator")],ul);const hl=[(0,Wa.fA)(1,0,0),(0,Wa.fA)(-1,0,0),(0,Wa.fA)(0,1,0),(0,Wa.fA)(0,-1,0),(0,Wa.fA)(0,0,1)],dl=[(0,Wa.fA)(0,1,0),(0,Wa.fA)(0,1,0),(0,Wa.fA)(0,0,-1),(0,Wa.fA)(0,0,1),(0,Wa.fA)(0,1,0)],pl=(0,Wa.Ul)();var fl=r(48761);class ml extends Sa.w{constructor(e){super(e,new Pa.K,(()=>this.destroy()))}initializeProgram(e){return new Ma.B(e.rctx,ml.shader.get().build(),Ta.D)}initializePipeline(){return(0,Ca.Ey)({blending:(0,Ca.p3)(Aa.dn.SRC_ALPHA,Aa.dn.ZERO,Aa.dn.ONE_MINUS_SRC_ALPHA,Aa.dn.ONE),colorWrite:Ca.wE})}}ml.shader=new xa.$(fl.a,(()=>r.e(1625).then(r.bind(r,71625))));let gl=class extends ht.A{constructor(e){super(e),this._passParameters=new fl.F;const t=e.context.renderContext.rctx;this._vao=(0,Da.Q)(t,Na.u7),this._technique=new ml(e);const r=(0,pa.tO)(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+_a.yv}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,t){if(this._update(e,t),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const i=e.offscreenRenderingHelper;i.renderDepthDetached((()=>{this._passParameters.depthTexture=i.depthTexture;const t=e.rctx.bindTechnique(r,e.bindParameters,this._passParameters);this._renderFog(t,e)}))}_renderFog(e,t){const r=t.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Aa.WR.TRIANGLE_STRIP,0,4)}_update(e,t){const r=e.bindParameters.camera;(0,da.n)(_l,r.eye);const i=Math.max(0,(0,da.m)(_l,e.bindParameters.lighting.mainLight.direction)),n=t.color;(0,da.j)(vl,n,.1),(0,da.o)(this._passParameters.fogColor,vl,n,i);const s=(0,da.l)(r.eye),o=s*s;this._passParameters.atmosphereC=o-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-(0,ws.TF)(.95*qo.ni,1*qo.ni,Math.abs(s-this._planetRadius)))*t.amount,this._passParameters.fogStrength=t.strength}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],gl.prototype,"context",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],gl.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],gl.prototype,"rctx",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],gl.prototype,"viewingMode",void 0),gl=(0,ze._)([(0,tt.$)("esri.views.3d.environment.Fog")],gl);class yl{constructor(){this.color=(0,nn.vt)(),this.strength=0,this.amount=0}}const _l=(0,nn.vt)(),vl=(0,nn.vt)();var bl=r(76955),wl=r(99650);class xl extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,xl.shader.get().build(this.configuration),Ta.D)}initializePipeline(){return this.configuration.geometry===wl.d.Cylinder?(0,Ca.Ey)({blending:(0,Ca.p3)(Aa.dn.SRC_ALPHA,Aa.dn.ONE,Aa.dn.ONE_MINUS_SRC_ALPHA,Aa.dn.ONE_MINUS_SRC_ALPHA),culling:Ca.PI,depthTest:{func:Aa.MT.LEQUAL},colorWrite:Ca.wE}):(0,Ca.Ey)({blending:(0,Ca.p3)(Aa.dn.SRC_ALPHA,Aa.dn.ONE,Aa.dn.ONE_MINUS_SRC_ALPHA,Aa.dn.ONE_MINUS_SRC_ALPHA),depthTest:{func:Aa.MT.LEQUAL},colorWrite:Ca.wE})}}xl.shader=new xa.$(bl.a,(()=>r.e(9435).then(r.bind(r,79435))));const Sl=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);var Tl=r(57481),Ml=r(48549),Al=r(62577),Cl=r(69008),El=r(66470),Rl=r(76718),Pl=r(98433),Ol=r(27207);class Il{constructor(e,t){this.type=ua.Local,this._configuration=new wl.$,this._passParameters=new bl.S,this._configuration.geometry=wl.d.Cylinder,this._technique=t.techniques.acquire(xl,this._configuration);const r=t.renderContext.rctx;this._vao=function(e){const t=(0,Al.Y6)(1,2,!1),{data:r,indices:i}=t[0][1],n=Nl.createBuffer(i.length),s=n.position;for(let o=0;o<i.length;++o){const e=3*i[o%3==0?o+2:o%3==2?o-2:o];s.set(o,0,r[e]),s.set(o,1,r[e+1]),s.set(o,2,r[e+2])}return new Cl.Z(e,Ta.D,{geometry:(0,Tl.U)(Nl)},{geometry:Rl.g.createVertex(e,Aa._U.STATIC_DRAW,n.buffer)})}(r),this._vaoCount=(0,Ol.mT)(this._vao,"geometry");const i=new sl.R;i.wrapMode=Aa.pF.CLAMP_TO_EDGE,i.flipped=!0,i.width=1,i.height=512,this._passParameters.texture=new Pl.g(r,i,Sl)}destroy(){this._passParameters.texture=(0,Je.WD)(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const t=e.rctx,r=t.bindTechnique(this._technique,e.bindParameters,this._passParameters);(function(e,t){(0,$a.C)(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1})(Ll,e.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",Ll),t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(Aa.WR.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}}const Ll=(0,qa.vt)(),Nl=(0,Ml.BP)().vec3f(El.r.POSITION);var Dl=r(75002);const Fl=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]);var kl=r(86994);const zl=128,Ul=-_a.UP,Vl=(0,vo.su)([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class Bl{constructor(e,t){this.view=e,this.type=ua.Mars,this._passParameters=new bl.S,this._vaoCount=0,this._texV1=1;const r=(0,pa.tO)(e.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+Ul)/this._planetRadius,this._middleRimFactor=(this._planetRadius+0)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=0/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniques=t.techniques;const i=t.renderContext.rctx;this._cameraChangeHandle=(0,gt.wB)((()=>this.view.state?.camera),(()=>t.requestRender()),gt.pc),this._vao=this._createRibbon(i),this._vaoCount=(0,Ol.mT)(this._vao,"geometry"),this._fadeVao=(0,Da.Q)(i),this._fadeVaoCount=(0,Ol.mT)(this._fadeVao,"geometry");const n=new sl.R;n.wrapMode=Aa.pF.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Pl.g(i,n,Fl);const s=new wl.$;s.geometry=wl.d.Cone,this._coneTechnique=this._techniques.acquire(xl,s),s.geometry=wl.d.Underground,this._undergroundTechnique=this._techniques.acquire(xl,s)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=(0,Je.WD)(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const t=e.bindParameters.camera;this._update(t);const r=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,e.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Aa.WR.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,e.bindParameters,this._passParameters),r.bindVAO(this._fadeVao),r.drawArrays(Aa.WR.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const t=(0,nn.vt)(),r=this._planetRadius,i=(0,da.l)(e.eye),n=i-r;if(n<0){const e=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=e}else this._passParameters.undergroundFadeAlpha=0;const s=Math.max(50,n),o=r+Ul;this._passParameters.innerScale=function(e,t,r){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-r*r)+t*r)}(r+s,r,o)-1,this._passParameters.altitudeFade=(0,_a.GF)(n),(0,da.j)(t,e.eye,(r+50)/i),jl(t,e.center,e.up,r,this._passParameters.silhouette);const a=this._computeScreenRimWidth(e,t,e.up,this._passParameters.silhouette),l=1-511/512,c=Vl(n);let u=this._texV0+l*this._texVScale,h=this._texV0+a*c*this._texVScale;if(n>50){jl(e.eye,e.center,e.up,r,this._passParameters.silhouette);const t=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),i=(0,ws.qE)((t-1.5)/(a-1.5),0,1);u=this._texV0+i*l*this._texVScale,h=this._texV0+(0,ws.Cc)(this._texV1,a*c,i)*this._texVScale}(0,ma.hZ)(this._passParameters.texV,u,h)}_createRibbon(e){const t=(0,Dl.oe)(1155),r=new Uint32Array(1920);t[0]=0,t[1]=0,t[2]=-1;for(let s=0;s<zl;s++){const e=9*s+3;t[e]=s,t[e+1]=this._innerRimFactor,t[e+2]=-1,t[e+3]=s,t[e+4]=this._middleRimFactor,t[e+5]=0,t[e+6]=s,t[e+7]=this._outerRimFactor,t[e+8]=1;const i=3*s+1,n=127===s?1:i+3,o=15*s;r[o]=i,r[o+1]=i+1,r[o+2]=n+1,r[o+3]=n+1,r[o+4]=n,r[o+5]=i,r[o+6]=i+1,r[o+7]=i+2,r[o+8]=n+2,r[o+9]=n+2,r[o+10]=n+1,r[o+11]=i+1,r[o+12]=i,r[o+13]=n,r[o+14]=0}const i=$l.createBuffer(r.length),n=i.position;for(let s=0;s<r.length;++s){const e=3*r[s];n.set(s,0,t[e]),n.set(s,1,t[e+1]),n.set(s,2,t[e+2])}return new Cl.Z(e,Ta.D,{geometry:(0,Tl.U)($l)},{geometry:Rl.g.createVertex(e,Aa._U.STATIC_DRAW,i.buffer)})}_computeScreenRimWidth(e,t,r,i){return(0,da.g)(Gl,i.center,i.v2),(0,da.j)(Zl,Gl,this._outerRimFactor),(0,$a.t5)(Hl,t,Gl,r),(0,kl.Cv)(Gl,Hl,e.projectionMatrix,e.viewport,Gl),(0,kl.Cv)(Zl,Hl,e.projectionMatrix,e.viewport,Zl),(0,da.p)(Gl,Zl)/e.height}}function jl(e,t,r,i,n){const s=(0,da.l)(e),o=i*Math.sqrt(s*s-i*i)/s,a=Math.sqrt(i*i-o*o),l=n.v1,c=n.v2;return(0,da.j)(n.center,e,a/s),(0,da.b)(l,e,t),(0,da.q)(l)<1&&(0,da.b)(l,e,r),(0,da.j)(l,l,o/(0,da.l)(l)),(0,da.b)(c,l,e),(0,da.j)(c,c,o/(0,da.l)(c)),o}const Hl=(0,qa.vt)(),Gl=(0,nn.vt)(),Zl=(0,nn.vt)();const $l=(0,Ml.BP)().vec3f(El.r.POSITION);var ql=r(91417),Wl=r(28080);class Yl extends wa.Y{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}}class Xl extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,Xl.shader.get().build(this.configuration),Jl)}initializePipeline(){return(0,Ca.Ey)({blending:(0,Ca.p3)(Aa.dn.ONE,Aa.dn.ONE,Aa.dn.ONE_MINUS_SRC_ALPHA,Aa.dn.ONE_MINUS_SRC_ALPHA),depthTest:{func:Aa.MT.LEQUAL},colorWrite:Ca.wE})}}Xl.shader=new xa.$(Wl.P,(()=>r.e(9104).then(r.bind(r,79104))));const Jl=new Map([[El.r.POSITION,0],[El.r.INSTANCEFEATUREATTRIBUTE,1]]);var Kl=r(90376),Ql=r(72085);let ec=class extends ht.A{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new Yl,this._animation=new Ql.a,this._passParameters.time=0,this._passParameters.radius=(0,pa.tO)(e.view.spatialReference).radius,this._techniques=e.context.techniques}destroy(){this._numParticles=0,this._snowTechniqueCached=(0,Je.Gz)(this._snowTechniqueCached),this._rainTechniqueCached=(0,Je.Gz)(this._rainTechniqueCached),this._vao=(0,Je.WD)(this._vao),this._instanceIdBuffer=(0,Je.WD)(this._instanceIdBuffer)}get _rainTechnique(){if(null==this._rainTechniqueCached){const e=new Kl.a;e.type=Kl.C.Rain,this._rainTechniqueCached=this._techniques.acquire(Xl,e)}return this._rainTechniqueCached}get _snowTechnique(){if(null==this._snowTechniqueCached){const e=new Kl.a;e.type=Kl.C.Snow,this._snowTechniqueCached=this._techniques.acquire(Xl,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,t,r){const i="rainy"===r?this._rainTechnique:this._snowTechnique;if(!i.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),null==i||null==this._vao||null==this._instanceIdBuffer)return;if(null!=e.bindParameters.cloudsFade.data&&(this._passParameters.opacity=e.bindParameters.cloudsFade.opacity),this._passParameters.opacity<=0)return;t=t<.5?(0,ws.Cc)(0,.35,2*t):(0,ws.Cc)(.35,1,2*(t-.5)),this._passParameters.time=("rainy"===r?this._rainSpeed:this._snowSpeed)*(0,ql.y)(this._animation.time)%1e5;const s=n.bindTechnique(i,e.bindParameters,this._passParameters);n.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),(0,Ol.yu)(n,Jl,this._instanceIdBuffer,rc,0),n.drawArraysInstanced(Aa.WR.TRIANGLES,0,3,this._numParticles*t),(0,Ol.Hi)(n,Jl,this._instanceIdBuffer,rc)}_ensureResources(e){null==this._vao&&(this._vao=function(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Cl.Z(e,Jl,{geometry:(0,Tl.U)(tc)},{geometry:Rl.g.createVertex(e,Aa._U.STATIC_DRAW,t)})}(e)),null==this._instanceIdBuffer&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let r=0;r<this._numParticles;r++)t.push(r);return Rl.g.createVertex(e,Aa._U.STATIC_DRAW,new Float32Array(t))}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],ec.prototype,"context",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],ec.prototype,"view",void 0),ec=(0,ze._)([(0,tt.$)("esri.views.3d.environment.Precipitation")],ec);const tc=(0,Ml.BP)().vec3f(El.r.POSITION),rc=(0,Tl.U)((0,Ml.BP)().f32(El.r.INSTANCEFEATUREATTRIBUTE),1);var ic=r(28899),nc=r(21594);class sc extends wa.Y{constructor(){super(...arguments),this.modelMatrix=(0,qa.vt)()}}class oc extends Sa.w{constructor(e){super(e,new Pa.K,(()=>this.destroy()))}initializeProgram(e){return new Ma.B(e.rctx,oc.shader.get().build(),Ta.D)}initializePipeline(){return(0,Ca.Ey)({blending:(0,Ca.p3)(Aa.dn.SRC_ALPHA,Aa.dn.ONE,Aa.dn.ONE_MINUS_SRC_ALPHA,Aa.dn.ONE_MINUS_SRC_ALPHA),depthTest:{func:Aa.MT.LEQUAL},colorWrite:Ca.wE})}}oc.shader=new xa.$(nc.S,(()=>r.e(6922).then(r.bind(r,66922))));let ac=class extends ht.A{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return null!=this._loadDataTask&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._passParameters=new sc,this._updatingTracking=new bn.U}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=(0,Je.DC)(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=(0,Je.Gz)(this._technique),this._vao=(0,Je.WD)(this._vao),mc=null}render(e){const{rctx:t}=e;if(this._ensureResources(t),null==this._technique||null==this._vao)return;if(!this._technique.compiled)return void this.requestRender();const r=t.bindTechnique(this._technique,e.bindParameters,this._passParameters);t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(Aa.WR.POINTS,0,this._numPoints)}_ensureResources(e){if(null!=this._technique||null==mc)return;this._technique=new oc({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=mc.byteLength/pc;const t=new Float32Array(mc,0,2*this._numPoints),r=new Uint8Array(mc,2*this._numPoints*4,this._numPoints);this._vao=function(e,t,r,i){const n=fc.createBuffer(i),s=n.position,o=n.color,a=n.size;for(let l=0;l<i;l++){const e=t[2*l],i=t[2*l+1];s.set(l,0,-Math.cos(e)*Math.sin(i)),s.set(l,1,-Math.sin(e)*Math.sin(i)),s.set(l,2,-Math.cos(i));const n=cc(r[l]),c=lc(uc[n[1]]);o.set(l,0,255*c[0]),o.set(l,1,255*c[1]),o.set(l,2,255*c[2]),o.set(l,3,255),a.set(l,n[0])}return new Cl.Z(e,Ta.D,{geometry:(0,Tl.U)(fc)},{geometry:Rl.g.createVertex(e,Aa._U.STATIC_DRAW,n.buffer)})}(e,t,r,this._numPoints),this._updatingTracking.add((()=>"virtual"!==this.view.environment.lighting.type?this.view.environment.lighting.date:null),(e=>this._update(e)),gt.Vh)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*function(e){const t=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}(e),i=(0,$a.C)(this._passParameters.modelMatrix,dc);(0,$a.Qr)(i,i,-r*Math.PI),(0,$a.lw)(i,hc,i),(0,$a.Qr)(i,i,-t*Math.PI),this.requestRender()}_createLoadDataTask(){if(null!=mc)return null;const e=(0,Fn.UT)((async e=>{const{data:t}=await(0,ic.N)("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:e});(function(e){if(!e)throw new Ze.A("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/pc;if(t%1!=0||t>5e4||t<5e3)throw new Ze.A("stars:invalid-data","Failed to create stars because star catalogue data is invalid")})(t),mc=t}));return e.promise.catch((e=>{(0,Ke.zf)(e)||Xe.A.getLogger(this).error(e)})).then((()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))})),e}};function lc(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}function cc(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],ac.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],ac.prototype,"requestRender",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],ac.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)()],ac.prototype,"_loadDataTask",void 0),(0,ze._)([(0,Qe.MZ)()],ac.prototype,"_updatingTracking",void 0),ac=(0,ze._)([(0,tt.$)("esri.views.3d.environment.Stars")],ac);const uc=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],hc=(0,qa.fA)(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),dc=(0,qa.fA)(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),pc=9,fc=(0,Ml.BP)().vec3f(El.r.POSITION).vec4u8(El.r.COLOR).f32(El.r.SIZE);let mc=null;var gc,yc=r(60586),_c=r(77730);!function(e){e[e.Immediate=0]="Immediate",e[e.Faded=1]="Faded"}(gc||(gc={}));let vc=class extends yc.RW{constructor(e){super(e),this.produces=new Map([[_c.N.OPAQUE_ENVIRONMENT,()=>!(null===this._atmosphere&&null===this._stars)],[_c.N.TRANSPARENT_ENVIRONMENT,()=>!(null===this._atmosphere)]]),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new bc,this._newWeatherParameters=new bc,this._fadedWeatherParameters=new bc,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),null!=this.view?._stage&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return null!=this.atmosphere?this.atmosphere.type:ua.None}consumes(){return this._atmosphereType===ua.Realistic?yc.B7:yc.qo}updateAnimation(e){return null!=this._precipitation&&this._precipitation.update(e)}get updating(){return null!=this._stars&&this._stars.updating||null!=this._clouds&&this._clouds.running}get weatherVisible(){return(0,da.l)(this.view.state.camera.eye)-(0,pa.tO)(this.view.spatialReference).radius<=qo.ni}get usedMemory(){return this._clouds?.usedMemory??0}get _stars(){const e=this.view,t=e.environment?.starsEnabled??!1,r=this._get("_stars");return t&&null!=this._context?null!=r?r:new ac({view:e,requestRender:()=>this._setNeedsRender()}):((0,Je.pR)(r),null)}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||null==this._context)return(0,Je.pR)(e),null;const t=this.view,r=this._context;return null!=e&&e.context===r?e:((0,Je.pR)(e),new ec({context:r,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||null==this._context)return(0,Je.pR)(e),null;if(null!=e)return e;const t=this.view,r=this._context;return(0,Je.pR)(e),new ul({context:r,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||null==this._context)return(0,Je.pR)(e),null;const t=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=(0,pa.tO)(this.view.spatialReference).radius;return null!=e&&e.viewingMode===t&&e.planetRadius===i?e:((0,Je.pR)(e),new ja({rctx:r,viewingMode:t,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||null==this._context)return(0,Je.pR)(e),null;if(null!=e)return e;const t=this.view,r=this._context,i=this._context.renderContext.rctx,n=this.view.state.viewingMode;return new gl({context:r,view:t,rctx:i,viewingMode:n})}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}initializeRenderContext(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._context=e;const t=()=>this._setNeedsRender();this.addHandles([(0,gt.wB)((()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled})),(e=>this._updateAtmosphere(e)),gt.pc),(0,gt.wB)((()=>this._stars),t),(0,gt.wB)((()=>this._precipitation),t),(0,gt.wB)((()=>this._clouds),(()=>this._updateWeather()),gt.Vh),(0,gt.wB)((()=>this._fog),(()=>this._updateFogHaze()),gt.Vh),(0,gt.wB)((()=>this.view.state.mode),(()=>this._setNeedsRender()),gt.OH),(0,gt.wB)((()=>this._weatherUpdateParameters),(()=>{this._updateWeather(),this._updateFogHaze()}),gt.pc)])}uninitializeRenderContext(){this._context=null,this._atmosphere=(0,Je.pR)(this._atmosphere),this._set("_stars",(0,Je.pR)(this._stars)),this._set("_precipitation",(0,Je.pR)(this._precipitation)),this._set("_clouds",(0,Je.pR)(this._clouds)),this._set("_cloudsComposition",(0,Je.pR)(this._cloudsComposition)),this._set("_fog",(0,Je.pR)(this._fog))}prepareRender(e){e.bindParameters.cloudsFade.data=(0,Ga.q9)(this._clouds)?this._clouds:null,"local"!==this.view.viewingMode&&null!=e.bindParameters.cloudsFade.data?.cubeMap&&(this._updateWeatherFading(e.bindParameters,e.time),e.bindParameters.cloudsFade.renderingStage===Ga.c2.FINISHED&&null!=this._clouds&&0===this._clouds.coverage&&!1===this._clouds.running&&(this._clouds.destroyFrameBufferCube(),e.bindParameters.cloudsFade.data=null))}renderNode(e){switch(e.bindParameters.slot){case _c.N.OPAQUE_ENVIRONMENT:this._stars?.render(e),null!=this.atmosphere&&(this.atmosphere.render(e,this.view?._stage?.renderer?.fullResolutionAtmosphere),this._cloudsComposition&&null!=e.bindParameters.cloudsFade.data&&(this.weatherVisible&&null!=this._clouds&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(e)),e.bindParameters.cloudsFade.isFading&&this._context&&null!=e.bindParameters.cloudsFade.data?.cubeMap&&this._context.requestRender());break;case _c.N.TRANSPARENT_ENVIRONMENT:if(null!=this.atmosphere&&(this.atmosphere.renderHaze(e,this._weatherParameters.hazeAmount,this.view?._stage?.renderer?.fullResolutionAtmosphere),this._weatherParameters.fog.amount>0&&null!=this._fog&&this._fog.render(e,this._weatherParameters.fog),this._precipitation)){const t=this.view.environment.weather;"rainy"!==t.type&&"snowy"!==t.type||this._precipitation.render(e,t.precipitation,t.type)}}}updateLightSources(e,t,r,i){if(null!=this._context){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=t,n.bindParameters.newLighting.globalFactor=r,n.bindParameters.newLighting.set(e),i===gc.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return null==e?null:"rainy"===e.type||"snowy"===e.type?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:"foggy"===e.type?e.fogStrength:e.cloudCover}}_updateWeatherFading(e,t){e.cloudsFade.updateFading(e.camera,this.view.state.mode,t,this.view.qualitySettings.fadeDuration),e.cloudsFade.updateParallax(e.camera),e.weatherFading&&(function(e){e.cloudsFade.fadeMode!==Xa.OQ.CROSS_FADE&&e.cloudsFade.fadeMode!==Xa.OQ.FADE_IN?e.fadeLighting(0):e.fadeLighting(e.cloudsFade.fadeFactor)}(e),this._updateFogAtmoshpere(e))}_updateFogAtmoshpere(e){e.cloudsFade.fadeMode!==Xa.OQ.CROSS_FADE&&e.cloudsFade.fadeMode!==Xa.OQ.FADE_IN?this._fadeWeather(0):this._fadeWeather(e.cloudsFade.fadeFactor)}_fadeWeather(e){const{_newWeatherParameters:t,_oldWeatherParameters:r}=this;e>=1?this._weatherParameters=t:(this._fadedWeatherParameters.lerp(r,t,e),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const e=this._weatherUpdateParameters;null!=e&&null!=this._clouds&&(this._clouds.applyPreset(Ja.n[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){null!=this._context&&this._context.requestRender()}_updateFogHaze(){const e=this._weatherUpdateParameters;if(null==this._fog||null==e||null==this._context)return;const t=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),e.type){case"foggy":this._newWeatherParameters.fog.strength=(0,ws.Cc)(3e-5,.005,e.weatherAdjustment**3),(0,da.c)(this._newWeatherParameters.fog.color,xc),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=(0,ws.Cc)(4e-6,2e-4,(e.effect??0)**3),(0,da.c)(this._newWeatherParameters.fog.color,wc),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=(0,ws.Cc)(4e-6,2e-4,(e.effect??0)**3),(0,da.c)(this._newWeatherParameters.fog.color,xc),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}t.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(e){const t=this._selectAtmosphereType(e);if(t!==ua.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==t){this._atmosphere=(0,Je.pR)(this._atmosphere);const e=this._getAtmosphereClass(t);e&&(this._atmosphere=new e(this.view,this._context))}}else this._atmosphere=(0,Je.pR)(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(e){switch(e){case ua.Realistic:return Ua;case ua.Local:return Il;case ua.Mars:return Bl;default:case ua.None:return null}}_selectAtmosphereType(e){const{enabled:t,viewingMode:r}=e;return!t||(0,$n.KQ)(this.view.spatialReference)?ua.None:r===$s.RT.Local?ua.Local:null!=this._context&&(0,$n.B3)(this.view.spatialReference)?ua.Realistic:(0,$n.q8)(this.view.spatialReference)?ua.Mars:ua.None}get test(){}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],vc.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],vc.prototype,"atmosphere",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],vc.prototype,"_atmosphereType",null),(0,ze._)([(0,Qe.MZ)({type:Boolean,readOnly:!0})],vc.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],vc.prototype,"weatherVisible",null),(0,ze._)([(0,Qe.MZ)()],vc.prototype,"_context",void 0),(0,ze._)([(0,Qe.MZ)()],vc.prototype,"_atmosphere",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],vc.prototype,"_stars",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],vc.prototype,"_precipitation",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],vc.prototype,"_clouds",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],vc.prototype,"_cloudsComposition",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],vc.prototype,"_fog",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],vc.prototype,"weatherEnabled",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],vc.prototype,"_precipitationEnabled",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],vc.prototype,"_weatherUpdateParameters",null),vc=(0,ze._)([(0,tt.$)("esri.views.3d.environment.EnvironmentRenderer")],vc);class bc{constructor(){this.fog=new yl,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,(0,da.c)(this.fog.color,e.fog.color)}lerp(e,t,r){this.fog.amount=(0,ws.Cc)(e.fog.amount,t.fog.amount,r),this.hazeAmount=(0,ws.Cc)(e.hazeAmount,t.hazeAmount,r),this.fog.strength=(0,ws.Cc)(e.fog.strength,t.fog.strength,r),(0,da.o)(this.fog.color,e.fog.color,t.fog.color,r)}}const wc=(0,nn.fA)(.5,.5,.5),xc=(0,nn.fA)(1.5,1.5,1.5);var Sc,Tc,Mc,Ac=r(3136),Cc=r(54787),Ec={exports:{}};Sc=Ec,Tc=function(){var e=Math.PI,t=Math.sin,r=Math.cos,i=Math.tan,n=Math.asin,s=Math.atan2,o=Math.acos,a=e/180,l=864e5,c=2440588,u=2451545,h={dec:0,ra:0};function d(e){return new Date((e+.5-c)*l)}function p(e){return function(e){return e.valueOf()/l-.5+c}(e)-u}var f=23.4397*a;function m(e,n){return s(t(e)*r(f)-i(n)*t(f),r(e))}function g(e,i){return n(t(i)*r(f)+r(i)*t(f)*t(e))}function y(e,n,o){return s(t(e),r(e)*t(n)-i(o)*r(n))}function _(e,i,s){return n(t(i)*t(s)+r(i)*r(s)*r(e))}function v(e,t){return a*(280.16+360.9856235*e)-t}function b(e){return a*(357.5291+.98560028*e)}function w(e){return a*(1.9148*t(e)+.02*t(2*e)+3e-4*t(3*e))}function x(t,r){return t+r+102.9372*a+e}function S(e,t){var r=b(e),i=x(r,w(r));return t||(t={dec:0,ra:0}),t.dec=g(i,0),t.ra=m(i,0),t}var T={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(e,t,r,i){var n=a*-r,s=a*t,o=p(e),l=S(o,h),c=v(o,n)-l.ra;return i||(i={azimuth:0,altitude:0}),i.azimuth=y(c,s,l.dec),i.altitude=_(c,s,l.dec),i}},M=[[-.83,"sunrise","sunset"]];T.addTime=function(e,t,r){M.push([e,t,r])};var A=9e-4;function C(t,r){return Math.round(t-A-r/(2*e))}function E(t,r,i){return A+(t+r)/(2*e)+i}function R(e,r,i){return u+e+.0053*t(r)-.0069*t(2*i)}function P(e,i,n){return o((t(e)-t(i)*t(n))/(r(i)*r(n)))}function O(e){var i=a*(134.963+13.064993*e),n=a*(93.272+13.22935*e),s=a*(218.316+13.176396*e)+6.289*a*t(i),o=5.128*a*t(n),l=385001-20905*r(i);return{ra:m(s,o),dec:g(s,o),dist:l}}return T.getTimes=function(e,i,n){var s=a*-n,o=a*i,l=C(p(e),s),c=E(0,s,l),u=b(c),h=w(u),f=x(u,h),m=g(f,0),y=R(c,u,f);function _(e){return R(E(P(e,o,m),s,l),u,f)}var v,S,A,O,I,L={solarNoon:d(y),nadir:d(y-.5),polarException:T.PolarException.NORMAL};for(v=0,S=M.length;v<S;v+=1)I=y-((O=_((A=M[v])[0]*a))-y),L[A[1]]=d(I),L[A[2]]=d(O);return L.polarException=function(e){var i=(t(e)-t(o)*t(m))/(r(o)*r(m));return i<-1?T.PolarException.MIDNIGHT_SUN:i>1?T.PolarException.POLAR_NIGHT:T.PolarException.NORMAL}(M[0][0]*a),L},T.getMoonPosition=function(e,t,r){var n=a*-r,s=a*t,o=p(e),l=O(o),c=v(o,n)-l.ra,u=_(c,s,l.dec);return u+=.017*a/i(u+10.26*a/(u+5.1*a)),{azimuth:y(c,s,l.dec),altitude:u,distance:l.dist}},T.getMoonFraction=function(e){var i=p(e),n=S(i),a=O(i),l=149598e3,c=o(t(n.dec)*t(a.dec)+r(n.dec)*r(a.dec)*r(n.ra-a.ra)),u=s(l*t(c),a.dist-l*r(c));return(1+r(u))/2},T},void 0!==(Mc=Tc())&&(Sc.exports=Mc);const Rc=(0,Cc.g)(Ec.exports),Pc={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};class Oc{constructor(e,t){this.direct=e,this.ambient=t}}function Ic(e,t,r,i,n,s){(0,da.s)(s.ambient.color,1,1,1),s.ambient.intensity=Pc.global.ambient,(0,da.s)(s.direct.color,1,1,1),s.direct.intensity=Pc.global.direct;const o=t[2],a=(0,ws.qE)((Math.abs(o)-Pc.local.altitude)/(Pc.global.altitude-Pc.local.altitude),0,1);let l;if(s.globalFactor=a,null!=e&&(l=Rc.getTimes(e,t[1],t[0])),a<1){let t;if(null!=e)t=function(e,t,r){const i=e.valueOf();let n,s;t.polarException===Rc.PolarException.MIDNIGHT_SUN?(n=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=n+432e6):t.polarException===Rc.PolarException.POLAR_NIGHT?(n=i-2,s=i-1):(n=t.sunrise.valueOf(),s=t.sunset.valueOf());const o=s-n,a=n+o/2,l=o/4,c=a-l,u=a+l,h=.06*o,d=n-h/2,p=n+h/2,f=s-h/2,m=s+h/2,g=(0,va.vt)(),y=(0,nn.vt)(),_=(0,nn.vt)();let v="";if(i<d||i>m)(0,ma.C)(g,Yc),(0,da.c)(y,Bc),(0,da.c)(_,Zc),v="night";else if(i<p){const e=(i-d)/(p-d);(0,ma.Cc)(g,Yc,Xc,e),(0,da.o)(y,Bc,jc,e),(0,da.o)(_,Zc,$c,e),v="sun rising"}else if(i<c){const e=(i-p)/(c-p);(0,ma.Cc)(g,Xc,Jc,e),(0,da.o)(y,jc,Hc,e),(0,da.o)(_,$c,qc,e),v="early morning"}else if(i<a){const e=(i-c)/(a-c);(0,ma.Cc)(g,Jc,Kc,e),(0,da.o)(y,Hc,Gc,e),(0,da.o)(_,qc,Wc,e),v="late morning"}else if(i<u){const e=(i-a)/(u-a);(0,ma.Cc)(g,Kc,Qc,e),(0,da.o)(y,Gc,eu,e),(0,da.o)(_,Wc,tu,e),v="early afternoon"}else if(i<f){const e=(i-u)/(f-u);(0,ma.Cc)(g,Qc,ru,e),(0,da.o)(y,eu,iu,e),(0,da.o)(_,tu,nu,e),v="late afternoon"}else if(i<m){const e=(i-f)/(m-f);(0,ma.Cc)(g,ru,Yc,e),(0,da.o)(y,iu,Bc,e),(0,da.o)(_,nu,Zc,e),v="sun setting"}let b=0;switch(r){case"rainy":case"foggy":b=.8;break;case"snowy":b=.5}b>0&&(Vc(y,b),Vc(_,b));const w=Uc(r);return{direct:{intensity:g[0]*w.direct,color:y},ambient:{intensity:g[1]*w.ambient,color:_},timeOfDay:v}}(e,l,i);else{const e=Uc(i);t={direct:{intensity:Pc.local.directAtNoon*e.direct,color:(0,nn.fA)(1,1,1)},ambient:{intensity:Pc.local.ambientAtNoon*e.ambient,color:(0,nn.fA)(1,1,1)},timeOfDay:"early afternoon"}}(0,da.o)(s.ambient.color,t.ambient.color,s.ambient.color,a),s.ambient.intensity=(0,ws.Cc)(t.ambient.intensity,s.ambient.intensity,a),(0,da.o)(s.direct.color,t.direct.color,s.direct.color,a),s.direct.intensity=(0,ws.Cc)(t.direct.intensity,s.direct.intensity,a),s.specularStrength="rainy"===i||"snowy"===i||"foggy"===i?0:1,s.environmentStrength="rainy"===i?.7:"snowy"===i||"foggy"===i?.75:1}s.noonFactor=null!=e?function(e,t){const r=e.valueOf();let i,n;t.polarException===Rc.PolarException.MIDNIGHT_SUN?(i=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=i+432e6):t.polarException===Rc.PolarException.POLAR_NIGHT?(i=r-2,n=r-1):(i=t.sunrise.valueOf(),n=t.sunset.valueOf());const s=i+(n-i)/2;return 1-(0,ws.qE)(Math.abs(r-s)/432e5,0,1)}(e,l):1,null!=e?Nc(e,t,r,s.direct.directionToLightSource):Lc(n,r,s.direct.directionToLightSource)}function Lc(e,t,r){t===$s.RT.Global?(0,da.n)(ou,e.eye):(0,da.s)(ou,0,0,1),(0,da.j)(au,e.viewForward,-1);const i=(0,vo.g7)(au,ou),n=Math.max(i-2*cu,0),s=.85*n/(n+1),o=Math.max(cu,i-cu-s);(0,$a.$0)(su,-o,e.viewRight),(0,da.h)(r,au,su),(0,da.g)(r,r,(0,da.j)(lu,e.viewRight,uu)),(0,da.n)(r,r)}function Nc(e,t,r,i){const n=zc,s=(0,$a.D_)(kc);if(r===$s.RT.Global)Rc.getPosition(e,0,0,n),(0,da.s)(i,0,0,-1),(0,$a.eL)(s,s,-n.azimuth),(0,$a.Z8)(s,s,-n.altitude),(0,da.h)(i,i,s);else{const r=Pc.planarDirection,o=r.globalAngles,a=t[2];let l=(Math.abs(a)-r.localAltitude)/(r.globalAltitude-r.localAltitude);l=(0,ws.qE)(l,0,1),l<1?(Rc.getPosition(e,t[1],t[0],n),n.azimuth=(1-l)*n.azimuth+l*o.azimuth,n.altitude=(1-l)*n.altitude+l*o.altitude):(n.azimuth=o.azimuth,n.altitude=o.altitude),(0,da.s)(i,0,-1,0),(0,$a.Qr)(s,s,-n.azimuth),(0,$a.eL)(s,s,-n.altitude),(0,da.h)(i,i,s)}}const Dc=(0,nn.fA)(.5773502691896258,-.5773502691896258,.5773502691896258);class Fc{constructor(){this.ambient={color:(0,nn.fA)(1,1,1),intensity:.55},this.direct={color:(0,nn.fA)(1,1,1),intensity:.55,directionToLightSource:(0,nn.o8)(Dc)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const kc=(0,qa.vt)(),zc={azimuth:0,altitude:0};function Uc(e){switch(e){case"disabled":case"sunny":case"cloudy":return new Oc(1,1);case"rainy":return new Oc(.4,1.2);case"snowy":return new Oc(.5,1.3);case"foggy":return new Oc(.2,1.6)}}function Vc(e,t){const r=(e[0]+e[1]+e[2])/3;e[0]+=(r-e[0])*t,e[1]+=(r-e[1])*t,e[2]+=(r-e[2])*t}const Bc=(0,nn.fA)(.01,.01,.01),jc=(0,nn.fA)(1,.6,.5),Hc=(0,nn.fA)(1,.98,.98),Gc=(0,nn.fA)(1,1,1),Zc=(0,nn.fA)(.8,.8,1),$c=(0,nn.fA)(.8,.8,1),qc=(0,nn.fA)(.98,.98,1),Wc=(0,nn.fA)(1,1,1),Yc=(0,va.fA)(.01,Pc.local.ambientAtNight),Xc=(0,va.fA)(Pc.local.directAtTwilight,Pc.local.ambientAtTwilight),Jc=(0,va.fA)(.9*Pc.local.directAtNoon,Pc.local.ambientAtNoon),Kc=(0,va.fA)(Pc.local.directAtNoon,Pc.local.ambientAtNoon),Qc=Jc,eu=Hc,tu=qc,ru=Xc,iu=jc,nu=$c;new Date(0);const su=(0,qa.vt)(),ou=(0,nn.vt)(),au=(0,nn.vt)(),lu=(0,nn.vt)(),cu=.25,uu=.2;var hu=r(71011),du=r(29772);let pu=class extends pt.A.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandlesKey="viewHandles",this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new hu.Qx,this._ambientLight=new hu.$p,this._moonLight=new hu._y,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePositionGeographic=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===$s.RT.Global&&(0,$n.B3)(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionGeographic(){return this._referencePositionGeographic}connectView(e){if(this._renderer)return;this._renderer=new vc({view:e});const t=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this.addHandles([(0,gt.wB)((()=>e.environment.lighting),(e=>this._updateLightingHandler(e)),gt.OH),(0,gt.wB)((()=>"virtual"!==e.environment.lighting.type?e.environment.lighting.date:null),(e=>this._lightingDateHandler(e)),gt.OH),(0,gt.wB)((()=>e.stationary),(()=>this._interactingStationaryHandler())),(0,gt.wB)((()=>e.environment.lighting.directShadowsEnabled),t,gt.OH),(0,gt.wB)((()=>e.qualitySettings.ambientOcclusion),t,gt.OH),(0,gt.wB)((()=>e.qualitySettings.reflections),t,gt.OH),(0,gt.wB)((()=>e.spatialReference),(()=>this._resetReferencePosition(!0)),gt.OH),(0,gt.wB)((()=>e.environment.weather.type),(()=>this._updateLighting(null,gc.Faded)),gt.OH),(0,gt.wB)((()=>this.weatherEnabled),(()=>this._updateLighting(null,gc.Faded)),gt.OH),(0,gt.wB)((()=>e.viewingMode),(()=>this._resetReferencePosition(!0)),gt.pc),(0,gt.wB)((()=>"virtual"!==e.environment.lighting.type&&e.environment.lighting.cameraTrackingEnabled),(e=>this._updateCameraTracking(e)),gt.pc),(0,gt.wB)((()=>e.state.camera),r,gt.pc),(0,gt.wB)((()=>this.disableQueries),r)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=(0,Je.pR)(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking("virtual"!==e.type&&e.cameraTrackingEnabled),this._lightingDateHandler("virtual"!==e.type?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const e=this._view.environment.lighting;"virtual"!==e?.type&&(e.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if("virtual"!==t?.type){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!(0,an.canProjectWithoutEngine)(r,Bt.A.WGS84)){const e=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(e))return void this._requestReferencePositionUpdate(e)}if(this._preupdateTracking(e),null!=this._referencePositionGeographic){const e=(0,Ac.aE)(this._referencePositionGeographic,yu);null!=e&&(t.autoUpdate(null,e),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&"virtual"!==this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=this._view;if(!t.ready)return;const r=t.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,t){const r=(0,$n.B3)(this._view.spatialReference);if(r&&!(0,an.canProjectWithoutEngine)(this._view.spatialReference,Bt.A.WGS84))return"virtual"===this._view.environment.lighting.type&&this._updateLighting(),!1;const i=e.position;return this._referencePositionGeographic??=(0,nn.vt)(),r?(0,cn.g)(i,this._referencePositionGeographic,Bt.A.WGS84):(0,da.s)(this._referencePositionGeographic,i.longitude??0,i.latitude??0,i.z??0),this.notifyChange("referencePositionGeographic"),this._autoUpdateTimezone(this._referencePositionGeographic,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePositionGeographic&&(this._referencePositionGeographic[2]=(t.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:gc.Immediate;const r=this._view;e=e||("virtual"===r.environment.lighting.type?null:r.environment.lighting.date);const i=this._referencePositionGeographic,n=i?fu:mu,s=this.weatherVisible?r.environment.weather.type:"disabled";null!=i?Ic(e,i,r.state.viewingMode,s,r.state.camera,n):"virtual"===r.environment.lighting.type&&Lc(r.state.camera,r.state.viewingMode,n.direct.directionToLightSource);const o=this._mainLight,a=n.direct;(0,da.j)(o.intensity,a.color,a.intensity*Math.PI),(0,da.c)(o.direction,a.directionToLightSource),o.specularStrength=n.specularStrength,o.environmentStrength=n.environmentStrength;const l=this._ambientLight;(0,da.j)(l.intensity,n.ambient.color,n.ambient.intensity);const c=this._moonLight;(0,da.o)(c.intensity,_u,vu,n.globalFactor);const u=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));(0,da.j)(c.intensity,c.intensity,u),(0,da.c)(c.direction,a.directionToLightSource),this._renderer.updateLightSources([o,l,c],n.noonFactor,n.globalFactor,t),this._updateRenderParameters()}_autoUpdateTimezone(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||null==e)return!1;const r=gu;r.setTime((t||this._view.environment.lighting.date).getTime());const i=(0,Ac.aE)(e,yu);if(null==i)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===i.hours&&n.minutes===i.minutes&&n.seconds===i.seconds)return!1}else n=i;const s=r.getUTCHours()-(i.hours-n.hours),o=r.getUTCMinutes()-(i.minutes-n.minutes),a=r.getUTCSeconds()-(i.seconds-n.seconds);return r.setUTCHours(s),r.setUTCMinutes(o),r.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(r,i)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=null==this._referencePositionGeographic||function(e,t){if(t===$s.RT.Global)return!0;const r=Pc.planarDirection;return Math.abs(e)<r.localAltitude}(this._referencePositionGeographic[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePositionGeographic=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const e=this._referencePosUpdateQuery=(0,Ke.Pl)(this._referencePointUpdateDelay).then((()=>{if(this._referencePosUpdateQuery===e){const t=()=>this._referencePosUpdateQuery!==e;return this._doReferencePositionUpdateQuery(t)}})).catch((e=>{"mapcoordshelper:missing-geometry-service"===e.name&&(this.disableQueries=!0)})).then((()=>{this._referencePosUpdateQuery===e&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))})),t=this._referencePosUpdateTimer=(0,Ke.Pl)(this._referencePointUpdateInterval).then((()=>{this._referencePosUpdateTimer===t&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())}));this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const e=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePositionGeographic?(0,da.s)(this._referencePositionGeographic,t[0],t[1],e):this._referencePositionGeographic=(0,nn.fA)(t[0],t[1],e),this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePositionGeographic)||this._updateLighting(),this.notifyChange("referencePositionGeographic")}_exceedsReferencePosDistThreshold(e){const t=this._referencePosMapCoords;if(null==t)return!0;const r=(0,du.Ce)(t,e);return null==r||(0,ha.kM)(r,"meters").value>this._referencePointUpdateDistThreshold}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){}};(0,ze._)([(0,Qe.MZ)({type:Boolean,readOnly:!0})],pu.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)()],pu.prototype,"disableQueries",void 0),(0,ze._)([(0,Qe.MZ)()],pu.prototype,"_disableWeather",void 0),(0,ze._)([(0,Qe.MZ)()],pu.prototype,"weatherEnabled",null),(0,ze._)([(0,Qe.MZ)()],pu.prototype,"weatherVisible",null),(0,ze._)([(0,Qe.MZ)()],pu.prototype,"referencePositionGeographic",null),(0,ze._)([(0,Qe.MZ)()],pu.prototype,"_renderer",void 0),(0,ze._)([(0,Qe.MZ)()],pu.prototype,"_referencePositionGeographic",void 0),pu=(0,ze._)([(0,tt.$)("esri.views.3d.environment.SceneViewEnvironmentManager")],pu);const fu=new Fc,mu=new Fc,gu=new Date,yu={hours:0,minutes:0,seconds:0},_u=(0,nn.fA)(.22,.22,.33),vu=(0,nn.fA)(.22,.22,.22);var bu,wu,xu,Su=r(93582),Tu=r(95925);!function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"}(bu||(bu={})),function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"}(wu||(wu={})),function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"}(xu||(xu={}));class Mu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bu.ALL,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wu.NONE,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:xu.TUMBLE;this.selection=e,this.interactionType=t,this.interactionFactor=r,this.interactionStartCamera=i,this.interactionDirection=n,this.tiltMode=s}}function Au(e,t){return!!(e&t)}function Cu(e,t,r,i,n,s){0!==e&&(r?(s.min=Math.min(s.min,t),s.max=Math.max(s.max,t)):null!=i?(s.min-=Math.max(0,(t-s.min)*(1-i)),s.max+=Math.max(0,(t-s.max)*(1-i))):n&&(s.min-=Math.max(0,t-s.min-n),s.max+=Math.max(0,t-s.max-n)))}const Eu=new Mu(bu.NONE);function Ru(e,t,r,i){return t=t||e.viewForward,(0,da.c)(i,t),(0,da.j)(i,i,Math.sign((0,da.m)(t,r))),i}var Pu=r(70335);function Ou(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Eu;if(!function(e,t){const r=e.state.constraints.altitude;return!(!e.state.isGlobal||!r)&&(t.interactionType!==wu.TUMBLE||!Au(t.selection,bu.TILT))}(e,r)||!e.state.constraints.altitude)return 0;const i=function(e,t){return t.min=e.min,t.max=e.max,t}(e.state.constraints.altitude,Iu);!function(e,t,r){const i=t.interactionType;if(i===wu.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:o,interactionFactor:a}=t;if(!o)return;const l=i===wu.TUMBLE||i===wu.ZOOM,c=Ou(e,o),u=0===c?0:e.renderCoordsHelper.getAltitude(o.eye);r.min=n,r.max=s,Cu(c,u,l,a,.05*u,r)}(e,r,i);const n=e.renderCoordsHelper.getAltitude(t.eye),s=(0,ws.qE)(n,i.min,i.max)-n;return Math.abs(s)<=1e-6?0:s}const Iu={min:0,max:0},Lu=(0,nn.vt)(),Nu=(0,nn.vt)(),Du=(0,nn.vt)(),Fu=(0,nn.vt)();function ku(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Eu;if(!e.state.isLocal)return 0;const i=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;Uu.min=0,Uu.max=i,function(e,t,r){const i=t.interactionType;if(i===wu.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:o,interactionFactor:a}=t;if(!o)return;const l=i===wu.ZOOM||i===wu.PAN,c=ku(e,o),u=0===c?0:zu(e,o);r.min=n,r.max=s,Cu(c,u,l,a,.05*u,r)}(e,r,Uu);const n=zu(e,t),s=Uu.max-n;return s>=-1e-6?0:s}function zu(e,t){const r=e.pointsOfInterest.surfaceOrigin;return r.renderLocation?(0,da.p)(t.eye,r.renderLocation):0}const Uu={min:0,max:0},Vu=(0,nn.vt)(),Bu=(0,nn.vt)(),ju=(0,nn.vt)(),Hu=(0,nn.vt)(),Gu=(0,nn.vt)();var Zu,$u=r(84687);function qu(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Zu.EYE;const i=e.state.constraints;if(!i.collision.enabled)return!1;const n=(0,$u.Rt)(e,t.eye),s=e.renderCoordsHelper.getAltitude(t.eye),o=n+i.collision.elevationMargin;if(s>=o)return!1;const a=(0,da.l)(t.eye);if((0,da.f)(Wu,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(Yu,o,t.eye),r===Zu.EYE_AND_CENTER)t.center=(0,da.g)(Wu,t.eye,Wu);else if(r===Zu.EYE_AND_CENTER_SCALE){const e=(a-s+o)/a;t.center=(0,da.j)(Wu,t.center,e)}return!0}!function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"}(Zu||(Zu={}));const Wu=(0,nn.vt)(),Yu=(0,nn.vt)();function Xu(e,t,r){e.worldUpAtPosition(t,Ju),(0,da.f)(Ku,r,t);const i=(0,da.l)(Ku);return 0===i?0:(0,ws.XM)((0,da.m)(Ku,Ju)/i)}const Ju=(0,nn.vt)(),Ku=(0,nn.vt)();function Qu(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Eu,n=arguments.length>4?arguments[4]:void 0;if(!e.state.constraints.tilt)return 0;const s=t.distance,o=e.state.constraints.tilt(s,ah);return function(e,t,r){if(t.interactionType===wu.NONE)return;const{interactionStartCamera:i,interactionFactor:n}=t;if(!i)return;const{min:s,max:o}=r,a=Qu(e,i,Eu,t),l=0===a?0:Xu(e.renderCoordsHelper,i.center,i.eye);r.min=s,r.max=o,t.interactionType===wu.TUMBLE?(Au(t.selection,bu.ALTITUDE)&&rh(e,i,r),Cu(a,l,!0,n,oh,r)):Cu(a,l,!1,n,oh,r)}(e,r,o),i.interactionType===wu.TUMBLE&&Au(i.selection,bu.ALTITUDE)&&rh(e,i.interactionStartCamera,o),r.tiltMode===xu.LOOK_AROUND||i.tiltMode===xu.LOOK_AROUND?function(e,t,r,i){switch(i&&(i.requiresTwoSteps=!1),e.viewingMode){case"global":return function(e,t,r,i){const n=function(e,t,r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=i+(0,pa.tO)(e.spatialReference).radius,s=e.renderCoordsHelper.intersectManifold(t.ray,i,sh);return r.eyeCenterDistance=t.distance,r.centerIsOnSurface=!1,null!=s?(r.eyeCenterDistance=(0,da.p)(t.eye,s),r.tiltAtCenter=Xu(e.renderCoordsHelper,s,t.eye),r.centerIsOnSurface=!0):e.state.isLocal?r.tiltAtCenter=Xu(e.renderCoordsHelper,t.center,t.eye):((0,Su.e)((0,Su.h)(Su.t,n),t.ray,sh),r.eyeCenterDistance=(0,da.p)(t.eye,sh),r.tiltAtCenter=(0,ws.XM)(-(0,da.m)(t.viewForward,(0,da.n)(sh,sh)))),r.radius=n,r.eyeRadius=(0,da.l)(t.eye),r.constraints=e.state.constraints,r}(e,t,lh),s=(0,ws.qE)(n.tiltAtCenter,r.min,r.max);if(!eh(n.tiltAtCenter-s))return 0;let o,a;return n.centerIsOnSurface?(o=function(e){const{constraints:t,eyeCenterDistance:r,tiltAtCenter:i}=e;let n=i,s=t.clampTilt(r,i);const o=th(e,s);if(t.clampTilt(o,i)===s)return s;let a=0;for(;a<10&&eh(s-n);){const r=(n+s)/2,i=th(e,r);eh(t.clampTilt(i,r)-r)?n=r:s=r,a++}return s}(n),a=function(e,t){const r=(0,ws.YN)(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),i=(0,ws.YN)(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?r-i:i-r}(n,o)):(o=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=function(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}(n,o)),i&&(i.eyeCenterDistance=th(n,o)),a}(e,t,r,i);case"local":return function(e,t,r,i){const n=Xu(e.renderCoordsHelper,t.center,t.eye),s=(0,ws.qE)(n,r.min,r.max),o=n-s;if(!eh(o))return 0;if(i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=e.renderCoordsHelper.getAltitude(t.eye)-r,o=Math.cos(s);Math.abs(o)>1e-4?i.eyeCenterDistance=n/o:i.eyeCenterDistance=t.distance}return o}(e,t,r,i)}}(e,t,o,n):function(e,t,r){const i=Xu(e.renderCoordsHelper,t.center,t.eye),n=i-(0,ws.qE)(i,r.min,r.max);return eh(n)?n:0}(e,t,o)}function eh(e){return Math.abs(e)>1e-9}function th(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const r=Math.PI-(0,ws.qE)(t,0,Math.PI),i=(0,ws.YN)(e.radius/e.eyeRadius*Math.sin(r)),n=Math.PI-r-i,s=Math.sin(n)/Math.sin(r);if(e.eyeRadius<e.radius&&s>1){const t=Math.PI-i,n=Math.PI-r-t;return Math.sin(n)/Math.sin(r)*e.eyeRadius}return s*e.eyeRadius}function rh(e,t,r){const i=e.state.constraints;if(e.state.isLocal||!i.altitude||!t)return;const n=(0,da.q)(t.center),s=Math.sqrt(n),o=t.distance,a=(0,pa.tO)(e.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,u=(l*l-o*o-n)/(-2*s*o),h=(c*c-o*o-n)/(-2*s*o);r.min=Math.max(r.min,Math.min(Math.PI-(0,ws.XM)(h),r.max)),r.max=Math.min(r.max,Math.PI-(0,ws.XM)(u))}const ih=(0,nn.vt)(),nh=(0,qa.vt)(),sh=(0,nn.vt)(),oh=(0,ws.kU)(5),ah={min:0,max:0},lh={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},ch={eyeCenterDistance:0,requiresTwoSteps:!1},uh=e=>e*e,hh=e=>1-uh(1-e),dh=e=>e*e*e,ph=e=>1-dh(1-e),fh=e=>e<.5?dh(2*e)/2:(ph(2*(e-.5))+1)/2,mh=e=>e*e*e*e,gh=e=>1-mh(1-e),yh=e=>e*e*e*e*e,_h=e=>1-yh(1-e),vh=e=>1-Math.cos(e*Math.PI/2),bh=e=>1-vh(1-e),wh=e=>2**(10*(e-1)),xh=e=>1-wh(1-e),Sh=e=>-(Math.sqrt(1-e*e)-1),Th=e=>1-Sh(1-e);function Mh(e){const t=2*(e-Math.sqrt((e-1)*e)),r=t/2/e;return i=>i<r?e*i*i:t*i-t+1}function Ah(e,t){return(r,i)=>r<t?t*e(r/t,i):1-e((1-r)/(1-t),i)*(1-t)}const Ch=Ah(Mh(1),1),Eh=Ah(Mh(1),0),Rh=Ah(Mh(1),.5),Ph=Ah(Mh(2),1),Oh=Ah(Mh(2),0),Ih=Ah(Mh(2),.5),Lh=Ah(Mh(3),1),Nh=Ah(Mh(3),0),Dh=Ah(Mh(3),.5),Fh=Ah(Mh(4),1),kh=Ah(Mh(4),0),zh=Ah(Mh(4),.5),Uh={linear:e=>e,"in-quad":uh,"out-quad":hh,"in-out-quad":e=>e<.5?uh(2*e)/2:(hh(2*(e-.5))+1)/2,"in-coast-quad":Ch,"out-coast-quad":Eh,"in-out-coast-quad":Rh,"in-cubic":dh,"out-cubic":ph,"in-out-cubic":fh,"in-coast-cubic":Ph,"out-coast-cubic":Oh,"in-out-coast-cubic":Ih,"in-quart":mh,"out-quart":gh,"in-out-quart":e=>e<.5?mh(2*e)/2:(gh(2*(e-.5))+1)/2,"in-coast-quart":Lh,"out-coast-quart":Nh,"in-out-coast-quart":Dh,"in-quint":yh,"out-quint":_h,"in-out-quint":e=>e<.5?yh(2*e)/2:(_h(2*(e-.5))+1)/2,"in-coast-quint":Fh,"out-coast-quint":kh,"in-out-coast-quint":zh,"in-sine":vh,"out-sine":bh,"in-out-sine":e=>e<.5?vh(2*e)/2:(bh(2*(e-.5))+1)/2,"in-expo":wh,"out-expo":xh,"in-out-expo":e=>e<.5?wh(2*e)/2:(xh(2*(e-.5))+1)/2,"in-circ":Sh,"out-circ":Th,"in-out-circ":e=>e<.5?Sh(2*e)/2:(Th(2*(e-.5))+1)/2};function Vh(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Hh,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t;i!==t&&i.copyFrom(t),i.computeUp(e.state.viewingMode);let n=!1;for(let a=0;a<Gh;a++){let t=0;for(const s of jh)if(Au(r.selection,s.type)){const o=Math.abs(s.error(e,i,r));s.apply(e,i,r)&&(n=!0,t+=o)}if(0===t)break}const s=Au(r.selection,bu.COLLISION),o=function(e,t){switch(e){case wu.PAN:return Zu.EYE_AND_CENTER;case wu.ASCEND:return t.state.isGlobal?Zu.EYE_AND_CENTER_SCALE:Zu.EYE_AND_CENTER;default:return Zu.EYE}}(r.interactionType,e);return s&&qu(e,i,o)&&(n=!0),n&&i.computeUp(e.state.viewingMode),n}function Bh(e){const t=Math.min(1,e/150);return fh(t)}const jh=[{type:bu.TILT,error:function(e,t,r){return Qu(e,t,r)*t.distance},apply:function e(t,r,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];ch.eyeCenterDistance=0,ch.requiresTwoSteps=!1;const s=Qu(t,r,i,Eu,ch);if(0===s)return!1;switch((0,$a.$0)(nh,-s,r.viewRight),i.tiltMode){case xu.LOOK_AROUND:(0,da.h)(ih,r.viewForward,nh),(0,da.j)(ih,ih,ch.eyeCenterDistance),r.center=(0,da.g)(sh,r.eye,ih);break;case xu.TUMBLE:(0,da.f)(ih,r.center,r.eye),(0,da.h)(ih,ih,nh),r.eye=(0,da.f)(sh,r.center,ih);break;default:(0,Ge.Xb)(i.tiltMode)}return r.up=(0,da.h)(sh,r.up,nh),!ch.requiresTwoSteps||!n||e(t,r,i,!1)}},{type:bu.ALTITUDE,error:Ou,apply:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Eu;const i=Ou(e,t,r);if(0===i)return!1;const n=e.renderCoordsHelper,s=n.getAltitude(t.eye)+i,o=Ru(t,r.interactionDirection,function(e,t,r,i){return e.renderCoordsHelper.worldUpAtPosition(t.eye,i),(0,da.j)(i,i,r),i}(e,t,Math.sign(i),Nu),Lu),a=(0,da.c)(Du,t.viewForward),l=n.intersectInfiniteManifold((0,Tu.LV)(t.eye,o),s,Fu);return t.eye=null!=l?l:n.setAltitude(Fu,s,t.eye),t.center=(0,Pu.Rg)(Fu,t.eye,a,t.center),!0}},{type:bu.DISTANCE,error:ku,apply:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Eu;const i=ku(e,t,r);if(0===i)return!1;const n=e.pointsOfInterest.surfaceOrigin;if(!n.renderLocation)return!1;const s=zu(e,t)+i,o=(0,da.c)(Vu,t.eye),a=Ru(t,r.interactionDirection,function(e,t,r){return(0,da.E)(r,e.eye,t)}(t,n.renderLocation,Hu),ju);if(!(0,Su.i)((0,Su.k)(n.renderLocation,s),(0,Tu.LV)(t.eye,a),Gu))return!1;t.eye=Gu;const l=(0,da.f)(Bu,t.eye,o);t.center=(0,da.g)(Gu,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),u=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,Gu);return null!=u&&(t.center=u),!0}}],Hh=new Mu,Gh=5;var Zh=r(44680);class $h{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(e){this.viewingMode=e,this.center=(0,nn.vt)(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=(0,nn.o8)(ed),this._fov=55,this._size=1}pixelsPerPanAtZoom(e){return this._size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this._size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/e}compareTo(e,t){if(this.viewingMode===$s.RT.Global){const r=((0,da.l)(this.center)+(0,da.l)(e.center))/2;t.pan=(0,vo.g7)(this.center,e.center)*r}else t.pan=(0,da.p)(this.center,e.center);let r=Math.abs(e._yaw-this._yaw);r>=Math.PI&&(r=2*Math.PI-r);const i=Math.abs(e._pitch-this._pitch);t.rotate=Math.max(r,i),t.fov=e.fov-this.fov,t.sourceZoom=this._distance,t.targetZoom=e._distance}interpolate(e,t,r){this.viewingMode===$s.RT.Global?(0,vo.nu)(e.center,t.center,r.pan,this.center):(0,da.o)(this.center,e.center,t.center,r.pan),this._distance=isFinite(t.distance)?(0,ws.Cc)(e.distance,t.distance+r.zoomOffset,r.zoom):e.distance,this._pitch=(0,ws.Cc)(e.pitch,t.pitch,r.rotate);let i=e._yaw;const n=t._yaw;Math.abs(n-i)>=Math.PI&&(i+=2*(i<n?1:-1)*Math.PI),this._yaw=(0,ws.Cc)(i,n,r.rotate),this._fov=(0,ws.Cc)(e.fov,t.fov,r.fov)}copyFrom(e){(0,da.c)(this.center,e.center),this._pitch=e.pitch,this._yaw=e.yaw,this._distance=e.distance,(0,da.c)(this.direction,e.direction),this._size=e.size,this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const t=this._lookAtOrientation(e.center,rd);(0,da.c)(this.center,e.center),(0,da.f)(Xh,e.center,e.eye),(0,da.t)(Xh,Xh,t),(0,da.t)(Jh,e.up,t),this._distance=(0,da.l)(Xh),0!==this._distance&&(Xh[0]/=this._distance,Xh[1]/=this._distance,Xh[2]/=this._distance),this._pitch=this._eyeUpToPitch(Xh),this._yaw=function(e,t){const r=Kh;return Math.abs(t[2])<.5?((0,da.c)(r,t),e[2]>0&&(0,da.j)(r,r,-1)):(0,da.c)(r,e),(0,da.b)(Wh,r,Qh),(0,da.n)(Wh,Wh),(0,vo.g7)(td,Wh,Qh)}(Xh,Jh),this._size=Math.sqrt(e.width*e.width+e.height*e.height),this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(e){const t=this._lookAtOrientation(this.center,rd);(0,Za.mg)(t,t),this._axisAngleVec3(td,this._pitch-Math.PI/2,ed,Xh),this._axisAngleVec3(Qh,this._yaw,Xh,Xh),this._axisAngleVec3(td,this._pitch-Math.PI/2,Qh,Jh),this._axisAngleVec3(Qh,this._yaw,Jh,Jh),(0,da.j)(Xh,Xh,this._distance),(0,da.t)(Xh,Xh,t),(0,da.t)(Jh,Jh,t),e.center=this.center,e.eye=(0,da.f)(Xh,this.center,Xh),e.up=Jh,e.fov=this._fov}_axisAngleVec3(e,t,r,i){const n=Math.cos(t),s=Math.sin(t);return(0,da.j)(qh,r,n),(0,da.b)(Wh,e,r),(0,da.j)(Wh,Wh,s),(0,da.j)(Yh,e,(1-n)*(0,da.m)(e,r)),(0,da.g)(i,(0,da.g)(i,qh,Wh),Yh)}_lookAtOrientation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,Zh.vt)();return this._upAtLookAt(e,Yh),(0,da.b)(qh,this.direction,Yh),(0,da.n)(qh,qh),0===qh[0]&&0===qh[1]&&0===qh[2]&&(0,da.c)(qh,td),(0,da.b)(Wh,Yh,qh),(0,da.n)(Wh,Wh),t[0]=qh[0],t[1]=Wh[0],t[2]=Yh[0],t[3]=qh[1],t[4]=Wh[1],t[5]=Yh[1],t[6]=qh[2],t[7]=Wh[2],t[8]=Yh[2],t}_upAtLookAt(e,t){return this.viewingMode===$s.RT.Local?(0,da.c)(t,Qh):(0,da.n)(t,e)}_eyeUpToPitch(e){return Math.PI-(0,vo.g7)(Qh,e)}}const qh=(0,nn.vt)(),Wh=(0,nn.vt)(),Yh=(0,nn.vt)(),Xh=(0,nn.vt)(),Jh=(0,nn.vt)(),Kh=(0,nn.vt)(),Qh=nn.Cb,ed=nn.JP,td=nn.Cw,rd=(0,Zh.vt)();var id=r(33062),nd=r(53494);class sd{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}}const od={desiredScreenFlow:2,minDuration:(0,ql.l5)(500),maxDuration:(0,ql.l5)(8e3)};(0,ql.l5)(4e3);class ad{constructor(e){this._createCamera=e,this.compared=new sd,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:od.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new ad(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,t,r){this.source!==e&&this.source.copyFrom(e),this.target!==t&&this.target.copyFrom(t),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=null!=r.desiredScreenFlow?r.desiredScreenFlow:od.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const t=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/t}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>(0,nd.FD)()}get hasFov(){return Math.abs(this.compared.fov)>(0,nd.FD)()}get hasRotate(){return this.compared.rotate>(0,nd.FD)()}}let ld=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce(((e,t)=>(0,ql.Kp)(e+t.time)),(0,ql.Kp)(0))}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,i=0;const n=this.definition,s=this.segments.reduce(((e,t)=>e||t.definition.hasZoom),!1);for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(this.segmentInterpolateComponentsAt(a,0===a.time?0:e/a.time,t),n.hasPan&&!isNaN(t.pan)&&isFinite(n.compared.pan)?t.pan=(r+l.compared.pan*t.pan)/n.compared.pan:t.pan=1,n.hasRotate&&!isNaN(t.rotate)&&isFinite(n.compared.rotate)?t.rotate=(i+l.compared.rotate*t.rotate)/n.compared.rotate:t.rotate=1,s&&!isNaN(t.zoom)&&isFinite(l.compared.targetZoom)){const{sourceZoom:e,targetZoom:r}=l.compared,i=t.zoom*(r-e)+e,n=this.segments[0].definition.compared.sourceZoom,s=this.segments[this.segments.length-1].definition.compared.targetZoom,o=Math.abs(r-n)>Math.abs(e-n)?r:e;t.zoomOffset=o-s,t.zoom=(i-n)/(o-n)}else t.zoom=1;return t}e-=a.time,r+=l.compared.pan,i+=l.compared.rotate}}segmentInterpolateComponentsAt(e,t,r){e.interpolateComponentsAt(t,r)}};class cd{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,t=e.compared,r=t.sourceZoom,i=t.targetZoom;this._zoomSign=r>i?1:-1,this._panPixelsAtSource=t.pan*e.source.pixelsPerPanAtZoom(r);const n=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(i))/2;this._rotatePixels=t.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,t=this.definition.compared.targetZoom,{hasZoom:r,hasPan:i,hasRotate:n}=this.definition;let s=0,o=0;r&&(i&&(s=(t/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(o=this._zoomSign*(Math.log(e/t)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const a=this.definition.desiredPixelFlow;if(r&&i&&n){const e=s+o+s*o;this._zoomPixelFlow=s*o/e*a,this._panPixelFlow=o/e*a,this._rotatePixelFlow=s/e*a}else if(r&&i){const e=1+s;this._zoomPixelFlow=s/e*a,this._panPixelFlow=1/e*a}else if(r&&n){const e=1+o;this._zoomPixelFlow=o/e*a,this._rotatePixelFlow=1/e*a}else if(i&&n){const e=this._panPixelsAtSource/this._rotatePixels,t=1+e;this._panPixelFlow=e/t*a,this._rotatePixelFlow=1/t*a}else i?this._panPixelFlow=a:r?this._zoomPixelFlow=a:n&&(this._rotatePixelFlow=a);this._time=this.rotateTime??this.zoomTime??this.panTime??this.fovTime??(0,ql.Kp)(0)}get rotateTime(){return this.definition.hasRotate?(0,ql.Kp)(this._rotatePixels/this._rotatePixelFlow):null}get zoomTime(){return this.definition.hasZoom?(0,ql.Kp)(this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow):null}get fovTime(){return this.definition.hasFov?(0,ql.Kp)(Math.abs(this.definition.compared.fov)/ud):null}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,t=e*this._panPixelsAtSource;return(0,ql.Kp)(Math.log(t*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow))}return(0,ql.Kp)(this._panPixelsAtSource/this._panPixelFlow)}}_interpolateComponentsZoom(e){if(0===e||1===e)return e;if(this.definition.hasZoom){const t=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(t*(t/r)**-e-t)/(r-t)}return e}_interpolateComponentsFov(e){if(0===e)return this.definition.segmentStart;if(1===e)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:t,segmentEnd:r}=this.definition;return t+e*(r-t)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(0===e||1===e)return e;if(this.definition.hasPan&&this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(t*e*this._time)-1))/(t*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),t.zoom=this._interpolateComponentsZoom(e),t.pan=this._interpolateComponentsPan(e),t.rotate=this._interpolateComponentsRotate(e),t.zoomOffset=0,t.fov=this._interpolateComponentsFov(e)}}const ud=(0,ws.kU)(90);function hd(e,t,r){const i=t-e.compared.sourceZoom,n=e.halfWindowPanAtZoom(i);return-e.halfWindowSize*(r.ascensionFactor*Math.LN2*e.compared.pan+n)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*n)}function dd(e,t,r){const i=1/t,n=Math.log(e.compared.sourceZoom*i),s=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*i*s*o*l*c-e.halfWindowSize*n*s*o*l+e.halfWindowSize*n*s*o*c/(a*a)}function pd(e,t,r){const i=t-e.compared.sourceZoom,n=1/i,s=1/t,o=Math.log(e.compared.sourceZoom*s),a=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(i))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*n*(-2*n*s*a+2*n*o+2*s-2*o*a/(i*i)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function fd(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function md(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function gd(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function yd(e,t,r){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function _d(e,t,r){const i=Math.log(t/e.compared.targetZoom),n=1/e.desiredPixelFlow,s=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*i*n*s*a+e.halfWindowSize*i*n*s*l/(o*o)+e.halfWindowSize*n*s*a*l/t}function vd(e,t,r){const i=t-e.compared.targetZoom,n=1/i,s=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+r.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*n*(-2*n*s*a-2*n*o+2*s+2*o*a/(i*i)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function bd(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function wd(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function xd(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function Sd(e,t){let r=function(e,t){const r=Math.max(e.compared.sourceZoom,e.compared.targetZoom),i=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return i<r?null!=t.maximumDistance?r+(t.maximumDistance-r)/2:1.5*r:t.maximumDistance?Math.min(t.maximumDistance,i):i}(e,t);const i={ascensionFactor:null!=t.ascensionFactor?t.ascensionFactor:.5,descensionFactor:null!=t.descensionFactor?t.descensionFactor:.5},n=0===i.ascensionFactor,s=0===i.descensionFactor,o=n?fd:hd,a=n?md:dd,l=n?gd:pd,c=s?bd:yd,u=s?wd:_d,h=s?xd:vd,d=t=>o(e,t,i)+function(e,t,r){return-e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}(e,t,i)+c(e,t,i),p=t=>a(e,t,i)+function(e,t,r){return e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}(e,t,i)+u(e,t,i),f=t=>l(e,t,i)+function(e,t,r){return-2*e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}(e,t,i)+h(e,t,i);let m=d(r);const g=function(e){const t=e.compared.sourceZoom-e.compared.targetZoom;if(0===t)return e.compared.pan*e.halfWindowSize/(e.desiredPixelFlow*e.halfWindowPanAtZoom(e.compared.sourceZoom));const r=Math.LN2*e.compared.pan,i=t,n=e.halfWindowPanAtZoom(i),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*n);return e.compared.sourceZoom<=e.compared.targetZoom?s*(r-n):s*(r+n)}(e);let y;const _=t.maximumIterations||20,v=null!=t.maximumDistance?t.maximumDistance:1/0;for(y=0;y<_;y++){const i=t.desiredSlope??1e-6;let n=p(r);Math.abs(n)>i&&(n+=i);const s=n/f(r);if(isNaN(s)||r>=v&&s<0){if(!isFinite(v))return null;r=v,m=d(r);break}if(r-=s,r<e.compared.sourceZoom||r<e.compared.targetZoom)return null;const o=d(r);if(Math.abs(o-m)/m<=.005)break;m=o}return m>.7*g||r<e.compared.sourceZoom||r<e.compared.targetZoom?null:r}class Td extends ld{constructor(e,t){super(),this._preallocSegments=[new cd,new cd,new cd],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,t)}update(e,t){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const r=t?.apex?Sd(e,t.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r?this._updateWithApex(r,t?.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,t,r){e.interpolateComponentsAt(t,r),e===this._ascensionSegment?r.zoom=hh(r.zoom):e===this._descensionSegment&&(r.zoom=uh(r.zoom))}_updateWithApex(e,t){const[r,i,n]=this._preallocSegments,s=t?.ascensionFactor??.5,o=Math.min(1-s,null!=t?.ascensionFactor&&null!=t.descensionFactor?t.descensionFactor:.5),a=1-s-o;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*s,r.definition.compared.rotate=this.definition.compared.rotate*s,r.definition.segmentEnd=s,r.update(),this._ascensionSegment=r,this.segments.push(r),a>0&&(i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.copyFrom(this.definition),i.definition.compared.sourceZoom=e,i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*a,i.definition.compared.rotate=this.definition.compared.rotate*a,i.definition.segmentStart=r.definition.segmentEnd,i.definition.segmentEnd=r.definition.segmentEnd+a,i.update(),this.segments.push(i)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*o,n.definition.compared.rotate=this.definition.compared.rotate*o,n.definition.segmentStart=s+a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}}const Md=new class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}};let Ad=class{get time(){return this._time}get isLinear(){return 1===this.path.segments.length}constructor(e){this._time=(0,ql.l5)(0),this._easing=Rh,this.definition=new ad(e),this.path=new Td}update(e,t,r){this.definition.update(e,t,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings((0,ql.gr)(isFinite(this.path.time)?this.path.time:(0,ql.Kp)(0)),r),this._easing=r.easing??(this._time>=1e3?Rh:xh)}cameraAt(e,t){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,Md);t.interpolate(this.definition.source,this.definition.target,r)}_normalizedEasing(e){const t=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(r-t)}_applyTimeSettings(e,t){const r=null!=t.speedFactor?t.speedFactor:1,i=t.minDuration??od.minDuration/r,n=t.maxDuration??od.maxDuration/r;return null!=t.duration?t.duration:(0,ql.l5)(Math.min(Math.max(e/r,i),n))}};class Cd{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=(0,ql.l5)(0),this._animation=new Ad((()=>new $h(e))),this._current=new $h(e)}update(e,t,r){const{source:i,target:n}=this._animation.definition,s=(0,da.f)(Ed,t.center,e.center),o=(0,da.l)(s);o>=1e-5?(s[0]/=o,s[1]/=o,s[2]/=o):(s[0]=0,s[1]=1,s[0]=0),(0,da.c)(i.direction,s),(0,da.c)(n.direction,s),i.copyFromRenderCamera(e),n.copyFromRenderCamera(t),this._current.copyFrom(i),this._animation.update(i,n,r),this.currentTime=(0,ql.l5)(0),e.almostEquals(t)&&(this.currentTime=this._animation.time)}cameraAt(e,t){return this._animation.cameraAt(e,this._current),t=t||new id.A,this._current.copyToRenderCamera(t),t}step(e,t){return this.finished||(this.currentTime=(0,ql.l5)(this.currentTime+(0,ql.gr)(e)),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,t)}}const Ed=(0,nn.vt)();var Rd;!function(e){e[e.Ready=0]="Ready",e[e.Rejected=1]="Rejected",e[e.Running=2]="Running",e[e.Stopped=3]="Stopped",e[e.Finished=4]="Finished"}(Rd||(Rd={}));let Pd=class extends ht.A{constructor(e){super(e),this.state=Rd.Ready}get active(){return this.state===Rd.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Rd.Stopped,!0)}finishController(){this.state=Rd.Finished}get steppingFinished(){return!1}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Pd.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Pd.prototype,"active",null),(0,ze._)([(0,Qe.MZ)()],Pd.prototype,"state",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Pd.prototype,"isInteractive",null),Pd=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.CameraController")],Pd);let Od=class extends Pd{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject((0,Ke.NK)()),this._asyncResult=null),this.state===Rd.Finished||this.state===Rd.Stopped?((0,Je.Lw)(e),this.state===Rd.Finished?e.resolve():e.reject((0,Ke.NK)())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Rd.Running,null!=this.viewAnimation&&this.viewAnimation.when((()=>this.updateStateFromViewAnimation()),(()=>this.updateStateFromViewAnimation()))}updateStateFromViewAnimation(){null==this.viewAnimation||this.state!==Rd.Ready&&this.state!==Rd.Running||(this.viewAnimation.state===so.State.FINISHED?this.finish():this.viewAnimation.state===so.State.STOPPED&&(this.state=Rd.Stopped))}onControllerEnd(){null==this.viewAnimation||this.viewAnimation.done||(this.state===Rd.Finished?this.viewAnimation.finish():this.state===Rd.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Rd.Finished?this._asyncResult.resolve():this._asyncResult.reject((0,Ke.NK)()))}finish(){this.finishController()}};Od=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.AnimationController")],Od);var Id=r(29808);let Ld=class extends Od{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new Cd(this.view.state.viewingMode),this.viewAnimation="interaction"===this.mode?null:new so}get isInteractive(){return"interaction"===this.mode}begin(e,t){this._hasTarget=!0;const r=this.animationSettings(t);Nd.copyFrom(this.view.state.camera);const i=(0,Id.hz)(this.view.state.viewingMode);this.intersectionHelper.intersectRay(Nd.ray,i,Dd)&&(Nd.center=Dd),this.animation.update(Nd,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,t){this._hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:"string"==typeof e.easing?Uh[e.easing]:e.easing}}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Ld.prototype,"mode",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Ld.prototype,"isInteractive",null),Ld=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.PointToPointAnimationController")],Ld);const Nd=new id.A,Dd=(0,nn.vt)();var Fd=r(73582),kd=r(60008),zd=r(4336),Ud=r(96190),Vd=r(75762);function Bd(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Zd;return[e[0],e[1],e[2],e[3]]}function jd(e,t){return Hd(e[0],e[1],e[2],t,Vd.Km.get())}function Hd(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Bd();return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function Gd(e,t,r){return(0,da.b)(r,e,t),(0,da.n)(r,r),r[3]=(0,Ud.g7)(e,t),r}const Zd=[0,0,1,0];(0,zd.vt)(),(0,zd.vt)();var $d=r(13927),qd=r(37431);function Wd(e,t,r,i){const n=(0,qd.vr)(t,r,Yd);return(0,Su.i)(e,n,i)}const Yd=(0,Tu.vt)();var Xd,Jd=r(97974);!function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"}(Xd||(Xd={}));const Kd=[1,3e8],Qd=1508e5,ep={exclude:new Set([Jd.fo])};function tp(e,t,r){return r[0]=t[0]/(e.fullWidth/e.pixelRatio),r[1]=t[1]/(e.fullHeight/e.pixelRatio),r}function rp(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function ip(e,t,r){const i=(0,$a.$0)(Vd.Rc.get(),r[3],r);null==i||(0,$a.t2)(i,qa.zK)||((0,da.f)(qp,e.eye,t),(0,da.h)(qp,qp,i),e.eye=(0,da.g)(qp,qp,t),(0,da.f)(qp,e.center,t),(0,da.h)(qp,qp,i),e.center=(0,da.g)(qp,qp,t),e.up=(0,da.h)(qp,e.up,i))}function np(e,t,r,i){return(0,$d.Ui)(e,(0,qd.vr)(t,r,Kp),i)}function sp(e,t,r,i){const n=Vd.rq.get();let s=1-r;(0,da.f)(n,t,e.eye);const o=(0,da.l)(n);let a=o*(1-s);s>=0&&a<i&&(a=i,s=-(a-o)/o),Math.abs(o-a)<1e-6||((0,da.j)(n,n,s),e.eye=(0,da.g)(qp,e.eye,n),e.center=(0,da.o)(qp,e.center,t,s))}function op(e,t,r){t.getScreenCenter(ap),Wd(e,t,ap,qp)&&(t.center=qp);const i=t.distance,n=i*r;if(Math.abs(i-n)<1e-6)return;const s=(0,da.j)(Vd.rq.get(),t.viewForward,n);t.eye=(0,da.f)(qp,t.center,s)}const ap=(0,Ki.gs)();function lp(e,t){(0,da.s)(t,0,0,0);for(const r of e)(0,da.g)(t,t,r);(0,da.j)(t,t,1/e.length)}function cp(e,t,r,i){return Math.sin(e/(0,da.l)(t))*(r+i.radius)}function up(e,t,r,i){return cp(Math.PI/2,t,r,i)+(e-Math.PI/2)}var hp;!function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"}(hp||(hp={}));const dp={Elevation:3e4,Angle:(0,ws.kU)(16)},pp={Pole:.95,Angle:(0,ws.kU)(18),Tilt:45},fp=(0,ws.kU)(80);function mp(e,t,r,i,n,s){const o=(0,nn.vt)(),a=(0,Su.c)();let l=!0,c=!0;return e.intersectScreen(r,o,s)?a[3]=(0,da.l)(o):(c=!1,t.aboveGround&&n!==Xd.Ellipsoid?a[3]=Math.max((0,da.l)(t.center),.9*i.radius):a[3]=(0,da.l)(t.eye)-t.relativeElevation,n===Xd.Silhouette?vp(a,t,r,o):l=Wd(a,t,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function gp(e,t,r,i){const n=e.relativeElevation;if(n>dp.Elevation&&"global"===i)return hp.Horizontal;(0,qd.vr)(e,t,Qp);const s=Math.sign(n),o=r.worldUpAtPosition(e.eye,qp);return-s*(0,da.m)(o,Qp.direction)<Math.sin(dp.Angle)*(0,da.l)(Qp.direction)?hp.Vertical:hp.Horizontal}function yp(e,t,r){(0,da.f)(_p,r,t),e.eye=(0,da.f)(qp,e.eye,_p),e.center=(0,da.f)(qp,e.center,_p)}const _p=(0,nn.vt)();function vp(e,t,r,i){const n=(0,qd.vr)(t,r,Kp);return null!=n&&((0,Su.e)(e,n,bp),(0,Su.i)(e,n,i)?!((0,da.a)(bp,n.origin)<(0,da.a)(i,n.origin))||((0,da.c)(i,bp),!1):((0,da.f)(wp,t.eye,t.center),(0,da.n)(wp,wp),(0,$d.UB)(wp,-(0,da.m)((0,da.n)(wp,wp),bp),xp),(0,$d.Ui)(xp,n,i),!1))}const bp=(0,nn.vt)(),wp=(0,nn.vt)(),xp=(0,$d.vt)();function Sp(e,t,r,i,n,s){let o=0;if((0,da.b)(Xp,e,t),(0,da.f)(Wp,e,t),(0,da.l)(e)<=n||!i.aboveGround){(0,da.b)(r,Wp,i.eye);const a=(0,da.m)(e,t)/((0,da.l)(e)*(0,da.l)(t));if(a<.9999)o=(0,ws.XM)(a);else{const r=(0,da.l)((0,da.b)((0,nn.vt)(),e,t))/((0,da.l)(e)*(0,da.l)(t));o=(0,ws.YN)(r)}const l=Math.cos((0,ws.qE)(Fd.wf.normalize((0,ws.kU)(s)),0,fp));o=-o-Math.max(0,(0,da.l)(t)-n)/(l*n)}else(0,da.f)(Tp,i.eye,i.center),(0,da.b)(r,Wp,Tp),o=-(0,da.l)(Wp)/n;return(0,da.n)(r,r),(0,da.j)(r,r,(0,da.l)(Xp)),o}const Tp=(0,nn.vt)();function Mp(e,t,r,i){let n,s;const o=Math.cos((0,ws.qE)(Fd.wf.normalize((0,ws.kU)(i)),0,fp));return n=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):(0,ws.XM)(t/r),s=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):(0,ws.XM)(e/r),(s-n)*r}function Ap(e,t,r,i,n,s,o,a,l,c){(0,da.b)(Xp,e,t),(0,dn.U9)(s.up,s.eye,Fp,kp,zp),(0,dn.U9)([0,0,1],s.eye,Lp,Np,Dp),(0,da.c)(r,Np),(0,da.c)(i,Lp),(0,da.n)(r,r),(0,da.j)(r,r,(0,da.l)(Xp)),(0,dn.PX)(e,(0,da.n)(kp,kp),(0,da.n)(zp,zp),(0,da.n)(Fp,Fp),Up),(0,dn.PX)(t,kp,zp,Fp,Vp),function(e,t,r,i,n,s,o,a,l,c){const u=Mp(e[2],t[2],s[3],a),h=l?Mp(e[0],t[0],s[3],180):t[0]-e[0],d=Math.sin(o)*h-Math.cos(o)*u,p=Math.cos(o)*h+Math.sin(o)*u;(0,da.n)(qp,n);const f=l?d/Math.sqrt(Math.abs(s[3]**2-(0,da.m)(r,qp)**2)):d/s[3],m=p/Math.sqrt(Math.abs(s[3]**2-(0,da.m)(r,i)**2));(0,ma.hZ)(c,f,m)}(Up,Vp,e,Lp,Np,o,a,l,c,n)}function Cp(e,t,r,i,n,s,o){(0,$a.$0)(Hp,n,i),(0,$a.$0)(Gp,o,s),(0,$a.lw)(Zp,Hp,Gp),(0,da.f)(t,e,r),(0,da.h)(t,t,Zp),(0,da.g)(t,t,r)}function Ep(e,t,r,i,n,s){(0,$a.$0)(Hp,i,r),(0,$a.$0)(Gp,s,n),(0,$a.lw)(Zp,Hp,Gp),(0,da.f)(qp,e.eye,t),(0,da.h)(qp,qp,Zp),e.eye=(0,da.g)(qp,qp,t),(0,da.f)(qp,e.center,t),(0,da.h)(qp,qp,Zp),e.center=(0,da.g)(qp,qp,t),(0,da.f)(qp,e.up,t),(0,da.h)(qp,qp,Zp),e.up=(0,da.g)(qp,qp,t)}function Rp(e,t,r,i,n,s){return(Math.abs(i)>Math.PI-pp.Angle||Math.abs(i)<pp.Angle)&&(Math.abs(e[2])<r*pp.Pole||Math.abs(t)>r)&&s.aboveGround&&n<pp.Tilt}function Pp(e,t,r,i,n,s){if(s)Gd(r,i,jp),ip(t,(0,Su.g)(e),jp);else{const s=Sp(r,i,Jp,t,e[3],n);ip(t,(0,Su.g)(e),jd(Jp,s))}}function Op(e,t,r,i,n,s,o){const a=o?20:1;let l,c;(0,da.c)($p,i),Yp.copyFrom(t);for(let u=0;u<a&&(0,da.a)(r,$p)>1e-12&&(l=(0,da.a)(r,$p),Ap(r,$p,Np,Lp,Bp,Yp,e,n,s,o),Ep(Yp,(0,Su.g)(e),Lp,Bp[1],Np,Bp[0]),Cp($p,$p,(0,Su.g)(e),Lp,Bp[1],Np,Bp[0]),c=(0,da.a)(r,$p),c<l||0===u);u++)t.copyFrom(Yp)}function Ip(e,t,r,i,n,s,o,a,l){Rp(e.center,(0,da.m)(e.up,e.center),(0,da.l)(e.center),-Fd.wf.normalize((0,ws.kU)(s)),o,t)?function(e,t,r,i,n,s){const{eye:o}=e;(0,dn.U9)([0,0,1],o,Lp,Np,Dp);const a=t.translation[0]*r.pan,l="zoom"===n.mode?0:t.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-(0,da.m)(e.center,Lp)**2/(0,da.l)(e.center)**2)),.5),u=(Math.sin(s)*l+Math.cos(s)*a)/c,h=-Math.cos(s)*l+Math.sin(s)*a;switch((0,$a.e$)(i.pan.matrix,i.pan.matrix,u,Lp),i.pan.enabled=!0,n.mode){case"pan":(0,$a.e$)(i.pan.matrix,i.pan.matrix,h,Np),i.pan.enabled=!0;break;case"zoom":i.zoom=-t.translation[1]*r.zoom}}(t,r,i,a,l,-Fd.wf.normalize((0,ws.kU)(n))):function(e,t,r,i,n){const{eye:s,viewRight:o}=e,a=(0,da.b)(Vd.rq.get(),o,s),l=t.translation[0]*r.pan;switch(0!==l&&((0,$a.e$)(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),n.mode){case"pan":{const e=t.translation[1]*r.pan;0!==e&&((0,$a.e$)(i.pan.matrix,i.pan.matrix,e,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-t.translation[1]*r.zoom}}(t,r,i,a,l)}const Lp=(0,nn.vt)(),Np=(0,nn.vt)(),Dp=(0,nn.vt)(),Fp=(0,nn.vt)(),kp=(0,nn.vt)(),zp=(0,nn.vt)(),Up=(0,nn.vt)(),Vp=(0,nn.vt)(),Bp=(0,va.vt)(),jp=Bd(),Hp=(0,qa.vt)(),Gp=(0,qa.vt)(),Zp=(0,qa.vt)(),$p=(0,nn.vt)(),qp=(0,nn.vt)(),Wp=(0,nn.vt)(),Yp=new id.A,Xp=(0,nn.vt)(),Jp=(0,nn.vt)(),Kp={origin:(0,nn.vt)(),direction:(0,nn.vt)()},Qp={origin:(0,nn.vt)(),direction:(0,nn.vt)()};let ef=class extends Ld{constructor(){super(...arguments),this._zoomLocation=(0,nn.vt)(),this._tmpCamera=new id.A,this._tmpViewDir=(0,nn.vt)(),this._tmpRayDir={origin:(0,nn.vt)(),direction:(0,nn.vt)()},this._targetOnSphere=(0,nn.vt)(),this._tmpCenter=(0,nn.vt)(),this._beginCamera=new id.A,this._constraintOptions=new Mu(bu.ALL_EXCEPT_COLLISION,wu.ZOOM,null,this._beginCamera),this._sphere=(0,Su.c)()}initialize(){this._intersector=(0,Id.hz)(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera);let i=!1,n=!1;this.intersectionHelper.intersectScreen(t,this._zoomLocation,0===this.view.map.ground.opacity?ep:{})&&(i=e>0,n=!0),this._tmpCamera.copyFrom(r.camera),i?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:(0,da.c)(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,t,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:(0,ql.l5)(600),easing:xh}}_updateCamera(e,t,r,i,n){const s=gp(e,i,this.view.renderCoordsHelper,this.view.viewingMode),o=Math.abs(this.view.camera.position.z);(0,da.n)(rf,e.eye),(0,da.j)(rf,rf,-1),(0,qd.vr)(e,i,this._tmpRayDir),(0,da.n)(this._tmpRayDir.direction,this._tmpRayDir.direction);const a=(0,ws.qE)(Math.min(8,1/Math.abs((0,da.m)(rf,this._tmpRayDir.direction)))*o,200,Qd);if(s===hp.Horizontal){let n=.6**t;this._sphere[3]=(0,da.l)(r),(0,da.f)(this._tmpViewDir,e.center,e.eye);const s=Math.min((0,da.l)(this._tmpViewDir),a);let o=s*n;if(n<=1&&o<4&&(o=4,n=o/s),Math.abs(s-o)<1e-6)return;const l=(0,da.l)(e.center);if(this._sphere[3]!==l){const t=this._sphere[3]+n*(l-this._sphere[3]);e.center=(0,da.j)(tf,e.center,t/l)}(0,da.j)(this._tmpViewDir,this._tmpViewDir,-n),e.eye=(0,da.g)(tf,e.center,this._tmpViewDir),Vh(this.view,e,this._constraintOptions),(0,da.a)(r,e.center)>1e-12&&Wd(this._sphere,e,i,this._targetOnSphere)&&function(e,t,r,i,n,s,o){Rp(r,(0,da.m)(t.up,r),e[3],-Fd.wf.normalize((0,ws.kU)(n)),s,t)?Op(e,t,r,i,-Fd.wf.normalize((0,ws.kU)(n)),s,o):Pp(e,t,r,i,s,o)}(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let s=.6**Math.abs(t);const o=t>0?1:-1;(0,da.f)(this._tmpViewDir,r,e.eye);const l=(0,da.l)(this._tmpViewDir),c=this.view._stage.renderView.getMinimalDepthForArea(null,i[0],i[1],this.view.state.camera,60);let u=null!=c?c:a;u=n&&t>0?Math.min(u,l):u,(0,da.j)(this._tmpRayDir.direction,this._tmpRayDir.direction,u),(0,da.g)(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let h=u*s;const d=Math.max(4,1.01*e.nearFar[0]);if(t>0&&h<d&&(h=d,s=h/u),Math.abs(u-h)<1e-6)return;(0,da.j)(this._tmpRayDir.direction,this._tmpRayDir.direction,o*(1-s)),e.eye=(0,da.g)(tf,e.eye,this._tmpRayDir.direction),e.center=(0,da.g)(tf,e.center,this._tmpRayDir.direction)}qu(this.view,e)}};ef=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],ef);const tf=(0,nn.vt)(),rf=(0,nn.vt)();var nf=r(60704);let sf=class extends Ld{constructor(){super(...arguments),this._zoomLocation=(0,nn.vt)(),this._tmpCamera=new id.A,this._tmpRayDir=(0,nn.vt)(),this._tmpCenter=(0,nn.vt)(),this._beginCamera=new id.A,this._constraintOptions=new Mu(bu.ALL,wu.ZOOM,null,this._beginCamera)}zoomStep(e,t){if(!this.active)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(r.camera);const i=(0,Id.hz)(this.view.state.viewingMode);let n=!1;e>0?(n=this.intersectionHelper.intersectScreenFreePointFallback(t,this._zoomLocation,0===this.view.map.ground.opacity?ep:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,i,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,i,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:(0,da.c)(this._zoomLocation,this._tmpCamera.center);const s=.6**e;let o=this.view._stage.renderView.getMinimalDepthForArea((0,nf.ds)(this.view),t[0],t[1],this.view.state.camera,60);(0,da.f)(lf,this._tmpCamera.eye,this._zoomLocation),(0,da.n)(lf,lf);const a=(0,ws.qE)(Math.min(8,1/Math.abs((0,da.m)(af,lf)))*Math.abs(this.view.camera.position.z),200,Qd);if(o=null!=o?o:a,o){const e=(0,nn.vt)();(0,da.f)(e,this._zoomLocation,this._tmpCamera.eye),(o<(0,da.l)(e)||!n)&&((0,da.n)(e,e),(0,da.g)(this._zoomLocation,this._tmpCamera.eye,(0,da.j)(e,e,o)))}this._updateCamera(this._tmpCamera,s,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:(0,ql.l5)(600),easing:xh}}_updateCamera(e,t,r){(0,da.f)(this._tmpRayDir,r,e.eye);const i=(0,da.l)(this._tmpRayDir);let n=i*t;const s=t<=1,o=Math.max(4,1.01*e.nearFar[0]);0!==n&&(s&&n<o&&(n=o,t=n/i),Math.abs(i-n)<1e-6||((0,da.j)(this._tmpRayDir,this._tmpRayDir,t),e.eye=(0,da.f)(of,r,this._tmpRayDir),e.center=(0,da.o)(of,e.center,r,1-t),Vh(this.view,e,this._constraintOptions)))}};sf=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.ZoomStepControllerLocal")],sf);const of=(0,nn.vt)(),af=(0,nn.fA)(0,0,1),lf=(0,nn.vt)();var cf=r(89196);function uf(e,t){if("touch"===e.pointerType)return!1;switch(t){case"primary":return 0===e.button;case"secondary":return 2===e.button;case"tertiary":return 1===e.button}}class hf extends cf.l{constructor(e,t){super(!0),this._view=e,this.registerIncoming("double-click",t,(e=>this._handleDoubleClick(e)))}_handleDoubleClick(e){const t=e.data;if(function(e,t){switch(t){case"primary":return"touch"===e.pointerType||0===e.button;case"secondary":return"touch"!==e.pointerType&&2===e.button;case"tertiary":return"touch"!==e.pointerType&&1===e.button}}(t,"primary")){const r=this._view.state.isGlobal?new ef({view:this._view,mode:"animation"}):new sf({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),(0,Ki.gs)(t.x,t.y)),e.stopPropagation()}}}var df=r(19247),pf=r(31633);class ff{constructor(e,t){this._elevationProvider=e,this._referenceEllipsoid=(0,pa.tO)(t),this._unitInMeters=(0,pf.GA)(t,this._referenceEllipsoid.metersPerDegree)}compute(e,t,r,i,n){n||(n={near:0,far:0});let s=e[2]*this._unitInMeters;const o=s,a=s-i,l=this._elevationProvider?.visibleElevationBounds;l&&(s=a>=0?o-this._unitInMeters*l.min:this._unitInMeters*l.max-o);const c={x:(r=null!=r?r:new Zn.A({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},u=Math.max(c.x,c.y,c.z);(0,da.f)(xf,t,e),wf[0]=xf[0]>0?r.xmax:r.xmin,wf[1]=xf[1]>0?r.ymax:r.ymin,wf[2]=xf[2]>0?u/2:-u/2,(0,da.f)(wf,wf,e),(0,da.n)(xf,xf);const h=1.1*(0,da.m)(wf,xf)*this._unitInMeters,d=Math.sqrt(s*(s+2*this._referenceEllipsoid.radius)),p=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),f=p*vf*this._unitInMeters,m=p*bf*this._unitInMeters,g=(0,ws.qE)((s-m)/(f-m),0,1)**3,y=Math.min((0,ws.Cc)(d,h,g),d)*Math.max(Math.log(Math.abs(a)),1);return gf(Math.min(y,Math.max(34064e4,u))/this._unitInMeters,yf,this._unitInMeters,n)}}class mf{constructor(e){this._referenceEllipsoid=(0,pa.tO)(e)}compute(e,t,r,i,n){n||(n={near:0,far:0});const s=(0,da.l)(e),o=s-this._referenceEllipsoid.radius,a=this._referenceEllipsoid.radius+Math.min(0,i),l=Math.abs(o-i),c=Math.max(l,Math.abs(o)),u=Math.sqrt(c*(c+2*a)),h=s+this._referenceEllipsoid.radius;return gf(1.2*(0,ws.Cc)(u,h,(0,_a.GF)(c)),(0,ws.qE)(2e4-(Math.log(c)-7.983)/9.011*19900,100,2e4),1,n)}}function gf(e,t,r,i){const n=_f/r;return e/t>n?(i.far=e,i.near=i.far/t):(i.near=n,i.far=i.near*t),i}const yf=2e4,_f=2,vf=.001,bf=1e-4,wf=(0,nn.vt)(),xf=(0,nn.vt)();let Sf=class extends ht.A{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",(e=>this._handleElevationChangeEvent(e))))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;null!=e.spatialReference&&(0,$u.HD)(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera((e=>qu(this.view,e,Zu.EYE_AND_CENTER)))}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Sf.prototype,"view",void 0),Sf=(0,ze._)([(0,tt.$)("esri.views.3d.state.SurfaceCollisionConstraint")],Sf);let Tf=class extends ht.A{constructor(e){super(e),this.nearFarHeuristic=function(e,t,r){return e===$s.RT.Global?new mf(r):new ff(t,r)}(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([(0,gt.wB)((()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far]),(()=>this._clipDistanceNearFarChanged())),(0,gt.wB)((()=>this.view.constraints?.clipDistance?.mode),(()=>this._updateNearFar())),this.view.state.events.on("before-camera-change",(e=>this._updateCameraNearFar(e))),(0,gt.wB)((()=>this.view.renderDataExtent),(()=>this._updateNearFar()),gt.OH),(0,gt.wB)((()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max]),(()=>this._updateAltitude()),gt.OH),(0,gt.wB)((()=>this.view.constraints?.tilt?.max),(()=>this._updateTiltMax()),gt.OH),(0,gt.wB)((()=>this.view.constraints?.tilt?.mode),(()=>this._updateTilt()),gt.OH),(0,gt.wB)((()=>this.view.state?.camera),(()=>this._updateTiltAutoMax()),gt.OH),(0,gt.wB)((()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled]),(()=>this._updateCollision()),gt.OH)]),this.view.state.isLocal&&this.addHandles((0,gt.wB)((()=>this.view.renderDataExtent),(e=>this._updateLocalSurfaceDistance(e)),gt.Vh)),this._updateNearFar(),this.view.state.viewingMode!==$s.RT.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new Sf({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints?.clipDistance;e&&"auto"!==e.mode&&this.view.state.updateCamera((t=>Mf(t,e)))}_updateNearFar(){this.view.state.updateCamera((e=>this._updateCameraNearFar(e)))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(t?t.mode:"auto")?Mf(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,(0,$u.Rt)(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCollision(){const e=this.view.map?.ground?.navigationConstraint?.type,t=!e||"stay-above"===e,r=this.view.state.constraints.collision;if(t!==r.enabled){r.enabled=t,t&&this._reapplyConstraints(bu.COLLISION);const e=this.view.constraints&&this.view.constraints.tilt;e&&"auto"!==e.mode||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==$s.RT.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&"auto"!==e.mode&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;"manual"===(e?e.mode:"auto")?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt((0,ws.kU)(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||"auto"!==e.mode)return;const t=this.view.state.constraints;if(t.tilt){const r=t.tilt(this.view.state.camera.distance).max;e.autoUpdate((0,ws.KJ)(r))}}_updateLocalSurfaceDistance(e){if(null==e)return;let t=Math.max(e.width,e.height);if(t<=0)return;null!=e.zmax&&null!=e.zmin&&(t=Math.max(t,e.zmax-e.zmin));const r=this.view.state,i=3*t/Math.atan(r.camera.fov/2);i!==r.constraints.distance&&(r.constraints.distance=i)}_reapplyConstraints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bu.ALL;this.view.state.updateCamera((t=>Vh(this.view,t,new Mu(e,wu.NONE,null))))}};function Mf(e,t){t&&(e.near=t.near,e.far=t.far)}(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Tf.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Tf.prototype,"surfaceCollisionConstraint",void 0),Tf=(0,ze._)([(0,tt.$)("esri.views.3d.state.ConstraintsManager")],Tf);var Af=r(61985);let Cf=class extends Pd{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Rd.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",(e=>this._handleElevationChangeEvent(e)))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(null==e.spatialReference||(0,$u.HD)(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera((e=>{e.copyViewFrom(this.desiredCamera),qu(this.view,e,Zu.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Rd.Stopped)}))}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Cf.prototype,"desiredCamera",null),Cf=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],Cf);var Ef=r(39356),Rf=r(5809),Pf=r(60216),Of=r(14487),If=r(42294),Lf=r(4763),Nf=r(80935),Df=r(89189),Ff=r(66388);const kf=.66;function zf(e){return 360-Fd.ie.normalize(e)}function Uf(e){return Fd.ie.normalize(360-e)}function Vf(e,t,r){const i=t.camera;if(null!=i)return function(e,t){const r=e.position;let i;try{i=(0,an.tryProjectWithZConversion)(r,t)}catch(s){return null}if(!i)return null;const n=e.clone();return n.position=i.clone(),n}(i,(0,En.v2)(e));const{targetGeometry:n}=t;if(null==n)return null;const{camera:s,mode:o}=jf(e,t.rotation,r);if("point"===n.type)return function(e,t,r,i,n){const s=e.spatialReference;let o;try{o=(0,an.tryProjectWithZConversion)(r.clone(),s)}catch(l){return null}if(!o)return null;const a=null!=t.scale?(0,En.tv)(e,t.scale,o.latitude):e.state.camera.distance;return(0,En.CA)(e,o,a,i,n)}(e,t,n,s,o);const a=n.extent;return null==a?null:(0,En.wI)(e,a,s.heading,s.tilt,o)}async function Bf(e,t,r,i){const n=t.camera;if(null!=n)return async function(e,t,r){const i=e.position,n=await(0,an.projectWithZConversion)(i,t,{signal:r});(0,Ke.Te)(r);const s=e.clone();return s.position=n.clone(),s}(n,(0,En.v2)(e),i);const{targetGeometry:s}=t;if(null==s)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=jf(e,t.rotation,r);if("point"===s.type)return async function(e,t,r,i,n,s){const o=e.spatialReference,a=await(0,an.projectWithZConversion)(r.clone(),o,{signal:s});(0,Ke.Te)(s);const l=null!=t.scale?(0,En.tv)(e,t.scale,a.latitude):e.state.camera.distance;return(0,En.V2)(e,a,l,i,n,s)}(e,t,s,o,a,i);const l=s.extent;if(null==l)throw new Error("Target geometry has no extent!");return(0,En.F3)(e,l,o.heading,o.tilt,a,i)}function jf(e,t,r){const i=(0,En.dl)(e,e.state.camera);let n=En.AO.ADJUST;return null!=t&&(i.heading=zf(t),n=En.AO.LOCKED),null!=r&&(i.tilt=r),{camera:i,mode:n}}async function Hf(e,t,r){const i=function(e,t){if(!t||!e.spatialReference)return null;const r={target:void 0};return"declaredClass"in t||Array.isArray(t)?r.target=t:(Object.assign(r,t),!r.target&&"center"in t&&t.center&&(r.target=t.center)),r}(e,t);if(!i)throw new Ze.A("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new Rt.A({fov:e.camera.fov}),s=new Lt({camera:n});if(i.target instanceof Lt)return Jf(await async function(e,t,r,i,n){if(t.camera)return Yf(e,t.camera,i,n);n.scale=t.scale,n.rotation=t.rotation,n.targetGeometry=null!=t.targetGeometry?t.targetGeometry.clone():null,n.camera=null,null!=r.heading?n.rotation=Uf(r.heading):null!=r.rotation&&(n.rotation=r.rotation);const s=Gf(e,r);return null!=s&&(n.scale=s),n.camera=await Bf(e,n,r.tilt,i),n}(e,i.target,i,r,s));if(i.target instanceof Rt.A)return Jf(await Yf(e,i.target,r,s));const o=null!=i.scale||null!=i.zoom;if(i.target instanceof Zn.A){const t=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return Jf(o||t?await Xf(e,i,i.target.center,n,r,s):await async function(e,t,r,i,n,s){s.targetGeometry=r.clone();const o=(0,$u.bZ)(e);(0,En.dl)(e,o,i);const a=Zf(i,t)?En.AO.LOCKED:En.AO.ADJUST;return s.camera=await(0,En.F3)(e,r,i.heading,i.tilt,a,n),s}(e,i,i.target,n,r,s))}const a=new Kf,l=o?function(e,t){const r=Gf(e,t);return r?(0,pn.j8)(r):void 0}(e,i):void 0;if(await Wf(e,i.target,l,a,r),isFinite(a.boundingBox[0])){let t;if((0,If.gX)(a.boundingBox,Qf),lm.x=Qf[0],lm.y=Qf[1],lm.z=Qf[2],lm.spatialReference=e.spatialReference,isFinite(lm.z)&&a.hasZ?t=(0,If.fT)(a.boundingBox):(lm.z=void 0,t=(0,un.ye)((0,If.ES)(a.boundingBox,im))),o||t)return Jf(await Xf(e,i,lm,n,r,s));const l=function(e,t){const r=kf;if(!t.length)return r;let i=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const e=t[n].screenSpaceBoundingRect;i=Math.max(i,Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2]),Math.abs(e[3]))}return r-i/Math.min(e.width,e.height)*2}(e,a.screenSpaceObjects);return Jf(await async function(e,t,r,i,n,s,o,a){a.targetGeometry=r.clone();const l=(0,$u.bZ)(e),c=function(e,t,r,i,n){let s=0;null!=r.z?s=r.z:e.basemapTerrain&&e.elevationProvider&&(s=(0,Nf.R1)(e.elevationProvider,r)),(0,da.s)(Qf,r.x,r.y,s),(0,Rf.l)(e.spatialReference,Qf,em,e.renderSpatialReference),(0,Za.z0)(tm,em),(0,Za.mg)(tm,tm),(0,If.Ie)(rm);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let f=0;f<o.length;f++){const t=o[f];let r=i[t[2]];isFinite(r)||(r=s),(0,da.s)(Qf,i[t[0]],i[t[1]],r),(0,Of.F)(Qf,e.spatialReference,Qf,e.renderSpatialReference),(0,If.iT)(rm,(0,da.t)(Qf,Qf,tm))}const a=(0,If.VL)(rm),l=(0,If.uJ)(rm),c=(0,If.yr)(rm),u=1/Math.tan(t.fovX/2),h=1/Math.tan(t.fovY/2),d=.5*Math.sqrt(a*a+c*c)*Math.max(h,u)+.5*l,p=.5*l*h+.5*Math.max(a,c);return Math.max(d,p)/n}(e,l,r,i,n);(0,En.dl)(e,l,s);const u=Zf(s,t)?En.AO.LOCKED:En.AO.ADJUST;return a.scale=(0,En.Fj)(e,c,a.targetGeometry.latitude),a.camera=await(0,En.gU)(e,a.targetGeometry,a.scale,s,u,o),a}(e,i,lm,a.boundingBox,l,n,r,s))}return i.position?Jf(await async function(e,t,r,i,n){const s=(0,$u.bZ)(e);(0,da.c)(nm,s.viewForward),(0,En.gn)(e,s.eye,nm,s.up,am);const o=e.spatialReference,{position:a}=t;if(a){const e=await(0,an.projectWithZConversion)(a,o,{signal:n});r.position=e}else r.position=new df.A;return r.heading=null!=t.heading?t.heading:am.heading,r.tilt=null!=t.tilt?t.tilt:am.tilt,$f(e,null,r,i)}(e,i,n,s,r)):Jf(await async function(e,t,r,i,n){if(null!=t.heading||null!=t.rotation||null!=t.scale||null!=t.tilt||null!=t.zoom||null!=t.zoomFactor){const s=(0,$u.bZ)(e),{spatialReference:o,renderSpatialReference:a}=e,l=new df.A({spatialReference:o});return(0,Pf.E)(s.center,a,l)?Xf(e,t,l,r,i,n):n}return n.scale=e.scale,n.camera=e.camera.clone(),Zf(n.camera,t),n}(e,i,n,r,s))}function Gf(e,t){return null==t.scale&&null!=t.zoom?(0,En.XM)(e,t.zoom):t.scale}function Zf(e,t){let r=!1;return null!=t.heading?(e.heading=t.heading,r=!0):null!=t.rotation&&(e.heading=zf(t.rotation),r=!0),null!=t.tilt&&(e.tilt=t.tilt,r=!0),null!=t.fov&&(e.fov=t.fov),r}function $f(e,t,r,i){const n=e.spatialReference||Bt.A.WGS84;if(t??=(0,En.Cz)(e,r),null==t)return i;const s=new df.A({spatialReference:n});if(!(0,Pf.E)(t.center,e.renderSpatialReference,s))return i;i.targetGeometry=s;const{latitude:o}=s;return i.scale=null!=o?(0,En.Fj)(e,t.distance,o):(0,En.gx)(e,t),i.rotation=Uf(r.heading),i.camera=r,i}async function qf(e,t,r,i){const n=()=>new Ze.A("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!t)throw n();"mesh"===t.type&&(t=t.extent);const s=e.basemapTerrain.spatialReference;if(!t.hasZ&&e.basemapTerrain){let r;switch(t.type){case"point":r=t;break;case"multipoint":case"polyline":r=t.extent?.center;break;case"extent":r=t.center;break;case"polygon":r=t.centroid}null!=r&&s&&e.elevationProvider?(r=await(0,an.projectWithZConversion)(r,s,{signal:i}),Qf[2]=(0,Nf.R1)(e.elevationProvider,r)??0):Qf[2]=0}const o=cm[t.type],a=new Array;if(o(t,t.hasZ?e=>{a.push([e[0],e[1],e[2]])}:e=>{a.push([e[0],e[1]])},Qf),0===a.length)throw n();const l=t.spatialReference,c=e.spatialReference,u=await(0,an.projectWithZConversion)(new Ff.A({spatialReference:l,hasZ:t.hasZ,hasM:!1,points:a}),c,{signal:i});if(t.hasZ&&(r.hasZ=!0),t.hasZ)for(const[h,d,p]of u.points)Qf[0]=h,Qf[1]=d,Qf[2]=p,(0,If.iT)(r.boundingBox,Qf);else for(const[h,d]of u.points)Qf[0]=h,Qf[1]=d,(0,If.iT)(r.boundingBox,Qf)}async function Wf(e,t,r,i,n){if(Array.isArray(t)&&2===t.length){const r=t[0],s=t[1];if("number"==typeof r&&"number"==typeof s)return lm.x=r,lm.y=s,lm.z=void 0,lm.spatialReference=e.spatialReference?.isGeographic?e.spatialReference:Bt.A.WGS84,void await qf(e,lm,i,n)}t&&"map"in t&&"function"==typeof t.map?await Promise.allSettled(t.map((t=>Wf(e,t,r,i,n)))):t instanceof Df.A?await qf(e,t,i,n):t instanceof Ef.A&&await async function(e,t,r,i,n){const s=await(0,Fn.Ke)(e.whenViewForGraphic(t));if(!1===s.ok||null==s.value||!("whenGraphicBounds"in s.value))return void await qf(e,t.geometry,i,n);const o=s.value,a=await(0,Fn.Ke)(o.whenGraphicBounds(t,{minDemResolution:r}));if(!1===a.ok||!a.value)return void await qf(e,t.geometry,i,n);const{screenSpaceObjects:l,boundingBox:c}=a.value;(0,If.RF)(i.boundingBox,c),l&&l.forEach((e=>{i.screenSpaceObjects.push(e)})),isFinite(c[2])&&(i.hasZ=!0)}(e,t,r,i,n)}async function Yf(e,t,r,i){const n=e.spatialReference,s=await(0,an.projectWithZConversion)(t.position,n,{signal:r}),o=t.clone();return o.position=s,$f(e,null,o,i)}async function Xf(e,t,r,i,n,s){s.targetGeometry=r.clone();const o=(0,$u.bZ)(e);if(t.position)return async function(e,t,r,i,n,s,o){const a=e.renderSpatialReference;return await(0,cn.W)(t,om,a,0,{signal:o}),await(0,cn.W)(r,sm,a,0,{signal:o}),s.targetGeometry=new df.A(t),n.position=new df.A(r),(0,da.f)(nm,om,sm),(0,En.gn)(e,sm,nm,i.up,n),s.scale=(0,En.Fj)(e,(0,da.p)(sm,om),s.targetGeometry.latitude),s.rotation=Uf(n.heading),s.camera=n,s}(e,s.targetGeometry,t.position,o,i,s,n);if(t.zoomFactor){const i=o.distance/t.zoomFactor,n=(0,da.j)(Qf,o.viewForward,-i);o.eye=(0,da.g)(Qf,o.center,n),s.scale=(0,En.Fj)(e,i,r.latitude)}(0,En.dl)(e,o,i);const a=Zf(i,t)?En.AO.LOCKED:En.AO.ADJUST;if(!t.zoomFactor){const l=Gf(e,t);null==l?(await(0,cn.W)(r,Qf,e.renderSpatialReference,0,{signal:n}),(0,Lf.bU)(o.frustum,Qf)?s.scale=(0,En.Fj)(e,(0,da.p)(o.eye,Qf),r.latitude):s.scale=(0,En.gx)(e,o)):s.scale=l,s.camera=await(0,En.gU)(e,s.targetGeometry,s.scale,i,a,n)}return s}function Jf(e){return null!=e?.camera&&(e.rotation=Uf(e.camera.heading)),e}class Kf{constructor(){this.hasZ=!1,this.boundingBox=(0,If.Ie)(),this.screenSpaceObjects=new Array}}const Qf=(0,nn.vt)(),em=(0,qa.vt)(),tm=(0,Zh.vt)(),rm=(0,If.vt)(),im=(0,un.vt)(),nm=(0,nn.vt)(),sm=(0,nn.vt)(),om=(0,nn.vt)(),am={heading:0,tilt:0},lm=new df.A,cm={point(e,t,r){r[0]=e.x,r[1]=e.y,null!=e.z&&(r[2]=e.z),t(r)},polygon(e,t,r){const i=e.hasZ;for(let n=0;n<e.rings.length;n++){const s=e.rings[n];for(let e=0;e<s.length;e++)r[0]=s[e][0],r[1]=s[e][1],i&&(r[2]=s[e][2]),t(r)}},polyline(e,t,r){const i=e.hasZ;for(let n=0;n<e.paths.length;n++){const s=e.paths[n];for(let e=0;e<s.length;e++)r[0]=s[e][0],r[1]=s[e][1],i&&(r[2]=s[e][2]),t(r)}},multipoint(e,t,r){const i=e.points,n=e.hasZ;for(let s=0;s<i.length;s++)r[0]=i[s][0],r[1]=i[s][1],n&&(r[2]=i[s][2]),t(r)},extent(e,t,r){null!=e.zmin&&null!=e.zmax?(t((0,da.s)(r,e.xmin,e.ymin,e.zmin)),t((0,da.s)(r,e.xmax,e.ymin,e.zmin)),t((0,da.s)(r,e.xmin,e.ymax,e.zmin)),t((0,da.s)(r,e.xmax,e.ymax,e.zmin)),t((0,da.s)(r,e.xmin,e.ymin,e.zmax)),t((0,da.s)(r,e.xmax,e.ymin,e.zmax)),t((0,da.s)(r,e.xmin,e.ymax,e.zmax)),t((0,da.s)(r,e.xmax,e.ymax,e.zmax))):(t((0,da.s)(r,e.xmin,e.ymin,r[2])),t((0,da.s)(r,e.xmax,e.ymin,r[2])),t((0,da.s)(r,e.xmin,e.ymax,r[2])),t((0,da.s)(r,e.xmax,e.ymax,r[2])))}};class um{constructor(e,t,r){this._target=e,this._options=t,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise(((e,t)=>{this._resolveCallback=e,this._rejectCallback=t;const r=new AbortController;null!=this._options.signal&&(0,Ke.u7)(this._options.signal,(()=>{this.abort()})),this._abortController=r,this._waitForReady()}))}_resolve(e){if("finished"!==this.state)return this.state="finished",this._resolveCallback(e)}_reject(e){if("finished"!==this.state)return this.state="finished",this._rejectCallback(e)}abort(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._abortController.abort(),"wait-for-animation-finish"===this.state&&!e&&null!=this._animationController&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this._reject((0,Ke.NK)())}async _waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await(0,gt.C_)((()=>this.view.ready),this._abortController.signal)}catch(e){return this._reject(e)}this._createViewPoint()}async _createViewPoint(){if("finished"!==this.state){this.state="wait-for-viewpoint",this._animationController=this._options.animate?this._getAnimationController():null;try{const e=await Hf(this.view,this._target,this._abortController.signal);if("finished"===this.state)return;const t=e?this._getCameraFromViewpoint(e):null;if(null==t)return;if(this._options.animate){if(null==this._animationController)return;this._startAnimation(t,this._animationController)}else this.view.stateManager.setStateCamera(t.camera,{applyConstraints:!t.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this._resolve()}catch(e){this._reject(e)}}}_getCameraFromViewpoint(e){const t=!!(this._target instanceof Lt&&this._target.camera||this._target instanceof Rt.A),r=e.camera;if(null==r)return null;if(!this.view.stateManager.isCompatible(r)){const e=r.position,t=e&&e.spatialReference,i=t?t.wkid:"none",n=this.view.spatialReference?.wkid;return this._reject(new Ze.A("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${i}, view: ${n})`,{camera:r})),null}const i=(0,En.Cz)(this.view,r);return null==i?(this._reject(new Ze.A("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:i,isFullySpecified:t}}_startAnimation(e,t){this.state="wait-for-animation-finish";const r=t.viewAnimation;if(null==r)return void this._reject(new Ze.A("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!t.active||null==t.viewAnimation||t.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==t)return this.abort();let i;e.isFullySpecified?(i=new Cf({view:this.view,desiredCamera:e.camera}),qu(this.view,e.camera,Zu.EYE_AND_CENTER)):Vh(this.view,e.camera),t.begin(e.camera,this._options);const n=e=>{if(null!=this.view.state)switch(t.state){case Rd.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._resolve()}break;case Rd.Ready:case Rd.Rejected:case Rd.Running:case Rd.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._reject(e)}}};r.when((()=>{const r=this.view.state.cameraController;i&&(r&&r.active?r instanceof Ld&&null!=r.viewAnimation&&r.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=i):null!=t.viewAnimation&&t.viewAnimation.target===e.viewpoint&&t.state===Rd.Finished&&(this.view.state.cameraController=i))}),(e=>n(e))),t.asyncResult={resolve:()=>n(),reject:e=>n(e)}}_getAnimationController(){let e=null,t=null;const r=this.view.state.cameraController;return r instanceof Ld&&(r.updateStateFromViewAnimation(),r.active&&(e=r,t=e.viewAnimation)),null!=e||(e=new Ld({view:this.view,mode:"animation"}),t=e.viewAnimation,this.view.state.switchCameraController(e))?e:(null!=t&&t.stop(),this._reject(new Ze.A("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}var hm=r(48606),dm=r(13840),pm=r(71118),fm=r(98476);let mm=class extends ht.A{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=Mm,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:e=>this._devicePixelRatioOverride=e,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return null!=this.renderState},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(e){this.viewStateManager._idleTimeout=e?Mm:0}},this._propertiesPool=new hm.M({frustum:Af.P},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new gm}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([(0,gt.on)((()=>this.view.state.events),"before-camera-change",(e=>e&&this._updateElevation(e))),(0,gt.wB)((()=>this.view.state?.camera),((e,t)=>this._cameraChangedHandler(e,t)),gt.OH)]),(0,gt.z7)((()=>this.view.state?.camera),(e=>this._updateElevation(e)),{once:!0,sync:!0}),this.addHandles([(0,Ji.mg)({prepare:()=>this._prepareFrame()}),(0,gt.wB)((()=>this.view.state.cameraController),(()=>{this._cameraSetByUser=!0,this.removeHandles(Sm)})),(0,gt.on)((()=>this.view.state.events),"camera-projection-changed",(()=>this.notifyChange("scale")))])}destroy(){this.exit(),this._propertiesPool=(0,Je.pR)(this._propertiesPool)}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=(0,En.dl)(this.view,this.view.state.camera,bm);return t&&e&&t.equals(e)?e:t.clone()}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider?.enableCache(!0),this.setStateCamera((0,En.Cz)(this.view,e),{applyConstraints:!1})||Xe.A.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider?.enableCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=(0,En.dl)(this.view,this.view.state.contentCamera,bm);return t&&e&&t.equals(e)?e:t.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=(0,En.Cz)(this.view,e);null!=t?(this._updateElevation(t),this.view.state.contentCamera=t):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(Tm),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,r=this.view.state.camera.distance**2,i=(0,nn.ci)(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([(0,gt.wB)((()=>this.contentCamera),(()=>{e.sticky||(this.removeHandles(Tm),this.test.contentCameraResetState.clear())})),(0,gt.wB)((()=>this.zoom),(e=>{void 0!==e&&void 0!==t&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(e-t)/2),Math.abs(e-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))})),(0,gt.wB)((()=>this.view.state.camera),(e=>{const t=(0,da.a)(i,e.center);this.test.contentCameraResetState.set("camera.center",t/r),t>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)}))],Tm),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():Xe.A.getLogger(this).error("#center=","Invalid center",e):Xe.A.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):Xe.A.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=(0,En.w1)(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return null!=t?t:this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||Xe.A.getLogger(this).error("#extent=","Invalid extent",e):Xe.A.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):Xe.A.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){const e=this.view.map;return e&&"initialViewProperties"in e?e.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return(0,En.Fj)(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||Xe.A.getLogger(this).error("#scale=","Invalid scale",e)}get terrainScale(){if(!this.ready)return this._get("scale");const e=this.view,t=e.basemapTerrain.tilingScheme,r=e.pointsOfInterest.cameraOnSurface.scale;if(!t||!r)return this._get("scale");const i=e.state.contentCamera;let n=(0,En.gn)(e,i.eye,i.viewForward,i.up).tilt;n>90&&(n=180-n);const s=2*(n/90)**2,o=t.levelAtScale(r)-s;return o<0?this._get("scale"):t.scaleAtLevel(o)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,r=e.pixelRatio,i=this._get("padding"),n=Math.round(t[dm.zj.TOP]/r),s=Math.round(t[dm.zj.RIGHT]/r),o=Math.round(t[dm.zj.BOTTOM]/r),a=Math.round(t[dm.zj.LEFT]/r);return null!=i&&i.top===n&&i.right===s&&i.bottom===o&&i.left===a?i:{top:n,right:s,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,xm),this.view.state.updateCamera((e=>e.padding=xm)))}_paddingToArray(e,t,r){e?(0,ga.s)(r,e.top||0,e.right||0,e.bottom||0,e.left||0):(0,ga.s)(r,0,0,0,0);for(let i=0;i<4;i++)r[i]=Math.round(r[i]*t)}get screenCenter(){const e=this.padding;return(0,Ki.tc)((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return null==r&&(r=new Lt),$f(e,null,t.clone(),r)}(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||Xe.A.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const t=null!=e.camera?e.camera.position:e.targetGeometry,r=null!=t&&t.spatialReference;Xe.A.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}else Xe.A.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?(0,En.J9)(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||void 0===e||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||Xe.A.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),t=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*t),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*t);const r=this.view._stage.renderView.renderingContext?.parameters.maxTextureSize;return r&&(0,nl.T)(this._tmpCanvasSize,r),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:t,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return null!=this._devicePixelRatioOverride?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(pm.n.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const e=this.view?._stage?.renderer;return e&&(e.isFeatureEnabled(pm.n.PhysicalPixelRendering,fm.M.IDLE)||e.isFeatureEnabled(pm.n.PhysicalPixelRendering,fm.M.INTERACTING)||e.isFeatureEnabled(pm.n.PhysicalPixelRendering,fm.M.ANIMATING))}preinit(e){return!(this._isOverridden("center")&&!(0,an.isLoadedOrLoadFor)(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!(0,an.isLoadedOrLoadFor)(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!(0,an.isLoadedOrLoadFor)(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||(0,an.isLoadedOrLoadFor)(this.viewpoint.targetGeometry?.spatialReference,e)&&(0,an.isLoadedOrLoadFor)(this.viewpoint.camera?.position?.spatialReference,e))}init(){this._constraintsManager=new Tf({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this._cameraSetByUser){const e=this._initialViewpoint||this.view.initialExtent;e&&this.isCompatible(e)?this._setInitialView(e):this.view.state.viewingMode===$s.RT.Local&&this.addHandles((0,gt.z7)((()=>this.view.basemapTerrain.ready),(()=>{this.removeHandles(Sm),this._setInitialView(this.view.dataExtent)}),{once:!0,initial:!0}),Sm)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(Sm),this._constraintsManager=(0,Je.pR)(this._constraintsManager))}async goTo(e,t){return t={animate:!0,...t},null!=this._gotoOperation&&this._gotoOperation.abort(t.animate),this._gotoOperation=new um(e,t,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera((0,$u.bZ)(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,r=t?.cameraController;r&&(t.updateCamera((t=>r.stepController(e,t))),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){null!=this._gotoOperation&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:r,overrides:i}of _m){const n=e.has(r),s=this._isOverridden(r);!n&&s&&t.push({name:r,value:this._get(r)}),this._clearOverride(r),(n||s)&&i.forEach((t=>e.add(t)))}return t}_setInitialView(e){if(null==e||this._cameraSetByUser)return;if(e instanceof Rt.A)return void this.setStateCamera((0,En.Cz)(this.view,e),{applyConstraints:!1});if(e instanceof Lt){if(e.targetGeometry instanceof Zn.A){const t=(0,En.wI)(this.view,e.targetGeometry,0,.5,En.AO.LOCKED);return void(null!=t&&this.setStateCamera((0,En.Cz)(this.view,t),{applyConstraints:!0}))}const t={applyConstraints:!e.camera},r=this._viewpointToCamera(e);return void this.setStateCamera(r,t)}const t=(0,En.wI)(this.view,e,0,.5,En.AO.LOCKED);null!=t&&this.setStateCamera((0,En.Cz)(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&ym.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return null!=e&&(e instanceof Lt?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Rt.A?this.isCompatible(e.position):e.spatialReference&&!(0,an.requiresLoad)(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vm;return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:wm;const{heading:i,tilt:n}=this._getPreservingHeadingTilt(),s=(0,En.rW)(this.view,i,n,e,t,En.AO.ADJUST);return null==s?null:(r.copyFrom(this.view.state.camera),r.eye=s.eye,r.center=s.center,r.up=s.up,r)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:t,tilt:r}=this._getPreservingHeadingTilt(),i=(0,En.wI)(this.view,e,t,r,En.AO.ADJUST,bm);return i?(0,En.Cz)(this.view,i):null}_scaleToCamera(e){if(null==e)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.renderLocation,i=t.location.latitude,n=(0,En.tv)(this.view,e,i);return this._centerPointAtDistanceToCamera(r,n)}_zoomToCamera(e){return this._scaleToCamera((0,En.XM)(this.view,e))}_viewpointToCamera(e){return(0,En.Cz)(this.view,Vf(this.view,e))}setStateCamera(e,t){return!(null==e||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera((r=>{t.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up,r.fov=e.fov):r.copyFrom(e),t.applyConstraints&&Vh(this.view,r)})),t.applyConstraints||(this.view.state.cameraController=new Cf({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._computeCanvasSize();if(0!==r.width&&0!==r.height&&(t.width===r.width&&t.height===r.height||(t.width=r.width,t.height=r.height),this.view.state)){const e=this.view.state.camera;e.fullWidth===r.width&&e.fullHeight===r.height&&e.pixelRatio===r.pixelRatio||(wm.copyFrom(e),wm.pixelRatio!==r.pixelRatio&&(this._paddingToArray(this.padding,r.pixelRatio,xm),wm.padding=xm),wm.fullWidth=r.width,wm.fullHeight=r.height,wm.pixelRatio=r.pixelRatio,this.view.state.camera=wm),this._updateViewState()}}_updateElevation(e){const t=this.view.basemapTerrain?.spatialReference,r=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,i=t?(0,$u.Rt)(this.view,e.eye):0;e.relativeElevation=r-i}_updateViewState(){null!=this.test.renderState?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=fm.M.ANIMATING:this.view.interacting?this.view.state.mode=fm.M.INTERACTING:(this.view.state.mode===fm.M.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=fm.M.INTERACTING:this.view.state.mode=fm.M.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};(0,ze._)([(0,Qe.MZ)({type:Rt.A,dependsOn:["view.state.camera","ready"]})],mm.prototype,"camera",null),(0,ze._)([(0,Qe.MZ)({type:Rt.A,dependsOn:["view.state.contentCamera","ready"]})],mm.prototype,"contentCamera",null),(0,ze._)([(0,Qe.MZ)({type:df.A})],mm.prototype,"center",null),(0,ze._)([(0,Qe.MZ)({type:Zn.A})],mm.prototype,"extent",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],mm.prototype,"frustum",null),(0,ze._)([(0,Qe.MZ)()],mm.prototype,"_constraintsManager",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],mm.prototype,"constraintsManager",null),(0,ze._)([(0,Qe.MZ)()],mm.prototype,"_initialViewpoint",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],mm.prototype,"hasInitialView",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0,type:Boolean})],mm.prototype,"ready",void 0),(0,ze._)([(0,Qe.MZ)({type:Number})],mm.prototype,"scale",null),(0,ze._)([(0,Qe.MZ)({type:Number})],mm.prototype,"terrainScale",null),(0,ze._)([(0,Qe.MZ)()],mm.prototype,"padding",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],mm.prototype,"screenCenter",null),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],mm.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({type:Lt})],mm.prototype,"viewpoint",null),(0,ze._)([(0,Qe.MZ)({type:Number})],mm.prototype,"zoom",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],mm.prototype,"_rasterPixelRatio",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],mm.prototype,"_usePhysicalPixelRendering",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],mm.prototype,"_usePhysicalPixelRenderingAny",null),(0,ze._)([(0,Qe.MZ)()],mm.prototype,"_windowDevicePixelRatio",void 0),(0,ze._)([(0,Qe.MZ)()],mm.prototype,"_devicePixelRatioOverride",void 0),mm=(0,ze._)([(0,tt.$)("esri.views.3d.state.ViewStateManager")],mm);class gm{constructor(){this.width=0,this.height=0,this.pixelRatio=1}}const ym=new Set(["camera","viewpoint","extent","scale","center","zoom"]),_m=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],vm={heading:0,tilt:0},bm=new Rt.A,wm=new id.A,xm=(0,ya.vt)(),Sm="pending-initial-view",Tm="content-camera-reset",Mm=300;let Am=class extends Pd{constructor(){super(...arguments),this.startCamera=new id.A,this.currentCamera=new id.A,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<100}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=Rd.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout((()=>this.notifyChange("isInteractive")),100),this.view.state.updateCamera((e=>this.stepController(0,e))),this.steppingFinished&&this.finishController()}};var Cm;(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Am.prototype,"isInteractive",null),(0,ze._)([(0,Qe.MZ)()],Am.prototype,"_lastInteraction",void 0),Am=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.InteractiveController")],Am),function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"}(Cm||(Cm={}));let Em=class extends Am{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Cm.CENTER,this._rotScale=0,this._lastPoint=(0,va.vt)(),this._tmpWorldUp=(0,nn.vt)(),this._tmpViewDir=(0,nn.vt)(),this._tmpRotCurPoint=(0,va.vt)(),this._tmpTransf=(0,qa.vt)(),this._tmpAxis=(0,nn.vt)(),this._tmpPivotPoint=(0,nn.vt)(),this._pivotPos=(0,nn.vt)(),this._constraintOptions=new Mu(bu.ALL,wu.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===Cm.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Cm.EYE:(0,da.c)(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=wu.LOOK_AROUND,this._constraintOptions.tiltMode=xu.LOOK_AROUND,this._constraintOptions.selection=bu.NONE;break;case Cm.CENTER:{const t=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,0===this.view.map.ground.opacity?ep:{});t||(0,da.c)(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=wu.TUMBLE,this._constraintOptions.tiltMode=xu.TUMBLE,this._constraintOptions.selection=bu.ALL&~bu.DISTANCE;break}}tp(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,t){const r=this.startCamera,i=(0,nn.vt)();(0,da.f)(i,this._pivotPos,r.eye);const n=(0,da.l)(i),s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Pm);let o=Math.max(Math.min(5,1/Math.abs((0,da.m)(Pm,r.viewForward)))*s,10);t&&(o=Math.min(n,o));const a=(0,Ki.gs)(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),l=gp(this.startCamera,a,this.view.renderCoordsHelper,this.view.viewingMode);let c=this.view._stage.renderView.getMinimalDepthForArea((0,nf.ds)(this.view),r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,225,90),u=this.view._stage.renderView.getMinimalDepthForArea((0,nf.ds)(this.view),e[0],e[1],r,90);null==c&&null==u||(c=c??u??0,u=null==u||l===hp.Horizontal?c:u,o=c>u?u:c,o=t?Math.min(o,n):o),(0,da.n)(i,i),(0,da.c)(this._pivotPos,(0,da.g)(this._tmpPivotPoint,r.eye,(0,da.j)(this._tmpPivotPoint,i,o)))}update(e){if(this.active){switch(this.pivot){case Cm.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Cm.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Vh(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,t,r,i){this.view.renderCoordsHelper.worldUpAtPosition(i,this._tmpWorldUp),tp(e,t,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,s=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;(0,da.f)(this._tmpViewDir,r,i);const o=(0,da.l)(this._tmpViewDir),a=(0,ws.XM)((0,da.m)(this._tmpViewDir,this._tmpWorldUp)/o);if(this.pivot===Cm.EYE){n*=-.5;const e=.5*Math.PI-a,t=.5*Math.PI*.99;n=e-Math.max(-t,Math.min(t,e+n))}return n=(0,ws.qE)(n+a,xo.min,xo.max)-a,(0,da.b)(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Cm.CENTER&&(s=-s),(0,$a.$0)(this._tmpTransf,s,this._tmpWorldUp),(0,$a.e$)(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),(0,da.h)(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=(0,da.h)(Rm,e.up,this._tmpTransf),(0,da.g)(Rm,i,this._tmpViewDir),(0,ma.C)(this._lastPoint,this._tmpRotCurPoint),Rm}};(0,ze._)([(0,Qe.MZ)()],Em.prototype,"pivot",void 0),Em=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.RotateController")],Em);const Rm=(0,nn.vt)(),Pm=(0,nn.vt)();class Om extends cf.l{constructor(e,t,r,i){super(!0),this._view=e,this.pointerAction=t,this._pivot=r,this.registerIncoming("drag",i,(e=>this._handleDrag(e)))}_handleDrag(e){const t=e.data;if(t.pointers.size>1)return;if(!uf(e.data,this.pointerAction))return;const r=(0,Ki.gs)(t.center.x,t.center.y);switch(t.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new Em({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}}let Im=class extends Am{constructor(){super(...arguments),this._pickPoint=(0,nn.vt)(),this._tmpP0=(0,va.vt)(),this._panAxisAngle=Bd(),this._tmpRayDir=(0,nn.vt)(),this._tmpRayDirPick=(0,nn.vt)(),this._targetOnSphere=(0,nn.vt)(),this._navMode=hp.Horizontal,this._tmpRay={origin:(0,nn.vt)(),direction:(0,nn.vt)()},this.dragBeginPoint=(0,Ki.gs)(),this._normalizedAnchorPoint=(0,va.vt)(),this._constraintOptions=new Mu(bu.ALL_EXCEPT_COLLISION,wu.ZOOM,0,this.startCamera),this._sphere=(0,Su.c)(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;(0,ma.C)(this.dragBeginPoint,e),tp(this.startCamera,e,this._normalizedAnchorPoint);const t=(0,pa.tO)(this.view.spatialReference),r=mp(this._intersectionHelper,this.startCamera,e,t,Xd.Ellipsoid,0===this.view.map.ground.opacity?ep:{});if(this._navMode=gp(this.startCamera,e,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===hp.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let t;(0,qd.vr)(this.startCamera,e,this._tmpRay),(0,da.n)(this._tmpRay.direction,this._tmpRay.direction),null!=r.scenePickPoint&&((0,da.f)(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),t=(0,da.l)(this._tmpRayDirPick));const i=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Nm);let n=(0,ws.qE)(Math.min(30,1/Math.abs((0,da.m)(Nm,this._tmpRay.direction)))*i,Kd[0],Kd[1]);const s=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,80);n=null!=s?s:n,n=null!=t?Math.min(n,t):n,this._hasPickPoint=!0,(0,da.j)(this._tmpRay.direction,this._tmpRay.direction,n),(0,da.g)(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===hp.Horizontal){(0,da.f)(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=(0,da.l)(this._tmpRayDir);tp(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let i=t*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&i<n&&(i=n),Math.abs(t-i)<1e-6)return;if(this._hasPickPoint&&i<t){const e=1-(1-i/t)*(1-this._sphere[3]/(0,da.l)(this.currentCamera.center));this.currentCamera.center=(0,da.j)(Lm,this.currentCamera.center,e)}(0,da.j)(this._tmpRayDir,this._tmpRayDir,-i/t),this.currentCamera.eye=(0,da.g)(Lm,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Bh((0,ma.Io)(this.dragBeginPoint,e)),Vh(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(vp(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),Gd(this._pickPoint,this._targetOnSphere,this._panAxisAngle),ip(this.currentCamera,(0,Su.g)(this._sphere),this._panAxisAngle))}else{const t=(0,da.l)(this._tmpRay.direction);tp(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let i=t*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&i<n&&(i=n),Math.abs(t-i)<1e-6)return;(0,da.j)(this._tmpRayDir,this._tmpRay.direction,1-i/t),this.currentCamera.eye=(0,da.g)(Lm,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=(0,da.g)(Lm,this.currentCamera.center,this._tmpRayDir)}qu(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};Im=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.ZoomControllerGlobal")],Im);const Lm=(0,nn.vt)(),Nm=(0,nn.vt)();let Dm=class extends Am{constructor(){super(...arguments),this._tmpP=(0,nn.vt)(),this._tmpDir=(0,nn.vt)(),this._tmpN=(0,nn.vt)(),this._tmpP0=(0,va.vt)(),this._tmpPoi=(0,nn.vt)(),this._tmpRayDir=(0,nn.vt)(),this.dragBeginPoint=(0,Ki.gs)(),this._normalizedAnchorPoint=(0,va.vt)(),this._constraintOptions=new Mu(bu.ALL,wu.ZOOM,0,this.startCamera,(0,nn.vt)()),this._plane=(0,$d.vt)()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;(0,ma.C)(this.dragBeginPoint,e),tp(this.startCamera,e,this._normalizedAnchorPoint);const t=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,0===this.view.map.ground.opacity?ep:{});(0,da.f)(this._tmpDir,this._tmpP,this.startCamera.eye);const r=(0,da.l)(this._tmpDir);(0,da.n)(this._tmpDir,this._tmpDir);const i=Math.abs(this.view.camera.position.z);let n=(0,ws.qE)(Math.min(30,1/Math.abs((0,da.m)(km,this._tmpDir)))*i,Kd[0],Kd[1]);const s=this.view._stage.renderView.getMinimalDepthForArea((0,nf.ds)(this.view),e[0],e[1],this.view.state.camera,80);n=null!=s?s:n,n=t?Math.min(n,r):n,(0,da.j)(this._tmpDir,this._tmpDir,n),(0,da.g)(this._tmpP,this.startCamera.eye,this._tmpDir),(0,da.f)(this._tmpN,this.startCamera.eye,this.startCamera.center),(0,da.n)(this._tmpN,this._tmpN),this._tmpN[1]<0&&(0,da.k)(this._tmpN,this._tmpN),(0,$d.O_)(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.active)return;(function(e,t,r,i){return(0,$d.Ui)(e,(0,qd.Z4)(t,r,Kp),i)})(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||(0,da.c)(this._tmpPoi,this.currentCamera.center),tp(this.currentCamera,e,this._tmpP0);let t=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);(0,ma.C)(this._normalizedAnchorPoint,this._tmpP0),(0,da.f)(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=(0,da.l)(this._tmpRayDir);let i=r*(1-t);this._constraintOptions.interactionDirection&&((0,da.c)(this._constraintOptions.interactionDirection,this._tmpRayDir),(0,da.j)(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(t)/r));const n=this.view.state.constraints.minimumPoiDistance;t>=0&&i<n&&(i=n,t=-(i-r)/r),Math.abs(r-i)<1e-6||((0,da.j)(this._tmpRayDir,this._tmpRayDir,t),this.currentCamera.eye=(0,da.g)(Fm,this.currentCamera.eye,this._tmpRayDir),(0,da.o)(Fm,this.currentCamera.center,this._tmpPoi,t),this._tmpPoi[2]>this.startCamera.center[2]?Fm[2]=Math.max(this.startCamera.center[2],Fm[2]):Fm[2]=Math.min(this.startCamera.center[2],Fm[2]),this.currentCamera.center=Fm,this._constraintOptions.interactionFactor=Bh((0,ma.Io)(this.dragBeginPoint,e)),Vh(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};Dm=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.ZoomControllerLocal")],Dm);const Fm=(0,nn.vt)(),km=(0,nn.fA)(0,0,1);class zm extends cf.l{constructor(e,t,r){super(!0),this._view=e,this.pointerAction=t,this.registerIncoming("drag",r,(e=>this._handleDrag(e)))}_handleDrag(e){const t=e.data;if(t.pointers.size>1)return;if(!uf(e.data,this.pointerAction))return;const r=(0,Ki.gs)(t.center.x,t.center.y);switch(t.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new Im({view:this._view}):this._cameraController=new Dm({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}}var Um=r(71372);function Vm(e){let t=e*e;return e<0&&(t*=-1),t}function Bm(e,t,r){const i=r,n=e.state,s=e.device,o="forward-down"===t.tiltDirection?1:-1;return"standard"===s.deviceType?(i.translation[0]=Vm(n.axes[0]),i.translation[1]=Vm(n.axes[1]),i.translation[2]=Vm(n.buttons[7])-Vm(n.buttons[6]),i.heading=Vm(n.axes[2]),i.tilt=Vm(n.axes[3])):"spacemouse"===s.deviceType&&(i.translation[0]=1.2*Vm(n.axes[0]),i.translation[1]=1.2*Vm(n.axes[1]),i.translation[2]=2*-Vm(n.axes[2]),i.heading=1.2*Vm(n.axes[5]),i.tilt=1.2*Vm(n.axes[3])),i.tilt*=o,(0,da.j)(i.translation,i.translation,1),i}function jm(e,t){const r=t;return r.translation[0]=e[1]-e[0],r.translation[1]=e[3]-e[2],r.translation[2]=e[4]-e[5],r.heading=e[7]-e[6],r.tilt=e[8]-e[9],r.zoom=e[10]-e[11],r}function Hm(e){return 0===e.translation[0]&&0===e.translation[1]&&0===e.translation[2]&&0===e.heading&&0===e.tilt&&0===e.zoom}let Gm=class extends Am{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new id.A,this._headingStart=0,this._constraintOptions=new Mu(bu.ALL,wu.NONE,0,new id.A,null,xu.LOOK_AROUND)}handleEventGamepad(e){const t=Bm(e,this.view.navigation.gamepad,this._transformation);("end"===e.action||Hm(t))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,jm(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;Hm(jm(this._keysButtonState,this._transformation))&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z;this._filteredSurfaceElevation+=1*(t-this._filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Km),this._applyDisabledMovementTypes(Km),this._applyPan(Km.pan),this._applyRotate(Km.rotate),this._applyZoom(Km.zoom),this._applyAscend(Km.ascend),this._constraintOptions.interactionType=wu.NONE,this._constraintOptions.selection=bu.COLLISION,Vh(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,t)}_updateStartHeading(){0!==this._transformation.heading&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;(0,da.f)(Qm,t.center,t.eye),(0,da.h)(Qm,Qm,e.matrix),t.center=(0,da.g)(Qm,Qm,t.eye),t.up=(0,da.h)(Qm,t.up,e.matrix),this._constraintOptions.interactionType=wu.LOOK_AROUND,this._constraintOptions.selection=bu.ALL_EXCEPT_COLLISION,Vh(this.view,t,this._constraintOptions)}_applyPan(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentCamera;e.enabled&&(t.eye=(0,da.h)(Qm,t.eye,e.matrix),t.center=(0,da.h)(Qm,t.center,e.matrix),this.view.state.isGlobal&&(t.up=(0,da.h)(Qm,t.up,e.matrix)),this._constraintOptions.interactionType=wu.PAN,this._constraintOptions.selection=bu.ALL,Vh(this.view,t,this._constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=(0,da.g)(Qm,this.currentCamera.eye,(0,da.j)(Vd.rq.get(),t,e)),(0,da.c)(eg,t),(0,da.k)(eg,eg),this._constraintOptions.interactionDirection=eg,this._constraintOptions.interactionType=wu.ZOOM,this._constraintOptions.selection=bu.ALL_EXCEPT_COLLISION,Vh(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Vd.rq.get());if(this._constraintOptions.interactionDirection=(0,da.c)(eg,t),this.view.state.isGlobal){const t=(0,da.l)(this.currentCamera.eye),r=(t+e)/t;this.currentCamera.eye=(0,da.j)(Qm,this.currentCamera.eye,r),this.currentCamera.center=(0,da.j)(Qm,this.currentCamera.center,r)}else{const r=(0,da.j)(Vd.rq.get(),t,e);this.currentCamera.eye=(0,da.g)(Qm,this.currentCamera.eye,r),this.currentCamera.center=(0,da.g)(Qm,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=wu.ASCEND,this._constraintOptions.selection=bu.COLLISION,Vh(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=bu.ALL_EXCEPT_COLLISION,Vh(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,r){!function(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,(0,$a.D_)(e.pan.matrix),e.rotate.enabled=!1,(0,$a.D_)(e.rotate.matrix)}(r);const i=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(i,t,r):this._calculateControlTransformationGlobal(i,t,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(r,e,Qm)}_calculateControlTransformationLocal(e,t,r){const{viewRight:i,viewForward:n}=t,s=this._transformation,o=this.view.navigation.gamepad,a=(0,da.s)(Vd.rq.get(),n[0],n[1],0);(0,da.n)(a,a);const l=s.translation[0]*e.pan;if(0!==l){const e=(0,da.j)(Vd.rq.get(),i,l);(0,$a.Tl)(r.pan.matrix,r.pan.matrix,e),r.pan.enabled=!0}switch(o.mode){case"pan":{const t=-s.translation[1]*e.pan;if(0!==t){const e=(0,da.j)(Vd.rq.get(),a,t);(0,$a.Tl)(r.pan.matrix,r.pan.matrix,e),r.pan.enabled=!0}r.zoom=s.zoom*e.zoom;break}case"zoom":r.zoom=(-s.translation[1]+s.zoom)*e.zoom;break;default:(0,Ge.Xb)(o.mode)}const c=s.translation[2]*e.ascend;r.ascend=c;const u=-s.heading*e.rotate;0!==u&&((0,$a.e$)(r.rotate.matrix,r.rotate.matrix,u,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,Vd.rq.get())),r.rotate.enabled=!0);const h=s.tilt*e.rotate,d=Xu(this.view.renderCoordsHelper,t.center,t.eye),p=(0,ws.qE)(d+h,xo.min,xo.max)-d;p&&((0,$a.e$)(r.rotate.matrix,r.rotate.matrix,p,i),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,r){const{eye:i,viewRight:n}=t,s=this._transformation,o=this.view.navigation.gamepad,a=(0,da.b)(Vd.rq.get(),n,i);(0,da.n)(a,a),(0,da.k)(a,a),Ip(this.startCamera,t,s,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,o),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Km.pan,this._tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=s.translation[2]*e.ascend;r.ascend=c;const u=-s.heading*e.rotate;0!==u&&((0,$a.e$)(r.rotate.matrix,r.rotate.matrix,u,this._tmpCamera.eye),r.rotate.enabled=!0);const h=s.tilt*e.rotate,d=this._clampTiltDeltaGlobalToValidRange(h,t.ray,l);0!==d&&((0,$a.e$)(r.rotate.matrix,r.rotate.matrix,d,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=s.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,r){const i=(0,pa.tO)(this.view.spatialReference),n=cp(xo.min,t.origin,r,i);let s=0,o=0;const a=Vd.rq.get();if(this.view.renderCoordsHelper.intersectManifold(t,r,a)){s=cp(Xu(this.view.renderCoordsHelper,a,t.origin),t.origin,r,i),o=cp(xo.max,t.origin,r,i)}else{(0,Su.e)((0,Su.h)(Su.t,r+i.radius),t,a);s=up(Math.PI+(0,Ud.g7)(t.direction,a),t.origin,r,i),o=up(xo.max,t.origin,r,i)}return(0,ws.qE)(s+e,n,o)-s}_getPointAbsoluteSurfaceElevation(e,t,r){const{renderCoordsHelper:i}=this.view,n=i.getAltitude(e),s=t+Math.abs(n-t);return i.setAltitude(r,s,e),s}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:r}=this.view,{camera:i}=this.view.state,{direction:n}=(0,En.ZC)(this.view,t,0,$m,tg),s=r.intersectManifoldClosestSilhouette((0,Tu.LV)(t,n),e,Vd.rq.get()),o=(0,da.p)(t,s),a=r.intersectManifoldClosestSilhouette((0,Tu.LV)(t,(0,da.E)(Vd.rq.get(),t,i.center)),e,Vd.rq.get()),l=(0,da.p)(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:r}=this.view,{camera:i,isGlobal:n}=r,s=t.intersectManifoldClosestSilhouette(i.ray,this._filteredSurfaceElevation,Vd.rq.get());if(n){const t=(0,da.f)(Vd.rq.get(),e,s),r=(0,da.l)(t);(0,da.j)(t,t,1/r);const i=(0,da.n)(Vd.rq.get(),e),n=(0,ws.XM)((0,da.m)(i,t));return r*Math.sin(Math.min(qm,n))}{const r=(0,da.c)(Vd.rq.get(),e);return t.setAltitude(r,this._filteredSurfaceElevation),(0,da.p)(s,r)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:Ym}_computeVelocities(e){const t=this._filteredSurfaceElevation,r=t+(0,pa.tO)(this.view.spatialReference).radius,{camera:i,isGlobal:n}=this.view.state,s=Vd.rq.get(),o=this._getPointAbsoluteSurfaceElevation(i.eye,t,s),a=this._clampedDistanceToSurface(t,s),l=i.width/2,c=Wm*i.width,u=Wm*i.width,h=a*Math.tan(.5*i.fovX)/l,d=h/r,p=h/this._computeHeadingRotateRadius(s),f=o-t;return{pan:(n?d:h)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*f-f),zoom:2**(c*e/l)*a-a,rotate:(0,ws.qE)(p*u,Xm,Jm)*e}}_applyDisabledMovementTypes(e){null==this.disableMovements||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&(0,$a.D_)(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&(0,$a.D_)(e.rotate.matrix))}static activatesFor(e,t){const r=Bm(t,e.navigation.gamepad,Zm);return!("end"===t.action||Hm(r))}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Gm.prototype,"gamepadDevice",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Gm.prototype,"disableMovements",void 0),Gm=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.GamepadKeyboardController")],Gm);const Zm={translation:[0,0,0],heading:0,tilt:0,zoom:0},$m=80,qm=(0,ws.kU)($m),Wm=.75,Ym=5,Xm=(0,ws.kU)(30),Jm=(0,ws.kU)(80),Km={zoom:0,ascend:0,pan:{enabled:!1,matrix:(0,qa.vt)()},rotate:{enabled:!1,matrix:(0,qa.vt)()}},Qm=(0,nn.vt)(),eg=(0,nn.vt)(),tg=(0,Um.N)();class rg extends cf.l{constructor(e){super(!0),this._view=e,this._watchHandles=new Gn.A,this._handle=this.registerIncoming("gamepad",(e=>this._handleEventGamepad(e))),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([(0,gt.wB)((()=>this._view.navigation.gamepad.enabled),(e=>{e?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))}),gt.Vh),(0,gt.wB)((()=>this._view.navigation.gamepad.device),(e=>{this._cameraControllerGamepad&&e&&this._cameraControllerGamepad.gamepadDevice!==e&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)}))])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const t=this._view.navigation.gamepad.device;if(t&&e.data.device!==t)return;const r=this._cameraControllerGamepad?.active;if(r||Gm.activatesFor(this._view,e.data)){if(!r){const t=new Gm({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(t)&&(this._cameraControllerGamepad=t)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}}var ig;!function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"}(ig||(ig={}));class ng extends cf.l{constructor(e,t){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:$s.RT.Local},this._keyToNumber={[t.left]:ig.LEFT,[t.right]:ig.RIGHT,[t.forward]:ig.FORWARD,[t.backward]:ig.BACKWARD,[t.up]:ig.UP,[t.down]:ig.DOWN,[t.headingLeft]:ig.HEADINGLEFT,[t.headingRight]:ig.HEADINGRIGHT,[t.tiltUp]:ig.TILTUP,[t.tiltDown]:ig.TILTDOWN,[t.zoomIn]:ig.ZOOMIN,[t.zoomOut]:ig.ZOOMOUT},this.registerIncoming("key-down",null,(e=>this._handleKeyDown(e))),this.registerIncoming("key-up",null,(e=>this._handleKeyUp(e))),this.registerIncoming("blur",null,(()=>this._handleStop())),this._visibilityHandle=function(e){const t=()=>e("visible"===document.visibilityState);return document.addEventListener("visibilitychange",t),(0,mt.hA)((()=>document.removeEventListener("visibilitychange",t)))}((e=>e?null:this._handleStop()))}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const t=this._keyToNumber[e.data.key];null!=t&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new Gm({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(t),e.stopPropagation()))}_handleStop(){this._cameraControllerKeyboard?.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const t=this._keyToNumber[e.data.key];null!=t&&this._cameraControllerKeyboard?.active&&(this._cameraControllerKeyboard.deactivateDirection(t),e.stopPropagation())}}class sg extends cf.l{constructor(e,t){super(!0),this._view=e,this.registerIncoming("mouse-wheel",t,(e=>this._handleMouseWheel(e)))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const t=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new ef({view:this._view,mode:"interaction"}):new sf({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*t.deltaY,(0,Ki.gs)(t.x,t.y)),e.preventDefault(),e.stopPropagation()}}class og{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return void 0===this._value?0:this._value}update(e){void 0===this._value?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}}let ag=class extends Od{constructor(){super(...arguments),this._beginCamera=new id.A,this._elapsedTimeSec=0,this.constraintOptions=new Mu(bu.ALL,wu.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new so}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,t),Vh(this.view,t,this.constraintOptions)}};ag=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.momentum.MomentumController")],ag);let lg=class extends ag{constructor(e){super(e),this.interactionType=wu.PAN,this._tmpPan=(0,nn.vt)()}momentumStep(e,t){const r=this.momentum.value(e);(0,da.j)(this._tmpPan,this.momentum.direction,r),t.eye=(0,da.f)(cg,t.eye,this._tmpPan),t.center=(0,da.f)(cg,t.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],lg.prototype,"momentum",void 0),lg=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],lg);const cg=(0,nn.vt)(),ug=(0,nn.vt)(),hg=(0,nn.vt)();let dg=class extends ag{constructor(e){super(e),this.interactionType=wu.PAN}momentumStep(e,t){const r=this.momentum.value1(e),i=this.momentum.value2(e);(0,da.c)(hg,t.eye),(0,da.n)(hg,hg),(0,da.b)(this.momentum.axis2,hg,this.momentum.axis1),Ep(t,ug,this.momentum.axis1,r,this.momentum.axis2,i)}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],dg.prototype,"momentum",void 0),dg=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],dg);let pg=class extends ag{set center(e){this._set("center",(0,nn.o8)(e))}set axis(e){this._set("axis",(0,nn.o8)(e))}constructor(e){super(e),this.interactionType=wu.TUMBLE}momentumStep(e,t){const r=this.momentum.value(e);ip(t,this.center,jd(this.axis,r))}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],pg.prototype,"momentum",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],pg.prototype,"center",null),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],pg.prototype,"axis",null),pg=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.momentum.RotationMomentumController")],pg);let fg=class extends ag{set zoomCenter(e){this._set("zoomCenter",(0,nn.o8)(e))}constructor(e){super(e),this.interactionType=wu.ZOOM,this.constraintOptions.interactionDirection=(0,nn.vt)()}momentumStep(e,t){const{interactionDirection:r}=this.constraintOptions;if(!r)return;(0,da.c)(r,t.eye);const i=this.momentum.valueDelta(0,e);sp(t,this.zoomCenter,i,this.view.state.constraints.minimumPoiDistance),(0,da.E)(r,t.eye,r)}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],fg.prototype,"momentum",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],fg.prototype,"zoomCenter",null),fg=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],fg);let mg=class extends ag{set screenCenter(e){this._set("screenCenter",(0,Ki.gs)(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",(0,nn.o8)(e))}constructor(e){super(e),this.interactionType=wu.ZOOM,this.radius=0,this._tmpSceneCenter=(0,nn.vt)(),this._tmpZoomAxisAngle=Bd(),this._sphere=(0,Su.c)()}initialize(){this._sphere[3]=this.radius}momentumStep(e,t){const r=this.momentum.valueDelta(0,e);op(this._sphere,t,r),this.constraintOptions.interactionType=wu.ZOOM,Vh(this.view,t,this.constraintOptions),vp(this._sphere,t,this.screenCenter,this._tmpSceneCenter),Gd(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),ip(t,(0,Su.g)(this._sphere),this._tmpZoomAxisAngle),this.constraintOptions.interactionType=wu.PAN}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],mg.prototype,"momentum",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],mg.prototype,"screenCenter",null),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],mg.prototype,"sceneCenter",null),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],mg.prototype,"radius",void 0),mg=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],mg);class gg{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const t=this.computeDelta(e);this._updateDelta(t)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(e){return void 0===this.lastValue?NaN:e-this.lastValue}_updateDelta(e){void 0!==this.filteredDelta?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}}class yg{constructor(e,t,r){this._initialVelocity=e,this._stopVelocity=t,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,t){const r=this.value(e);return this.value(e+t)-r}valueFromInitialVelocity(e,t){t=Math.min(t,this.duration);const r=1-this.friction;return e*(r**t-1)/Math.log(r)}}class _g extends yg{constructor(e,t,r,i,n){super(e,t,r),this._sceneVelocity=i,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}}class vg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.84;this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=r,this.enabled=!0,this._time=new gg(.6),this._screen=[new gg(.4),new gg(.4)],this._scene=[new gg(.6),new gg(.6),new gg(.6)],this._tmpDirection=(0,nn.vt)()}add(e,t,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(t[0]),this._scene[1].update(t[1]),this._scene[2].update(t[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,t=this._screen[1].filteredDelta,r=null==e||null==t?0:Math.sqrt(e*e+t*t),i=this._time.filteredDelta,n=null==i||null==r?0:r/i;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,t,r){(0,da.s)(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const i=(0,da.l)(this._tmpDirection);i>0&&(0,da.j)(this._tmpDirection,this._tmpDirection,1/i);const n=this._time.filteredDelta;return new _g(e,t,r,null==n?0:i/n,this._tmpDirection)}}class bg{constructor(e){this._gain=e}update(e){void 0!==this.filteredValue?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return void 0!==this.filteredValue}}const wg=1e-5;class xg extends yg{constructor(e,t,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6?arguments[6]:void 0;super(e,t,r),this._angularVelocity1=i,this.axis1=n,this.angularVelocity2=s,this.axis2=o}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}}class Sg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.84;this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=r,this.enabled=!0,this._tmpAxis1=(0,nn.vt)(),this._tmpAxis2=(0,nn.vt)(),this._tmpAngles=(0,va.vt)(),this._time=new gg(.3),this._screen=[new gg(.4),new gg(.4)],this._angle1=new bg(.6),this._angle2=new bg(.6),this._axis1=(0,nn.vt)(),this._axis2=(0,nn.vt)(),this._lastScene=(0,nn.vt)()}addMomentumDirectRotation(e,t,r,i,n,s){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let e=Sp(this._lastScene,t,this._tmpAxis2,i,n,s);this._angle2.update(0),(0,da.q)(this._tmpAxis2)<wg?e=0:(0,da.n)(this._axis1,this._tmpAxis2),this._angle1.update(e),(0,da.c)(this._lastScene,t)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,t,r,i,n,s,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;Ap(this._lastScene,t,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,i,n,s,o,!1),(0,da.q)(this._tmpAxis2)<wg?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),(0,da.n)(this._axis1,this._tmpAxis1),(0,da.n)(this._axis2,this._tmpAxis2)),(0,da.c)(this._lastScene,t)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,t=this._screen[1].filteredDelta,r=null==e||null==t?null:Math.sqrt(e*e+t*t),i=this._time.filteredDelta,n=null==r||null==i?0:r/i;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,t,r){const i=this._time.filteredDelta,n=this._angle1.filteredValue,s=this._angle2.filteredValue,o=null==i||null==s?0:s/i;return new xg(e,t,r,null==i||null==n?0:n/i,this._axis1,o,this._axis2)}}class Tg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12;this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=r,this._maxVelocity=i,this.enabled=!0,this.value=new gg(.8),this.time=new gg(.3)}add(e,t){if(this.enabled&&null!=t){if(this.time.hasLastValue()){if(this.time.computeDelta(t)<.01)return;if(this.value.hasFilteredDelta()){const t=this.value.computeDelta(e);this.value.filteredDelta*t<0&&this.value.reset()}}this.time.update(t),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=(0,ws.qE)(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,t,r){return new yg(e,t,r)}}class Mg extends Tg{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,arguments.length>3&&void 0!==arguments[3]?arguments[3]:12)}add(e,t){const r=this.value.lastValue;if(null!=r){let t=e-r;for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;e=r+t}super.add(e,t)}}class Ag extends yg{constructor(e,t,r){super(e,t,r)}value(e){const t=super.value(e);return Math.exp(t)}valueDelta(e,t){const r=super.value(e),i=super.value(e+t)-r;return Math.exp(i)}}class Cg extends Tg{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:2.5,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,arguments.length>3&&void 0!==arguments[3]?arguments[3]:12)}add(e,t){super.add(Math.log(e),t)}createMomentum(e,t,r){return new Ag(e,t,r)}}let Eg=class extends Am{constructor(){super(...arguments),this._smoothRotation=new og(.05),this._rotationAxis=(0,nn.vt)(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=(0,$d.vt)(),this._beginRadius=0,this._smoothScaling=new og(.05),this._zoomCenterScreen=(0,Ki.gs)(),this._zoomMomentumEstimator=new Cg,this._rotationMomentumEstimator=new Mg,this._panSphericalMomentumEstimator=new Sg,this._panPlanarMomentumEstimator=new vg,this._adjustedSphere=(0,Su.c)(),this._tmp3d=(0,nn.vt)(),this._tmpScreenPointArray=(0,Ki.gs)(),this._beginScreenPoint=(0,Ki.gs)(),this._beginScenePoint=(0,nn.vt)(),this._screenPickPoint=(0,Ki.gs)(),this._scenePickPoint=(0,nn.vt)(),this._navMode=hp.Horizontal,this._sphere=(0,Su.c)(),this._pointerCount=0,this._tmpInteractionDirection=(0,nn.vt)(),this._beginCamera=new id.A,this._constraintOptions=new Mu(bu.ALL,wu.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-Fd.wf.normalize((0,ws.kU)(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),(0,Ki.WA)(e.center,this._screenPickPoint),(0,ma.C)(this._beginScreenPoint,this._screenPickPoint);const t=(0,pa.tO)(this.view.spatialReference),r=mp(this._intersectionHelper,this.startCamera,this._screenPickPoint,t,Xd.Silhouette,0===this.view.map.ground.opacity?ep:{});null!=r.scenePickPoint&&(this._scenePickPoint=r.scenePickPoint,this._sphere=r.sphere,(0,da.c)(this._beginScenePoint,this._scenePickPoint),this._navMode=gp(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===hp.Vertical&&this._preparePlanarPanMode(e,r.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this._navMode===hp.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return this._navMode===hp.Horizontal?new mg({view:this.view,momentum:t,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new fg({view:this.view,momentum:t,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new pg({view:this.view,momentum:r,center:(0,Su.g)(this._sphere),axis:this._rotationAxis});if(this._navMode===hp.Horizontal){const e=this._panSphericalMomentumEstimator.evaluateMomentum();if(e)return new dg({view:this.view,momentum:e})}else{const e=this._panPlanarMomentumEstimator.evaluateMomentum();if(e)return new lg({view:this.view,momentum:e})}return null}_preparePlanarPanMode(e,t){const r=(0,da.k)(this._tmp3d,this.startCamera.viewForward);(0,$d.O_)(this._scenePickPoint,r,this._panningPlane);const i=(0,Ki.gs)(this._screenPickPoint[0],0),n=(0,nn.vt)(),s=(0,da.l)(this.startCamera.eye);this._adjustedSphere[3]=s<this._sphere[3]?s-100:this._sphere[3],vp(this._adjustedSphere,this.startCamera,i,n);const o=(0,Ki.r_)();this.startCamera.projectToRenderScreen(n,o);const a=(0,nn.vt)(),l=(0,nn.vt)(),c=(0,nn.vt)();(0,da.f)(a,this._scenePickPoint,this.currentCamera.eye);const u=(0,da.l)(a);(0,da.n)(a,a);const h=5*Math.max(Math.abs(this.view.camera.position.z),50),d=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,80);let p=null!=d?d:h;p=t?Math.min(p,u):p,(0,da.c)(c,(0,da.g)(l,this.currentCamera.eye,(0,da.j)(l,a,p))),this._panningPlane[3]=-(0,da.m)((0,$d.Qj)(this._panningPlane),c),this.startCamera.center=(0,da.g)(l,this.startCamera.eye,(0,da.j)(l,this.startCamera.viewForward,p));const f=(0,Ki.WA)(e.center,this._tmpScreenPointArray);np(this._panningPlane,this.startCamera,f,this._beginScenePoint)}_zoomSpherical(e){const t=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(t),op(this._sphere,this.currentCamera,this._smoothScaling.value),(0,Ki.WA)(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=wu.ZOOM,this._constraintOptions.interactionFactor=Bh(e.radius-this._beginRadius),Vh(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const t=(0,Ki.WA)(e.center,this._tmpScreenPointArray);vp(this._sphere,this.currentCamera,t,this._tmp3d),Rp(this._beginScenePoint,(0,da.m)(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(Op(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(Pp(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=wu.PAN,this._constraintOptions.interactionFactor=Bh((0,ma.Io)(this._screenPickPoint,t)),Vh(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){(0,da.n)(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||(0,da.k)(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value,r=t+rp(e.angle-t),i=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=i,this._smoothRotation.update(r);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),ip(this.currentCamera,(0,Su.g)(this._sphere),jd(this._rotationAxis,n)),this._constraintOptions.interactionType=wu.TUMBLE,this._constraintOptions.interactionFactor=Bh(e.radius*r),Vh(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const t=(0,Ki.WA)(e.center,this._tmpScreenPointArray);np(this._panningPlane,this.currentCamera,t,this._tmp3d)&&(yp(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(t,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=wu.PAN,this._constraintOptions.interactionFactor=Bh((0,ma.Io)(this._beginScreenPoint,t)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Vh(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(t),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),sp(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=wu.ZOOM,this._constraintOptions.interactionFactor=Bh(e.radius-this._beginRadius),Vh(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){(0,da.c)(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||(0,da.k)(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value;let r=e.angle-t;r=rp(r);const i=t+r,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(i);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),ip(this.currentCamera,(0,Su.g)(this._sphere),jd(this._rotationAxis,s)),this._constraintOptions.interactionType=wu.TUMBLE,this._constraintOptions.interactionFactor=Bh(e.radius*s),Vh(this.view,this.currentCamera,this._constraintOptions)}};Eg=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],Eg);const Rg=(0,nn.fA)(0,0,1);let Pg=class extends Am{constructor(){super(...arguments),this._rotationValueSmooth=new og(.05),this._scalingValueSmooth=new og(.05),this._planeHorizontal=(0,$d.vt)(),this._planeVertical=(0,$d.vt)(),this._rotationMomentumEstimator=new Mg,this._panMomentumEstimator=new vg(300,12,.9),this._zoomMomentumEstimator=new Cg,this._beginRadius=0,this._beginCenter=(0,nn.vt)(),this._beginAngle=0,this._tmpPoints=[],this._navMode=hp.Horizontal,this._beginCenterScreen=(0,Ki.gs)(),this._tmpCentroid3d=(0,nn.vt)(),this._tmpCentroid2d=(0,Ki.gs)(),this._tmp2d=(0,Ki.gs)(),this._pointerCount=0,this._beginCamera=new id.A,this._constraintOptions=new Mu(bu.ALL,wu.NONE,0,this._beginCamera)}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panMomentumEstimator.enabled=t,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),(0,Ki.WA)(e.center,this._beginCenterScreen),(0,$d.UB)(Rg,0,this._planeHorizontal);const r=(0,nn.vt)(),i=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,0===this.view.map.ground.opacity?ep:{}),n=(0,nn.vt)();(0,da.k)(n,this.startCamera.viewForward);const s=(0,nn.vt)();(0,da.c)(s,Rg);const o=(0,da.m)(n,s);this._navMode=gp(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);const a=Math.min(5,1/Math.abs((0,da.m)(s,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),50);(0,$d.mP)(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||(0,$d.ze)(this._planeHorizontal,this._planeHorizontal);const l=(0,nn.vt)(),c=(0,nn.vt)(),u=(0,nn.vt)();(0,da.f)(l,r,this.currentCamera.eye);const h=(0,da.l)(l);if((0,da.n)(l,l),this._navMode===hp.Vertical){(0,da.j)(s,s,o),(0,da.f)((0,$d.Qj)(this._planeVertical),n,s),(0,da.n)((0,$d.Qj)(this._planeVertical),(0,$d.Qj)(this._planeVertical)),(0,$d.mP)(this._planeVertical,this._planeVertical,r);const t=this.view._stage.renderView.getMinimalDepthForArea((0,nf.ds)(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,80);let d=null!=t?t:a;d=i?Math.min(d,h):d,(0,da.c)(u,(0,da.g)(c,this.currentCamera.eye,(0,da.j)(c,l,d))),this._planeVertical[3]=-(0,da.m)((0,$d.Qj)(this._planeVertical),u),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),lp(this._tmpPoints,this._beginCenter)}else{const t=i?h:a;(0,da.c)(u,(0,da.g)(c,this.currentCamera.eye,(0,da.j)(c,l,t))),this._planeHorizontal[3]=-(0,da.m)((0,$d.Qj)(this._planeHorizontal),u),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),lp(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,r=this._navMode===hp.Horizontal?this._planeHorizontal:this._planeVertical,i=this._beginCenter;if(t){const t=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=r,this._scalingValueSmooth.update(t),sp(this.currentCamera,i,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=wu.ZOOM,this._constraintOptions.interactionFactor=Bh(Math.abs(e.radius-this._beginRadius)),Vh(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),lp(this._tmpPoints,this._tmpCentroid3d),(0,Ki.WA)(e.center,this._tmpCentroid2d),yp(this.currentCamera,i,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=wu.PAN,this._constraintOptions.interactionFactor=Bh((0,ma.Io)(this._beginCenterScreen,this._tmpCentroid2d)),Vh(this.view,this.currentCamera,this._constraintOptions),t){const t=i,r=this._rotationValueSmooth.value,n=r+rp(e.angle-r),s=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=s,this._rotationValueSmooth.update(n);const o=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp);const a=(0,$d.Qj)(this._planeHorizontal);ip(this.currentCamera,t,jd(a,o)),this._constraintOptions.interactionType=wu.TUMBLE,this._constraintOptions.interactionFactor=Bh(Math.abs(e.radius*o)),Vh(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return new fg({view:this.view,momentum:t,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new pg({view:this.view,momentum:r,center:this._beginCenter,axis:(0,$d.Qj)(this._planeHorizontal)});const i=this._panMomentumEstimator.evaluateMomentum();return i?new lg({view:this.view,momentum:i}):null}_computePlanePoints(e,t,r,i){i.length=e.size;const n=this._tmp2d;let s=0;return e.forEach((e=>{n[0]=e.x,n[1]=e.y,void 0===i[s]&&(i[s]=(0,nn.vt)()),np(t,r,n,i[s]),s+=1})),i}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};Pg=(0,ze._)([(0,tt.$)("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],Pg);class Og extends cf.l{constructor(e,t,r){super(!0),this._view=e,this.pointerAction=t,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,(e=>this._handleDrag(e)))}_handleDrag(e){if("mouse"===e.data.pointerType&&!uf(e.data,this.pointerAction))return;const t=e.timestamp-this._lastEndTimestamp,r=this._momentum&&this._momentum.active&&t<40;switch(e.data.action){case"start":case"update":if(r)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,t){if(this._controller?.active){this._lastEndTimestamp=e.timestamp;const r=this._controller.end(e.data);t&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new Eg({view:this._view}):new Pg({view:this._view})}}class Ig extends cf.l{constructor(e,t){super(!0),this.view=e,this.registerIncoming("pointer-down",t,(()=>this.view.state.stopActiveCameraController()))}}class Lg extends cf.l{constructor(e,t){super(!0),this.key=e,this.registerIncoming("key-down",t,(e=>this._handleKeyDown(e)))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}}class Ng extends Lg{constructor(e,t,r){super(t,r),this.view=e}activate(){this.view.goTo({heading:0}).catch((()=>{}))}}class Dg extends Lg{constructor(e,t,r){super(t,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch((()=>{}))}}class Fg extends cf.l{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(!0),this._view=e,this._invert=t,this.registerIncoming("vertical-two-finger-drag",(e=>this._handleTwoFinger(e)))}_handleTwoFinger(e){const t=this._invert?-1:1,r=(0,Ki.gs)(0,e.data.delta*t);switch(e.data.action){case"begin":this._cameraController?.end(),this._cameraController=new Em({view:this._view,pivot:Cm.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController?.update(r);break;case"end":this._cameraController?.end(),this._cameraController=null}}}function kg(e){const t=e.native;return t?{buttons:t.buttons.map((e=>e.pressed?e.value||1:0)),axes:t.axes.map((t=>function(e,t){const r=Math.abs(e);return r<t?0:Math.sign(e)*(r-t)/(1-t)}(t,e.axisThreshold)))}:{buttons:[],axes:[]}}class zg{constructor(e,t){this._element=e,this._input=t,this._hasEventListeners=!1,this._onConnectGamepad=e=>{this._connectGamepad(e.gamepad)},this._onDisconnectGamepad=e=>{const t=e.gamepad,r=t.index,i=this._inputDevices[r];i&&(this._emitGamepadEvent(t,kg(i),!1),this._inputDevices.splice(r,1),this._latestUpdate.splice(r,1),this._input.gamepad.devices.remove(i),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,i=window.isSecureContext;this.supported=r&&i,this.supported&&(Vg((e=>this._connectGamepad(e))),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const t=new Ls(e);"unknown"!==t.deviceType&&(this._inputDevices[e.index]=t,this._input.gamepad.devices.add(t)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){null==this._frameTask&&(this._frameTask=(0,Ji.mg)({update:()=>this._readGamepadState()}))}_stopPolling(){null!=this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),t=this._element.contains(document.activeElement),r="document"===this._input.gamepad.enabledFocusMode&&!e||"view"===this._input.gamepad.enabledFocusMode&&!t;Vg((e=>{const t=this._inputDevices[e.index];if(!t)return;const i=this._latestUpdate[e.index],n=kg(t),s=r||function(e){for(let t=0;t<e.axes.length;t++)if(0!==e.axes[t])return!1;for(let t=0;t<e.buttons.length;t++)if(0!==e.buttons[t])return!1;return!0}(n);if(i){if(i.timestamp===e.timestamp)return;if(!i.active&&s)return;if(function(e,t){if(e.axes.length!==t.axes.length)return!1;if(e.buttons.length!==t.buttons.length)return!1;for(let r=0;r<e.axes.length;r++)if(e.axes[r]!==t.axes[r])return!1;for(let r=0;r<e.buttons.length;r++)if(e.buttons[r]!==t.buttons[r])return!1;return!0}(i.state,n))return}this._emitGamepadEvent(e,n,!s)}))}_emitGamepadEvent(e,t,r){const i=this._latestUpdate[e.index],n=i&&i.active;if(!n&&!r)return;const s=!n&&r?"start":n&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:t,action:s})}}function Ug(e){if(!e)return!1;if(!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}function Vg(e){const t=window.navigator.getGamepads();for(let r=0;r<t.length;r++){const i=t[r];Ug(i)&&e(i)}}const Bg=(0,it.A)("edge"),jg=(0,it.A)("chrome"),Hg=(0,it.A)("ff"),Gg=(0,it.A)("safari"),Zg="esri-view-surface",$g={touchNone:`${Zg}--touch-none`,touchPan:`${Zg}--touch-pan`};class qg{constructor(e,t){this._input=t,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new zg(e,this._input),this._gamepadSource.onEvent=e=>this._callback("gamepad",e)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach((e=>{this._releasePointerCaptureSafe(e)})),this._gamepadSource=(0,Je.pR)(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const t in this._active)if(!e||!e.has(t)){const e=this._active[t];this._element.removeEventListener(Wg[t],e),delete this._active[t]}e&&e.forEach((e=>{if(!this._active[e]&&Wg[e]){const t=(this._eventHandlers[e]||this._handleDefault).bind(this,e);this._element.addEventListener(Wg[e],t),this._active[e]=t}})),this._gamepadSource.hasEventListeners=e?.has("gamepad")??!1}setPointerCapture(e,t){t?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?$g.touchNone:$g.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?$g.touchPan:$g.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove($g.touchNone),this._element.classList.remove($g.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch(t){}}_updateNormalizedPointerLikeEvent(e,t){const r=(0,xs.Uo)(this._element,e);return qg.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),t.x=r.x,t.y=r.y,t}_handleKey(e,t){const{key:r}=t;r&&"key-up"===e&&this._keyDownState.delete(r);const i={native:t,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&"key-down"===e&&this._keyDownState.add(i.key),this._callback(e,i)}_handlePointer(e,t){const r=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,t){const r=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,r)}_handleMouseWheel(e,t){let r=t.deltaY;switch(t.deltaMode){case 0:Bg&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}Bg?r*=.7:jg||Gg?r*=.6:Hg&&(r*=1.375);const i=Math.abs(r);if(i>100){const e=.02;r=r/i*200/(1+Math.exp(-e*(i-100)))}const n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:r});this._callback(e,n)}_handlePointerCaptureLost(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)}_handleDefault(e,t){const r={native:t};t.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){"Alt"===e.key&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}}qg.test={disableSubpixelCoordinates:!1};const Wg={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class Yg extends cf.l{constructor(){super(!0),this.registerIncoming("context-menu",(e=>{e.data.native.preventDefault()}))}}const Xg=300,Jg=1.5,Kg=6,Qg=6,ey=500,ty=250,ry=10,iy=350,ny=35;function sy(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function oy(e){const{native:t}=e,{pointerId:r,button:i,pointerType:n}=t;return"mouse"===n?`${r}:${i}`:`${n}`}class ay extends cf.l{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,t,r,i){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:t.buttons,timestamp:i,pointers:uy(this._activePointerMap),pointer:t,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const t=e.native.pointerId,r=cy(this._activePointerMap).angle,i={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(t,i);const n=hy(i,ly(this._activePointerMap));i.initialAngle=n,i.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(e){if(e&&null==e.x&&null==e.y)return;const t=e.native.pointerId,r=this._activePointerMap.get(t);r?r.event=e:this._addPointer(e)}_removePointer(e){const t=cy(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(t)}_updatePointerAngles(e){const t=cy(this._activePointerMap);this._activePointerMap.forEach((r=>{r.initialAngle=hy(r,t)-e,r.lastAngle=hy(r,t)-e}))}_emitEvent(e,t,r){const i=cy(this._activePointerMap);this._drag.emit(this._createPayload(e,t,i,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const t=e.data.native.pointerId,r=(0,ql.l5)(e.timestamp);this._activePointerMap.get(t)&&(1===this._activePointerMap.size?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(t)):(this._removePointer(t),this._emitEvent("removed",e.data,(0,ql.l5)(e.timestamp))))}_handlePointerDrag(e){const t=e.data,r=t.currentEvent,i=(0,ql.l5)(e.timestamp);switch(t.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,i)):(this._addPointer(r),this._emitEvent("added",r,i),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,i))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&"touch"===this._pointerType&&1===this._activePointerMap.size}}function ly(e){const t=[];return e.forEach((e=>{t.push((0,Ki.tc)(e.event.x,e.event.y))})),function(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:(0,Ki.tc)()},0===e.length)return t;if(1===e.length)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(2===e.length){const[r,i]=e,[n,s]=[i.x-r.x,i.y-r.y];return t.radius=Math.sqrt(n*n+s*s)/2,t.center.x=(r.x+i.x)/2,t.center.y=(r.y+i.y)/2,t}let r=0,i=0;for(let v=0;v<e.length;v++)r+=e[v].x,i+=e[v].y;r/=e.length,i/=e.length;const n=e.map((e=>e.x-r)),s=e.map((e=>e.y-i));let o=0,a=0,l=0,c=0,u=0,h=0,d=0;for(let v=0;v<n.length;v++){const e=n[v],t=s[v],r=e*e,i=t*t;o+=r,a+=i,l+=e*t,c+=r*e,u+=i*t,h+=e*i,d+=t*r}const p=.5*(c+h),f=.5*(u+d),m=o*a-l*l,g=(p*a-f*l)/m,y=(o*f-l*p)/m,_=(0,Ki.tc)(g+r,y+i);return{radius:Math.sqrt(g*g+y*y+(o+a)/e.length),center:_}}(t)}function cy(e){const t=ly(e);let r=0;return e.forEach((e=>{let i=hy(e,t),n=i-e.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;i=e.lastAngle+n,e.lastAngle=i;const s=i-e.initialAngle;r+=s})),r/=e.size||1,{angle:r,radius:t.radius,center:t.center}}function uy(e){const t=new Map;return e.forEach(((e,r)=>t.set(r,e.event))),t}function hy(e,t){const r=e.event,i=r.x-t.center.x,n=r.y-t.center.y;return Math.atan2(n,i)}var dy;!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"}(dy||(dy={}));class py extends cf.l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ty,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ry,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:iy,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ny,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ms.p;super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=i,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach((e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()})),super.onUninstall()}_handlePointerDown(e){const t=e.data,r=oy(t);if(!this._pointerState.has(r)){const e={downButton:t.native.button,x:t.x,y:t.y,immediateDoubleClick:null};this._pointerState.set(r,e),this.startCapturingPointer(t.native)}}_handlePointerUp(e){const t=e.data,r=oy(t),i=this._pointerState.get(r);if(i&&i.downButton===t.native.button){const r=i.immediateDoubleClick,n="touch"===e.data.native.pointerType?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;r?(r.timeoutHandle.remove(),sy(r,e.data)>n?this._startImmediateDoubleClick(e,i):(this._immediateDoubleClick.emit(e.data,void 0,r.modifiers),this._removeState(t))):sy(i,e.data)>n?this._removeState(t):this._startImmediateDoubleClick(e,i)}}_startImmediateDoubleClick(e,t){const r="touch"===e.data.native.pointerType?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout((()=>this._removeState(e.data)),r)}}_removeState(e){const t=oy(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}}class fy extends cf.l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xg,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Jg,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Kg,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Qg,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ey,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ms.p;super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=t,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=i,this._holdDelay=n,this._clock=s,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(e=>{this._handlePointerLoss(e,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(e=>{this._handlePointerLoss(e,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(e=>{this._handlePointerLoss(e,"pointer-cancel")})),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach((e=>{e.holdTimeout=(0,Je.xt)(e.holdTimeout)})),super.onUninstall()}_handlePointerDown(e){const t=e.data,r=t.native.pointerId;let i=null;0===this._pointerState.size&&(i=this._clock.setTimeout((()=>{const t=this._pointerState.get(r);if(t){if(!t.isDragging){const r=t.previousEvent;this._pointerHold.emit(r,void 0,e.modifiers),t.holdEmitted=!0}t.holdTimeout=null}}),this._holdDelay));const n={startEvent:t,previousEvent:t,startTimestamp:e.timestamp,isDragging:!1,downButton:t.native.button,holdTimeout:i,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(t.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const t=e.data,r=t.native.pointerId,i=this._pointerState.get(r);i&&(i.isDragging?this._pointerDrag.emit(my("update",i,t),void 0,i.modifiers):function(e,t){const r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}(t,i.startEvent)>this._getDragThreshold(t.native.pointerType)&&this._startDragging(e),i.previousEvent=t)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const t=e.data,r=t.native.pointerId;this._pointerState.forEach((i=>{null!=i.holdTimeout&&(i.holdTimeout.remove(),i.holdTimeout=null),i.isDragging||(i.modifiers=e.modifiers,i.isDragging=!0,r===i.startEvent.native.pointerId?this._pointerDrag.emit(my("start",i,t)):this._pointerDrag.emit(my("start",i,i.previousEvent),e.timestamp))}))}_handlePointerLoss(e,t){const r=e.data,i=r.native.pointerId,n=this._pointerState.get(i);n&&(null!=n.holdTimeout&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(my("end",n,"pointer-up"===t?r:n.previousEvent),void 0,n.modifiers):"pointer-up"===t&&n.downButton===r.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(i),this.stopCapturingPointer(r.native),0===this._pointerState.size&&this._moveHandle.pause())}}function my(e,t,r){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:r}}class gy extends cf.l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ty,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ry,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:iy,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ny,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ms.p;super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=i,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach((e=>e.doubleClickTimer=(0,Je.xt)(e.doubleClickTimer)))}get hasPendingInputs(){return(0,Yn.Bs)(this._pointerState,(e=>null!=e.doubleClickTimer))}_clearDoubleClickTimer(e,t){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=(0,Je.xt)(r.doubleClickTimer),t&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const t=this._pointerState.get(e);1===t.pointerDownCount&&this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const t=e.data,{pointerType:r}=t.native,i=function(e){const{pointerId:t,pointerType:r,button:i}=e.native;return"mouse"===r?`${t}:${i}`:`${r}`}(t);if(!this._pointerState.has(i))return void this._startClick(e);const n=this._pointerState.get(i),{data:s,modifiers:o}=n.event,a="touch"===r?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;sy(s,t)>a?(this._clearDoubleClickTimer(i,!0),this._startClick(e)):(this._clearDoubleClickTimer(i,!1),2===n.pointerDownCount&&this._doubleClick.emit(s,void 0,o))}_handlePointerDown(e){const t=oy(e.data),r=this._pointerState.get(t);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:t}=e,{native:{pointerType:r}}=t,i=oy(t),n="touch"===r?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,s=this._clock.setTimeout((()=>this._doubleClickTimeoutExceeded(i)),n);this._pointerState.set(i,{event:e,doubleClickTimer:s,pointerDownCount:1}),this.refreshHasPendingInputs()}}class yy{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const t=e.data,r=t.pointers.size;switch(t.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){this._startEvent=e,this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}}class _y extends cf.l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40;super(!1),this._threshold=e,this._maxDelta=t,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new yy({start:(e,t)=>this._observeStart(e,t),update:(e,t,r)=>this._observeUpdate(e,t,r),end:(e,t)=>this._observeEnd(t)}),this.registerIncoming("drag",(e=>this._dragEventSeparator.handle(e)))}get failed(){return"failed"===this._state}_observeStart(e,t){1===e&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center}),t.stopPropagation()),this._state=2===e?"ready":"failed"}_observeUpdate(e,t,r){if("failed"!==this._state&&2===e)return"active"===this._state?(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void t.stopPropagation()):void(this._checkMovementWithinLimits(t.data,r.data)?this._checkVerticalThresholdReached(t.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=t.data.center,this._artificalDrag.emit({action:"end",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center}),this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),t.stopPropagation()):this._state="failed")}_observeEnd(e){"active"===this._state&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,t){let r=-1/0,i=1/0,n=-1/0,s=1/0;for(const{x:f,y:m}of t.pointers.values())r=Math.max(r,f),i=Math.min(i,f),n=Math.max(n,m),s=Math.min(s,m);let o=-1/0,a=1/0,l=-1/0,c=1/0;for(const{x:f,y:m}of e.pointers.values())o=Math.max(o,f),a=Math.min(a,f),l=Math.max(l,m),c=Math.min(c,m);const u=r-i,h=n-s,d=o-a,p=l-c;return Math.abs(e.center.x-t.center.x)<this._threshold&&Math.abs(d-u)<=this._maxDelta&&Math.abs(p-h)<=this._maxDelta}_checkVerticalThresholdReached(e,t){let r=Math.abs(e.center.y-t.center.y);return e.pointers.forEach(((e,i)=>{const n=t.pointers.get(i);r=Math.min(r,Math.abs(e.y-n.y))})),r>=this._threshold}}let vy=class extends ht.A{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){"pan"!==e&&"rotate"!==e||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){"default"!==e&&"pro"!==e||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=(0,Je.pR)(this._inputManager)}connect(){const e=this.view;this._source=new qg(this.view.surface,e.input);const t=[new py,new fy,new gy,new ay(this.view.navigation),new _y],r=new zn.e({eventSource:this._source,recognizers:t});this._inputManager=r,r.installHandlers("prevent-context-menu",[new Yg],zn.o.INTERNAL),this._modeDragPan=new Og(e,"primary"),this._modeDragRotate=new Om(e,"secondary",Cm.CENTER),this._modeDragZoom=new zm(e,"tertiary");const i="b",n={left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},s="n",o="p";r.installHandlers("navigation",[new Ig(e),new hf(e),new rg(e),new ng(e,n),new sg(e),new Dg(e,o),new Ng(e,s),new Om(e,"primary",Cm.EYE,[i]),new Om(e,"secondary",Cm.CENTER,[i]),new Og(e,"tertiary",[i]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Fg(e)],zn.o.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this.addHandles((0,gt.wB)((()=>this.view.navigation?.browserTouchPanEnabled),(e=>{this._source.browserTouchPanningEnabled=!e}),gt.Vh))}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}_updateMode(){const e=this.mode,t=this.primaryDragAction,r=by.get(e)?.get(t);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){}};(0,ze._)([(0,Qe.MZ)()],vy.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({value:"pan"})],vy.prototype,"primaryDragAction",null),(0,ze._)([(0,Qe.MZ)({value:"default"})],vy.prototype,"mode",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],vy.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)()],vy.prototype,"latestPointerType",null),(0,ze._)([(0,Qe.MZ)()],vy.prototype,"latestPointerLocation",null),(0,ze._)([(0,Qe.MZ)()],vy.prototype,"multiTouchActive",null),(0,ze._)([(0,Qe.MZ)()],vy.prototype,"_inputManager",void 0),vy=(0,ze._)([(0,tt.$)("esri.views.3d.input.SceneInputManager")],vy);const by=new Map,wy=new Map,xy=new Map;wy.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),wy.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),xy.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),xy.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),by.set("default",wy),by.set("pro",xy);const Sy=vy;var Ty=r(30015),My=r(22955);let Ay,Cy,Ey=!1,Ry=!1,Py=!1,Oy=!1,Iy=null;function Ly(e){Py=My.b.DECONFLICTOR_SHOW_VISIBLE,Oy=My.b.DECONFLICTOR_SHOW_INVISIBLE,Ey=Py||Oy,Ry=My.b.DECONFLICTOR_SHOW_GRID,Iy=null,Ey||Ry?Iy=()=>function(e){null==Ay&&(Ay=document.createElement("canvas"),Ay.setAttribute("id","debugCanvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(Ay));const{state:t}=e,{camera:r,pixelRatio:i}=t,{width:n,height:s}=r,o=n*i,a=s*i;Ay.setAttribute("width",`${o}px`),Ay.setAttribute("height",`${a}px`),Ay.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),Cy=Ay.getContext("2d"),Cy.clearRect(0,0,n,s),Cy.font="12px Arial"}(e):Ay&&(Ay.parentElement.removeChild(Ay),Ay=null)}function Ny(){Iy&&(Iy(),Iy=null)}function Dy(e,t,r,i,n){Ny();const s=Ay.height,o=Cy;o.beginPath(),o.lineWidth=1,o.strokeStyle=n,o.moveTo(e,s-r),o.lineTo(t,s-r),o.stroke(),o.lineTo(t,s-i),o.stroke(),o.lineTo(t,s-r),o.stroke(),o.lineTo(e,s-r),o.stroke(),o.lineTo(e,s-r),o.stroke(),o.closePath()}function Fy(e,t){Ey&&(t&&Py||!t&&Oy)&&Dy(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var ky=r(89422),zy=r(12028),Uy=r(84248),Vy=r(96791);const By=(0,nn.vt)(),jy=(0,ya.vt)(),Hy=(0,ya.vt)(),Gy=(0,nn.vt)(),Zy=(0,qa.vt)(),$y=(0,Su.c)(),qy=(0,Tu.vt)(),Wy=(0,nn.vt)(),Yy=(0,un.vt)();class Xy{constructor(){this.aabr=(0,un.vt)(),this.distance=0,this.culled=!1,this.visible=!1}}class Jy{constructor(e,t){this.graphics3DGraphic=e,this.slicePlaneEnabled=t,this.info={}}}var Ky;!function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"}(Ky||(Ky={}));class Qy{constructor(){this.camera=new id.A,this.slicePlane=(0,hn.a)(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),(0,hn.c)(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let e_=class extends ht.A{get dirty(){return this._dirty}get state(){return this._state}constructor(e){super(e),this._dirty=!1,this._viewState=new Qy,this._state=Ky.Idle,this._active=new Map,this._visible=new Map,this._iterators=new i_,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Ky.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/Ky.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&null!=this.view.state&&this.updating}runTask(e){switch(this._state){case Ky.Idle:this._startUpdate(),e.madeProgress();case Ky.Process:if(this._state=Ky.Process,!this._processActiveGraphics(e))return;case Ky.Sort:if(this._state=Ky.Sort,!this._sortVisibleGraphics(e))return;case Ky.Deconflict:if(this._state=Ky.Deconflict,!this._deconflictVisibleGraphics(e))return;default:(function(e,t){if(!Ry||!Cy)return;Ny();const r=Cy;let i=0;for(let n=0;n<e.accBinsNumX;n++)for(let t=0;t<e.accBinsNumY;t++){const s=e.accBins[n][e.accBinsNumY-1-t];i+=s.length;const o=n*e.accBinsSizeX,a=(n+1)*e.accBinsSizeX,l=t*e.accBinsSizeY,c=(t+1)*e.accBinsSizeY;r.fillText(s.length.toFixed(),o+5,l+15),Dy(o,a,l,c,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+t.size,70,50),r.fillText("total numTests: "+e.accNumTests,70,30)})(this,this._visible),this._state=Ky.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach((e=>this.addToActiveGraphics(e))):e.forEach((e=>this.removeFromActiveGraphics(e))),this.setDirty()}layerSupportsDeconfliction(e){if(null==e||"object3d"!==e.type)return!1;const t=e.stageObject;if(1!==(t?.geometries.length??0))return!1;const r=t?.geometries[0],i=r?.material;return i instanceof Uy.R}_startUpdate(){Ly(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._viewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new Xy,this._active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._visible.delete(e.graphics3DGraphic.graphic.uid),function(e,t){const r=e.graphics3DGraphic;r.destroyed||r.setVisibilityFlag(t,ky.Z.DECONFLICTION,!0)}(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this._active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),r=(0,$a.Qw)(Zy,this._viewState.camera.projectionMatrix),i="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this._viewState.camera.relativeElevation>0?$y:null;let n=0;for(null!=i&&((0,da.h)((0,Su.g)(i),nn.uY,this._viewState.camera.viewMatrix),i[3]=(0,pa.tO)(this.view.spatialReference).radius,n=(0,Su.d)(i,nn.uY));!e.done;){e.madeProgress();const s=t.next();if(!0===s.done)return this._resetActiveGraphicsIterator(),!0;const o=s.value,a=o?.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,n),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const r=t.next();if(e.madeProgress(),!0===r.done)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===ky.u.LABEL;for(;!e.done;){e.madeProgress();const i=t.next();if(!0===i.done)return this._resetVisibleGraphicsIterator(),!0;const n=i.value,s=n.info[this.visibilityGroup];if(!s||s.culled){this._setGraphicVisibility(n,!1);continue}const o=n.graphics3DGraphic,a=!r||o.isVisible();s.visible=a&&!this._isConflicted(n),s.visible&&this._addToBins(n),this._setGraphicVisibility(n,s.visible),Fy(s,s.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=t_(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=t_(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=function*(e,t,r){t.clear(),e.forEach(((e,i)=>{const n=t.pushNew();n.id=i,n.visible=e.graphics3DGraphic.getVisibilityFlag(r,ky.Z.DECONFLICTION);const s=e.info?.[r];n.prio=e.graphics3DGraphic.deconflictionPriority,n.distance=s?s.distance:Number.MAX_VALUE})),yield;const i=t.iterableSort(((e,t)=>e.prio!==t.prio?t.prio-e.prio:e.distance!==t.distance?e.distance-t.distance:e.visible!==t.visible?e.visible?-1:1:e.id-t.id));for(let n=i.next();!n.done;n=i.next())yield;t.forAll((t=>{const r=e.get(t.id);r&&(e.delete(t.id),e.set(t.id,r))})),t.clear()}(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(e,t,r,i){const n=e.graphics3DGraphic;if(n.destroyed)return;const s=e.info[this.visibilityGroup];if(!n.isVisible(ky.u.GRAPHIC,ky.Z.DECONFLICTION))return void(s.culled=!0);const o=this.getGraphicsLayers(n);(0,un.Ie)(s.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const n=l.stageObject.geometries[0].material;if(null==a&&(a=o_,this._getProjectionInfo(l,t,a),a.isOutsideScreen||this._isCulledBySlice(e,By)||null!=r&&s_(a,r,i)))return void(s.culled=!0);this._expandBoundingRect(s,l,n,a)}null==a?s.culled=!0:(s.distance=a.distance,s.culled=!1)}_getProjectionInfo(e,t,r){const i=this._viewState.camera,n=e.stageObject,s=n.geometries[0],o=s.material,a=(0,Su.g)(n.boundingVolumeWorldSpace.bounds);(0,da.h)(By,a,i.viewMatrix);const l=s.attributes,c=l.get(El.r.NORMAL).data,u=l.get(El.r.CENTEROFFSETANDDISTANCE).data;o.applyShaderOffsetsView(By,c,n.transformation,u,i,r.scaleInfo,By),(0,ga.s)(jy,By[0],By[1],By[2],1),(0,ga.t)(Hy,jy,i.projectionMatrix),(0,da.j)(r.positionNDC,Hy,1/Hy[3]),o.applyShaderOffsetsNDC(r.positionNDC,u,i,r.positionNDC,Gy),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(Gy[2]),r.distance=Gy[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),(0,ga.s)(Hy,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),(0,ga.t)(jy,Hy,t),(0,ga.b)(jy,jy,1/jy[3]),(0,da.s)(r.positionView,By[0],By[1],By[2])}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&(0,hn.e)(this._viewState.slicePlane,t)}_expandBoundingRect(e,t,r,i){let{positionNDC:n,scaleInfo:s}=i;const o=this._viewState.camera,a=t.getScreenSize(n_);(0,zy.MD)(a,s.factor,a),a[0]*=o.pixelRatio,a[1]*=o.pixelRatio;const l=(0,un.cY)(r.calculateRelativeScreenBounds(a,s.factorAlignment.scale,Yy),(0,ws.Cc)(0,o.fullWidth,.5+.5*n[0]),(0,ws.Cc)(0,o.fullHeight,.5+.5*n[1])),c=this.marginFactor;if(0!==c){const e=c*Math.min((0,un.VL)(l),(0,un.uJ)(l));l[0]-=e,l[1]-=e,l[2]+=e,l[3]+=e}(0,un.fT)(e.aabr,l,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,r=e.info[this.visibilityGroup];let i=!0;for(let n=Math.floor(r.aabr[0]/this._accBinsSizeX);n<=Math.floor(r.aabr[2]/this._accBinsSizeX);n++)if(!(n<0||n>=this._accBinsNumX))for(let e=Math.floor(r.aabr[1]/this._accBinsSizeY);e<=Math.floor(r.aabr[3]/this._accBinsSizeY);e++){if(e<0||e>=this._accBinsNumY)continue;i=!1;const s=this._accBins[n][e];for(let e=0;e<s.length;e++){const i=s.data[e],n=i.info[this.visibilityGroup];if(n&&n.visible&&i.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,(0,un.HY)(n.aabr,r.aabr)))return!0}}return i}_initBins(e,t){if(null==this._accBins){this._accBins=[];for(let e=0;e<this._accBinsNumX;e++){this._accBins.push([]);const e=this._accBins[this._accBins.length-1];for(let t=0;t<this._accBinsNumY;t++)e.push(new Ty.A)}}else for(let r=0;r<this._accBinsNumX;r++)for(let e=0;e<this._accBinsNumY;e++)this._accBins[r][e].clear();this._accBinsSizeX=e/this._accBinsNumX,this._accBinsSizeY=t/this._accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],r=Math.floor(t.aabr[0]/this._accBinsSizeX),i=Math.floor(t.aabr[2]/this._accBinsSizeX),n=Math.floor(t.aabr[1]/this._accBinsSizeY),s=Math.floor(t.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let t=n;t<=s;t++)t<0||t>=this._accBinsNumY||this._accBins[o][t].push(e)}_setGraphicVisibility(e,t){const r=e.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(this.visibilityGroup,ky.Z.DECONFLICTION,t),this.visibilityGroup===ky.u.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,t))}};function*t_(e){if(Map.prototype.entries){const t=e.entries();for(let e=t.next();!e.done;e=t.next())yield e.value[1]}else yield*e.values()}(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],e_.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean,readOnly:!0})],e_.prototype,"updating",null),e_=(0,ze._)([(0,tt.$)("esri.views.3d.layers.graphics.Deconflictor")],e_);class r_{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class i_{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.active=e,this.visible=t,this.sort=r,this.sortArray=new Ty.A({allocator:e=>e||new r_})}}const n_=(0,va.vt)();function s_(e,t,r){return(0,da.c)(qy.direction,e.positionView),(0,da.s)(qy.origin,0,0,0),!!(0,Su.i)(t,qy,Wy)&&e.distanceWithoutPolygonOffset>r}const o_=new class{constructor(){this.positionView=(0,nn.vt)(),this.positionNDC=(0,nn.vt)(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new Vy.D}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}};let a_=class extends e_{constructor(e){super(e),this.visibilityGroup=ky.u.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return cl.G;const t=performance.now();if(e.state!==fm.M.IDLE&&t-this._lastDeconfliction<2e3)return cl.G;super.runTask(e),this.state===Ky.Idle&&(this._lastDeconfliction=t)}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],a_.prototype,"parent",void 0),a_=(0,ze._)([(0,tt.$)("esri.views.3d.layers.graphics.LabelDeconflictor")],a_);let l_=class extends e_{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=ky.u.GRAPHIC,this._marginFactor=-.1,this.test={overrideMarginFactor:e=>{this._marginFactor=e,this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([(0,gt.wB)((()=>this.view?.state?.camera),(()=>{this._updateViewState(),this.setDirty()})),(0,gt.wB)((()=>this.view?.map?.ground?.opacity),((e,t)=>{1!==e&&1!==t||this.setDirty()})),(0,gt.wB)((()=>this.view?.slicePlane),(()=>{this._updateSlicePlane(),this._slicePlaneChanged()}),gt.Vh)]),this._frameTask=this.view.resourceController.scheduler.registerTask(ll.W6.GRAPHICS_DECONFLICTOR,this),this._labels=new a_({view:this.view,parent:this})}destroy(){this._labels=(0,Je.pR)(this._labels),this._frameTask=(0,Je.xt)(this._frameTask)}get marginFactor(){return this._marginFactor}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;null!=e&&(0,hn.t)(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=null!=e}_slicePlaneChanged(){(0,Yn.Bs)(this._contexts,((e,t)=>t.symbolCreationContext.slicePlaneEnabled))&&this.setDirty()}addGraphicsOwner(e){const t=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,t,r),removeGraphic:e=>this._removeGraphic(t,e),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach((e=>this._removeGraphic(t,e.graphics3DGraphic))),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach((e=>this._removeGraphic(t,e.graphics3DGraphic))),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,r){const i=r.graphic.uid,n=new Jy(r,e.symbolCreationContext.slicePlaneEnabled);t.set(i,n),c_(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n);const s=!this._graphicSupportsDeconfliction(r)||!c_(e);r.setVisibilityFlag(ky.u.GRAPHIC,ky.Z.DECONFLICTION,s)}_removeGraphic(e,t){const r=t.graphic.uid,i=e.get(r);i&&(this.removeFromActiveGraphics(i),this._labels.removeFromActiveGraphics(i),e.delete(r),this.setDirty())}enabledChanged(e,t){const r=c_(e);r||function(e){const t=e.graphics3DGraphics;t&&t.forEach((e=>e.setVisibilityFlag(ky.u.GRAPHIC,ky.Z.DECONFLICTION,!0)))}(e),this.modifyGraphics(t,r)}_slicePlaneEnabledChanged(e,t){const r=e.symbolCreationContext.slicePlaneEnabled;t.forEach((e=>e.slicePlaneEnabled=r)),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.layers;if(!t?.length)return!1;for(const r of t)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const t=this._contexts.get(e);if(t)return t;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function c_(e){const t=e.layer;return!(!t?.featureReduction||"selection"!==t.featureReduction.type)}l_=(0,ze._)([(0,tt.$)("esri.views.3d.layers.graphics.GraphicsDeconflictor")],l_);var u_=r(6918),h_=r(90632),d_=r(33836),p_=r(45097),f_=r(3789),m_=r(98510),g_=r(45308),y_=r(482);var __=r(53574);class v_{constructor(e,t){this._renderCoordsHelper=e,this._getIsGroundOpaque=t,this._surfaceElevation=0,this._isGroundOpaque=!1,this._cache=new Map,this._frustumBoundingSphereCenter=(0,nn.vt)(),this._frustumBoundingSphereRadius=0,this._frustum=new Af.P(e),this._extendedFrustum=new Af.P(e),this._intersector=new __.O({renderCoordsHelper:e}),this._renderSR=e.spatialReference;const r=(0,m_.lO)(this._renderSR);this._renderSREllipsoidRadius=(0,pa.tO)(r).radius,this._renderCoordsHelper=e}begin(e,t){this._surfaceElevation=t,this._aboveGround=e.aboveGround,this._isGroundOpaque=this._getIsGroundOpaque(),this._frustum.update(e),R_(this._frustum),this._updateExtendedFrustum(e),this._updateFrustumBoundingSphere()}end(){this._cache.clear()}calculate(e){const t=this._renderCoordsHelper.viewingMode===$s.RT.Global&&e.lij[0]>=b_&&e.lij[0]<w_,r=this._getOrCalculateSingleTileVisibility(e,!t);return r!==d_.b.INVISIBLE&&t?this._calculateAggregatedChildrenVisibility(e):r}_calculateAggregatedChildrenVisibility(e){let t=d_.b.INVISIBLE;const r=this._cache.get(e.id);if(null!=r)return r;const i=E_.acquire();e.getChildren(i);for(const n of i){const e=this.calculate(n);if(e!==d_.b.INVISIBLE&&(t=e,e===d_.b.VISIBLE_ON_SURFACE))break}return E_.release(i),this._cache.set(e.id,t),t}_getOrCalculateSingleTileVisibility(e,t){const r=this._cache.get(e.id);if(null!=r)return r;const i=this._calculateSingleTileVisibility(e);return t&&this._cache.set(e.id,i),i}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===$s.RT.Global&&e.lij[0]<x_?this._calculateSingleTileVisibilitySided(e,!1)===d_.b.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_isTileVisibleInFrustum(e){return this._renderCoordsHelper.viewingMode===$s.RT.Local?this._isTileVisibleInFrustumLocal(e):this._isTileVisibleInFrustumGlobal(e)}_updateFrustumBoundingSphere(){const e=this._frustum,t=e.origin,r=Y_;(0,da.n)(r,e.direction);const i=e.points,n=X_;(0,da.z)(n,i[4],t);const s=.5*(0,da.m)(n,n)/(0,da.m)(r,n),o=this._frustumBoundingSphereCenter;(0,da.r)(o,t,r,s);const a=1+s;this._frustumBoundingSphereRadius=a}_isTileVisibleInFrustumLocal(e){const t=e.tilingScheme.spatialReference,r=e.extent,i=this._renderSR,n=U_;if(n[0]=r[0],n[1]=r[1],n[2]=0,n[3]=r[2],n[4]=r[3],n[5]=0,!(0,g_.projectBuffer)(n,t,0,n,i,0,2))return!1;const s=V_;(0,da.s)(s[0],n[0],n[1],0),(0,da.s)(s[1],n[3],n[1],0),(0,da.s)(s[2],n[3],n[4],0),(0,da.s)(s[3],n[0],n[4],0);const o=B_;(0,da.s)(o,.5*(n[0]+n[3]),.5*(n[1]+n[4]),.5*(n[2]+n[5]));const a=j_;(0,da.s)(a,0,0,1);const l=.5*(0,da.F)(s[0],s[2]),c=this._frustum,u=this._frustumBoundingSphereRadius,h=this._frustumBoundingSphereCenter,d=K_;(0,da.z)(d,h,o);const p=(0,da.m)(a,d),f=J_;if((0,da.r)(f,o,a,p),(0,da.F)(f,h)>l+u)return!1;const m=z_,g=this._isGroundOpaque&&this._aboveGround,y=this._isGroundOpaque&&!this._aboveGround,_=Math.min(y?xv:1/0,p+u),v=Math.max(g?-xv:-1/0,p-u);for(let b=0;b<4;++b)(0,da.r)(m[b],s[b],a,_),(0,da.r)(m[b+4],s[b],a,v);return!D_(c.planes,m,8)}_isTileVisibleInFrustumGlobal(e){const t=e.tilingScheme.spatialReference,r=e.extent,i=this._isGroundOpaque&&this._aboveGround,n=this._isGroundOpaque&&!this._aboveGround;if(e.lij[0]<F_)return!0;const s=V_,o=.5*(r[0]+r[2]);if((0,da.s)(s[0],r[0],r[1],0),(0,da.s)(s[1],r[2],r[1],0),(0,da.s)(s[2],r[2],r[3],0),(0,da.s)(s[3],r[0],r[3],0),(0,da.s)(s[4],o,r[1],0),(0,da.s)(s[5],o,r[3],0),!function(e,t,r,i,n,s){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;const a=(0,y_.jd)(t,n,y_.N9);if(null==a)return!1;if(a===y_.pO){if(e===i&&r===s)return!0;const t=r+o;for(let n=r,o=s;n<t;++n,++o)(0,da.c)(i[o],e[n]);return!0}const l=r+o;for(let c=r,u=s;c<l;++c,++u)a(e[c],0,i[u],0);return!0}(s,t,0,s,this._renderSR,0,6))return!1;const a=s[0][2]>0,l=s[3][2]<0,c=a||l,u=this._renderSREllipsoidRadius;if(c){const e=(0,nn.fA)(0,0,1),t=G_;P_(t,e,s[0]);const r=Z_;if(P_(r,e,s[1]),a){const i=H_,n=s[4],o=$_;P_(o,n,e),P_(i,o,n);const a=s[0];(0,da.b)(a,t,i),I_(a,u);const l=s[1];(0,da.b)(l,r,i),I_(l,u)}else if(l){const i=H_,n=s[5],o=$_;P_(o,n,e),P_(i,n,o);const a=s[3];(0,da.b)(a,i,t),I_(a,u);const l=s[2];(0,da.b)(l,i,r),I_(l,u)}}const h=B_;{const e=(0,da.z)(iv,s[3],s[0]);(0,da.n)(e,e);const t=(0,da.g)(nv,s[0],s[3]);(0,da.j)(t,t,.5);const r=-(0,da.m)(t,e),i=(0,da.g)(sv,s[0],s[1]);(0,da.j)(i,i,.5);const n=(0,da.g)(ov,s[2],s[3]);(0,da.j)(n,n,.5);const o=(0,da.z)(av,n,i);(0,da.n)(o,o);const a=-(r+(0,da.m)(e,i))/(0,da.m)(e,o);(0,da.r)(h,i,o,a),I_(h,u)}const d=this._frustumBoundingSphereRadius,p=this._frustumBoundingSphereCenter,f=this._frustum,m=f.planes,g=q_;(0,da.n)(g,h);const y=(0,da.m)(s[0],g)/(0,da.H)(s[0]),_=f.origin,v=f.points;let b=!1;if(i){{b=!0;const e=(0,da.n)((0,nn.vt)(),_);for(let t=0;t<4;++t){const r=v[4+t],i=(0,da.z)((0,nn.vt)(),r,_);(0,da.n)(i,i);const n=(0,da.b)((0,nn.vt)(),e,i);(0,da.n)(n,n);const s=(0,da.b)((0,nn.vt)(),i,n);if((0,da.n)(s,s),(0,da.m)(_,s)>u){b=!1;break}}}if(b&&(0,da.m)(_,g)<u*y-xv)return!1;const e=(0,da.n)(Sv,f.origin);if((0,da.m)(e,g)<0)return!1;{const e=(0,da.n)(Tv,f.direction);if((0,da.m)(e,g)>Mv)return!1}}const w=Math.sqrt(1-y*y);if(w>.9)return!0;let x=!1;{const e=(0,da.m)(g,p),t=(0,da.H)(p);if(t<=d&&!m.some((e=>(0,$d.mN)(e,Q_)>0))){if(!i)return!0;x=!0}const r=e/t;if(!x&&e<=0&&-e>d)return!1;const n=d/t;if(Math.sqrt(1-r*r)*Math.sqrt(1-n*n)-n*r>w)return!1}if(!b){if(s.some((e=>f.intersectsPoint(e))))return!0;if(f.intersectsPoint(h))return!0}const S=ev;(0,da.z)(S,p,Q_);const T=(0,da.m)(S,g),M=W_;(0,da.j)(M,g,T);const A=(0,da.F)(M,p),C=t.isWGS84,E=e.lij,R=C&&E[2]===2**E[0]-1,P=C&&0===E[2],O=P?yv:R?mv:pv,I=P?_v:R?gv:fv;if(!x){const e=s,t=vv,r=lv,i=cv,n=Q_;for(const s of O){const o=e[s];if(O_(r,e[(s+1)%4],o),O_(i,n,o),P_(t,i,r),k_(t,v,1))return!1}}let L=null;if(!i&&T<1.01*d){const e=2.5*d;if(A>y*e+d)return!1;const t=rv,r=e/y;for(let i=0;i<4;++i)(0,da.j)(t[i],s[i],r/u);(0,da.s)(t[4],0,0,0),L=t}else{const e=(n?u+xv:T+d)/y,t=i?u-xv:(T-d)/y,r=tv;for(let i=0;i<4;++i){const n=s[i];(0,da.j)(r[i],n,t/u),(0,da.j)(r[i+4],n,e/u)}L=r}if(D_(m,L,L.length))return!1;const N=f.lines,D=uv,F=hv;for(const k of N){(0,da.n)(F,k.direction);for(const e of I){const t=L[e];if((0,da.n)(D,t),wv(F,D,L,v))return!1;const r=(e+1)%4;if(i){const e=L[r];if((0,da.z)(D,e,t),(0,da.n)(D,D),wv(F,D,L,v))return!1}if(n){const t=L[4+e],i=L[4+r];if((0,da.z)(D,i,t),(0,da.n)(D,D),wv(F,D,L,v))return!1}}}return!0}_calculateSingleTileVisibilitySided(e,t){return this._isTileVisibleInFrustum(e)?(this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,t),this._intersector.isVisibleInFrustum(this._frustum,this._renderSREllipsoidRadius,!0)?d_.b.VISIBLE_ON_SURFACE:d_.b.VISIBLE_WHEN_EXTENDED):d_.b.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),R_(this._extendedFrustum);const t=this._renderCoordsHelper.worldUpAtPosition(e.eye,M_);this._aboveGround||(0,da.k)(t,t);const r=(0,ws.XM)(-(0,da.m)(t,e.viewForward));if(this._hasExtendedFrustum=r>e.fovY/2,!this._hasExtendedFrustum)return;const i=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let s=0;s<4;s++){const e=i.pointIndices[s],t=n[e],r=this._renderCoordsHelper.getAltitude(t);if(i.needsAltitudeAdjustment(r)){switch(this._renderCoordsHelper.worldUpAtPosition(t,M_),e){case Lf.J7.FAR_BOTTOM_LEFT:case Lf.J7.FAR_TOP_LEFT:case Lf.J7.NEAR_BOTTOM_LEFT:case Lf.J7.NEAR_TOP_LEFT:(0,$d.jb)(this._extendedFrustum.planes[Lf.FB.LEFT],M_,M_);break;case Lf.J7.FAR_BOTTOM_RIGHT:case Lf.J7.FAR_TOP_RIGHT:case Lf.J7.NEAR_BOTTOM_RIGHT:case Lf.J7.NEAR_TOP_RIGHT:(0,$d.jb)(this._extendedFrustum.planes[Lf.FB.RIGHT],M_,M_)}(0,da.j)(M_,M_,i.direction),this._renderCoordsHelper.intersectInfiniteManifold((0,Tu.LV)(t,M_),i.zWithMargin,t)}}if(this._extendedFrustum.updatePoints(n),(0,$d.Cr)(n[Lf.J7.NEAR_BOTTOM_LEFT],n[Lf.J7.NEAR_BOTTOM_RIGHT],n[Lf.J7.NEAR_TOP_RIGHT],A_),(0,$d.Cr)(n[Lf.J7.NEAR_BOTTOM_RIGHT],n[Lf.J7.NEAR_TOP_RIGHT],n[Lf.J7.NEAR_TOP_LEFT],C_),(0,da.m)((0,$d.Qj)(A_),(0,$d.Qj)(C_))<0){const e=this._extendedFrustum.mutablePoints;this._aboveGround?[e[Lf.J7.NEAR_BOTTOM_LEFT],e[Lf.J7.NEAR_BOTTOM_RIGHT]]=[e[Lf.J7.NEAR_BOTTOM_RIGHT],e[Lf.J7.NEAR_BOTTOM_LEFT]]:[e[Lf.J7.NEAR_TOP_LEFT],e[Lf.J7.NEAR_TOP_RIGHT]]=[e[Lf.J7.NEAR_TOP_RIGHT],e[Lf.J7.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(e)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-T_;return{zWithMargin:e,pointIndices:Af.P.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:t=>t>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+T_;return{zWithMargin:e,pointIndices:Af.P.planePointIndices.top,direction:1,needsAltitudeAdjustment:t=>t<e}}}const b_=2,w_=6,x_=12,S_=.95,T_=1,M_=(0,nn.vt)(),A_=(0,$d.vt)(),C_=(0,$d.vt)(),E_=new f_.A(Array,(e=>{4!==e.length&&(e[0]=new d_.J,e[1]=new d_.J,e[2]=new d_.J,e[3]=new d_.J)}),(e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()}));function R_(e){const t=Af.P.nearFarLineIndices,r=e.mutablePoints;for(const i of t){const[e,t]=i,n=r[e],s=r[t];(0,da.f)(M_,s,n),(0,da.j)(M_,M_,S_),(0,da.g)(r[t],n,M_)}e.updatePoints(r)}function P_(e,t,r){return(0,da.b)(e,t,r),(0,da.n)(e,e),e}function O_(e,t,r){return(0,da.z)(e,t,r),(0,da.n)(e,e),e}function I_(e,t){return(0,da.j)(e,e,t/(0,da.H)(e)),e}const L_=[Lf.FB.LEFT,Lf.FB.RIGHT,Lf.FB.BOTTOM,Lf.FB.TOP,Lf.FB.FAR];function N_(e,t,r){for(let i=0;i<r;++i)if((0,$d.mN)(e,t[i])<=0)return!1;return!0}function D_(e,t,r){for(const i of L_)if(N_(e[i],t,r))return!0;return!1}const F_=4;function k_(e,t,r){for(const i of t)if((0,da.m)(i,e)<r)return!1;return!0}const z_=[(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)()],U_=[0,0,0,0,0,0],V_=[(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)()],B_=(0,nn.vt)(),j_=(0,nn.vt)(),H_=(0,nn.vt)(),G_=(0,nn.vt)(),Z_=(0,nn.vt)(),$_=(0,nn.vt)(),q_=(0,nn.vt)(),W_=(0,nn.vt)(),Y_=(0,nn.vt)(),X_=(0,nn.vt)(),J_=(0,nn.vt)(),K_=(0,nn.vt)(),Q_=(0,nn.fA)(0,0,0),ev=(0,nn.vt)(),tv=[(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)()],rv=[(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)()],iv=(0,nn.vt)(),nv=(0,nn.vt)(),sv=(0,nn.vt)(),ov=(0,nn.vt)(),av=(0,nn.vt)(),lv=(0,nn.vt)(),cv=(0,nn.vt)(),uv=(0,nn.vt)(),hv=(0,nn.vt)(),dv=(0,nn.vt)(),pv=[0,1,2,3],fv=[0,1,2,3],mv=[0,1,3],gv=[0,1,3],yv=[1,2,3],_v=[1,2,3],vv=(0,nn.vt)();const bv=[0,0];function wv(e,t,r,i){if(0===r.length||0===i.length)return!0;const n=dv;P_(n,e,t);const s=i[0]<r[0],o=s?r:i,a=bv;return function(e,t,r){let i=1/0,n=-1/0;for(const s of r){const e=(0,da.m)(t,s);i=Math.min(i,e),n=Math.max(n,e)}e[0]=i,e[1]=n}(a,n,s?i:r),function(e,t,r,i){let n=1/0,s=-1/0;for(const o of i){const i=(0,da.m)(r,o);if(n=Math.min(n,i),s=Math.max(s,i),n<=t&&s>=e)return!1}return!0}(a[0],a[1],n,o)}const xv=430,Sv=(0,nn.vt)(),Tv=(0,nn.vt)(),Mv=Math.cos(.25*Math.PI);class Av{constructor(e){this._camera=new id.A,this._focusOnMap=[0,0],this._screenRect=(0,un.vt)(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new v_(e.renderCoordsHelper,e.getIsGroundOpaque)}begin(e,t,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=t.x,this._focusOnMap[1]=t.y,(0,un.fA)(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=(0,un.Io)(e.extent,this._focusOnMap),e.measures.visibility!==d_.b.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const t=Cv,r=1<<t,i=e.measures.screenRect;(0,un.Ie)(i);let n=0;const s=e.lij,o=s[0],a=o+t,l=s[1]<<t,c=s[2]<<t,u=this._tileSizeWithBias(e),h=u*u,d=this._camera,{frustum:p,viewport:f}=d;if(this._renderCoordsHelper.viewingMode===$s.RT.Local||o>F_){const t=Pv;this._tilingScheme.getExtent(s[0],s[1],s[2],t);const r=Rv,i=Fv,n=(0,un.Ie)();for(let e=0;e<4;++e)this._toRenderCoords(t,kv[e][0],kv[e][1],i[e]),d.projectToScreen(i[e],r[e]),(0,un.tK)(n,r[e]);const o=D_(p,i,4),a=n[0]>f[2]||n[1]>f[3]||n[2]<f[0]||n[3]<f[1];if(o||a)return void(e.measures.shouldSplit=!1)}for(let m=0;m<r;m++)for(let t=0;t<r;t++)if(n+=this._computeScreenArea(a,l+m,c+t,i),n>h)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===d_.b.VISIBLE_WHEN_EXTENDED?this._tileSize*Ev:this._tileSize}_computeScreenArea(e,t,r,i){this._tilingScheme.ensureMaxLod(e);const n=Pv;this._tilingScheme.getExtent(e,t,r,n);const s=Iv;return this._toRenderCoords(n,0,3,s[0]),this._toRenderCoords(n,2,3,s[1]),this._toRenderCoords(n,2,1,s[2]),this._toRenderCoords(n,0,1,s[3]),this._computeTriangleScreenArea([s[0],s[1],s[2]],i)+this._computeTriangleScreenArea([s[2],s[1],s[3]],i)}_computeTriangleScreenArea(e,t){const r=this._camera.frustum[Lf.FB.NEAR];let i=0,n=-1,s=-1;for(let o=0;o<3;++o)(0,$d.mN)(r,e[o])>0?(i++,-1===n&&(n=o)):-1===s&&(s=o);if(0===i)return this._computeTriangleScreenAreaInside(e,t);if(1===i){const i=Nv,s=(n+1)%3,o=(n+2)%3,a=n;(0,da.c)(i[0],e[s]),(0,da.c)(i[1],e[o]),Dv(i[2],e[o],e[a],r);const l=this._computeTriangleScreenAreaInside(i,t);return Dv(i[1],e[s],e[a],r),l+this._computeTriangleScreenAreaInside(i,t)}if(2===i){const i=Nv,n=s;(0,da.c)(i[0],e[n]);const o=(s+1)%3,a=(s+2)%3;return Dv(i[1],e[n],e[o],r),Dv(i[2],e[n],e[a],r),this._computeTriangleScreenAreaInside(i,t)}return 0}_computeTriangleScreenAreaInside(e,t){for(let r=0;r<3;r++)this._camera.projectToRenderScreen(e[r],Lv),this._camera.renderToScreen(Lv,Rv[r]),(0,un.fT)(t,Rv[r],t);return(0,p_.Fm)(Rv[0],Rv[1],Rv[2])}_toRenderCoords(e,t,r,i){return Ov[0]=e[t],Ov[1]=e[r],Ov[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(Ov,this._tilingScheme.spatialReference,i),i}}const Cv=2,Ev=5,Rv=[(0,Ki.gs)(),(0,Ki.gs)(),(0,Ki.gs)(),(0,Ki.gs)()],Pv=(0,un.vt)(),Ov=(0,nn.vt)(),Iv=[(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)()],Lv=(0,Ki.r_)(),Nv=[(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)()];function Dv(e,t,r,i){const n=(0,$d.mN)(i,t),s=(0,$d.mN)(i,r),o=Math.abs(s-n);(0,da.j)(e,t,Math.abs(s)/o),(0,da.r)(e,e,r,Math.abs(n)/o)}const Fv=[(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)(),(0,nn.vt)()],kv=[[0,3],[2,3],[2,1],[0,1]];var zv=r(42136);let Uv=class extends ht.A{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(null!=e&&!e.spatialReference.equals(this.viewState.spatialReference))return void Xe.A.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||null!=t&&e&&t.equals(e))return;const r=null!=e?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(null==this.filterExtent)return null;const e=(0,un.vt)();return(0,zv.k)(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new je.A,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Ty.A}initialize(){this.addHandles([(0,gt.wB)((()=>[this.tilingScheme,this.tileSize]),(()=>this._reset()),gt.OH),(0,gt.wB)((()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location]),(()=>this._setDirty()),gt.pc),(0,gt.wB)((()=>this.terrain?.baseOpacity??1),(()=>this._setDirty()))]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(ll.W6.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=(0,Je.xt)(this._frameWorker)}addClient(){const e=(0,h_.c)();return this._clients.add(e),1===this._clients.size&&this._setDirty(),(0,mt.hA)((()=>this._removeClient(e)))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(ll.Bb))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),null!=this._frameWorker&&(this._frameWorker.priority=ll.W6.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||null==this._frameWorker||(this._frameWorker.priority=ll.W6.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Av({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,getIsGroundOpaque:()=>1===(this.terrain?.baseOpacity??1)}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map((t=>new d_.J(t[0],t[1],t[2],e)))}_purgeHorizonTiles(e){if(e.sort(((e,t)=>{const r=e.measures.screenRect,i=t.measures.screenRect;return r[1]+r[3]-(i[1]+i[3])})),!(e.length>jv))return e.toArray();(0,un.Ie)(Vv);for(let t=0;t<e.length;t++)if((0,un.fT)(Vv,e.data[t].measures.screenRect,Vv),(0,un.uJ)(Vv)>Bv)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:t}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!(0,un.HY)(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==d_.b.INVISIBLE&&(r.measures.shouldSplit?(t.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const i of this.tiles.items)i.used=!1;const t=e.filter((e=>{const t=this._idToTile.get(e.id);return t?(t.copyMeasurementsFrom(e),t.used=!0):this._idToTile.set(e.id,e),!t})),r=this.tiles.items.filter((e=>!e.used&&(this._idToTile.delete(e.id),!0)));this.tiles.removeMany(r),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort(((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===d_.b.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance)),this.tiles.forEach(((e,t)=>e.loadPriority=t))}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Uv.prototype,"scheduler",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Uv.prototype,"renderCoordsHelper",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Uv.prototype,"tilingSchemeOwner",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Uv.prototype,"cameraOnSurface",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Uv.prototype,"focus",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Uv.prototype,"viewState",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Uv.prototype,"terrain",void 0),(0,ze._)([(0,Qe.MZ)()],Uv.prototype,"tiles",void 0),(0,ze._)([(0,Qe.MZ)()],Uv.prototype,"tileSize",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Uv.prototype,"tilingScheme",null),(0,ze._)([(0,Qe.MZ)()],Uv.prototype,"filterExtent",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Uv.prototype,"_filterExtentRect",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Uv.prototype,"_rootTileIds",null),(0,ze._)([(0,Qe.MZ)({value:!1})],Uv.prototype,"suspended",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Uv.prototype,"updating",null),Uv=(0,ze._)([(0,tt.$)("esri.views.3d.layers.support.FeatureTileTree3D")],Uv);const Vv=(0,un.vt)(),Bv=10,jv=50;var Hv=r(68452);let Gv=class extends ht.A{constructor(){super(...arguments),this._propertiesPool=new hm.M({camera:id.A},this),this._lastSeenCameraProjectionValues=new id.A,this.mode=fm.M.ANIMATING,this._cssCamera=new id.A,this._camera=new id.A,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new pt.A,this.viewingMode=$s.RT.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new bo({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new hm.M({camera:id.A},this)}destroy(){this.cameraController=null,this._propertiesPool?.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===$s.RT.Global){const e=(0,pa.tO)(this.spatialReference).radius;this.camera=new id.A({eye:(0,nn.fA)(4*e,0,0),center:(0,nn.fA)(e,0,0),up:(0,nn.fA)(0,0,1)})}else this.camera=new id.A({eye:(0,nn.fA)(0,0,100),center:(0,nn.fA)(0,0,0),up:(0,nn.fA)(0,1,0)})}get animation(){return this.cameraController instanceof Od&&null!=this.cameraController.viewAnimation?this.cameraController.viewAnimation:null}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:t,width:r,pixelRatio:i}=this.camera;return e.pixelRatio=1,e.height=Math.round(t/i),e.width=Math.round(r/i),e}get camera(){return this._camera}set camera(e){e!==$v&&$v.copyFrom(e),$v.computeUp(this.viewingMode),this.events.emit("before-camera-change",$v);const t=this._camera;if(function(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[dm.zj.TOP]!==t.padding[dm.zj.TOP]||e.padding[dm.zj.RIGHT]!==t.padding[dm.zj.RIGHT]||e.padding[dm.zj.BOTTOM]!==t.padding[dm.zj.BOTTOM]||e.padding[dm.zj.LEFT]!==t.padding[dm.zj.LEFT]}(this._lastSeenCameraProjectionValues,$v)&&(this._lastSeenCameraProjectionValues.copyFrom($v),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!t.equals($v)&&(this._camera=this._propertiesPool.get("camera").copyFrom($v),this._cameraChanged=!t.almostEquals($v),this._cameraChanged)){const e=(0,Hv.rs)((()=>{this._cameraChanged=!1,e.remove()}))}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===fm.M.IDLE}get updating(){return this.mode!==fm.M.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=null!=e?e.clone():null}get fixedContentCamera(){return null!=this._contentCamera}get isGlobal(){return this.viewingMode===$s.RT.Global}get isLocal(){return this.viewingMode===$s.RT.Local}get navigating(){return!!this.cameraController?.isInteractive}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.cameraController?.destroy(),e&&(this.removeHandles(qv),this.addHandles((0,gt.z7)((()=>e.state===Rd.Finished||e.state===Rd.Stopped),(()=>{this._set("cameraController",null),this.updateCamera((t=>e.onControllerEnd(t)))}),{sync:!0,once:!0}),qv),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Rd.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Rd.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(0===this._updateQueue.length||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();$v.copyFrom(this._get("camera")),e($v),this.camera=$v,this._processingUpdates=!1,this._processUpdateQueue()}};(0,ze._)([(0,Qe.MZ)()],Gv.prototype,"mode",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0,type:so})],Gv.prototype,"animation",null),(0,ze._)([(0,Qe.MZ)({type:id.A})],Gv.prototype,"cssCamera",null),(0,ze._)([(0,Qe.MZ)()],Gv.prototype,"_cssCamera",void 0),(0,ze._)([(0,Qe.MZ)({type:id.A})],Gv.prototype,"camera",null),(0,ze._)([(0,Qe.MZ)()],Gv.prototype,"_camera",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Gv.prototype,"pixelRatio",null),(0,ze._)([(0,Qe.MZ)()],Gv.prototype,"rasterPixelRatio",void 0),(0,ze._)([(0,Qe.MZ)()],Gv.prototype,"contentPixelRatio",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Gv.prototype,"alignPixelEnabled",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Gv.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)({})],Gv.prototype,"_contentCamera",void 0),(0,ze._)([(0,Qe.MZ)({type:id.A})],Gv.prototype,"contentCamera",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Gv.prototype,"fixedContentCamera",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Gv.prototype,"constraints",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Gv.prototype,"events",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Gv.prototype,"isGlobal",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Gv.prototype,"isLocal",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Gv.prototype,"viewingMode",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Gv.prototype,"spatialReference",void 0),(0,ze._)([(0,Qe.MZ)()],Gv.prototype,"navigating",null),(0,ze._)([(0,Qe.MZ)()],Gv.prototype,"stationary",null),(0,ze._)([(0,Qe.MZ)()],Gv.prototype,"_cameraChanged",void 0),(0,ze._)([(0,Qe.MZ)()],Gv.prototype,"cameraController",null),Gv=(0,ze._)([(0,tt.$)("esri.views.3d.state.ViewState")],Gv);const Zv=Gv;const $v=new id.A,qv="ViewStateHandles";var Wv=r(12482),Yv=r(88220),Xv=r(3112),Jv=r(46571);class Kv{constructor(e,t,r){this.viewingMode=e,this._forEachLayer=t,this._view=r,this._externalIntersectionHandlers=new Ty.A,this._tolerance=Id.TH,this._tmpRay=(0,Tu.vt)(),this._tmpRegion=(0,un.vt)(),this._validateHUDIntersector=(0,Id.hz)(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,t,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),ib(this.viewingMode),t,r)}intersectScreenFreePointFallback(e,t,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),t,r)}intersectRayFreePointFallback(e,t,r){return this.intersectRay(e,ib(this.viewingMode),t,r)||this._intersectRayFreePointLocal(e,t)}intersectRay(e,t,r,i){return t.options.selectionMode=!1,t.options.store=Xv.oH.MIN,this.computeIntersection(e,t,i),!!t.results.min&&t.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;return e.getRenderCenter(lb,r,i),lb[0]+=.0466,lb[1]-=.0123,(0,qd.dk)(e,lb,t)}intersectIntersectorScreen(e,t,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),t,r)}intersectToolIntersectorScreen(e,t,r){const i=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(i,t,r)}intersectToolIntersectorRay(e,t,r){t.options.selectionMode=!0,this.computeIntersection(e,t,r);const i=t.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||(0,Jv.i3)(i)&&i.intersector!==Xv.dz.TERRAIN||(t.options.selectionMode=!1,this.computeIntersection(e,t,r))}setTolerance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Id.TH;this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort(((e,t)=>e.type===Xv.dz.TERRAIN?1:t.type===Xv.dz.TERRAIN?-1:0))}removeIntersectionHandler(e){null!=this._externalIntersectionHandlers.removeUnordered(e)&&this._externalIntersectionHandlers.sort(((e,t)=>e.type===Xv.dz.TERRAIN?1:t.type===Xv.dz.TERRAIN?-1:0))}_getPickRay(e,t){const r=this._view.state.camera;return(0,qd.Z4)(r,e,t)}_intersectRayFreePointLocal(e,t){return this.viewingMode!==$s.RT.Local||null==e||(0,da.g)(t,e.origin,(0,da.n)(Vd.rq.get(),e.direction)),!1}intersectElevationFromScreen(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this._intersectElevation(this._getPickRay(e,this._tmpRay),t,r,i)}_intersectElevation(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(null==e)return null;const n=this._view,{renderCoordsHelper:s}=n,o=(0,pf.G9)(n.spatialReference),a=null!=t?t.mode:"absolute-height",l=(0,Wv.M7)(t)/o,c=("on-the-ground"!==a?l+r:0)*o/s.unitInMeters,{camera:u}=n.state;if("absolute-height"===a){const t=s?.getAltitude(u.eye),r=(0,da.m)((0,da.n)(ob,e.direction),s.worldUpAtPosition(u.eye,ab));if(t<c&&r<0||t>=c&&r>0)return null;if(s.intersectInfiniteManifold(e,c,ob)){const e=(0,Yv.zC)(n,ob);return e.z??=0,e.z-=l,e}return null}const h=(0,Ki.sc)(Vd.rq.get());u.projectToRenderScreen(e.origin,h);const d=new nb(null,this._forEachLayer),{slicePlane:p}=n,f=null!=p?(0,Jv.Q5)(p):null,m=(0,Id.hz)(this.viewingMode);m.options.store=Xv.oH.MIN,m.options.verticalOffset=c,m.options.normalRequired=!1;const g=e.origin,y=(0,da.g)(Vd.rq.get(),g,e.direction);m.reset(g,y,u),m.point=h;const _=i?"type"in i&&"graphics"===i.type?e=>e.layerUid!==i.uid:e=>e.graphicUid!==i.uid:null;switch(a){case"relative-to-scene":{const e=e=>(!_||_(e))&&!!e.lastValidElevationBB;m.intersect(d.layers,h,this._tolerance,null,e),this._externalIntersectionHandlers.forAll((e=>{if(e.type===Xv.dz.I3S||e.type===Xv.dz.TERRAIN||e.type===Xv.dz.TILES3D){const t=e.slicePlaneEnabled?f:null;e.intersect(m,t,m.rayBegin,m.rayEnd,h)}}));break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll((e=>{if(e.isGround){const t=e.slicePlaneEnabled?f:null;e.intersect(m,t,m.rayBegin,m.rayEnd,h)}}))}if(m.results.min.getIntersectionPoint(ob)){const e=(0,Yv.zC)(n,ob);return e.z=r,e}return null}computeIntersection(e,t,r,i){if(null==e)return;const n=this._view.state.camera,s=(0,Ki.sc)(Vd.rq.get());n.projectToRenderScreen(e.origin,s);const o=new nb(r,this._forEachLayer);t.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=e.origin,l=(0,da.g)(Vd.rq.get(),e.origin,e.direction);t.reset(a,l,n),t.intersect(o.layers,s,this._tolerance);const c=this._view.slicePlane,u=null!=c?(0,Jv.Q5)(c):null;t.intersect(o.sliceableLayers,s,this._tolerance,u);const h=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll((e=>{const r=e.layerUid,n=Array.isArray(r),c=n?r:[r];n&&(t.options.filteredLayerUids=[]);let d=!1;for(const i of c)o.filterLayerUid(i)?d=!0:n&&t.options.filteredLayerUids.push(i);if(t.options.isFiltered=!d,e.isGround&&h||!t.options.isFiltered){const r=e.slicePlaneEnabled?u:null;e.intersect(t,r,a,l,s,i)}}));const d=Vd.rq.get(),p=this._view.basemapTerrain;if(r&&r.enableDraped&&null!=p.spatialReference&&t.results.ground.getIntersectionPoint(d)){const e=p.overlayManager.renderer,r=this._view.renderCoordsHelper.spatialReference,i=Vd.rq.get();this._view.renderCoordsHelper.fromRenderCoords(d,i,p.spatialReference),i[2]=this._view.elevationProvider?.getElevation(d[0],d[1],d[2],r,"ground")??0,e.intersect(t,i,t.results.ground,(e=>o.filterRenderGeometry(e)))}t.sortResults(),this._processHUDResults(t)}_processHUDResults(e){const t=e.results.hud;(0,un.C)(this._tmpRegion,un.qv);const r=this._view.state.camera,i=[],n=this._tmpRegion,s=e=>{const t=new tb(e);r.projectToRenderScreen(e.target.center,t.screenPoint),t.screenPoint[0]=Math.floor(t.screenPoint[0]),t.screenPoint[1]=Math.floor(t.screenPoint[1]),i.push(t),(0,un.tK)(n,t.screenPoint)};e.sortResults(t.all),null!=t.min.dist&&s(t.min);for(const g of t.all)t.min.target.object!==g.target.object&&t.max.target.object!==g.target.object&&s(g);if(null!=t.max.dist&&t.max.target.object!==t.min.target.object&&s(t.max),!i.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const o=r.fullWidth,a=r.fullHeight,l=Math.max(0,n[0]-Qv),c=Math.max(0,n[1]-Qv),u=Math.min((0,un.VL)(n)+2*Qv,o-l),h=Math.min((0,un.uJ)(n)+2*Qv,a-c);if(u<=0||h<=0)return;const d=new Uint8Array(u*h*4);this._view._stage.renderer.readHUDVisibility(l,c,u,h,d);let p=!0;const f=null==e.results.max.dist;let m=0;for(const g of i)for(const t of eb){const r=4*(Math.min(g.screenPoint[0]+t[0],o)-n[0]+(Math.min(g.screenPoint[1]+t[1],a)-n[1])*u);if(!(r<0||r>=d.length)&&d[r]){p&&(e.results.min.copy(g.result),p=!1),f&&e.results.max.copy(g.result),e.options.store===Xv.oH.ALL&&e.results.all.splice(m++,0,g.result);break}}}}const Qv=1,eb=(()=>{const e=[],t=Qv;for(let r=-t;r<=t;r++)for(let i=-t;i<=t;i++)e.push([i+t,r+t]);return e})();class tb{constructor(e){this.result=e,this.screenPoint=(0,Ki.r_)()}}let rb;function ib(e){return rb&&rb.viewingMode===e||(rb=(0,Id.hz)(e)),rb}class nb{constructor(e,t){this.layers=new Array,this.sliceableLayers=new Array,this.include=e?.include,this.exclude=e?.exclude,t((e=>{e.pickable&&this.filterLayerUid(e.apiLayerUid)&&(e.sliceable?this.sliceableLayers:this.layers).push(e)}))}filterLayerUid(e){const{include:t,exclude:r}=this;return null==e?null==t&&null==r:(null==t||t.has(e))&&(null==r||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}}function sb(e){return"object"==typeof e&&"intersect"in e}const ob=(0,nn.vt)(),ab=(0,nn.vt)(),lb=(0,Ki.r_)();var cb=r(94683),ub=r(95225);let hb=class extends(pt.A.EventedMixin(ht.A)){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=(0,Je.pR)(this._cachedQuery)}enableCache(e){e||(this.lastElevationQuery=null),this._cacheEnabled=e}getElevation(e,t,r,i,n){if(this._cacheEnabled&&null!=this.lastElevationQuery){const s=this.lastElevationQuery;if(e===s.x&&t===s.y&&r===s.z&&(0,$n.aI)(i,s.spatialReference)&&n===s.queryContext)return s.result}let s=null;return s=db(s,this._im,e,t,r,i,n),null==s&&(s=db(s,this._ground,e,t,r,i,n)),"scene"===n&&(s=db(s,this._scene,e,t,r,i,n)),this._cacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:r,spatialReference:i,queryContext:n,result:s}),s}getSphereElevationBounds(e,t,r){const i=new ub.H;function n(n){for(const s of n)if(s.getSphereElevationBounds){const n=s.getSphereElevationBounds(e,t,r);null!=n&&i.expandElevationRangeValues(n.elevationRangeMin,n.elevationRangeMax)}}return n(this._ground),n(this._im),"scene"===r&&n(this._scene),i}getRootElevationBounds(){const e=new ub.H;for(const t of[this._im,this._ground,this._scene])t.forEach((t=>{if(t.getRootElevationBounds){const r=t.getRootElevationBounds();null!=r&&e.expandElevationRangeValues(r.elevationRangeMin,r.elevationRangeMax)}}));return e}async queryElevation(e,t,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const a=this._getElevationQuery(i);try{const l=await a.queryElevation(e,t,s,o);return"scene"===n?db(l,this._scene,e,t,r,i,n):l}catch(l){return(0,Ke.QP)(l),this.getElevation(e,t,r,i,n)}}register(e,t){this.addHandles(t.on("elevation-change",(e=>this.emit("elevation-change",e))),t),this._providersFromContext(e).push(t)}unregister(e){this.removeHandles(e);for(const t of[this._im,this._ground,this._scene]){const r=t.indexOf(e);r>-1&&t.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.view.spatialReference;const t=this._cachedQuery;if(null!=t&&(0,$n.aI)(e,t.spatialReference))return t;t?.destroy({completeTasks:!0});const{wkid:r,wkt:i,wkt2:n,latestWkid:s}=e,o=new cb.I(this.view.resourceController.scheduler,new Bt.A({wkid:r,wkt:i,wkt2:n,latestWkid:s}),(()=>this.view.map?.ground),{maximumAutoTileRequests:4});return this._cachedQuery=o,o}};function db(e,t,r,i,n,s,o){for(const a of t){const t=a.getElevation(r,i,n,s,o);null!=t&&(e=null!=e?Math.max(t,e):t)}return e}(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],hb.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)()],hb.prototype,"spatialReference",null),hb=(0,ze._)([(0,tt.$)("esri.views.3d.support.CombinedElevationProvider")],hb);class pb{static isValidProfile(e){return e in pb.profiles}static getDefaultProfile(){return(0,it.A)("esri-iPhone")?"low":"medium"}static apply(e,t){const r=pb.profiles[e];t.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,t.graphics3D.maxNumberOfDrawCalls=r.graphics3D.maxNumberOfDrawCalls,t.graphics3D.maxTotalNumberOfVertices=r.graphics3D.maxTotalNumberOfVertices,t.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,t.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,t.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,t.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods,t.graphics3D.uncompressedTextureDownsamplingEnabled=r.graphics3D.uncompressedTextureDownsamplingEnabled;const i=t.sceneService.object,n=r.sceneService.object;i.lodFactor=n.lodFactor,t.sceneService.point.lodFactor=r.sceneService.point.lodFactor,t.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,t.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,t.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,t.tiledSurface.lodBias=r.tiledSurface.lodBias,t.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,t.tiledSurface.vtlContentZoom=r.tiledSurface.vtlContentZoom,t.tiledSurface.elevationLevelDelta=r.tiledSurface.elevationLevelDelta,t.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,t.heatmap.pixelRatio=r.heatmap.pixelRatio,t.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,t.fadeDuration=r.fadeDuration,t.antialiasingEnabled=r.antialiasingEnabled,t.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,t.highQualityTransparency=r.highQualityTransparency,t.highResolutionAtmosphere=r.highResolutionAtmosphere,t.reflections=r.reflections,t.ambientOcclusion=r.ambientOcclusion,t.memoryLimit=r.memoryLimit,t.additionalCacheMemory=r.additionalCacheMemory,t.frameRate=r.frameRate,t.maximumPixelRatio=r.maximumPixelRatio}}pb.test={reset(){const e=mb();for(const t of Object.keys(e))pb.profiles[t]=e[t]}};const fb={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function mb(){const e=!!(0,it.A)("esri-mobile"),t=!!(0,it.A)("ios"),r=(0,ql.l5)(400);return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:(0,ql.l5)(0),antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+fb.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:e},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!(0,it.A)("disable-feature:reduce-map-tile-levels")},fadeDuration:r,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:e?600+fb.GalaxyS20:750+fb.FullHD,additionalCacheMemory:e?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!(0,it.A)("disable-feature:reduce-map-tile-levels")},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:e?900+fb.SurfacePro7:1500+fb.FullHDRetina,additionalCacheMemory:e?-150:0,frameRate:0,maximumPixelRatio:e?1:1/0}}}!function(e){e.profiles=mb()}(pb||(pb={}));const gb=pb,yb=new Be.A([0,255,255]),_b=new Be.A([0,0,0]);let vb=class extends ht.A{constructor(){super(...arguments),this.color=yb.clone(),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=_b.clone(),this.shadowDifference=.2}};(0,ze._)([(0,Qe.MZ)({type:Be.A})],vb.prototype,"color",void 0),(0,ze._)([(0,Qe.MZ)({type:Be.A})],vb.prototype,"haloColor",void 0),(0,ze._)([(0,Qe.MZ)()],vb.prototype,"haloOpacity",void 0),(0,ze._)([(0,Qe.MZ)()],vb.prototype,"fillOpacity",void 0),(0,ze._)([(0,Qe.MZ)()],vb.prototype,"shadowOpacity",void 0),(0,ze._)([(0,Qe.MZ)({type:Be.A})],vb.prototype,"shadowColor",void 0),(0,ze._)([(0,Qe.MZ)()],vb.prototype,"shadowDifference",void 0),vb=(0,ze._)([(0,tt.$)("esri.views.3d.support.HighlightOptions")],vb);const bb=vb;var wb,xb=r(39483);class Sb{constructor(e,t){this.spatialReference=t,this.unitInMeters=(0,pf.GA)(this.spatialReference,(0,pa.tO)(this.spatialReference).metersPerDegree);const r=e&&"portalItem"in e?e.portalItem:void 0;this._geometryServiceURLPromise=(0,xb.getGeometryServiceURL)(r).catch((()=>{throw new Ze.A("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")}))}async toGeographic(e){const t=await this._geometryServiceURLPromise;let r,i=!0;Array.isArray(e[0])&&"number"!=typeof e[0]?r=e:(r=[e],i=!1);const n=r.map((e=>e instanceof df.A?e:new df.A(e,this.spatialReference))),s=new Xr.A({geometries:n,outSpatialReference:Bt.A.WGS84}),o=(await(0,Yr.C)(t,s)).map((e=>"point"===e.type?[e.x,e.y]:void 0)).filter((e=>!!e));return i?o:o[0]}}!function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"}(wb||(wb={}));const Tb=[wb.ELEVATION,wb.MAP];const Mb=.05;async function Ab(e,t){const{results:r,ground:i}=await async function(e,t){if("2d"===e.type)return e.hitTest(t);const r=await e.hitTest(t);if(0===r.results.length)return r;const i=r.results[0],n=(i.distance??0)*(1+Mb),s=r.results.findIndex((e=>(e.distance??0)>n));return-1!==s&&(r.results=r.results.slice(0,s)),i&&r.ground.distance>n&&(r.ground.mapPoint=null),r}(e,t),n=(!i.layer||!(0,vt.Eq)(i.layer.type))&&i.mapPoint,s=[],o=function(e){const t=new Map;for(const r of e.allLayerViews){const e=r.layer.uid;t.set(e,r)}return t}(e),a=n?function(e,t){const r=new Set,i=[];for(let s=e.basemapTerrain.numLayers(wb.MAP)-1;s>=0;s--){const t=e.basemapTerrain.layerViewByIndex(s,wb.MAP);r.add(t.layer.uid),i.push(t)}const n=e.basemapTerrain.overlayManager.renderer.layers;for(const{uid:s}of n){const e=t.get(s);e&&(r.add(s),i.push(e))}return i.reverse(),{layerUids:r,layerViews:i}}(e,o):Cb;let l=0,c=0;const u=()=>{const e=a.layerViews[c];n&&e&&"fetchPopupFeaturesAtLocation"in e&&s.push({mapPoint:i.mapPoint,layerView:e}),++c};let h=null;for(;l<r.length||c<a.layerViews.length;){const t=r[l];if(t&&"graphic"!==t.type)++l;else if("scene"!==t?.layer?.type||t?.layer?.parent!==e?.map?.basemap)if(t){const e=t.layer?.uid,r=a.layerUids.has(e)&&t.distance===i.distance,n=o.get(t.layer?.uid);if(h??=t.mapPoint,c<a.layerViews.length&&(r||(t.distance??0)>i.distance)&&a.layerViews[c]!==n){u();continue}s.push({graphic:t.graphic,layerView:n}),++l}else u();else++l}return h??=i.mapPoint,{hits:s,location:h}}const Cb={layerUids:new Set,layerViews:[]};let Eb=class extends ht.A{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};(0,ze._)([(0,Qe.MZ)()],Eb.prototype,"minTotalNumberOfFeatures",void 0),(0,ze._)([(0,Qe.MZ)()],Eb.prototype,"maxTotalNumberOfFeatures",void 0),(0,ze._)([(0,Qe.MZ)()],Eb.prototype,"maxNumberOfDrawCalls",void 0),(0,ze._)([(0,Qe.MZ)()],Eb.prototype,"maxTotalNumberOfVertices",void 0),(0,ze._)([(0,Qe.MZ)()],Eb.prototype,"snapshotAvailable",void 0),(0,ze._)([(0,Qe.MZ)()],Eb.prototype,"polygonLodFactor",void 0),(0,ze._)([(0,Qe.MZ)()],Eb.prototype,"polylineLodFactor",void 0),(0,ze._)([(0,Qe.MZ)()],Eb.prototype,"skipHighSymbolLods",void 0),(0,ze._)([(0,Qe.MZ)()],Eb.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Eb=(0,ze._)([(0,tt.$)("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Eb);let Rb=class extends ht.A{constructor(){super(...arguments),this.lodFactor=1}};(0,ze._)([(0,Qe.MZ)()],Rb.prototype,"lodFactor",void 0),Rb=(0,ze._)([(0,tt.$)("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Rb);let Pb=class extends ht.A{constructor(){super(...arguments),this.object=new Rb,this.point=new Rb,this.integratedMesh=new Rb,this.pointCloud=new Rb,this.uncompressedTextureDownsamplingEnabled=!1}};(0,ze._)([(0,Qe.MZ)({type:Rb})],Pb.prototype,"object",void 0),(0,ze._)([(0,Qe.MZ)({type:Rb})],Pb.prototype,"point",void 0),(0,ze._)([(0,Qe.MZ)({type:Rb})],Pb.prototype,"integratedMesh",void 0),(0,ze._)([(0,Qe.MZ)({type:Rb})],Pb.prototype,"pointCloud",void 0),(0,ze._)([(0,Qe.MZ)()],Pb.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Pb=(0,ze._)([(0,tt.$)("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Pb);let Ob=class extends ht.A{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.elevationLevelDelta=3,this.reduceTileLevelDifferences=!0}};(0,ze._)([(0,Qe.MZ)()],Ob.prototype,"lodBias",void 0),(0,ze._)([(0,Qe.MZ)()],Ob.prototype,"angledSplitBias",void 0),(0,ze._)([(0,Qe.MZ)()],Ob.prototype,"vtlContentZoom",void 0),(0,ze._)([(0,Qe.MZ)()],Ob.prototype,"elevationLevelDelta",void 0),(0,ze._)([(0,Qe.MZ)()],Ob.prototype,"reduceTileLevelDifferences",void 0),Ob=(0,ze._)([(0,tt.$)("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Ob);let Ib=class extends ht.A{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};(0,ze._)([(0,Qe.MZ)()],Ib.prototype,"pixelRatio",void 0),(0,ze._)([(0,Qe.MZ)()],Ib.prototype,"maxTotalNumberOfFeatures",void 0),Ib=(0,ze._)([(0,tt.$)("esri.views.3d.support.QualitySettings.HeatmapSettings")],Ib);let Lb=class extends ht.A{constructor(){super(...arguments),this.graphics3D=new Eb,this.sceneService=new Pb,this.tiledSurface=new Ob,this.heatmap=new Ib,this.fadeDuration=(0,ql.l5)(400),this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};(0,ze._)([(0,Qe.MZ)({type:Eb})],Lb.prototype,"graphics3D",void 0),(0,ze._)([(0,Qe.MZ)({type:Pb})],Lb.prototype,"sceneService",void 0),(0,ze._)([(0,Qe.MZ)({type:Ob})],Lb.prototype,"tiledSurface",void 0),(0,ze._)([(0,Qe.MZ)({type:Ib})],Lb.prototype,"heatmap",void 0),(0,ze._)([(0,Qe.MZ)()],Lb.prototype,"fadeDuration",void 0),(0,ze._)([(0,Qe.MZ)()],Lb.prototype,"antialiasingEnabled",void 0),(0,ze._)([(0,Qe.MZ)()],Lb.prototype,"physicallyBasedRenderingEnabled",void 0),(0,ze._)([(0,Qe.MZ)()],Lb.prototype,"highQualityTransparency",void 0),(0,ze._)([(0,Qe.MZ)()],Lb.prototype,"highResolutionAtmosphere",void 0),(0,ze._)([(0,Qe.MZ)()],Lb.prototype,"reflections",void 0),(0,ze._)([(0,Qe.MZ)()],Lb.prototype,"ambientOcclusion",void 0),(0,ze._)([(0,Qe.MZ)()],Lb.prototype,"memoryLimit",void 0),(0,ze._)([(0,Qe.MZ)()],Lb.prototype,"additionalCacheMemory",void 0),(0,ze._)([(0,Qe.MZ)()],Lb.prototype,"frameRate",void 0),(0,ze._)([(0,Qe.MZ)()],Lb.prototype,"maximumPixelRatio",void 0),Lb=(0,ze._)([(0,tt.$)("esri.views.3d.support.QualitySettings")],Lb);const Nb=Lb;var Db=r(74487),Fb=r(75540),kb=r(5729),zb=r(69495),Ub=r(3825);class Vb{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}}class Bb{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new jb}}class jb{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class Hb{constructor(e,t,r,i){this._workerFunc=e,this._callbackFunc=t,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=i.map((e=>new Bb(e)))}destroy(){this._clients.length=0}hasQuota(e){const t=this._clients[e];return!!t&&(this._totalNumWorkers<this._maxTotalNumWorkers||t.numWorkers+t.tasks.length<t.typeWorkerQuota)}push(e){const t=this._clients[e.client];t&&(this._totalNumWorkers<this._maxTotalNumWorkers?(t.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,((e,t)=>this._taskCallback(e,t)))):t.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const t=this._clients[e.client];this._totalNumWorkers--,t&&(t.numWorkers--,t.statistics.requests++,t.statistics.size+=e.size||0,t.statistics.duration+=e.duration||0,t.statistics.speed=t.statistics.duration>0?t.statistics.size/t.statistics.duration:0,(0,kl.vA)(t.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),((e,t)=>this._taskCallback(e,t))))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,t){e._cancelled||(this._callbackFunc(e,t),this._taskFinished(e))}getStatsForType(e){const t=this._clients[e];return t?{quota:t.typeWorkerQuota,workers:t.numWorkers,queueSize:t.tasks.length,requestStats:t.statistics}:null}get test(){}}class Gb{constructor(e,t){this.element=e,this.type="image+type",this.isOpaque="image/jpeg"===t}}var Zb=r(74110);let $b=class extends ht.A{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,r){this._loadQueue=new Hb(((e,t)=>this._startLoading(e,t)),((e,t)=>this._doneLoadingCB(e,t)),e,t),r&&(this._frameTask=r.registerTask(ll.W6.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=(0,Je.xt)(this._frameTask),this._tasks.forEach((e=>(0,Je.DC)(e.abortController))),this._loadQueue=(0,Je.pR)(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const n=(0,Ke.Tw)();n.__signal=null!=i?i.signal:null;const s=this._createOrUpdateTask(e,t,r,i,n);return(0,Ke.u7)(i,(()=>this._cancelRequest(s,n))),n.promise}_createTask(e,t,r,i,n,s){const o=new Wb(e,t,r,i,n);return this._updateTask(o,s),this._tasks.set(n,o),1===this._tasks.size&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){(0,Dt.Xy)(e.resolvers,t),t.reject((0,Ke.NK)()),0===e.resolvers.length&&(e.status===Yb.DOWNLOADING&&(e.status=Yb.CANCELLED,this._loadQueue.cancel(e),e.abortController?.abort(),e.request=null,e.abortController=null),e.status=Yb.CANCELLED,this._tasks.delete(e.key),0===this._tasks.size&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,r,i,n){const s=function(e,t,r){return`${e}:${t}:${r}`}(i?.uid||e,t,r),o=this._tasks.get(s);return o?(this._updateTask(o,n),o):this._createTask(e,i,t,r,s,n)}_doneLoadingCB(e,t){this._loadQueue&&((0,kl.vA)(e.status===Yb.DOWNLOADING),e.status=Yb.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();(0,Ke.Te)(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==Yb.DOWNLOADED&&(t.err=t.err||(0,Ke.NK)()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!(0,Ke.zf)(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=(0,Zb.EM)(e.result)||e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const i of e.resolvers)if(t)(0,Ke.zf)(t)?i.reject(t):i.reject(new Ze.A("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--r;const t=r>0?(0,qe.o8)(e.result):e.result;i.resolve(t)}this._tasks.delete(e.key),0===this._tasks.size&&this._set("updating",!1)}_startLoading(e,t){if(e.status===Yb.CANCELLED)return!1;let r,i;switch(e.startTime=performance.now(),e.status=Yb.DOWNLOADING,e.docType){case"binary":i="array-buffer",r=0;break;case"image":i="image";break;case"image+type":i="array-buffer";break;default:i="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=(0,Ub.A)(e.url,{...e.options,responseType:i,timeout:r,signal:n});const s=r=>{e.duration=performance.now()-e.startTime,e.size=r instanceof ArrayBuffer?r.byteLength:e.size||0,e.result=r,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},o=r=>{e.status===Yb.DOWNLOADING&&t(e,r)};return"image+type"!==e.docType?(e.request.then((e=>s(e.data)),o),!0):(e.request.then((t=>{const a=t.data,l=function(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return 137===t[0]&&80===t[1]?"image/png":71===t[0]&&73===t[1]?"image/gif":66===t[0]&&77===t[1]?"image/bmp":255===t[0]&&216===t[1]?"image/jpeg":"unknown"}(a);if(i="image",e.size=a.byteLength,"unknown"===l)return e.request=(0,Ub.A)(e.url,{responseType:i,timeout:r,signal:n}),void e.request.then((e=>s(e.data)),o);const c=new Blob([a],{type:l}),u=window.URL.createObjectURL(c);e.request=(0,Ub.A)(u,{responseType:i,timeout:r,signal:n}),e.request.then((e=>s(new Gb(e.data,l))),o).finally((()=>window.URL.revokeObjectURL(u)))}),o),!0)}get test(){}};(0,ze._)([(0,Qe.MZ)({readOnly:!0})],$b.prototype,"updating",void 0),$b=(0,ze._)([(0,tt.$)("esri.views.3d.support.StreamDataLoader")],$b);const qb=0;class Wb extends Vb{constructor(e,t,r,i,n){super(i),this.url=e,this.options=t,this.docType=r,this.key=n,this.result=null,this.status=Yb.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=qb}}var Yb;!function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"}(Yb||(Yb={}));let Xb=class extends ht.A{constructor(){super(...arguments),this.updating=!1}};(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Xb.prototype,"updating",void 0),Xb=(0,ze._)([(0,tt.$)("esri.views.3d.support.ResourceController.ResourceControllerMain")],Xb);let Jb=class extends Xb{constructor(){super(...arguments),this._immediateTask=ll.nu,this._normalTask=ll.nu,this._updatingObjects=(0,Fb.v)([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=(0,ll.mj)(),this._memoryController=(0,zb.w)(this.view),this._streamDataLoader=new $b,this._streamDataLoader.setup(kb.u1,kb.U0,this._scheduler),this.addHandles([(0,gt.wB)((()=>this.view.state?.mode),(e=>{null!=e&&(this._scheduler.state=e)}),gt.OH),(0,gt.wB)((()=>this.view.stationary),(()=>this._stationaryChangedHandler()))]),this._frameTask=(0,Ji.mg)({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(ll.W6.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(ll.W6.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=(0,Je.xt)(this._frameTask),this._streamDataLoader=(0,Je.pR)(this._streamDataLoader),this._memoryController=(0,Je.pR)(this._memoryController),this._scheduler=(0,Je.pR)(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some((e=>e.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const t=this._streamDataLoader;return{request:(r,i,n)=>t.request(r,i,e,n),get busy(){return!t.hasDownloadSlots(e)}}}addUpdatingObject(e){const t=this._updatingObjects;return t.value=[...t.value,e],(0,mt.hA)((()=>{t.value=t.value.filter((t=>t!==e))}))}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step((0,ql.y)(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};(0,ze._)([(0,Qe.MZ)()],Jb.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)()],Jb.prototype,"_scheduler",void 0),(0,ze._)([(0,Qe.MZ)()],Jb.prototype,"_memoryController",void 0),(0,ze._)([(0,Qe.MZ)()],Jb.prototype,"_streamDataLoader",void 0),(0,ze._)([(0,Qe.MZ)()],Jb.prototype,"_immediateTask",void 0),(0,ze._)([(0,Qe.MZ)()],Jb.prototype,"_normalTask",void 0),(0,ze._)([(0,Qe.MZ)()],Jb.prototype,"_updatingObjects",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Jb.prototype,"updating",null),Jb=(0,ze._)([(0,tt.$)("esri.views.3d.support.ResourceController")],Jb);var Kb=r(55877),Qb=r(65768);class ew{constructor(e){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer;const t=e.performanceInfo;this.memory=t.usedMemory,this.displayedNumberOfFeatures=t.displayedFeatures,this.maximumNumberOfFeatures=t.maximumFeatures,this.totalNumberOfFeatures=t.totalFeatures}}class tw{constructor(e){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,null!=e.resourceController){const t=e.resourceController.memoryController;this.totalMemory=(t.maxMemory??0)*Kb.u.MEGABYTES,this.usedMemory=Math.round(t.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=t.usedCacheMemory}this.terrainMemory=e.basemapTerrain?.usedMemory??0,this.edgesMemory=e._stage?.renderer.usedMemory.edges??0,this.fboMemory=e._stage?.renderer.usedMemory.fbos??0,e.allLayerViews?.items.forEach((e=>{(0,Qb.T)(e)&&this.layerPerformanceInfos.push(new ew(e))})),this.layerPerformanceInfos.sort(((e,t)=>t.memory-e.memory))}}var rw=r(11109),iw=r(56516),nw=r(14766);class sw{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",(()=>{})),this._wosrMemCache=e("wosr-resources",(()=>{}))}destroy(){this._gltfLoading.forEach((e=>e.abortController.abort())),this._wosrLoading.forEach((e=>e.abortController.abort())),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,t,r){const i=r?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(i);return null!=n?Promise.resolve(n):ow(this._gltfLoading,this._gltfMemCache,i,(t=>(0,iw.y)(new rw.R(t.streamDataRequester),e,t,r)),t)}loadWOSR(e,t){const r=`wosr:${e}:${t.disableTextures}`,i=this._wosrMemCache.get(r);return null!=i?Promise.resolve(i):ow(this._wosrLoading,this._wosrMemCache,r,(t=>(0,nw.Hh)(e,t)),t)}}async function ow(e,t,r,i,n){(0,Ke.Te)(n);const s=(0,Ke.u7)(n,(()=>function(e,t){const r=e.get(t);if(null!=r&&--r.refCount>0)return;e.delete(t),null!=r&&r.abortController.abort()}(e,r)));let o=e.get(r);if(o)o.refCount++;else{const t=new AbortController;o={refCount:1,abortController:t,promise:i({...n,signal:t.signal})},e.set(r,o)}try{const i=await o.promise;return t.put(r,i,i.size),e.delete(r),(0,Ke.Te)(n),i}finally{(0,Je.xt)(s)}}let aw=class extends ht.A{constructor(e,t){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=t?.registerTask(ll.W6.TEXTURE_UNLOAD)??ll.nu}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach((e=>this._releaseTextureRequest(e))),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,t){const r=this.makeUid(e);let i=this._textureRequests.get(r);if(!i){const e=new cw;e.texture=t(),this._stage&&(e.texture.load(this._stage.renderView.renderingContext),this._stage.add(e.texture)),this._textureRequests.set(r,e),i=e}return i.referenceCount++,new lw(r,i.texture,(()=>this._release(r)))}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule((()=>this._releaseNow(e)))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(t.texture?.unload(),this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!=t?`${e}.${t}px`:e}};(0,ze._)([(0,Qe.MZ)()],aw.prototype,"_frameTask",void 0),(0,ze._)([(0,Qe.MZ)()],aw.prototype,"updating",null),aw=(0,ze._)([(0,tt.$)("esri.views.3d.support.TextureCollection")],aw);class lw{constructor(e,t,r){this.uid=e,this.texture=t,this.release=r}}class cw{constructor(){this.referenceCount=0}}var uw=r(96897);class hw extends aw{constructor(e,t,r){super(t,r),this._streamDataRequester=e}async fromUrl(e,t,r){(0,Ke.Te)(r);const i=r?.signal,n=this.makeUid(e,t);let s=this._textureRequests.get(n);if(!s){const r=new AbortController,i=this._streamDataRequester.request(e,"image",{uid:n,signal:r.signal});s=new cw,s.abortController=r;const o=s;this._textureRequests.set(n,s),s.textureAsync=i.then((async r=>{const i=this._createTexture(e,r,t);return o.texture=i,o.abortController=null,await i.load(this._stage.renderView.renderingContext),this._stage.add(i),new lw(n,i,(()=>this._release(n)))}),(e=>{throw o.abortController=null,e}))}s.referenceCount++;try{return await(0,Ke.qr)(s.textureAsync,i)}catch(o){throw this._release(n),o}}_createTexture(e,t,r){const i={width:t.width,height:t.height,wrap:{s:Aa.pF.CLAMP_TO_EDGE,t:Aa.pF.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if((0,zt.XJ)(e)){if(r||0===t.width&&0===t.height){const e=t.width?t.height/t.width:1;r=r||64,e>1?(t.width=Math.round(r/e),t.height=r):(t.width=r,t.height=Math.round(r*e))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(i.preMultiplyAlpha=!1)}return new uw.g(t,i)}}class dw{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(kb.sK.SYMBOLOGY),this.objectResourceCache=new sw(((t,r)=>e.resourceController.memoryController.newCache(t,r))),this.textures=new hw(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const t=(0,pa.tO)(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=(0,zy.mt)(e.viewingMode,t),this.screenSizePerspectiveSettingsLabels=(0,zy.M4)(e.viewingMode,t)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return(0,mt.hA)();this._graphicsOwners.push(e);const t=(0,gt.wB)((()=>e.layer?.screenSizePerspectiveEnabled),(()=>this._updateScreenSizePerspectiveEnabled()));return this._updateScreenSizePerspectiveEnabled(),(0,mt.hA)((()=>{t.remove(),(0,Dt.Xy)(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()}))}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some((e=>!0===e.layer?.screenSizePerspectiveEnabled));if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Gn.A;const e=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([(0,gt.wB)((()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance),e,gt.OH),this._viewState.events.on("camera-projection-changed",e)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=(0,Je.pR)(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;pw.distance=e.centerOnSurfaceInfrequent.distance,pw.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(pw),this.screenSizePerspectiveSettingsLabels.update(pw),this._view._stage.renderView.requestRender()}get test(){}}const pw={distance:0,fovY:0};r(95444);var fw=r(37471),mw=r(27796),gw=r(21405);class yw{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.graphics=e,this._symbol=new fw.A({symbolLayers:new je.A([new mw.A({material:{color:t},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new gw.A({text:r,halo:{color:"white",size:1/.75},material:{color:t},size:12})])})}show(e,t){if(null==t)return;this.hide();const r=new df.A({x:e[0],y:e[1],z:e[2],spatialReference:t});this._graphic=new Ef.A({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){null!=this._graphic&&(this.graphics.remove(this._graphic),this._graphic=null)}}let _w=class extends ht.A{constructor(e){super(e)}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],_w.prototype,"renderCoordsHelper",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],_w.prototype,"surface",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],_w.prototype,"state",void 0),_w=(0,ze._)([(0,tt.$)("esri.views.3d.support.pointsOfInterest.PointOfInterest")],_w);const vw=Array;let bw=class extends _w{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new hm.M({location:df.A,renderLocation:vw},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=(0,nn.vt)(),this._tmpPoint=new df.A}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles((0,gt.on)((()=>this.map?.ground?.layers),"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=(0,Je.pR)(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){const e=this._camera,t=(0,da.p)(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return(0,En.Fj)(r,t,0)}get updating(){return this._dirty||null!=this._pendingElevationQueryController}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map?.ground)return this._updateSurfaceAltitude(0),cl.G;const e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const t=(this._tmpPoint.z??0)>xw&&this.renderCoordsHelper.viewingMode===$s.RT.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:t?Sw:0}).then((e=>this._updateSurfaceAltitude(e.geometry.z??0))).catch((e=>{(0,Ke.zf)(e)||this._updateSurfaceAltitude(0)})).catch((()=>{})).then((()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null})),this._pendingElevationQueryController=r,cl.G}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(ww,this._estimatedSurfaceAltitude,this._camera.eye),(0,da.e)(this._get("renderLocation"),ww)||(this._set("renderLocation",(0,da.c)(this._propertiesPool.get("renderLocation"),ww)),this.notifyChange("renderLocation"))}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],bw.prototype,"scheduler",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],bw.prototype,"cache",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],bw.prototype,"task",void 0),(0,ze._)([(0,Qe.MZ)()],bw.prototype,"location",null),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],bw.prototype,"map",void 0),(0,ze._)([(0,Qe.MZ)()],bw.prototype,"renderLocation",void 0),(0,ze._)([(0,Qe.MZ)()],bw.prototype,"scale",null),(0,ze._)([(0,Qe.MZ)()],bw.prototype,"updating",null),bw=(0,ze._)([(0,tt.$)("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],bw);const ww=(0,nn.vt)(),xw=1e5,Sw=1e6,Tw=Array;let Mw=class extends _w{constructor(e){super(e),this._propertiesPool=new hm.M({location:df.A,renderLocation:Tw},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=(0,nn.vt)(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=(0,Je.xt)(this._frameWorker),this._propertiesPool=(0,Je.pR)(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,cl.G}_updateRenderLocation(){const e=Cw;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&r&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const i=Ew;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,i)&&((0,da.c)(e,i),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=(0,da.p)(this._camera.eye,e):((0,da.j)(e,this._camera.viewForward,this._get("distance")),(0,da.g)(e,e,this._camera.eye)),(0,da.e)(this._get("renderLocation"),e)||this._set("renderLocation",(0,da.c)(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){const r=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(r.ray,e,t))return!1;if(this.state.isGlobal){const i=(0,pa.tO)(this.renderCoordsHelper.spatialReference).radius,n=i+e,s=(0,da.q)(r.eye),o=s<n*n,a=(0,da.p)(r.eye,t);if(o&&a>i/4){const e=n-Math.sqrt(s);return(0,da.j)(t,r.viewForward,e),(0,da.g)(t,t,r.eye),!0}}else{const e=this.surface?.ready?this.surface.extent:null;null!=e&&(0,ln.S)(e,this.surface?.spatialReference,Rw,this.renderCoordsHelper.spatialReference)&&(t[0]=(0,ws.qE)(t[0],Rw[0],Rw[2]),t[1]=(0,ws.qE)(t[1],Rw[1],Rw[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==e)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(My.b.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,i=(0,da.p)(r,e),n=(0,da.p)(r,t);if(Math.abs(n-i)/i>Aw)return!0}return!1}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Mw.prototype,"scheduler",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Mw.prototype,"task",void 0),(0,ze._)([(0,Qe.MZ)()],Mw.prototype,"distance",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Mw.prototype,"estimateSurfaceAltitudeAtCenter",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Mw.prototype,"location",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],Mw.prototype,"renderLocation",void 0),(0,ze._)([(0,Qe.MZ)()],Mw.prototype,"updating",void 0),Mw=(0,ze._)([(0,tt.$)("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],Mw);const Aw=.05,Cw=(0,nn.vt)(),Ew=(0,nn.vt)(),Rw=(0,un.vt)();class Pw{constructor(e){this._handles=new Gn.A,this.events=new pt.A,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",(e=>this._layerViewsChanged(e)))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=(0,Je.pR)(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach((e=>{"esri.views.3d.layers.SceneLayerView3D"===e.declaredClass&&this._handles.add(e.on("visible-geometry-changed",(()=>this._contentChanged())),e.uid)})),e.removed.forEach((e=>this._handles.remove(e.uid)))}_contentChanged(){this.events.emit("request-update",Ow)}}const Ow={},Iw=Array;let Lw=class extends _w{constructor(e){super(e),this._propertiesPool=new hm.M({location:df.A,renderLocation:Iw},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([(0,gt.wB)((()=>this.centerOnSurface.renderLocation),(()=>this.updateRenderLocation())),(0,gt.wB)((()=>this.state.contentCamera),(()=>this.updateRenderLocation()))]),this.scheduler&&this.addHandles(this.scheduler.registerTask(ll.W6.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=(0,Je.pR)(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){const{camera:e,contentPixelRatio:t}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/t)}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,i=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(t,Nw);const n=Math.max(0,(Math.acos((0,da.m)(Nw,i.viewForward))-.5*Math.PI)*(i.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!(0,da.G)(e,t)){const e=this._propertiesPool.get("renderLocation");(0,da.c)(e,t),this._set("renderLocation",e)}return cl.G}const s=1-(0,ws.qE)(n/(.5*Math.PI),0,1),o=s*s*s;this._calculateScreenHorizontalEdgeOnSurface(Fw);const a=this._propertiesPool.get("renderLocation");return(0,da.o)(a,t,Fw,o),e&&(0,da.G)(e,a)||this._set("renderLocation",a),cl.G}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,r=t.getRenderCenter((0,Ki.r_)());if(r[1]=t.aboveGround?t.padding[dm.zj.BOTTOM]:t.fullHeight-t.padding[dm.zj.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const i=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(r,Dw)){(0,da.f)(Dw,Dw,t.eye);const r=(0,da.n)(Dw,Dw);if(this.renderCoordsHelper.intersectInfiniteManifold((0,Tu.LV)(t.eye,r),i,e))return e}return this.renderCoordsHelper.setAltitude(e,i,t.eye)}updateRenderLocation(){this._dirty=!0}};(0,ze._)([(0,Qe.MZ)()],Lw.prototype,"_dirty",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Lw.prototype,"scheduler",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Lw.prototype,"centerOnSurface",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Lw.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),(0,ze._)([(0,Qe.MZ)()],Lw.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)()],Lw.prototype,"location",null),(0,ze._)([(0,Qe.MZ)()],Lw.prototype,"renderLocation",void 0),(0,ze._)([(0,Qe.MZ)()],Lw.prototype,"worldUnitsPerContentPixel",null),Lw=(0,ze._)([(0,tt.$)("esri.views.3d.support.pointsOfInterest.Focus")],Lw);const Nw=(0,nn.vt)(),Dw=(0,nn.vt)(),Fw=(0,nn.vt)();let kw=class extends ht.A{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=(0,nn.vt)();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([(0,gt.wB)((()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent]),(()=>this._update())),(0,gt.on)((()=>this.surface?.layers),"change",(()=>this._update()))]),this._update())}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),null==this.surfaceView?.extent||null==this.surfaceView.spatialReference)return void this._set("location",null);const e=(0,un.gX)(this.surfaceView.extent),t=new df.A({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then((e=>{this._updateController=null,this._set("location",e.geometry)})).catch((e=>{}))):this._set("location",t)}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],kw.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],kw.prototype,"cache",void 0),(0,ze._)([(0,Qe.MZ)()],kw.prototype,"surface",null),(0,ze._)([(0,Qe.MZ)()],kw.prototype,"surfaceView",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],kw.prototype,"location",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],kw.prototype,"renderLocation",null),kw=(0,ze._)([(0,tt.$)("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],kw);let zw=class extends ht.A{constructor(e){super(e),this._tileGeometryUpdateExtent=(0,un.Ie)(),this._tileGeometryUpdateSpatialReference=null,this.events=new pt.A,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",(e=>this._tileGeometryChanged(e))),this.scheduler.registerTask(ll.W6.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating?(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Uw),(0,un.Ie)(this._tileGeometryUpdateExtent),this._set("updating",!1),cl.G):cl.G}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,(0,un.fT)(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const r=this.centerOnSurfaces[t];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,t){const r=this.state.contentCamera.eye,i=jw,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,Vw,t),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,Bw,t),Vw[0]<Bw[0]?(i[0]=Vw[0],i[2]=Bw[0]):(i[0]=Bw[0],i[2]=Vw[0]),Vw[1]<Bw[1]?(i[1]=Vw[1],i[3]=Bw[1]):(i[1]=Bw[1],i[3]=Vw[1]),(0,un.HY)(i,e)}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],zw.prototype,"state",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],zw.prototype,"centerOnSurfaces",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],zw.prototype,"renderCoordsHelper",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],zw.prototype,"scheduler",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],zw.prototype,"surface",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],zw.prototype,"updating",void 0),zw=(0,ze._)([(0,tt.$)("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],zw);const Uw={},Vw=(0,nn.vt)(),Bw=(0,nn.vt)(),jw=(0,un.Ie)();let Hw=class extends ht.A{constructor(e){super(e),this.renderPointOfView=(0,nn.vt)(),this._pois=new Array,this._debugCenters=new Map,this._tmpRay=(0,Tu.vt)(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new hm.M({renderPointOfView:Gw},this)}initialize(){const{state:e,basemapTerrain:t,renderCoordsHelper:r,map:i}=this.view;this._surfaceIntersector=(0,Id.hz)(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Xv.oH.MIN,this._contentIntersector=(0,Id.hz)(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),s=this.view.resourceController.scheduler,o=this.view.basemapTerrain?.elevationQueryCache,a={state:e,scheduler:s,surface:t,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Mw({...a,task:ll.W6.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new Mw({...a,task:ll.W6.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new Mw({...a,task:ll.W6.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new bw({...a,cache:o,task:ll.W6.POINT_OF_INTEREST_INFREQUENT,map:i})),this._set("surfaceGeometryUpdates",new zw({...a,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Pw({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new kw({cache:o,view:this.view})),this._set("focus",new Lw({state:e,scheduler:s,surface:t,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(e,t)=>this._estimateSurfaceIntersectionAtRenderPoint(e,this.view.state.contentCamera,t)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const l=this.view.graphics;this._debugCenters.set(this.centerOnContent,new yw(l,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new yw(l,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new yw(l,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new yw(l,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new yw(l,"green","Focus")),this.addHandles([(0,gt.wB)((()=>e.contentCamera),(e=>this._cameraChanged(e)),gt.OH),(0,gt.wB)((()=>t.extent),(()=>this._updateCenterPointsOfInterest())),(0,gt.z7)((()=>!t.updating),(()=>this._updateCenterPointsOfInterest()),gt.OH),(0,gt.on)((()=>this.surfaceGeometryUpdates.events),"request-update",(()=>this._updateCenterPointsOfInterest())),(0,gt.on)((()=>this.contentGeometryUpdates.events),"request-update",(()=>this._updateCenterOnContent())),(0,gt.z7)((()=>My.b.SHOW_POI),(e=>this._setDebug(e)),gt.Vh)]),this._cameraChanged(this.view.state.contentCamera);for(const c of this._pois)c.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some((e=>e.updating)))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return null==e||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,Zw,qw)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Zw):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(null==e)return this._surfaceAltitudeAtCenter;const t=e.origin,r=(0,da.g)(Zw,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,r),this._surfaceIntersector.results.min.getIntersectionPoint(Zw)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Zw)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,r){const i=(0,qd.dk)(t,e,$w);if(null==i)return null;const n=i.origin,s=(0,da.g)(Zw,i.origin,i.direction);return this._surfaceIntersector.resetWithRay(i,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,s),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;(0,da.e)(this.renderPointOfView,t)||this._set("renderPointOfView",(0,da.c)(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach((e=>e.hide())),void this.removeHandles("debug");for(const t of this._pois)this.addHandles((0,gt.wB)((()=>t.renderLocation),(e=>this._debugCenters.get(t)?.show(e,t.renderCoordsHelper.spatialReference)),gt.Vh),"debug")}get test(){}};(0,ze._)([(0,Qe.MZ)()],Hw.prototype,"centerOnContent",void 0),(0,ze._)([(0,Qe.MZ)()],Hw.prototype,"centerOnSurfaceFrequent",void 0),(0,ze._)([(0,Qe.MZ)()],Hw.prototype,"centerOnSurfaceInfrequent",void 0),(0,ze._)([(0,Qe.MZ)()],Hw.prototype,"cameraOnSurface",void 0),(0,ze._)([(0,Qe.MZ)()],Hw.prototype,"focus",void 0),(0,ze._)([(0,Qe.MZ)()],Hw.prototype,"renderPointOfView",void 0),(0,ze._)([(0,Qe.MZ)()],Hw.prototype,"surfaceOrigin",void 0),(0,ze._)([(0,Qe.MZ)()],Hw.prototype,"contentGeometryUpdates",void 0),(0,ze._)([(0,Qe.MZ)()],Hw.prototype,"surfaceGeometryUpdates",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],Hw.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)()],Hw.prototype,"updating",null),Hw=(0,ze._)([(0,tt.$)("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],Hw);const Gw=Array,Zw=(0,nn.vt)(),$w=(0,Tu.vt)(),qw={exclude:new Set([Jd.fo])};var Ww=r(23859);class Yw{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,t){this._store.put(e,t,t.values.byteLength+256)}}var Xw=r(542),Jw=r(15255),Kw=r(93938);class Qw{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.min=e,this.max=t,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}}var ex=r(38205);class tx{constructor(e,t,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=t,this.samplerData=new ex.Q(r,t)}computeMinMaxValue(e,t,r,i){i.min=1/0,i.max=-1/0,i.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return i;const s=2**n;if(Math.floor(t/s)!==this.i||Math.floor(r/s)!==this.j)return i;let o=1/0,a=-1/0;const l=this.samplerData.data.width,c=this.samplerData.data.values,u=.5*On.sH;let h=(l-1)/s,d=(r-this.j*s)*h,p=(t-this.i*s)*h;if(h<1){const e=Math.floor(d),t=Math.floor(p),r=e+t*l,n=c[r],s=c[r+1],o=c[r+l],a=c[r+l+1];if(n+s+o+a<u){const r=d-e,l=p-t,c=(0,vo.BI)(n,s,o,a,r,l),u=(0,vo.BI)(n,s,o,a,r+h,l),f=(0,vo.BI)(n,s,o,a,r,l+h),m=(0,vo.BI)(n,s,o,a,r+h,l+h);return i.min=Math.min(c,u,f,m),i.max=Math.max(c,u,f,m),i}d=e,p=t,h=1}else d=Math.floor(d),p=Math.floor(p),h=Math.ceil(h);for(let f=d;f<=d+h;f++)for(let e=p;e<=p+h;e++){const t=c[f+e*l];t<u?(o=Math.min(o,t),a=Math.max(a,t)):i.hasNoDataValues=!0}return i.min=o,i.max=a,i}}const rx=.5*On.sH;function ix(e,t,r){if(null==r)return null;for(const i of r){if(!i)continue;const r=i.safeWidth;let n=(0,ws.qE)(i.dy*(i.y1-t),0,r),s=(0,ws.qE)(i.dx*(e-i.x0),0,r);const o=Math.floor(n),a=Math.floor(s),l=i.data.width,c=o*l+a,u=i.data.values,h=u[c],d=u[c+1],p=c+l,f=u[p],m=u[p+1];if(h+f+d+m<rx){n-=o,s-=a;const e=h+(d-h)*s;return e+(f+(m-f)*s-e)*n}}return null}var nx=r(4225);let sx=class extends ht.A{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",(()=>this.notifyChange("stencilEnabledExtents")))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach((t=>{const r=t.layer;if("operationalLayerType"in r&&(0,vt.If)(r.operationalLayerType)&&null!=this.viewSpatialReference){const t=lx(r.fullExtent,this.viewSpatialReference);null!=t&&e.push((0,un.VY)(t))}})),e}};(0,ze._)([(0,Qe.MZ)({readOnly:!0})],sx.prototype,"layerViewsExtent",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],sx.prototype,"tiledLayersExtent",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],sx.prototype,"stencilEnabledExtents",null),(0,ze._)([(0,Qe.MZ)()],sx.prototype,"viewSpatialReference",void 0),(0,ze._)([(0,Qe.MZ)()],sx.prototype,"tilingScheme",void 0),(0,ze._)([(0,Qe.MZ)()],sx.prototype,"defaultTiledLayersExtent",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],sx.prototype,"layers",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],sx.prototype,"layerViews",void 0),sx=(0,ze._)([(0,tt.$)("esri.views.3d.terrain.ExtentHelper")],sx);let ox=class extends sx{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?On.cf:On.yt}};ox=(0,ze._)([(0,tt.$)("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],ox);let ax=class extends sx{_computeLayerViewsExtent(){const e=(0,un.Ie)(),t=this.viewSpatialReference;this.layerViews.forEach((r=>{const i=r.layer;if(r.isResolved()&&("graphics"!==i.type||!i.internal)){const i=lx("fullExtentInLocalViewSpatialReference"in r&&r.fullExtentInLocalViewSpatialReference||r.layer.fullExtent,t);(0,un.fT)(e,i,e)}}));const r=(0,un.vQ)(e)?e:null,i=this._get("layerViewsExtent");return(0,un.aI)(r,i)?i:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,r=(0,un.Ie)();this.layers.forEach((i=>{if(i.loaded&&(0,vt.qK)(i)){const n=(0,nx.Uo)(i,t,$s.RT.Local);if(null==n)return;const{tileInfo:s,fullExtent:o}=n,a="tilemapCache"in i?i.tilemapCache?.effectiveMaxLOD:void 0;null!=s&&null!=o&&((0,nx.Ci)(i)||e.compatibleWith(s,a)&&o.spatialReference.equals(e.spatialReference))&&(0,un.fT)(r,o,r)}})),(0,un.fT)(r,this.defaultTiledLayersExtent,r);const i=(0,un.vQ)(r)?r:null,n=this._get("tiledLayersExtent");return(0,un.aI)(i,n)?n:i}};function lx(e,t){return null==e||e.spatialReference.equals(t)?e:(0,an.projectWithoutEngine)(e,e.spatialReference,t)}ax=(0,ze._)([(0,tt.$)("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],ax);var cx=r(19539),ux=r(33169),hx=r(83490),dx=r(75507),px=r(45463),fx=r(76044);function mx(){const e=globalThis.require?.modules;if(e){const t=Object.keys(e);for(const r of t)r.includes(".glsl")&&delete e[r]}}const gx=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let yx,_x=class extends ht.A{constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=(0,it.A)("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){const e=this.view;this.renderer=new ux.or({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.plugins.add(this.renderer);const t=()=>this.setDrawTexturesDirty();this._groundIntersector=(0,Id.hz)(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([(0,gt.wB)((()=>this.renderer.hasHighlights),t),this.renderer.events.on("has-water",(t=>e._stage?.renderer.setParameters({hasOverlayWater:t}))),this.renderer.events.on("content-changed",t),(0,gt.wB)((()=>e.state.camera.pixelRatio),t),(0,gt.wB)((()=>e.state.alignPixelEnabled),t),this.renderer.events.on("textures-disposed",(()=>this.surface.requestRender())),(0,gt.wB)((()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location]),(()=>this.setPlacementDirty())),(0,gt.wB)((()=>[e.state?.pixelRatio,e.state?.contentPixelRatio]),(()=>this.setPlacementDirty()),gt.OH),this.surface.on("elevation-change",(()=>this.setPlacementDirty())),e.on("resize",(()=>this.setPlacementDirty())),e.resourceController.scheduler.registerTask(ll.W6.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",(e=>{this._updateOverlays(ll.Bb,e.camera,hx.C7.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(hx.C7.BACKGROUND,e)}))]),e._stage.renderer.renderOverlay=e=>this._renderOverlay(e)}destroy(){this.view?._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{}),yx&&(yx.hide(),yx=null),this.renderer=(0,Je.pR)(this.renderer)}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||My.b.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return null!=this._spatialReference&&this._spatialReference.isGeographic&&!this.view.state.isLocal?(0,pa.tO)(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return 1.3/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}_renderOverlay(e){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._dispatchAnimationUpdate(e),this._drawOverlays(hx.C7.UPDATE,this.view.state)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;null!=e&&null!=t?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Fd.hr(-20037508.342787,20037508.342787):new Fd.hr(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,t,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const i=this.renderer.createDrapeSourceRenderer(e,t,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),i}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,fx.B)}_updateDrapeSourceExtent(e){2===this.renderer.overlays.length&&null!=e.setDrapingExtent&&null!=this._spatialReference&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,hx.C7.UPDATE)}_updateOverlays(e,t,r){if(!this._spatialReference)return cl.G;const i=this._computeOverlayResolution(t);this._computeOverlayExtents(t,i,wx),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,wx.stretch);const n=this._updateOverlay(cx.vr.INNER,wx.inner,i,1*wx.pixelRatioAdjustment,wx.mapUnitsPerPixel),s=(0,un.VL)(wx.inner)/(0,un.VL)(wx.outer),o=this._updateOverlay(cx.vr.OUTER,wx.outer,i,s*wx.pixelRatioAdjustment,wx.mapUnitsPerPixel);n!==Mx.EXTENT&&o!==Mx.EXTENT||(this._drapeSources.forEach((e=>this._updateDrapeSourceExtent(e))),this.surface.updateTileOverlayParams(r)),n===Mx.NONE&&o===Mx.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const t=this.view.state.contentPixelRatio*this.view.resolutionScale,r=e.fullWidth/e.pixelRatio*t,i=e.fullHeight/e.pixelRatio*t,n=Math.ceil(1.5*Math.max(r,i));return Math.min((0,Fa.Mv)(n),this._maxResolution)}_updateOverlay(e,t,r,i,n){if(0===this.renderer.overlays.length)return Mx.NONE;const s=this.renderer.overlays[e],o=s.mapUnitsPerPixel;if(s.mapUnitsPerPixel=n,s.pixelRatio=i,function(e,t){const r=1e-5,i=My.b.TESTS_DISABLE_OPTIMIZATIONS?0:r*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=i&&Math.abs(t[1]-e[1])<=i&&Math.abs(t[2]-e[2])<=i&&Math.abs(t[3]-e[3])<=i}(t,s.extent)&&r===s.resolution)return o===n?Mx.NONE:Mx.RERENDER_ONLY;(0,un.C)(s.extent,t),s.resolution=r;const a=(0,un.gX)(s.extent);return s.renderLocalOrigin=(0,dx.f)(a[0],a[1],0,"OV_"+this._latestOriginId++),Mx.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[cx.vr.INNER],i=this.renderer.overlays[cx.vr.OUTER],n=e.extent;this._rectInsideRect(r.extent,n)||this._rectanglesOverlap(n,r.extent)||this._rectanglesOverlap(n,i.extent)?(this._setTileOverlayData(n,cx.vr.INNER,t),this._setTileOverlayData(n,cx.vr.OUTER,t)):(this._clearTileOverlayData(cx.vr.INNER,t),this._clearTileOverlayData(cx.vr.OUTER,t))}else this._clearTileOverlayData(cx.vr.INNER,t),this._clearTileOverlayData(cx.vr.OUTER,t)}overlayPixelSizeInMapUnits(e,t){if(0===this.renderer.overlays.length)return t();const r=this.renderer.overlays[cx.vr.INNER],i=this.renderer.overlays[cx.vr.OUTER],n=this._pointIsInExtent(e,r.extent)?r:i;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,t,r){if(0===this.renderer.overlays.length)return;const i=this.renderer.overlays[t].extent,n=(0,un.VL)(i),s=(0,un.uJ)(i);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(i[0],o);const t=this._longitudeCyclical.minimalMonotonic(i[0],e[2]);o>t&&(o=t-(e[2]-e[0]))}r.setScale(t,(0,un.VL)(e)/n,(0,un.uJ)(e)/s),r.setOffset(t,(o-i[0])/n,(e[1]-i[1])/s)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){mx(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(ll.Bb)}_dispatchAnimationUpdate(e){const t=(0,ql.l5)(e-this._animationTimeLast);if(t>=this.surface.view._stage.renderer.animationTimestep||null!=this.view.state.forcedAnimationTime||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=(0,ql.l5)(t/this.surface.view._stage.renderer.animationTimeDilation),i=new px.sP(this.view.state.camera,r,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(i)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,t,r,i){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Tx,t,r);if(null==n)return!1;const s=n.origin,o=(0,da.g)(bx,n.origin,n.direction);return this._groundIntersector.reset(s,o,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,s,o),this._groundIntersector.results.min.getIntersectionPoint(i)}_findHorizonBasedPointOfInterest(e,t){let r=.5;const i=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),s=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=(0,ws.qE)(s.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+o,e.aboveGround?n-o:1/0),l=e.aboveGround;if("global"===this.view.viewingMode){const t=bx;(0,Su.e)((0,Su.h)(Su.t,(0,pa.tO)(this.view.spatialReference).radius+a),(0,Tu.LV)(e.eye,e.viewForward),t),(0,da.f)(t,t,e.eye);const n=Fd.wf.normalize((0,Ud.EJ)(e.viewForward,t,e.viewRight))/e.fovY+.5,s=n<=0||n>=1?.5:i;r=l?s*n:n+s*(1-n)}else{const t=.5*Math.PI-Math.acos(-e.viewForward[2]),n=Math.tan(t),s=(0,ya.fA)(0,n,1,0),o=(0,ga.t)(s,s,e.projectionMatrix)[1],a=(0,ws.qE)(.5+.5*o,0,1);r=1===a||0===a?.5:l?a*i:1-(1-a)*i}return!!this._intersectGroundFromView(e,.5,r,t)&&(0,da.w)(t,e.eye)<s.distance*s.distance}_computeOverlayExtents(e,t,r){const i=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=(0,nn.vt)();this._findHorizonBasedPointOfInterest(e,n)||(0,da.c)(n,i),My.b.OVERLAY_SHOW_CENTER?(null==yx&&(yx=new yw(this.view.graphics,"red")),yx.show(n,this._renderSR)):null!=yx&&yx.hide();const s=Math.max(.1,(0,da.p)(e.eye,n)),o=Xu(this.view.renderCoordsHelper,i,e.eye);this._overlaySREqualsRenderSR||(0,Of.F)(n,this._renderSR,n,this._spatialReference);const a=this.surface.extent,l=!this._isSpherical&&this._spatialReference?.isGeographic,c=l&&this._spatialReference?1/(0,pa.tO)(this._spatialReference).metersPerDegree:1,u=this.view.state.contentPixelRatio,h=e.perScreenPixelRatio/u*s*c;r.mapUnitsPerPixel=h/this._worldToPCSRatio,r.stretch=this._overlayStretch;let d=t*h/2*r.stretch,p=!1,f=l?90:1/0;this._isSpherical&&a&&this._spatialReference&&(this._spatialReference.isWebMercator?(d/=Math.cos((0,$r.jg)(n[1])),f=a[3]):(p=!0,d/=(0,pa.tO)(this._spatialReference).metersPerDegree,f=90),d>=f&&(d=f,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let m=1;p&&(m=1/Math.max(.2,Math.cos(Math.abs((0,ws.kU)(n[1])))),d*m>180&&(m=180/d),r.mapUnitsPerPixel*=m);const g=Math.log(2)/12;d=Math.exp(Math.round(Math.log(d)/g)*g);const y=d*m,_=.5*t/(32*y),v=.5*t/(32*d);n[0]=Math.round(n[0]*_)/_,n[1]=Math.round(n[1]*v)/v;const b=r.inner;b[0]=n[0]-y,b[1]=n[1]-d,b[2]=n[0]+y,b[3]=n[1]+d,this._isSpherical&&this._shiftExtentToFitBounds(b,1/0,f);const w=r.outer;if(6*y>(0,un.VL)(a))(0,un.C)(w,a);else if(Math.PI/2-Math.abs(o-Math.PI/2)<=.25*Math.PI)w[0]=b[0]-y,w[1]=b[1]-d,w[2]=b[2]+y,w[3]=b[3]+d;else{(0,Of.F)(e.eye,this._renderSR,bx,this._spatialReference),(0,ma.Re)(vx,n,bx);let t=-Math.atan2(vx[1],vx[0])+.125*Math.PI;t<0&&(t+=2*Math.PI);const r=Math.floor(t/(.25*Math.PI));(0,ga.b)(vx,gx[r],2*d),vx[0]*=m,vx[2]*=m,(0,ga.f)(w,b,vx)}if(this._isSpherical)w[0]=this._longitudeCyclical.clamp(w[0]),w[2]=this._longitudeCyclical.clamp(w[2]),w[1]=Math.max(w[1],-f),w[3]=Math.min(w[3],f);else{const e=(0,un.E$)(b,a,xx),t=(0,un.E$)(w,a,Sx);(0,un.gR)(e,t)&&(w[2]=w[0],w[3]=w[1])}const x=Math.abs(b[2]-b[0])/t;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,x),r.pixelRatioAdjustment=r.mapUnitsPerPixel/x}_drawOverlays(e,t){if(!this.renderer.hasOverlays)return;if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const r=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const i=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(t),i!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(hx.C7.UPDATE),r?(this.surface.requestRender(e),e===hx.C7.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(hx.C7.BACKGROUND),this.renderer}_rectanglesOverlap(e,t){return null!=e&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):(0,un.HY)(e,t))}_rectInsideRect(e,t){return null!=t&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:(0,un.gR)(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const r=e.x,i=e.y;return r>t[0]&&r<t[2]&&i>t[1]&&i<t[3]}_shiftExtentToFitBounds(e,t,r){let i=0,n=0;e[0]<-t?i=e[0]+t:e[2]>t&&(i=t-e[2]),e[1]<-r?n=e[1]+r:e[3]>r&&(n=r-e[3]),(0,un.cY)(e,i,n)}get test(){}};(0,ze._)([(0,Qe.MZ)()],_x.prototype,"_spatialReference",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],_x.prototype,"running",null),(0,ze._)([(0,Qe.MZ)()],_x.prototype,"_placementDirty",void 0),(0,ze._)([(0,Qe.MZ)()],_x.prototype,"_contentUpdated",void 0),(0,ze._)([(0,Qe.MZ)()],_x.prototype,"_isSpherical",null),(0,ze._)([(0,Qe.MZ)()],_x.prototype,"_worldToPCSRatio",null),(0,ze._)([(0,Qe.MZ)()],_x.prototype,"renderer",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],_x.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],_x.prototype,"surface",void 0),(0,ze._)([(0,Qe.MZ)()],_x.prototype,"suspended",null),(0,ze._)([(0,Qe.MZ)()],_x.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)({type:Boolean})],_x.prototype,"rendersOccludedDraped",null),_x=(0,ze._)([(0,tt.$)("esri.views.3d.terrain.OverlayManager")],_x);const vx=(0,ya.vt)(),bx=(0,nn.vt)(),wx=new class{constructor(){this.inner=(0,un.vt)(),this.outer=(0,un.vt)(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=1.3}},xx=(0,un.vt)(),Sx=(0,un.vt)(),Tx=(0,Tu.vt)();var Mx;!function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"}(Mx||(Mx={}));var Ax=r(79341),Cx=r(25672);class Ex{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=(0,If.Ie)(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=(0,Je.Gz)(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,(0,If.Ie)(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(e){return this.outerEdgesOffsetAndLength[2*e]}getEdgeCount(e){return this.outerEdgesOffsetAndLength[2*e+1]}getEdgeVertexIndex(e,t){return this.getEdgeAttributeIndex(e,t)}getEdgeVertexPosition(e,t,r,i){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(e,i),t),(0,da.g)(t,t,r)}getEdgeNormal(e,t,r){const{typedBuffer:i,typedBufferStride:n}=this.vertexAttributes.normalCompressed;(0,Cx.Tz)(t,i,this.getEdgeAttributeIndex(e,r),n)}setEdgeNormalFromValues(e,t,r,i,n){this._setNormal(this.getEdgeAttributeIndex(e,t),r,i,n)}setEdgeVertexFromValuesRawPositionUV(e,t,r,i,n,s,o){const a=this.getEdgeAttributeIndex(e,t);this.vertexAttributes.position.setValues(a,r,i,n),this._setUV(a,s,o)}setEdgeVertexFromValuesRawPositionUVNormal(e,t,r,i,n,s,o,a,l,c){const u=this.getEdgeAttributeIndex(e,t);this.vertexAttributes.position.setValues(u,r,i,n),this._setUV(u,s,o),this._setNormal(u,a,l,c)}_getEdgeVertexRaw(e,t){this.vertexAttributes.position.getVec(e,t)}_setNormal(e,t,r,i){const{typedBuffer:n,typedBufferStride:s}=this.vertexAttributes.normalCompressed;(0,Cx.aT)(n,e,t,r,i,s)}_setUV(e,t,r){Px(this.vertexAttributes.uv0,e,t,r)}getEdgeAttributeIndex(e,t){return(0,nx.GH)(0<=t&&t<this.getEdgeCount(e)),this.getEdgeFirstVertexIndex(e)+t}}const Rx=16384;function Px(e,t,r,i){e.setValues(t,r*Rx,i*Rx)}class Ox{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}}class Ix{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=(0,Je.pR)(this._current),this._next=(0,Je.pR)(this._next),this._waiting=(0,Je.pR)(this._waiting),this._delayed=(0,Je.pR)(this._delayed)}get current(){if(null==this._current)return null;if(!this._isFadingEnabled){const e=this._delayed||this._waiting||this._next||this._current;e!==this._current&&(this._current=null,this.clear(),this._current=e)}let e=Ix.test.fadeMoment;if(null!=this._delayed&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,Lx.Immediate),this._delayed=null)),null!=this._next){e=e||performance.now();const t=this._fadeDuration,r=null!=this._current&&this._next.texture===this._current.texture,i=this._next.type!==cx.ZY.FADING,n=e-this._fadeStart>=t;(r||i||n)&&((0,Je.pR)(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(null==this._next)return 1;const e=Ix.test.fadeMoment||performance.now(),t=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return t>r?0:1-t/r}get isFading(){return null!=this._next||null!=this._delayed}push(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Lx.Immediate;this._delayed=(0,Je.pR)(this._delayed),this._push(e,t)}_push(e,t){if(this._isFadingEnabled||this.clear(),null==this._current)return void(this._current=e);const r=Ix.test.fadeMoment||performance.now();return t!==Lx.Immediate?(this._delayed=e,void(this._delayedTime=r+t)):null==this._next?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(null!=e&&((0,Je.pR)(this._waiting),this._waiting=e))}get _fadeDuration(){return null==this._waiting?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const t=this._getFadeDuration();return e+t-e%t}get _isFadingEnabled(){return this._getFadeDuration()>0}}var Lx;Ix.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(Lx||(Lx={}));var Nx=r(9902);class Dx{get updating(){return!!this._tileRequested}init(e,t,r,i){this.tile=e,this._layerIdx=t,this._layerClass=r,this._suspended=i,this._tileLayerInfo=e.getLayerInfo(t,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,t){this._setUpsampleTile(e,t),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,cx.ZY.FADING,t):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return null!=e?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,t=this._layerClass,r=this.tile.surface.layerViewByIndex(e,t),i=(0,nx.BU)(r),{minLevel:n,maxLevel:s}=r.dataLevelRange,o=this._desiredMinLevelDelta,a=this._progressiveLevelModulo+o,l=this._scaleRangeEnabled?Nx.D_:()=>!0;let c=this.tile;const u=c.level;let h;const d=this._tileLayerInfo.upsampleInfo,p=null!=d?d.tile.level:-1,f=null!=d&&p-u>=o,m=i?.tilemapCache,g="vector-tile-3d"===r.type?r.schemaHelper:null;for(;c&&l(c,i,!1)&&c.level>=n;){const r=c.level,i=u-r,l=c.layerInfo[t][e];if(l.data&&i>=o){(!f||r>p)&&this._setUpsampleTile(c),l.dataInvalidated&&(h=c);break}const d=g?.getLevelRowColumn(c.lij)??c.lij;if("unavailable"!==m?.getAvailability(d[0],d[1],d[2])&&r<=s&&!l.data&&!l.dataMissing&&((!h||c.level===n||r%On.EY==0||u-h.level<o)&&(h=c),i>=a))break;c=c.parent}if(null!=h&&u-h.level<o)if(d)h=null;else{const r=this._findAncestorWithData();null!=r&&(this._setUpsampleTile(r),h=r.layerInfo[t][e].dataInvalidated?r:null)}return h}_findAncestorWithData(){const e=this.tile.elevationLevel,t=this._desiredMinLevelDelta;let r;for(let i=this.tile;i;i=i.parent)if(i.hasLayerData(this._layerIdx,this._layerClass)){if(e-i.level>=t)return i;r=i}return r}_setUpsampleTile(e,t){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,cx.ZY.FADING,t)}get test(){}}const Fx=new Error("Abstract method called on TileAgent"),kx=new class extends Dx{constructor(){super(...arguments),this.type="none"}get _desiredMinLevelDelta(){throw Fx}get _progressiveLevelModulo(){throw Fx}dispose(){}};var zx;!function(e){e[e.INSIDE=0]="INSIDE",e[e.INTERSECTS=1]="INTERSECTS",e[e.OUTSIDE=2]="OUTSIDE"}(zx||(zx={}));class Ux{constructor(){this.waitingAgents=new Ty.A,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const t=Vx.acquire();return t._init(e),t}release(){this.dispose(),Bx.delete(this),Vx.release(this)}dispose(){this.loadingAgent=(0,Je.WD)(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=(0,nx.n8)(this._data)}static prune(){Vx.prune(0)}_init(e){this.waitingAgents.clear(),this._data=(0,nx.n8)(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=(0,Je.DC)(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){null!=this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,t){if(e!==t&&null!=t){if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===t)return;this._upsampleInfo.tile.unrefMapData()}t.refMapData(),(0,Nx.vx)(e,t,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){(0,nx.n8)(this._data),this._data=e}}const Vx=new f_.A(Ux,null,(()=>{})),Bx=new Map;var jx;!function(e){e[e.NONE=0]="NONE",e[e.SPLIT=1]="SPLIT",e[e.ELEVATION=2]="ELEVATION",e[e.MERGE=4]="MERGE",e[e.GEOMETRY=8]="GEOMETRY",e[e.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=32]="TEXTURE_FADING"}(jx||(jx={}));class Hx{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=(0,un.vt)(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=(0,un.vt)(),this.centerAtSeaLevel=(0,nn.vt)(),this._center=[(0,nn.vt)(),(0,Su.c)(),(0,nn.vt)()],this.up=(0,nn.TS)(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=(0,nn.vt)(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){$x.prune(0),qx.prune(0),Ux.prune()}get _isCached(){return!this.isLeaf&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Yx.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,t=e?.frustumVisibility??zx.INTERSECTS;this._frustumVisibility=t===zx.INSIDE?zx.INSIDE:t===zx.OUTSIDE?zx.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==zx.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}init(e,t,r,i,n){this._lij[0]=e,this._lij[1]=t,this._lij[2]=r,this.ellipsoid=(0,pa.tO)(n.tilingScheme.spatialReference),n.tilingScheme.getExtent(e,t,r,this.extent),n.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,n.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Yx.MIDDLE][3]=0,this.elevationLevel=e,i&&!Number.isNaN(i.elevationBoundsMin)?(this._elevationBoundsMin=i.elevationBoundsMin,this._elevationBoundsMax=i.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=i,this.unsetChildren(),this._surface=n,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const s of Tb){const e=n.numLayers(s),t=this.layerInfo[s];for(const r of t)r.release();t.length=e;for(let r=0;r<e;r++)t[r]=Ux.acquire(this._surface.upsampleInfoPool),s===wb.ELEVATION&&this.findElevationBoundsForLayer(r,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(n.tilingScheme.pixelSize,On.Me)}dispose(){(0,nx.bk)(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of Tb){for(const t of this.layerInfo[e])t.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[wb.MAP].reduce(((e,t)=>{let{data:r}=t;return e+((0,Zb.kC)(r)?r.usedMemory/r.referenced:0)}),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const e=this._surface.tilingScheme.pixelSize;return e*e*4}_ensureUsedMemory(){if(null!=this._usedMemory)return this._usedMemory;this._usedMemory=this._baseUsedMemory,this._mapTileMemoryInternal=0;let e=0;for(const{data:r}of this.layerInfo[wb.MAP])(0,Zb.kC)(r)?e+=this._getTerrainDataMemory(r):this._mapTileMemoryInternal+=this._getTerrainDataMemory(r);const t=this._cpuImageMemorySize;for(const r of this.layerInfo[wb.ELEVATION])this._usedMemory+=r.data?t:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=this.renderData.texture?.usedMemory??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,t){const r=this.layerInfo[e][t];return r?.data?e===wb.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):e===wb.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return(0,Zb.Cs)(e)?e.texture.usedMemory:(0,Zb.k$)(e)?e.memoryUsage:(0,Zb.kC)(e)?e.usedMemory/e.referenced:(0,Zb.EM)(e)||e instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(e){const t=this._center[Yx.MIDDLE],r=e,i=t[0],n=t[1],s=t[2],o=r[2]*i+r[6]*n+r[10]*s+r[14];this.screenDepth=o<0?0:o/(r[3]*i+r[7]*n+r[11]*s+r[15])}shouldSplit(e,t,r){if(!this.visible)return jx.NONE;if(e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===zx.OUTSIDE))return jx.NONE;const i=this.level;(0,da.f)(tS,(0,Su.g)(this._center[Yx.MIDDLE]),t);let n=(0,da.q)(tS),s=tS,o=(0,Su.g)(this._center[Yx.MIDDLE]);(0,da.f)(rS,this._center[Yx.TOP],t);const a=(0,da.q)(rS);a<n&&(n=a,s=rS,o=this._center[Yx.TOP]),(0,da.f)(iS,this._center[Yx.BOTTOM],t);const l=(0,da.q)(iS);if(l<n&&(n=l,s=iS,o=this._center[Yx.BOTTOM]),this._edgeLen2>n&&i<e.maxLod)return jx.SPLIT;const c=Math.sqrt(n),u=e.fovX*c*2,h=this._edgeLen/u,d=()=>{if(i<e.maxLod)return this.elevationLevel=i,jx.NONE;const t=i+Math.ceil(-Math.log2(e.relativeWidthLimit/h));return t!==this.elevationLevel?(this.elevationLevel=t,jx.ELEVATION):jx.NONE},p=null!=r?r-i:1/0;if(p<=.5)return d();const f=(0,da.m)(this.up,tS),m=this._elevationBoundsMax-this._elevationBoundsMin,g=m/this.edgeLen;if(e.aboveGround&&f>0&&g<.001&&f/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-g>0)return jx.NONE;const y=null!=r?3-Math.min(p,2):1;if(h*y<e.relativeWidthLimit||i>=e.maxLod)return d();if(i<7)return jx.SPLIT;(0,da.j)(nS,this.up,f),(0,da.f)(nS,nS,s);const _=(0,da.q)(nS);if(_<=this.radius*this.radius)return jx.SPLIT;(0,da.j)(nS,nS,this.radius/Math.sqrt(_)),(0,da.g)(nS,nS,o),(0,da.f)(nS,t,nS);const v=Math.min(1,(Math.abs((0,da.m)(nS,this.up))+.5*m+this._curvatureHeight)/(0,da.l)(nS)),b=.1/e.angledSplitBias,w=e.fovY*c*2;return v*(this._edgeLen/w*y)<b*e.relativeHeightLimit?jx.NONE:jx.SPLIT}setChildren(e,t,r,i){(0,nx.bk)(!!(e&&t&&r&&i),"Null child passed");const n=this._children;return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const e of Tb)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const t of Tb){const e=this.layerInfo[t];for(const t of e)t.loadingAgent&&t.loadingAgent!==kx&&(Zx(t.loadingAgent),t.loadingAgent=null),t.pendingUpdates=0}this.resetPendingUpdate(jx.GEOMETRY),this.resetPendingUpdate(jx.TEXTURE_NOFADING),this.resetPendingUpdate(jx.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[wb.MAP];for(const t of e)t.loadingAgent&&t.loadingAgent!==kx&&(Zx(t.loadingAgent),t.loadingAgent=null),t.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if((0,un.aI)(e,this._clippingArea))return!1;const t=this._intersectsClippingArea,r=this._isWithinClippingArea;null!=e?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const i=r&&this._isWithinClippingArea,n=!(r||t||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||i||n||this.setPendingUpdate(jx.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,t){return this.layerInfo[t][e]}hasLayerData(e,t){const r=this.layerInfo[t][e];return!(!r?.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of Tb){const t=this.layerInfo[e];for(const e of t)if(e.loadingAgent&&e.loadingAgent!==kx&&e.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(jx.SPLIT)||e!==wb.ELEVATION&&!this.loadable}get hasPendingUpdates(){return 0!==this._pendingUpdates}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){const t=this._pendingUpdates;return this._pendingUpdates|=e,e===jx.SPLIT||e===jx.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),t!==this._pendingUpdates}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,t,r){const i=this.layerInfo[t][e];if(i.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),t,e),!0;if(i.waitingAgents.push(r),i.data&&!i.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),t,e);const n=(0,Zb.kC)(i.data);return r.dataArrived(this,n),!0}if(i.requestPromise)return!0;(0,Je.DC)(i.requestAbort),i.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,t,i.requestAbort);if(!n)return i.requestAbort=null,!1;const s=()=>{i.requestPromise===n&&(i.requestPromise=null,i.requestAbort=null)};return i.requestPromise=n,n.then(s,s),!0}get isLeaf(){return null==this._children[0]}hasLij(e){return this._lij[0]===e[0]&&this._lij[1]===e[1]&&this._lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const t=this._children;return t[0]?t[0].findByLij(e)||t[1].findByLij(e)||t[2].findByLij(e)||t[3].findByLij(e):null}distanceToSquared(e){return(0,da.q)((0,da.f)(nS,(0,Su.g)(this._center[Yx.MIDDLE]),e))}containsPoint(e){const t=this.extent;return e[0]>=t[0]&&e[1]>=t[1]&&e[0]<=t[2]&&e[1]<=t[3]}containsPointXY(e,t){const r=this.extent;return e>=r[0]&&t>=r[1]&&e<=r[2]&&t<=r[3]}unrequestLayerData(e,t,r){const i=this.layerInfo[t][e],n=i.waitingAgents,s=null!=n.removeUnordered(r);(0,nx.bk)(s,"agent has not requested this piece of map data"),n.length<1&&(i.abortRequest(),this.setMemoryDirty())}dataArrived(e,t,r){const i=(0,Zb.kC)(r),n=this.layerInfo[t][e];n.data=r,n.dataInvalidated=!1,n.waitingAgents.forAll((e=>e.dataArrived(this,i))),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,t){const r=this.layerInfo[t][e];r.dataMissing=!0,r.waitingAgents.forAll((e=>e.dataMissing())),r.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,t,r){switch(r&&this.forEachLoadedNeighbor((r=>r.updateRenderData(e,t))),e){case wb.MAP:return this._updateTexture(t);case wb.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===cx.ZY.FADING?jx.TEXTURE_NOFADING:jx.TEXTURE_FADING),this.setPendingUpdate(e===cx.ZY.FADING?jx.TEXTURE_FADING:jx.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(jx.GEOMETRY);for(const e of this.layerInfo[wb.ELEVATION])e.pendingUpdates|=jx.GEOMETRY}invalidateLayerData(e,t){this.layerInfo[t][e].invalidateSourceData(),this.restartAgents(t)}computeElevationBounds(){const e=this._elevationBoundsMin,t=this._elevationBoundsMax;let r=1/0,i=-1/0;const n=this.layerInfo[wb.ELEVATION];let s=!0;for(const o of n)null!=o.elevationBounds&&(r=Math.min(r,o.elevationBounds.min),i=Math.max(i,o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(s=!1));s&&(r=Math.min(r,0),i=Math.max(i,0)),e===r&&t===i||(this._elevationBoundsMin=r,this._elevationBoundsMax=i,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBoundsMin,t=this._elevationBoundsMax,r=.5*(e+t),i=this._center;(0,da.j)(nS,this.up,r),(0,da.g)((0,Su.g)(i[Yx.MIDDLE]),this.centerAtSeaLevel,nS),(0,da.j)(nS,this.up,e),(0,da.g)(i[Yx.TOP],this.centerAtSeaLevel,nS),(0,da.j)(nS,this.up,t),(0,da.g)(i[Yx.BOTTOM],this.centerAtSeaLevel,nS)}findElevationBoundsForLayer(e,t){const r=this.layerInfo[wb.ELEVATION][e],i=this.elevationLevelDelta,n=Math.max(this.elevationLevel-i,0),s=r.elevationBounds;if(null!=s&&s.level>=t&&s.level<=n)return;const o=this._surface.layerViewByIndex(e,wb.ELEVATION),a=(0,nx.BU)(o);if(!(0,Nx.D_)(this,a,!1))return;const l=Wx;let c=!1;const u=r.data;if(u&&u.level<=n){const e=r.data;l.min=e.samplerData.data.minValue,l.max=e.samplerData.data.maxValue,l.hasNoDataValues=e.samplerData.data.hasNoDataValues,l.level=this.level,c=!0}else{let t,r,s=0;for(let o=this._parent;o&&(!r||s<i)&&(s=this.elevationLevel-o.level,t=r||t,r=o.layerInfo[wb.ELEVATION][e].data,!(!r&&t&&o.level<=n));o=o.parent);r=r||t,r&&(r.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],l),l.min!==1/0&&(l.level=r.level,c=!0))}c&&(null==r.elevationBounds&&(r.elevationBounds=new Qw),r.elevationBounds.copyFrom(l))}modifyLayers(e,t,r){const i=this.layerInfo[r];for(const o of i)o.loadingAgent&&o.loadingAgent!==kx&&(Zx(o.loadingAgent),o.loadingAgent=null),o.waitingAgents.clear();for(let o=0;o<i.length;++o)void 0===e[o]&&i[o].release();const n=new Array(...i),s=t.length;i.length=s;for(let o=0;o<s;o++){const e=t[o];i[o]=e>-1?n[e]:Ux.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,cx.ZY.FADING))}updateAgents(e){if(this.renderData){const t=this.layerInfo[e];for(const e of t)e.loadingAgent===kx&&(e.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of Tb){const t=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==kx&&(r.loadingAgent.setSuspension(t),r.loadingAgent===kx&&this.updateRenderData(e,cx.ZY.FADING))}}removeLayerAgent(e,t){const r=this.layerInfo[t][e];r.loadingAgent&&r.loadingAgent!==kx&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,t){const r=this.layerInfo[t][e];r.loadingAgent=kx,r.data||null!=r.upsampleInfo||this._createOrUpdateAgents(e+1,t)}_hasBlendableAncestor(e){return"normal"!==e.blendMode||(0,vt.jZ)(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,t,r){for(let i=e;i<t;++i){const e=this._surface.layerViewByIndex(i,r);if((0,nx.KE)(e)&&"normal"!==e?.layer?.blendMode||(0,vt.jZ)(e?.layer?.parent)&&this._hasBlendableAncestor(e?.layer?.parent))return!0}return!1}_createOrUpdateAgents(e,t){const r=this.layerInfo[t];if(0===r.length)return;const i=this._isSuspended(t);for(let n=e;n<r.length;++n){const s=r[n];let o=!1;const a=this._surface.layerViewByIndex(n,t),l=(0,nx.BU)(a);if(s.loadingAgent?(0,Nx.D_)(this,l,!1)?(s.loadingAgent!==kx&&s.loadingAgent.setSuspension(i),s.loadingAgent!==kx&&(o=s.loadingAgent.update())):s.dispose():(0,Nx.D_)(this,l,!1)&&(s.loadingAgent=Gx(this,n,t,i),o=s.loadingAgent.startLoading(),o?s.loadingAgent===kx&&this.setPendingUpdate(jx.GEOMETRY):(Zx(s.loadingAgent),s.loadingAgent=kx)),s.loadingAgent===kx&&this.updateRenderData(t,cx.ZY.FADING),!this._hasBlendModes(e,r.length,t)&&o&&a.isOpaque)return}}_isWithinExtent(e){const t=this.extent;return t[0]>=e[0]&&e[2]>=t[2]&&t[1]>=e[1]&&e[3]>=t[3]}intersectsExtent(e){const t=this.extent;return t[2]>=e[0]&&e[2]>=t[0]&&t[3]>=e[1]&&e[3]>=t[1]}getElevationVerticesPerSide(e){const t=this.elevationLevel-this.level,r=Math.max(this.level-e,this.elevationLevelDelta-t),i=(0,ws.qE)(1+(this.maxTesselation>>r),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(i,n)}_findLIJ(e,t){if(!e)return null;const r=this.surface.rootTiles;if(null!=r)for(const i of r)if(Xx(i,e)){let r=i,n=e[0]-r.level-1;for(;n>=0&&!r.isLeaf&&!t(r);){const t=e[1]>>n&1,i=e[2]>>n&1;r=r.children[2*t+i],n--}return t(r)?r:null}return null}findNeighborTile(e,t){const r=this._lij,i=this.getNeighborLIJ(r,e);return i?Jx(r,i)?t(this)?this:null:this._findLIJ(i,t):null}findCorner(e,t){const r=e===Ax.N.NORTH_EAST?1:e===Ax.N.NORTH_WEST?0:e===Ax.N.SOUTH_WEST?2:3;let i=this;for(;i.children[0]&&(!t||!t(i));)i=i.children[r];return i}findNeighborCornerTileExact(e,t){return this.findNeighborTile(e,(e=>t(e)||e.level===this.level))?.findCorner((0,nx.jj)(e),t)||null}forAllSubtreeOnSide(e,t){const r=e===Ax.N.NORTH?[0,1]:e===Ax.N.NORTH_EAST?[1]:e===Ax.N.EAST?[1,3]:e===Ax.N.SOUTH_EAST?[3]:e===Ax.N.SOUTH?[2,3]:e===Ax.N.SOUTH_WEST?[2]:e===Ax.N.WEST?[0,2]:[0],i=e=>{const n=e.children;!t(e)&&n[0]&&r.forEach((e=>i(n[e])))};i(this)}getNeighborEdgeStartVertexIndex(e,t){if(!t)return 0;const r=this.level-t.level;if((0,nx.GH)(!nx.L8||r>=0),0===r)return 0;const i=2**r,n=!(1&~e),s=n?0:1,o=t.lij[s+1]*i,a=this._lij[s+1],l=a-o,c=n?i-1-l:l;return nx.L8&&((0,nx.GH)(o<=a&&a<o+i),(0,nx.GH)(0<=c&&c<i)),c}forEachLoadedNeighbor(e){const t=this.level,r=e=>e.level===t||e.isLoaded;nx.Rz.forEach((t=>{const i=this.findNeighborTile(t,r);null!=i&&i!==this&&i.forAllSubtreeOnSide((0,nx.JM)(t),(r=>!!r.isLoaded&&(e(r,t),!0)))})),nx.XQ.forEach((t=>{const i=this.findNeighborTile(t,r)?.findCorner((0,nx.jj)(t),(e=>e.isLoaded));(0,nx.GH)(!i||Kx(this,i,t)),i?.isLoaded&&e(i,t)}))}getNeighborLIJ(e,t){const r=(0,nx.uK)(t)?-1:(0,nx.mJ)(t)?1:0,i=(0,nx.Ec)(t)?-1:(0,nx.sZ)(t)?1:0,n=[e[0],e[1]+r,e[2]+i];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return 0===this._lij[2]}get isNorthEnd(){return 0===this._lij[1]}get isSouthEnd(){const e=this.surface.extent,t=e?.[1]??null;return null!=t&&this.extent[1]+(0,nd.FD)()>=t}checkGeometryWaterproofness(){nx.aL&&((0,nx.GH)(this.isLoaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const t=this.extent,r=this.surface.rootTilesExtent,i=.25*(t[2]-t[0]);if((0,nx.uK)(e)&&t[3]+i>=r[3])return!1;if((0,nx.mJ)(e)&&t[1]-i<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&(0,nx.Ec)(e)&&t[0]-i<=r[0])&&!(!n&&(0,nx.sZ)(e)&&t[2]+i>=r[2])}updateDistanceToPOI(e){const t=this._lastPOI;if(this.distanceToPOI>=0&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return;(0,da.c)(this._lastPOI,e);const r=this._center[Yx.MIDDLE],i=e[0]-r[0],n=e[1]-r[1],s=e[2]-r[2];this.distanceToPOI=i*i+n*n+s*s}get test(){return{cachedMemory:this._cachedMemory}}}function Gx(e,t,r,i){const n=r===wb.ELEVATION?qx.acquire():$x.acquire();return n.init(e,t,r,i),n}function Zx(e){e.dispose(),function(e){return"elevation"===e.type}(e)?qx.release(e):function(e){return"map"===e.type}(e)&&$x.release(e)}const $x=new f_.A(class extends Dx{constructor(){super(),this.type="map",this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return On.EY}}),qx=new f_.A(class extends Dx{constructor(){super(...arguments),this.type="elevation",this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}),Wx=new Qw;var Yx;function Xx(e,t){const r=e.lij,i=t[0]-r[0];return!(i<0)&&t[1]>>i===r[1]&&t[2]>>i===r[2]}function Jx(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Kx(e,t,r){return null!=e&&null!=t&&t!==e&&(e.level>=t.level?Qx(e,t,r):Qx(t,e,(0,nx.jj)(r)))}function Qx(e,t,r){(0,nx.GH)(e.level>=t.level);const i=(0,nx.hL)(r),n=(0,nx.HF)(r),s=e.extent,o=t.extent,a=[i?s[0]:s[2],n?s[3]:s[1]],l=[i?o[2]:o[0],n?o[1]:o[3]],c=1e-5*(s[2]-s[0]),u=(0,nx.yL)(a[0],l[0],c)||e.surface.isGlobal&&(0,nx.yL)(a[0],-l[0],c),h=(0,nx.yL)(a[1],l[1],c);if(u&&h)return!0;if(e.level===t.level)return(0,nx.GH)(!1),!1;if(!u&&!h)return(0,nx.GH)(!1),!1;const d=u?eS(o[1],o[3],s[1],s[3],c):eS(o[0],o[2],s[0],s[2],c);return(0,nx.GH)(d),d}function eS(e,t,r,i,n){return e-n<=r&&r<=i&&i<=t+n}!function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"}(Yx||(Yx={}));const tS=(0,nn.vt)(),rS=(0,nn.vt)(),iS=(0,nn.vt)(),nS=(0,nn.vt)();class sS{constructor(){this._scales=(0,ya.fA)(-1,-1,-1,-1),this._offsets=(0,ya.fA)(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,t,r){this._scales[2*e]=t,this._scales[2*e+1]=r}setOffset(e,t,r){this._offsets[2*e]=t,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}}var oS=r(34981),aS=r(43074),lS=r(96643);class cS extends Sa.w{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,t){t.spherical=e.viewingMode===$s.RT.Global}initializeProgram(e){return new Ma.B(e.rctx,cS.shader.get().build(this.configuration),uS)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const t=this.configuration,r=t.backfaceCullingEnabled&&!t.renderOccluded;return(0,Ca.Ey)({blending:t.renderOccluded?(0,Ca.ox)(Aa.dn.ONE,Aa.dn.ONE_MINUS_SRC_ALPHA):null,culling:r?Ca.PI:null,depthTest:t.renderOccluded?null:{func:Aa.MT.LESS},depthWrite:t.renderOccluded?null:Ca.kn,colorWrite:Ca.wE,stencilTest:e?(0,lS.Rv)(hx.dd.IntegratedMeshMaskExcluded):null,drawBuffers:t.output===oS.V.Depth?{buffers:[Aa.Hr.NONE]}:null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}}cS.shader=new xa.$(aS.a,(()=>r.e(5674).then(r.bind(r,45674))));const uS=new Map([[El.r.POSITION,0],[El.r.UV0,1],[El.r.NORMALCOMPRESSED,2]]);class hS{constructor(){this.geometry=new Ex,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureRef=new Ix((()=>this.tile.surface.fadeDuration)),this.overlay=new sS,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(e,t){this.clear(),this._tile=e,this.geometry.reset(),this.intersectionData=null,this.geometryState=new Ox,this._localOrigin=t,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),nx.L8&&this.tile.intersectsClippingArea)for(let t=0;t<4;++t)(0,nx.GH)(this.geometry.getEdgeCount(t)===this.geometryState.edgeResolutions[t]+1)}_calculateEdgeResolution(e,t){const r=this.tile,i=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const t=r.surface.extent;if(null!=t&&(0===e&&r.extent[3]>t[3]||1===e&&r.extent[2]>t[2]||2===e&&r.extent[1]<t[1]||3===e&&r.extent[0]<t[0]))return i}const n=r.level,s=nx.Rz[e];if(!t)return(0,nx.GH)(null==r.surface?.rootTiles||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(s)),i;if(t.isLoaded){const r=t,s=r.renderData.geometryState,o=n-r.level;if((0,nx.GH)(o>=0),0===o){const e=s.numVerticesPerSide-1;return Math.max(e,i)}const a=2**o,l=s.edgeResolutions[(e+2)%4]/a;return Math.max(1,l)}(0,nx.GH)(!t.isLeaf);let o=i;return t.forAllSubtreeOnSide((0,nx.JM)(s),(e=>e===r||(e.isLoaded?(o=Math.max(o,2**(e.level-n)),!0):((0,nx.GH)(!e.isLeaf),!1)))),o}updateNeighborData(){const e=this.tile;if(!e.intersectsClippingArea)return;const t=e.renderData.geometryState,r=t=>(t.isLoaded||t.level===e.level)&&t?.intersectsClippingArea,i=t.edgePeerNeighbors,n=t.edgePeerNeighborSamplerVersions;for(let s=0;s<4;++s){const o=e.findNeighborTile(nx.Rz[s],r),a=bS(e,o),l=a?.renderData?.geometryState.samplerDataVersion??-1,c=i[s],u=a!==bS(e,c),h=n[s]!==l;nx.L8&&o&&((0,nx.GH)(e.level>=o.level),(0,nx.GH)(e.level-o.level<=On.nU)),i[s]=o,(u||h)&&(n[s]=l,this._markEdgeDirty(s));const d=t.edgeResolutions[s],p=this._calculateEdgeResolution(s,o);(0,nx.GH)((0,ws.r6)(p)),(0,nx.GH)(p>=1),t.edgeResolutions[s]=p,d!==p&&this._markEdgeResolutionDirty(s)}for(let s=0;s<4;++s){const n=e.findNeighborTile(nx.XQ[s],r);t.cornerPeerNeighbors[s]=n;const o=bS(e,i[s]),a=bS(e,i[(s+1)%4]),l=bS(e,n);vS[s]=l,vS[(s+1)%4]=a,vS[(s+2)%4]=e,vS[(s+3)%4]=o,(0,nx.GH)(vS.some((t=>t?.isLoaded||t===e)));const c=vS.reduce(((e,t)=>Math.min(e,t?.level??1/0)),1/0);vS.forEach(((e,t)=>{e&&e?.level>c&&(vS[t]=null)})),(0,nx.GH)(vS.some((t=>t?.isLoaded||t===e)));const u=t.cornerNeighborCornerTiles,h=t.cornerNeighborCornerTileSamplerVersions;for(let e=0;e<4;++e){const t=vS[e],r=t?.renderData.geometryState.samplerDataVersion??-1,i=4*s+e,n=u[i]!==t,o=!n&&h[i]!==r;(n||o)&&(u[i]=t,h[i]=r,this._markCornerDirty(s))}nx.L8&&(0,nx.GH)(ES.some((t=>u[4*s+t]?.isLoaded||u[4*s+t]===e)))}nx.L8&&(0,nx.GH)(this.geometryState.edgeResolutions.every((e=>e>0)));for(let s=0;s<4;++s)vS[s]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;nx.L8&&(0,nx.GH)(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every((e=>e>0))),this.intersectionData=null;const{tile:t,_vao:r,geometry:i,geometryState:n}=this,s=!r||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,o=0!==this.dirtyEdgeResolutions,a=n.edgeResolutions.reduce(((e,t)=>e+t+1),0),l=s||o&&a>(i?.maxEdgeVertexCount??0),c=!l&&o,u=!c&&(0!==this.dirtyEdges||o),h=!u&&0!==this.dirtyCorners;l?(this.releaseGeometry(),this._createGeometry(e)):c?t.updateEdgeElevationsAndResolutions():u||h?t.updateEdgeElevations():h?t.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=(0,Je.WD)(this._vao),this.geometry.release(),!0)}ensureTexture(e,t,r){const i=t?Aa.Ab.RGBA:Aa.Ab.RGB;return null==this._texture||this._texture.descriptor.width===e&&this._texture.descriptor.pixelFormat===i||this.releaseTexture(),null==this._texture&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){null!=this._texture&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}get numVerticesPerSideChanged(){return!!(this._modifiedFlags&wS)}get samplerDataChanged(){return!!(this._modifiedFlags&xS)}get clippingAreaChanged(){return!!(this._modifiedFlags&SS)}get wireframeChanged(){return!!(this._modifiedFlags&TS)}get dirtyEdges(){return this._modifiedFlags>>MS&15}get dirtyCorners(){return this._modifiedFlags>>AS&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>CS&15}_markCornerDirty(e){const t=1<<e<<AS;this._modifiedFlags|=t}_markEdgeDirty(e){const t=1<<e<<MS;this._modifiedFlags|=t,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const t=1<<e<<CS;this._modifiedFlags|=t,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<AS|15<<MS|15<<CS}updateGeometryState(){const e=this._getElevationInfo(),t=this.tile,r=e.samplerData?t.getElevationVerticesPerSide(e.maxTileLevel):t.getDefaultVerticesPerSide(),i=Math.max(r,5);let n=t.clippingArea;t.intersectsClippingArea&&!t.isWithinClippingArea||(n=null);const s=this.geometryState;let o=!1;s.numVerticesPerSide!==i&&(this._modifiedFlags|=1,s.numVerticesPerSide=i,s.samplerDataVersion++,o=!0),e.changed&&(this._modifiedFlags|=2,s.samplerData=e.samplerData,s.samplerDataVersion++,o=!0),(0,Dt.aI)(s.clippingArea,n)||(this._modifiedFlags=4,s.clippingArea=n,o=!0);const a=t.surface.wireframe;return s.wireframe!==a&&(this._modifiedFlags=8,s.wireframe=a,o=!0),this._geometryStateChangedSinceLastUpdate||=o,o&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const t=this.geometry.vertexAttributes,r=this.geometry.indices,i=e.gl;this._vao=new Cl.Z(e,uS,{geometry:(0,Tl.U)(t.layout)},{geometry:Rl.g.createVertex(e,i.STATIC_DRAW,t.buffer)},Rl.g.createIndex(e,i.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Lx.Immediate;null!=e&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,t)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,t=this.tile.layerInfo[wb.ELEVATION],r=t.length,i=new Array(r);let n=0,s=0,o=!1;for(let c=0;c<r;c++){const r=t[c];if(null!=r.upsampleInfo){const t=r.upsampleInfo.tile,a=t.layerInfo[wb.ELEVATION][c].data,l=a&&a.samplerData;e&&e[n]===l||(o=!0),i[n++]=l,s=Math.max(s,t.lij[0])}else if(r.data){const t=this.tile.surface.layerViewByIndex(c,wb.ELEVATION);if((0,Nx.D_)(this.tile,t.layer,!1)){const t=r.data;e&&e[n]===t.samplerData||(o=!0),i[n++]=t.samplerData,s=this.tile.level}}}null!=e&&e.length!==n&&(o=!0);const a=n>0,l=a?i:null;return a&&(i.length=n),{changed:o,samplerData:l,maxTileLevel:s}}get estimatedGeometryMemoryUsage(){const e=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+e}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(!nx.L8)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||0===e.level)return void(0,nx.GH)(e?.isLoaded);const t=e.surface.extent;if(null!=t&&!e.intersectsExtent(t))return;const r=nx.Rz.map(((r,i)=>null!=t&&(i<2?-1:1)*(e.extent[3-i]-t[3-i])<0)),i=e.level;(0,nx.GH)(0===this.dirtyCorners),(0,nx.GH)(0===this.dirtyEdges),(0,nx.GH)(0===this.dirtyEdgeResolutions),(0,nx.GH)(!this.numVerticesPerSideChanged),(0,nx.GH)(!this.samplerDataChanged),(0,nx.GH)(!this.clippingAreaChanged),(0,nx.GH)(!this.wireframeChanged);const n=nx.XQ.map((t=>e.findNeighborCornerTileExact(t,(t=>!t.intersectsClippingArea||t.isLoaded||t.level===e.level))??null)).map((e=>e?.intersectsClippingArea?e:null)),s=this.geometryState;for(let o=0;o<4;++o){const t=s.cornerPeerNeighbors[o],r=n[o];(0,nx.GH)(r===t,`Tile[${e.lij}].corner[${o}] out of date: cur=[${t?.lij}] exp=[${r?.lij}]`)}nx.Rz.forEach(((t,n)=>{if(r[n])return;const s=e.findNeighborTile(t,(e=>(e.level===i||e?.isLoaded)&&e?.intersectsClippingArea));if(!s){const r=!e.surface.updatingRootTiles&&null!=e.surface.rootTiles&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(t);return void(0,nx.GH)(!r)}(0,nx.GH)(s.isLoaded||s.level===e.level),(0,nx.GH)(s===this.geometryState.edgePeerNeighbors[n]);const o=i-s.level;if(!s.isLoaded)return(0,nx.GH)(!s.isLeaf),void(0,nx.GH)(0===o);const a=s.renderData;(0,nx.GH)(function(e,t,r){if(null==e||null==t)return!1;if(0===e.level&&0===t.level){if(e.isEastEnd&&t.isWestEnd&&r===Ax.N.EAST)return!0;if(e.isWestEnd&&t.isEastEnd&&r===Ax.N.WEST)return!0}const i=Math.max(1e-6*(e.extent[2]-e.extent[0]),1);switch(r){case Ax.N.NORTH:return(0,nx.yL)(e.extent[3],t.extent[1],i);case Ax.N.SOUTH:return(0,nx.yL)(e.extent[1],t.extent[3],i);case Ax.N.EAST:return(0,nx.yL)(e.extent[2],t.extent[0],i)||(0,nx.yL)(e.extent[2],-t.extent[0],i);case Ax.N.WEST:return(0,nx.yL)(e.extent[0],t.extent[2],i)||(0,nx.yL)(e.extent[0],-t.extent[2],i)}}(e,s,t)),(0,nx.GH)(o>=0);const l=2**o;if(o<0)return void(0,nx.GH)(!1);const c=e.renderData,u=c.geometry,h=c.localOrigin,d=u.getEdgeCount(n),p=u.numVerticesPerSide-1,f=a.geometry;if(!f)return void(0,nx.GH)(!1);const m=a.localOrigin,g=this.geometryState.edgePeerNeighbors[n];if(g?.isLoaded){const e=g.renderData;(0,nx.GH)(c.geometryState.edgePeerNeighborSamplerVersions[n]===e.geometryState.samplerDataVersion),(0,nx.GH)(this.geometryState.edgePeerNeighborSamplerVersions[n]===e.geometryState.samplerDataVersion)}const y=(n+2)%4,_=f.getEdgeCount(y),v=d-1,b=_-1;(0,nx.GH)(v*l===b,`Tile[${e.lij}]:e${n},res=${v} edgeRes mismatch with Neighbor[${s.lij}]:e${y},res=${b} (expected:${v*l})`);const w=e.extent,x=t===Ax.N.NORTH||t===Ax.N.SOUTH,S=_-1,T=S>>o,M=d-1;if(T<1)return void(0,nx.GH)(1===M);(0,nx.GH)(T===M),(0,nx.GH)((0,ws.r6)(T));const A=f.numVerticesPerSide-1;(0,nx.GH)(o>0||T===Math.max(A,p));const C=e.getNeighborEdgeStartVertexIndex(n,s);(0,nx.GH)(0<=C&&C<l);const E=C*T;(0,nx.GH)(0<=E&&E<=S-T);let R=0,P=E;u.getEdgeVertexPosition(n,dS,h,0),u.getEdgeVertexPosition(n,pS,h,d-1);const O=(0,da.p)(dS,pS),I=Math.max(_S,1e-4*O);for(let r=0;r<=T;++r){u.getEdgeVertexPosition(n,dS,h,R),f.getEdgeVertexPosition(y,pS,m,P);const i=r/T,o=x?w[0]+i*(w[2]-w[0]):t===Ax.N.WEST?w[0]:w[2],l=x?t===Ax.N.SOUTH?w[1]:w[3]:w[1]+i*(w[3]-w[1]),p=e.surface.extent;if(null==p||(0,un.Rj)(p,o,l)){const t=(0,da.F)(dS,pS),r=(0,da.H)(dS)-_o.$O.radius,i=(0,da.H)(pS)-_o.$O.radius,g=t<I;if(!g){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${n}[${R}/${d}] and [${s.lij}].edge${y}[${P}/${_}]`),null!=p&&console.warn("  surface extent= ",p," x,y=",o,",",l);const v=(0,nn.vt)();(0,da.f)(v,c.localOrigin,a.localOrigin),(0,da.H)(v)>0&&console.warn(`   localOrigins: ${c.localOrigin} vs ${a.localOrigin} d=${(0,da.H)(v)} [${v}]`),(()=>{const t=(0,nn.o8)(dS),r=(0,nn.o8)(pS);e.updateEdgeElevations(),s.updateEdgeElevations(),u.getEdgeVertexPosition(n,dS,h,R),f.getEdgeVertexPosition(y,pS,m,P);const i=(0,nn.vt)();(0,da.z)(i,dS,t),(0,da.H)(i)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${t} vs ${dS} d=${(0,da.H)(i)} [${i}]`),(0,da.z)(i,pS,r),(0,da.H)(i)>0&&console.warn(`  XXX Neighbor[${s.lij}] edge out of date: ${r} vs ${pS} d=${(0,da.H)(i)} [${i}]`)})();const b=u.getEdgeCount(n),w=f.getEdgeCount(_);(0,nx.GH)(g,`Mismatch in tile [${e.lij}].edge[${n}][${R}/${b}] vs neighbor [${s.lij}].edge[${y}][${P}/${w}] ${(0,nx.hC)(dS)} vs ${(0,nx.hC)(pS)}  dist=${t} h(t|n|d)=${r}|${i}|${i-r}`)}u.getEdgeNormal(n,fS,R),f.getEdgeNormal(y,mS,P),(0,da.n)(gS,fS),(0,da.n)(yS,mS);const v=(0,da.m)(gS,yS),b=1-v<.01||e===s;if(!b){const t=(0,nn.vt)();(0,da.z)(t,fS,mS);const r=()=>`Mismatch in tile edge normal ${(0,nx.xl)(e.lij)} (${R}/${d-1}) edge ${n} vs neighbor ${(0,nx.xl)(s.lij)}  (${P}/${_-1}) nedge ${y} :${(0,nx.hC)(fS)} vs ${(0,nx.hC)(mS)}  dot = ${v} : ${(0,nx.hC)(t)}`;console.warn("Mismatch in tile edge normal: ",r());{e.updateEdgeElevations(),s.updateEdgeElevations();const t=(0,nn.vt)(),r=(0,nn.vt)();u.getEdgeNormal(n,t,R),f.getEdgeNormal(y,r,P),(0,da.G)(fS,t)||console.warn("Missing update in tile normal: ",(0,nx.hC)(fS)," => ",(0,nx.hC)(t)),(0,da.G)(mS,r)||console.warn("Missing update in neighbor normal: ",(0,nx.hC)(mS)," => ",(0,nx.hC)(r))}(0,nx.GH)(b,r())}}R+=1,P+=1}}))}}const dS=(0,nn.vt)(),pS=(0,nn.vt)(),fS=(0,nn.vt)(),mS=(0,nn.vt)(),gS=(0,nn.vt)(),yS=(0,nn.vt)(),_S=1,vS=[null,null,null,null];function bS(e,t){return t?.isLoaded||t===e?t:null}const wS=1,xS=2,SS=4,TS=8,MS=4,AS=8,CS=12,ES=[0,1,2,3],RS=65536;function PS(e,t){const{tile:r,geometry:i,geometryState:n}=e,{extentInRadians:s,surface:o}=r,{isWebMercator:a,renderer:l}=o,{numVerticesPerSide:c,wireframe:u}=n,h=c-1,d=(c-2)**2,p=a&&(t===cx.JG.HAS_SOUTH_POLE||t===cx.JG.HAS_BOTH_POLES),f=a&&(t===cx.JG.HAS_NORTH_POLE||t===cx.JG.HAS_BOTH_POLES),m=((p?1:0)+(f?1:0))*cT*c,g=oT(n),y=d+m+4*g,_=l.tileGeometryCache.acquire(y);i.numVerticesPerSide=c,i.vertexAttributes=_,i.maxEdgeVertexCount=g;const{boundingBox:v}=i;(0,If.Ie)(v);const b=DS(e);QS.update(h,s,b),function(e){const{tile:t}=e;if(!t.intersectsClippingArea)return;const{geometry:r,geometryState:i,localOrigin:n}=e,{numVerticesPerSide:s,samplerData:o}=i,a=s-2,l=s-1,{vertexAttributes:c,boundingBox:u}=r,h=c.position,d=c.uv0,{typedBuffer:p,typedBufferStride:f}=c.normalCompressed,{extent:m}=t,g=m[0],y=m[2],_=m[1],v=m[3],b=t.ellipsoid.radius,w=n[0],x=n[1],S=n[2],T=h.typedBuffer,M=h.typedBufferStride,A=1/l;let C=0;if(1<=a){const e=A,t=_*(1-e)+v*e,r=QS.sinLatLUT[1],i=QS.cosLatLUT[1];for(let n=1;n<=a;n++){const s=n*A,a=g*(1-s)+y*s,l=QS.sinLonLUT[n],c=QS.cosLonLUT[n],h=b+ix(a,t,o),p=h*c*i-w,f=h*l*i-x,m=h*r-S;sT(p,f,m,u);const _=(n-1)*M;T[_]=p,T[_+1]=f,T[_+2]=m,Px(d,n-1,s,e)}}for(let E=1;E<=a;E++){const e=E*A,t=_*(1-e)+v*e,r=QS.sinLatLUT[E],i=QS.cosLatLUT[E],n=E+1,s=n*A,c=_*(1-s)+v*s,h=QS.sinLatLUT[n],m=QS.cosLatLUT[n],R=QS.sinLonLUT[0],P=QS.cosLonLUT[0],O=b+ix(g,t,o);let I=P*i*O-w,L=R*i*O-x,N=r*O-S;const D=C*M;let F=T[D],k=T[D+1],z=T[D+2];for(let v=1;v<=a;v++){const e=v*A,n=g*(1-e)+y*e,R=QS.sinLonLUT[v],P=QS.cosLonLUT[v];let O=0,D=0,U=0;if(v<a){const e=(C+1)*M;O=T[e],D=T[e+1],U=T[e+2]}else{const e=QS.sinLonLUT[l],n=QS.cosLonLUT[l],s=b+ix(y,t,o);O=n*i*s-w,D=e*i*s-x,U=r*s-S}const V=I,B=L,j=N;I=F,L=k,N=z,F=O,k=D,z=U;const H=O-V,G=D-B,Z=U-j;let $=0,q=0,W=0;if(E>1){const e=(C-a)*M;$=T[e],q=T[e+1],W=T[e+2]}else{const e=QS.sinLatLUT[0],t=QS.cosLatLUT[0],r=b+ix(n,_,o);$=P*t*r-w,q=R*t*r-x,W=e*r-S}const Y=b+ix(n,c,o),X=P*m*Y-w,J=R*m*Y-x,K=h*Y-S;if(E<a){const t=C+a,r=t*M;T[r]=X,T[r+1]=J,T[r+2]=K,sT(X,J,K,u),Px(d,t,e,s)}const Q=$-X,ee=q-J,te=W-K;let re=P*i,ie=R*i,ne=r;ne*ne<.999&&(re=Z*ee-G*te,ie=H*te-Z*Q,ne=G*Q-H*ee);const se=1/Math.sqrt(re*re+ie*ie+ne*ne);(0,Cx.aT)(p,C,re*se,ie*se,ne*se,f),++C}}}(e),i.poleVerticesStartIndex=d;const w=function(e,t,r){const{tile:i,localOrigin:n,geometry:s}=e,{extent:o,ellipsoid:a}=i,{boundingBox:l,numVerticesPerSide:c,vertexAttributes:u,poleVerticesStartIndex:h}=s,d=c-1,p=n[0],f=n[1],m=n[2],g=a.radius,y=o[1],_=o[3],v=[];let b=h;const w=(e,t)=>{const r=t*c;sT(-p,-f,e*g-m,l),v.push(new JS(1===e,r,1===e?0:2,b,cT));const i=NS(-1===e?y:_,g),n=e*Math.PI/2-i,s=.99*(1===e?1:-1),o=g+0,{position:a,uv0:h}=u,{typedBuffer:w,typedBufferStride:x}=u.normalCompressed;for(let c=1;c<=cT;++c){const e=i+n*(c/cT),t=Math.cos(e),r=Math.sin(e);for(let i=0;i<=d;i++){const e=i/d,n=QS.sinLonLUT[i],c=QS.cosLonLUT[i]*t,u=n*t,g=r,y=c*o-p,_=u*o-f,v=g*o-m;sT(y,_,v,l),a.setValues(b,y,_,v),Px(h,b,e,s),(0,Cx.aT)(w,b,c,u,g,x),++b}}};return t&&w(-1,0),r&&w(1,d),v}(e,p,f);i.edgeVerticesStartIndex=d+m,GS(e),OS(e),BS(i,w,u),e.intersectionData=null}function OS(e){e.tile.intersectsClippingArea&&(LS(e),IS(e))}function IS(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{geometry:r,geometryState:i,tile:n,localOrigin:s}=e,{level:o,extent:a,extentInRadians:l,ellipsoid:c}=n,u=c.radius,h=l[0],d=l[2],p=l[1],f=l[3],{samplerData:m}=i,g=a[0],y=a[2],_=a[1],v=a[3],b=DS(e),{boundingBox:w,vertexAttributes:x}=r,S=s[0],T=s[1],M=s[2],A=x.position,C=A.typedBuffer,E=A.typedBufferStride,R=x.uv0;for(let P=0;P<4;++P){const s=1===P||3===P,l=i.edgeResolutions[P];(0,nx.GH)((0,ws.r6)(l));const c=l+1,x=bS(n,i.edgePeerNeighbors[P]);if(rT(n,x,P)){$S(e,P,x);continue}const A=null!=x;(0,nx.GH)(!A||x.level===n.level),(0,nx.GH)(!A||(0,Nx.lR)(n,x)<=0);const O=x?.renderData,I=O?.geometryState;if(nx.L8){const e=n.surface;if(!x&&e&&!e.updatingRootTiles){const t=nx.Rz[P],r=n.findNeighborTile(t,(e=>e.isLoaded||e.isLeaf||e.level===n.level));r?r.intersectsClippingArea&&((0,nx.GH)(!r.isLoaded),(0,nx.GH)(!r.isLeaf),(0,nx.GH)(r.level===o)):(0,nx.GH)(null==e?.rootTiles||!n.shouldHaveNeighbor(t))}}const L=1===P?a[2]:a[0],N=x?.extent,D=N&&s?1===P?N[0]:N[2]:L,F=0===P?a[3]:a[1],k=1===P?1:0,z=0===P?1:0,U=1===P?d:h,V=0===P?f:p,B=Math.sin(U),j=Math.cos(U),H=Math.sin(V),G=Math.cos(V),Z=I?.samplerData,$=A?(e,t,r)=>.5*(ix(e,t,m)+ix(r,t,Z)):(e,t,r)=>ix(e,t,m),q=r.outerEdgesOffsetAndLength[2*P+0],W=t&&c>3?c-3:1,Y=null!=m&&m.some((e=>null!=e)),X=null!=Z&&Z.some((e=>null!=e)),J=Y||X,K=1/l,Q=q;(0,nx.GH)(!N||(0,nx.yL)(N[2]-N[0],a[2]-a[0])),(()=>{const e=1===P?-1:3===P?1:0,t=0===P?-1:2===P?1:0,i=(a[2]-a[0])*K,n=e*i,o=t*i,l=s?e*((d-h)*K):0,p=s?0:t*K,f=z,x=s?U+l:U,O=s?Math.sin(x):B,I=s?Math.cos(x):j,N=s?U-l:U,q=s?Math.sin(N):B,Y=s?Math.cos(N):j,X=s?V:b(f+p),ee=s?H:Math.sin(X),te=s?G:Math.cos(X),re=s?V:b(f-p),ie=s?H:Math.sin(re),ne=s?G:Math.cos(re);let se=0,oe=0,ae=0;{const e=0*K,t=s?L:g*(1-e)+y*e,r=s?D:t,i=s?_*(1-e)+v*e:F,n=s?U:h*(1-e)+d*e,o=s?B:Math.sin(n),a=s?j:Math.cos(n),l=s?b(e):V,c=s?Math.sin(l):H,p=s?Math.cos(l):G,f=u+$(t,i,r);se=a*p*f,oe=o*p*f,ae=c*f}let le=0,ce=0,ue=0;{const e=1*K,t=s?L:g*(1-e)+y*e,r=s?D:t,i=s?_*(1-e)+v*e:F,n=s?U:h*(1-e)+d*e,o=s?B:Math.sin(n),a=s?j:Math.cos(n),l=s?b(e):V,c=s?Math.sin(l):H,p=s?Math.cos(l):G,f=u+$(t,i,r);le=a*p*f,ce=o*p*f,ue=c*f}for(let a=1;a<c-1;a+=W){let e=0,t=0,i=0;{const r=(a+1)*K,n=s?L:g*(1-r)+y*r,o=s?D:n,l=s?_*(1-r)+v*r:F,c=s?U:h*(1-r)+d*r,p=s?B:Math.sin(c),f=s?j:Math.cos(c),m=s?b(r):V,w=s?Math.sin(m):H,x=s?Math.cos(m):G,S=u+$(n,l,o);e=f*x*S,t=p*x*S,i=w*S}const l=e,c=t,p=i,f=le,x=ce,N=ue;le=l,ce=c,ue=p;{const e=Q+a,t=e*E,r=f-S,i=x-T,n=N-M;C[t]=r,C[t+1]=i,C[t+2]=n,sT(r,i,n,w);const o=a*K;Px(R,e,s?k:o,s?o:z)}const W=se,X=oe,re=ae;se=f,oe=x,ae=N;const he=f,de=x,pe=N,fe=1/Math.sqrt(he*he+de*de+pe*pe),me=pe*fe;let ge=0,ye=0,_e=0;if(J&&me*me<.999){let e=0,t=0,r=0;{const i=0===P?-1:1;e=i*(l-W),t=i*(c-X),r=i*(p-re)}{const i=a*K,l=s?L:g*(1-i)+y*i,c=s?D:l,p=s?_*(1-i)+v*i:F,f=s?U:h*(1-i)+d*i,w=s?B:Math.sin(f),x=s?j:Math.cos(f),S=s?b(i):V,T=s?Math.sin(S):H,M=s?Math.cos(S):G;let C=he,E=de,R=pe;if(A){const e=u+ix(c-n,p-o,Z),t=s?M:ne;C=(s?Y:x)*t*e,E=(s?q:w)*t*e,R=(s?T:ie)*e}{const i=u+ix(l+n,p+o,m),a=s?M:te,c=(s?I:x)*a*i,h=(s?O:w)*a*i,d=(s?T:ee)*i;A||(C=2*he-c,E=2*de-h,R=2*pe-d);const f=3===P?-1:1,g=f*(C-c),y=f*(E-h),_=f*(R-d);ge=r*y-t*_,ye=e*_-r*g,_e=t*g-e*y;const v=1/Math.sqrt(ge*ge+ye*ye+_e*_e);ge*=v,ye*=v,_e*=v}}}else ge=he*fe,ye=de*fe,_e=pe*fe;r.setEdgeNormalFromValues(P,a,ge,ye,_e)}})()}}function LS(e){qS(e)}function NS(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function DS(e){const{tile:t}=e;if(t.surface.isWebMercator){const e=t.extent,r=t.ellipsoid.radius;return t=>function(e,t,r,i){return NS(e*(1-i)+t*i,r)}(e[1],e[3],r,t)}const r=t.extentInRadians;return e=>function(e,t,r){return e*(1-r)+t*r}(r[1],r[3],e)}function FS(e,t){const{tile:r,geometryState:i,geometry:n}=e,{extent:s,surface:o}=r,{wireframe:a}=i,l=s[0],c=s[1],u=s[2]-l,h=s[3]-c,{numVerticesPerSide:d,clippingArea:p}=i,f=null!=p?Math.max(0,(p[0]-l)/u):0,m=null!=p?Math.max(0,(p[1]-c)/h):0,g=null!=p?Math.min(1,(p[2]-l)/u):1,y=null!=p?Math.min(1,(p[3]-c)/h):1,_=(d-2)**2,v=oT(i),b=_+4*v,w=o.renderer.tileGeometryCache.acquire(b),{boundingBox:x}=n;(0,If.Ie)(x),n.numVerticesPerSide=d,n.vertexAttributes=w,n.maxEdgeVertexCount=v,n.minu=f,n.minv=m,n.maxu=g,n.maxv=y,function(e){const t=e.tile;if(!t.intersectsClippingArea)return;const{geometry:r,geometryState:i,localOrigin:n}=e,{samplerData:s,clippingArea:o,numVerticesPerSide:a}=i,{surface:l,extent:c,ellipsoid:u}=t,{isWebMercatorOnPlateCarree:h}=l,d=null!=o?o:eT,p=c[0],f=c[1],m=c[2],g=c[3],y=Math.max(p,d[0]),_=Math.min(m,d[2]),v=Math.max(f,d[1]),b=Math.min(g,d[3]),w=u.radius,x=t.horizontalScale,S=a-1,T=a-2,{minu:M,minv:A,maxu:C,maxv:E,boundingBox:R,vertexAttributes:P}=r,O=P.position,I=P.uv0,{typedBuffer:L,typedBufferStride:N}=P.normalCompressed,D=n[0],F=n[1],k=n[2],z=O.typedBuffer,U=O.typedBufferStride;let V=0;const B=(0,ws.qE)(f,v,b),j=h?(Math.PI/2-2*Math.atan(Math.exp(-B/w)))*w:B*x,H=1/S,G=(0,ws.qE)(f*(1-H)+g*H,v,b);let Z=j,$=h?(Math.PI/2-2*Math.atan(Math.exp(-G/w)))*w:G*x;for(let q=1;q<=T;q++){const e=q/S,t=(0,ws.qE)(f*(1-e)+g*e,v,b),r=(0,ws.qE)(e,A,E),i=$,n=(q-1)/S,o=(0,ws.qE)(f*(1-n)+g*n,v,b),a=Z,l=(q+1)/S,c=(0,ws.qE)(f*(1-l)+g*l,v,b),u=h?(Math.PI/2-2*Math.atan(Math.exp(-c/w)))*w:c*x,d=(0,ws.qE)(l,A,E);Z=$,$=u;const P=(0,ws.qE)(p,y,_);let O=P*x,B=ix(P,t,s);const j=1/S,H=(0,ws.qE)(j,M,C),G=(0,ws.qE)(p*(1-H)+m*H,y,_);let W=H,Y=G,X=G*x,J=ix(G,t,s);if(1===q){const e=X-D,t=Z-F,i=J-k,n=0*U;z[n]=e,z[n+1]=t,z[n+2]=i,sT(e,t,i,R);Px(I,V,(0,ws.qE)(j,M,C),r)}for(let h=1;h<=T;h++){const e=X,n=J,l=(h+1)/S,f=(0,ws.qE)(l,M,C),g=(0,ws.qE)(p*(1-l)+m*l,y,_),v=Y;Y=g;{const e=V+1,n=e*U;if(1===q||h===T){const o=g*x,a=ix(g,t,s);if(1===q&&h<T){const t=o-D,s=i-F,l=a-k;z[n]=t,z[n+1]=s,z[n+2]=l,sT(t,s,l,R),Px(I,e,f,r)}X=o,J=a}else X=z[n]+D,J=z[n+2]+k}const b=X,w=J,A=O,E=B;O=e,B=n;const P=(V-T)*U,j=1===q?ix(v,o,s):z[P+2]+k,H=ix(v,c,s);if(q<T){const t=V+T,r=t*U,i=e-D,n=u-F,s=H-k;z[r]=i,z[r+1]=n,z[r+2]=s,sT(i,n,s,R);const o=W;W=f,Px(I,t,o,d)}{const e=b-A,t=a-u,r=t*(w-E),i=e*(j-H),n=-t*e,s=r*r+i*i+n*n;if(0===s)(0,Cx.aT)(L,V,0,0,1,N);else{const e=1/Math.sqrt(s);(0,Cx.aT)(L,V,r*e,i*e,n*e,N)}}++V}}}(e),n.edgeVerticesStartIndex=_,GS(e),kS(e),BS(n,[],a),e.intersectionData=null}function kS(e,t){e.tile.intersectsClippingArea&&(US(e),zS(e,!1))}function zS(e,t){const{geometry:r,geometryState:i,localOrigin:n}=e,s=e.tile,{surface:o,extent:a}=s,{clippingArea:l,samplerData:c}=i,u=null!=l?l:eT,h=a[0],d=a[2],p=a[1],f=a[3],m=[f>u[3],d>u[2],p<u[1],h<u[0]],g=s.horizontalScale,y=VS(o.isWebMercatorOnPlateCarree,s.ellipsoid.radius,g),{minu:_,minv:v,maxu:b,maxv:w,boundingBox:x}=r,S=Math.max(h,u[0]),T=Math.min(d,u[2]),M=Math.max(p,u[1]),A=Math.min(f,u[3]),C=n[0],E=n[1],R=n[2];for(let P=0;P<4;++P){const n=1===P||3===P,a=i.edgeResolutions[P];(0,nx.GH)((0,ws.r6)(a));const l=a+1,u=m[P],O=bS(s,i.edgePeerNeighbors[P]);if(!u&&rT(s,O,P)){$S(e,P,O);continue}const I=null!=O&&!u,L=O?.renderData,N=L?.geometryState;if(nx.L8&&((0,nx.GH)(!I||O.level===s.level),(0,nx.GH)(!I||(0,Nx.lR)(s,O)<=0),s&&!O&&!o.updatingRootTiles)){const e=nx.Rz[P],t=s.findNeighborTile(e,(e=>e.isLoaded||e.isLeaf||e.level===s.level));o.updatingRootTiles||(t?t.intersectsClippingArea&&((0,nx.GH)(!t.isLoaded),(0,nx.GH)(!t.isLeaf),(0,nx.GH)(t.level===s.level)):(0,nx.GH)(null==o?.rootTiles||!s.shouldHaveNeighbor(e)))}const D=(0,ws.qE)(1===P?d:h,S,T),F=(0,ws.qE)(0===P?f:p,M,A),k=N?.samplerData,z=t&&l>3?l-3:1,U=(0,ws.qE)(1===P?1:0,_,b),V=(0,ws.qE)(0===P?1:0,v,w),B=I?(e,t)=>.5*(ix(e,t,k)+ix(e,t,c)):(e,t)=>ix(e,t,c),j=(d-h)/a,H=n?1===P?j:-j:0,G=n?0:0===P?j:-j,Z=-H,$=-G;let q=0,W=0,Y=0;{const e=0/a,t=n?D:(0,ws.qE)(h*(1-e)+d*e,S,T),r=n?(0,ws.qE)(p*(1-e)+f*e,M,A):F,i=B(t,r);q=t*g,W=y(r),Y=i}let X=0,J=0,K=0;{const e=1/a,t=n?D:(0,ws.qE)(h*(1-e)+d*e,S,T),r=n?(0,ws.qE)(p*(1-e)+f*e,M,A):F,i=B(t,r);X=t*g,J=y(r),K=i}for(let e=1;e<l-1;e+=z){const t=e/a,i=X,s=J,o=K;{const a=n?U:(0,ws.qE)(t,_,b),l=n?(0,ws.qE)(t,v,w):V,c=i-C,u=s-E,h=o-R;sT(i,u,h,x),r.setEdgeVertexFromValuesRawPositionUV(P,e,c,u,h,a,l)}{const t=(e+1)/a,r=n?D:(0,ws.qE)(h*(1-t)+d*t,S,T),i=n?(0,ws.qE)(p*(1-t)+f*t,M,A):F,s=B(r,i);X=r*g,J=y(i),K=s}const l=X,u=K,m=q,O=W,L=Y;q=i,W=s,Y=o;let N=0,z=0,j=0;if(n){const e=J-s,r=u-o,n=O-s,a=L-o,l=(0,ws.qE)(p*(1-t)+f*t,M,A),h=D+Z,d=h*g-i,m=ix(h,l,c)-o,y=3===P?-1:1;if(N=y*(-n+e)*m,z=y*d*(-a+r),j=-y*d*(-n+e),I){const t=D+H,s=t*g-i;N=(-n+e)*(m-(ix(t,l,k)-o)),z=(d-s)*(-a+r),j=-(d-s)*(-n+e)}}else{const e=l-i,r=u-o,n=m-i,a=L-o,p=(0,ws.qE)(h*(1-t)+d*t,S,T),f=F+$,g=ix(p,f,c)-o,_=y(f)-s,v=2===P?-1:1;if(N=v*_*(-a+r),z=v*(-n+e)*g,j=-v*_*(-n+e),I){const t=p,i=F+G,l=y(i)-s;N=(-_+l)*(-a+r),z=(-n+e)*(-g+(ix(t,i,k)-o)),j=-(-_+l)*(-n+e)}}const Q=1/Math.sqrt(N*N+z*z+j*j);r.setEdgeNormalFromValues(P,e,N*Q,z*Q,j*Q)}}}function US(e,t){qS(e)}function VS(e,t,r){return e?e=>function(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}(e,t):e=>function(e,t){return e*t}(e,r)}function BS(e,t,r){const{numVerticesPerSide:i,vertexAttributes:n,maxEdgeVertexCount:s}=e,o=i-1,a=n.count,l=2*(i-3)*(i-3),c=4*(o+s-3),u=ES.reduce(((t,r)=>t+(o+e.getEdgeCount(r)-3)),0),h=t.reduce(((e,t)=>e+o*(2*(t.latitudeResolution-1)+1)),0),d=3*(r?2:1),p=(l+c+h)*d,f=a>=RS?new Uint32Array(p):new Uint16Array(p);for(let m=0;m<p;++m)f[m]=0;e.indices=f,e.indexCount=(l+u+h)*d,e.poleIndicesStartIndex=l*d,e.edgeIndicesStartIndex=(l+h)*d,r?(function(e){const{indices:t,numVerticesPerSide:r,vertexAttributes:i}=e,{position:n}=i,{typedBuffer:s,typedBufferStride:o}=n,a=r-2;let l=0;for(let c=0;c<r-3;++c){const e=c*a;for(let i=0;i<r-3;++i){const r=c*a+i,n=r+1,u=n+a,h=u-1,d=e+i,p=d+1,f=p+a;aT(d,p,f,f-1,o,s)?(lT(t,l,r,n,u),l+=6,lT(t,l,u,h,r)):(lT(t,l,r,n,h),l+=6,lT(t,l,h,u,n)),l+=6}}}(e),function(e,t){const{indices:r,numVerticesPerSide:i,poleIndicesStartIndex:n}=e,s=i-1;let o=n;for(const a of t){const t=a.connectedOuterEdgeOffset;let n=e.getEdgeVertexIndex(t,0),l=1;for(let e=0;e<a.latitudeResolution;++e){const t=0===e?a.rowOffset:n+i;for(let i=0;i<s;i++)lT(r,o,n,n+1,t+i),o+=6,e<a.latitudeResolution-1&&(lT(r,o,n+1,t+i+1,t+i),o+=6),n+=l;n=t,l=1}}}(e,t),HS(e)):(function(e){const{numVerticesPerSide:t,indices:r,vertexAttributes:i}=e,{position:n}=i,{typedBuffer:s,typedBufferStride:o}=n,a=t-2,l=t-3,c=0,u=t-3;let h=0;for(let d=0;d<l;++d){const e=d*a;for(let t=c;t<u;++t){const i=e+t,n=i+1,l=n+a,c=l-1;aT(i,n,l,c,o,s)?(r[h]=i,r[h+1]=n,r[h+2]=l,r[h+3]=l,r[h+4]=c,r[h+5]=i):(r[h]=i,r[h+1]=n,r[h+2]=c,r[h+3]=c,r[h+4]=n,r[h+5]=l),h+=6}}}(e),function(e,t){const{numVerticesPerSide:r,indices:i,poleIndicesStartIndex:n}=e,s=r-1;let o=n;for(const a of t){const t=a.isNorth?1:2,n=a.isNorth?2:1,l=a.isNorth?3:4,c=a.isNorth?4:3;let u=e.getEdgeVertexIndex(a.connectedOuterEdgeOffset,0),h=1;for(let e=0;e<a.latitudeResolution;++e){const d=0===e?a.rowOffset:u+r;for(let r=0;r<s;r++){const s=d+r;i[o]=u,i[o+t]=u+1,i[o+n]=s,e<a.latitudeResolution-1?(i[o+l]=u+1,i[o+c]=s+1,i[o+5]=s,o+=6):o+=3,u+=h}u=d,h=1}}}(e,t),jS(e))}function jS(e){const{indices:t,numVerticesPerSide:r,edgeIndicesStartIndex:i}=e,n=r-1,s=n-2;let o=i;for(let a=0;a<4;++a){const r=nT[a];let i=0,l=0;const c=e.getEdgeCount(a),u=r.count;(0,nx.GH)(u===n-1);const h=1===a||2===a,d=h?1:2,p=h?2:1,f=e.getEdgeFirstVertexIndex(a),m=1,g=r.vertex0Index,y=r.stride;for(;i<c-1||l<u-1;){const e=g+l*y,r=f+i*m,a=i<c-1,h=l<u-1,_=a&&(!h||(a?0+n*(i+.5)/(c-1):0)<=(h?1+s*(l+.5)/(u-1):0));_?++i:++l;const v=_?r+m:e+y;t[o]=e,t[o+d]=r,t[o+p]=v,o+=3}}e.indexCount=o}function HS(e){const{indices:t,numVerticesPerSide:r,edgeIndicesStartIndex:i}=e,n=r-1,s=n-2;let o=i;for(let a=0;a<4;++a){const r=nT[a];let i=0,l=0;const c=e.getEdgeCount(a),u=r.count;(0,nx.GH)(u===n-1);const h=1===a||2===a,d=h?1:3,p=h?3:1,f=e.getEdgeFirstVertexIndex(a),m=1,g=r.vertex0Index,y=r.stride;for(;i<c-1||l<u-1;){const e=g+l*y,r=f+i*m,a=i<c-1,h=l<u-1,_=a&&(!h||(a?0+n*(i+.5)/(c-1):0)<=(h?1+s*(l+.5)/(u-1):0));_?++i:++l;const v=_?r+m:e+y;t[o]=e,t[o+d]=r,t[o+d+1]=r,t[o+p]=v,t[o+p+1]=v,t[o+5]=e,o+=6}}e.indexCount=o}function GS(e){const{geometry:t,geometryState:r}=e,{edgeResolutions:i}=r,{numVerticesPerSide:n,edgeVerticesStartIndex:s}=t,o=n-2;let a=s;for(let l=0;l<4;++l){{const e=0===l||2===l,t=(0===l?o-1:0)*o+(1===l?o-1:0),r=(e?0:1)*o+(e?1:0),i=nT[l];i.vertex0Index=t,i.stride=r,i.count=o}{const e=i[l]+1;t.outerEdgesOffsetAndLength[2*l+0]=a,t.outerEdgesOffsetAndLength[2*l+1]=e,a+=e}}}function ZS(e){GS(e),e.geometryState.wireframe?HS(e.geometry):jS(e.geometry)}function $S(e,t,r){const{geometryState:i,geometry:n,tile:s,localOrigin:o}=e,a=1===t||3===t,l=i.edgeResolutions[t];(0,nx.GH)((0,ws.r6)(l));const c=l+1,{boundingBox:u,minu:h,minv:d,maxu:p,maxv:f,vertexAttributes:m}=n,g=(0,ws.qE)(1===t?1:0,h,p),y=(0,ws.qE)(0===t?1:0,d,f),_=r.renderData,v=_.geometryState,b=_.geometry,w=(t+2)%4,x=b.getEdgeCount(w),S=s.getNeighborEdgeStartVertexIndex(t,r)*l,T=l*2**(s.level-r.level);(0,nx.GH)(v.edgeResolutions[w]===T),(0,nx.GH)(x-1===T);const M=_.localOrigin[0]-o[0],A=_.localOrigin[1]-o[1],C=_.localOrigin[2]-o[2],E=n.getEdgeFirstVertexIndex(t),R=m.position,P=R.typedBuffer,O=R.typedBufferStride,I=m.normalCompressed,L=I.typedBuffer,N=I.typedBufferStride,D=m.uv0,F=b.vertexAttributes,k=b.getEdgeFirstVertexIndex(w),z=F.position.typedBuffer,U=F.position.typedBufferStride,V=F.normalCompressed.typedBuffer,B=F.normalCompressed.typedBufferStride;for(let j=1;j<c-1;++j){const e=E+j,t=k+(S+j),r=e*O,i=t*U,n=z[i]+M,s=z[i+1]+A,o=z[i+2]+C;P[r]=n,P[r+1]=s,P[r+2]=o,sT(n,s,o,u);const c=e*N,m=t*B;L[c]=V[m],L[c+1]=V[m+1];const _=j/l;Px(D,e,a?g:(0,ws.qE)(_,h,p),a?(0,ws.qE)(_,d,f):y)}}function qS(e){const{geometry:t,geometryState:r,localOrigin:i}=e,{clippingArea:n,samplerData:s}=r,{minu:o,minv:a,maxu:l,maxv:c,boundingBox:u,vertexAttributes:h}=t,d=e.tile,{surface:p,ellipsoid:f,extent:m,extentInRadians:g,horizontalScale:y}=d,_="local"===p.view?.viewingMode,v=f.radius;let b=0,w=0,x=0;const S=_?(()=>{const e=n,t=null!=e&&(m[3]>e[3]||m[2]>e[2]||m[1]<e[1]||m[0]<e[0]),r=VS(p.isWebMercatorOnPlateCarree,v,y);return(i,n,s)=>{const o=0===i?m[0]:m[2],a=0===n?m[1]:m[3],l=t?(0,ws.qE)(o,e[0],e[2]):o,c=t?(0,ws.qE)(a,e[1],e[3]):a,u=s;b=l*y,w=r(c),x=u}})():(e,t,r)=>{const i=g[0===t?1:3],n=g[0===e?0:2],s=Math.cos(i),o=Math.sin(i),a=Math.sin(n),l=Math.cos(n),c=v+r;b=l*s*c,w=a*s*c,x=o*c};let T=0,M=0,A=0,C=0,E=0,R=0,P=0,O=0,I=0;const L=_&&p.isWebMercatorOnPlateCarree,N=(e,t,r,i,n)=>{let s=0,o=0,a=0;if(_){const e=t*y,n=L?(Math.PI/2-2*Math.atan(Math.exp(-r/v)))*v:r*y;s=e-b,o=n-w,a=i-x}else{const n=DS(e),l=e.tile,c=l.extent,u=l.extentInRadians,h=(t-c[0])/(c[2]-c[0]),d=(r-c[1])/(c[3]-c[1]),p=u[0]*(1-h)+u[2]*h,f=n(d),m=Math.cos(f),g=Math.sin(f),y=Math.sin(p),_=Math.cos(p),S=v+i;s=_*m*S-b,o=y*m*S-w,a=g*S-x}switch(n){case 0:P+=s,O+=o,I+=a;break;case 1:C-=s,E-=o,R-=a;break;case 2:P-=s,O-=o,I-=a;break;case 3:C+=s,E+=o,R+=a}},D=n??eT,F=m[0],k=m[2],z=m[1],U=m[3],V=[U>D[3],k>D[2],z<D[1],F<D[0]],B=Math.max(F,D[0]),j=Math.min(k,D[2]),H=Math.max(z,D[1]),G=Math.min(U,D[3]),Z=e=>Math.max(D[0],Math.min(D[2],e)),$=e=>Math.max(D[1],Math.min(D[3],e)),q=e=>{const t=r.cornerNeighborCornerTiles;T=0,M=0,A=1,C=0,E=0,R=0,P=0,O=0,I=0;let i=1/0;for(let r=0;r<4;++r){const n=t[4*e+r];i=Math.min(i,n?.level??1/0)}for(let r=0;r<4;++r){const n=t[4*e+r];tT[r]=n?.level===i?n:null}let n=1,s=0;for(let r=0;r<4;++r){const e=tT[r];e&&(n=Math.max(n,e?.renderData.geometryState.numVerticesPerSide),s=e.extent[2]-e.extent[0])}const o=s,a=n;(0,nx.GH)(a>1);const l=o/a;for(let r=0;r<4;++r){const e=tT[(r+3)%4],t=tT[r%4];if(!e&&!t)continue;const i=0===r?1:1===r?2:2===r?3:0,n=0===r?2:1===r?3:2===r?0:1;if(e&&t){const s=KS[r][0]*l,o=KS[r][1]*l,a=e.extent,c=Z(a[0===i||1===i?2:0]+s),u=$(a[0===i||3===i?3:1]+o),h=t.extent,d=Z(h[0===n||1===n?2:0]+s),p=$(h[0===n||3===n?3:1]+o),f=e.renderData,m=t.renderData,g=ix(c,u,f.geometryState.samplerData),y=ix(d,p,m.geometryState.samplerData);N(f,c,u,.5*(g+y),r)}else{const s=e??t,o=e?i:n,a=s.extent,c=KS[r],u=Z(a[0===o||1===o?2:0]+c[0]*l),h=$(a[0===o||3===o?3:1]+c[1]*l),d=s.renderData,p=ix(u,h,d.geometryState.samplerData);N(d,u,h,p,r)}}if(!_){const e=Math.sqrt(b*b+w*w+x*x);T=b/e,M=w/e,A=x/e}if(_||A*A<.999){const e=Math.sqrt(C*C+E*E+R*R);C/=e,E/=e,R/=e;const t=Math.sqrt(P*P+O*O+I*I);P/=t,O/=t,I/=t,T=R*O-E*I,M=C*I-R*P,A=E*P-C*O;const r=1/Math.sqrt(T*T+M*M+A*A);T*=r,M*=r,A*=r}},W=r.cornerNeighborCornerTiles;for(let Y=0;Y<4;++Y){const e=Y,n=(Y+1)%4,p=0===Y||1===Y?1:0,f=0===Y||3===Y?1:0,m=(0,ws.qE)(p,o,l),g=(0,ws.qE)(f,a,c),y=t.getEdgeFirstVertexIndex(e),_=t.getEdgeCount(e),v=0===Y||3===Y?_-1:0,C=t.getEdgeFirstVertexIndex(n),E=t.getEdgeCount(n),R=0===Y||1===Y?E-1:0;let P=-1;for(let t=0;t<4;++t){const e=W[4*Y+t],r=W[4*Y+P];e&&(-1===P||(0,Nx.lR)(r,e)>0)&&(P=t)}const O=P,I=W[4*Y+O];if(I!==d){const e=d.level-I.level,t=2**e,n=[I.lij[0]+e,I.lij[1]*t,I.lij[2]*t],s=[n[1]+t===d.lij[1],0===Y&&(1===O||0===O&&I!==W[4*Y+3])||1===Y&&(0===O||1===O&&I!==W[4*Y+2]),n[1]===d.lij[1]+1,2===Y&&(3===O||2===O&&I!==W[4*Y+1])||3===Y&&(2===O||3===O&&I!==W[4*Y+0])],o=s.reduce(((e,t)=>e+(t?1:0)),0);(0,nx.GH)(1===o||2===o);let a=-1,l=-1;const c=I.renderData;if(1===o){const e=s.findIndex((e=>e));(0,nx.GH)(0<=e&&e<=3),a=(e+2)%4;const t=r.edgeResolutions[e];l=d.getNeighborEdgeStartVertexIndex(e,I)*t+t*(0===e&&0===Y||1===e&&0===Y||2===e&&1===Y||3===e&&3===Y?1:0)}else{(0,nx.GH)(s[1]||s[3]),a=s[1]?3:1;const e=c.geometryState.edgeResolutions[a];l=0===Y||3===Y?0:e}const p=c.geometry;{const e=y+v,t=C+R,r=p.getEdgeFirstVertexIndex(a)+l,n=p.vertexAttributes,s=c.localOrigin;{const o=n.position,a=o.typedBuffer,l=r*o.typedBufferStride,c=a[l]+s[0]-i[0],d=a[l+1]+s[1]-i[1],p=a[l+2]+s[2]-i[2];sT(c,d,p,u);const f=h.position,m=f.typedBuffer;{const t=e*f.typedBufferStride;m[t]=c,m[t+1]=d,m[t+2]=p}{const e=t*f.typedBufferStride;m[e]=c,m[e+1]=d,m[e+2]=p}}const o=h.uv0;Px(o,e,m,g),Px(o,t,m,g);{const i=n.normalCompressed.typedBuffer,s=r*n.normalCompressed.typedBufferStride,o=h.normalCompressed,a=o.typedBuffer;{const t=e*o.typedBufferStride;a[t]=i[s],a[t+1]=i[s+1]}{const e=t*o.typedBufferStride;a[e]=i[s],a[e+1]=i[s+1]}}}}else{let r;if(V[e]||V[n]){r=ix((0,ws.qE)(F*(1-p)+k*p,B,j),(0,ws.qE)(z*(1-f)+U*f,H,G),s)}else r=WS(W,Y);S(p,f,r),q(Y);const o=b-i[0],a=w-i[1],l=x-i[2];sT(o,a,l,u),t.setEdgeVertexFromValuesRawPositionUVNormal(e,v,o,a,l,m,g,T,M,A),t.setEdgeVertexFromValuesRawPositionUVNormal(n,R,o,a,l,m,g,T,M,A)}}for(let Y=0;Y<4;++Y)tT[Y]=null}function WS(e,t){const r=4*t,i=ES.reduce(((t,i)=>Math.min(t,e[r+i]?.level??1/0)),1/0);nx.L8&&((0,nx.GH)(!e[r+0]||!e[r+2]||Kx(e[r+0],e[r+2],Ax.N.SOUTH_WEST)),(0,nx.GH)(!e[r+1]||!e[r+3]||Kx(e[r+1],e[r+3],Ax.N.NORTH_WEST)));let n=0,s=0;for(let a=0;a<4;++a){const t=e[r+a];if(t&&t.level===i){const e=0===a||1===a,r=0===a||3===a,i=t.extent,o=i[e?0:2],l=i[r?1:3],c=t.renderData?.geometryState?.samplerData;s+=ix(o,l,c),n++}}const o=n?s/n:0;return(0,nx.GH)(null!=o),o}function YS(e){const{vao:t,geometry:r}=e,{vertexAttributes:i,edgeVerticesStartIndex:n}=r,s=i.position.typedBuffer;t.vertexBuffers.geometry.setSubData(s,n,n,s.length)}function XS(e){const{vao:t,geometry:r}=e,{indices:i,indexCount:n,edgeIndicesStartIndex:s}=r;t.indexBuffer.setSubData(i,s,s,n)}class JS{constructor(e,t,r,i,n){this.isNorth=e,this.connectedRowOffset=t,this.connectedOuterEdgeOffset=r,this.rowOffset=i,this.latitudeResolution=n}}const KS=[[0,1],[1,0],[0,-1],[-1,0]],QS=new class{constructor(){this.sinLonLUT=new Array(On.Me+1),this.cosLonLUT=new Array(On.Me+1),this.sinLatLUT=new Array(On.Me+1),this.cosLatLUT=new Array(On.Me+1)}update(e,t,r){const i=t[0],n=t[2];for(let s=0;s<=e;s++){const t=s/e,o=i*(1-t)+n*t;this.sinLonLUT[s]=Math.sin(o),this.cosLonLUT[s]=Math.cos(o);const a=r(t);this.sinLatLUT[s]=Math.sin(a),this.cosLatLUT[s]=Math.cos(a)}}},eT=(0,un.fA)(-1/0,-1/0,1/0,1/0),tT=[null,null,null,null];function rT(e,t,r){if(!t)return!1;const i=(0,Nx.lR)(e,t);return i>0||0===i&&r>=2}class iT{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(e){return(0,nx.GH)(0<=e&&e<this.count),this.vertex0Index+this.stride*e}}const nT=[new iT,new iT,new iT,new iT];function sT(e,t,r,i){e<i[0]?i[0]=e:e>i[3]&&(i[3]=e),t<i[1]?i[1]=t:t>i[4]&&(i[4]=t),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}function oT(e){const{edgeResolutions:t,numVerticesPerSide:r}=e,i=1+Math.max(...t);return Math.max(r,i)}function aT(e,t,r,i,n,s){const o=e*n,a=s[o],l=s[o+1],c=s[o+2],u=t*n,h=s[u],d=s[u+1],p=s[u+2],f=r*n,m=s[f],g=s[f+1],y=s[f+2],_=i*n,v=s[_],b=s[_+1],w=s[_+2];return(h-v)*(h-v)+(d-b)*(d-b)+(p-w)*(p-w)>(a-m)*(a-m)+(l-g)*(l-g)+(c-y)*(c-y)}function lT(e,t,r,i,n){e[t]=r,e[t+1]=i,e[t+2]=i,e[t+3]=n,e[t+4]=n,e[t+5]=r}const cT=6;var uT=r(48168);class hT extends Hx{constructor(e,t,r,i,n){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=(0,un.vt)(),this._baseUsedMemory=900,this._subtreeGeometryElevationBoundMin=0,this._subtreeGeometryElevationBoundMax=0,this.init(e,t,r,i,n)}init(e,t,r,i,n){super.init(e,t,r,i,n);const s=n.view.renderSpatialReference,o=n.spatialReference,a=null!=s&&(0,$n.r1)(s)&&null!=o&&o.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=a;const{isWebMercatorOnPlateCarree:l}=n,c=this._extentInRenderSR,u=this.extent;if(l){const e=(0,nn.fA)(u[0],u[1],0);(0,Of.F)(e,Bt.A.WebMercator,e,Bt.A.PlateCarree);const t=(0,nn.fA)(u[2],u[3],0);(0,Of.F)(t,Bt.A.WebMercator,t,Bt.A.PlateCarree),c[0]=e[0],c[1]=e[1],c[2]=t[0],c[3]=t[1]}else for(let h=0;h<4;++h)c[h]=u[h]*a;this.centerAtSeaLevel[0]=.5*(c[0]+c[2]),this.centerAtSeaLevel[1]=.5*(c[1]+c[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(c[2]-c[0],c[3]-c[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,t=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),i=Math.sqrt(t*t+r*r),n=.5*(this.elevationBoundsMax-this.elevationBoundsMin),s=Math.max(i,n);this._center[Yx.MIDDLE][3]=s}_calculateFrustumVisibilityStatus(e){const t=this._aabb(),r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5];let l=!0;for(let c=0;c<6;c++){const t=e[c],u=t[0],h=t[1],d=t[2],p=t[3];if(u*(u>0?r:s)+h*(h>0?i:o)+d*(d>0?n:a)+p>=0)return zx.OUTSIDE;l=l&&u*(u<0?r:s)+h*(h<0?i:o)+d*(d<0?n:a)+p<=0}return l?zx.INSIDE:zx.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return(0,If.LV)(e[0],e[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),e[2],e[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(e,t,r,i){return dT[0]=1/t[0],dT[1]=1/t[1],dT[2]=1/t[2],(0,uT.d2)(this._aabb(),e,dT,r,i)}createGeometry(){FS(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds(),this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){const e=this._subtreeGeometryElevationBoundMin,t=this._subtreeGeometryElevationBoundMax,r=this.renderData;let i=e,n=t;if(r){const e=r.geometry.boundingBox;i=e[2],n=e[5]}else if(!this.isLeaf){i=1/0,n=-1/0;for(const e of this.children)i=Math.min(i,e._subtreeGeometryElevationBoundMin),n=Math.max(n,e._subtreeGeometryElevationBoundMax)}if(i!==this._subtreeGeometryElevationBoundMin||n!==this._subtreeGeometryElevationBoundMax){this._subtreeGeometryElevationBoundMin=i,this._subtreeGeometryElevationBoundMax=n;const e=this.parent;e?._updateSubtreeGeometryElevationsBounds()}}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){(function(e){e.tile.intersectsClippingArea&&(US(e),zS(e,!0),YS(e),e.intersectionData=null)})(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){(function(e){e.tile.intersectsClippingArea&&(kS(e),YS(e),e.intersectionData=null)})(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){(function(e){e.tile.intersectsClippingArea&&(ZS(e),kS(e),YS(e),XS(e),e.intersectionData=null)})(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}}const dT=(0,nn.vt)();var pT=r(16475);class fT{constructor(){this.extent=(0,ya.vt)(),this.minLevel=0,this.maxLevel=0,this.callback=null}}let mT=class extends ht.A{constructor(){super(...arguments),this._queries=new Ty.A({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Ty.A({initialSize:30}),this._queryPool=new f_.A(fT)}queryVisibleLevelRange(e,t,r,i){const n=this._queryPool.acquire();(0,ga.c)(n.extent,e),n.minLevel=t??-Number.MAX_VALUE,n.maxLevel=r??Number.MAX_VALUE,n.callback=i,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return 0!==this._queryQueue.length}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const t=this._queries.data[e];this._queryPool.release(t),t.callback(e>=this._queriesInvPtr),t.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const t=e.level;let r=0;for(;r<this._queriesInvPtr;){const i=this._queries.data[r],n=i.extent;t>=i.minLevel&&t<=i.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};(0,ze._)([(0,Qe.MZ)()],mT.prototype,"updating",null),mT=(0,ze._)([(0,tt.$)("esri.views.3d.terrain.ScaleRangeQueries")],mT);var gT=r(44815);class yT extends Hx{constructor(e,t,r,i,n){super(),this._convexHull=new Array(24),this._boundingSphere=(0,Su.c)(),this._baseUsedMemory=1816,this.init(e,t,r,i,n)}init(e,t,r,i,n){super.init(e,t,r,i,n);const s=this.ellipsoid.radius,o=this.extentInRadians[0],a=this.extentInRadians[1],l=this.extentInRadians[2],c=this.extentInRadians[3],u=(0,ws.Cc)(a,c,.5),h=(0,ws.Cc)(o,l,.5),d=0===e?0:Math.min(Math.abs(a),Math.abs(c));this._edgeLen=(l-o)*Math.cos(d)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),function(e,t,r,i){const n=Math.cos(r);e[0]=Math.cos(t)*n*i,e[1]=Math.sin(t)*n*i,e[2]=Math.sin(r)*i}(this.centerAtSeaLevel,h,u,this.ellipsoid.radius),(0,da.n)(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(0===this.lij[0])(0,da.s)((0,Su.g)(e[Yx.MIDDLE]),0,0,0),(0,da.s)(e[Yx.TOP],0,0,0),(0,da.s)(e[Yx.BOTTOM],0,0,0),e[Yx.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const t=e[Yx.MIDDLE],r=this.convexHull;let i=0;for(let e=0;e<8;++e)i=Math.max(i,vT((0,Su.g)(t),r,3*e));e[Yx.MIDDLE][3]=Math.sqrt(i)}}_calculateFrustumVisibilityStatus(e){if(!(0,Lf.m7)(e,this._boundingSphere))return zx.OUTSIDE;if(this.lij[0]<10)return zx.INTERSECTS;const t=this.convexHull,r=this.surface.view.state.camera.near;let i=!0;for(let n=0;n<Lf.YH;n++){const s=n===Lf.FB.NEAR,o=e[n],a=o[0],l=o[1],c=o[2],u=o[3]-(s?r:0);let h=!1;for(let e=0;e<8;++e){const r=3*e;if(a*t[r]+l*t[r+1]+c*t[r+2]+u<0){if(h=!0,!i)break}else i=!1}if(!h)return zx.OUTSIDE}return i?zx.INSIDE:zx.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){PS(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),nx.L8&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,t=(0,Su.g)(e),r=this.elevationBoundsMin,i=this.elevationBoundsMax,n=this.ellipsoid.radius,s=i;if(0===this.level)(0,da.s)(t,0,0,0),e[3]=n+s;else{const s=this.extentInRadians,o=.5*(s[0]+s[2]),a=s[1],l=s[3];wT(ST,o,a,n),wT(TT,o,l,n),(0,da.g)(t,ST,TT),(0,da.j)(t,t,(n+.5*(r+i))/(0,da.H)(t));const c=this.convexHull;let u=0;const h=(e,t)=>{const r=e[0]-c[3*t],i=e[1]-c[3*t+1],n=e[2]-c[3*t+2];return Math.sqrt(r*r+i*i+n*n)};for(let e=0;e<8;++e){const r=h(t,e);u=Math.max(u,r)}const d=u;e[3]=d+2}}_updateConvexHull(){const e=this.extentInRadians,t=this.ellipsoid.radius;if(0===this.level)return;const r=this.elevationBoundsMin,i=this.elevationBoundsMax,n=this._getPatchType(),s=this.surface.isWebMercator,o=s&&n===cx.JG.HAS_NORTH_POLE,a=s&&n===cx.JG.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,u=e[0],h=e[2],d=a?-c:e[1],p=o?c:e[3],f=.5*(u+h),m=r,g=t+(l?Math.min(0,m-1):m),y=(e,t,r)=>wT(e,t,r,g),_=(0,nn.vt)(),v=(0,nn.vt)(),b=(0,nn.vt)(),w=(0,nn.vt)();y(_,u,d),y(v,u,p),y(b,h,p),y(w,h,d);const x=(e,t)=>{for(let r=0;r<3;++r)this._convexHull[3*t+r]=e[r]};x(_,0),x(v,1),x(b,2),x(w,3);const S=i,T=t+(l?Math.max(0,S+1):S),M=(0,nn.vt)(),A=(0,nn.vt)(),C=(0,nn.vt)();wT(A,f,p,g),wT(C,f,d,g),(0,da.g)(M,A,C),(0,da.n)(M,M);const E=(0,nn.vt)(),R=(0,nn.vt)(),P=(e,t)=>{(0,da.z)(R,e,t),(0,da.n)(R,R);const r=-(0,da.m)(e,E)/(0,da.m)(R,E);(0,nx.GH)(r>=0),(0,da.j)(R,R,r),(0,da.g)(e,e,R)};if(2**this.lij[0]>2*this.lij[1]){const e=C,t=(0,nn.vt)();(0,da.b)(t,xT,e),(0,da.n)(t,t),(0,da.b)(E,e,t),(0,da.n)(E,E),(0,nx.GH)((0,nx.yL)((0,da.m)(E,e)/(0,da.H)(e),0)),P(_,v),P(w,b),x(_,0),x(w,3)}else if(2**this.lij[0]!==2*this.lij[1]){const e=A,t=(0,nn.vt)();(0,da.b)(t,xT,e),(0,da.n)(t,t),(0,da.b)(E,t,e),(0,da.n)(E,E),P(v,_),P(b,w),x(v,1),x(b,2)}const O=(e,t)=>{const r=T/(0,da.m)(t,M);for(let i=0;i<3;++i)this._convexHull[3*e+i]=t[i]*r};O(4,_),O(5,v),O(6,b),O(7,w)}_getPatchType(){const e=this.lij[1],t=0===e,r=e===(1<<this.level)-1;return t?r?cx.JG.HAS_BOTH_POLES:cx.JG.HAS_NORTH_POLE:r?cx.JG.HAS_SOUTH_POLE:cx.JG.REGULAR}intersectsRay(e,t,r,i){const n=this._boundingSphere,s=n[3]+r,o=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],a=n[0]-e[0],l=n[1]-e[1],c=n[2]-e[2],u=(a*t[0]+l*t[1]+c*t[2])/o,h=t[0]*u-a,d=t[1]*u-l,p=t[2]*u-c;return h*h+d*d+p*p<s*s}getDefaultVerticesPerSide(){return this.level<_T.length?_T[this.level]+1:2}updateCornerElevations(){(function(e){e.tile.intersectsClippingArea&&(LS(e),IS(e,!0),YS(e),e.intersectionData=null)})(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){(function(e){e.tile.intersectsClippingArea&&(OS(e),YS(e),e.intersectionData=null)})(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){(function(e){e.tile.intersectsClippingArea&&(ZS(e),OS(e),YS(e),XS(e),e.intersectionData=null)})(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!nx.L8)return;if(this.level<=2)return;const e=this._boundingSphere,t=e[3],r=(0,Su.g)(e),i=(0,nn.vt)(),n=this.ellipsoid.radius,s=this.elevationBoundsMin,o=this.elevationBoundsMax,a=n+s,l=this._center[Yx.MIDDLE][3],c=this.convexHull,u=(e,t)=>{for(let r=0;r<3;++r)e[r]=c[3*t+r]};{const e=(0,nn.vt)(),t=(0,nn.vt)(),r=(0,nn.vt)(),i=(0,nn.vt)(),n=(0,nn.vt)(),s=(s,o,a,l)=>{u(t,s),u(r,o),u(i,a),(0,da.z)(t,t,r),(0,da.z)(i,i,r),(0,da.b)(e,t,i),(0,da.n)(e,e);const c=(0,da.m)(e,r);u(n,l);const h=(0,da.m)(e,n),d=Math.abs(h-c);(0,nx.GH)((0,nx.yL)(d,0),`Non coplanar ${s},${o},${a},${l} diff = ${d}`)};s(0,1,2,3),s(4,5,6,7),s(0,1,4,5),s(1,2,5,6),s(2,3,6,7),s(3,0,7,4)}const h=(0,gT.jh)(24),d=(0,nn.vt)(),p=(0,nn.vt)(),f=(0,nn.vt)(),m=(0,nn.vt)(),g=(e,t,r,i)=>{u(d,t),u(p,r),u(f,i),(0,da.z)(d,d,p),(0,da.n)(d,d),(0,da.z)(f,f,p),(0,da.n)(f,f),(0,da.b)(m,d,f),(0,da.n)(m,m);const n=(0,da.m)(m,p);((e,t,r)=>{const i=4*e;for(let n=0;n<3;++n)h[i+n]=t[n];h[i+3]=r})(e,m,n)};g(0,0,1,2),g(1,1,0,4),g(2,1,5,2),g(3,3,2,6),g(4,4,0,3),g(5,4,6,5);const y=(e,t,r,i)=>{const n=4*e;return h[n]*t+h[n+1]*r+h[n+2]*i-h[n+3]},_=(e,t,r,i)=>y(e,t,r,i)>=-1,v=(e,t)=>_(e,t[0],t[1],t[2]),b=2**this.lij[0]>2*this.lij[1],w=(e,i,n)=>Math.sqrt(bT(e,i,n,r[0],r[1],r[2]))<t,x=e=>w(e[0],e[1],e[2]),S=(e,t)=>w(e[t],e[t+1],e[t+2]),T=this.extentInRadians,M=.5*(T[0]+T[2]),A=T[1],C=T[3],E=(0,nn.vt)(),R=(0,nn.vt)();wT(E,M,C,a),wT(R,M,A,a);const P=b?"Upper":"Lower";let O=!0;for(let q=0;q<6;++q){for(let e=0;e<8;++e){const t=3*e,r=_(q,c[t],c[t+1],c[t+2]);O&&=r,(0,nx.GH)(r,`Tile[${this.lij}] Convex hull point ${e} outside of plane ${q}`)}(0,nx.GH)(v(q,R),`Tile[${this.lij}] (${P}) bottom mid outside of plane ${q}`),(0,nx.GH)(v(q,E),`Tile[${this.lij}] (${P}) top mid outside of plane ${q}`)}(0,nx.GH)(O,"Not all convex hull points are inside  convex hull polyhedron"),(0,nx.GH)(x(R),`Tile[${this.lij}] (${P}) bottom mid outside of bounding sphere`),(0,nx.GH)(x(E),`Tile[${this.lij}] (${P}) top mid outside of bounding sphere`);for(let q=0;q<8;++q){const e=S(c,3*q);(0,nx.GH)(e,`Tile[${this.lij}] Convex hull point ${q} outside of bounding sphere`)}for(let q=0;q<6;++q)for(let e=0;e<8;++e){const t=3*e;_(q,c[t],c[t+1],c[t+2])||console.error(`Tile[${this.lij}] Convex hull point ${e} outside of plane ${q}`)}const{extentInRadians:I}=this,L=Math.max(I[2]-I[0],I[3]-I[1]),N=Math.round(L*n),{renderData:D}=this;if(!D)return;const{geometry:F,geometryState:k,localOrigin:z}=D,U=F.vertexAttributes?.position;if(!U)return;const V=(0,nn.vt)(),B=F.numVerticesPerSide-2,{indices:j,indexCount:H,edgeVerticesStartIndex:G,poleVerticesStartIndex:Z}=F;if(!j)return;const $=new Set;for(let q=0;q<H;++q){const e=j[q];if($.has(e))continue;$.add(e);const a=e<Z,c=e>=G;let u=!1,h=-1;if(c){let t=G;for(let r=0;r<4;++r){const i=k.edgeResolutions[r];if(e===t||e===t+i-1){u=!0;break}if(t+=i,e<t){h=r;break}}}const d=c?k.edgePeerNeighbors[h]:null,p=c&&d&&(0,Nx.lR)(this,d)>0;U.getVec(e,i),(0,da.g)(V,i,z);const f=(0,da.H)(V)-n;let m=0,g=!1;const v=s-f,b=f-o,w=v>1,x=b>1,S=w||x,T=()=>{const t=a?"internal":c&&!u?"edge":u?"corner":"pole";return`Tile[${this.lij}].vertex[${e}]:${t}`+(w?"(below)":x?"(above)":"")+(p?"(Neighbor)":"")},M=(0,da.F)(V,r);if(M>=t+0){const e=M-t;S||(console.error(`${T()} is out of the bounding sphere by ${e.toFixed(0)} / ${t.toFixed(0)}[tol=0] h=${f.toFixed(0)} / [${s.toFixed(0)}..${o.toFixed(0)}] (${(e/t).toFixed(0)})`),g=!0)}for(let r=0;r<6;++r)if(!_(r,V[0],V[1],V[2])){const i=y(r,V[0],V[1],V[2]),n=e%B,a=(e-n)/B;0===r&&v||5===r&&b||(console.error(`${T()} (${n},${a})|${B}] is out of the bounding trapezoid plane ${r} h=${Math.round(f)} / [${Math.round(s)}..${Math.round(o)}] dist=${Math.round(i)} radii = ${Math.round(t)}/${Math.round(l)}} : maxL = ${N}`),++m)}if(g||m>0)break}}get convexHull(){return this._convexHull}}const _T=[128,64,64,32,16,8,8,4];function vT(e,t,r){return bT(e[0],e[1],e[2],t[r],t[r+1],t[r+2])}function bT(e,t,r,i,n,s){const o=i-e,a=n-t,l=s-r;return o*o+a*a+l*l}const wT=(e,t,r,i)=>{const n=Math.cos(t),s=Math.sin(t),o=Math.cos(r),a=Math.sin(r);e[0]=i*o*n,e[1]=i*o*s,e[2]=i*a},xT=[0,0,1],ST=(0,nn.vt)(),TT=(0,nn.vt)();let MT=class extends ht.A{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};(0,ze._)([(0,Qe.MZ)()],MT.prototype,"fovX",void 0),(0,ze._)([(0,Qe.MZ)()],MT.prototype,"fovY",void 0),(0,ze._)([(0,Qe.MZ)()],MT.prototype,"relativeWidthLimit",void 0),(0,ze._)([(0,Qe.MZ)()],MT.prototype,"relativeHeightLimit",void 0),(0,ze._)([(0,Qe.MZ)()],MT.prototype,"maxLod",void 0),(0,ze._)([(0,Qe.MZ)()],MT.prototype,"angledSplitBias",void 0),(0,ze._)([(0,Qe.MZ)()],MT.prototype,"aboveGround",void 0),(0,ze._)([(0,Qe.MZ)()],MT.prototype,"frustum",void 0),MT=(0,ze._)([(0,tt.$)("esri.views.3d.terrain.SplitLimits")],MT);var AT=r(88105),CT=r(29898);const ET=(0,Ml.BP)().vec3f(El.r.POSITION).vec2i16(El.r.UV0).vec2i16(El.r.NORMALCOMPRESSED,{glNormalized:!0});class RT{constructor(e){this._storage=new Ww.I(((t,r)=>e.newCache(t,r)),"TileGeometry")}acquire(e){const t=4*Math.ceil(e/4),r=this._storage,i=function(e){return e.toString()}(t),n=r.pop(i);if(n)return n;const s=ET.createBuffer(t);return s.release=()=>r.put(i,s),s}clear(){this._storage.clear()}destroy(){this._storage.destroy()}}var PT=r(32124);class OT extends Pa.K{constructor(){super(...arguments),this.blendMode=PT.IU.Normal}}(0,ze._)([(0,Pa.W)({count:PT.IU.COUNT})],OT.prototype,"blendMode",void 0);var IT=r(72702),LT=r(4747),NT=r(65826);class DT extends OT{constructor(){super(...arguments),this.output=LT.x.Composite,this.baseOpacityMode=IT.Q.NotRequired,this.premultipliedSource=NT.g.Off}}(0,ze._)([(0,Pa.W)({count:LT.x.COUNT})],DT.prototype,"output",void 0),(0,ze._)([(0,Pa.W)({count:IT.Q.COUNT})],DT.prototype,"baseOpacityMode",void 0),(0,ze._)([(0,Pa.W)()],DT.prototype,"premultipliedSource",void 0);var FT=r(25252),kT=r(28590);class zT extends FT.J{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=nn.uY}}class UT extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,UT.shader.get().build(this.configuration),Ta.D)}initializePipeline(){return(0,Ca.Ey)({blending:(0,Ca.ox)(Aa.dn.ONE,Aa.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Ca.wE})}}UT.shader=new xa.$(kT.B,(()=>r.e(4825).then(r.bind(r,54825))));class VT extends DT{constructor(){super(...arguments),this.background=kT.a.BelowLayer}}(0,ze._)([(0,Pa.W)()],VT.prototype,"background",void 0);class BT{constructor(e,t,r,i,n,s){this.texture=e,this.type=t,e.retain(),this.offsetAndScale=(0,ya.fA)(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=(0,nn.fA)(i,n,s)}destroy(){this.texture.release()}}var jT=r(72770),HT=(r(40181),r(93453)),GT=(r(15389),r(96345),r(85827)),ZT=r(36458),$T=r(62887),qT=r(6645),WT=r(76418);function YT(e,t,r,i,n,s){const{iconRotationAlignment:o,textRotationAlignment:a,iconTranslate:l,iconTranslateAnchor:c,textTranslate:u,textTranslateAnchor:h}=i;let d=0;for(const p of e.colliders){const[e,i]=0===p.partIndex?l:u,f=0===p.partIndex?c:h,m=p.minLod<=s&&s<=p.maxLod;d+=m?0:1,p.enabled=m,p.xScreen=p.xTile*n[0]+p.yTile*n[3]+n[6],p.yScreen=p.xTile*n[1]+p.yTile*n[4]+n[7],f===WT.Cq.MAP?(p.xScreen+=r*e-t*i,p.yScreen+=t*e+r*i):(p.xScreen+=e,p.yScreen+=i),WT.I5.VIEWPORT===(0===p.partIndex?o:a)?(p.dxScreen=p.dxPixels,p.dyScreen=p.dyPixels):(p.dxScreen=r*(p.dxPixels+p.width/2)-t*(p.dyPixels+p.height/2)-p.width/2,p.dyScreen=t*(p.dxPixels+p.width/2)+r*(p.dyPixels+p.height/2)-p.height/2)}e.colliders.length>0&&d===e.colliders.length&&(e.unique.show=!1)}class XT{constructor(e,t,r,i,n,s){this._symbols=e,this._styleRepository=i,this._zoom=n,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new qT.xT(t,r,$T.o2),this._si=Math.sin(Math.PI*s/180),this._co=Math.cos(Math.PI*s/180);for(const o of e)for(const e of o.symbols)this._allNeededMatrices.has(e.tile)||this._allNeededMatrices.set(e.tile,(0,GT.o8)(e.tile.transforms.tileUnitsToPixels))}work(e){const t=this._gridIndex;function r(e){const r=e.xScreen+e.dxScreen,i=e.yScreen+e.dyScreen,n=r+e.width,s=i+e.height,[o,a,l,c]=t.getCellSpan(r,i,n,s);for(let u=a;u<=c;u++)for(let e=o;e<=l;e++){const o=t.cells[u][e];for(const e of o){const t=e.xScreen+e.dxScreen,o=e.yScreen+e.dyScreen,a=t+e.width,l=o+e.height;if(!(n<t||r>a||s<o||i>l))return!0}}return!1}const i=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const t=this._symbols[this._currentLayerCursor],n=this._getProperties(t.styleLayerUID);for(;this._currentSymbolCursor<t.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-i>e)return!1;const s=t.symbols[this._currentSymbolCursor];if(!s.unique.show)continue;YT(s,this._si,this._co,n,this._allNeededMatrices.get(s.tile),this._zoom);const o=s.unique;if(!o.show)continue;const{iconAllowOverlap:a,iconIgnorePlacement:l,textAllowOverlap:c,textIgnorePlacement:u}=n;for(const e of s.colliders){if(!e.enabled)continue;const t=o.parts[e.partIndex];t.show&&(!(e.partIndex?c:a)&&r(e)&&(e.hard?o.show=!1:t.show=!1))}if(o.show)for(const e of s.colliders){if(!e.enabled)continue;if(e.partIndex?u:l)continue;if(!o.parts[e.partIndex].show)continue;const t=e.xScreen+e.dxScreen,r=e.yScreen+e.dyScreen,i=t+e.width,n=r+e.height,[s,a,c,h]=this._gridIndex.getCellSpan(t,r,i,n);for(let o=a;o<=h;o++)for(let t=s;t<=c;t++)this._gridIndex.cells[o][t].push(e)}}}return!0}_getProperties(e){const t=this._styleProps.get(e);if(t)return t;const r=this._zoom,i=this._styleRepository.getStyleLayerByUID(e),n=i.getLayoutValue("symbol-placement",r)!==WT.kt.POINT;let s=i.getLayoutValue("icon-rotation-alignment",r);s===WT.I5.AUTO&&(s=n?WT.I5.MAP:WT.I5.VIEWPORT);let o=i.getLayoutValue("text-rotation-alignment",r);o===WT.I5.AUTO&&(o=n?WT.I5.MAP:WT.I5.VIEWPORT);const a=i.getPaintValue("icon-translate",r),l=i.getPaintValue("icon-translate-anchor",r),c=i.getPaintValue("text-translate",r),u=i.getPaintValue("text-translate-anchor",r),h={iconAllowOverlap:i.getLayoutValue("icon-allow-overlap",r),iconIgnorePlacement:i.getLayoutValue("icon-ignore-placement",r),textAllowOverlap:i.getLayoutValue("text-allow-overlap",r),textIgnorePlacement:i.getLayoutValue("text-ignore-placement",r),iconRotationAlignment:s,textRotationAlignment:o,iconTranslateAnchor:l,iconTranslate:a,textTranslateAnchor:u,textTranslate:c};return this._styleProps.set(e,h),h}}function JT(e,t){if(e.priority-t.priority)return e.priority-t.priority;const r=e.tile.key,i=t.tile.key;return r.world-i.world?r.world-i.world:r.level-i.level?r.level-i.level:r.row-i.row?r.row-i.row:r.col-i.col?r.col-i.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}class KT{get running(){return this._running}constructor(e,t,r,i,n,s){this._visibleTiles=e,this._symbolRepository=t,this._createCollisionJob=r,this._assignTileSymbolsOpacity=i,this._symbolLayerSorter=n,this._isLayerVisible=s,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const t=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const t=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}return this._running=!1,!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let o=0;o<e.length;o++){const t=e[o];for(let e=0;e<t.uniqueSymbols.length;e++){const r=t.uniqueSymbols[e];for(const e of r.tileSymbols)e.selectedForRendering=!1}}const t=[];let r=0,i=0;const n=this._isLayerVisible;const s=this._symbolLayerSorter;return{work:function(s){let o;const a=performance.now();for(;i<e.length;i++,r=0){const l=e[i],c=l.styleLayerUID;if(!n(c)){t[i]||(t[i]={styleLayerUID:c,symbols:[]});continue}t[i]=t[i]||{styleLayerUID:c,symbols:[]};const u=t[i];for(;r<l.uniqueSymbols.length;r++){if(o=l.uniqueSymbols[r],r%100==99&&performance.now()-a>s)return!1;let e=null,t=!1,i=!1;for(const r of o.tileSymbols)if(!i||!t){const n=r.tile;(!e||n.isCoverage||n.neededForCoverage&&!t)&&(e=r,(n.neededForCoverage||n.isCoverage)&&(i=!0),n.isCoverage&&(t=!0))}if(e.selectedForRendering=!0,i){u.symbols.push(e),o.show=!0;for(const e of o.parts)e.show=!0}else o.show=!1}}for(const e of t)e.symbols.sort(JT);return!0},get sortedSymbols(){return t.sort(s)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,t=this._visibleTiles;let r=0;function i(t,r){const n=t.symbols;for(const[e,i]of n)QT(i,r);e(t,r);for(const e of t.childrenTiles)i(e,r)}return{work(e){const n=performance.now();for(;r<t.length;r++){if(performance.now()-n>e)return!1;const s=t[r];null==s.parentTile&&i(s,performance.now())}return!0}}}}function QT(e,t){for(const r of e){const e=r.unique;for(const r of e.parts){const i=r.targetOpacity>.5?1:-1;r.startOpacity+=i*((t-r.startTime)/$T.zk),r.startOpacity=Math.min(Math.max(r.startOpacity,0),1),r.startTime=t,r.targetOpacity=e.show&&r.show?1:0}}}class eM{constructor(e,t,r){this.tileCoordRange=e,this._visibleTiles=t,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(e,t){this._uniqueSymbolLayerArray=null;let r=this._tiles.get(e.id);r||(r={symbols:new Map},this._tiles.set(e.id,r));const i=new Map;if(t)for(const o of t)r.symbols.has(o)&&(i.set(o,r.symbols.get(o)),r.symbols.delete(o));else for(const[o,a]of e.layerData)r.symbols.has(o)&&(i.set(o,r.symbols.get(o)),r.symbols.delete(o));this._removeSymbols(i);const n=e.symbols,s=new Map;for(const[o,a]of n){let e=a.length;if(e>=32){let t=this.tileCoordRange;do{t/=2,e/=4}while(e>8&&t>64);const i=new qT.xT(this.tileCoordRange,this.tileCoordRange,t);s.set(o,{flat:a,index:i}),r.symbols.set(o,{flat:a,index:i});for(const e of a)i.getCell(e.xTile,e.yTile).push(e)}else s.set(o,{flat:a}),r.symbols.set(o,{flat:a})}this._addSymbols(e.key,n)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const[t,r]of this._tiles){const i=new Map;for(const t of e)r.symbols.has(t)&&(i.set(t,r.symbols.get(t)),r.symbols.delete(t));this._removeSymbols(i),0===r.symbols.size&&this._tiles.delete(t)}}removeTile(e){this._uniqueSymbolLayerArray=null;const t=this._tiles.get(e.id);if(!t)return;const r=new Map;for(const[i,n]of e.symbols)t.symbols.has(i)&&(r.set(i,t.symbols.get(i)),t.symbols.delete(i));this._removeSymbols(r),0===t.symbols.size&&this._tiles.delete(e.id)}querySymbols(e,t,r,i){const n=[],s=this.uniqueSymbols;for(const o of s){const i=o.styleLayerUID,s=o.uniqueSymbols;for(const o of s){const s=o.tileSymbols.find((e=>e.selectedForRendering));s&&(0,qT.OI)(s,e,t*(window.devicePixelRatio||1),r)&&n.push({vtlSymbol:s,styleLayerUID:i,tileKey:s.tile.key})}}return n}_removeSymbols(e){for(const[t,{flat:r}]of e)for(const e of r){const r=e.unique,i=r.tileSymbols,n=i.length-1;for(let t=0;t<n;t++)if(i[t]===e){i[t]=i[n];break}if(i.length=n,0===n){const e=this._uniqueSymbolsReferences.get(t);e.delete(r),0===e.size&&this._uniqueSymbolsReferences.delete(t)}e.unique=null}}_addSymbols(e,t){if(0===t.size)return;const r=this._visibleTiles;for(const i of r)i.parentTile||i.key.world!==e.world||i.key.level===e.level&&!i.key.equals(e)||this._matchSymbols(i,e,t);for(const[i,n]of t)for(const e of n)if(null==e.unique){const t=this._createUnique();e.unique=t,t.tileSymbols.push(e);let r=this._uniqueSymbolsReferences.get(i);r||(r=new Set,this._uniqueSymbolsReferences.set(i,r)),r.add(t)}}_matchSymbols(e,t,r){if(e.key.level>t.level){const r=e.key.level-t.level;if(e.key.row>>r!==t.row||e.key.col>>r!==t.col)return}if(t.level>e.key.level){const r=t.level-e.key.level;if(t.row>>r!==e.key.row||t.col>>r!==e.key.col)return}if(t.equals(e.key)){for(const i of e.childrenTiles)this._matchSymbols(i,t,r);return}const i=new Map;for(const[n,s]of r){const r=[];for(const i of s){const n=(0,qT.I)(this.tileCoordRange,i.xTile,t.level,t.col,e.key.level,e.key.col),s=(0,qT.I)(this.tileCoordRange,i.yTile,t.level,t.row,e.key.level,e.key.row);n>=0&&n<this.tileCoordRange&&s>=0&&s<this.tileCoordRange&&r.push({symbol:i,xTransformed:n,yTransformed:s})}const o=[],a=20+(e.key.level<t.level?1:1<<e.key.level-t.level),l=this._tiles.get(e.id).symbols.get(n);if(l){const e=l.flat;for(const t of r){let r,i=!1;const n=t.xTransformed,s=t.yTransformed;r=null!=l.index?l.index.getCell(n,s):e;const c=t.symbol,u=c.hash;for(const e of r)if(u===e.hash&&Math.abs(n-e.xTile)<=a&&Math.abs(s-e.yTile)<=a){const t=e.unique;c.unique=t,t.tileSymbols.push(c),i=!0;break}i||o.push(c)}}o.length>0&&i.set(n,o)}for(const n of e.childrenTiles)this._matchSymbols(n,t,i)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsReferences,t=new Array(e.size);let r,i=0;for(const[n,s]of e){const e=new Array(s.size);r=0;for(const t of s)e[r++]=t;t[i]={styleLayerUID:n,uniqueSymbols:e},i++}return t}}const tM=(0,GT.vt)();var rM=r(4273);class iM extends rM.Y{_createTransforms(){return{displayViewScreenMat3:(0,GT.vt)(),tileMat3:(0,GT.vt)()}}}class nM{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const t=[];for(const r of this._candidateTiles)e>0?(r.reshuffle(),e--):t.push(r);this._candidateTiles=t}}class sM{constructor(){this._renderParams={reshuffleManager:new nM,context:null,drawPhase:1,state:new oM,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new iM(new HT.A(0,0,0,0),0,0,0,512,512,4096,4096),this._heading=0,this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(e,t,r,i,n,s,o,a,l,c){const u=this._backgroundTile;this._updateRenderParameters(e,t,u,r,n,s,o,a,l,c),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,u,i)}renderContent(e,t,r,i,n,s,o,a,l,c,u,h){this._declutter(r),i.forAll((e=>this._declutter(e.sourceLayerInfo.data))),this._stencilSymbols(e,t,r,i,n,s,o,Math.round(1/a),l,c,u,h);let d=1;r.stencilRef=d++,e.setStencilFunction(Aa.MT.EQUAL,r.stencilRef,255),this._render(e,t,r,n,s,o,a,l,c,u,h),i.forAll((t=>{t.sourceLayerInfo.data.stencilRef=d++,this._renderSymbols(e,t.sourceLod,t.sourceLayerInfo.data,n,s,o,Math.round(1/a),t.offset,c,u,h)}))}_stencilSymbols(e,t,r,i,n,s,o,a,l,c,u,h){let d=1;r.stencilRef=d++,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(Aa.eA.KEEP,Aa.eA.KEEP,Aa.eA.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(Aa.MT.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(e,t,r,n,s,o,a,l,c,u,h);for(const p of i.toArray()){const{sourceLod:t,offset:r,sourceLayerInfo:i}=p;i.data.stencilRef=d++,e.setStencilFunction(Aa.MT.ALWAYS,i.data.stencilRef,255),this._stencilTileSymbols(e,t,i.data,n,s,o,a,r,c,u,h)}e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,t,r,i,n,s,o,a,l,c,u){e.setStencilFunction(Aa.MT.EQUAL,r.stencilRef,255),this._render(e,t,r,i,n,s,o,a,l,c,u,WT.Dc.SYMBOL)}_render(e,t,r,i,n,s,o,a,l,c,u,h){this._updateRenderParameters(e,t,r,i,s,o,a,l,c,u),this._renderParams.stencilSymbols=!1,i.drawTile(this._renderParams,r,n,h)}_stencilTileSymbols(e,t,r,i,n,s,o,a,l,c,u){this._updateRenderParameters(e,t,r,i,s,o,a,l,c,u),this._renderParams.stencilSymbols=!0,r.triangleCount=0,i.drawSymbols(this._renderParams,r,n)}_updateRenderParameters(e,t,r,i,n,s,o,a,l,c){"type"in r&&"vector-tile"===r.type&&!r.stage&&r.attachWithContext(e);const u=t[0]-n.getLevelShift(t[0]),h=this._renderParams;h.context=e,h.painter=i,h.glyphMosaic=i.glyphMosaic,h.spriteMosaic=i.spriteMosaic,h.pixelRatio=l*c,h.displayLevel=u,h.requiredLevel=u;const d=n.getScale(t[0]),[p,f]=n.getOffset(t,s*d),m=.125*s*d/a,g=r.transforms.displayViewScreenMat3;g[0]=m,g[4]=-m,g[6]=-1-p-o[0]*s*2,g[7]=1+f+(1-o[1])*s*2-2;const y=h.state,_=a/c;y.size[0]=_,y.size[1]=_,y.pixelRatio=c,y.rotation=(360-this._heading)%360;const v=2/_;(0,Za.hZ)(y.displayViewMat3,v,0,0,0,-v,0,-1,1,1);const b=(0,Za.D_)(y.displayMat3),w=(0,nd.DF)(this._heading);(0,Za.Tl)(b,b,[_/2,_/2]),(0,Za.e$)(b,b,w),(0,Za.Tl)(b,b,[-_/2,-_/2]),(0,Za.lw)(b,y.displayViewMat3,b)}updateHeading(e){this._heading=e}_declutter(e){this._declutteredForHeading.get(e)!==this._heading&&(function(e,t){const r=e.transforms.tileUnitsToPixels,i=(0,nd.DF)(t),n=Math.cos(i),s=Math.sin(i),o=Math.ceil(512*(Math.abs(s)+Math.abs(n)));(0,Za.D_)(tM),(0,Za.Tl)(tM,tM,[o/2,o/2]),(0,Za.e$)(tM,tM,i),(0,Za.Tl)(tM,tM,[-256,-256]),(0,Za.hs)(tM,tM,[1/8,1/8,1]),e.transforms.tileUnitsToPixels=tM;const a=[],l=new eM(4096,a,(()=>new ZT.S)),c=new KT(a,l,((r,i,n)=>new XT(r,i,n,e.styleRepository,e.key.level,t)),((e,t)=>{(0,qT.jy)(e,t,!1)}),(()=>0),(t=>{const r=e.styleRepository.getStyleLayerByUID(t).getLayoutProperty("visibility");return!r||r.getValue()!==WT.bv.NONE}));a.push(e),l.add(e),c.setScreenSize(o,o),c.continue(1/0),l.removeTile(e),e.transforms.tileUnitsToPixels=r}(e,(360-this._heading)%360),this._declutteredForHeading.set(e,this._heading))}}class oM{constructor(){this.size=[0,0],this.pixelRatio=1,this.rotation=0,this.displayMat3=(0,Zh.vt)(),this.displayViewMat3=(0,Zh.vt)(),this.transform=null,this.inverseTransform=null,this.viewMat2d=null,this.viewMat3=null,this.id=0,this.extent=null,this.center=null,this.scale=1,this.resolution=0,this.worldScreenWidth=0,this.spatialReference=null,this.viewpoint=null,this.getScreenTransform=null,this.toMap=null,this.toScreen=null,this.clone=null,this.copy=null,this.toJSON=null}}var aM=r(745);class lM extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,lM.shader.get().build(this.configuration),Ta.D)}initializePipeline(){return(0,Ca.Ey)({blending:(0,Ca.ox)(Aa.dn.ONE,Aa.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Ca.wE})}}lM.shader=new xa.$(aM.R,(()=>r.e(4713).then(r.bind(r,64713))));class cM extends DT{constructor(){super(...arguments),this.colorizerType=jT.T.Stretch,this.stretchType=jT.M.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}}(0,ze._)([(0,Pa.W)({count:jT.T.COUNT})],cM.prototype,"colorizerType",void 0),(0,ze._)([(0,Pa.W)({count:jT.M.COUNT})],cM.prototype,"stretchType",void 0),(0,ze._)([(0,Pa.W)()],cM.prototype,"applyColormap",void 0),(0,ze._)([(0,Pa.W)()],cM.prototype,"requireBilinearWithNN",void 0);var uM=r(88800);class hM{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach((e=>e.dispose())),this._fbos.clear()}_getPool(e){const t=this._fbos.get(e);if(t)return t;const r=new nl.H(this._rctx,new sl.R(e),new uM.q(Aa.yQ.DEPTH24_STENCIL8,e));return this._fbos.set(e,r),r}}class dM{constructor(e,t){this._rctx=e,this._techniques=t,this._fbos=[],this._vectorTileHelper=new sM,this._bindParameters=new al.k(null,null),this._blendLayersTechniqueConfig=new VT,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=(0,Da.Q)(this._rctx,Na.u7)}dispose(){this._fbos.forEach(Je.WD),this._fbos=null,this._vtFBO=(0,Je.WD)(this._vtFBO),this._vaoQuad=(0,Je.WD)(this._vaoQuad),this._vectorTileHelper=(0,Je.WD)(this._vectorTileHelper),this._backgroundTechnique=(0,Je.Gz)(this._backgroundTechnique),this._applyOpacityTechnique=(0,Je.Gz)(this._applyOpacityTechnique),this._blendLayersTechnique=(0,Je.Gz)(this._blendLayersTechnique)}updateHeading(e){this._vectorTileHelper?.updateHeading(e)}_getBlendLayersTechnique(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:NT.g.Off,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:kT.a.BelowLayer;return this._blendLayersTechniqueConfig.output=t,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=i,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniques.releaseAndAcquire(UT,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,t){const r=this._getBlendLayersTechnique(PT.IU.Normal,t?LT.x.ColorComposite:LT.x.GridComposite,IT.Q.NotRequired,NT.g.Off,kT.a.Only),i=this._rctx.bindTechnique(r,this._bindParameters,e);this._render(i)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Aa.WR.TRIANGLE_STRIP,0,(0,Ol.mT)(this._vaoQuad,"geometry"))}drawGroup(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:NT.g.On;t===LT.x.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const s=e.baseOpacity<1?IT.Q.Required:IT.Q.NotRequired,o=this._getBlendLayersTechnique(i,t,s,n),a=this._rctx.bindTechnique(o,this._bindParameters,e);this._render(a)}drawImageData(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:NT.g.Off;if(null==e.texture)return;const s=e.baseOpacity<1?IT.Q.Required:IT.Q.NotRequired;e.fboTexture=t===LT.x.GroupBackgroundComposite||i===PT.IU.Normal&&s===IT.Q.NotRequired&&n===NT.g.Off?null:this.switch(r).colorTexture;const o=this._getBlendLayersTechnique(i,t,s,n),a=this._rctx.bindTechnique(o,this._bindParameters,e);this._render(a)}drawRasterData(e,t,r,i,n){const s=n.sourceLayerInfo.data;if(!s.source)return;if(n.tile.surface.layerViewByIndex(n.layerIndex,wb.MAP).ensureSymbolizerParameters(s),!s.bind(this._rctx))return;const o=e.baseOpacity<1?IT.Q.Required:IT.Q.NotRequired;e.fboTexture=i===PT.IU.Normal&&o===IT.Q.NotRequired?null:this.switch(r).colorTexture;const a=this._getRasterColorizerTechnique(s,t,i,o);s.opacity=e.opacity;const l=s.getUniforms();l.scale=n.scale,l.offset=n.offset,l.backgroundColor=e.backgroundColor,l.fboTexture=e.fboTexture,l.baseOpacity=e.baseOpacity;const c=this._rctx.bindTechnique(a,null,l);this._render(c)}_getRasterColorizerTechnique(e,t,r,i){const n=e.symbolizerParameters,s=["stretch","lut","hillshade"].indexOf(n.type);return null==this._rasterColorizerConfig&&(this._rasterColorizerConfig=new cM,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=t,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=i,this._rasterColorizerConfig.colorizerType=s,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?jT.M.Noop:jT.M.PerBand,this._rasterColorizerTechnique=this._techniques.releaseAndAcquire(lM,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,t,r,i,n,s,o,a){const l=this._rctx,c=n.sourceLayerInfo.data,u=n.tile.surface.layerViewByIndex(n.layerIndex,wb.MAP),h=e.baseOpacity<1?IT.Q.Required:IT.Q.NotRequired,d=h===IT.Q.Required||e.opacity<1||i!==PT.IU.Normal||t!==LT.x.Composite,p=d?NT.g.On:NT.g.Off,f=this._getBlendLayersTechnique(i,t,h,p);l.setPipelineState(f.getPipeline());let m=null,g=null;d?(g=this.currentFBO(r),null==this._vtFBO&&(this._vtFBO=new hM(this._rctx)),m=this._vtFBO.get(r),l.bindFramebuffer(m),this._clearCurrentFBO()):a&&l.clear(Aa.hn.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(l,n.sourceLod,u.painter,u.layer.styleRepository,u.schemaHelper,Math.round(1/n.scale),n.offset,o,s,u.contentZoom),c&&this._vectorTileHelper.renderContent(l,n.sourceLod,c,n.vtlNeighborInfos,u.painter,u.layer.styleRepository,u.schemaHelper,Math.round(1/n.scale),n.offset,o,s,u.contentZoom)}catch(ct){Xe.A.getLogger("esri.views.3d.terrain").warnOnce("A render call containing vector tiles did not resolve correctly.",ct)}return null==m||(l.bindFramebuffer(g),e.texture=m.colorTexture,e.offset=va.uY,e.scale=1,this.drawImageData(e,t,r,i,p),a)}copyFBOToTexture(e){const t=this._rctx,r=t.bindTexture(e.texture,Pl.g.TEXTURE_UNIT_FOR_UPDATES),i=e.descriptor;t.gl.copyTexImage2D(Aa.Ap.TEXTURE_2D,0,i.pixelFormat,0,0,i.width,i.height,0),e.generateMipmap(),t.bindTexture(r,Pl.g.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clear(Aa.hn.COLOR_BUFFER_BIT|Aa.hn.DEPTH_BUFFER_BIT|Aa.hn.STENCIL_BUFFER_BIT)}_initFBO(e,t,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,t,t),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._current=t,t>=this._fbos.length)for(let i=this._fbos.length;i<=t;i++)this._fbos.push(new hM(this._rctx));this._initFBO(this._fbos[t].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const t=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),t}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const t=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(t),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}}class pM{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}}class fM{constructor(e,t){this._texture=e,this._cache=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,0===this._refCount)if(this._cache){const e=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(e,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}}class mM{constructor(e,t,r,i,n,s){this.start=e,this.end=t,this.blendMode=r,this.opacity=i,this.output=n,this.baseOpacity=s}}class gM{constructor(e,t,r,i){this._rctx=e,this.tileSize=t,this._techniques=r,this._cache=i,this._passParameters=new zT,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._compositor=new dM(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._compositor=(0,Je.WD)(this._compositor),this._backgroundTexture=(0,Je.Gz)(this._backgroundTexture)}get backgroundIsGrid(){return null==this._backgroundColor}get backgroundColor(){return this._backgroundColor}updateHeading(e){this._compositor?.updateHeading(e)}updateTileTexture(e,t){if(!e.renderData)return;const r=e.surface,i=r.baseOpacity;let n=0,s=0,o=this.tileSize,a=!1,l=!1;const c=r.view.state.contentPixelRatio;let u=!1;xM.clear(),SM.length=0;const h=e.layerInfo[wb.MAP];let d=0,p=null;for(;d<h.length;d++){const t=r.layerViewByIndex(d,wb.MAP),f=t.layer.opacity,m=t.fullOpacity;if(l=l||(0,vt.rz)(t.layer),(0,nx.KE)(t)){let e="normal"!==t.layer.blendMode;if((0,vt.jZ)(t.layer.parent)){const r=_M(t.layer.parent);null!=r&&""!==r&&(e=bM(t.layer.parent)||e)}e&&(u=e,a=!1)}if(0===f&&!u){h[d].pendingUpdates&=~(jx.TEXTURE_NOFADING&jx.TEXTURE_FADING);continue}++s;const g=(0,nx.G3)(t),y=yM(e,d,g);if(y){if(h[d].pendingUpdates&=~(jx.TEXTURE_NOFADING&jx.TEXTURE_FADING),(0,vt.jZ)(t.layer.parent)){const e=_M(t.layer.parent);null!=e&&""!==e&&wM(t.layer.parent,d)}g?o=Math.max(o,this.tileSize*c):1===i&&1===m&&(t.isOpaque||this._dataToTexture(y)&&y.sourceLayerInfo.data.descriptor.isOpaque)&&(a=!0),++n,null===p&&(p=d)}}const f=o/this.tileSize,m=this._ensureBackgroundTexture(this.tileSize);0!==n&&null!==p?1===n&&!u&&this._useLayerTexture(e,p)||this._composeLayers(e,t,d-1,l,o,f,!a||u,xM,u):function(e,t,r,i){const n=e.renderData,s=!i&&null!=n.textureReference&&(e.surface.view.layerViewManager.updating||t>0)?Lx.Delayed:Lx.Immediate;n.setTextureReference(new BT(r,cx.ZY.FADING,MM,e.surface.baseOpacity,0,1),s)}(e,s,m,t!==cx.ZY.FADING)}_ensureBackgroundTexture(e){return null==this._backgroundTexture&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._compositor.bind(e),this._passParameters.offset=va.uY,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,null!=this.backgroundColor),this._compositor.copyFBOToTexture(this._backgroundTexture),this._compositor.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useLayerTexture(e,t){const r=e.surface.layerViewByIndex(t,wb.MAP),i=(0,vt.rz)(r.layer),n=i?e.surface.baseOpacity:1,s=i?1:e.surface.baseOpacity,o=r.fullOpacity,a=yM(e,t,!1);return!!this._dataToTexture(a)&&(e.renderData.setTextureReference(new BT(a.sourceLayerInfo.data,cx.ZY.FADING,a,n,s,o)),!0)}_composeLayers(e,t,r,i,n,s,o,a,l){this._compositor.ensureBuffer(n);const c=e.surface.baseOpacity;let u=!1,h=Aa.Cj.LINEAR_MIPMAP_LINEAR,d=!1,p=0;for(let y=r;y>=0;y--){const t=e.surface.layerViewByIndex(y,wb.MAP),r=(0,nx.G3)(t),f=yM(e,y,r),m=t.layer.opacity;if(!f||0===m&&!l)continue;const g=!(0,vt.rz)(t.layer)&&!u;g&&(u=!0);let _=!1;a.forEach((e=>{e.start===y&&(e.output=i?LT.x.Composite:o&&g?this.backgroundIsGrid?LT.x.GridComposite:LT.x.ColorComposite:LT.x.Composite,e.baseOpacity=g?c:1,SM.push(e),this._compositor.openGroup(n),_=!0)}));const v=0===p,b=_?LT.x.GroupBackgroundComposite:o&&v?this.backgroundIsGrid?LT.x.GridComposite:LT.x.ColorComposite:LT.x.Composite,w=PT.wy[(0,nx.KE)(t)?t.layer.blendMode:"normal"];for(this._passParameters.baseOpacity=g&&!_&&c<1?c:1,this._passParameters.opacity=m,(0,nx.cU)(f)?d=this._compositor.drawVectorData(this._passParameters,b,n,w,f,s,this.tileSize,d):(0,nx.fe)(f)?(this._compositor.drawRasterData(this._passParameters,b,n,w,f),vM(f)&&(h=Aa.Cj.NEAREST)):this._dataToTexture(f)&&(this._passParameters.texture=f.sourceLayerInfo.data.texture,this._passParameters.offset=f.offset,this._passParameters.scale=f.scale,this._compositor.drawImageData(this._passParameters,b,n,w));SM.length>0&&SM[SM.length-1].end===y;){const e=SM.pop();this._passParameters.baseOpacity=e.baseOpacity,this._passParameters.opacity=e.opacity,this._passParameters.offset=va.uY,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,e.output,n,PT.wy[e.blendMode])}p++}const f=e.renderData,m=l||u&&c<1,g=f.ensureTexture(n,m,(()=>this._buildTexture(n,m,h)));this._compositor.copyFBOToTexture(g),this._compositor.unbind(),f.setTextureReference(new BT(g,t,MM,u?1:c,0,1))}_dataToTexture(e){if((0,nx.rI)(e)){const t=e.sourceLayerInfo;t.data=this._buildTexture(t.data,!0),e.tile.setMemoryDirty()}return(0,nx.E5)(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Aa.Cj.LINEAR_MIPMAP_LINEAR;if(null==e)return null;const i=new sl.R;i.wrapMode=Aa.pF.CLAMP_TO_EDGE,i.samplingMode=r,i.maxAnisotropy=this._maxAnisotropy,i.preMultiplyAlpha=!0,i.flipped=!0,i.hasMipmap=!0,t||(i.pixelFormat=Aa.Ab.RGB);const n=this._rctx;let s;if("number"==typeof e)i.width=i.height=e,s=this._buildTileTexture(i,e);else if((0,Zb.EM)(e))i.isOpaque=e.isOpaque,i.isOpaque&&(i.pixelFormat=Aa.Ab.RGB),s=this._buildTileTexture(i,e.element.width,e.element);else try{i.width=e.width,i.height=e.height,s=this._buildTileTexture(i,e.width,e)}catch(a){s=new fM((0,Da.T)(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=n.bindTexture(s.texture,Pl.g.TEXTURE_UNIT_FOR_UPDATES);return s.generateMipmap(),n.bindTexture(o,Pl.g.TEXTURE_UNIT_FOR_UPDATES),s}_buildTileTexture(e,t,r){const i=`${t} ${e.pixelFormat}`,n=this._cache.pop(i);return n?(n.retain(),n.texture.setData(r),n):new fM(new Pl.g(this._rctx,e,r),this._cache)}get test(){}}function yM(e,t,r){TM.layerIndex=t,TM.vtlNeighborInfos.clear();const i=e.layerInfo[wb.MAP][t];if((0,ma.hZ)(TM.offset,0,0),TM.tile=e,TM.scale=1,TM.sourceLod=e.lij,TM.sourceLayerInfo=i,TM.isVTLBackground=r,i.data)return r&&e.forEachLoadedNeighbor(((r,n)=>{if(r.level!==e.level)return;const s=r.layerInfo[wb.MAP][t];if(!(0,nx.Y4)(s)||i.data===s.data)return;const o=TM.vtlNeighborInfos.pushNew();o.offset=AM[n],o.sourceLod=r.lij,o.sourceLayerInfo=s})),TM;const n=i.upsampleInfo;if(n){const e=n.tile.layerInfo[wb.MAP][t];return TM.tile=n.tile,(0,ma.C)(TM.offset,n.offset),TM.scale=n.scale,TM.sourceLod=n.tile.lij,TM.sourceLayerInfo=e,TM}return r?TM:null}function _M(e){return e.uid}function vM(e){const t=e.sourceLayerInfo.data;return!!t.source&&"nearest"===t.interpolation}function bM(e){let t="normal"!==e.blendMode;return(0,vt.jZ)(e.parent)&&(t=bM(e.parent)||t),t}function wM(e,t){(0,vt.jZ)(e.parent)&&wM(e.parent,t);const r=_M(e);if(null!=r&&""!==r){const i=xM.get(r);i?i.start=t:xM.set(r,new mM(t,t,e.blendMode,e.opacity,LT.x.Composite,1))}}const xM=new Map,SM=new Array,TM=new class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new Ty.A({allocator:e=>e||new pM})}},MM={offset:[0,0],scale:1},AM=new Array;AM[Ax.N.NORTH]=[0,-1],AM[Ax.N.NORTH_EAST]=[-1,-1],AM[Ax.N.EAST]=[-1,0],AM[Ax.N.SOUTH_EAST]=[-1,1],AM[Ax.N.SOUTH]=[0,1],AM[Ax.N.SOUTH_WEST]=[1,1],AM[Ax.N.WEST]=[1,0],AM[Ax.N.NORTH_WEST]=[1,-1];const CM=1e-6;class EM{constructor(e,t,r,i,n){this.aabb=e,this.axis=t,this.d=r,this.midStartIndex=i,this.rightStartIndex=n}}class RM{constructor(e,t,r,i){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=t,this.positions=i,this._rayDirection=(0,nn.vt)(),this._callback=DM,this._intersectionOptions=NM,this.bspNodeTree=new Array;const n=r-t,s=new(n<IM?Uint8Array:n<LM?Uint16Array:Uint32Array)(n);this.triangleIndexMap=s;for(let o=0;o<n;++o)s[o]=o;{const o=function(e,t,r,i,n){const s=r-t,o=new Float32Array(6*s);for(let a=0;a<s;++a){const r=3*(a+t),s=e[r]*n,l=e[r+1]*n,c=e[r+2]*n;for(let e=0;e<3;++e){const t=i[s+e],r=i[l+e],n=i[c+e];o[6*a+e]=Math.min(t,r,n),o[6*a+3+e]=Math.max(t,r,n)}}return o}(e,t,r,i.data,i.stride),a=(0,ws.qE)(Math.log2(n/40),2,10),l=(e,t,r)=>{const i=function(e,t,r,i){if(i<=r)return(0,If.fA)(NaN,NaN,NaN,NaN,NaN,NaN);{const i=6*e[r];for(let e=0;e<3;++e)PM[e]=t[i+0+e],OM[e]=t[i+3+e]}for(let n=r+1;n<i;++n){const r=6*e[n];for(let e=0;e<3;++e)PM[e]=Math.min(PM[e],t[r+0+e]),OM[e]=Math.max(OM[e],t[r+3+e])}return(0,If.fA)(PM[0],PM[1],PM[2],OM[0],OM[1],OM[2])}(s,o,e,t),n=t-e;if(n<=40){const r=new EM(i,void 0,0,e,t);return this.bspNodeTree.push(r),r}const{axis:c,midValue:u}=function(e){const t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2],n=t>r?t>i?0:r>i?1:2:r>i?1:i>t?2:0;return{axis:n,midValue:(e[n]+e[n+3])/2}}(i),h=function(e,t,r,i,n,s){let o=r,a=i;for(;o<a;){const r=e[o];t[6*r+n+3]<=s?++o:(--a,e[o]=e[a],e[a]=r)}let l=o;for(a=i;l<a;){const r=e[a-1];t[6*r+n]>=s?--a:(e[a-1]=e[l],e[l]=r,++l)}return{next:o,mid:l}}(s,o,e,t,c,u),d=(e,t)=>{if(r>a)return;const i=t-e;return i<40||i>=.8*n?void 0:l(e,t,r+1)},p=new EM(i,c,u,h.next,h.mid);return this.bspNodeTree.push(p),p.leftNode=d(e,h.next),p.rightNode=d(h.mid,t),p};l(0,n,0)}}intersectRayTriangleRange(e,t){if(e>=t)return;const r=this.positions;(0,uT.h7)(this._rayFrom,this._rayDirection,e,t,this.globalTriangleVertexIndices,r.data,r.stride,this._intersectionOptions.normalRequired,this._callback,this.triangleIndexMap,this.firstTriangleIndex),RM.numFacesTested+=t-e}intersectRay(e,t,r,i){RM.numFacesTested=0;const n=e,s=t,o=s[0]-n[0],a=s[1]-n[1],l=s[2]-n[2];if(o*o+a*a+l*l<CM)return;this._rayFrom=n;const c=this._rayDirection;c[0]=o,c[1]=a,c[2]=l;const u=this.triangleIndexMap.length;this._callback=i,this._intersectionOptions=r,this.intersectRayBSP(this.bspNodeTree[0],0,u),this._callback=DM,this._intersectionOptions=NM}intersectRayBSP(e,t,r){const i=this._rayFrom,n=this._rayDirection;if(!function(e,t,r){const i=t,n=r;let s=0,o=1/0;for(let a=0;a<3;++a){{const t=e[a];if(i[a]<t){if(n[a]<=CM)return!1;const e=(t-i[a])/n[a];s=Math.max(s,e)}else if(n[a]<=-1e-6){const e=(t-i[a])/n[a];o=Math.min(o,e)}if(s>o)return!1}{const t=e[a+3];if(i[a]>t){if(n[a]>=-1e-6)return!1;const e=(t-i[a])/n[a];s=Math.max(s,e)}else if(n[a]>=CM){const e=(t-i[a])/n[a];o=Math.min(o,e)}if(s>o)return!1}}return!0}(e.aabb,i,n))return;const s=e.axis,o=e.d;if(i[s]<o||n[s]<0){const r=t,i=e.midStartIndex;if(r<i){const t=e.leftNode;void 0!==t?this.intersectRayBSP(t,r,i):this.intersectRayTriangleRange(r,i)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),i[s]>o||n[s]>0){const t=e.rightStartIndex,i=r;if(t<i){const r=e.rightNode;void 0!==r?this.intersectRayBSP(r,t,i):this.intersectRayTriangleRange(t,i)}}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}}RM.numFacesTested=0;const PM=[1/0,1/0,1/0],OM=[-1/0,-1/0,-1/0];const IM=255,LM=65535,NM=new uT.JG,DM=()=>{};var FM=r(38918),kM=r(50468),zM=r(16699),UM=r(59046),VM=r(97808),BM=r(26719),jM=r(12057),HM=r(92656);class GM extends HM.E{constructor(){super(...arguments),this.output=oS.V.Color,this.overlayMode=jM.w9.Disabled,this.tileBlendInput=FM.k.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.opaque=!0,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=BM.A9.Simplified}}(0,ze._)([(0,Pa.W)({count:oS.V.COUNT})],GM.prototype,"output",void 0),(0,ze._)([(0,Pa.W)({count:jM.w9.COUNT})],GM.prototype,"overlayMode",void 0),(0,ze._)([(0,Pa.W)({count:FM.k.COUNT})],GM.prototype,"tileBlendInput",void 0),(0,ze._)([(0,Pa.W)()],GM.prototype,"spherical",void 0),(0,ze._)([(0,Pa.W)()],GM.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,ze._)([(0,Pa.W)()],GM.prototype,"receiveShadows",void 0),(0,ze._)([(0,Pa.W)()],GM.prototype,"hasSlicePlane",void 0),(0,ze._)([(0,Pa.W)()],GM.prototype,"backfaceCullingEnabled",void 0),(0,ze._)([(0,Pa.W)()],GM.prototype,"textureFadingEnabled",void 0),(0,ze._)([(0,Pa.W)()],GM.prototype,"renderOccluded",void 0),(0,ze._)([(0,Pa.W)()],GM.prototype,"hasScreenSpaceReflections",void 0),(0,ze._)([(0,Pa.W)()],GM.prototype,"hasCloudsReflections",void 0),(0,ze._)([(0,Pa.W)()],GM.prototype,"invisible",void 0),(0,ze._)([(0,Pa.W)()],GM.prototype,"opaque",void 0),(0,ze._)([(0,Pa.W)()],GM.prototype,"tileBorders",void 0),(0,ze._)([(0,Pa.W)()],GM.prototype,"visualizeNormals",void 0),(0,ze._)([(0,Pa.W)()],GM.prototype,"screenSizePerspective",void 0),(0,ze._)([(0,Pa.W)()],GM.prototype,"receiveAmbientOcclusion",void 0),(0,ze._)([(0,Pa.W)({count:BM.A9.COUNT})],GM.prototype,"pbrMode",void 0),(0,ze._)([(0,Pa.W)({constValue:UM.W.Compressed})],GM.prototype,"normalType",void 0),(0,ze._)([(0,Pa.W)({constValue:VM.q.Compressed})],GM.prototype,"textureCoordinateType",void 0),(0,ze._)([(0,Pa.W)({constValue:!1})],GM.prototype,"highStepCount",void 0),(0,ze._)([(0,Pa.W)({constValue:!1})],GM.prototype,"useCustomDTRExponentForWater",void 0),(0,ze._)([(0,Pa.W)({constValue:!1})],GM.prototype,"useFillLights",void 0),(0,ze._)([(0,Pa.W)({constValue:!0})],GM.prototype,"hasColorTexture",void 0);const ZM=(0,If.vt)();var $M;!function(e){e[e.Opaque=0]="Opaque",e[e.Semitransparent=1]="Semitransparent",e[e.TransparentWithDraped=2]="TransparentWithDraped",e[e.Empty=3]="Empty"}($M||($M={}));let qM=class extends yc.Ot{get _isGlobal(){return this._stage.viewingMode===$s.RT.Global}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(e,t,r,i,n){super({}),this._overlayRenderer=e,this._stage=t,this._allTiles=r,this._ellipsoidRadius=i,this.type=Xv.dz.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new GM,this._passParameters=new aS.T,this._drawParameters=new zM.P,this._renderDataPool=new f_.A(hS),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new Nx.C2,this._transparencyState=$M.Opaque,this._castShadows=!1,this._inViewshed=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=px.m$.Occlude,this.produces=new Map([[_c.N.OPAQUE_TERRAIN,()=>this._produces()],[_c.N.TRANSPARENT_TERRAIN,()=>this._produces()],[_c.N.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileTextureCache=new Ww.I(((e,t)=>n.newCache(e,t)),"TileTexture"),this.tileGeometryCache=new RT(n)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles((0,gt.wB)((()=>this._overlayRenderer.rendersOccludedDraped),(e=>{this.renderOccludedFlags=e?ux.O8:px.m$.Occlude,this.setNeedsRender()}),gt.OH))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?yc.B7:yc.qo}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}updateHeading(e){this._tileRenderer?.updateHeading(e)}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===$M.TransparentWithDraped||e===$M.Empty,this._techniqueConfiguration.opaque=e===$M.Opaque,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return Jd.fo}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,null!=this._tileRenderer&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e,this._getLocalOriginOfTile(e)))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,jx.TEXTURE_FADING)}updateTileTexture(e,t){null!=this._tileRenderer&&(this._tileRenderer.updateTileTexture(e,t===jx.TEXTURE_FADING?cx.ZY.FADING:cx.ZY.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){for(const r of e.layerInfo[wb.ELEVATION])r.pendingUpdates&=~jx.GEOMETRY;e.resetPendingUpdate(jx.GEOMETRY);const t=e.renderData.updateGeometryState();return t&&this.setDirty(),t}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this._renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const t=Math.max(0,7*Math.floor((e.level-3)/7));if(this._isGlobal&&0===t)return nn.uY;for(;e.parent&&e.level>t;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hx.C7.UPDATE;this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hx.C7.UPDATE;this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hx.C7.UPDATE;this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new gM(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=(0,Da.T)(this._rctx)}uninitializeRenderContext(){this._emptyTex=(0,Je.WD)(this._emptyTex),this._tileRenderer=(0,Je.WD)(this._tileRenderer)}intersect(e,t,r,i){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==$M.Opaque)return;const n=WM,s=YM;(0,da.f)(n,i,r),(0,da.s)(s,1/n[0],1/n[1],1/n[2]);const o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===Xv.oH.MIN,u=!!e.results.ground.target,h=(0,Jd.dd)(e.verticalOffset),d=e.tolerance;let p,f=c&&null!=o.dist?o.dist:1/0;const m=e.options,g=m.normalRequired||!m.backfacesTerrain,y=new uT.JG(!1,g),_=u=>{const _=u.renderData;if(!_?.vao)return;const v=_.geometry;(0,If.hZ)(ZM,v.boundingBox);const b=_.localOrigin;null!=h&&(h.localOrigin=b,h.applyToAabb(ZM));const w=ZM;if(XM[0]=r[0]-b[0],XM[1]=r[1]-b[1],XM[2]=r[2]-b[2],!(0,uT.d2)(w,XM,s,d,f))return;const x=(e,t,r)=>{e.set(this.type,u,t,r,qa.zK),f=c&&null!=o.dist?o.dist:1/0},S=(s,c,u)=>{if((!g||null!=u)&&s>=0&&(m.backfacesTerrain||(0,da.m)(u,n)<0)&&(m.invisibleTerrain||!m.selectionMode||null==t||t(r,i,s))){if((null==l.dist||s<l.dist)&&x(l,s,u),m.isFiltered)return;m.store===Xv.oH.ALL&&(null==p?(p=(0,Id.G7)(e.ray),x(p,s,u),e.results.all.push(p)):s<p.dist&&x(p,s,u)),(null==o.dist||s<o.dist)&&x(o,s,u),m.store!==Xv.oH.MIN&&(null==a.dist||s>a.dist)&&x(a,s,u)}},T=JM;(0,da.f)(T,i,b);const{indices:M,indexCount:A}=v,C=v.vertexAttributes,E=C.getField(El.r.POSITION,AT.xs),R=new kM.K(E.typedBuffer,3,C.stride/4),P=A/3;if(!h&&P>200){const e=u.renderData;null==e.intersectionData&&(e.intersectionData=new RM(M,0,P,R)),e.intersectionData.intersectRay(XM,T,y,S)}else(0,uT.Z$)(XM,T,0,P,M,R,h,y,S)},v=this._rootTiles;null!=v&&(()=>{const t=this._tileIterator;t.reset(v);const i=e.options.invisibleTerrain;for(let e=t.next();e;e=t.next())!(e.visible||i&&e.intersectsClippingArea)||null==h&&!e.intersectsRay(r,n,d,f)||u&&this._useStencilForTile(e)?t.skipSubtree():_(e)})()}processScaleRangeQueries(e,t){if(!t.done)for(this._updatePatchGroups();e.updating&&!t.done;){e.prepare();for(const t of this._visiblePatchesByOrigin.values())for(const r of t)null!=r.renderData?.textureReference&&e.queriesForTile(r);e.process(),t.madeProgress()}}prepareTechnique(e){const t=(0,it.A)("enable-feature:terrain-shadows")&&e.bindParameters.shadowMap.enabled;t!==this._castShadows&&(this._castShadows=t,this._patchesByOriginDirty=!0);const r=e.bindParameters.viewshedEnabled;if(this._inViewshed!==r&&(this._inViewshed=r,this._patchesByOriginDirty=!0),e.bindParameters.slot===_c.N.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&ux.O8))return null}else{const t=this.transparency===$M.Opaque?_c.N.OPAQUE_TERRAIN:_c.N.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}if(this.transparency===$M.Empty)return null;switch(e.output){case oS.V.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=null!=e.bindParameters.ssr.lastFrameColor,this._techniqueConfiguration.hasCloudsReflections=null!=e.bindParameters.cloudsFade.data,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=null!=e.bindParameters.ssao,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(oS.V.Color,e.bindParameters.slot===_c.N.OCCLUDED_TERRAIN);case oS.V.Shadow:case oS.V.ShadowExcludeHighlight:return this._castShadows?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(oS.V.Shadow,!1)):null;case oS.V.ViewshedShadow:return this._inViewshed?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(oS.V.ViewshedShadow,!1)):null;case oS.V.Depth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(oS.V.Depth,!1);case oS.V.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(oS.V.Normal,!1);case oS.V.ObjectAndLayerIdColor:return this._updateTechnique(oS.V.ObjectAndLayerIdColor,!1);case oS.V.Highlight:return this._overlayRenderer.hasHighlights?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(oS.V.Highlight,!1)):null}return null}renderNode(e,t){switch(this._updatePatchGroups(),t.useStencil=!1,e.output){case oS.V.Color:{const r=e.bindParameters.slot===_c.N.OCCLUDED_TERRAIN?CT.A.Occluded:CT.A.Color;this._renderMaterialPass(e,t,r);break}case oS.V.Depth:case oS.V.Normal:this._renderAuxiliaryPass(e,t,CT.A.Color,this._visiblePatchesByOrigin);break;case oS.V.Highlight:this._renderAuxiliaryPass(e,t,CT.A.Highlight,this._visiblePatchesByOrigin);break;case oS.V.Shadow:case oS.V.ShadowExcludeHighlight:case oS.V.ViewshedShadow:this._renderAuxiliaryPass(e,t,null,this._allPatchesByOrigin);break;case oS.V.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,t,CT.A.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(null==this._tileRenderer)return;const t=this._tileRenderer;let r;if(null!=e){const t=Be.A.toUnitRGBA(e);r=(0,nn.fA)(t[0]||0,t[1]||0,t[2]||0)}t.setBackground(r),this._allTiles.forAll((e=>t.updateTileTexture(e,cx.ZY.FADING))),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?FM.k.GridComposite:null!=t.backgroundColor?FM.k.ColorComposite:FM.k.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==pT.X.NONE){const e=Array.from(this._visiblePatchesByOrigin.values()),t=this._stencilEnabledLayerExtents;for(const r of e)(0,Nx.Ey)(this.renderOrder,r,t);e.sort(((e,t)=>(0,Nx.Ri)(e[0],t[0],this.renderOrder))),this._visiblePatchesByOrigin=new Map(e.map((e=>[e[0].renderData.localOrigin,e]))),this._patchSortingDirty=!1}}_rebuildPatchGroups(){const e=this._rootTiles;if(null!=e){e[0]?.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const t of e)this._rebuildPatchGroupsForRootTile(t)}}_rebuildPatchGroupsForRootTile(e){const t=this._tileIterator;for(t.resetOne(e);!t.done;){const e=t.next(),r=e.renderData;if(!r){this._numTilesCulled++;continue}const i=r.localOrigin;if(this._castShadows||this._inViewshed){let t=this._allPatchesByOrigin.get(i);t||(t=[],this._allPatchesByOrigin.set(i,t)),t.push(e)}if(!e.visible){this._numTilesCulled++,t.skipSubtree();continue}let n=this._visiblePatchesByOrigin.get(i);n||(n=[],this._visiblePatchesByOrigin.set(i,n)),n.push(e),t.skipSubtree()}}_useStencilForTile(e){for(const t of this._stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderAuxiliaryPass(e,t,r,i){const n=e.rctx;this._passParameters.overlayContent=r,n.bindTechnique(t,e.bindParameters,this._passParameters);const s=this._stencilEnabledLayerExtents.length>0;i.forEach((i=>{this._drawParameters.origin=i[0].renderData.localOrigin,t.program.bindDraw(this._drawParameters,e.bindParameters,this._passParameters);for(let n=0;n<i.length;n++)this._renderPatch(e,t,i[n],Aa.WR.TRIANGLES,s,r)})),e.rctx.bindVAO(null)}_renderMaterialPass(e,t,r){const{rctx:i}=e;this._passParameters.overlayContent=r,i.bindTechnique(t,e.bindParameters,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const n=e.bindParameters.camera,s=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const e=(0,zy.mt)(this._stage.viewingMode,this._ellipsoidRadius),t=this.pointsOfInterest.centerOnSurfaceFrequent.distance;e.update({distance:t,fovY:n.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=r===CT.A.Occluded;a&&(s.bindTexture("tex",this._emptyTex),s.setUniform3fv("textureOpacities",nn.uY),s.setUniform4fv("texOffsetAndScale",ya.uY));const l=null!=this._tileRenderer?.backgroundColor?this._tileRenderer.backgroundColor:nn.uY;this._techniqueConfiguration.tileBlendInput===FM.k.ColorComposite&&s.setUniform3fv("backgroundColor",l);const c=this.wireframe?Aa.WR.LINES:Aa.WR.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&s.bindTexture("texNext",this._emptyTex);const u=this._visiblePatchesByOrigin;for(const h of u.values()){const i=h[0].renderData.localOrigin;t.program.bindDraw(new zM.P(i),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const n of h){const i=n.renderData,l=i.textureReference;if(null!=l){if(!a){s.setUniform4fv("texOffsetAndScale",l.offsetAndScale),s.bindTexture("tex",l.texture.texture);const e=i.textureFadeFactor,t=e<1?i.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&null!=t&&e<1?(s.setUniform1f("fadeFactor",e),s.setUniform4fv("nextTexOffsetAndScale",t.offsetAndScale),s.setUniform3fv("nextTexOpacities",t.opacities),s.bindTexture("texNext",t.texture.texture)):s.setUniform1f("fadeFactor",1),i.textureIsFading&&this.setNeedsRender(),s.setUniform3fv("textureOpacities",l.opacities)}this._renderPatch(e,t,n,c,o,r),n.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,t,r,i,n,s){const o=r.renderData,a=o.vao,l=a?.indexBuffer;if(!a||null==l)return void(nx.L8&&console.error("Rendered tile with no indices: ",r.lij," : ",o));const c=t.program;null==s||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(c,o.overlay),n&&(t.useStencil=this._useStencilForTile(r),e.rctx.setPipelineState(t.getPipeline()));const u=o.geometry.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(i,u,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=t,this._shaderTechnique=this._techniques.releaseAndAcquire(cS,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){}};(0,ze._)([(0,Qe.MZ)({readOnly:!0})],qM.prototype,"_isGlobal",null),(0,ze._)([(0,Qe.MZ)()],qM.prototype,"renderOccludedFlags",void 0),(0,ze._)([(0,Qe.MZ)({value:!1})],qM.prototype,"renderingDisabled",null),(0,ze._)([(0,Qe.MZ)({value:!0})],qM.prototype,"visible",null),(0,ze._)([(0,Qe.MZ)()],qM.prototype,"renderPatchBorders",null),(0,ze._)([(0,Qe.MZ)()],qM.prototype,"visualizeNormals",null),(0,ze._)([(0,Qe.MZ)()],qM.prototype,"cullBackFaces",null),(0,ze._)([(0,Qe.MZ)({value:pT.X.FRONT_TO_BACK})],qM.prototype,"renderOrder",null),(0,ze._)([(0,Qe.MZ)()],qM.prototype,"wireframe",null),qM=(0,ze._)([(0,tt.$)("esri.views.3d.terrain.TerrainRenderer")],qM);const WM=(0,nn.vt)(),YM=(0,nn.vt)(),XM=(0,nn.vt)(),JM=(0,nn.vt)();class KM{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}var QM=r(12006),eA=r(66908);let tA=class extends ht.A{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",(()=>this._update())),(0,gt.wB)((()=>this.extentHelper.layerViewsExtent),(()=>this._setAdHocTilingScheme()))]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some((t=>!(!(0,vt.qK)(t)||t.isRejected())&&!(t.isFulfilled()&&!function(e,t,r){return null!=(0,nx.Uo)(e,t,r)}(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!("vector-tile"===t?.type||(0,nx.Ci)(t))))),e)if(e.isResolved()){const t=(0,nx.Uo)(e,this.viewSpatialReference,this.viewingMode);if(null!=t){const e=new eA.n(t.tileInfo);this._lockTilingScheme(e)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch((()=>{})).then((()=>{t!==this._waitTask||this.destroyed||this._update()}));this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===$s.RT.Global){const t=e.levels.length-1,r=e.spatialReference;r.isWebMercator?e=eA.n.makeWebMercatorAuxiliarySphere(t):(0,QM.s)(r)&&(e=eA.n.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles((0,gt.wB)((()=>this.extentHelper.tiledLayersExtent),(()=>this._updateTiledLayerExtent())))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===$s.RT.Global){const e=this.extentHelper.viewSpatialReference;e.isWebMercator?this.tilingScheme=eA.n.WebMercatorAuxiliarySphere:(0,QM.C)(e)&&(this.tilingScheme=eA.n.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;null==e||(0,un.aI)(e,this.extent)||(this.tilingScheme=eA.n.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){}};(0,ze._)([(0,Qe.MZ)()],tA.prototype,"tilingScheme",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],tA.prototype,"extent",void 0),(0,ze._)([(0,Qe.MZ)({value:!1})],tA.prototype,"tilingSchemeLocked",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],tA.prototype,"viewSpatialReference",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],tA.prototype,"layers",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],tA.prototype,"extentHelper",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],tA.prototype,"viewingMode",void 0),tA=(0,ze._)([(0,tt.$)("esri.views.3d.terrain.TilingSchemeLogic")],tA);class rA{constructor(){this.offset=(0,va.vt)(),this.scale=0,this.tile=null}init(e,t,r,i){this.tile=e,this.offset[0]=t,this.offset[1]=r,this.scale=i}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}var iA;let nA=iA=class extends(pt.A.EventedMixin(ht.A)){constructor(e){super(e),this._scaleRangeQueries=new mT,this._iteratorPool=new f_.A(Nx.C2,(e=>e.remove=()=>this._iteratorPool.release(e))),this._postorderIterator=new Nx.V$,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new KM,this._viewChanged=!1,this.heading=0,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=(0,nn.vt)(),this._eyePosSurfaceSR=(0,nn.vt)(),this._splitLimits=new MT,this._frustum=(0,Lf.vt)(),this._viewProjectionMatrix=(0,qa.vt)(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new bn.U,this._frameTask=ll.nu,this._allTiles=new Ty.A,this._upsampleInfoPool=new f_.A(rA),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=(0,un.vt)(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Bt.A.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new Qw(1/0,-1/0),this.rootTileElevationBounds=new Qw(1/0,-1/0),this._sebProjectorMap=new Map,this._sebProjectorCache=(0,y_.Ur)(),this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new _x({...e,surface:this}),this._isGlobal=!e.view?.state?.isLocal,this._isGeographic=this._spatialReference?.isGeographic??!1,this._tileConstructor=this._isGlobal?yT:hT}initialize(){const e=this.view,t=e.resourceController,i=t.memoryController;this._tileCache=new Ww.I(((e,t)=>i.newCache(e,t)),"terrain-tile"),this._upsampleMapCache=i.newCache("terrain-upsample",(e=>e.unloadMapData())),this._elevationQueryCache=new Yw(i.newCache("elevation-query"));const n=this.overlayManager;this._renderer=new qM(n.renderer,e._stage,this._allTiles,(0,pa.tO)(e.spatialReference).radius,i),this.addHandles([(0,gt.wB)((()=>n.renderer.isEmpty),(()=>this._evaluateTransparency())),(0,gt.wB)((()=>this.renderer.visible),(e=>this.suspended=!e)),(0,gt.wB)((()=>this.heading),(e=>{this._renderer.updateHeading(e),this._updateTileTextures(cx.ZY.FADING)})),(0,gt.wB)((()=>({heading:e.camera?.heading,state:e.state?.mode})),(e=>{let{heading:t,state:r}=e;if(null==t)return;if(this.isGlobal&&this.isGeographic||this.isWebMercatorOnPlateCarree)return void(this.heading=90*Math.round(t/90)%360);const i=Math.round(t)%360,n=Math.abs(i-this.heading);(r===fm.M.IDLE||Math.min(n,360-n)>=30)&&(this.heading=i)}))],"overlayManager"),this.addHandles([(0,gt.wB)((()=>this.baseOpacity),(()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?cx.ZY.UNFADED:cx.ZY.IMMEDIATE)}),gt.pc),(0,gt.wB)((()=>this.hasCompositeBlendMode),(()=>this._updateTileTextures(this._evaluateTransparency()?cx.ZY.UNFADED:cx.ZY.IMMEDIATE)),gt.pc),(0,gt.wB)((()=>this.backgroundColor),((e,t)=>{e?.equals(t)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(e))}),gt.OH),(0,gt.wB)((()=>this.snapLevel),(()=>this._viewChanged=!0),gt.OH),(0,gt.wB)((()=>this.view.pointsOfInterest),(e=>{this._renderer.pointsOfInterest=e,this._watchUpdatingTracking.removeAll(),e&&this._watchUpdatingTracking.add((()=>e.focus.renderLocation),(()=>this._allTilesSorted=!1))})),(0,gt.wB)((()=>My.b.TERRAIN_TILE_TREE_SHOW_TILES),(t=>{t&&!this._treeDebugger?r.e(2777).then(r.bind(r,12777)).then((t=>{let{TerrainTileTree3DDebugger:r}=t;!this._treeDebugger&&My.b.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new r({view:e}))})):t||(this._treeDebugger=(0,Je.pR)(this._treeDebugger))}),gt.Vh)]);const{spatialReference:s}=e;this._extentHelper=function(e,t){return e===$s.RT.Global?new ox(t):new ax(t)}(this.viewingMode,{layers:e.map.allLayers,layerViews:e.allLayerViews,viewSpatialReference:s});const o=new dt.A({getCollections:()=>e.defaultsFromMap?.mapCollections?.map((e=>{let{layers:t}=e;return t})),getChildrenFunction:e=>e&&"layers"in e?e.layers:null}),a=new tA({layers:o,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:s});this._set("tilingSchemeLogic",a),this._updateTilingScheme(),this._elevationDataRequester=t.createStreamDataRequester(kb.sK.ELEVATION),this._mapDataRequester=t.createStreamDataRequester(kb.sK.BASEMAP);const l=t.scheduler;this._frameTask=l.registerTask(ll.W6.TERRAIN_SURFACE,this),this.addHandles([(0,gt.wB)((()=>this._extentHelper.stencilEnabledExtents),(e=>this._renderer.setStencilEnabledLayerExtents(e)),gt.Vh),(0,gt.wB)((()=>this.tilingSchemeLogic.tilingScheme),(()=>this._updateTilingScheme()),gt.OH),(0,gt.wB)((()=>this.extent),(()=>this._updateRootTiles()),gt.Vh),e.on("resize",(()=>this._viewChangeUpdate())),(0,gt.wB)((()=>{const t=e.state;return[this._lodBias,this.lodSnapping,e.quality,t.camera,t.contentCamera,t.fixedContentCamera]}),(()=>this._viewChangeUpdate()),gt.pc),(0,gt.wB)((()=>e.qualitySettings?.fadeDuration),(e=>this._renderer.textureFadingEnabled=e>0),gt.Vh),(0,gt.wB)((()=>e.qualitySettings?.physicallyBasedRenderingEnabled),(e=>this._renderer.pbrMode=e?BM.A9.Simplified:BM.A9.Disabled),gt.Vh),(0,gt.wB)((()=>e.qualitySettings?.tiledSurface.elevationLevelDelta),(()=>this._updateAllTileGeometries())),(0,gt.wB)((()=>this._userClippingExtent),(()=>this._updateClippingExtent()),gt.OH)]),this.addHandles(e.allLayerViews.on("after-changes",(()=>this._layerViewsDirty=!0))),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._removeAllTiles(),this._set("tilingSchemeLogic",(0,Je.pR)(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach(((e,t)=>this._unregisterTiledLayerView(t))),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",(0,Je.pR)(this.overlayManager)),this._tileCache=(0,Je.pR)(this._tileCache),Hx.prune(),this._treeDebugger=(0,Je.pR)(this._treeDebugger),this._renderer=(0,Je.pR)(this._renderer),this._iteratorPool=(0,Je.pR)(this._iteratorPool),this._upsampleMapCache=(0,Je.pR)(this._upsampleMapCache),this._elevationQueryCache=(0,Je.pR)(this._elevationQueryCache),this._set("view",null),this._extentHelper=(0,Je.pR)(this._extentHelper),this._upsampleInfoPool=(0,Je.pR)(this._upsampleInfoPool),(0,Xw.D)(),Bx.size>0&&(console.log(`${Bx.size} live TilePerLayerInfo allocations:`),Bx.forEach((e=>console.log(e,"\n"))))}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===cx.iw.ON){const e=this.view,t=this.tilingScheme,r=e.terrainScale;if(t&&r){const i=t.levelAtScale(r)+e.qualitySettings.tiledSurface.lodBias,n=t.getMaxLod();return Math.min(i,n||1/0)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?cx.iw.ON:cx.iw.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(null==t||null==e)return null;const r=(0,un.vt)(),i=(0,zv.k)(t,r,e)?r:null,n=this._get("extent");return(0,un.aI)(i,n)?n:i}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=(0,un.E$)(this.groundExtent,this._userClippingExtent,(0,un.vt)()),t=this._get("extent");return(0,un.aI)(e,t)?t:e}get groundExtent(){return null!=this._tilingSchemeExtent?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return null!=this._rootTiles}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===$M.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(e,t,r,i){this._renderer.intersect(e,t,r,i)}getElevationLevelDelta(e){return e<4?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}getElevation(e,t,r,i){const n=this._rootTiles;if(!n?.length)return null;if(0===n[0].layerInfo[wb.ELEVATION].length)return null;let s=this._elevationProjectorCache.get(i);if(void 0===s&&(s=(0,y_.jd)(i,this._spatialReference)??null,this._elevationProjectorCache.set(i,s)),null==s)return Xe.A.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const o=(0,da.s)(oA,e,t,r);return s(o,0,o,0),hA(n,o[0],o[1])}getElevations(e,t,r){const i=this._rootTiles,n=i?i[0].layerInfo[wb.ELEVATION].length:0;if(i?.length&&0!==n)for(let s=0;s<t;++s){const t=3*s;r(s,hA(i,e[t],e[t+1]))}else for(let s=0;s<t;++s)r(s,null)}getScale(e){if(!this.tilingScheme)return null;if(!(0,cn.g)(e,oA,this.spatialReference))return Xe.A.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this._rootTiles;if(null!=t)for(const r of t)if(r?.containsPoint(oA)){let e=r;for(;e.children[0]&&!e.rendered;){const t=e.children[0].extent;let r=0;oA[0]>t[2]&&(r+=1),oA[1]<t[1]&&(r+=2),e=e.children[r]}return this._getLodBiasCorrectedScale(e.level)}return 1/0}_ensureSEBProject(e){const t=this._sebProjectorMap.get(e);if(t)return t;const r=(0,y_.jd)(e,this._tilingSchemeSpatialReference,this._sebProjectorCache)??null;return this._sebProjectorMap.set(e,r),r}getSphereElevationBounds(e,t){const r=this._ensureSEBProject(t);if(null==r)return Xe.A.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;(0,Su.a)(e,aA);const i=(0,Su.g)(aA);r(i,0,i,0);const n=new ub.H,s=this._rootTiles;if(null!=s){const e=[];for(const r of s)e.push(r);let t=0;for(;t<e.length;){const r=e[t];if(++t,!(0,un.m7)(r.extent,aA))continue;const i=r.children;if(null==i[0]||r.rendered)n.expandElevationRangeValues(r.elevationBoundsMin,r.elevationBoundsMax);else for(const t of i)e.push(t)}}return n}getRootElevationBounds(){return new ub.H(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!(0,cn.g)(e,(0,Su.g)(aA),this.spatialReference))return Xe.A.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;aA[3]=t;let r=null;const i=e=>{if(e&&(0,un.m7)(e.extent,aA)){const t=e.children;if(t[0]&&!e.rendered)for(const e of t)i(e);else{const t=this._getLodBiasCorrectedScale(e.level);r=null==r?t:Math.min(r,t)}}},n=this._rootTiles;if(null!=n)for(const s of n)i(s);return r}queryVisibleScaleRange(e,t,r,i){const n=t?this.tilingScheme.levelAtScale(t):0,s=r?this.tilingScheme.levelAtScale(r):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,n+o,s+o,i)}_evaluateTransparency(){const e=this.baseOpacity,t=this.overlayManager.renderer.isEmpty,r=this._renderer.transparency,i=this._allSurfaceLayersTransparent()?t?$M.Empty:$M.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?$M.Opaque:$M.Semitransparent,n=r!==i;return n&&(this._renderer.transparency=i,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency})),n}_updateTilingScheme(){const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;(0,nx.bk)(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();const t=e?.spatialReference??Bt.A.WebMercator;this._spatialReference=t,this._isWebMercator=!!t?.isWebMercator,this._isWebMercatorOnPlateCarree=this._isWebMercator&&(0,$n.r1)(this.view?.renderSpatialReference),this._isGeographic=t?.isGeographic??!1,this._set("tilingScheme",e),this._tilingSchemeSpatialReference=this.tilingScheme?.spatialReference,this._sebProjectorMap.clear(),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,t,r,i){const n=this._tileCache.pop(iA._tileMemcacheKey);return n?(n.init(e,t,r,i,this),n):new this._tileConstructor(e,t,r,i,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const r=lA;let i=t.rootTilesInExtent(e,r,5*On.SR);if(null!=this._rootTiles){if(i.length>On.SR)return void Xe.A.getLogger(this).warn(On.hB);const e=this._rootTiles.map((e=>e.lij)),t=(0,Dt.iv)(e,i,Jx);if(this._updatingRootTiles=!0,t.removed.length>0||t.added.length>0){const e=this._rootTiles.filter((e=>!(t.removed.findIndex((t=>Jx(t,e.lij)))>-1)||(this._purgeTile(e),!1)));t.added.forEach((t=>e.push(this._newRootTile(t)))),this._setRootTiles(e)}}else this._updatingRootTiles=!0,i.length>On.SR&&(Xe.A.getLogger(this).warn(On.P2),i=t.rootTilesInExtent(e,r,On.SR)),this._setRootTiles(i.map((e=>this._newRootTile(e))));(0,un.aI)(r,this._rootTilesExtent)||(this._rootTilesExtent=(0,un.vt)(r)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter((e=>e.isLoaded&&e.intersectsClippingArea));e.sort(Nx.lR),e.forEach((e=>this._renderer.updateTileGeometryState(e))),e.forEach((e=>e.renderData.updateNeighborData())),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(0===e.length)return;e.sort(Nx.lR);const t=this.renderer;e.forEach((e=>t.updateGeometryIfNeeded(e))),e.forEach((e=>this._pendingTilesForElevationUpdateEvent.add(e)))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===jx.SPLIT}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(t)&&t.setPendingUpdate(jx.SPLIT),this._loadTile(t),this._markTileToUpdate(t),this._updateRootTileElevationBounds(),t}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),null!=e){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(jx.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(null==e)return;const t=(0,Nx.kh)(e),r=this.visibleElevationBounds;let i=t?r.min:1/0,n=t?r.max:-1/0;const s=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){const e=a.next();e.updateClippingStatus(s)&&e.resetPendingUpdate(jx.GEOMETRY)&&this._updateTileGeometryState(e),e.computeVisibility(),e.updateScreenDepth(o),e.renderData&&(i=Math.min(e.elevationBoundsMin,i),n=Math.max(e.elevationBoundsMax,n))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(i)&&isFinite(n)&&(r.min!==i||r.max!==n)&&(this.visibleElevationBounds=new Qw(i,n))}_updateRootTileElevationBounds(){let e=1/0,t=-1/0;const r=this._rootTiles;null!=r&&r.forEach((r=>{let{elevationBoundsMin:i,elevationBoundsMax:n}=r;e=Math.min(e,i),t=Math.max(t,n)}));const i=this.rootTileElevationBounds;i.min===e&&i.max===t||(this.rootTileElevationBounds=new Qw(e,t))}_updateViewDependentParameters(){const{camera:e,contentCamera:t}=this.view.state,r=Math.tan(.5*t.fovX),i=Math.tan(.5*t.fovY),n=this.tilingScheme.pixelSize,s=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=i,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*s,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*s,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=(0,Lf.C)(this._splitLimits.frustum??(0,Lf.vt)(),t.frustum):this._splitLimits.frustum=null,(0,Lf.C)(this._frustum,e.frustum),(0,$a.lw)(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),(0,da.c)(this._eyePosRenderSR,t.eye),(0,Of.F)(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForUpdate(e){e.forEachLoadedNeighbor((e=>{this._layerViews[wb.MAP].some(nx.G3)&&e.setPendingUpdate(jx.TEXTURE_FADING),this._pendingTilesToUpdate.add(e)}))}_updateTileTexture(e,t){const r=e.resetPendingUpdate(jx.TEXTURE_FADING)?jx.TEXTURE_FADING:!!e.resetPendingUpdate(jx.TEXTURE_NOFADING)&&jx.TEXTURE_NOFADING;r&&(this._renderer.updateTileTexture(e,r),this._usedMemory=null,t.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const e=cA.extent;(0,un.Ie)(e),this._pendingTilesForElevationUpdateEvent.forEach((t=>(0,un.fT)(e,t.extent,e))),this._pendingTilesForElevationUpdateEvent.clear(),cA.spatialReference=this.spatialReference,this.emit("elevation-change",cA),this._shouldEmitChangeEvent=!1}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(e,t),this._updateElevation(e),this._updateTextures(e),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),nx.L8&&this._checkTileInvariant(),!e.hasProgressed)return cl.G}_checkTileInvariant(){const e=new Map;this._allTiles.forAll((t=>e.set(t,new Set))),this._allTiles.forAll((t=>{if((0,nx.bk)(t.rendered===t.isLeaf,` rendered ${t.rendered} != ${t.isLeaf} leaf`),!t.isLeaf){const e=e=>0===e.unmergableChildCount&&0===e.maxLevelDeltaNeighborCount,r=t.children.reduce(((t,r)=>t+(e(r)?0:1)),0);if((0,nx.bk)(t.unmergableChildCount===r,` Tile[${t.lij.toString()}] unmergeable child count mismatch: actual ${t.unmergableChildCount} vs ${r}`),t.hasPendingUpdate(jx.MERGE)){(0,nx.bk)(!t.hasPendingUpdate(jx.SPLIT),"Tile can be both split and merge at the same time");for(const e of t.children)(0,nx.bk)(e.isLeaf||e.hasPendingUpdate(jx.MERGE),"Child of tile to merge must also merge")}}for(let r=0;r<4;++r){if(t.rendered){const e=t.renderData?.geometryState.edgePeerNeighbors[r];if(null!=e){{const i=t.level-e.level<=On.nU;i||(console.log(`tile level delta [${t.lij.toString()}] vs [${e.lij.toString()}] > ${On.nU}  (edge[${r}])`),(0,nx.bk)(i,`tile level delta [${t.level}] vs [${e.level}] > ${On.nU}`))}(0,nx.bk)(t.level-e.level<=On.nU,`Max tile lod delta exceeded: [${t.lij.toString()}] vs [${e.lij.toString()}]`)}}const i=t.level-On.nU,n=e=>e.isLeaf||e.level===t.level,s=t.findNeighborTile(nx.Rz[r],n);if(null!=s){if(t.isLeaf&&t.level>=On.nU){let r=s;for(;t.level-r.level<On.nU;)r=r.parent;if(!Jx([i,t.lij[1]>>On.nU,t.lij[2]>>On.nU],r.lij)){const i=e.get(r);(0,nx.bk)(!i.has(t),"Cannot already have neighbor"),i.add(t)}}(0,nx.bk)(s.rendered||s.level===t.level,"Non-same-level-neighbor of rendered must be rendered"),(0,nx.bk)(t.level-s.level<=On.nU,`Tile level delta [${t.level}] vs [${s.level}] > ${On.nU}`)}}})),this._allTiles.forAll((t=>{const r=t.maxLevelDeltaNeighborCount,i=e.get(t);(0,nx.bk)(r===i.size,`Tile[${t.lij.toString()}] merge-blocker mismatch: actual ${r} vs ${i.size}`)}))}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const t=new dA(this._allTiles.length);t.pushAll(this._rootTiles);const r=this.snapLevel,i=this._splitLimits,n=this._eyePosRenderSR;this._allTiles.forAll((e=>{e.maxLevelDeltaNeighborCount=0,e.unmergableChildCount=0}));const s=this._viewProjectionMatrix;for(;!t.empty;){const e=t.pop(),o=e.parent,a=null!=o&&o.hasPendingUpdate(jx.MERGE),l=a?jx.MERGE:e.shouldSplit(i,n,r),c=l===jx.SPLIT;e.isLeaf?pA(e,c):t.pushAll(e.children),a?(e.resetPendingUpdate(jx.SPLIT),e.isLeaf||e.setPendingUpdate(jx.MERGE),this._updateClippingStatus(e),e.updateVisibility(),e.updateScreenDepth(s)):c?(e.resetPendingUpdate(jx.MERGE),e.isLeaf&&e.setPendingUpdate(jx.SPLIT)):(e.resetPendingUpdate(jx.SPLIT)&&e.updateAgentSuspension(),l===jx.ELEVATION&&e.updateAgents(wb.ELEVATION),e.isLeaf||(e.setPendingUpdate(jx.MERGE),e.resetPendingUpdate(jx.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||((0,Nx.jV)(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){(0,nx.GH)(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForUpdate(e))}_updatePendingTileGeometries(){const e=this._pendingTilesToUpdate,t=Array.from(e.keys()).filter((e=>e.isLoaded&&e.intersectsClippingArea));if(0===t.length)return void e.clear();const r=(r,i)=>{!i?.isLoaded||!i.intersectsClippingArea||i.level<r.level||e.has(i)||(e.add(i),t.push(i),i.renderData.updateNeighborData())};t.sort(Nx.lR);const i=t.length;for(let n=0;n<i;++n){const i=t[n];(0,nx.GH)(i.isLoaded),(0,nx.GH)(i.intersectsClippingArea);const s=i.renderData;s.updateNeighborData();const o=s.dirtyEdgeResolutions,a=s.geometryState,l=e=>{const t=nx.XQ[e];r(i,a.cornerPeerNeighbors[e]?.findCorner((0,nx.jj)(t),(e=>e.isLoaded)))};for(let t=0;t<4;++t)if(o&1<<t){const n=s.geometryState.edgePeerNeighbors[t];n&&n?.level>=i.level&&n.forAllSubtreeOnSide((0,nx.JM)(nx.Rz[t]),(t=>!(!t.isLoaded||!t.intersectsClippingArea)&&((0,nx.GH)(e.has(t)||(0,Nx.lR)(i,t)<0),r(i,t),!0))),l((t+1)%4),l(t)}}e.clear(),this._updateTilesGeometries(t),this._shouldEmitChangeEvent=!0,nx.L8&&nx.aL&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let r=!1;const i=this.view.state.fixedContentCamera;let n=!1;for(;!e.done;){n=!0;let s=!1;const o=!this._allTiles.some((n=>{if(!r&&!i&&!n.visible)return e.done;let o=n;if(n.hasPendingUpdate(jx.MERGE)){if(!t||n.unmergableChildCount>0)return e.done;for(n.resetPendingUpdate(jx.MERGE);null!=o.parent&&0===o.parent.unmergableChildCount&&o.parent.resetPendingUpdate(jx.MERGE);)o=o.parent;this._mergeTile(o),s=!0,e.madeProgress()}else if(n.resetPendingUpdate(jx.SPLIT)){let t=!0;const r=n.level;if(r>=On.nU){const e=e=>e.isLeaf||r-e.level<On.nU;for(let i=0;i<4;++i){const s=n.findNeighborTile(nx.Rz[i],e);null!=s&&r-s.level===On.nU&&(t=!1,nx.L8&&((0,nx.GH)(s.isLeaf),(0,nx.GH)(s.hasPendingUpdate(jx.SPLIT))))}}t?(this._splitTile(n),e.madeProgress(),s=!0):n.setPendingUpdate(jx.SPLIT)}return e.done}));if(s&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!r){r=!0;continue}if(!s)break}else this._allTilesDirty=!0}n?e.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some((t=>(t.resetPendingUpdate(jx.GEOMETRY)&&(this._updateTileGeometryState(t),this._shortBatches&&this._updatePendingTileGeometries(),e.madeProgress()),e.done))),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some((t=>(this._updateTileTexture(t,e),e.done)))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(hx.C7.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*On.CU}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,r=(0,ws.qE)(e-this._lodBias,0,t.length-1),i=r-Math.floor(r);return t[Math.floor(r)].scale*(1-i)+t[Math.ceil(r)].scale*i}_removeAllTiles(){null!=this._rootTiles&&(this._rootTiles.forEach((e=>this._purgeTile(e))),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return;const t=e.children.slice();e.unsetChildren();for(let r=0;r<4;++r)this._purgeTile(t[r])}_purgeTile(e){e.isLeaf?mA(e):this._purgeDescendantTiles(e),this._allTiles.removeUnordered(e),this._unloadTile(e),this._tileCache.put(iA._tileMemcacheKey,e)}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){(0,nx.bk)(e.isLeaf,"Tile that is already split should not be split again!"),(0,nx.bk)(e.rendered,"Tile marked to split is not rendered"),mA(e);const t=e.level+1,r=2*e.lij[1],i=2*e.lij[2],n=e.setChildren(this._createTile(t,r,i,e),this._createTile(t,r,i+1,e),this._createTile(t,r+1,i,e),this._createTile(t,r+1,i+1,e));this._allTiles.pushArray(n),e.updateAgentSuspension(),(0,nx.bk)(e.rendered,"parent should be rendered"),this._unloadTile(e),n.forEach((e=>this._loadTile(e))),n.forEach((e=>this._pendingTilesToUpdate.add(e))),this._markAllTileNeighborsForUpdate(e),this._emitTileScaleChange(e,e.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),n.forEach((e=>pA(e,e.hasPendingUpdate(jx.SPLIT)))),++this._performanceInfo.numSplit}_emitTileScaleChange(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.level;uA.spatialReference=this.spatialReference,uA.extent=e.extent,uA.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",uA)}_createTile(e,t,r,i){(0,nx.bk)(!!i,"_createTile sanity check");const n=this._acquireTile(e,t,r,i);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(jx.SPLIT),n}get _shortBatches(){return this.view.state.mode!==fm.M.IDLE}_mergeTile(e){(0,nx.bk)(!e.hasPendingUpdate(jx.SPLIT),"_mergeTile sanity check"),(0,nx.bk)(!e.isLeaf,"Cannot merge a leaf"),e.isLeaf||(this._purgeDescendantTiles(e),(0,nx.bk)(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this._shortBatches&&this._updatePendingTileGeometries(),pA(e,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(e){e.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_handleLayerViewChanges(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ll.Bb;if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const r=new Set;let i=-1;for(let n=this.view.allLayerViews.length-1;n>=0;n--){const e=this.view.allLayerViews.items[n];if(r.add(e.uid),(0,nx.eS)(e)||(0,nx.Gk)(e))if(this._basemapLayerViewHandles.has(e.uid)&&!(0,nx.Gk)(e)){const r=this._layerClassFromLayerView(e),n=this._getLayerIdxByUID(r,e.uid);null!=n&&((n<i||null==i)&&(t=!0),i=n)}else this._registerTiledLayerView(e),e.layer.loaded&&(t=!0)}this._basemapLayerViewHandles.forEach(((e,i)=>{r.has(i)||(this._unregisterTiledLayerView(i),t=!0)})),t&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){let e=0===this.view.map?.ground?.opacity;for(const t of this.view.allLayerViews.items)if((0,nx.LC)(t)&&!(0,vt.rz)(t.layer)&&0!==t.fullOpacity)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if(((0,nx.KE)(e)||(0,nx.Gk)(e))&&(0,PT.aO)(PT.wy[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return(0,nx.oX)(e)?wb.ELEVATION:wb.MAP}_registerTiledLayerView(e){const t=[];if(((0,nx.KE)(e)||(0,nx.Gk)(e))&&t.push((0,gt.wB)((()=>e.layer.blendMode),(()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(cx.ZY.UNFADED)}))),!(0,nx.Gk)(e)){const r=this._layerClassFromLayerView(e);t.push((0,gt.wB)((()=>e.suspended),(()=>this._updateTiledLayers()))),t.push((0,gt.wB)((()=>e.fullOpacity),(()=>this._updateTileTextures(cx.ZY.UNFADED)))),t.push((0,gt.wB)((()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null),(()=>this._restartAllAgents(r)))),t.push(e.on("data-changed",(()=>{const t=this._getLayerIdxByUID(r,e.uid);null!=t&&this._invalidateLayerData(t,r)})))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(const e of t)e.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let r=null;e.forEach((e=>{if(!e.layer||e.suspended||!(0,nx.eS)(e)||!e.fullExtent)return;const i=this._layerClassFromLayerView(e);if(i===wb.MAP){const t=e.displayLevelRange.maxLevel;t!==1/0&&(null===r||t>r)&&(r=t)}t[i].push(e)}));for(const i of Tb){const e=this._layerViews[i],r=t[i];r.reverse();const n=r.length;let s=e.length!==n;const o=new Array(n),a=new Array(e.length);this._layerIndexByUid[i].clear();for(let t=0;t<n;t++){const n=r[t].uid;this._layerIndexByUid[i].set(n,t);const l=e.indexOf(r[t]);o[t]=l,t!==l&&(s=!0),l>-1&&(a[l]=t)}if(s){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;)e.next().modifyLayers(a,o,i);this._layerViews[i]=r,this._restartAllAgents(i),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this._rootTiles);!t.done;){const r=t.next();r.restartAgents(e),e===wb.ELEVATION&&r.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll((t=>{t.updateAgents(wb.MAP),e===cx.ZY.IMMEDIATE?this.renderer.updateTileTexture(t,jx.TEXTURE_NOFADING):t.updateRenderData(wb.MAP,e)})),this._evaluateTransparency()}_invalidateLayerData(e,t){this._allTiles.forAll((r=>r.removeLayerAgent(e,t))),this._allTiles.forAll((r=>r.invalidateLayerData(e,t)))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hx.C7.UPDATE;this.renderer.setNeedsRender(e)}requestUpdate(){1==++this._pendingUpdates&&(this._hasPendingUpdates=!0)}requestTileData(e,t,r,i){const n=this.layerViewByIndex(t,r),s=n.layer;return!s.tilemapCache||(0,nx.G3)(n)?this._requestTileData(e,r,n,i):(++this._asyncWorkItems,s.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...i,timeout:6e3}).then((()=>--this._asyncWorkItems)).catch((t=>{throw--this._asyncWorkItems,(0,Ke.Te)(i),(0,Ke.zf)(t)||this._dataMissing(e,r,n),t})).then((()=>this._frameTask.schedule((()=>this._requestTileData(e,r,n,i)),i.signal))))}_requestTileData(e,t,r,i){const n=t===wb.ELEVATION;return i.requester??=n?this._elevationDataRequester:this._mapDataRequester,n?(0,nx.oX)(r)?this._requestElevationTileData(e,r,i):Promise.reject():(0,nx.LC)(r)?this._requestMapTileData(e,r,i):Promise.reject()}_requestElevationTileData(e,t,r){++this._asyncWorkItems;const i=i=>{!(0,Ke.G4)(r)&&i&&(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,t,i))};return t.fetchTile(e.lij,r).then((e=>this._frameTask.schedule((()=>i(e)))),(r=>{(0,Ke.zf)(r)||(Xe.A.getLogger(this).error(`Tile ${e.lij.toString()} layer ${wb.ELEVATION}/${t.uid} error ${r}`),this._dataMissing(e,wb.ELEVATION,t),this.requestUpdate())})).finally((()=>--this._asyncWorkItems))}_elevationDataArrived(e,t,r){const i=this._layerIndexByUid[wb.ELEVATION].get(t.uid);if(null==i)return void Xe.A.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",wb.ELEVATION,e.lij.toString());const n=new tx(e.lij,e.extent,r);e.dataArrived(i,wb.ELEVATION,n);const s=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(s);!a.done;){const e=a.next();e.findElevationBoundsForLayer(i,o),e.computeElevationBounds()}0===o&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(s)}_requestMapTileData(e,t,r){var i=this;++this._asyncWorkItems;const n=(i,n)=>{(0,nx.n8)(n),(0,Ke.G4)(r)||(console.error(`Tile ${e.lij.toString()} layer ${wb.MAP}/${t.uid} error ${i}`),this._dataMissing(e,wb.MAP,t),this.requestUpdate())},s=e=>t=>n(t,e);return t.fetchTile(e.lij,r).then((i=>this._frameTask.schedule((()=>{this.requestUpdate(),(0,Ke.G4)(r)?(0,nx.n8)(i):this._mapTileDataArrived(e,t,i)}),r.signal,s(i)).catch(s(i))),(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return i._frameTask.schedule((()=>n(e,t)))})).finally((()=>--this._asyncWorkItems))}_mapTileDataArrived(e,t,r){const i=this._getLayerIdxByUID(wb.MAP,t.uid);if(null==i)return(0,nx.n8)(r),void Xe.A.getLogger(this).warn("TerrainSurface: received data from unknown layer");e.dataArrived(i,wb.MAP,r)}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,r){const i=this._getLayerIdxByUID(t,r.uid);null!=i?e.dataMissing(i,t):Xe.A.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll((e=>{e.renderData&&this.overlayManager.setTileParameters(e)})),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll((t=>{t.isLeaf&&e.numLeaves++;const r=t.level;t.renderData&&(e.numLoadedPerLevel[r]=(e.numLoadedPerLevel[r]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[r]=(e.numRenderedPerLevel[r]||0)+1,e.numRendered++))})),e}get usedMemory(){return this.tilingScheme?(null==this._usedMemory&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce(((e,t)=>e+t.usedMemory),0)):null}getUsedMemoryForLayerView(e){let t=0;const r=this._layerClassFromLayerView(e),i=this._getLayerIdxByUID(r,e.uid);return null!=i&&this._allTiles.forAll((e=>t+=e.getUsedMemoryForLayer(r,i))),t}getTile(e){if(null==e||null==this._rootTiles)return null;const t=e.split("/").map((e=>+e));if(0===t[0])return this._rootTiles.find((e=>e.lij[1]===t[1]&&e.lij[2]===t[2]));const r=t[0],i=t[1]>>r,n=t[2]>>r;let s;if(this._rootTiles.some((e=>e.lij[1]===i&&e.lij[2]===n&&(s=e,!0))),s){let e=1<<t[0]-1;for(;s.lij[0]<t[0];){let r=t[1]&e?2:0;if((t[2]&e)>0&&r++,!s.children[r])return null;s=s.children[r],e>>=1}return(0,nx.bk)(s.lij[0]===t[0]&&s.lij[1]===t[1]&&s.lij[2]===t[2],"not the right tile?"),s}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){}checkAllTilesWaterproofness(){if(!nx.aL)return;const e=this._rootTiles;if(null==e)return;const t=e=>e?.renderData?.geometry?.indices?.length>0,r=(e,r)=>{t(e)&&console.error("Tile[",e.lij,"] has geometry although parent[",r.lij,"] has geom")},i=e=>{if(e.intersectsClippingArea)if(e.renderData&&!e.renderData.geometryState&&console.error("Tile[",e.lij,"] has renderData but not geometryState"),e.renderData&&!e.renderData.geometry&&console.error("Tile[",e.lij,"] has renderData but not geometryInfo"),!e.renderData?.geometry||(e.renderData.geometry.indices?.length??0)>0||console.error("Tile[",e.lij,"] has renderData but no indices - geometryInfo: ",e.renderData.geometry),t(e)){e.checkGeometryWaterproofness();for(const t of e.children)r(t,e)}else if(e.isLeaf)console.error("Tile[",e.lij,"] has no geometry and no children, from root to leaf");else for(const t of e.children)i(t)},n=e=>{const t=e.parent?.visible??!0,r=e.visible;e.computeVisibility();const i=e.visible;if(r!==i&&t&&console.error(" Tile[",e.lij,"] has out of date visibility: ",r," instead of ",i),!e.isLeaf)for(const s of e.children)n(s)};for(const s of e)i(s),n(s)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(e){return this._isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this._isGlobal&&0===e[2]}lijEastEnd(e){return 1<<e+(this._isGeographic?1:0)}wrapEastWest(e){const t=this.lijEastEnd(e[0]),r=e[2];if(0<=r&&r<t)return e;if(!this._isGlobal)return null;const i=(r+(r<0?t:0))%t;return[e[0],e[1],i]}enableInternalChecks(e){(0,nx.T7)(e)}enableWaterproofnessChecks(e){(0,nx.Tn)(e)}};nA._tileMemcacheKey="TerrainTileMemcache",(0,ze._)([(0,Qe.MZ)()],nA.prototype,"_renderer",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],nA.prototype,"_scaleRangeQueries",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],nA.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],nA.prototype,"overlayManager",void 0),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"_hasPendingUpdates",void 0),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"_asyncWorkItems",void 0),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"_allTilesDirty",void 0),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"_allTilesSorted",void 0),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"_viewChanged",void 0),(0,ze._)([(0,Qe.MZ)({type:Number})],nA.prototype,"heading",void 0),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"_splitLimits",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"_watchUpdatingTracking",void 0),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"_frameTask",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"snapLevel",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"lodSnapping",null),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"_userClippingExtent",null),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"_rootTilesExtent",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"extent",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"groundExtent",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"_tilingSchemeExtent",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"running",null),(0,ze._)([(0,Qe.MZ)(Kw.S)],nA.prototype,"updatingProgress",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"updatingProgressValue",null),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"_maxNumUpdating",void 0),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"baseOpacity",null),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"hasCompositeBlendMode",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"viewingMode",null),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"maxTextureScale",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"ready",null),(0,ze._)([(0,Qe.MZ)({value:pT.X.FRONT_TO_BACK})],nA.prototype,"renderOrder",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"rootTiles",null),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"_rootTiles",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"spatialReference",null),(0,ze._)([(0,Qe.MZ)({type:Be.A})],nA.prototype,"backgroundColor",null),(0,ze._)([(0,Qe.MZ)({value:!1})],nA.prototype,"slicePlaneEnabled",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"tilingScheme",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"tilingSchemeLocked",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],nA.prototype,"tilingSchemeLogic",void 0),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"wireframe",null),(0,ze._)([(0,Qe.MZ)({value:!1})],nA.prototype,"suspended",null),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"fadeDuration",null),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"visibleElevationBounds",void 0),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"rootTileElevationBounds",void 0),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"_layerViewsDirty",void 0),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"renderPatchBorders",null),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"visualizeNormals",null),(0,ze._)([(0,Qe.MZ)()],nA.prototype,"renderingDisabled",null),nA=iA=(0,ze._)([(0,tt.$)("esri.views.3d.terrain.TerrainSurface")],nA);const sA=nA,oA=(0,nn.vt)(),aA=(0,Su.c)(),lA=(0,un.vt)();new Ty.A;const cA=new Jw.L("ground"),uA={spatialReference:null,extent:null,scale:0};function hA(e,t,r){for(const i of e){if(!i.containsPointXY(t,r))continue;let e=i;for(;e&&!e.renderData;){const i=(t>e.extentMidX?1:0)+(r<e.extentMidY?2:0);e=e.children[i]}return ix(t,r,e?.renderData?.geometryState.samplerData??null)}return null}class dA{constructor(e){this.capacity=e,this._head=0,this._tail=0,this._data=new Array(e)}push(e){const t=this._tail;if(!(t<this.capacity))throw new Error("Queue full");this._data[t]=e,this._tail=t+1}pushAll(e){const t=e.length;if(0===t)return;const r=this._tail;if(!(r+t<=this.capacity))throw new Error("Queue full");for(let i=0;i<t;++i)this._data[r+i]=e[i];this._tail=r+t}pop(){const e=this._head;if(e<this._tail){const t=this._data[e];return this._head=e+1,t}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}}function pA(e,t){!e.isLeaf||e.level<On.nU||yA(e,(e=>{t&&fA(e);const r=gA(e);if(e.maxLevelDeltaNeighborCount++,r){let t=e.parent;for(;t;){const e=gA(t);if(t.unmergableChildCount++,!e)break;t=t.parent}}}))}function fA(e){if(e.hasPendingUpdate(jx.SPLIT))return;let t=e.parent;for(;t?.resetPendingUpdate(jx.MERGE);)t=t.parent;e.resetPendingUpdate(jx.MERGE),e.isLeaf&&e.setPendingUpdate(jx.SPLIT),e.level<On.nU||yA(e,(e=>{fA(e)}))}function mA(e){e.level<On.nU||yA(e,(e=>{if(e.maxLevelDeltaNeighborCount--,0===e.maxLevelDeltaNeighborCount&&0===e.unmergableChildCount){let t=e.parent;for(;t&&(t.unmergableChildCount--,gA(t));)t=t.parent}}))}function gA(e){return 0===e.maxLevelDeltaNeighborCount&&0===e.unmergableChildCount}function yA(e,t){if(e.level<On.nU)return;const r=e.level-On.nU,i=e.lij[1]>>On.nU,n=e.lij[2]>>On.nU,s=e=>e.isLeaf||e.level===r;for(let o=0;o<4;++o){const a=e.findNeighborTile(nx.Rz[o],s);if(!a||a.level!==r)continue;const l=a.lij;l[1]===i&&l[2]===n||t(a)}}var _A=r(63496),vA=r(44513),bA=r(8918),wA=r(87634),xA=r(97583),SA=r(57824);class TA{constructor(e,t,r,i){this.operation=e,this.geometry=t,this.states=r,this.sync=i}}let MA=class extends ht.A{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,t){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach(((r,i)=>{const n=this._ensureGeomRecord(e,i);r.forEach(((e,r)=>{let{geometry:s,operation:o,states:a}=e,l=!1;if(o===SA.q.UPDATE){const e=n.get(r);if(e){if(a&SA.k.TRANSFORMATION){const t=this.model.getObject(i);this.model.updateRenderGeometryTransformation(t,s,e)&&(l=!0)}l||t.updates.push({renderGeometry:e,updateType:a})}else(0,kl.vA)(!1,"ModelDirtySet.commitLayer: invalid update")}if(o===SA.q.REMOVE||l){const e=n.get(r);e?(t.removes.push(e),n.delete(r)):o===SA.q.REMOVE&&(0,kl.vA)(!1,"ModelDirtySet.commitLayer: invalid remove")}if(o===SA.q.ADD||l){const e=this.model.getObject(i);if(null!=e){const i=this.model.getRenderGeometry(e,s);t.adds.push(i),n.set(r,i)}}})),0===n.size&&this._residentGeomRecords.get(e).delete(i)})),0===this._residentGeomRecords.get(e).size&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(e,t){const r=this._dirtyGeomRecords.get(e);r&&r.forEach(((r,i)=>{const n=this._ensureGeomRecord(e,i);r.forEach(((e,r)=>{let{geometry:s,operation:o,states:a,sync:l}=e,c=!1;if(o===SA.q.UPDATE&&l){const e=n.get(r);if(e){if(a&SA.k.TRANSFORMATION){const t=this.model.getObject(i);this.model.updateRenderGeometryTransformation(t,s,e)&&(c=!0)}c||t.updates.push({renderGeometry:e,updateType:a})}else(0,kl.vA)(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}}))}))}getResidentRenderGeometries(e,t){const r=this._residentGeomRecords.get(e);r&&r.forEach((e=>e.forEach((e=>t.push(e)))))}_objectStateChanged(e,t){for(const r of t.geometries)this._updateOrCreateDirtyRecord(t,r,null,SA.q.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(SA.k.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(SA.k.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(SA.k.OCCLUDEE,e)}attributesChanged(e){let{object:t,geometry:r,sync:i}=e;this._updateOrCreateDirtyRecord(t,r,null,SA.q.UPDATE,SA.k.GEOMETRY,i)}layerAdded(e){e.objects.forAll((t=>this._layerObjectAdded(e,t)))}layerRemoved(e){e.objects.forAll((t=>this._layerObjectRemoved(e,t)))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const r=e.id;for(const i of t.geometries)this._geometryAdded(t,i,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const r=e.id;for(const i of t.geometries)this._geometryRemoved(t,i,r)}transformationChanged(e){const t=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(t,r).forEach((r=>{this._updateOrCreateDirtyRecord(e,r.geometry,t,SA.q.UPDATE,SA.k.TRANSFORMATION)}))}shaderTransformationChanged(e){const t=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(t,r).forEach((t=>{t.objectShaderTransformationChanged(e.shaderTransformation)}))}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._updateOrCreateDirtyRecord(e,t,r,SA.q.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._updateOrCreateDirtyRecord(e,t,r,SA.q.REMOVE)}_updateOrCreateDirtyRecord(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:SA.k.NONE,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];r=r??this._getParentLayerId(e);const o=e.id,a=t.id,l=this._ensureDirtyRecord(r,o),c=l.get(a);let u=!1;if(c){const e=c.operation;e===SA.q.REMOVE&&i===SA.q.ADD&&c.states!==SA.k.NONE?c.operation=SA.q.UPDATE:e===SA.q.REMOVE&&i===SA.q.ADD||e===SA.q.ADD&&i===SA.q.REMOVE?(l.delete(a),u=!0):e!==SA.q.UPDATE||i!==SA.q.REMOVE&&i!==SA.q.UPDATE?((0,kl.vA)((e===SA.q.REMOVE||e===SA.q.ADD)&&i===SA.q.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=n):(c.operation=i,c.states|=n),c.sync=c.sync||s}else l.set(a,new TA(i,t,n,s));this.dirty=!u||this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let i=r.get(t);return i||(i=new Map,r.set(t,i)),i}get _hasDirtyGeometryRecords(){for(const e of this._dirtyGeomRecords.values())for(const t of e.values())if(t.size>0)return!0;return!1}_ensureDirtyRecord(e,t){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let i=r.get(t);return i||(i=new Map,r.set(t,i)),i}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:h_.M}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach(((r,i)=>{r.forEach(((r,n)=>{t.length>0&&(t+="\n"),t+=i+"."+n;const s=[];r.forEach((e=>{const t=e.operation;s[t]||(s[t]=[]),s[t].push(e.geometry.id)}));for(let i=0;i<s.length;i++)if(s[i]){t+=" "+e[i-1]+": ";for(let e=0;e<s[i].length;e++)t+=s[i][e]+", "}}))})),t}get test(){}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],MA.prototype,"model",void 0),(0,ze._)([(0,Qe.MZ)()],MA.prototype,"dirty",void 0),MA=(0,ze._)([(0,tt.$)("esri.views.3d.webgl-engine.lib.ModelDirtySet")],MA);const AA=MA;var CA=r(442);let EA=class extends ht.A{constructor(){super(...arguments),this.dirtySet=new AA({model:this}),this._content=new Map,this._originFactory=new xA.g(null)}getObject(e){return this._content.get(e)}add(e){const t=e.id;(0,kl.vA)(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),(0,bA.r)(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),(0,bA.r)(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const t of e)t&&((0,kl.vA)(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)t&&((0,kl.vA)(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id))}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach((r=>{r.type===e&&t(r)}))}getRenderGeometry(e,t){const r=new CA.$(t,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});r.transformation=e.getCombinedStaticTransformation(t,RA);const{localOrigin:i}=t;return r.localOrigin=null!=i?i:this._originFactory.getOrigin((0,Su.g)(r.boundingSphere)),r}updateRenderGeometryTransformation(e,t,r){if(null==e)return!1;r.transformation=e.getCombinedStaticTransformation(t,RA);const i=this._originFactory.getOrigin((0,Su.g)(r.boundingSphere));return r.localOrigin!==i}getStats(){const e={},t=Array.from(this._content.values());for(let r=0;r<wA.X.COUNT;++r)e[r]=t.filter((e=>e.type===r)).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){}};(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],EA.prototype,"dirtySet",void 0),EA=(0,ze._)([(0,tt.$)("esri.views.3d.webgl-engine.parts.Model")],EA);const RA=(0,qa.vt)();var PA=r(78393),OA=r(38496),IA=r(45136),LA=r(64591),NA=r(51990),DA=r(59231);class FA{constructor(e){this._totalCount=e,this._componentCountCache=-1,this._indexRanges=[0,e]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return 0===this._indexRanges.length}isVisible(e){if(e<0||e>=this._totalCount)return!1;if(this.allVisible())return!0;{const t=this._indexRanges;let r=0,i=t.length/2;if(e<t[2*r]||e>t[2*i]+t[2*i+1])return!1;for(;i-r>0;){const n=Math.floor(.5*(r+i)),s=t[2*n];if(e<s){if(i-r==1)return!1;i=n}else{if(e<s+t[2*n+1])return!0;if(i-r==1)return!1;r=n+1}}return!1}}get componentCount(){if(-1===this._componentCountCache){const e=this._indexRanges;let t=0;for(let r=0;r<e.length;r+=2)t+=e[r+1];this._componentCountCache=t}return this._componentCountCache}reset(e){"all"===e||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=function(e){const t=new Array;if(0===e.length)return t;let r=e[0],i=1;for(let n=1;n<e.length;n++){const s=e[n];r+i===s?i+=1:(t.push(r),t.push(i),r=s,i=1)}return t.push(r),t.push(i),t}(e),this._componentCountCache=-1}forEachComponent(e){const t=this._indexRanges;for(let r=0;r<t.length;r+=2){const i=t[r],n=i+t[r+1];for(let t=i;t<n;t++)if(!e(t))return!1}return!0}forEachComponentRange(e){const t=this._indexRanges;for(let r=0;r<t.length;r+=2){const i=t[r];if(!e(i,i+t[r+1]))return!1}return!0}computeOffsetRanges(e){const t=new Array(this._indexRanges.length),r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i],s=n+r[i+1],o=e[n],a=e[s];t[i]=o,t[i+1]=a-o}return t}}class kA{constructor(e,t){this.offsets=t,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const r=this.count;this.visibility=new FA(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let i=0;i<r;i++)this.materialDataIndices[i]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return null==this.cachedGeometryRanges&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return null==this.highlightCounts?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return null==this.highlightCounts?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((null==this.cachedHighlightRanges||null==this.cachedDefaultRanges)&&null!=this.highlightCounts){const{highlightRanges:e,defaultRanges:t}=function(e,t,r){const i=[],n=[];let s=r.length,o=r.length;return t.forEachComponent((t=>(e[t]>0?(s!==t-1&&(i.length&&i.push(r[s+1]-i[i.length-1]),i.push(r[t])),s=t):(o!==t-1&&(n.length&&n.push(r[o+1]-n[n.length-1]),n.push(r[t])),o=t),!0))),i.length&&i.push(r[s+1]-i[i.length-1]),n.length&&n.push(r[o+1]-n[n.length-1]),{highlightRanges:i,defaultRanges:n}}(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=t}}}class zA{constructor(e,t,r,i,n,s){this.transform=e,this.toMapSpace=t,this.obb=r,this.components=i,this.renderable=n,this.intersectionGeometry=s,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=(0,Je.pR)(this.intersectionGeometry),this.renderable=(0,Je.pR)(this.renderable),this.components=(0,Je.pR)(this.components)}}function UA(e,t){return new(function(e){return e<128?Uint8Array:e<32768?Uint16Array:e<1<<31?Uint32Array:Array}(e))(t)}class VA{constructor(e,t){this.elementCount=e,this.model=t,this._elementIndexMap=null,this._bspNodes=[],this._generatedBVH=!1,this.localMode=t.localMode,this.planetCenterZ=t.planetCenterZ,this.geometryMinZ=t.geometryMinZ,this.planetCenter=(0,nn.fA)(0,0,this.planetCenterZ),this.maxBspNodeDepth=t.maxBspNodeDepth??8,this.minElementCountForBVH=t.minElementCountForBVH??15,this.minBspNodeElementCount=t.minBspNodeElementCount??5}get elementIndexMap(){return this._ensureBVH(),this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||0===this._bspNodes.length&&this._generateBsp()}intersectRay(e,t,r){this.elementCount<1||(this._skipBVH?this._intersectRayWithoutBVH(r):this._intersectRayWithBVH(e,t,r))}_intersectRayWithoutBVH(e){this._intersectRange(0,this.elementCount)}_intersectRange(e,t){this.model.intersectRange(e,t)}_intersectRayWithBVH(e,t,r){this._ensureBVH(),r?this._intersectGeometryWithBVHVerticalRay(e):this._intersectGeometryWithBVHGeneralRay(e,t)}_intersectGeometryWithBVHVerticalRay(e){let t=e[0],r=e[1];if(!this.localMode){const{geometryMinZ:i,planetCenterZ:n}=this,s=(i-n)/(e[2]-n);t=e[0]*s,r=e[1]*s}const{_bspNodes:i}=this;let n=0;for(;n>=0;){const e=i[n],{d:s,dim:o,minIndexIndex:a,minMidIndexIndex:l,maxMidIndexIndex:c,maxIndexIndex:u,aabb2D:h}=e;if(t<h[0]||t>h[2]||r<h[1]||r>h[3])break;if(-1===o||-1===e.child0&&-1===e.child1){this._intersectRange(a,u);break}{this._intersectRange(l,c);const i=(0===o?t:r)-s;if(i<0){if(-1===e.child0){this._intersectRange(a,l);break}n=e.child0}else{if(!(i>0))break;if(-1===e.child1){this._intersectRange(c,u);break}n=e.child1}}}}_intersectGeometryWithBVHGeneralRay(e,t){let r=e[0],i=e[1],n=t[0],s=t[1];const{geometryMinZ:o}=this;if(!this.localMode){let a=0,l=1;const c=Math.min(.5*this.planetCenterZ,o),u=e[2],h=t[2];if(u<c&&h<c)return;if(u<c&&(a=(c-u)/(h-u)),h<c&&(l=(c-u)/(h-u)),a>l)return;const d=(1-a)*e[0]+a*t[0],p=(1-a)*e[1]+a*t[1],f=(1-a)*e[2]+a*t[2],m=(1-l)*e[0]+l*t[0],g=(1-l)*e[1]+l*t[1],y=(1-l)*e[2]+l*t[2],{planetCenterZ:_}=this,v=o-_,b=v/(f-_);r=d*b,i=p*b;const w=v/(y-_);n=m*w,s=g*w}const a=n-r,l=s-i,c=this._bspNodes;let u=1;{const{aabb2D:e}=c[0],t=(e,t,r,i)=>{if(Math.abs(t)<1e-5*Math.max(i-r,1))return!1;const n=t>0,s=n?i:r,o=e+u*t;return(n?o<s:o>s)&&(u=Math.max((s-e)/t,u),!0)},n=()=>t(r,a,e[0],e[2]),s=()=>t(i,l,e[1],e[3]);Math.abs(a)>=Math.abs(l)?n()||s():s()||n()}const h=[0,0,u];let d=0;for(;d<h.length;){const e=h[d];let t=h[d+1],n=h[d+2];if(d+=3,t>n)continue;const s=c[e],{minIndexIndex:o,maxIndexIndex:p}=s,{child0:f,child1:m,minMidIndexIndex:g,maxMidIndexIndex:y,aabb2D:_,d:v,dim:b}=s;{const e=r+t*a,i=r+n*a,s=Math.min(e,i),o=Math.max(e,i),l=_[0],c=_[2];if(o<l||c<s)continue;if(s<l){const e=(l-r)/a;a>0?t=Math.max(t,e):n=Math.min(n,e)}if(c<o){const e=(c-r)/a;a>0?n=Math.min(n,e):t=Math.max(t,e)}}{const e=i+t*l,r=i+n*l,s=Math.min(e,r),o=Math.max(e,r),a=_[1],c=_[3];if(o<a||c<s)continue;if(s<a){const e=(a-i)/l;l>0?t=Math.max(t,e):n=Math.min(n,e)}if(c<o){const e=(c-i)/l;l>0?n=Math.min(n,e):t=Math.max(t,e)}}if(-1===f&&-1===m)this._intersectRange(o,p);else{const e=0===b?r:i,s=0===b?a:l,c=e+t*s,d=e+n*s,_=Math.min(c,d),w=Math.max(c,d),x=(0,ws.qE)((v-e)/s,0,u);o<g&&_<=v&&(-1!==f?(h.push(f),h.push(s>=0?t:Math.max(t,x)),h.push(s>=0?Math.min(n,x):n)):this._intersectRange(o,g)),this._intersectRange(g,y),y<p&&v<=w&&(-1!==m?(h.push(m),h.push(s>=0?Math.max(t,x):t),h.push(s>=0?n:Math.min(n,x))):this._intersectRange(y,p))}}}_generateBsp(){const{elementCount:e}=this;if(e<1)return;const t=UA(e,e);this._elementIndexMap=t;for(let d=0;d<e;++d)t[d]=d;const r=this.model.getAabbs2D();let i=0;const n=this._bspNodes;n.length=0;const{localMode:s}=this;let o=!1;if(!s){const{planetCenterZ:e,geometryMinZ:t}=this;o=e>=0||t<.5*e}const a=[],l=(e,t,r,i,n)=>{a.push(e),a.push(t),a.push(r),a.push(i<0?-1:(n?0:1)+2*i)},{maxBspNodeDepth:c,minBspNodeElementCount:u}=this,h=(e,i,a,h,d)=>{const p=n.length;if(p>0&&(o||a>=c||i-e<u))return;const f=[0,0,0,0];!function(e,t,r,i,n){let s=1/0,o=1/0,a=-1/0,l=-1/0;for(let c=t;c<r;++c){const e=4*i[c];s=Math.min(s,n[e+0]),o=Math.min(o,n[e+1]),a=Math.max(a,n[e+2]),l=Math.max(l,n[e+3])}e[0]=s,e[1]=o,e[2]=a,e[3]=l}(f,e,i,t,r);const{d:m,dim:g}=s?function(e){const t=e[0],r=e[1],i=e[2],n=e[3];let s,o;return i-t>=n-r?(o=.5*(t+i),s=0):(o=.5*(r+n),s=1),{d:o,dim:s}}(f):function(e){const t=e[0],r=e[1],i=e[2],n=e[3];let s,o;return i-t>=n-r?(s=0,o=.5*(t+i)):(s=1,o=.5*(r+n)),{dim:s,d:o}}(f),{rangeMidStart:y,rangeMidEnd:_}=function(e,t,r,i,n,s){let o=e;{let e=t;for(;o<e;){const t=n[o];BA(t,r,i,s)<0?++o:(--e,n[o]=n[e],n[e]=t)}}const a=o;let l=o,c=t;for(;l<c;){const e=n[c-1];BA(e,r,i,s)>0?--c:(n[c-1]=n[l],n[l]=e,++l)}return{rangeMidStart:a,rangeMidEnd:c}}(e,i,g,m,t,r),v=a===c-1,b=!v&&y>=e+u,w=!v&&i>=_+u;if(b||w||0===p){const t=new jA(e,y,_,i,g,m,f);if(b&&l(e,y,a+1,p,!0),w&&l(_,i,a+1,p,!1),n.push(t),-1!==h){const e=n[h];d?e.child0=p:e.child1=p}}};for(l(0,e,0,-1,!1);i<a.length;){const e=a[i],t=a[i+1],r=a[i+2],n=a[i+3];i+=4;const s=n>>1;h(e,t,r,s,n-(s<<1)==0)}this._generatedBVH=!0}}function BA(e,t,r,i){const n=4*e,s=i[n+0+t];return i[n+2+t]<r?-1:s>r?1:0}class jA{constructor(e,t,r,i,n,s,o){this.minIndexIndex=e,this.minMidIndexIndex=t,this.maxMidIndexIndex=r,this.maxIndexIndex=i,this.dim=n,this.d=s,this.aabb2D=o,this.child0=-1,this.child1=-1}}class HA{constructor(e,t,r,i,n,s,o,a,l){this.componentIndex=e,this.vertexData=t,this.vertexStride=r,this.indexData=i,this.startTriangleNumber=n,this.endTriangleNumber=s,this.geometryMinZ=o,this.planetCenterZ=a,this.localMode=l,this.maxBspNodeDepth=8,this.minElementCountForBVH=20,this.minBspNodeElementCount=10,this.rayDirection=(0,nn.vt)(),this.ray0=(0,nn.vt)(),this.isVerticalRay=!1,this._triangleHitCallback=ZA,this.totalElevationOffset=0,this.normalRequired=!1,this._bvh=new VA(s-n,this)}getAabbs2D(){return this.localMode?function(e,t,r,i,n){const s=t-e,o=new Float64Array(4*s);for(let a=0;a<s;++a){const t=3*(a+e),s=n*r[t+0],l=i[s+0],c=i[s+1],u=n*r[t+1],h=i[u+0],d=i[u+1],p=n*r[t+2],f=i[p+0],m=i[p+1],g=4*a;o[g+0]=Math.min(l,h,f),o[g+1]=Math.min(c,d,m),o[g+2]=Math.max(l,h,f),o[g+3]=Math.max(c,d,m)}return o}(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):function(e,t,r,i,n,s,o){const a=s-o,l=t-e,c=new Float64Array(4*l);for(let u=0;u<l;++u){const t=3*(u+e),s=n*r[t+0],l=i[s+0],h=i[s+1],d=a/(i[s+2]-o),p=l*d,f=h*d,m=n*r[t+1],g=i[m+0],y=i[m+1],_=a/(i[m+2]-o),v=g*_,b=y*_,w=n*r[t+2],x=i[w+0],S=i[w+1],T=a/(i[w+2]-o),M=x*T,A=S*T,C=4*u;c[C+0]=Math.min(p,v,M),c[C+1]=Math.min(f,b,A),c[C+2]=Math.max(p,v,M),c[C+3]=Math.max(f,b,A)}return c}(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(e,t,r,i,n,s){(0,da.c)(this.ray0,e),(0,da.z)(this.rayDirection,t,e),this.isVerticalRay=r,this.totalElevationOffset=i,this.normalRequired=s,this._triangleHitCallback=n,this._bvh.intersectRay(e,t,r),this._triangleHitCallback=ZA}intersectRange(e,t){const r=this._bvh.elementIndexMap;GA(this.ray0,this.rayDirection,e,t,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,r,this.startTriangleNumber)}getTriangleElevationOffset(e){return this.totalElevationOffset}}function GA(e,t,r,i,n,s,o,a,l,c,u){let h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0;0!==a?(0,uT.zW)(e,t,r,i,n,s,o,a,l,c,u,h,d):(0,uT.h7)(e,t,r,i,n,s,o,c,u,h,d)}function ZA(){}function $A(e,t,r,i){if(r>=t)return e;null==e&&(e=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return{isVisibleBit:!e,data:new Uint32Array(0)}}());const n=e.isVisibleBit;let s=e.data;const o=WA(s),a=r/o|0,l=r-o*a,c=(t-1)/o|0,u=s,h=i===n;if(!(r<u.length*o)&&h){const e=a+1,t=Math.ceil(u.length*Dt.Ji),r=c+1;let i=Math.max(e,t);i=Math.min(i,r),s=new Uint32Array(i),s.set(u)}return a<s.length&&(s[a]=function(e,t,r){return e&~(1<<t)|(r?1:0)<<t}(s[a],l,h)),e.data=s,e}function qA(e,t){if(null==e)return!0;const{isVisibleBit:r,data:i}=e,n=WA(i);return t<i.length*n?function(e,t,r,i){const n=r/i|0,s=r-n*i;return function(e,t){return!!(e&1<<t)}(t[n],s)===e}(r,i,t,n):!e.isVisibleBit}function WA(e){return 8*e.BYTES_PER_ELEMENT}class YA{constructor(e,t,r,i,n,s,o,a){this.vertexData=e,this.vertexStride=t,this.indexData=r,this._components=i,this._componentAabbs3D=n,this.geometryMinZ=s,this.planetCenterZ=o,this.localMode=a,this.maxBspNodeDepth=6,this.minElementCountForBVH=10,this.minBspNodeElementCount=3,this._ray0=QA,this._ray1=eC,this._invDir=(0,nn.vt)(),this._componentVerticalOffsets=null,this._verticalOffset=null,this._tolerance=0,this._intersectionOptions=rC,this._callback=tC,this.rayDirectionC=(0,nn.vt)(),this._componentIndexMap=null,this._bvh=new VA(i.count,this),this.componentIntersectionData=new Array(i.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){const{numComponents:e,planetCenterZ:t,minZGlobal:r}=this,i=new Float64Array(4*e),n=this._componentAabbs3D;for(let s=0;s<e;++s){const e=6*s,o=n[e+0],a=n[e+1],l=n[e+2],c=n[e+3],u=n[e+4],h=r/(l-t),d=r/(n[e+5]-t),p=Math.min(o*h,o*d),f=Math.min(a*h,a*d),m=Math.max(c*h,c*d),g=Math.max(u*h,u*d),y=4*s;i[y+0]=p,i[y+1]=f,i[y+2]=m,i[y+3]=g}return i}getAabbs2DLocal(){const{numComponents:e}=this,t=new Float64Array(4*e),r=this._componentAabbs3D;for(let i=0;i<e;++i){const e=6*i,n=r[e+0],s=r[e+1],o=r[e+3],a=r[e+4],l=4*i;t[l+0]=n,t[l+1]=s,t[l+2]=o,t[l+3]=a}return t}intersectRay(e,t,r,i,n,s,o){const{isVerticalRay:a}=o;this._ray0=e,this._ray1=t,this._componentVerticalOffsets=r,this._verticalOffset=i,this._tolerance=s,this._intersectionOptions=o,this._componentIndexMap=this._bvh.elementIndexMap,(0,uT.OO)(e,t,this._invDir),this._callback=n,this._bvh.intersectRay(e,t,a),this._callback=tC}intersectRange(e,t){const r=this._componentIndexMap,i=this._components,n=i.pickability,s=i.visibility;for(let o=e;o<t;++o){const e=r?r[o]:o;qA(n,e)&&s.isVisible(e)&&this._intersectComponent(e)}}getComponentTriangleCount(e){const t=this._components.offsets,r=t[e]/3;return t[e+1]/3-r}getComponentAabb3D(e,t){const r=this._componentAabbs3D,i=6*e;return t[0]=r[i],t[1]=r[i+1],t[2]=r[i+2],t[3]=r[i+3],t[4]=r[i+4],t[5]=r[i+5],t}_intersectComponent(e){if(!qA(this._components.pickability,e))return;const t=this.getComponentAabb3D(e,XA);let r=!1;const{localMode:i,_componentVerticalOffsets:n,_verticalOffset:s,_ray0:o,_ray1:a,_invDir:l,planetCenterZ:c,_tolerance:u,rayDirectionC:h,componentIntersectionData:d}=this,{isVerticalRay:p}=this._intersectionOptions,f=this._components.offsets,m=(0,da.c)(JA,o),g=(0,da.c)(KA,a),y=n?.[e]??0,_=y+(s?.offset??0);if(0!==_&&(i?(m[2]=o[2]-_,g[2]=a[2]-_,r=!0):null!=s&&(s.componentOffset=y)),null==s||r||0===_||s.applyToAabb(t),!(0,uT.Wb)(t,m,l,u))return;(0,da.z)(h,g,m);const v=f[e]/3,b=f[e+1]/3,w=b-v,x=(t,r,i)=>{this._callback(t,r,e,i)},{vertexData:S,vertexStride:T,indexData:M,_intersectionOptions:A}=this,{normalRequired:C}=A;if(w>iC){let t=d[e];null==t&&(t=new HA(e,S,T,M,v,b,this.geometryMinZ,c,i),d[e]=t),t.intersectRay(m,g,p,r?0:_,x,C)}else GA(m,h,v,b,M,S,T,r?0:_,c,C,x)}}const XA=(0,If.vt)(),JA=(0,nn.vt)(),KA=(0,nn.vt)(),QA=(0,nn.vt)(),eC=(0,nn.vt)(),tC=()=>{},rC=new uT.JG,iC=40;class nC{constructor(e,t,r){this.viewingMode=e,this.positionData=t,this._components=r,this.verticalOffset=null,this.componentVerticalOffsets=null,this._planetCenter=(0,nn.vt)(),this._componentBvh=null,this._aabb=[0,0,0,0,0,0],this._indices=t.indices?(0,OA.Dg)(t.indices):(0,OA.tM)(t.positions.length/3),this._positions=t.positions}destroy(){this._positions=null,this._indices=null,this._perComponentAabbs=null,this._componentBvh=null}getComponentAabb(e,t){const r=this._ensureComponentAabbs(),i=6*e;return t[0]=r[i],t[1]=r[i+1],t[2]=r[i+2],t[3]=r[i+3],t[4]=r[i+4],t[5]=r[i+5],t}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(e,t){t.indices=this._indices,t.data=this._positions,t.stride=3,t.startIndex=this._components.offsets[e],t.endIndex=this._components.offsets[e+1]}intersect(e,t,r,i,n,s,o,a){this.verticalOffset=i,this.componentVerticalOffsets=n;const{position:l}=s,c=(0,da.z)(sC,e,l),u=(0,da.z)(oC,t,l),h=(0,Za.B8)(aC,s.rotationScale);(0,da.t)(c,c,h),(0,da.t)(u,u,h);const d=(0,Za.mg)(cC,h);if(this.viewingMode===$s.RT.Global){const e=this._planetCenter;(0,da.k)(e,l),(0,da.t)(e,e,h)}this._intersectComponents(c,u,n,i,((e,t,r,i)=>{a(r,e,i?(0,da.t)(lC,i,d):null,t)}),r,o)}_computePerComponentAabbs(){const e=this._aabb,t=.5*(e[0]+e[3]),r=.5*(e[1]+e[4]),i=.5*(e[2]+e[5]),n=this._components.count,s=(0,Dl.oe)(6*n),o=this._indices,a=this._positions,l=this._components.offsets;let c=0,u=1/0,h=1/0,d=1/0,p=-1/0,f=-1/0,m=-1/0;for(let g=0;g<n;g++){const e=l[g],n=l[g+1];let y=1/0,_=1/0,v=1/0,b=-1/0,w=-1/0,x=-1/0;if(e<n)for(let t=e;t<n;t++){const e=3*o[t],r=a[e],i=a[e+1],n=a[e+2];y=Math.min(y,r),_=Math.min(_,i),v=Math.min(v,n),b=Math.max(b,r),w=Math.max(w,i),x=Math.max(x,n)}else y=t,_=r,v=i,b=t,w=r,x=i;s[c++]=y,s[c++]=_,s[c++]=v,s[c++]=b,s[c++]=w,s[c++]=x,u=Math.min(u,y),h=Math.min(h,_),d=Math.min(d,v),p=Math.max(p,b),f=Math.max(f,w),m=Math.max(m,x)}return this._aabb[0]=u,this._aabb[1]=h,this._aabb[2]=d,this._aabb[3]=p,this._aabb[4]=f,this._aabb[5]=m,s}_intersectComponents(e,t,r,i,n,s,o){let a=this._componentBvh;null==a&&(a=new YA(this._positions,3,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode),this._componentBvh=a),a.intersectRay(e,t,r,i,n,s,o)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===$s.RT.Local}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}}const sC=(0,nn.vt)(),oC=(0,nn.vt)(),aC=(0,Zh.vt)(),lC=(0,nn.vt)(),cC=(0,Zh.vt)();class uC{constructor(e,t,r){this.material=e,this.geometry=t,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}}class hC{constructor(e,t,r,i){this.vao=e,this.primitiveType=t,this.parameters=r,this.indexed=i}dispose(){this.vao.dispose()}}class dC{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}}function pC(e){return e?fC(e,1/0,-1/0):function(e,t){return{near:e,far:t}}(1/0,-1/0)}function fC(e,t,r){return e.near=t,e.far=r,e}function mC(e,t){null!=t&&(e.near=Math.min(e.near,t.near),e.far=Math.max(e.far,t.far))}function gC(e,t){return e.near<=t&&t<=e.far}const yC={near:0,far:0};function _C(e,t){const r=pC(),{eye:i,frustum:n,viewForward:s}=e;t.forAll((e=>{const t=null!=e.offsetObb?e.offsetObb:e.obb,o=(0,da.m)((0,da.z)(LC,t.center,i),s),a=t.projectedRadius(s);if(gC(r,o-a)&&gC(r,o+a))return;const l=function(e,t){let r=0;for(let i=0;i<PC;i++){const n=e.intersectPlane(t[i]);if(n>0)return-1;0===n&&(r|=1<<i)}return r}(t,n);if(-1===l)return;if(0===l)return bC.far=o+a,bC.near=o-a,void mC(r,bC);const c=vC.pushNew();c.near=o-a,c.far=o+a,c.mask=l,c.object=e}));for(let o=0;o<vC.length;o++){const e=vC.data[o];if(gC(r,e.near)&&gC(r,e.far))continue;bC.far=e.far,bC.near=1/0;const t=EC(null!=e.object.offsetObb?e.object.offsetObb:e.object.obb,i,SC,(t=>{let r=TC;for(let i=0;i<PC&&t.length>0;i++){if(!(e.mask&1<<i))continue;MC(n[i],t,r);const s=t;t=r,r=s}for(let e=0;e<t.length;e+=3){(0,da.s)(wC,t.data[e],t.data[e+1],t.data[e+2]);const r=(0,da.m)((0,da.z)(wC,wC,i),s);bC.near=Math.min(bC.near,r)}}));0===t&&(bC.near=0),mC(r,bC)}return vC.length=0,r}const vC=new Ty.A({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),bC=pC(),wC=(0,nn.vt)(),xC=(0,nn.vt)(),SC=new Ty.A({deallocator:null}),TC=new Ty.A({deallocator:null});function MC(e,t,r){r.length=0;const i=t.length-3;AC(wC,t,i);const n=(0,$d.mN)(e,wC);n<=0&&(r.push(wC[0]),r.push(wC[1]),r.push(wC[2]));let s=0,o=n;for(;s<i;s+=3){AC(xC,t,s);const i=(0,$d.mN)(e,xC);o*i<0&&((0,da.o)(wC,xC,wC,i/(i-o)),CC(r,wC)),i<=0&&CC(r,xC),o=i,(0,da.c)(wC,xC)}o*n<0&&(AC(xC,t,i),(0,da.o)(wC,xC,wC,n/(n-o)),CC(r,wC))}function AC(e,t,r){return(0,da.s)(e,t.data[r],t.data[r+1],t.data[r+2])}function CC(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function EC(e,t,r,i){(0,kd.Xr)(IC,e.quaternion),(0,da.z)(LC,t,e.center),(0,da.u)(LC,LC,IC);const n=e.halfSize,s=8*((LC[0]<-n[0]?-1:LC[0]>n[0]?1:0)+3*(LC[1]<-n[1]?-1:LC[1]>n[1]?1:0)+9*(LC[2]<-n[2]?-1:LC[2]>n[2]?1:0)+13),o=RC[s];if(0===o)return o;(0,Za.I0)(OC,e.quaternion),(0,Za.hs)(OC,OC,e.halfSize);const a=(t,r)=>{const i=RC[s+r+1];return(0,da.s)(t,((1&i)<<1)-1,(2&i)-1,((4&i)>>1)-1),(0,da.t)(t,t,OC),(0,da.g)(t,e.center,t)};return r.length=0,CC(r,a(NC,0)),CC(r,a(DC,1)),CC(r,a(LC,2)),CC(r,a(FC,3)),i(r),1===o||(r.length=0,CC(r,NC),CC(r,FC),CC(r,a(LC,4)),CC(r,a(kC,5)),i(r),2===o||(r.length=0,CC(r,NC),CC(r,kC),CC(r,a(LC,6)),CC(r,DC),i(r))),o}const RC=(()=>{const e=new Array(216);let t=0;const r=r=>{for(let i=0;i<r.length;i++)e[t+i]=r[i];t+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),e})(),PC=4;const OC=(0,Zh.vt)(),IC=(0,zd.vt)(),LC=(0,nn.vt)(),NC=(0,nn.vt)(),DC=(0,nn.vt)(),FC=(0,nn.vt)(),kC=(0,nn.vt)();class zC{constructor(e){this._objects=e}submit(e,t){this._objects.preSubmit(t),this._objects.visibleObjects.forAll((r=>r.renderable.material.submit(e,t,r)))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?_C(e,this._objects.visibleObjects):null}}var UC=r(16449);class VC{constructor(){this.externalColor=(0,ya.vt)(),this.externalColorMixMode=NA.k5.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}}var BC=r(91555),jC=r(63599),HC=r(13545),GC=r(96141),ZC=r(8775),$C=r(13167),qC=r(36911);const WC=()=>Xe.A.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class YC{constructor(e,t){this._renderManager=e,this._viewingMode=t,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._visible=new Ty.A,this._hidden=new Ty.A,this._renderSubmit=new zC(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=(0,it.A)("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new $C.A(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){(0,kl.vA)(0===this._hidden.length&&0===this._visible.length,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll((e=>e.destroy())),this._hidden.forAll((e=>e.destroy())),this._visible.clear(),this._hidden.clear()}createObject(e){const t=e.geometry,r=new kA(this._componentBufferManager,(0,OA.Dg)(t.componentOffsets)),i=this._createRenderable(e,r),n=new nC(this._viewingMode,t.positionData,r),s=new zA(e.transform,e.toMapSpace,e.obb.clone(),r,i,n);return(s.visible?this._visible:this._hidden).push(s),s}destroyObject(e){const t=e;(t.visible?this._visible:this._hidden).removeUnordered(t),t.destroy(),this._notifyDirty()}setObjectVisibility(e,t){const r=e;t!==r.visible&&(t?(this._hidden.removeUnordered(r),this._visible.push(r)):(this._visible.removeUnordered(r),this._hidden.push(r)),r.visible=t,this._notifyDirty())}preSubmit(e){const t=e.camera.eye;this.visibleObjects.forAll((e=>e.renderable.meta.cameraDepthSquared=(0,da.a)(t,e.obb.center)))}getMaterial(e){return e.renderable.material}updateMaterial(e,t){const r=e.renderable.material;t(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,t){const r=e;r.components.visibility.reset(t),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,t){return e.components.visibility.forEachComponent(t)}getComponentCount(e){const t=e,r=t.components.visibility.componentCount;return{visible:r,invisible:t.components.count-r}}setComponentData(e,t){const r=e,i=r.renderable.material,n=r.components,s=n.materialDataBuffer,o=n.materialDataIndices,a=new VC,l=s.textureBuffer,c=new Uint8Array(4),u=new Uint32Array(c.buffer);let h=0,d=0,p=0,f=n.verticalOffsets,m=1/0,g=-1/0,y=!1,_=!1,v=0;for(let b=0;b<n.count;b++){t(b,a),h+=+(a.externalColor[3]<1),d+=+(a.externalColorMixMode===NA.k5.Replace&&1===a.externalColor[3]),p+=+a.castShadows,(0,NA._j)(a.externalColor,a.externalColorMixMode,c),c[2]=254&c[2]|+a.castShadows,l.setData(o[b],0,c[0],c[1],c[2],c[3]),y||=b>0&&v!==u[0],v=u[0],_||=0!==a.elevationOffset,_&&null==f&&(f=new Array(b).fill(0)),null!=f&&(f[b]=a.elevationOffset),m=Math.min(m,a.elevationOffset),g=Math.max(g,a.elevationOffset),(0,HC.B)(a.elevationOffset,c),l.setData(o[b],1,c[0],c[1],c[2],c[3]);const e=a.objectAndLayerIdColor;null!=e&&l.setData(o[b],2,e[0],e[1],e[2],e[3]),a.pickable!==qA(n.pickability,b)&&(n.pickability=$A(n.pickability,n.count,b,a.pickable))}n.verticalOffsets=_?f:null,r.offsetObb=_?(0,DA.gm)(r.obb,m,g,this._viewingMode,r.offsetObb??r.obb.clone()):null,y||_||this._hasObjectAndLayerId?(i.componentParameters=new BC.em,i.componentParameters.castShadows=JC(p,n.count),i.componentParameters.transparent=JC(h,n.count),i.componentParameters.opaqueOverride=JC(d,n.count),i.componentParameters.texture=l,l.updateTexture()):(i.componentParameters=new BC.Wo,i.componentParameters.castShadows=a.castShadows?BC.d0.All:BC.d0.None,i.componentParameters.externalColor=a.externalColor,i.componentParameters.externalColorMixMode=a.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.intersectionGeometry.getComponentAabb(t,r);const n=e,s=n.components.verticalOffsets;if(i||null==s)return r;const o=s[t];if(this._viewingMode===$s.RT.Local||0===o)return r[2]+=o,r[5]+=o,r;const a=(0,Jd.XG)(o);return a.localOrigin=n.transform.position,a.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,t,r){return e.intersectionGeometry.getComponentPositions(t,r)}expandRangeWithComponentObjectElevationRange(e,t,r,i){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==t||i.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const n=e,s=n.components,o=s.count,a=s.verticalOffsets,l=n.intersectionGeometry,c=this._viewingMode===$s.RT.Local,u=l.getComponentAabbs(),h=KC;let d=1/0,p=-1/0;for(let f=0;f<o;f++){const e=6*f,s=a?.[f]??0;let o=1/0,l=-1/0;if(c)o=u[e+2]+s+t,l=u[e+5]+s+t;else{if(h[0]=u[e],h[1]=u[e+1],h[2]=u[e+2],h[3]=u[e+3],h[4]=u[e+4],h[5]=u[e+5],0!==s){const e=(0,Jd.XG)(s);e.localOrigin=n.transform.position,e.applyToAabb(h)}const o=Math.max(Math.abs(h[3]),Math.abs(h[0])),a=Math.max(Math.abs(h[4]),Math.abs(h[1])),l=t+h[5]+r;i.expandElevationRangeValues(t+h[2],Math.sqrt(o*o+a*a+l*l)-r)}i.expandElevationRangeValues(o,l),d=Math.min(d,o),p=Math.max(p,l)}this._elevationRangeCacheVerticalOffset=t,this._elevationRangeCacheMin=d,this._elevationRangeCacheMax=p}intersect(e,t,r,i,n,s,o){const a=e,{transform:l}=a,{position:c}=l;return null!=n&&(n.localOrigin=c),a.intersectionGeometry.intersect(t,r,i,n,a.components.verticalOffsets,l,s,o)}addEdges(e,t,r,i,n){const s=e,{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets;return t.addComponentObject(s,a,o,l,r,i,n)}async extractEdgeInformation(e,t,r){const i=e,n=i.components.visibility;if(n.allInvisible())return{buffer:ZC.HY.createBuffer(0),origin:[0,0,0]};const{indices:s,positions:o}=i.intersectionGeometry,a=i.components.offsets,l=GC.I$.createBuffer(o.length/3);(0,LA.c)(l.position.typedBuffer,o,l.position.typedBufferStride,3),(0,IA.c)(l.position,l.position,i.transform.rotationScale),this._setComponentIndices(l.componentIndex,s,a);const c=l.count,u=this._computeVisibilityIndices(s,n,a,c);return{origin:(0,nn.o8)(i.transform.position),buffer:await t.extractComponentsEdgeLocations({indices:u,indicesLength:u.length,skipDeduplicate:!0,data:l,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,t,r){let i=0;for(let n=0;n<r.length-1;n++){const s=r[n],o=r[n+1];for(let r=s;r<o;r++){const n=t?t[r]:r;e.set(n,i)}i++}}_computeVisibilityIndices(e,t,r,i){if(e&&t.allVisible())return e;let n=0;t.forEachComponentRange(((e,t)=>(n+=r[t]-r[e],!0)));const s=(0,PA.cy)(e)?new Array(n):2===e?.BYTES_PER_ELEMENT||i<=65536?new Uint16Array(n):new Uint32Array(n);let o=0;return t.forEachComponentRange(((t,i)=>{const n=r[t],a=r[i];for(let r=n;r<a;r++)s[o++]=e?e[r]:r;return!0})),s}addComponentHighlight(e,t){const r=e.components;null==r.highlightCounts&&(r.highlightCounts=new Uint32Array(r.count+1)),0===r.highlightCounts[t]++&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,t){const r=e.components;if(null==r.highlightCounts)return void WC().warn("Removing non-existing highlight.");const i=r.highlightCounts[t],n=r.highlightCounts[r.count];if(0!==i){if(i>1)return r.highlightCounts[t]=i-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[t]=0,r.highlightsDirty(),this._notifyDirty(),1===n?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else WC().warn("Removing non-existing highlight.")}clearHighlights(e){const t=e.components;null!=t.highlightCounts&&(t.highlightCounts=null,t.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(e,t){const r=this._renderManager.rctx,i=e.geometry,n=i.vertices.layoutParameters,s=Rl.g.createVertex(r,Aa._U.STATIC_DRAW,i.vertices.data),o=i.indices?Rl.g.createIndex(r,Aa._U.STATIC_DRAW,i.indices):null,a=(0,Tl.U)((0,UC.h)(n)),l=new Uint16Array(i.vertices.count);for(let f=0;f<t.count;f++){const e=t.offsets[f],r=t.offsets[f+1],n=t.materialDataIndices[f];if(null!=i.indices)for(let t=e;t<r;t++)l[i.indices[t]]=n;else for(let t=e;t<r;t++)l[t]=n}const c=Rl.g.createVertex(r,Aa._U.STATIC_DRAW,l.buffer),u=new BC.f5(e.transform,e.toMapSpace),h=new qC.Z(r,jC.T,{data:a,componentIndices:XC},{data:s,componentIndices:c},o),d=new hC(h,Aa.WR.TRIANGLES,n,null!=o),p={cameraDepthSquared:.5,gpuMemoryEstimate:s.usedMemory+c.usedMemory+(null!=o?o.usedMemory:0)};return new uC(u,d,p)}_notifyDirty(){this._renderManager.notifyDirty()}}const XC=(0,Tl.U)((0,Ml.BP)().u16(El.r.COMPONENTINDEX));function JC(e,t){return e===t?BC.d0.All:0===e?BC.d0.None:BC.d0.Some}const KC=(0,If.vt)();var QC=r(58229),eE=r(36451),tE=r(61157);class rE extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,rE.shader.get().build(),Ta.D)}initializePipeline(){return(0,Ca.Ey)({blending:(0,Ca.p3)(Aa.dn.SRC_ALPHA,Aa.dn.ONE,Aa.dn.ONE_MINUS_SRC_ALPHA,Aa.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Ca.wE})}}rE.shader=new xa.$(tE.H,(()=>r.e(2671).then(r.bind(r,82671))));var iE=r(43666);class nE extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,nE.shader.get().build(),Ta.D)}initializePipeline(){return(0,Ca.Ey)({colorWrite:Ca.wE})}}nE.shader=new xa.$(iE.a,(()=>r.e(9616).then(r.bind(r,9616))));var sE=r(21019);class oE extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,oE.shader.get().build(),Ta.D)}initializePipeline(){return(0,Ca.Ey)({colorWrite:Ca.wE})}}oE.shader=new xa.$(sE.a,(()=>r.e(1521).then(r.bind(r,51521))));class aE extends wa.Y{constructor(){super(...arguments),this.color=(0,ya.fA)(1,0,1,1),this.haloColor=(0,ya.fA)(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.coverageRounding=(0,va.fA)(1,1)}}let lE=class extends eE.A{constructor(e){super(e),this.produces="highlight-color",this.consumes={required:["highlight-color","highlights"]},this._passParameters=new aE,this._downsampleDrawParameters=new sE.H,this._blurDrawParameters=new iE.H,this._blurColorFormat=(0,it.A)("mac")?La.N.RGBA:La.N.RGBA4,this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0},this._blurTechnique=e.techniques.acquire(nE),this._downsampleTechnique=e.techniques.acquire(oE),this._applyTechnique=e.techniques.acquire(rE)}initialize(){this.addHandles([(0,gt.wB)((()=>this.view.highlightOptions.color),(e=>{this._passParameters.color=(0,fa.QP)(e??yb),this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color),this.requestRender(hx.C7.UPDATE)}),gt.pc),(0,gt.wB)((()=>this.view.highlightOptions.haloColor),(e=>{this._passParameters.haloColor=null!=e?(0,fa.QP)(e):this._passParameters.color,this.requestRender(hx.C7.UPDATE)}),gt.pc),(0,gt.wB)((()=>this.view.highlightOptions.haloOpacity),(e=>{this._passParameters.haloOpacity=e??1,this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity,this.requestRender(hx.C7.UPDATE)}),gt.pc),(0,gt.wB)((()=>this.view.highlightOptions.fillOpacity),(e=>{this._passParameters.fillOpacity=e??.25,this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity,this.requestRender(hx.C7.UPDATE)}),gt.pc)])}destroy(){this._blurTechnique.release(),this._downsampleTechnique.release(),this._applyTechnique.release(),this._grid.coverage=(0,Je.Gz)(this._grid.coverage),this._grid.vao=(0,Je.WD)(this._grid.vao)}render(e){if(this.bindParameters.decorations===hx.ID.OFF)return e.find((e=>{let{name:t}=e;return"highlight-color"===t}));if(!(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled))return this.requestRender(hx.C7.UPDATE),e.find((e=>{let{name:t}=e;return"highlight-color"===t}));const t=e.find((e=>{let{name:t}=e;return"highlights"===t})).getTexture(),r=this.bindParameters.camera,i=r.fullWidth,n=r.fullHeight,s=r.pixelRatio,o=Math.ceil(i/s),a=Math.ceil(n/s),l=this.renderingContext;this._gridUpdateResources(t),this._gridComputeCoverage(t,this.bindParameters),this._passParameters.highlightTexture=t,this._passParameters.coverageTexture=this._grid.coverage?.getTexture();const{width:c,height:u}=t.descriptor;(0,ma.hZ)(this._passParameters.coverageRounding,c/(Math.ceil(c/sE.g)*sE.g),u/(Math.ceil(u/sE.g)*sE.g));const h=this._grid.vao;l.bindVAO(h);const d=this.fboCache.acquire(o,a,"highlight blur",this._blurColorFormat);l.unbindTexture(d.fbo?.colorTexture),l.bindFramebuffer(d.fbo),l.setClearColor(0,0,0,0),l.clear(Aa.hn.COLOR_BUFFER_BIT),l.setViewport(0,0,o,a),this._blurDrawParameters.blurInputTexture=t,(0,ma.hZ)(this._blurDrawParameters.blurSize,1/o,0);const p=l.bindTechnique(this._blurTechnique,this.bindParameters,this._passParameters,this._blurDrawParameters);l.drawArrays(this._blurTechnique.primitiveType,0,(0,Ol.mT)(h,"geometry"));const f=this.fboCache.acquire(o,a,"highlight blur",this._blurColorFormat);l.unbindTexture(f.fbo?.colorTexture),l.bindFramebuffer(f.fbo),l.setClearColor(0,0,0,0),l.clear(Aa.hn.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=d.getTexture(),(0,ma.hZ)(this._blurDrawParameters.blurSize,0,1/a),p.bindDraw(this._blurDrawParameters,this.bindParameters,this._passParameters),l.drawArrays(this._blurTechnique.primitiveType,0,(0,Ol.mT)(h,"geometry"));const m=e.find((e=>{let{name:t}=e;return"highlight-color"===t}));return l.bindFramebuffer(m.fbo),l.setViewport4fv(r.fullViewport),this._passParameters.blurTexture=f.getTexture(),l.bindTechnique(this._applyTechnique,this.bindParameters,this._passParameters),l.drawArrays(this._applyTechnique.primitiveType,0,(0,Ol.mT)(h,"geometry")),d.release(),f.release(),m}_gridUpdateResources(e){const t=this.renderingContext,r=this._grid,i=Math.ceil(e.descriptor.height/sE.g),n=Math.ceil(e.descriptor.width/sE.g);if(r.vao&&r.verticalCellCount===i&&r.horizontalCellCount===n)return;r.verticalCellCount=i,r.horizontalCellCount=n;const s=i+1,o=n+1,a=1/i,l=1/n,c=new Float32Array(24*s*o);let u=0;for(let h=0;h<s;h++)for(let e=0;e<o;e++)c[u++]=(e-.5)*l*2-1,c[u++]=(h-.5)*a*2-1,c[u++]=e*l,c[u++]=h*a,c[u++]=(e+.5)*l*2-1,c[u++]=(h-.5)*a*2-1,c[u++]=e*l,c[u++]=h*a,c[u++]=(e-.5)*l*2-1,c[u++]=(h+.5)*a*2-1,c[u++]=e*l,c[u++]=h*a,c[u++]=(e-.5)*l*2-1,c[u++]=(h+.5)*a*2-1,c[u++]=e*l,c[u++]=h*a,c[u++]=(e+.5)*l*2-1,c[u++]=(h-.5)*a*2-1,c[u++]=e*l,c[u++]=h*a,c[u++]=(e+.5)*l*2-1,c[u++]=(h+.5)*a*2-1,c[u++]=e*l,c[u++]=h*a;r.vao?.dispose(),r.vao=new Cl.Z(t,Ta.D,{geometry:Na.u7},{geometry:Rl.g.createVertex(t,Aa._U.STATIC_DRAW,c)})}_gridComputeCoverage(e,t){const r=this.renderingContext,i=this._grid,n=e.descriptor,s=Math.ceil(n.width/sE.g),o=Math.ceil(n.height/sE.g);this._downsampleDrawParameters.input=e,i.coverage?.release(),i.coverage=this.fboCache.acquire(s,o,"highlight coverage",La.N.RG),r.unbindTexture(i.coverage.fbo?.colorTexture),r.bindFramebuffer(i.coverage.fbo),r.bindTechnique(this._downsampleTechnique,t,this._passParameters,this._downsampleDrawParameters),r.setViewport(0,0,s,o),r.screen.draw()}get test(){}};(0,ze._)([(0,Qe.MZ)()],lE.prototype,"produces",void 0),(0,ze._)([(0,Qe.MZ)()],lE.prototype,"consumes",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],lE.prototype,"techniques",void 0),lE=(0,ze._)([(0,tt.$)("esri.views.3d.webgl-engine.effects.highlight.Highlight")],lE);var cE=r(86279);class uE extends Pa.K{constructor(){super(...arguments),this.receiveShadows=!0}}(0,ze._)([(0,Pa.W)()],uE.prototype,"receiveShadows",void 0);var hE=r(97157);class dE extends cE.QR{constructor(){super(...arguments),this.shadowColor=(0,ya.fA)(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class pE extends Sa.w{constructor(e){super(e,new uE,(()=>this.destroy()))}initializeProgram(e){return new Ma.B(e.rctx,pE.shader.get().build(this.configuration),Ta.D)}initializePipeline(){return(0,Ca.Ey)({blending:(0,Ca.p3)(Aa.dn.SRC_ALPHA,Aa.dn.ONE,Aa.dn.ONE_MINUS_SRC_ALPHA,Aa.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Ca.wE,depthTest:null,depthWrite:null})}get primitiveType(){return Aa.WR.TRIANGLE_STRIP}}pE.shader=new xa.$(hE.S,(()=>r.e(8655).then(r.bind(r,98655))));let fE=class extends eE.A{constructor(e){super(e),this.produces="composite-color",this.consumes={required:["composite-color","highlights"]},this._passParameters=new dE,this._maxOpacity=1,this._shadowDifference=.2,this._technique=e.techniques.acquire(pE)}initialize(){this.addHandles([(0,gt.wB)((()=>this.view.highlightOptions.shadowOpacity),(e=>{this._passParameters.shadowOpacity=e??.4,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()}),gt.pc),(0,gt.wB)((()=>this.view.highlightOptions.shadowDifference),(e=>{this._shadowDifference=e??.2,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()}),gt.pc),(0,gt.wB)((()=>this.view.highlightOptions.shadowColor),(e=>{this._passParameters.shadowColor=(0,fa.QP)(e??_b),this._updateMaxOpacity()}),gt.pc)])}destroy(){this._technique.release()}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}render(e){const t=e.find((e=>{let{name:t}=e;return"composite-color"===t})),r=this.bindParameters;if(!r.shadowHighlightsVisible||!r.depth||!this._ensureIfVisible(r.camera,r.lighting.mainLight.direction))return t;if(!this._technique.compiled)return this.requestRender(hx.C7.UPDATE),t;this._passParameters.highlight=e.find((e=>{let{name:t}=e;return"highlights"===t}))?.getTexture(),this._passParameters.origin=r.camera.center;const i=this.renderingContext;return i.bindFramebuffer(t.fbo),i.bindTechnique(this._technique,r,this._passParameters),i.screen.draw(),t}_ensureIfVisible(e,t){this._passParameters.opacityElevation=1-(0,ws.TF)(4e4,5e4,e.relativeElevation);const r=this.viewingMode===$s.RT.Global?(0,da.n)(mE,e.center):(0,da.s)(mE,0,0,1),i=(0,da.m)(r,t);return this._passParameters.dayNightTerminator=(0,ws.TF)(0,1,(0,ws.qE)(30*i,0,1)),this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=.001953125}};(0,ze._)([(0,Qe.MZ)()],fE.prototype,"produces",void 0),(0,ze._)([(0,Qe.MZ)()],fE.prototype,"consumes",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],fE.prototype,"viewingMode",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],fE.prototype,"techniques",void 0),fE=(0,ze._)([(0,tt.$)("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],fE);const mE=(0,nn.vt)();var gE=r(49003),yE=r(99129);class _E extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,_E.shader.get().build(),Ta.D)}initializePipeline(){return(0,Ca.Ey)({blending:(0,Ca.ox)(Aa.dn.ONE,Aa.dn.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Ca.wE})}}_E.shader=new xa.$(yE.a,(()=>r.e(7943).then(r.bind(r,27943))));let vE=class extends eE.A{constructor(e){super(e),this.produces="magnifier-color",this.consumes={required:["magnifier-color"]},this._imageSources=null,this._imageLoadTask=null,this._passParameters=new yE.M,this._vao=null,this._technique=null,this._magnifier=null,this._tmpScreenPoint=(0,Ki.gs)(),this._tmpRenderPoint=(0,Ki.QG)()}initialize(){this.addHandles([(0,gt.wB)((()=>this.view.magnifier),(e=>this._update(e)),gt.pc)])}_update(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const t=()=>{const e=this._validMagnifier;e?(this._loadResources(e),this.produces="magnifier-color"):this.produces="disabled",this.requestRender()};this._magnifier&&this.addHandles((0,gt.wB)((()=>this._magnifier?.version),t)),t()}get _validMagnifier(){return this._magnifier?.visible&&this._magnifier?.position&&this._magnifier?.size>0?this._magnifier:null}get _factor(){return this._magnifier?.factor||1}destroy(){this._magnifier=null,null!=this._imageLoadTask&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeTextures(),this._vao=(0,Je.WD)(this._vao)}_disposeTextures(){this._passParameters.mask=(0,Je.WD)(this._passParameters.mask),this._passParameters.overlay=(0,Je.WD)(this._passParameters.overlay),this._passParameters.input=(0,Je.WD)(this._passParameters.input)}render(e){const t=this._validMagnifier,r=e.find((e=>{let{name:t}=e;return"magnifier-color"===t}));if(null==t)return r;if(null==this._imageSources)return this.requestRender(hx.C7.UPDATE),r;const i=this.renderingContext,n=this.camera.pixelRatio,s=Math.ceil(n*t.size);if(this._vao??=(0,Da.Q)(i,Na.lK,Ta.D,0,1),this._technique??=this.techniques.acquire(_E),this._ensureTextureResources(i,s),!this._technique?.compiled||!this._passParameters.input)return this.requestRender(hx.C7.UPDATE),r;const o=Math.ceil(1/this._factor*s),a=this._passParameters.input;a.resize(o,o),(0,Ki.WA)(t.position,this._tmpScreenPoint);const l=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=this.camera.fullWidth,u=this.camera.fullHeight,h=.5*o,d=.5*o;l[0]=(0,ws.qE)(l[0],h,c-h-1),l[1]=(0,ws.qE)(l[1],d,u-d-1);const p=Math.floor(l[0]-h),f=Math.floor(l[1]-d);return i.bindFramebuffer(r.fbo),this._technique.program.bindTexture("textureInput",a),i.gl.copyTexImage2D(a.descriptor.target,0,a.descriptor.pixelFormat,p,f,o,o,0),this._passParameters.magnifier=t,i.bindTechnique(this._technique,this.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(Aa.WR.TRIANGLE_STRIP,0,4),r}_loadResources(e){const{maskUrl:t,overlayUrl:i}=e;this._imageLoadTask?.maskUrl===t&&this._imageLoadTask?.overlayUrl===i||(this._imageLoadTask?.task.abort(),this._imageLoadTask=this._imageSources=null),this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:(0,Fn.UT)((async e=>{const n=null==t||null==i?async function(e){const t=r.e(5047).then(r.bind(r,5047)),i=r.e(8193).then(r.bind(r,68193)),n=(0,gE.D)((await t).default,{signal:e}),s=(0,gE.D)((await i).default,{signal:e}),o={mask:await n,overlay:await s};return(0,Ke.Te)(e),o}(e):null,s=null!=t?(0,gE.D)(t,{signal:e}):n.then((e=>e.mask)),o=null!=i?(0,gE.D)(i,{signal:e}):n.then((e=>e.overlay));this._imageSources={mask:await s,overlay:await o}}))})}_ensureTextureResources(e,t){if(null==this._imageSources||this._passParameters.size===t&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay)return;this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=t,this._imageSources.overlay.height=this._imageSources.mask.height=t;const r=new sl.R;r.internalFormat=Aa.Ab.RGBA,r.wrapMode=Aa.pF.CLAMP_TO_EDGE,r.flipped=!0,r.preMultiplyAlpha=!(0,zt.XJ)(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result,this._passParameters.overlay=new Pl.g(e,r,this._imageSources.overlay),r.pixelFormat=r.internalFormat=Aa.Ab.ALPHA,r.preMultiplyAlpha=!1,this._passParameters.mask=new Pl.g(e,r,this._imageSources.mask),r.pixelFormat=r.internalFormat=Aa.Ab.RGBA,r.flipped=!1,this._passParameters.input=new Pl.g(e,r)}};(0,ze._)([(0,Qe.MZ)()],vE.prototype,"produces",void 0),(0,ze._)([(0,Qe.MZ)()],vE.prototype,"consumes",void 0),(0,ze._)([(0,Qe.MZ)()],vE.prototype,"_imageSources",void 0),(0,ze._)([(0,Qe.MZ)()],vE.prototype,"_imageLoadTask",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],vE.prototype,"techniques",void 0),vE=(0,ze._)([(0,tt.$)("esri.views.3d.webgl-engine.effects.magnifier.MagnifierRenderNode")],vE);var bE=r(32581);class wE extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,wE.shader.get().build(),Ta.D)}initializePipeline(){return(0,Ca.Ey)({colorWrite:Ca.wE})}}wE.shader=new xa.$(bE.B,(()=>r.e(9379).then(r.bind(r,79379))));var xE=r(58090);class SE extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,SE.shader.get().build(),Ta.D)}initializePipeline(){return(0,Ca.Ey)({colorWrite:Ca.wE})}}SE.shader=new xa.$(xE.B,(()=>r.e(4884).then(r.bind(r,24884))));var TE=r(21199);class ME extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,ME.shader.get().build(),Ta.D)}initializePipeline(){return(0,Ca.Ey)({colorWrite:Ca.wE})}}ME.shader=new xa.$(TE.E,(()=>r.e(2713).then(r.bind(r,72713))));class AE extends wa.Y{}let CE=class extends eE.A{constructor(e){super(e),this.produces="disabled",this.consumes={required:["aa-color","composite-color"]},this._areaTexture=null,this._searchTexture=null,this._smaaParameters=new AE,this._edgeTechnique=e.techniques.acquire(ME),this._blendTechnique=e.techniques.acquire(wE),this._blurTechnique=e.techniques.acquire(SE)}initialize(){this.addHandles([(0,gt.wB)((()=>this.isEnabled()),(e=>e?this.enable():this.disable()),gt.pc)])}async enable(){if(this.produces="aa-color",this._abortController||this._areaTexture&&this._searchTexture)return;this._abortController=new AbortController;const e=this._abortController.signal;try{const t=await r.e(7004).then(r.bind(r,77004));await this._loadTextures(t,e),this.requestRender(hx.C7.UPDATE)}catch{}this._abortController=null}async _loadTextures(e,t){(0,Ke.Te)(t);const[r,i]=await Promise.allSettled([(0,gE.D)(e.areaTexture,{signal:t}),(0,gE.D)(e.searchTexure,{signal:t})]);if((0,Ke.Te)(t),"fulfilled"!==r.status||"fulfilled"!==i.status)return;const n=this.renderingContext;this._areaTexture=EE(n,Aa.Cj.LINEAR,Aa.Ab.RGB,r.value),this._searchTexture=EE(n,Aa.Cj.NEAREST,Aa.Ab.LUMINANCE,i.value)}disable(){this.produces="disabled"}destroy(){this._searchTexture=(0,Je.WD)(this._searchTexture),this._areaTexture=(0,Je.WD)(this._areaTexture),this._blurTechnique.release(),this._blendTechnique.release(),this._edgeTechnique.release()}render(e){const t=e.find((e=>{let{name:t}=e;return"aa-color"===t}));if(!(this._edgeTechnique.compiled&&this._blendTechnique.compiled&&this._blurTechnique.compiled&&this._areaTexture&&this._searchTexture))return this.requestRender(hx.C7.UPDATE),t;const r=e.find((e=>{let{name:t}=e;return"composite-color"===t})),i=r.fbo.width,n=r.fbo.height,s=this.renderingContext;s.setViewport(0,0,i,n);const o=this.fboCache.acquire(i,n,"smaa edges",La.N.RG);s.unbindTexture(o.fbo?.colorTexture),s.bindFramebuffer(o.fbo),s.setClearColor(0,0,0,1),s.clear(Aa.hn.COLOR_BUFFER_BIT),this._smaaParameters.color=r.getTexture(),s.bindTechnique(this._edgeTechnique,null,this._smaaParameters),s.screen.draw();const a=this.fboCache.acquire(i,n,"smaa blend");return s.unbindTexture(a.fbo?.colorTexture),s.bindFramebuffer(a.fbo),s.setClearColor(0,0,1,1),s.clear(Aa.hn.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=o.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,s.bindTechnique(this._blendTechnique,null,this._smaaParameters),s.screen.draw(),o.release(),s.bindFramebuffer(t.fbo),s.setClearColor(0,1,0,1),s.clear(Aa.hn.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=a.getTexture(),s.bindTechnique(this._blurTechnique,null,this._smaaParameters),s.screen.draw(),a.release(),t}};function EE(e,t,r,i){const n=new sl.R;return n.pixelFormat=r,n.wrapMode=Aa.pF.CLAMP_TO_EDGE,n.width=i.width,n.height=i.height,n.samplingMode=t,new Pl.g(e,n,i)}(0,ze._)([(0,Qe.MZ)()],CE.prototype,"produces",void 0),(0,ze._)([(0,Qe.MZ)()],CE.prototype,"consumes",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],CE.prototype,"isEnabled",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],CE.prototype,"techniques",void 0),(0,ze._)([(0,Qe.MZ)()],CE.prototype,"_abortController",void 0),CE=(0,ze._)([(0,tt.$)("esri.views.3d.webgl-engine.effects.smaa.SMAA")],CE);var RE,PE=r(37958),OE=r(80517);!function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"}(RE||(RE={}));class IE extends Pa.K{constructor(){super(...arguments),this.alphaMode=RE.None,this.hasOpacityFactor=!1,this.isDepthBlit=!1}}(0,ze._)([(0,Pa.W)({count:RE.COUNT})],IE.prototype,"alphaMode",void 0),(0,ze._)([(0,Pa.W)()],IE.prototype,"hasOpacityFactor",void 0),(0,ze._)([(0,Pa.W)()],IE.prototype,"isDepthBlit",void 0);class LE extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,LE.shader.get().build(this.configuration),Ta.D)}initializePipeline(){switch(this.configuration.alphaMode){case RE.None:return(0,Ca.Ey)({colorWrite:Ca.wE});case RE.Alpha:return(0,Ca.Ey)({blending:(0,Ca.p3)(Aa.dn.SRC_ALPHA,Aa.dn.ONE,Aa.dn.ONE_MINUS_SRC_ALPHA,Aa.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Ca.wE});case RE.PremultipliedAlpha:case RE.COUNT:return(0,Ca.Ey)({blending:(0,Ca.ox)(Aa.dn.ONE,Aa.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Ca.wE})}}}LE.shader=new xa.$(OE.a,(()=>r.e(1043).then(r.bind(r,71043))));var NE=r(35072);class DE extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,DE.shader.get().build(),Ta.D)}initializePipeline(){return(0,Ca.Ey)({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}}DE.shader=new xa.$(NE.a,(()=>r.e(2362).then(r.bind(r,12362))));var FE=r(16309);class kE extends Sa.w{initializeProgram(e){return new Ma.B(e.rctx,kE.shader.get().build(),Ta.D)}initializePipeline(){return(0,Ca.Ey)({blending:(0,Ca.p3)(Aa.dn.SRC_ALPHA,Aa.dn.ONE,Aa.dn.ONE_MINUS_SRC_ALPHA,Aa.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Ca.wE})}}kE.shader=new xa.$(FE.a,(()=>r.e(3547).then(r.bind(r,33547))));class zE{constructor(e,t){this._rctx=e,this._techniques=t,this._configuration=new IE,this._passParameters=new OE.C,this._oitParameters=new FE.O,this._hudParameters=new NE.H}compositeOIT(e,t,r,i){this._oitParameters.colorTexture=t,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=i;const n=this._techniques.acquire(kE);this._rctx.bindTechnique(n,e,this._oitParameters),this._rctx.screen.draw(),n.release()}compositeHUD(e,t){this._hudParameters.texture=t;const r=this._techniques.acquire(DE);this._rctx.bindTechnique(r,e,this._hudParameters),this._rctx.screen.draw(),r.release()}composite(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:RE.None,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=1!==i,this._passParameters.texture=t,this._passParameters.opacity=i;const n=this._techniques.acquire(LE,this._configuration);this._rctx.bindTechnique(n,e,this._passParameters),this._rctx.screen.draw(),n.release()}blitDepthToLinearDepth(e,t){this._configuration.isDepthBlit=!0,this.composite(e,t),this._configuration.isDepthBlit=!1}}var UE=r(14522),VE=r(94536);const BE=100,jE=500,HE=500,GE=.1;function ZE(e,t,r){return(0,UE.T)(t,e)*(r[1]-r[0])+r[0]}function $E(e,t,r){let i=0;if(!t.some((e=>!!e.materialReference&&(i+=e.numGeometries,i>=1e4))))return nR.compute(e,t);const n=pC();return r.forAll((t=>mC(n,function(e,t){if(!t.visible)return;const r=pC(),i=t.getSpatialQueryAccelerator();return i?function(e,t,r){const i=t.eye,n=t.viewForward,s=t.frustum,o=e=>e.visible,a=r.objectCount;if(a<jE)fC(rR,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(i,n,VE.A.DepthOrder.FRONT_TO_BACK,rR,((r,i)=>{qE(e,t,r),rR.far=e.near,i.setRange(rR)}),s,o),fC(rR,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(i,n,VE.A.DepthOrder.BACK_TO_FRONT,rR,((r,i)=>{qE(e,t,r),rR.near=e.far,i.setRange(rR)}),s,o);else{const i=Math.max(Math.min(a,HE),Math.ceil(a*GE)),l=r.findClosest(n,VE.A.DepthOrder.FRONT_TO_BACK,s,o,i),c=r.findClosest(n,VE.A.DepthOrder.BACK_TO_FRONT,s,o,i);l&&c&&(YE(e,t,l.boundingVolumeWorldSpace.bounds),YE(e,t,c.boundingVolumeWorldSpace.bounds))}}(r,e,i):function(e,t,r){iR.clear(),r.forAll((e=>{e.visible&&0!==e.geometries.length&&iR.add(e)})),iR.empty||(iR.sort(t),fC(rR,t.near,Math.min(e.near,t.far)),iR.forEachInDepthRange(rR,VE.A.DepthOrder.FRONT_TO_BACK,((r,i)=>{i<e.near&&qE(e,t,r)})),fC(rR,Math.max(e.far,t.near),t.far),iR.forEachInDepthRange(rR,VE.A.DepthOrder.BACK_TO_FRONT,((t,r,i)=>{e.far=Math.max(e.far,i)})))}(r,e,t.objects),r}(e,t)))),n}function qE(e,t,r){if(!r.visible)return;if(!(0,Lf.m7)(t.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,n=tR;r.geometries.forEach((r=>{(0,$a.lw)(n,i,r.transformation);const s=(0,vo.hG)(n);WE(e,t,r.boundingInfo,n,s)}))}function WE(e,t,r,i,n){if(null==r)return;(0,da.h)((0,Su.g)(eR),r.center,i);const{eye:s,viewForward:o}=t,a=o[0]*(eR[0]-s[0])+o[1]*(eR[1]-s[1])+o[2]*(eR[2]-s[2]);if(eR[3]=r.radius*n,!(a-eR[3]>e.near&&a+eR[3]<e.far)&&(0,Lf.m7)(t.frustum,eR))if(r.radius>BE&&r.getChildren())for(const l of r.getChildren())WE(e,t,l,i,n);else sR.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function YE(e,t,r){const i=t.eye,n=t.viewForward,s=(r[0]-i[0])*n[0]+(r[1]-i[1])*n[1]+(r[2]-i[2])*n[2];e.near=Math.min(e.near,s-r[3]),e.far=Math.max(e.far,s+r[3])}function XE(e,t,r){let i=[e,t,r];for(let n=0;n<4;++n){const e=i;i=[];for(let t=0;t<e.length;++t){const r=e[t],s=e[(t+1)%e.length];JE(s,n)?(JE(r,n)||i.push(KE(r,s,n)),i.push(s)):JE(r,n)&&i.push(KE(r,s,n))}}return i}function JE(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void(0,kl.vA)(!1)}function KE(e,t,r){let i=0;return 0===r?i=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===r?i=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===r?i=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===r&&(i=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),(0,ga.l)((0,ya.vt)(),e,t,i)}const QE=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],eR=(0,Su.c)(),tR=(0,qa.vt)(),rR=pC(),iR=new class{constructor(){this._items=new Ty.A({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return 0===this._items.length}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const t=e.eye,r=e.viewForward;this._items.forAll((e=>{const i=e.object.boundingVolumeWorldSpace.bounds,n=(i[0]-t[0])*r[0]+(i[1]-t[1])*r[1]+(i[2]-t[2])*r[2];e.distance=n,e.near=n-i[3],e.far=n+i[3]})),this._items.sort(((e,t)=>e.distance-t.distance))}forEachInDepthRange(e,t,r){if(t===VE.A.DepthOrder.FRONT_TO_BACK)for(let i=0;i<this._items.length;++i){const t=this._items.data[i];t.far<e.near||t.near>e.far||r(t.object,t.near,t.far)}else for(let i=this._items.length-1;i>=0;--i){const t=this._items.data[i];t.far<e.near||t.near>e.far||r(t.object,t.near,t.far)}}},nR=new class{constructor(){this._view=(0,qa.vt)(),this._viewProj=(0,qa.vt)(),this._frustum=(0,Lf.vt)(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,t){this._reset(),(0,$a.C)(this._view,e.viewMatrix),(0,$a.lw)(this._viewProj,e.projectionMatrix,this._view),(0,Lf.C)(this._frustum,e.frustum);const r=this._view,i=r[2],n=r[6],s=r[10],o=r[14];t.forAll((e=>{e.materialReference&&e.forEachGeometry&&e.forEachGeometry((e=>{if(!e.visible||!e.castShadow)return;const t=e.boundingSphere,r=i*t[0]+n*t[1]+s*t[2]+o,a=r-t[3],l=r+t[3];this._geometries.push(e),this._near.push(-l),this._far.push(-a)}))}));const a=new dC;if(0===this._geometries.length)return a;for(let h=0;h<this._geometries.length;++h)this._near[h]>a.far&&(a.far=this._near[h]),this._near[h]>2&&this._far[h]<a.near&&(a.near=this._far[h]);const l=this._looseRange;l.near=Math.max(.5*a.near,2),l.far=2*a.far;let c=0,u=0;for(let h=0;h<this._geometries.length;++h)this._near[h]<a.near&&(this._near[h]>=l.near?a.near=this._near[h]:this._nearCandidates[c++]=h),this._far[h]>a.far&&(this._far[h]<=l.far?a.far=this._far[h]:this._farCandidates[u++]=h);if(0===this._nearCandidates.length&&0===this._farCandidates.length)return a;this._nearCandidates.sort(((e,t)=>this._near[e]<this._near[t]?-1:this._near[e]>this._near[t]?1:0)),this._farCandidates.sort(((e,t)=>this._far[e]<this._far[t]?1:this._far[e]>this._far[t]?-1:0));for(let h=0;h<this._nearCandidates.length;++h){const e=this._nearCandidates[h];if(this._near[e]<a.near){const t=this._geometries[e],r=t.boundingInfo;this._includeNearBoundingInfoRec(r,t.shaderTransformation,a)}}for(let h=0;h<this._farCandidates.length;++h){const e=this._farCandidates[h];if(this._far[e]>a.far){const t=this._geometries[e],r=t.boundingInfo;this._includeFarBoundingInfoRec(r,t.shaderTransformation,a)}}return this._reset(),a}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,t,r){if(null==e)return;const i=e.center;(0,da.h)((0,Su.g)(eR),i,t);const n=(0,vo.hG)(t),s=eR[0],o=eR[1],a=eR[2],l=e.radius*n,c=this._frustum;if(c[0][0]*s+c[0][1]*o+c[0][2]*a+c[0][3]>l||c[1][0]*s+c[1][1]*o+c[1][2]*a+c[1][3]>l||c[2][0]*s+c[2][1]*o+c[2][2]*a+c[2][3]>l||c[3][0]*s+c[3][1]*o+c[3][2]*a+c[3][3]>l)return;const u=this._view[2]*s+this._view[6]*o+this._view[10]*a+this._view[14],h=u+l;if(!(-(u-l)<2||-h>=r.near))if(-h>this._looseRange.near)r.near=-h;else{if(l>BE){const i=e.getChildren();if(void 0!==i){for(const e of i)this._includeNearBoundingInfoRec(e,t,r);return}}sR.unionDepthRangeWithAABB(r,this._viewProj,t,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,t,r){if(null==e)return;let i=e.radius;const n=e.center;(0,da.h)((0,Su.g)(eR),n,t);const s=(0,vo.hG)(t),o=eR[0],a=eR[1],l=eR[2];i*=s;const c=this._frustum;if(c[0][0]*o+c[0][1]*a+c[0][2]*l+c[0][3]>i||c[1][0]*o+c[1][1]*a+c[1][2]*l+c[1][3]>i||c[2][0]*o+c[2][1]*a+c[2][2]*l+c[2][3]>i||c[3][0]*o+c[3][1]*a+c[3][2]*l+c[3][3]>i)return;const u=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14]-i;if(!(-u<=r.far))if(-u<this._looseRange.far)r.far=-u;else{if(i>BE){const i=e.getChildren();if(void 0!==i){for(const e of i)this._includeFarBoundingInfoRec(e,t,r);return}}sR.unionDepthRangeWithAABB(r,this._viewProj,t,e.bbMin,e.bbMax)}}},sR=new class{constructor(){this._modelViewProj=(0,qa.vt)(),this._clipPosition=[(0,ya.vt)(),(0,ya.vt)(),(0,ya.vt)(),(0,ya.vt)(),(0,ya.vt)(),(0,ya.vt)(),(0,ya.vt)(),(0,ya.vt)()]}unionDepthRangeWithAABB(e,t,r,i,n){const s=this._modelViewProj;(0,$a.lw)(s,t,r);let o=!1;for(let a=0;a<8;++a){const e=this._clipPosition[a],t=0===a||3===a||4===a||7===a?i[0]:n[0],r=0===a||1===a||4===a||5===a?i[1]:n[1],o=a<4?i[2]:n[2];e[0]=s[0]*t+s[4]*r+s[8]*o+s[12],e[1]=s[1]*t+s[5]*r+s[9]*o+s[13],e[2]=s[2]*t+s[6]*r+s[10]*o+s[14],e[3]=s[3]*t+s[7]*r+s[11]*o+s[15]}for(let a=0;a<12;++a){const t=XE(this._clipPosition[QE[a][0]],this._clipPosition[QE[a][1]],this._clipPosition[QE[a][2]]);let r=!0;for(let e=0;e<t.length;++e)if(t[e][3]>=2){r=!1;break}if(!r){o=!0;for(let r=0;r<t.length;++r){const i=t[r][3];Number.isFinite(i)&&(e.near=Math.min(i,e.near),e.far=Math.max(i,e.far))}}}return o}};var oR=r(30988),aR=r(75941);class lR{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new AT.XP(new ArrayBuffer(4)),this._layerToOidToColor=new aR.O,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new aR.O,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,t,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;e&&t&&r&&i&&(this._layerUidToId.set(i,r),this._layerUidToPopupEnabled.set(i,n),n&&this._layerUidToGraphicsUidToObjectId.set(i,t,{objectId:e,attributeNodeId:s,attributeIndex:o,subLayerId:a}))}getObjectAndLayerIdColor(e){const t=this.getObjectAndLayerIdColorArray(e);return(0,ya.fA)(t.get(0,1),t.get(0,2),t.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const t=this._layerUidToPopupEnabled.get(e.layerUid);if(void 0===t)return this.colorZero;if(!1===t)return this.colorZero;const r=this._layerUidToGraphicsUidToObjectId.get(e.layerUid,e.graphicUid)?.objectId;if(!r)return this.colorZero;let i=this._layerToOidToColor.get(e.layerUid,r);if(!i){for(;!i;){const e=Math.floor(16777214*Math.random())+1;this._colorToUID.has(e)||(i=e)}if(i>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerUid,r,i),this._colorToUID.set(i,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,i,!1),new AT.XP(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[t,r]of this._colorToUID.entries()){const i=this._layerUidToGraphicsUidToObjectId.get(r.layerUid,r.graphicUid),n=this._layerUidToId.get(r.layerUid);i&&n&&e.set(t,i.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:i.objectId,lid:n,attrId:i.attributeNodeId,attrIdx:i.attributeIndex,subLayerId:i.subLayerId}:{type:"object-and-layer-id",oid:i.objectId,lid:n})}return e}}var cR,uR;r(39299),r(15434),r(62754);!function(e){e.OPAQUE="opaque-color",e.TRANSPARENT="transparent-color",e.COMPOSITE="composite-color",e.FINAL="final-color"}(cR||(cR={})),function(e){e.ANTIALIASING="aa-color",e.HIGHLIGHTS="highlight-color",e.MAGNIFIER="magnifier-color"}(uR||(uR={}));class hR{constructor(e,t){this.key=e,this.free=t,this.incarnation=0,this._refCount=1}retain(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._refCount+=e}release(){return 0===this._refCount?(console.log(`Releasing already released FBO attachment in ${(new Error).stack}`),!0):(--this._refCount,0===this._refCount&&(this.free(),!0))}}var dR;!function(e){e[e.FBO=0]="FBO",e[e.DEPTH=1]="DEPTH",e[e.COLOR=2]="COLOR"}(dR||(dR={}));class pR extends hR{constructor(e,t,r){super(e,r),this.attachment=t,this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}}class fR extends pR{constructor(e,t,r){super(e,t,r),this.attachment=t,this.type=dR.COLOR}}class mR extends pR{constructor(){super(...arguments),this.type=dR.DEPTH}}var gR=r(89179);class yR extends hR{constructor(e,t,r,i,n,s){super(e,s),this.type=dR.FBO,this._colors=new Map,this._name="composite-color",this.acquireDepth=null,this.acquireColor=null,this._name=t,this.fbo=r,this.acquireDepth=i,this.acquireColor=n}dispose(){this.fbo?.dispose()}get usedMemory(){return this.fbo?.usedMemory||0}get name(){return this._name}setName(e){this._name=e}getTexture(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Aa.Nm.COLOR_ATTACHMENT0;return e===Aa.nI?this.fbo?.depthStencilTexture:this.fbo?.getColorTexture(e)}getAttachment(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Aa.Nm.COLOR_ATTACHMENT0;return e===Aa.nI?this._depth:this._colors.get(e)}attachDepth(e){return e?.retain(),this.detachDepth(),e&&this.fbo?.attachDepthStencil(e.attachment),this._depth=e,this}detachDepth(){this.fbo?.detachDepthStencilTexture(),this.fbo?.detachDepthStencilBuffer(),this._depth=(0,Je.Gz)(this._depth)}obtainDepthTexture(){const e=this._depth;return function(e){return e?.attachment.type===gR.p.Texture}(e)?(this.fbo?.detachDepthStencilTexture(),this._depth=null,e):null}attachColor(e,t){return e.retain(),this.detachColor(t),this.fbo?.attachColorTexture(e.attachment,t),this._colors.set(t,e),this}detachColor(e){this.fbo?.detachColorTexture(e);const t=this._colors.get(e);this._colors.delete(e),t?.release()}detachAll(){this._colors.forEach(((e,t)=>this.detachColor(t))),this.detachDepth()}}class _R{constructor(e,t){this._last=new Ty.A,this._incarnation=0,this._cache=new Ww.I(e,t)}destroy(){this._last?.forAll((e=>e.dispose())),this._last=null,this._cache.destroy()}set interactive(e){e&&!this._last?this._last=new Ty.A:e||(this._last?.forAll((e=>e.dispose())),this._last=null)}clean(){this._last?.filterInPlace((e=>!(e.incarnation<this._incarnation)||(this._cache.put(e.key,e),!1)))}frame(){++this._incarnation}pop(e){if(this._last){const t=this._last.find((t=>t.key===e));if(t)return this._last.removeUnordered(t),t}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){return this._last?.reduce(((e,t)=>e+t.usedMemory),0)??0}}var vR=r(62881);class bR{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new _R(e.newCache,"FBOCache"),this._depthCache=new _R(e.newCache,"DepthAttachmentCache"),this._colorCache=new _R(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback&&this.debugCallback()}frameEnd(){const e=this.debugCallback;e&&this._acquired.forEach((t=>t.type===dR.FBO&&e(t.name,t.fbo)))}get usedMemory(){return Array.from(this._acquired.values()).reduce(((e,t)=>e+("getTexture"in t?t.getTexture()?.usedMemory??0:t.usedMemory)),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:La.N.RGBA;const n=xR(i,e,t);let s=this._cache.pop(n);if(s){s.retain(),s.setName(r);const e=this.rctx.getBoundFramebufferObject();this.rctx.bindFramebuffer(s.fbo),this.rctx.setDrawBuffers([Aa.Nm.COLOR_ATTACHMENT0]),this.rctx.bindFramebuffer(e)}else s=new yR(n,r,new nl.H(this.rctx,{...PR[i],width:e,height:t}),(e=>{e??=La.z.DEPTH_STENCIL_TEXTURE;const t=this._acquireDepth(e,s.fbo.width,s.fbo.height,`${s.name} depth`);return s.attachDepth(t),t.release(),s}),((r,i)=>{i??=La.N.RGBA;const n=this._acquireColor(i,e,t,`${s.name} color ${r}`);return s.attachColor(n,r),n.release(),s}),(()=>{this.debugCallback&&this.debugCallback(s.name,s.fbo),this._acquired.delete(s),s.detachAll(),this._cache.put(s)}));return this._trackHandle(s)}acquireDepth(e,t,r,i){return this._acquireDepth(e,t,r,i)}_acquireDepth(e,t,r,i){const n=xR(e,t,r),s=this._depthCache.pop(n);if(s)return s.retain(),s.name=i,this._trackHandle(s);const o=e===La.z.DEPTH_STENCIL_TEXTURE?new mR(n,new Pl.g(this.rctx,{...IR[e],width:t,height:r}),(()=>{this._acquired.delete(o),this._depthCache.put(o)})):new mR(n,new vR.l(this.rctx,{...IR[e],width:t,height:r}),(()=>{this._acquired.delete(o),this._depthCache.put(o)}));return o.name=i,this._trackHandle(o)}_acquireColor(e,t,r,i){const n=xR(e,t,r),s=this._colorCache.pop(n);if(s)return s.retain(),s.name=i,this._trackHandle(s);const o=new fR(n,new Pl.g(this.rctx,{...PR[e],width:t,height:r}),(()=>{this._acquired.delete(o),this._colorCache.put(o)}));return o.name=i,this._trackHandle(o)}_trackHandle(e){return this._acquired.add(e),e}}const wR=new yR("default","default",null,(()=>wR),(()=>wR),(()=>{}));function xR(e,t,r){return`${e}x${t}x${r}`}const SR=new sl.R;SR.pixelFormat=Aa.Ab.RED,SR.internalFormat=Aa.H0.R8,SR.wrapMode=Aa.pF.CLAMP_TO_EDGE;const TR=new sl.R;TR.pixelFormat=Aa.Ab.RG,TR.internalFormat=Aa.H0.RG8,TR.wrapMode=Aa.pF.CLAMP_TO_EDGE;const MR=new sl.R;MR.internalFormat=Aa.H0.RGBA4,MR.dataType=Aa.ld.UNSIGNED_SHORT_4_4_4_4,MR.wrapMode=Aa.pF.CLAMP_TO_EDGE;const AR=new sl.R;AR.wrapMode=Aa.pF.CLAMP_TO_EDGE;const CR=new sl.R;CR.wrapMode=Aa.pF.CLAMP_TO_EDGE,CR.samplingMode=Aa.Cj.LINEAR_MIPMAP_LINEAR,CR.hasMipmap=!0,CR.maxAnisotropy=8;const ER=new sl.R;ER.pixelFormat=Aa.Ab.RED,ER.dataType=Aa.ld.HALF_FLOAT,ER.internalFormat=Aa.H0.R16F,ER.samplingMode=Aa.Cj.NEAREST;const RR=new sl.R;RR.dataType=Aa.ld.HALF_FLOAT,RR.internalFormat=Aa.H0.RGBA16F,RR.samplingMode=Aa.Cj.NEAREST;const PR={[La.N.RED]:SR,[La.N.RG]:TR,[La.N.RGBA4]:MR,[La.N.RGBA]:AR,[La.N.RGBA_MIPMAP]:CR,[La.N.R16F]:ER,[La.N.RGBA16F]:RR},OR=new sl.R;OR.pixelFormat=Aa.Ab.DEPTH_STENCIL,OR.dataType=Aa.ld.UNSIGNED_INT_24_8,OR.samplingMode=Aa.Cj.NEAREST,OR.wrapMode=Aa.pF.CLAMP_TO_EDGE;const IR={[La.z.DEPTH_STENCIL_TEXTURE]:OR,[La.z.DEPTH16_BUFFER]:new uM.q(Aa.yQ.DEPTH_COMPONENT16,4)};var LR,NR=r(89712),DR=r(10773);!function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"}(LR||(LR={}));class FR{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:LR.FrontToBack;this._rctx=e,this._techniques=t,this._sorting=r,this._draws=new Ty.A({initialSize:32,allocator:e=>e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,t,r,i){const n=this._draws.pushNew();n.geometry=t,n.geometryRanges=r,n.material=e,n.depthSquaredHint=i,n.indexType=(t.indexed?t.vao.indexBuffer.indexType:null)??0}prepare(e,t){return this._draws.map((r=>r.material.prepareTechnique(this._techniques,e,t,r.geometry.parameters)))}dispatch(e,t,r){const i=this._rctx;this._previouslyBoundDraw.clear();let n=null;const s=this._draws.length;for(let o=0;o<s;o++){const s=r[o];s===n&&s.configuration.transparencyPassType===DR.y.NONE||(i.bindTechnique(s,t,e),n=s);const a=this._draws.data[o],l=a.geometry;i.bindVAO(l.vao),this._previouslyBoundDraw.get(s)!==a.material&&(s.program.bindDraw(a.material,t,e),this._previouslyBoundDraw.set(s,a.material));const c=a.geometryRanges,u=c.length;if(0!==a.indexType){const e=kR.get(a.indexType);for(let t=0;t<u;t+=2){const r=c[t],n=c[t+1];i.drawElements(l.primitiveType,n,a.indexType,r*e)}}else for(let e=0;e<u;e+=2){const t=c[e],r=c[e+1];i.drawArrays(l.primitiveType,t,r)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===LR.FrontToBack?1:-1;this._draws.sort(((t,r)=>{const i=e*(t.depthSquaredHint-r.depthSquaredHint);return 0!==i?i:t.geometry.vao.byteSize-r.geometry.vao.byteSize}))}get count(){return this._draws.length}}const kR=new Map;kR.set(Aa.pe.UNSIGNED_BYTE,1),kR.set(Aa.pe.UNSIGNED_SHORT,2),kR.set(Aa.pe.UNSIGNED_INT,4);var zR=r(77845);let UR=class extends yc.tI{constructor(){super({}),this._passes=null,this.produces=new Map([[_c.N.OPAQUE_MATERIAL,e=>this._produces(e)],[_c.N.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[_c.N.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new NR.Dh,this._shadowPassParameters=new NR.kR,this._highlightPassParameters=new NR.eF,this._viewshedPassParameters=new NR.d0,this._systems=new Set}initializeRenderContext(e){this._context=e;const t=e.renderContext.rctx,r=e.techniques;this._passes={materialOpaque:new FR(t,r),materialTransparent:new FR(t,r,LR.BackToFront),materialIntegratedMesh:new FR(t,r),shadowMap:new FR(t,r),highlight:new FR(t,r),highlightIntegratedMesh:new FR(t,r),highlightShadowMap:new FR(t,r),viewshedShadowMap:new FR(t,r),defaultShadowMap:new FR(t,r)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return 0!==this._systems.size&&null!==this._passes&&(e===oS.V.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==oS.V.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(0!==this._systems.size&&null!==this._passes){for(const e of Object.values(this._passes))e.prepareSubmit();this._systems.forEach((t=>t.submit(this._passes,e.bindParameters)));for(const e of Object.values(this._passes))e.finishSubmit();this._context.techniques.frameUpdate()}}prepareTechniques(e){if(0===this._systems.size)return null;const t=e.output===oS.V.Shadow||e.output===oS.V.ShadowHighlight||e.output===oS.V.ShadowExcludeHighlight?this._shadowPassParameters:e.output===oS.V.ViewshedShadow?this._viewshedPassParameters:e.output===oS.V.Highlight?this._highlightPassParameters:this._materialPassParameters,r=e.bindParameters;return this._updateParameters(r.camera,t,r.slot===_c.N.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,((t,r)=>t.prepare(r,e.bindParameters)))}renderNode(e,t){this._invoke(e,((r,i)=>r.dispatch(i,e.bindParameters,t)))}_invoke(e,t){if(null===this._passes)return null;switch(e.bindParameters.slot){case _c.N.OPAQUE_MATERIAL:switch(e.output){case oS.V.Color:case oS.V.Depth:case oS.V.Normal:case oS.V.ObjectAndLayerIdColor:return t(this._passes.materialOpaque,this._materialPassParameters);case oS.V.Highlight:return t(this._passes.highlight,this._highlightPassParameters);case oS.V.Shadow:return t(this._passes.shadowMap,this._shadowPassParameters);case oS.V.ShadowHighlight:return t(this._passes.highlightShadowMap,this._shadowPassParameters);case oS.V.ShadowExcludeHighlight:return t(this._passes.defaultShadowMap,this._shadowPassParameters);case oS.V.ViewshedShadow:return t(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;case _c.N.TRANSPARENT_MATERIAL:switch(e.output){case oS.V.Color:case oS.V.Depth:case oS.V.Normal:case oS.V.ObjectAndLayerIdColor:return t(this._passes.materialTransparent,this._materialPassParameters)}break;case _c.N.INTEGRATED_MESH:switch(e.output){case oS.V.Color:case oS.V.Depth:case oS.V.Normal:case oS.V.ObjectAndLayerIdColor:return t(this._passes.materialIntegratedMesh,this._materialPassParameters);case oS.V.Highlight:return t(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const t=new dC;return this._systems.forEach((r=>mC(t,r.queryShadowCasterDepthRange(e)))),t}_updateParameters(e,t,r){const i=e.viewInverseTransposeMatrix;(0,da.s)(VR,i[3],i[7],i[11]),jR.set(VR),(0,da.c)(t.transformWorldFromViewTH,jR.high),(0,da.c)(t.transformWorldFromViewTL,jR.low),(0,da.c)(t.slicePlaneLocalOrigin,VR),(0,Za.z0)(t.transformViewFromCameraRelativeRS,e.viewMatrix),(0,$a.C)(t.transformProjFromView,e.projectionMatrix),t.identifier===NR.zq.Material&&(this._materialPassParameters.transparent=r,(0,Za.mg)(BR,t.transformViewFromCameraRelativeRS),(0,Za.B8)(t.transformNormalViewFromGlobal,BR))}};UR=(0,ze._)([(0,tt.$)("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],UR);const VR=(0,nn.vt)(),BR=(0,Zh.vt)(),jR=new zR.p;var HR=r(98521),GR=r(48353);function ZR(e){return e.name}var $R=r(61678);class qR{constructor(e){this._context=e,this._nodes=new Ty.A}destroy(){this._nodes.forEach((e=>e.destroy())),this._nodes.clear()}add(e){this._nodes.push(e),$R.Ns&&console.log(`Registered render nodes: ${this._nodes.map((e=>{let{declaredClass:t}=e;return t})).join(", ")}`)}remove(e){this._nodes.remove(e),$R.Ns&&console.log(`Registered render nodes: ${this._nodes.map((e=>{let{declaredClass:t}=e;return t})).join(", ")}`)}produces(e){return this._nodes.some((t=>{let{produces:r}=t;return r===e}))}require(e){const t=this._nodes;for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];return i.reduce(((r,i)=>r+t.reduce(((t,r)=>{let{consumes:n,produces:s}=r;return t+(n.required.includes(e)&&s===i?1:0)}),0)),0)}optional(e){const t=this._nodes;for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];return i.reduce(((r,i)=>r+t.reduce(((t,r)=>{let{consumes:n,produces:s}=r;return t+(n.optional?.includes(e)&&s===i?1:0)}),0)),0)}updateAnimation(){return this._nodes.reduce(((e,t)=>t.updateAnimation()||e),!1)}render(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const i=ZR(e)?e.name:e,n=this._nodes.filter((e=>{let{produces:t}=e;return t===i}));return 0===n.length||(n.forEach((n=>{const s=ZR(e)?[e]:[];for(const e of n.consumes.required){if(e===i)continue;const n=t.get(e);if(!n)return void(r&&r(s));s.push(n)}if(n.consumes.optional)for(const e of n.consumes.optional){if(e===i)continue;const r=t.get(e);r&&s.push(r)}try{const r=n.doRender(s,this._context);r&&r!==e&&(ZR(e)?(e.release(),e=r,t.set(i,e)):e=r)}catch(o){Xe.A.getLogger(n).errorOnce(o)}r&&r(s)})),this._context.rctx.enforceState()),ZR(e)?e:wR}}class WR{constructor(e){this._context=e,this._renderPlugins=new Ty.A,this._materialRenderers=new Map,this._slots=new Array,this._renderVersion=(0,Fb.v)(0);for(let t=0;t<_c.N.MAX_SLOTS;++t)this._slots[t]=[]}destroy(){this._renderPlugins.forEach((e=>e.destroy())),this._renderPlugins.clear(),this._materialRenderers.clear()}get plugins(){return this._renderPlugins}add(e,t){const r=()=>{if(t?.aborted)throw e.uninitializeRenderContext(),(0,Ke.NK)();this._renderPlugins.push(e),e.materialReference&&this._materialRenderers.set(e.materialReference,e),e.produces.forEach(((t,r)=>{this._slots[r].push(e)})),this._context.requestRender(),this._renderVersion.value++},i=e.initializeRenderContext(this._context,t);if((0,Ke.$X)(i))return i.then(r);r()}remove(e){if(null!=e.materialReference&&this._materialRenderers.delete(e.materialReference),null!=this._renderPlugins.removeUnordered(e)){for(let t=0;t<this._slots.length;++t)this._slots[t]=this._slots[t].filter((t=>t!==e));e.uninitializeRenderContext(),this._context.requestRender(),this._renderVersion.value++}}prepareRender(){this._renderPlugins.forAll((e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)}))}updateAnimation(e){let t=!1;return this._renderPlugins.forAll((r=>{r.updateAnimation&&(t=r.updateAnimation(e)||t)})),t}renderFeatureChanged(){this._renderPlugins.forAll((e=>{e.renderFeatureChanged&&e.renderFeatureChanged()}))}prepare(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const i of t)this._context.renderContext.bindParameters.slot=i,this._slots[i].forEach((e=>{const t=e.produces.get(i);t?.(oS.V.Color)&&((0,yc.zo)(e)&&e.prepareTechnique(this._context.renderContext),(0,yc.ss)(e)&&e.prepareTechniques(this._context.renderContext))}))}_getRenderables(){const e=this._context.renderContext.bindParameters.slot,t=this._context.renderContext.output??oS.V.Color,r=new Map;return this._slots[e].forEach((i=>{const n=i.produces.get(e);if(n?.(t)&&(!i.isDecoration||this._context.renderContext.bindParameters.decorations!==hx.ID.OFF))if((0,yc.zo)(i)){const e=i.prepareTechnique(this._context.renderContext);null!=e&&r.set(i,e)}else if((0,yc.ss)(i)){const e=i.prepareTechniques(this._context.renderContext);null!=e&&r.set(i,e)}else r.set(i,null)})),r}render(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(const n of r)this._context.renderContext.bindParameters.slot=n,this._getRenderables().forEach(((t,r)=>r.renderNode(this._context.renderContext,t,e)))}queryDepthRange(e){const t=new dC;return this._renderPlugins.forAll((r=>{const i=r.queryDepthRange?.(e);mC(t,i)})),t}get updating(){return this._renderVersion.value>=0&&this._renderPlugins.some((e=>e.running))}produces(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(const n of r)if(this._slots[n].some((t=>{const r=t.produces.get(n);return!!r&&r(e)})))return!0;return!1}consumes(e){return this._renderPlugins.some((t=>t.consumes().required.includes(e)))}getMaterialRenderer(e){return this._materialRenderers.get(e)}removeEmptyMaterialRenderers(){this._renderPlugins.filterInPlace((e=>!e.materialReference||0!==e.numGeometries||(this._materialRenderers.delete(e.materialReference),e.destroy(),!1)))}get hasDecorations(){return this._renderPlugins.some((e=>e.isDecoration))}get hasOccludees(){return this._renderPlugins.some((e=>e.hasOccludees))}get renderOccludedFlags(){return this._renderPlugins.reduce(((e,t)=>e|t.renderOccludedFlags),px.m$.None)}get usedMemory(){return this._renderPlugins.reduce(((e,t)=>null!==t.materialReference?e:e+(t.usedMemory??0)),0)}get test(){}}class YR{constructor(e){this.techniques=e,this._blitConfiguration=new IE,this._blitParameters=new OE.C}render(e,t,r,i,n){e.bindFramebuffer(r.fbo);const s=this.techniques.acquire(LE,this._blitConfiguration);return e.setClearColor(0,0,0,1),e.clear(Aa.hn.COLOR_BUFFER_BIT),s?.compiled?(this._blitParameters.texture=t.getTexture(),e.bindTechnique(s,i,this._blitParameters),e.screen.draw(),s.release(),r):(n(hx.C7.UPDATE),r)}}class XR{constructor(){this._step=rP,this._dilation=1,this._firstIdleTime=(0,ql.l5)(0)}frame(e,t){if(t?0===this._firstIdleTime&&(this._firstIdleTime=(0,ql.l5)(performance.now())):this._firstIdleTime=(0,ql.l5)(0),(0,it.A)("disable-feature:high-quality-idle"))this._dilation=1;else{const e=t?performance.now()-this._firstIdleTime:0;if(e>=KR+QR)return this._step=(0,ql.l5)(1/0),void(this._dilation=1);this._dilation=e>=KR?eP:1}const r=(0,ws.qE)(e/JR,rP,iP);this._step===1/0?this._step=(0,ql.l5)(r):this._step=(0,ql.l5)(this._step*tP+r*(1-tP))}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=(0,ql.l5)(0)}}const JR=.5,KR=(0,ql.l5)(12e4),QR=(0,ql.l5)(1e4),eP=10,tP=.9,rP=(0,ql.l5)(1e3),iP=(0,ql.l5)(1e3/30);var nP=r(85086);class sP{constructor(e,t){this._fbos=e,this.compositingHelper=t,this._width=4,this._height=4,this._clearColor=(0,ya.vt)()}dispose(){this._color=(0,Je.Gz)(this._color),this.releaseBuffers()}get framebuffer(){return this.color.attachDepth(this.depth),this.color.fbo}get colorTexture(){return this.color.getTexture()}get depthTexture(){return this.depth.attachment}initializeFrame(e,t,r){this._fbos.interactive=r===dm.fS.Default;const i=this._fbos.rctx;this._width=e.fullWidth,this._height=e.fullHeight,(0,nl.T)(this,i.parameters.maxTextureSize);const n=this._color;return this._color=null,this.releaseBuffers(),(0,ga.c)(this._clearColor,t),n}releaseBuffers(){this._color?.detachDepth(),this._depth=(0,Je.Gz)(this._depth)}renderHUDVisibility(e,t,r){return e?.fbo?.width===this._width&&e?.fbo?.height===this._height||(e?.release(),e=this._fbos.acquire(this._width,this._height,"hud visibility",La.N.RGBA4)),e.attachDepth(r||this.depth),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(oP),t(),e.detachDepth(),e}compositeToHUDVisibility(e,t){this._fbos.rctx.bindFramebuffer(e.hudVisibility?.fbo),this.compositingHelper.compositeHUD(e,t)}renderOITPass(e,t,r){let i,n;const{_width:s,_height:o}=this;switch(t){case DR.y.ColorAlpha:i=this._fbos.acquire(s,o,r?"oit hud color alpha":"oit color alpha",La.N.RGBA16F),i.acquireColor(Aa.Nm.COLOR_ATTACHMENT1,La.N.R16F),n=[0,0,0,1];break;case DR.y.FrontFace:i=this._fbos.acquire(s,o,r?"oit hud front":"oit front"),n=[0,0,0,0]}return r?i.acquireDepth(La.z.DEPTH16_BUFFER):i.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(i.fbo),this._fbos.rctx.clearFramebuffer(n,r,r),e(),i.detachDepth(),i}compositeToFramebuffer(e,t,r,i){this.bindFbo(),this.compositingHelper.composite(e,t,r,i)}compositeOIT(e,t,r,i){i?(this._fbos.rctx.bindFramebuffer(i.fbo),this._fbos.rctx.setClearColor(0,0,0,1e-13),this._fbos.rctx.clear(Aa.hn.COLOR_BUFFER_BIT)):this.bindFbo(),this.compositingHelper.compositeOIT(e,t.getTexture(),t.getTexture(Aa.Nm.COLOR_ATTACHMENT1),r.getTexture())}renderDepthDetached(e){this._bindTarget(this.color),e(),this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:La.N.RGBA,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:La.z.DEPTH16_BUFFER,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this._width,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:this._height,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;return e?.fbo?.width===o&&e?.fbo?.height===a||(e=(0,Je.Gz)(e)),e=e??this._fbos.acquire(o,a,t,n),l?.forEach((t=>e.acquireColor(t.attachment,t.format))),null!=s&&e.acquireDepth(s),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(i,!0,!0),r(),e}renderToTargets(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this._bindTarget(t,r),this._fbos.rctx.clearFramebuffer(i,n,s),e(),t.detachDepth()}bindFbo(){const e=null==this._color;if(this._bindTarget(this.color,this.depth),e){const e=this._fbos.rctx;e.setClearStencil(0),e.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),e.clear(Aa.hn.COLOR_BUFFER_BIT|Aa.hn.DEPTH_BUFFER_BIT|Aa.hn.STENCIL_BUFFER_BIT)}}_bindTarget(e,t){e.attachDepth(t),this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._ensureColor()}_ensureColor(){return this._color||(this._color=this._fbos.acquire(this._width,this._height,"composite-color")),this._color}updateColor(e){const t=this._ensureColor();t.attachDepth(this.depth),this._color=e(t)}get depth(){return this._depth||(this._depth=this._fbos.acquireDepth(La.z.DEPTH_STENCIL_TEXTURE,this._width,this._height,"depth")),this._depth}}const oP=[0,1,0,1];var aP=r(23187);class lP{constructor(){this._inputs=new Map}set(e,t){this._inputs.set(e,t)}get(e){return this._inputs.get(e)}has(e){return this._inputs.has(e)}release(e){this._inputs.get(e)?.release()&&this._inputs.delete(e)}}var cP=r(99604),uP=r(60322);class hP extends Sa.w{constructor(e,t){super(e,t,(()=>this.destroy()))}initializeProgram(e){return new Ma.B(e.rctx,hP.shader.get().build(this.configuration),Ta.D)}initializePipeline(){return(0,Ca.Ey)({blending:uP.V0,colorWrite:Ca.wE,depthTest:null,depthWrite:null})}get primitiveType(){return Aa.WR.TRIANGLE_STRIP}}hP.shader=new xa.$(cP.a,(()=>r.e(7874).then(r.bind(r,37874))));var dP=r(50578);const pP=1/512;let fP=class extends ht.A{constructor(e,t,r,i){super({}),this._techniques=e,this._rctx=t,this._data=r,this._requestRender=i,this._passParameters=new cP.S(this._data),this._techniqueConfig=new dP.q,this._enabled=!1,this._vao=(0,Da.Q)(t)}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=(0,Je.WD)(this._vao),this._techniques.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniques.releaseAndAcquire(hP,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const t=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,e,this._passParameters),this._rctx.drawArrays(t.primitiveType,0,(0,Ol.mT)(this._vao,"geometry"))}setOptions(e){void 0!==e.enabled&&this._setEnabled(e.enabled),void 0!==e.color&&this._setColor(e.color),void 0!==e.threshold&&(this._threshold=e.threshold),void 0!==e.visualization&&(this._visualization=e.visualization),void 0!==e.bandSize&&(this._bandSize=e.bandSize),void 0!==e.bandsEnabled&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>pP}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniques.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniques.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;(0,ga.a)(e,t)||((0,ga.c)(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};(0,ze._)([(0,Qe.MZ)()],fP.prototype,"opacityFromElevation",null),fP=(0,ze._)([(0,tt.$)("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],fP);var mP=r(90877),gP=r(59922);class yP extends Sa.w{constructor(e){super(e,new uE,(()=>this.destroy()))}initializeProgram(e){return new Ma.B(e.rctx,yP.shader.get().build(this.configuration),Ta.D)}initializePipeline(){return(0,Ca.Ey)({blending:(0,Ca.p3)(Aa.dn.ONE,Aa.dn.ONE,Aa.dn.ONE,Aa.dn.ONE),colorWrite:Ca.wE,depthTest:null,depthWrite:null})}get primitiveType(){return Aa.WR.TRIANGLE_STRIP}}yP.shader=new xa.$(gP.a,(()=>r.e(216).then(r.bind(r,50216))));let _P=class extends ht.A{constructor(e,t,r,i,n,s){super({}),this.fbos=e,this._stage=r,this._prepareForShadowMapPass=i,this._renderToShadowMap=n,this._requestRender=s,this._progress=0,this._sampleCount=0,this._passParameters=new cE.QR,this._cachedLightDirections=[],this._depthRange=yC,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new al.k(new mP.p(e,r.viewingMode),null),this._bindParameters.shadowMap.enabled=!0,this._vao=(0,Da.Q)(this._rctx),this._accumulationRenderer=new fP(t,this._rctx,this,s);const o=this._stage.view.resourceController.scheduler;this.addHandles([o.registerTask(ll.W6.SHADOW_ACCUMULATOR,this),(0,gt.wB)((()=>r.renderView),(e=>{this.removeHandles(bP),null!=e&&this.addHandles(e.events.on("force-camera-for-screenshot",(()=>this._cameraForcedForScreenshot=!0)),bP)}),gt.pc),(0,gt.wB)((()=>this._previewing),(()=>this._requestRenderIfEnabled()),gt.OH)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=(0,Je.WD)(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=(0,Je.WD)(this._fbo),this._vao=(0,Je.WD)(this._vao),this._accumulationTechniqueCached=(0,Je.Gz)(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(null==this._accumulationTechniqueCached){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new yP(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return null!=this._fbo&&this._sampleCount>0}get canAccumulate(){return null!=this._bindParameters.depth&&this._depthRange!==yC&&this._opacityFromElevation>pP}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if((0,Dt.aI)(t,e,da.G))return;const r=Math.min(gP.S,e.length);t.length=r,this._sampleCount=r;for(let i=0;i<r;++i)t[i]=(0,da.c)(t[i]??(0,nn.vt)(),e[i]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,r,i){if(this._depthRange=t,this._updateCamera(r),this._bindParameters.contentCamera=i,this._bindParameters.depth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return!1;(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(vP,this._sampleCount-this._progress);for(let s=0;s<n;++s)this._accumulateShadow();return this._cameraForcedForScreenshot=!1,this._requestRender(),n>0}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(void 0!==e.enabled){const t=null!=this._fbo;e.enabled!==t&&(e.enabled?this._enable():this._disable())}void 0!==e.previewing&&(this._previewing=e.previewing),void 0!==e.lightDirections&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,t){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||t<0||t>=this._fbo.height?0:(this._fbo.readPixels(e,t,1,1,Aa.Ab.RGBA,Aa.ld.UNSIGNED_BYTE,wP),wP[0]/this._progress)}_enable(){this._progress=0;const e=new sl.R;e.pixelFormat=Aa.Ab.RED,e.internalFormat=Aa.H0.R8,e.wrapMode=Aa.pF.CLAMP_TO_EDGE,this._fbo=new nl.H(this._rctx,e),this._requestRender()}_disable(){this._fbo=(0,Je.WD)(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clear(Aa.hn.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,(0,Ol.mT)(this._vao,"geometry"))}_updateCamera(e){const t=this._fbo;if(null==t)return;const r=this._bindParameters.camera;e.equals(r)||r.copyFrom(e),t.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-(0,ws.TF)(4e4,5e4,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};(0,ze._)([(0,Qe.MZ)()],_P.prototype,"_progress",void 0),(0,ze._)([(0,Qe.MZ)()],_P.prototype,"_sampleCount",void 0),(0,ze._)([(0,Qe.MZ)()],_P.prototype,"_fbo",void 0),(0,ze._)([(0,Qe.MZ)()],_P.prototype,"_depthRange",void 0),(0,ze._)([(0,Qe.MZ)()],_P.prototype,"_previewing",void 0),(0,ze._)([(0,Qe.MZ)()],_P.prototype,"_accumulationRenderer",void 0),(0,ze._)([(0,Qe.MZ)()],_P.prototype,"_isRefining",null),(0,ze._)([(0,Qe.MZ)()],_P.prototype,"_isActive",null),(0,ze._)([(0,Qe.MZ)()],_P.prototype,"canAccumulate",null),(0,ze._)([(0,Qe.MZ)()],_P.prototype,"_isDoneAccumulating",null),(0,ze._)([(0,Qe.MZ)()],_P.prototype,"_opacityFromElevation",null),(0,ze._)([(0,Qe.MZ)()],_P.prototype,"running",null),_P=(0,ze._)([(0,tt.$)("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],_P);const vP=6,bP="renderView",wP=new Uint8Array(4),xP=(0,hn.a)();class SP{constructor(){this._plane=(0,hn.a)()}get isEnabled(){return!(0,hn.d)(this.plane,xP)}get plane(){return this._plane}set plane(e){(0,hn.c)(e||xP,this._plane)}}var TP=r(92290),MP=r(46702),AP=r(74964),CP=r(32634);class EP{constructor(e,t,r,i,n,s,o,a,l){this.createQuery=e,this.deleteQuery=t,this.resultAvailable=r,this.getResult=i,this.disjoint=n,this.beginTimeElapsed=s,this.endTimeElapsed=o,this.createTimestamp=a,this.timestampBits=l}}let RP=!1;class PP{constructor(e,t){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,t.forEach((e=>{const t=this._timer.createQuery(),r=this._timer.createQuery();this._queryPool.push(t,r),this._queryResults.set(e,null)}))}start(){RP||(this._currentQuery=this._queryPool.pop(),null!=this._currentQuery&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||null==this._currentQuery||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const t=this._queryResults.get(e);if(null==t)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(t))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(t)/1e6;return this._queryPool.unshift(t),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){null!=this._currentQuery&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){null!=this._currentQuery&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach((e=>{this._timer.deleteQuery(e)})),this._queryResults.forEach((e=>{null!=e&&this._timer.deleteQuery(e)}))}}var OP;!function(e){e.OVERLAY="overlay",e.PREPARE="prepare",e.SHADOW_MAP="shadow map",e.DEPTH="depth",e.ACCUMULATED_SHADOWS="accumulated shadows",e.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",e.NORMALS="normals",e.SSAO="SSAO",e.OPAQUE_EDGES="opaque edges",e.VOXEL="voxel",e.TRANSPARENT="transparent",e.TRANSPARENT_EDGES="transparent edges",e.HUD_VISIBILITY="HUD visibility",e.TRANSPARENT_TERRAIN="transparent terrain",e.OPAQUE_ENVIRONMENT="opaque environment",e.TRANSPARENT_ENVIRONMENT="transparent environment",e.LASER_LINES="laser lines",e.VIEWSHED="viewshed",e.OCCLUDED="occluded",e.HUD="HUD",e.HUD_OCCLUDED="HUD occluded",e.FINISH="finish"}(OP||(OP={}));const IP=Object.values(cR).concat(Object.values(uR)).concat(Object.values(OP)),LP="Total";class NP{constructor(e){this._rctx=e,this._startTimeStampCPU=(0,ql.l5)(0),this._lastTimeStampCPU=(0,ql.l5)(0),this._totalCPUTime=new CP.A(LP),this._cpuTimeSamplers=new Map(IP.map((e=>[e,new CP.A(e)]))),this._enableGPUTimer=0,this._totalGPUTime=new CP.A("GPU"),this._gpuTimeSamplers=new Map(IP.map((e=>[e,new CP.A(e)]))),this._totalTime=(0,ql.l5)(0),this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return null!=this._gpuTimerPool}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return(0,ql.l5)(performance.now()-this._startTimeStampCPU)}enableGPUPerformanceInfo(){if(null==this._gpuTimerPool){const e=[...IP,LP];this._gpuTimerPool=function(e,t){const r=e.capabilities.disjointTimerQuery;return null==r?null:new PP(r,t)}(this._rctx,e)}if(null==this._gpuTimerPool)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,0===this._enableGPUTimer&&(this._gpuTimerPool=(0,Je.WD)(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=(0,ql.l5)(performance.now()),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(e){const t=(0,ql.l5)(performance.now());if(this._cpuTimeSamplers.get(e).record(t-this._lastTimeStampCPU),this._lastTimeStampCPU=t,this._gpuTimerPool){const t=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(t),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const e=this._gpuTimerPool.stop(OP.FINISH);this._gpuTimeSamplers.get(OP.FINISH).record(e),this._rctx.gl.flush()}const e=(0,ql.l5)(performance.now()-this._startTimeStampCPU);this._totalTime=(0,ql.l5)(this._totalTime+e),this._totalCPUTime.record(e),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce(((e,t)=>e+(t.last||0)),0)),++this._totalFrameCount}}class DP{constructor(e,t,r,i,n,s){this._stage=e,this._techniques=r,this._rctx=i,this._compositingHelper=n,this._requestRender=s,this._pluginsHas={hudElements:!1,water:!1},this._hasOverlayWater=!1,this.renderOverlay=e=>{},this._isRendering=!1,this._inGlobeView=!1,this._backgroundColor=(0,ya.fA)(0,0,0,1),this._sliceHelper=new SP,this._blit=null,this._state=(0,Fb.v)(fm.M.IDLE),this._highQualityTransparencyEnabled=!0,this._terrainTransparency=$M.Opaque,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new XR,this._loadEdgeViewTask=null,this._edgeViewCallbacks=[],this._reprojectionMatrixVersion=(0,Fb.v)(0),this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new lP,this._releaseNormals=e=>{e.some((e=>{let{name:t}=e;return"normals"===t}))&&this._pluginInput.release("normals")},this._debugNeedsDepth=!1,this.fboCache=new bR(i),this._renderStateFeatures=(0,Fb.v)((0,pm.u)(!(0,it.A)("disable-feature:high-quality-idle"),e.view.qualityProfile)),this._offscreen=new sP(this.fboCache,this._compositingHelper),this.performanceInfo=new NP(this._rctx),this._shadowMap=new mP.p(this.fboCache,e.viewingMode),this._viewshed=new TP.S({fboCache:this.fboCache,view:e.view},((e,t,r)=>{t.setGLViewport(this._rctx);const{camera:i,contentCamera:n}=e;this._ensureBindParametersCamera(t,t),this._renderAllGeometry(r),this._ensureBindParametersCamera(i,n),e.camera.setGLViewport(this._rctx)})),this._shadowAccumulator=new _P(this.fboCache,r,e,(e=>{const t=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(e.camera,e.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=t}),((e,t,r)=>{const i=this._stage.view.qualitySettings.maximumPixelRatio;e.shadowMap.start(e.camera,t,r,!0,i),this._renderShadowCascades(oS.V.Shadow,e.shadowMap),e.shadowMap.finish(),e.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(e.camera,e.contentCamera)}),s),this._renderContext=new aP.AZ(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper),this._nodes=new qR(this._renderContext),this._plugins=new WR({renderContext:this._renderContext,techniques:r,materials:t,requestRender:s,controller:e,fbos:this.fboCache,isFeatureEnabled:e=>this.isFeatureEnabled(e)}),this.renderPassManager=new UR,this._plugins.add(this.renderPassManager),this._plugins.add(this._viewshed),this._handles=[(0,gt.wB)((()=>this._stage.view.state.camera),(()=>s()),gt.pc),(0,gt.wB)((()=>My.b.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES),(e=>{this._renderHiddenTransparentEdges=e?()=>this._renderEdges(MP.x.TRANSPARENT):()=>{},s()}),gt.Vh),(0,gt.wB)((()=>this._stage.view.environment.background?.color),(e=>{const t=e?(0,fa.QP)(e):ya.uY;(0,ga.s)(this._backgroundColor,t[0]*t[3],t[1]*t[3],t[2]*t[3],t[3]),s()}),gt.pc),(0,gt.wB)((()=>this._stage.view.state.camera.relativeElevation),(e=>{this._inGlobeView=(e??1/0)>=GR.b}),gt.pc)]}destroy(){this._handles.forEach((e=>e.remove())),this._gpuTimerHandle=(0,Je.xt)(this._gpuTimerHandle),this._nodes.destroy(),this._offscreen.dispose(),this._shadowMap.dispose(),this._shadowAccumulator.dispose(),this._loadEdgeViewTask=(0,Je.DC)(this._loadEdgeViewTask),this._edgeView=(0,Je.pR)(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),nP.j.prune()}get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!(0,it.A)("disable-feature:high-quality-idle");this._renderStateFeatures.value=(0,pm.u)(t,e),this._plugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._state.value;return this._renderStateFeatures.value.get(t,e)??!1}setFeatureEnabled(e,t,r){this._renderStateFeatures.mutate((i=>i.set(t,e,r))),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(pm.n.HighQualityTransparency)}get hasReflections(){return(this._pluginsHas.water||this._hasOverlayWater)&&(this._ssrEnabled||this.isFeatureEnabled(pm.n.WaterReflection))}get hasDecorations(){return this._plugins.hasDecorations||this._nodes.produces("magnifier-color")}get hasHighlights(){return this._plugins.produces(oS.V.Highlight,_c.N.OPAQUE_MATERIAL,_c.N.TRANSPARENT_MATERIAL,_c.N.DRAPED_MATERIAL)}get hasLaserlines(){return this._plugins.produces(this._renderContext.output,_c.N.LASERLINES,_c.N.LASERLINES_CONTRAST_CONTROL)}get hasSSAO(){return(this._stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(pm.n.SSAO))&&!this._inGlobeView}get hasSMAA(){return this._stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(pm.n.Antialiasing)}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(pm.n.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=(0,Je.Gz)(this._bindParameters.ssr.lastFrameColor),this._bindParameters.multipassTerrain.depth=(0,Je.Gz)(this._bindParameters.multipassTerrain.depth),this._bindParameters.multipassGeometry.depth=(0,Je.Gz)(this._bindParameters.multipassGeometry.depth)}_disposeOffscreenBuffers(){this._offscreen.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._viewshed.viewshedShadowMap.disposeOffscreenBuffers(),this._bindParameters.depth=(0,Je.Gz)(this._bindParameters.depth),this._bindParameters.hudVisibility=(0,Je.Gz)(this._bindParameters.hudVisibility)}get updating(){return null!=this._edgeView&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){return this._loadEdgeViewTask||(this._loadEdgeViewTask=(0,Fn.UT)((async e=>{const{EdgeView:t}=await r.e(1693).then(r.bind(r,31693));(0,Ke.Te)(e);const i=this._edgeView=new t({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:ZP(this._stage.view.resourceController)});return this._handles.push((0,gt.wB)((()=>i.updating),(()=>this._requestRender()),gt.OH)),this._requestRender(),this._edgeViewCallbacks.forEach((e=>e(i))),this._edgeViewCallbacks.length=0,i}))),this._loadEdgeViewTask.promise}withEdgeView(e){this.loadEdgeView(),null==this._edgeView?this._edgeViewCallbacks.push(e):e(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&(0,$a.aI)(this._bindParameters.ssr.reprojectionMatrix,qa.zK)}set _reprojectionMatrix(e){(0,Dt.yo)(this._bindParameters.ssr.reprojectionMatrix,e)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(e){const{_shadowMap:t,_bindParameters:r}=this;if(void 0!==e.qualitySettings?.reflections&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),void 0!==e.shadowMap&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),void 0!==e.shadowMapMaxCascades&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),null!=e.environment){null!=e.environment.weather&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const t="virtual"!==e.environment.lighting.type;r.enableFillLights!==t&&(r.enableFillLights=t,this._requestRender())}void 0!==e.highQualityTransparency&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),void 0!==e.hasOverlayWater&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),void 0!==e.slicePlane&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),void 0!==e.terrainTransparency&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),void 0!==e.shadowCast&&this._shadowAccumulator.setOptions(e.shadowCast)}get hasSlicePlane(){return!!this._sliceHelper.plane}get plugins(){return this._plugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,t){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:i,updates:n}=e;if(0===r.length&&0===i.length&&0===n.length)return;const s=(0,dm.$T)(e);let o=!1;s.forEach(((r,i)=>{if(t.done)return;let n=this._plugins.getMaterialRenderer(i);if(null==n&&r.adds.length>0){const e=new AP.y({material:i});e.initializeRenderContext(this._plugins._context),n=e,this._plugins.add(n)}n&&(n.modify(r),0===n.numGeometries&&(o=!0)),r.removes.forEach((t=>e.removes.removeUnordered(t))),r.adds.forEach((t=>e.adds.removeUnordered(t))),r.updates.forEach((t=>e.updates.removeUnordered(t))),t.madeProgress()})),o&&this._plugins.removeEmptyMaterialRenderers(),this._updateHasFlags(),this._requestRender()}_updateHasFlags(){const e=this._pluginsHas;e.hudElements=this._plugins.produces(oS.V.Color,_c.N.LINE_CALLOUTS_HUD_DEPTH,_c.N.HUD_MATERIAL,_c.N.LABEL_MATERIAL),e.water=this._plugins.produces(oS.V.Normal,_c.N.DRAPED_WATER),this._bindParameters.hasOccludees=this._plugins.hasOccludees}updateAnimation(e){const t=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(e),this._hasAnimations=this._nodes.updateAnimation()||this._hasAnimations,this._hasAnimations!==t&&(this._gpuTimerHandle=t?(0,Je.xt)(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:dm.fS.Default,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:hx.ID.ON;this._isRendering=!0,this.performanceInfo.startFrame(),this.fboCache.frameStart(),this._disposeBindBuffers();const n=this._offscreen,{camera:s,contentCamera:o,mode:a,alignPixelEnabled:l}=e;this._state.value=a,this._bindParameters.overlay=this.renderOverlay(t),this._bindParameters.overlay&&this.performanceInfo.advance(OP.OVERLAY),this._renderContext.time=t,this._bindParameters.transparencyPassType=DR.y.NONE,this._bindParameters.alignPixelEnabled=l,this._bindParameters.decorations=i,this._bindParameters.mainColor=this._bindParameters.mainDepth=null,this._bindParameters.viewshedEnabled=this._viewshed.enabled;const c=this._nodes.produces("magnifier-color"),u=this._nodes.produces("final-color"),h=(0,hn.a)(this._sliceHelper.plane);i===hx.ID.OFF&&(this._sliceHelper.plane=null),s.setGLViewport(this._rctx);const d=n.initializeFrame(s,this._backgroundColor,r);this.hasReflections?this._bindParameters.ssr.lastFrameColor=d:d?.release(),this._ensureBindParametersCamera(s,o),this._plugins.prepareRender(),this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&i===hx.ID.ON;const p=this._plugins.produces(oS.V.Color,_c.N.OPAQUE_TERRAIN)&&(this._terrainTransparency===$M.Semitransparent||this._terrainTransparency===$M.TransparentWithDraped),f=this._highQualityTransparency&&p,m=this._plugins.produces(oS.V.Color,...VP);this._prepareShaders(f,m),this.performanceInfo.advance(OP.PREPARE);const g=this._computeDepthRange(s);this._renderShadowMap(s,this._bindParameters.lighting.mainLight.direction,g),this._ensureBindParametersCamera(s,o);let y=this._renderNormals();if(this._pluginInput.set("normals",y),y){let e=null;this._needsDepth&&(e=y.getAttachment(Aa.nI),e?.retain()),this._pluginInput.set("ssao",this._renderSSAO()),this._renderNoSSAOGeometryDepth(e),y=null}else this._renderAllGeometryDepth();this._renderShadowAccumulation(g,s,o),this._ensureBindParametersSSR(t),this._renderContext.output=oS.V.Color,n.bindFbo(),this._bindParameters.mainColor=n.colorTexture,this._bindParameters.mainDepth=n.depthTexture;const _=this.plugins.produces(oS.V.Color,...UP);_&&this._renderOpaqueGeometry(),this._offscreen.updateColor((e=>this._renderNodes(cR.OPAQUE,e,_))),this.fboCache.debugCallback?.("opaque-color",this._offscreen.color.fbo),this._renderPlugins(_c.N.OPAQUE_ENVIRONMENT,OP.OPAQUE_ENVIRONMENT),this._renderMultipassTerrainDepth(f),this._setMultipassTerrain(f),this._renderEdges(MP.x.OPAQUE),n.bindFbo(),this._renderPlugins(_c.N.VOXEL,OP.VOXEL),this._renderHiddenTransparentEdges(),m&&(this._oitEnabled?this._renderOITPass(FP.Geometry):this._renderTransparentMaterial()),this._offscreen.updateColor((e=>this._renderNodes(cR.TRANSPARENT,e,m))),this.fboCache.debugCallback?.("transparent-color",this._offscreen.color.fbo),this._renderMultipassGeometryDepth(f),this._renderHUDVisibility(),f||this._plugins.render(this._pluginInput,_c.N.LINE_CALLOUTS);const v=r===dm.fS.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;this._renderEdges(MP.x.TRANSPARENT);const b=p?this._renderTransparentTerrain():null;b&&(this.performanceInfo.advance(OP.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&(f?this._renderLineCallouts(HR.D.Occluded):n.compositeToHUDVisibility(this._bindParameters,b.getTexture()),this._renderHUD(HR.D.Occluded,n.color))),this._setTerrainCulling(!1),b&&(n.compositeToFramebuffer(this._bindParameters,b.getTexture(),RE.PremultipliedAlpha,1),b.release(),f&&(this._renderEdges(MP.x.OPAQUE),m&&(this._oitEnabled?this._renderOITPass(FP.Geometry):this._renderTransparentMaterial(),this.performanceInfo.advance(OP.TRANSPARENT)),this._renderEdges(MP.x.TRANSPARENT))),this._bindParameters.ssao=(0,Je.Gz)(this._bindParameters.ssao),f&&this._renderLineCallouts(HR.D.NotOccluded),this._setMultipassEnabled(!1),this._renderTransparentEnvironment(),this._renderViewshed(),this._renderLaserlines(),this._renderOccluded(),this._pluginInput.set("highlights",this._renderHighlightPrepass()),this._offscreen.updateColor((e=>this._renderNodes(cR.COMPOSITE,e)));const w=this._nodes.produces("aa-color"),x=!(r!==dm.fS.Default||u||c&&i===hx.ID.ON&&r===dm.fS.Default),S=this._pluginInput.get("composite-color"),T=x?wR:this.fboCache.acquire(S.fbo.width,S.fbo.height,"aa-color"),M=w?this._renderNodes(uR.ANTIALIASING,T):this._blitToDefault(S,T,!1);this._pluginInput.set(uR.ANTIALIASING,M),this._renderHUD(HR.D.NotOccluded,M);const A=this._renderNodes(uR.HIGHLIGHTS,M);let C=this._renderNodes(uR.MAGNIFIER,A);return c&&i===hx.ID.ON&&r===dm.fS.Default&&!u&&(C=this._blitToDefault(C)),u?(C.attachDepth(n.depth),this._blitToDefault(this._renderNodes(cR.FINAL,C)),C.detachDepth()):this._pluginInput.set(cR.FINAL,C),this._pluginInput.release("highlights"),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),this._offscreen.releaseBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=h,this._isRendering=!1,this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),r!==dm.fS.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),{screen:this._pluginInput.get("final-color"),oid:v}}_prepareShaders(e,t){this._renderContext.output=oS.V.Color,this._prepareOpaqueGeometry(),this._setMultipassTerrain(e),this._plugins.prepare(_c.N.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),e||this._plugins.prepare(_c.N.LINE_CALLOUTS),t&&this._prepareTransparencySlots(),this._plugins.prepare(_c.N.VIEWSHED,_c.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,_c.N.TRANSPARENT_ENVIRONMENT,_c.N.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(){if(!(0,it.A)("enable-feature:objectAndLayerId-rendering"))return;const e=this._renderContext.output,t=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oid");return t.acquireDepth(La.z.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(t.fbo),this.fboCache.rctx.clearFramebuffer([0,0,0,0],!0,!0),this._renderAllGeometry(oS.V.ObjectAndLayerIdColor),this._rctx.bindFramebuffer(t.fbo),this.fboCache.rctx.clearFramebuffer(void 0,!0,!0),this._bindParameters.hudRenderStyle=HR.D.NotOccluded,this._plugins.render(this._pluginInput,_c.N.HUD_MATERIAL),this._renderContext.output=e,this.performanceInfo.advance(OP.OBJECT_AND_LAYER_ID_COLOR),t}finish(e){this._hasAnimations||this._animationTimestep.clear();const t=this.performanceInfo.gpuSamplingEnabled,r=e===hx.C7.BACKGROUND;if(r||t){const e=r?this.performanceInfo.elapsedTime:0,i=t?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),n=Math.max(e,i);this._animationTimestep.frame(n,r)}}readDepthPixels(e,t){if(!this._bindParameters.mainDepth)return;const{width:r,height:i}=this._offscreen,n=this.fboCache.acquire(r,i,"linear-depth");this._rctx.bindFramebuffer(n.fbo),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.clearFramebuffer([0,0,0,0],!0,!0),this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,this._bindParameters.mainDepth),n.fbo?.readPixels(e[0],e[1],e[2],e[3],Aa.Ab.RGBA,Aa.ld.UNSIGNED_BYTE,t),n.release()}readHUDVisibility(e,t,r,i,n){this._bindParameters.hudVisibility?.fbo?.readPixels(e,t,r,i,Aa.Ab.RGBA,Aa.ld.UNSIGNED_BYTE,n)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassTerrain(e){this._setMultipassEnabled(e),this._setTerrainCulling(e)}_setMultipassEnabled(e){this._bindParameters.multipassEnabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderEdges(e){const t=this._edgeView;if(!t?.shouldRender())return;const{width:r,height:i,depth:n}=this._offscreen,s=this.fboCache.acquire(r,i,"edges"),o=this._bindParameters.multipassGeometry.depth;this._offscreen.renderToTargets((()=>t.render(this._bindParameters,e)),s,o??n,zP),this._offscreen.compositeToFramebuffer(this._bindParameters,s.getTexture(),RE.Alpha,1),s.release(),this.performanceInfo.advance(e===MP.x.OPAQUE?OP.OPAQUE_EDGES:OP.TRANSPARENT_EDGES)}_renderShadowMap(e,t,r){const i=this._shadowMap;i.enabled&&(i.start(e,t,r,this.isFeatureEnabled(pm.n.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._needsShadowHighlight?(this._renderShadowCascades(oS.V.ShadowHighlight,this._shadowMap),i.moveSnapshot(mP.z.Highlight),this._renderShadowCascades(oS.V.ShadowExcludeHighlight,this._shadowMap),i.copySnapshot(mP.z.ExcludeHighlight),this._renderShadowCascades(oS.V.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(oS.V.Shadow),i.finish(),e.setGLViewport(this._rctx),this.performanceInfo.advance(OP.SHADOW_MAP))}_renderShadowCascades(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._shadowMap;for(const r of t.cascades)r.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(r.camera,r.camera),this._renderAllGeometry(e)}get _needsDepth(){return this._plugins.consumes(oS.V.Depth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast||this._debugNeedsDepth}_renderNoSSAOGeometryDepth(e){if(!this._needsDepth||!e)return void(this._bindParameters.depth=(0,Je.Gz)(this._bindParameters.depth));const{width:t,height:r}=this._offscreen,i=this.fboCache.acquire(t,r,"depth");i.attachDepth(e),e.release(),this._rctx.bindFramebuffer(i.fbo),this._rctx.clearFramebuffer(void 0,!1,!0),this._renderGeometryExcludedFromSSAO(oS.V.Depth),(0,Je.Gz)(this._bindParameters.depth),this._bindParameters.depth=i.obtainDepthTexture(),i.release(),this.performanceInfo.advance(OP.DEPTH)}_renderAllGeometryDepth(){if(!this._needsDepth)return void(this._bindParameters.depth=(0,Je.Gz)(this._bindParameters.depth));const{width:e,height:t}=this._offscreen,r=this.fboCache.acquire(e,t,"depth").acquireDepth(La.z.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderAllGeometry(oS.V.Depth),(0,Je.Gz)(this._bindParameters.depth),this._bindParameters.depth=r.obtainDepthTexture(),r.release(),this.performanceInfo.advance(OP.DEPTH)}_renderMultipassTerrainDepth(e){if(!e)return void(this._bindParameters.multipassTerrain.depth=(0,Je.Gz)(this._bindParameters.multipassTerrain.depth));const t=this._renderContext.output;this._renderContext.output=oS.V.Depth;const{width:r,height:i}=this._offscreen,n=this.fboCache.acquire(r,i,"terrain depth").acquireDepth(La.z.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderTransparentTerrain(),(0,Je.Gz)(this._bindParameters.multipassTerrain.depth),this._bindParameters.multipassTerrain.depth=n.obtainDepthTexture(),this._renderContext.output=t,n.release()}_renderMultipassGeometryDepth(e){if(!e)return void(this._bindParameters.multipassGeometry.depth=(0,Je.Gz)(this._bindParameters.multipassGeometry.depth));const t=this._renderContext.output,{width:r,height:i}=this._offscreen,n=this.fboCache.acquire(r,i,"geometry depth").acquireDepth(La.z.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderOpaqueGeometryAndTransparentMaterial(oS.V.Depth),this._renderContext.output=t,(0,Je.Gz)(this._bindParameters.multipassGeometry.depth),this._bindParameters.multipassGeometry.depth=n.obtainDepthTexture(),n.release()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return yC;const t=$E(e,this._plugins.plugins,this._stage.layers);return mC(t,this._plugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderNormals(){const e=this._nodes.require("normals","final-color","composite-color","opaque-color","transparent-color"),t=(this.hasSSAO?1:0)+(this.hasLaserlines?1:0)+e;if(0===t)return;const r=this._offscreen.renderToCachedFBO(null,"normals",(()=>this._renderGeometryForSSAO(oS.V.Normal)),[0,0,0,0],La.N.RGBA,La.z.DEPTH_STENCIL_TEXTURE),i=this._nodes.optional("normals","final-color","composite-color","opaque-color","transparent-color")+(this._viewshedEnabled?1:0);return r.retain(t+i-1),this.performanceInfo.advance(OP.NORMALS),r}_renderSSAO(){const e=this._pluginInput.get("normals");if(!this.hasSSAO||!e)return void e?.detachDepth();const t=this._nodes.render("ssao",this._pluginInput);return this._bindParameters.ssao=t,e.detachDepth(),this._pluginInput.release("normals"),this.performanceInfo.advance(OP.SSAO),t}_renderAllGeometry(e){this._renderContext.output=e,this._plugins.prepare(_c.N.TRANSPARENT_TERRAIN),this._renderOpaqueGeometryAndTransparentMaterial(e),this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(e){this._renderContext.output=e,this._plugins.prepare(_c.N.TRANSPARENT_MATERIAL,_c.N.TRANSPARENT_NO_SSAO_DEPTH),this._renderOpaqueGeometry(),this._renderTransparentMaterial()}_renderGeometryForSSAO(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,_c.N.INTEGRATED_MESH,_c.N.OPAQUE_TERRAIN,_c.N.OPAQUE_MATERIAL,_c.N.TRANSPARENT_MATERIAL),this._renderTransparentTerrain()}_renderGeometryExcludedFromSSAO(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,_c.N.OPAQUE_NO_SSAO_DEPTH,_c.N.TRANSPARENT_NO_SSAO_DEPTH)}_prepareOpaqueGeometry(){this._plugins.prepare(...UP,_c.N.OPAQUE_ENVIRONMENT)}_renderOpaqueGeometry(){this._plugins.render(this._pluginInput,...UP)}_renderTransparentMaterial(){this._plugins.render(this._pluginInput,...VP)}_renderTransparentTerrain(){const e=this._renderContext.output;if(!this._plugins.produces(e,_c.N.TRANSPARENT_TERRAIN))return;const t=()=>this._plugins.render(this._pluginInput,_c.N.TRANSPARENT_TERRAIN);if(e!==oS.V.Color)return void t();const{width:r,height:i,depth:n}=this._offscreen,s=this.fboCache.acquire(r,i,"transparent terrain");return this._offscreen.renderToTargets(t,s,n,[0,0,0,0]),s}_renderHUDVisibility(){this._plugins.produces(this._renderContext.output,_c.N.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,(()=>this._plugins.render(this._pluginInput,_c.N.OCCLUSION_PIXELS)),this._bindParameters.multipassGeometry.depth),this._offscreen.bindFbo(),this.performanceInfo.advance(OP.HUD_VISIBILITY)):this._bindParameters.hudVisibility=(0,Je.Gz)(this._bindParameters.hudVisibility)}_renderLineCallouts(e){if(this._bindParameters.hudRenderStyle=e,e===HR.D.Occluded){const e=()=>this._plugins.render(this._pluginInput,_c.N.LINE_CALLOUTS),{width:t,height:r,color:i}=this._offscreen,n=this.fboCache.acquireDepth(La.z.DEPTH16_BUFFER,t,r,"line callouts");this._offscreen.renderToTargets(e,i,n,void 0,!0,!0),n.release()}else this._plugins.render(this._pluginInput,_c.N.LINE_CALLOUTS)}_renderLaserlines(){if(this.hasLaserlines){if(this._plugins.render(this._pluginInput,_c.N.LASERLINES),this._plugins.produces(this._renderContext.output,_c.N.LASERLINES_CONTRAST_CONTROL)){const e=this._offscreen,{width:t,height:r,depth:i}=e,n=this.fboCache.acquire(t,r,"laser lines"),s=()=>this._plugins.render(this._pluginInput,_c.N.LASERLINES_CONTRAST_CONTROL);e.renderToTargets(s,n,i,zP),e.compositeToFramebuffer(this._bindParameters,n.getTexture(),RE.PremultipliedAlpha,1),n.release()}this._pluginInput.release("normals"),this.performanceInfo.advance(OP.LASER_LINES)}}_renderHUD(e,t){if(this._pluginsHas.hudElements){if(this._oitEnabled){const r=this._renderOITPass(FP.HUD,e);this._rctx.bindFramebuffer(t.fbo),this._compositingHelper.composite(this._bindParameters,r.getTexture(),RE.PremultipliedAlpha),r.release()}else if(e===HR.D.Occluded){this._renderContext.output=oS.V.Color;const t=()=>this._renderHUDElements(e),{width:r,height:i,color:n}=this._offscreen,s=this.fboCache.acquireDepth(La.z.DEPTH16_BUFFER,r,i,"hud");this._offscreen.renderToTargets(t,n,s,void 0,!0,!0),s.release()}else this._renderContext.output=oS.V.Color,t.acquireDepth(La.z.DEPTH16_BUFFER),this._rctx.bindFramebuffer(t.fbo),this._renderHUDElements(e),t.detachDepth();this.performanceInfo.advance(e===HR.D.Occluded?OP.HUD_OCCLUDED:OP.HUD)}}_renderHUDElements(e){this._bindParameters.hudRenderStyle=e,this._plugins.prepare(_c.N.LINE_CALLOUTS_HUD_DEPTH,_c.N.HUD_MATERIAL,_c.N.LABEL_MATERIAL),this._plugins.render(this._pluginInput,_c.N.LINE_CALLOUTS_HUD_DEPTH,_c.N.HUD_MATERIAL,_c.N.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._plugins.produces(oS.V.ShadowHighlight,_c.N.OPAQUE_MATERIAL)}_renderHighlightPrepass(){if(!this.hasHighlights)return;const e=this._offscreen.renderToCachedFBO(null,"highlights",(()=>{this._renderAllGeometry(oS.V.Highlight),this._rctx.clear(Aa.hn.DEPTH_BUFFER_BIT),this._renderHUDElements(HR.D.Both)}),[0,0,0,0],La.N.RGBA4,La.z.DEPTH_STENCIL_TEXTURE);return e.detachDepth(),e}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(e,t,r){this._needsShadowCast&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,e,t,r)&&this.performanceInfo.advance(OP.ACCUMULATED_SHADOWS)}_prepareTransparencySlots(){this._renderContext.output=oS.V.Color,this._bindParameters.transparencyPassType=DR.y.ColorAlpha,this._plugins.prepare(...VP),this._bindParameters.transparencyPassType=DR.y.FrontFace,this._plugins.prepare(...VP),this._bindParameters.transparencyPassType=DR.y.NONE,this._techniques.acquire(kE).release()}_renderOITPass(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:HR.D.Both;const r=e===FP.HUD,i=r?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oit hud composite"):null,n=r?()=>this._renderHUDElements(t):()=>this._renderTransparentMaterial(),s=this._renderContext.output;this._renderContext.output=oS.V.Color,this._bindParameters.transparencyPassType=DR.y.ColorAlpha;const o=this._offscreen.renderOITPass(n,DR.y.ColorAlpha,r);this._bindParameters.transparencyPassType=DR.y.FrontFace;const a=this._offscreen.renderOITPass(n,DR.y.FrontFace,r);return this._offscreen.compositeOIT(this._bindParameters,o,a,i),i?.detachDepth(),a.release(),o.release(),this._bindParameters.transparencyPassType=DR.y.NONE,this._renderContext.output=s,i}_renderOccluded(){let e=0;BP.clear(),this._plugins.plugins.forAll((t=>{t.materialReference&&t.queryRenderOccludedState(px.m$.OccludeAndTransparentStencil)&&(e|=px.m$.OccludeAndTransparentStencil,BP.push(t))}));const t=this._offscreen,r=(r,i,n,s,o)=>{if(!(e&i))return;const{width:a,height:l,depth:c}=t,u=this.fboCache.acquire(a,l,"tmp color");t.renderToTargets(n,u,c,[0,0,0,0],s,o),t.compositeToFramebuffer(this._bindParameters,u.getTexture(),RE.PremultipliedAlpha,r),u.release()},i=(e,t)=>{this._bindParameters.slot=e,t.forAll((e=>{if((0,yc.zo)(e)){const t=e.prepareTechnique(this._renderContext);t&&e.renderNode(this._renderContext,t)}}))};0!==BP.length&&(i(_c.N.OCCLUDER_MATERIAL,BP),r(.5,px.m$.OccludeAndTransparentStencil,(()=>i(_c.N.TRANSPARENT_OCCLUDER_MATERIAL,BP)),!1,!1));const n=BP.length>0;BP.clear(),this._plugins.plugins.forAll((t=>{if(!t.materialReference)return;const r=t.queryRenderOccludedState(px.m$.OccludeAndTransparent),i=t.queryRenderOccludedState(px.m$.Transparent),n=t.queryRenderOccludedState(px.m$.Opaque);(r||i||n)&&(e|=r?px.m$.OccludeAndTransparent:i?px.m$.Transparent:px.m$.Opaque,BP.push(t))}));const s=this._plugins.renderOccludedFlags;if(e|=s,!e)return;const o=e=>{this._renderContext.renderOccludedMask=e,s>px.m$.Occlude&&this._plugins.render(this._pluginInput,_c.N.OCCLUDED_TERRAIN),i(_c.N.OPAQUE_MATERIAL,BP),i(_c.N.TRANSPARENT_MATERIAL,BP),i(_c.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,BP),this._renderContext.renderOccludedMask=aP.Vr};this._renderContext.output=oS.V.Color,r(.5,px.m$.OccludeAndTransparent,(()=>o(px.m$.OccludeAndTransparent)),!0,hx.dd.OutlineVisualElementMask),r(.5,px.m$.Transparent,(()=>o(px.m$.Transparent)),!0,hx.dd.OutlineVisualElementMask),r(1,px.m$.Opaque,(()=>o(px.m$.Opaque)),!0,hx.dd.OutlineVisualElementMask),(n||BP.length>0)&&this.performanceInfo.advance(OP.OCCLUDED),BP.clear()}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters),this._offscreen.bindFbo(),this._plugins.render(this._pluginInput,_c.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,_c.N.TRANSPARENT_ENVIRONMENT),this.performanceInfo.advance(OP.TRANSPARENT_ENVIRONMENT)}_renderViewshed(){this._viewshedEnabled&&(this._viewshed.renderHighQuality=this.isFeatureEnabled(pm.n.HighResolutionViewshed),this._plugins.render(this._pluginInput,_c.N.VIEWSHED),this._pluginInput.release("normals"),this.performanceInfo.advance(OP.VIEWSHED))}_renderPlugins(e,t){this._plugins.produces(this._renderContext.output,e)&&(this._plugins.render(this._pluginInput,e),this.performanceInfo.advance(t))}_renderNodes(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._nodes.produces(e))return r&&this.performanceInfo.advance(e),t;t.setName(e),this._pluginInput.set(e,t);const i=this._nodes.render(t,this._pluginInput,this._releaseNormals);return this.performanceInfo.advance(e),i}_blitToDefault(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wR,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._blit||(this._blit=new YR(this._techniques));const i=this._blit.render(this._rctx,e,t,this._bindParameters,this._requestRender);return this._pluginInput.set(e.name,i),r&&e.release(),i}_ensureBindParametersCamera(e,t){this._bindParameters.camera=e,this._bindParameters.contentCamera=t}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.lastFrameColor){null==this._ssrEnableTime&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=qa.zK:((0,$a.B8)(HP,this._bindParameters.camera.viewMatrix),(0,$a.B8)(jP,this._bindParameters.camera.projectionMatrix),(0,$a.lw)(GP,HP,jP),(0,$a.lw)(GP,this._renderContext.lastFrameCamera.viewMatrix,GP),(0,$a.lw)(GP,this._renderContext.lastFrameCamera.projectionMatrix,GP),this._reprojectionMatrix=GP);const t=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=t>0?Math.min(t,e-this._ssrEnableTime)/t:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=qa.zK,this._ssrEnableTime=null}addRenderNode(e){this._nodes.add(e),this._requestRender()}removeRenderNode(e){this._nodes.remove(e),this._requestRender()}get usedMemory(){return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:this.edgeView?.usedMemory??0}}get _viewshedEnabled(){return this._viewshed.enabled&&this._plugins.produces(this._renderContext.output,_c.N.VIEWSHED)}get test(){}}var FP,kP;(0,ze._)([(0,Qe.MZ)({readOnly:!0})],DP.prototype,"fullResolutionAtmosphere",null),(0,ze._)([(0,Qe.MZ)()],DP.prototype,"_edgeView",void 0),(0,ze._)([(0,Qe.MZ)()],DP.prototype,"updating",null),function(e){e[e.Geometry=0]="Geometry",e[e.HUD=1]="HUD"}(FP||(FP={})),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.ShadowMap=2]="ShadowMap",e[e.HudVisibility=3]="HudVisibility",e[e.ViewshedShadowMap=4]="ViewshedShadowMap"}(kP||(kP={}));const zP=[0,0,0,0],UP=[_c.N.INTEGRATED_MESH,_c.N.OPAQUE_TERRAIN,_c.N.OPAQUE_MATERIAL,_c.N.OPAQUE_NO_SSAO_DEPTH],VP=[_c.N.TRANSPARENT_MATERIAL,_c.N.TRANSPARENT_NO_SSAO_DEPTH],BP=new Ty.A,jP=(0,qa.vt)(),HP=(0,qa.vt)(),GP=(0,qa.vt)();function ZP(e){return t=>e.immediate.schedule(t)}class $P{constructor(e){this._rctx=e,this._vao=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Na.lK,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ta.D;const i=new Float32Array([-1,-1,3,-1,-1,3]);return new Cl.Z(e,r,{geometry:t},{geometry:Rl.g.createVertex(e,Aa._U.STATIC_DRAW,i)})}(e)}destroy(){this._vao=(0,Je.WD)(this._vao)}draw(){null!=this._vao&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(Aa.WR.TRIANGLES,0,3))}get test(){}}class qP{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = vec4(0.0, 0.0, 0.0, 1.0);\n    }"}}_createHelperProgram(){const e=qP.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Rl.g.createIndex(this._rctx,Aa._U.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Aa.NZ.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Aa.WR.POINTS,1,Aa.pe.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}}class WP{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Aa.dn.ONE,dstRGB:Aa.dn.ZERO,srcAlpha:Aa.dn.ONE,dstAlpha:Aa.dn.ZERO},this.blendEquation={mode:Aa.Tb.ADD,modeAlpha:Aa.Tb.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Aa.Y7.BACK,this.frontFace=Aa.Ac.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Aa.MT.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Aa.Y7.FRONT_AND_BACK,func:Aa.MT.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Aa.Y7.FRONT_AND_BACK,fail:Aa.eA.KEEP,zFail:Aa.eA.KEEP,zPass:Aa.eA.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[Aa.Hr.BACK],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}}class YP{constructor(e){this._objectType=e,this._active=new Map}add(e){const t=(new Error).stack.split("\n");t.shift(),t.shift(),this._active.set(e,t.join("\n"))}remove(e){this._active.delete(e)}resetLog(){const e=new Map;this._active.forEach(((t,r)=>{let{usedMemory:i}=r;e.has(t)||e.set(t,new Map);const n=e.get(t);n.set(i??0,n.get(i??0)??1)})),this._active.clear();let t=0;const r=new Array;return e.forEach(((e,i)=>{let n=0;e.forEach(((e,t)=>n+=e*t)),e.set(-1,n),t+=n,r.push([i,e])})),e.clear(),r.sort(((e,t)=>t[1].get(-1)-e[1].get(-1))),r.reduce(((e,t)=>{let[r,i]=t;const n=Math.round(i.get(-1)/1024);return i.delete(-1),e+`  ${n}KB from ${Array.from(i.values()).reduce(((e,t)=>e+t),0)} allocations at ${r}\n`}),`Total unestimated ${this._objectType} memory: ${Math.round(t/1024)}KB\n`)}}const XP=!1;class JP{constructor(){for(this._current=new Array,this._allocations=XP?new YP("WebGLObject"):null;this._current.length<Aa.vt.COUNT;)this._current.push(0)}increment(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._current[e]+=r,this._allocations?.add(t)}decrement(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._current[e]-=r,this._allocations?.remove(t)}get current(){return this._current}get total(){return this.current.reduce(((e,t,r)=>e+(r<Aa.vt.UNCOUNTED?t:0)),0)}get resourceInformation(){let e="";if(this.total>0){e+="Live objects:\n";for(let t=0;t<Aa.vt.COUNT;++t){const r=this._current[t];r>0&&(e+=`${Aa.vt[t]}: ${r}\n`)}}return e+=this._allocations?.resetLog(),e}}class KP{constructor(e,t,r){const i=t.textureFilterAnisotropic,n=r.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=i?Math.min(e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES),this.maxDrawBuffers=e.getParameter(e.MAX_DRAW_BUFFERS)}}var QP=r(44488);class eO{constructor(e){this._rctx=e,this._store=new aR.O}dispose(){this._store.forEach((e=>e.forEach((e=>e.dispose())))),this._store.clear()}acquire(e,t,r,i){const n=this._store.get(e,t);if(null!=n)return n.ref(),n;const s=new QP.B(this._rctx,e,t,r,i);return s.ref(),this._store.set(e,t,s),s}get test(){}}class tO{constructor(){this._result=!1}dispose(){this._program=(0,Je.WD)(this._program)}get result(){return null!=this._program&&(this._result=this._test(this._program),this.dispose()),this._result}}class rO extends tO{constructor(e){super(),this._rctx=e,this._helperProgram=null,(0,it.A)("mac")&&(0,it.A)("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(e){const t=this._rctx,r=t.getBoundFramebufferObject(),{x:i,y:n,width:s,height:o}=t.getViewport();t.resetState();const a=new sl.R(1);a.wrapMode=Aa.pF.CLAMP_TO_EDGE,a.samplingMode=Aa.Cj.NEAREST;const l=new nl.H(t,a),c=Rl.g.createIndex(this._rctx,Aa._U.STATIC_DRAW,new Uint8Array([0]));t.bindFramebuffer(l),t.setViewport(0,0,1,1),t.useProgram(this._helperProgram),t.bindBuffer(c,Aa.NZ.ELEMENT_ARRAY_BUFFER),t.drawElements(Aa.WR.POINTS,1,Aa.pe.UNSIGNED_BYTE,0),t.useProgram(e),t.bindVAO(null),t.drawArrays(Aa.WR.TRIANGLES,0,258);const u=new Uint8Array(4);return l.readPixels(0,0,1,1,Aa.Ab.RGBA,Aa.ld.UNSIGNED_BYTE,u),t.setViewport(i,n,s,o),t.bindFramebuffer(r),l.dispose(),c.dispose(),255===u[0]}_prepareProgram(){const e=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${wa.H.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,t=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${wa.H.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(e,t,new Map([]))}_prepareHelperProgram(){const e=qP.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}}var iO=r(99643),nO=r(21812);class sO extends tO{constructor(e){super(),this._rctx=e,this._program=oO(this._rctx,!1),this._obfuscated=oO(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=(0,Je.WD)(this._obfuscated)}_test(e){if((0,it.A)("force-double-precision-obfuscation"))return!0;if(null==this._obfuscated)return!1;const t=this._rctx,r=t.getBoundFramebufferObject(),{x:i,y:n,width:s,height:o}=t.getViewport(),a=this._runProgram(e),l=this._runProgram(this._obfuscated);return t.setViewport(i,n,s,o),t.bindFramebuffer(r),0!==a&&(0===l||a/l>5)}_runProgram(e){const t=this._rctx;t.resetState();const r=new sl.R(1);r.wrapMode=Aa.pF.CLAMP_TO_EDGE,r.samplingMode=Aa.Cj.NEAREST;const i=new nl.H(t,r),n=Rl.g.createVertex(t,Aa._U.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new qC.Z(t,new Map([["position",0]]),{geometry:[new nO._("position",2,Aa.pe.UNSIGNED_SHORT,0,4)]},{geometry:n}),o=(0,nn.fA)(5633261.287538229,2626832.878767164,1434988.0495278358),a=(0,nn.fA)(5633271.46742708,2626873.6381334523,1434963.231608387),l=new Float32Array(6);(0,iO.jS)(o,l,3);const c=new Float32Array(6);(0,iO.jS)(a,c,3),t.useProgram(e),e.setUniform3f("u_highA",l[0],l[2],l[4]),e.setUniform3f("u_lowA",l[1],l[3],l[5]),e.setUniform3f("u_highB",c[0],c[2],c[4]),e.setUniform3f("u_lowB",c[1],c[3],c[5]),t.bindFramebuffer(i),t.setViewport(0,0,1,1),t.bindVAO(s),t.drawArrays(Aa.WR.TRIANGLE_STRIP,0,4);const u=new Uint8Array(4);i.readPixels(0,0,1,1,Aa.Ab.RGBA,Aa.ld.UNSIGNED_BYTE,u),s.dispose(),i.dispose();const h=(o[2]-a[2])/25,d=(0,UE.T)(u);return Math.abs(h-d)}}function oO(e,t){const r=`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `;return e.programCache.acquire(r,"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",new Map([["position",0]]))}class aO extends tO{constructor(e){if(super(),this._rctx=e,!e.gl)return;if(!e.capabilities.colorBufferFloat?.textureFloat||!e.capabilities.colorBufferFloat?.floatBlend)return;this._program=e.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n     precision highp float;\n\n     void main() {\n      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",new Map([["a_pos",0]]))}_test(e){const t=this._rctx,r=new sl.R(1);r.wrapMode=Aa.pF.CLAMP_TO_EDGE,r.dataType=Aa.ld.FLOAT,r.internalFormat=Aa.H0.RGBA32F,r.samplingMode=Aa.Cj.NEAREST;const i=new nl.H(t,r),n=Rl.g.createVertex(t,Aa._U.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new qC.Z(t,new Map([["a_pos",0]]),{geometry:[new nO._("a_pos",2,Aa.pe.UNSIGNED_SHORT,0,4)]},{geometry:n});t.gl.getError(),t.useProgram(e);const o=t.getBoundFramebufferObject(),{x:a,y:l,width:c,height:u}=t.getViewport();t.bindFramebuffer(i),t.setViewport(0,0,1,1),t.bindVAO(s),t.drawArrays(Aa.WR.TRIANGLE_STRIP,0,4);const h=(0,Ca.Ey)({blending:(0,Ca.ox)(Aa.dn.ZERO,Aa.dn.ONE_MINUS_SRC_ALPHA)});t.setPipelineState(h),t.drawArrays(Aa.WR.TRIANGLE_STRIP,0,4);const d=t.gl.getError();return t.setViewport(a,l,c,u),t.bindFramebuffer(o),s.dispose(),i.dispose(),d!==t.gl.INVALID_OPERATION||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}}new nO._("a_pos",2,Aa.pe.BYTE,0,2),new nO._("a_pos",2,Aa.pe.BYTE,0,4),new nO._("a_tex",2,Aa.pe.BYTE,2,4);const lO={geometry:[new nO._("a_pos",2,Aa.pe.UNSIGNED_SHORT,0,4)]};class cO extends tO{constructor(e){super(),this._rctx=e;this._program=e.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv = a_pos;\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor = texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const t=this._rctx;if(!t.gl)return e.dispose(),!0;const r=new sl.R(1);r.wrapMode=Aa.pF.CLAMP_TO_EDGE,r.samplingMode=Aa.Cj.NEAREST;const i=new nl.H(t,r),n=Rl.g.createVertex(t,Aa._U.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new qC.Z(t,new Map([["a_pos",0]]),lO,{geometry:n}),o=new sl.R;o.samplingMode=Aa.Cj.LINEAR,o.wrapMode=Aa.pF.CLAMP_TO_EDGE;const a=new Pl.g(t,o,uO);t.useProgram(e),t.bindTexture(a,0),e.setUniform1i("u_texture",0);const l=t.getBoundFramebufferObject(),{x:c,y:u,width:h,height:d}=t.getViewport();t.bindFramebuffer(i),t.setViewport(0,0,1,1),t.setClearColor(0,0,0,0),t.setBlendingEnabled(!1),t.clear(Aa.hn.COLOR_BUFFER_BIT),t.bindVAO(s),t.drawArrays(Aa.WR.TRIANGLE_STRIP,0,4);const p=new Uint8Array(4);return i.readPixels(0,0,1,1,Aa.Ab.RGBA,Aa.ld.UNSIGNED_BYTE,p),s.dispose(),i.dispose(),a.dispose(),t.setViewport(c,u,h,d),t.bindFramebuffer(l),255!==p[0]}}const uO=new Image;uO.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",uO.width=5,uO.height=5,uO.decode();class hO{constructor(e){this.rctx=e,this.floatBufferBlend=new aO(e),this.svgPremultipliesAlpha=new cO(e),this.doublePrecisionRequiresObfuscation=new sO(e),this.drawArraysRequiresIndicesTypeReset=new rO(e)}dispose(){this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}}class dO{constructor(e,t){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._disabledExtensions=t.disabledExtensions||{},this._debugWebGLExtensions=t.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC??=function(e,t){if(t.compressedTextureETC)return null;const r=e.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}(this._gl,this._disabledExtensions),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??=function(e,t){if(t.compressedTextureS3TC)return null;const r=e.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(this._gl,this._disabledExtensions),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??=function(e,t){if(t.textureFilterAnisotropic)return null;const r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}(this._gl,this._disabledExtensions),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??=function(e,t){if(t.disjointTimerQuery)return null;let r=e.getExtension("EXT_disjoint_timer_query_webgl2");return r?new EP((()=>e.createQuery()),(t=>{e.deleteQuery(t),RP=!1}),(t=>e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)),(t=>e.getQueryParameter(t,e.QUERY_RESULT)),(()=>e.getParameter(r.GPU_DISJOINT_EXT)),(t=>{RP||(RP=!0,e.beginQuery(r.TIME_ELAPSED_EXT,t))}),(()=>{e.endQuery(r.TIME_ELAPSED_EXT),RP=!1}),(e=>r.queryCounterEXT(e,r.TIMESTAMP_EXT)),(()=>e.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT))):(r=e.getExtension("EXT_disjoint_timer_query"),r?new EP((()=>r.createQueryEXT()),(e=>{r.deleteQueryEXT(e),RP=!1}),(e=>r.getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT)),(e=>r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)),(()=>e.getParameter(r.GPU_DISJOINT_EXT)),(e=>{RP||(RP=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,e))}),(()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),RP=!1}),(e=>r.queryCounterEXT(e,r.TIMESTAMP_EXT)),(()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT))):null)}(this._gl,this._disabledExtensions),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??=function(e,t){const r=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),n=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!n,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}(this._gl,this._disabledExtensions),this._colorBufferFloat}get loseContext(){return this._loseContext??=function(e,t){const r=t.loseContext&&e.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}(this._gl,this._debugWebGLExtensions),this._loseContext}get textureNorm16(){return this._textureNorm16??=function(e,t){if(t.textureNorm16)return null;const r=e.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}(this._gl,this._disabledExtensions),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??=function(e,t,r,i,n){if(i)return!0;if(t[r])return!1;for(const s of n)if(e.getExtension(s))return!0;return!1}(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]),this._textureFloatLinear}enable(e){return this[e]}}let pO=class{constructor(e,t){this.gl=e,this.instanceCounter=new JP,this.programCache=new eO(this),this._transformFeedbackRequestInfo=null,this._state=new WP,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(t)}configure(e){this._capabilities=new dO(this.gl,e),this._parameters=new KP(this.gl,this._capabilities,e),Pl.g.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const t=this.gl.getParameter(this.gl.VIEWPORT);this._state=new WP,this._state.viewport={x:t[0],y:t[1],width:t[2],height:t[3]},this._stateTracker=new Ca.Ms({setBlending:e=>{if(e){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(e.opRgb,e.opAlpha),this.setBlendFunctionSeparate(e.srcRgb,e.dstRgb,e.srcAlpha,e.dstAlpha);const t=e.color;this.setBlendColor(t.r,t.g,t.b,t.a)}else this.setBlendingEnabled(!1)},setCulling:e=>{e?(this.setFaceCullingEnabled(!0),this.setCullFace(e.face),this.setFrontFace(e.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:e=>{e?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(e.factor,e.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:e=>{e?(this.setDepthTestEnabled(!0),this.setDepthFunction(e.func)):this.setDepthTestEnabled(!1)},setStencilTest:e=>{if(e){this.setStencilTestEnabled(!0);const t=e.function;this.setStencilFunction(t.func,t.ref,t.mask);const r=e.operation;this.setStencilOp(r.fail,r.zFail,r.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:e=>{e?(this.setDepthWriteEnabled(!0),this.setDepthRange(e.zNear,e.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:e=>{e?this.setColorMask(e.r,e.g,e.b,e.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:e=>{e?this.setStencilWriteMask(e.mask):this.setStencilWriteMask(0)},setDrawBuffers:e=>{if(e)this.setDrawBuffers(e.buffers);else{const{drawFramebuffer:e}=this._state;null===e?this.setDrawBuffers([Aa.Hr.BACK]):0===e.colorAttachments.length?this.setDrawBuffers([Aa.Hr.NONE]):this.setDrawBuffers([Aa.Nm.COLOR_ATTACHMENT0])}}}),this.enforceState(),(0,Je.WD)(this._driverTest),this._driverTest=new hO(this)}dispose(){(0,Je.WD)(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Aa.NZ.ARRAY_BUFFER),this.unbindBuffer(Aa.NZ.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(Aa.NZ.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Aa.NZ.PIXEL_PACK_BUFFER),this.unbindBuffer(Aa.NZ.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Aa.NZ.COPY_READ_BUFFER),this.unbindBuffer(Aa.NZ.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,(0,$R.en)()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(e,t){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;t>=0&&(this._state.activeTexture=t)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,t,r,i){e===this._state.blendColor.r&&t===this._state.blendColor.g&&r===this._state.blendColor.b&&i===this._state.blendColor.a||(this.gl.blendColor(e,t,r,i),this._state.blendColor.r=e,this._state.blendColor.g=t,this._state.blendColor.b=r,this._state.blendColor.a=i,this._stateTracker.invalidateBlending())}setBlendFunction(e,t){e===this._state.blendFunction.srcRGB&&t===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,t),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=t,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,t,r,i){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===t&&this._state.blendFunction.dstAlpha===i||(this.gl.blendFuncSeparate(e,t,r,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,t){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setColorMask(e,t,r,i){this._state.colorMask.r===e&&this._state.colorMask.g===t&&this._state.colorMask.b===r&&this._state.colorMask.a===i||(this.gl.colorMask(e,t,r,i),this._state.colorMask.r=e,this._state.colorMask.g=t,this._state.colorMask.b=r,this._state.colorMask.a=i,this._stateTracker.invalidateColorWrite())}setClearColor(e,t,r,i){this._state.clearColor.r===e&&this._state.clearColor.g===t&&this._state.clearColor.b===r&&this._state.clearColor.a===i||(this.gl.clearColor(e,t,r,i),this._state.clearColor.r=e,this._state.clearColor.g=t,this._state.clearColor.b=r,this._state.clearColor.a=i)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,t){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===t||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,t,r,i){this._state.scissorRect.x===e&&this._state.scissorRect.y===t&&this._state.scissorRect.width===r&&this._state.scissorRect.height===i||(this.gl.scissor(e,t,r,i),this._state.scissorRect.x=e,this._state.scissorRect.y=t,this._state.scissorRect.width=r,this._state.scissorRect.height=i)}setDepthTestEnabled(e){this._state.depthTest!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,t){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===t||(this.gl.depthRange(e,t),this._state.depthRange.zNear=e,this._state.depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,t,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===t&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,t,r),this._state.stencilFunction.face=Aa.Y7.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=t,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,t,r,i){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFuncSeparate(e,t,r,i),this._state.stencilFunction.face=e,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,t,r){this._state.stencilOperation.face===Aa.Y7.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===t&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,t,r),this._state.stencilOperation.face=Aa.Y7.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=t,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,t,r,i){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOpSeparate(e,t,r,i),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setActiveTexture(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=this._state.activeTexture;return e>=0&&(t||e!==this._state.activeTexture)&&(this.gl.activeTexture(Aa.xM+e),this._state.activeTexture=e),r}setDrawBuffers(e){const{drawFramebuffer:t}=this._state,r=null===t,i=r?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(t);if(i?.length!==e.length||!i.every(((t,r)=>t===e[r])))if(e.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(r){if(e.length>1)return void console.error("The default framebuffer can only have one active draw buffer.");if(e[0]!==Aa.Hr.BACK&&e[0]!==Aa.Hr.NONE)return void console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.")}r||!e.includes(Aa.Hr.BACK)?(this.gl.drawBuffers(e),r?this._state.drawBuffers.defaultFramebuffer=e:this._state.drawBuffers.fbos.set(t,e),this._stateTracker.invalidateDrawBuffers()):console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers.")}}clear(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;if(e){if(e&Aa.hn.COLOR_BUFFER_BIT){const e=this._state.drawFramebuffer?.colorAttachments;e&&this.setDrawBuffers(e),this.setColorMask(!0,!0,!0,!0)}e&Aa.hn.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Aa.hn.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(t),this.gl.clear(e)}}clearFramebuffer(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=0;if(e){const t=1e-13,r=Math.max(t,e[3]);this.setClearColor(e[0],e[1],e[2],r),i|=Aa.hn.COLOR_BUFFER_BIT}t&&(i|=Aa.hn.DEPTH_BUFFER_BIT),!1===r?r=0:(!0===r&&(r=255),i|=Aa.hn.STENCIL_BUFFER_BIT),i&&this.clear(i,r)}drawArrays(e,t,r){if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(null==this._state.program?.hasTransformFeedbackVaryings)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if((0,$R.en)()){this._numOfDrawCalls++,this._numOfTriangles+=mO(e,r);const t=this._state.textureUnitMap;for(let e=0;e<t.length;e++){const r=t[e];if(null!=r&&r===this._state.drawFramebuffer?.colorTexture)throw new Error(`Detected readWrite. Texture already bound at index ${e}`)}}this.gl.drawArrays(e,t,r),(0,$R.Y2)(this.gl)}drawArraysInstanced(e,t,r,i){this.gl.drawArraysInstanced(e,t,r,i),(0,$R.Y2)(this.gl)}drawElements(e,t,r,i){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if((0,$R.en)()&&(this._numOfDrawCalls++,this._numOfTriangles+=mO(e,t)),this.gl.drawElements(e,t,r,i),(0,$R.en)()){const n=(0,Ol.WH)(this);if(n){const s=this.getBoundVAO(),o=s?.indexBuffer,a=s?.vertexBuffers,l={indexBuffer:o,vertexBuffers:a},c={mode:e,count:t,type:r,offset:i},u=o?.size??0,h=i+t,d=u<h?`. Buffer is too small. Attempted to draw index ${h} of ${u}`:"";console.error(`drawElements: ${n}${d}`,{args:c,vao:l})}}}logInfo(){(0,$R.en)()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){(0,$R.en)()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,t,r,i){r=Math.max(Math.round(r),1),i=Math.max(Math.round(i),1);const n=this._state.viewport;n.x===e&&n.y===t&&n.width===r&&n.height===i||(n.x=e,n.y=t,n.width=r,n.height=i,this.gl.viewport(e,t,r,i))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport(e){let{x:t,y:r,width:i,height:n}=e;this.setViewport(t,r,i,n)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){this._state.program!==e&&(this._state.program?.stop(),this._state.program=e,this.gl.useProgram(e?.glName??null))}bindTexture(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(t>=this.parameters.maxTextureImageUnits||t<0)&&console.error("Input texture unit is out of range of available units!");const i=this._state.textureUnitMap[t];return null==e?.glName?(null!=i&&(this.setActiveTexture(t,r),this.gl.bindTexture(i.descriptor.target,null)),this._state.textureUnitMap[t]=null,i):r||i!==e?(this.setActiveTexture(t,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[t]=e,i):(e.isDirty&&(this.setActiveTexture(t,r),e.applyChanges()),i)}unbindTexture(e){if(null!=e)for(let t=0;t<this.parameters.maxTextureImageUnits;t++)this._state.textureUnitMap[t]===e&&(this.bindTexture(null,t),this._state.textureUnitMap[t]=null)}bindFramebuffer(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),null==e)return this.gl.bindFramebuffer(Aa.R.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(Aa.R.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=t===Aa.R.READ_FRAMEBUFFER,n=i?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==e)&&(null==e?this.gl.bindFramebuffer(t,null):e.initializeAndBind(t),i?this._state.readFramebuffer=e??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=e??null))}blitFramebuffer(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.width,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.height,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:t.width,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:t.height,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:Aa.hn.COLOR_BUFFER_BIT,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:Aa.Cj.NEAREST;this.bindFramebufferSeparate(e,Aa.R.READ_FRAMEBUFFER),this.bindFramebufferSeparate(t,Aa.R.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,i,n,s,o,a,l,c,u,h)}bindBuffer(e,t){if(e)switch(t??=e.bufferType,t){case Aa.NZ.ARRAY_BUFFER:this._state.vertexBuffer=fO(this.gl,e,t,this._state.vertexBuffer);break;case Aa.NZ.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=fO(this.gl,e,t,this._state.indexBuffer);break;case Aa.NZ.UNIFORM_BUFFER:this._state.uniformBuffer=fO(this.gl,e,t,this._state.uniformBuffer);break;case Aa.NZ.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=fO(this.gl,e,t,this._state.pixelPackBuffer);break;case Aa.NZ.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=fO(this.gl,e,t,this._state.pixelUnpackBuffer);break;case Aa.NZ.COPY_READ_BUFFER:this._state.copyReadBuffer=fO(this.gl,e,t,this._state.copyReadBuffer);break;case Aa.NZ.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=fO(this.gl,e,t,this._state.copyWriteBuffer);break;case Aa.NZ.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=fO(this.gl,e,t,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,t){if(t>=this.parameters.maxUniformBufferBindings||t<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=e===Aa.NZ.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let i=r[t];return null==i&&(i={buffer:null,offset:0,size:0},r[t]=i),i}bindBufferBase(e,t,r){const i=this._getBufferBinding(e,t);null!=i&&(i.buffer===r&&0===i.offset&&0===i.size||(this.gl.bindBufferBase(e,t,r?r.glName:null),i.buffer=r,i.offset=0,i.size=0))}bindBufferRange(e,t,r,i,n){const s=this._getBufferBinding(e,t);null!=s&&(s.buffer===r&&s.offset===i&&s.size===n||(i%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(e,t,r.glName,i,n),s.buffer=r,s.offset=i,s.size=n):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,t,r,i){null!=t?((0,$R.en)()&&(i??t.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),t.initialize(),void 0!==r&&void 0!==i?this.bindBufferRange(Aa.NZ.UNIFORM_BUFFER,e,t.buffer,r,i):this.bindBufferBase(Aa.NZ.UNIFORM_BUFFER,e,t.buffer)):this.bindBufferBase(Aa.NZ.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let t=0,r=this._state.uniformBufferBindingPoints.length;t<r;t++){const r=this._state.uniformBufferBindingPoints[t];null!=r&&r.buffer===e.buffer&&this.bindBufferBase(Aa.NZ.UNIFORM_BUFFER,t,null)}}unbindBuffer(e){switch(e){case Aa.NZ.ARRAY_BUFFER:this._state.vertexBuffer=fO(this.gl,null,e,this._state.vertexBuffer);break;case Aa.NZ.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=fO(this.gl,null,e,this._state.indexBuffer);break;case Aa.NZ.UNIFORM_BUFFER:this._state.uniformBuffer=fO(this.gl,null,e,this._state.uniformBuffer);break;case Aa.NZ.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=fO(this.gl,null,e,this._state.pixelPackBuffer);break;case Aa.NZ.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=fO(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Aa.NZ.COPY_READ_BUFFER:this._state.copyReadBuffer=fO(this.gl,null,e,this._state.copyReadBuffer);break;case Aa.NZ.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=fO(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null!=e?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(e){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,t){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:r}=this;r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,e.glName),r.beginTransformFeedback(t),this._transformFeedbackRequestInfo={primitiveType:t}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,ql.l5)(10);const{gl:t}=this,r=t.fenceSync(Aa.tx.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let i;this.instanceCounter.increment(Aa.vt.Sync,r),t.flush();do{await(0,Ke.Pl)(e),i=t.clientWaitSync(r,0,0)}while(i===Aa.sS.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Aa.vt.Sync,r),t.deleteSync(r),i===Aa.sS.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Aa.R.FRAMEBUFFER)===Aa.R.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Aa.NZ.ARRAY_BUFFER),this.unbindBuffer(Aa.NZ.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(Aa.NZ.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Aa.NZ.PIXEL_PACK_BUFFER),this.unbindBuffer(Aa.NZ.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Aa.NZ.COPY_READ_BUFFER),this.unbindBuffer(Aa.NZ.COPY_WRITE_BUFFER);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Aa.dn.ONE,Aa.dn.ZERO),this.setBlendEquation(Aa.Tb.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Aa.Y7.BACK),this.setFrontFace(Aa.Ac.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Aa.MT.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Aa.MT.ALWAYS,0,0),this.setStencilOp(Aa.eA.KEEP,Aa.eA.KEEP,Aa.eA.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([Aa.Hr.BACK]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const{gl:e}=this;e.bindVertexArray(null);for(let r=0;r<this.parameters.maxVertexAttributes;r++)e.disableVertexAttribArray(r);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(Aa.NZ.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(Aa.NZ.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(Aa.NZ.UNIFORM_BUFFER,null);for(let r=0;r<this._parameters.maxUniformBufferBindings;r++){const t=this._state.uniformBufferBindingPoints[r];if(null!=t){const{buffer:i,offset:n,size:s}=t;null!==i?0===n&&0===s?e.bindBufferBase(Aa.NZ.UNIFORM_BUFFER,r,i.glName):e.bindBufferRange(Aa.NZ.UNIFORM_BUFFER,r,i.glName,n,s):e.bindBufferBase(Aa.NZ.UNIFORM_BUFFER,r,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(Aa.NZ.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(Aa.NZ.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(Aa.NZ.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(Aa.NZ.COPY_WRITE_BUFFER,null),e.bindFramebuffer(Aa.R.READ_FRAMEBUFFER,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(Aa.R.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),e.readBuffer(Aa.Nm.COLOR_ATTACHMENT0)),e.bindFramebuffer(Aa.R.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null),null===this._state.drawFramebuffer){const t=this._state.drawBuffers.defaultFramebuffer;e.drawBuffers(t??[Aa.Hr.BACK])}else{const t=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);e.drawBuffers(t??[Aa.Nm.COLOR_ATTACHMENT0])}if(this._state.vertexArrayObject){const e=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(e)}e.useProgram(this._state.program?.glName??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,this._state.renderbuffer?.glName??null),!0===this._state.blend?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),!0===this._state.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),!0===this._state.faceCulling?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),!0===this._state.polygonOffsetFill?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),!0===this._state.scissorTest?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),!0===this._state.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let r=0;r<this.parameters.maxTextureImageUnits;r++){e.activeTexture(Aa.xM+r),e.bindTexture(Aa.Ap.TEXTURE_2D,null),e.bindTexture(Aa.Ap.TEXTURE_CUBE_MAP,null),e.bindTexture(Aa.Ap.TEXTURE_3D,null),e.bindTexture(Aa.Ap.TEXTURE_2D_ARRAY,null);const t=this._state.textureUnitMap[r];null!=t&&e.bindTexture(t.descriptor.target,t.glName)}e.activeTexture(Aa.xM+this._state.activeTexture);const t=this._state.viewport;e.viewport(t.x,t.y,t.width,t.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function fO(e,t,r,i){return t?i!==t&&e.bindBuffer(r,t.glName):e.bindBuffer(r,null),t}function mO(e,t){switch(e){case Aa.WR.POINTS:return 2*t;case Aa.WR.TRIANGLES:return t/3;case Aa.WR.TRIANGLE_STRIP:case Aa.WR.TRIANGLE_FAN:return t-2;default:return 0}}class gO extends pO{constructor(e,t,r){super(e,t),this.gl=e,this.newCache=r,this._appleAmdDriverHelper=null,this._refCount=1,this.screen=new $P(this)}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){super.dispose(),this._appleAmdDriverHelper?.dispose(),this.screen.destroy()}bindTechnique(e,t,r,i,n){return this.useProgram(e.program),this.setPipelineState(e.getPipeline(!!n)),e.program.bindPass(r,t),i&&e.program.bindDraw(i,t,r),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??=new qP(this),this._appleAmdDriverHelper.run())}get test(){}}function yO(e){return!!e.frameUpdate}var _O=r(40325),vO=r(86967);let bO=class extends ht.A{constructor(e,t,r){super({}),this._stage=e,this._techniques=t,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new pt.A,this._frameTask=e.view.resourceController.scheduler.registerTask(ll.W6.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(wA.X.Texture,(e=>e.unload()))}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return null==this._textureTechnique&&(this._textureTechnique=this._techniques.acquire(_O.e,new vO.M)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),t.loadingPromise??t):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach((t=>{const r=t.texture.frameUpdate(t.previousToken);r>=0&&r!==t.previousToken&&(t.previousToken=r,e=!0)})),e&&this.events.emit("changed",hx.C7.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(null==t)return(0,kl.vA)(void 0!==t),null;const r=t.events.on("unloaded",(()=>{r.remove(),this._onTextureUnloaded(e)})),i=new wO(e,(()=>{this._frameTask.schedule((()=>{i.isUnreferenced&&t.unload()}))}));return this._textures.set(e,i),i.ref(),t.glTexture?(this._updateGLTexture(i,t.glTexture),yO(t)&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),i):(this._loadingCount++,i.loadingPromise=this._stage.schedule((()=>{const r=t.load(this._rctx),n=r=>(this._loadingCount--,i.loadingPromise=null,this._updateGLTexture(i,r),yO(t)&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),i);return(0,Ke.$X)(r)?r.then(n,(e=>(this._loadingCount--,i.loadingPromise=null,(0,Ke.zf)(e)||Xe.A.getLogger(this).error(e),null))):n(r)})),i.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",hx.C7.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};(0,ze._)([(0,Qe.MZ)()],bO.prototype,"_loadingCount",void 0),(0,ze._)([(0,Qe.MZ)()],bO.prototype,"_frameTask",void 0),(0,ze._)([(0,Qe.MZ)()],bO.prototype,"updating",null),bO=(0,ze._)([(0,tt.$)("esri.views.3d.webgl-engine.lib.TextureRepository")],bO);class wO{constructor(e,t){this.id=e,this._release=t,this._refCount=0}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(0!==this._refCount?(Xe.A.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}var xO=r(99443),SO=r(73999);var TO=r(95901);let MO=class extends ht.A{constructor(){super(...arguments),this._passParameters=new AO,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=(0,Je.DC)(this._resourcesTask),this._passParameters.waveNormal=(0,Je.WD)(this._passParameters.waveNormal),this._passParameters.wavePerturbation=(0,Je.WD)(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=(0,Fn.UT)((async t=>{await Promise.allSettled([this._loadImageResource(e,(0,ic.s)("esri/images/materials/water/normals.jpg"),(e=>this._passParameters.waveNormal=e),t),this._loadImageResource(e,(0,ic.s)("esri/images/materials/water/perturbation.jpg"),(e=>this._passParameters.wavePerturbation=e),t)])}))),this._resourcesTask.finished?hx.Am.LOADED:hx.Am.LOADING}async _loadImageResource(e,t,r,i){try{const n=await(0,gE.D)(t,{signal:i});(0,Ke.Te)(i);const s=new sl.R(n.width,n.height);s.pixelFormat=Aa.Ab.RGB,s.samplingMode=Aa.Cj.LINEAR_MIPMAP_LINEAR,s.hasMipmap=!0,s.maxAnisotropy=8,r(new Pl.g(e,s,n))}catch(n){Xe.A.getLogger(this).error("Failed to load water material normal texture.",n)}}};(0,ze._)([(0,Qe.MZ)()],MO.prototype,"_resourcesTask",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean,readOnly:!0})],MO.prototype,"updating",null),MO=(0,ze._)([(0,tt.$)("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],MO);class AO extends wa.Y{}const CO=new Map;function EO(){return CO}var RO=r(16770);function PO(e,t){const{format:r,quality:i,rotation:n,disableDecorations:s}=e||{},o=FO(e,t.padding),a=function(e,t){const r={x:0,y:0,width:t.width,height:t.height};if(e?.area){null!=e.area.x&&(r.x=Math.floor(e.area.x)),null!=e.area.y&&(r.y=Math.floor(e.area.y));const i=null!=e.area.width?Math.floor(e.area.width):null,n=null!=e.area.height?Math.floor(e.area.height):null;if(r.width=t.width-r.x,r.height=t.height-r.y,null!=i&&null!=n)r.width=Math.min(r.width,i),r.height=Math.min(r.height,n);else if(null==i&&null!=n){const e=Math.min(r.width,i);r.height=e/r.width*r.height,r.width=e}else if(null!=i&&null==n){const e=Math.min(r.height,n);r.width=e/r.height*r.width,r.height=e}}return function(e,t){const r=Math.floor(Math.max(e.x,0)),i=Math.floor(Math.max(e.y,0)),n={x:r,y:i,width:Math.floor(Math.min(e.width,t.width-r)),height:Math.floor(Math.min(e.height,t.height-i))},s=n.width/n.height,o=e.width/e.height;if(o===s)return n;if(o>s){const e=Math.floor(n.width/o),t=n.height-e;return{x:n.x,y:Math.floor(n.y+t/2),width:n.width,height:e}}const a=Math.floor(n.height*o),l=n.width-a;return{x:Math.floor(n.x+l/2),y:n.y,width:a,height:n.height}}(function(e,t){if(null==t?.width||null==t.height)return e;const r=t.width/t.height,i=e.width/e.height;if(i===r)return e;if(i<r){const t=Math.floor(e.height*r);return e.x-=(t-e.width)/2,e.width=t,e}const n=Math.floor(e.width/r);return e.y-=(n-e.height)/2,e.height=n,e}(r,e),t)}(e,{width:t.width-o.left-o.right,height:t.height-o.top-o.bottom}),{width:l,height:c}=function(e,t){if(!e)return t;const r=e.width,i=e.height;if(null!=r&&null!=i)return{width:Math.floor(r),height:Math.floor(i)};if(null==r&&null==i)return t;const n=t.width/t.height;return null==i?{width:Math.floor(r),height:Math.floor(r/n)}:{width:Math.floor(i*n),height:Math.floor(i)}}(e,a),u=kO(r),h=VO[u];return{format:u,quality:(0,ws.qE)(null!=i?i:h,0,100),area:a,width:l,height:c,rotation:n,disableDecorations:!!s,ignoreBackground:!!e?.ignoreBackground,ignorePadding:!!e?.ignorePadding}}function OO(e,t,r){const{ctx:i,canvas:n}=LO(e,r),s=i.getImageData(0,0,e.width,e.height),o=function(e,t){const r=zO[t.format],i=t.quality/100;return e.toDataURL(r,i)}(n,t);return NO(n),{dataUrl:o,data:s}}function IO(e,t){const{ctx:r,canvas:i}=LO(e,t),n=r.getImageData(0,0,e.width,e.height);return NO(i),n}function LO(e,t){const r=(null==DO&&(DO=document.createElement("canvas")),DO);t.premultipliedAlpha&&function(e){const t=e.data,r=t.length;for(let i=0;i<r;i+=4){const e=t[i+3];if(255!==e&&e>0){const r=255/e;t[i]=t[i]*r,t[i+1]=t[i+1]*r,t[i+2]=t[i+2]*r}}}(e),r.width=e.width,r.height=e.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(e,0,0),t.flipY&&function(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}(i),{ctx:i,canvas:r}}function NO(e){e.width=0,e.height=0}let DO=null;function FO(e,t){return!t||e?.ignorePadding?BO:t}function kO(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return UO}}const zO={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},UO="png",VO={png:100,jpg:98,jpeg:98},BO={top:0,right:0,bottom:0,left:0};class jO{constructor(e,t,r){this.parameters=e,this.frameHasDecorations=t,this.fbos=r}}class HO{constructor(e,t,r){this._rctx=e,this._renderFunctions=t,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(hx.C7.BACKGROUND);const t=(0,Ke.Tw)();return this._screenshotQueue.push({settings:e,resolver:t}),t.promise}update(e,t){for(const r of this._screenshotQueue){if(null==this._rctx){r.resolver.reject();continue}const i={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,i,t);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,t,r){e.width=t.width,e.height=t.height;const i=e.getContext("2d"),n=r.pixelRatio;return i.save(),i.translate(0,t.height),i.scale(1,-1),r.region&&i.translate(-r.region.x,-r.region.y),i.scale(n,n),t=this._renderFunctions.renderOverlay(e,r.disableDecorations?hx.ID.OFF:hx.ID.ON,t),i.restore(),t}_readbackScreenshot(e,t){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},t):this._readbackScreenshotImmediate(e,t)}_readbackScreenshotResampled(e,t){const{framebufferWidth:r,framebufferHeight:i,region:n,resample:s}=e,o=this._ensureScreenshotEncodeCanvas();let a=(0,RO.xR)(r,i,o);this._rctx.gl.readPixels(0,0,r,i,Aa.Ab.RGBA,Aa.pe.UNSIGNED_BYTE,new Uint8Array(a.data.buffer)),t(),a=this._renderScreenshotOverlay(o,a,{...e,region:void 0});return function(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.width-i,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e.height-n,a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{data:l}=e,{width:c,height:u,data:h}=t,d=s/c,p=o/u,f=Math.ceil(d/2),m=Math.ceil(p/2),g=e.width;for(let y=0;y<u;y++)for(let e=0;e<c;e++){const t=4*(e+(a?u-y-1:y)*c);let s=0,o=0,_=0,v=0,b=0,w=0;const x=(y+.5)*p;for(let a=Math.floor(y*p);a<(y+1)*p;a++){const t=Math.abs(x-(a+.5))/m,c=(e+.5)*d,u=t*t;for(let h=Math.floor(e*d);h<(e+1)*d;h++){const e=Math.abs(c-(h+.5))/f,t=Math.sqrt(u+e*e);if(t>=1)continue;let d=2*t*t*t-3*t*t+1;const p=4*(i+h+(n+a)*g);w+=d*l[p+3],o+=d,!r&&l[p+3]<255&&(d=d*l[p+3]/255),_+=d*l[p],v+=d*l[p+1],b+=d*l[p+2],s+=d}}h[t]=_/s,h[t+1]=v/s,h[t+2]=b/s,h[t+3]=w/o}return t}(a,(0,RO.xR)(n.width,n.height,o),!0,s.region.x,i-(s.region.y+s.region.height),s.region.width,s.region.height)}_readbackScreenshotImmediate(e,t){const{framebufferHeight:r,region:i}=e,n=this._ensureScreenshotEncodeCanvas(),s=(0,RO.xR)(i.width,i.height,n);return this._rctx.gl.readPixels(i.x,r-(i.y+i.height),i.width,i.height,Aa.Ab.RGBA,Aa.pe.UNSIGNED_BYTE,new Uint8Array(s.data.buffer)),t(),this._renderScreenshotOverlay(n,s,e)}_renderScreenshot(e,t,r){const i=e.parameters.camera,n={width:t.framebufferWidth,height:t.framebufferHeight};(0,nl.T)(n,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let s=!1;const o=t.disableDecorations&&e.frameHasDecorations,a=n.width!==i.fullWidth||n.height!==i.fullHeight,l=t.ignorePadding&&i.pixelRatio!==t.pixelRatio,c=a||o||l||t.objectAndLayerIdColor;let u=null,h=null;if(c){const e=i.clone();if(t.ignorePadding){const r=(0,ya.o8)(e.padding);for(let i=0;i<4;i++)r[i]=Math.round(r[i]/e.pixelRatio*t.pixelRatio);e.padding=r}e.fullWidth=n.width,e.fullHeight=n.height,e.pixelRatio=t.pixelRatio;const o=i.fovX-e.fovX,a=i.fovY-e.fovY;o<0&&o<a?e.fovX=i.fovX:a<0&&a<o&&(e.fovY=i.fovY);const l={camera:e,contentCamera:e,mode:fm.M.IDLE,alignPixelEnabled:!0,contentPixelRatio:e.pixelRatio};this._forceCameraHook(l),s=!0;const c=this._renderFunctions.renderScene(l,r,t.objectAndLayerIdColor?dm.fS.ObjectAndLayerID:dm.fS.Screenshot,t.disableDecorations?hx.ID.OFF:hx.ID.ON);h=c.screen,u=c.oid}this._rctx.bindFramebuffer(h?.fbo);const d=this._readbackScreenshot(t,(()=>{this._rctx.bindFramebuffer(null),h?.release()}));let p=null;if(t.objectAndLayerIdColor){const e=()=>{this._rctx.bindFramebuffer(null),u?.release()};this._rctx.bindFramebuffer(u?.fbo),p=this._readbackScreenshot(t,e),this._rctx.bindFramebuffer(null)}if(c&&!this._rctx.contextAttributes.alpha)for(let f=3;f<d.data.length;f+=4)d.data[f]=255;if(p&&!this._rctx.contextAttributes.alpha)for(let f=3;f<p.data.length;f+=4)p.data[f]=255;return s&&this._forceCameraHook(e.parameters),[d,p]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}const GO=!1;var ZO=r(28007);let $O=class extends ht.A{constructor(e){super({}),this.events=new pt.A,this.waterTextures=new MO,this.objectAndLayerIdRenderHelper=(0,it.A)("enable-feature:objectAndLayerId-rendering")?new lR:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode;try{this._initializeContext(e)}catch(i){return void console.error("Failed to initialize context",i)}const{memoryController:t}=e.view.resourceController;this.stippleTextures=(0,TO.Ry)(this._rctx,t),this.markerTextures=function(e,t){return new SO.f((t=>(0,xO.sS)(t,e)),(e=>e),t)}(this._rctx,t),this._techniques=new QC.I({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextures:this.stippleTextures,waterTextures:this.waterTextures,markerTextures:this.markerTextures}),this._textures=new bO(e,this._techniques,this._rctx),this.addHandles(this._textures.events.on("changed",(e=>this.requestRender(e)))),this._materials=new oR.v(this._textures,this._techniques,(()=>this.requestRender()),(()=>this.requestRender())),this._compositingHelper=new zE(this._rctx,this._techniques),this.renderer=new DP(e,this._materials,this._techniques,this._rctx,this._compositingHelper,(e=>this.requestRender(e))),this.addHandles([(0,gt.wB)((()=>e.view.ready),(t=>{t&&this._createRenderNodes(e.view,e.viewingMode)}),gt.Vh),(0,gt.wB)((()=>this.waterTextures?.updating),(()=>this.requestRender()),gt.Vh),(0,gt.wB)((()=>e.view.qualityProfile),(e=>this.renderer?.updateRenderFeatures(e)),gt.pc)]);const r={renderScene:(e,t,r,i)=>this.renderer.render(e,t,r,i),requestRenderScene:e=>this.requestRender(e),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(t,r,i)=>e.options.screenshot.renderOverlay(t,r,i)};this._screenshotManager=new HO(this._rctx,r,(e=>this.events.emit("force-camera-for-screenshot",e))),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=(0,Je.xt)(this._frameTask),this._techniques=(0,Je.pR)(this._techniques),this._componentObjects=(0,Je.pR)(this._componentObjects),this._screenshotManager=(0,Je.pR)(this._screenshotManager),(0,Je.pR)(this.renderer),this._textures=(0,Je.pR)(this._textures),(0,Je.pR)(this.waterTextures),(0,Je.pR)(this.markerTextures),(0,Je.pR)(this.stippleTextures),this._canvas=null,this._container=null,this._rctx=(0,Je.pR)(this._rctx)}_createRenderNodes(e,t){new PE.n({view:e,isEnabled:()=>this.renderer.hasSSAO,techniques:this._techniques}),new CE({view:e,isEnabled:()=>this.renderer.hasSMAA,techniques:this._techniques}),new vE({view:e,techniques:this._techniques}),new lE({view:e,techniques:this._techniques}),new fE({view:e,viewingMode:t,techniques:this._techniques})}requestRender(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hx.C7.UPDATE;this._needsRender=!0,e===hx.C7.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get compositingHelper(){return this._compositingHelper}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then((e=>e[0]))}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,t,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n;const o=i.constrainWindowSize(t,r,n*i.pixelRatio,s*i.pixelRatio),a=this._ensureDepthBuffer(o);this.renderer.readDepthPixels(o,a);let l=Number.MAX_VALUE;for(let c=0;c<o[2]*o[3];c++){const e=ZE(4*c,a,i.nearFar);l>e&&e!==i.nearFar[0]&&e!==i.nearFar[1]&&(l=e)}if(e){const n=e.pickDepth(t*i.pixelRatio,r*i.pixelRatio,i);null!=n&&l>n&&n!==i.nearFar[0]&&n!==i.nearFar[1]&&(l=n)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(null==this._tmpDepthBuffer||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}async reloadShaders(){mx(),await this._techniques.reloadAll(),this.requestRender()}_registerFrameTask(e){const t=e.view.state;let r=!1,i=hx.C7.BACKGROUND,n=!1;const s={preRender:n=>{let{time:s}=n;r=this.updating,i=this._needsUpdate?hx.C7.UPDATE:hx.C7.BACKGROUND,e.commitSyncLayers();const o=(0,ql.l5)(s-this._lastAnimationUpdate);if(o>this.renderer.animationTimestep||null!=t.forcedAnimationTime||r||this._needsRender){const e=(0,ql.l5)(o/this.renderer.animationTimeDilation),r=new px.sP(t.camera,e,t.forcedAnimationTime);this.renderer.updateAnimation(r)&&this.requestRender(hx.C7.BACKGROUND),this._lastAnimationUpdate=s}},render:e=>{let{time:r}=e;if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const e=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(t,r),n=!0,e&&this.renderer.hasReflections&&(this.requestRender(hx.C7.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:e=>{let{time:r}=e;const i=this.renderer.hasSlicePlane||this.renderer.hasDecorations||this.renderer.hasHighlights,n=new jO(t,i,this.renderer.fboCache);this._textures.update(),this._screenshotManager.update(n,r)},finish:()=>{n&&(this.renderer.finish(t.mode===fm.M.IDLE?i:hx.C7.UPDATE),n=!1)}};this._frameTask=(0,Ji.mg)(s)}_initializeContext(e){const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:t.preserveDrawingBuffer??!1},i=(0,ZO.q)(this._canvas,r);null!=i?(this._rctx=function(e,t){const r={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},i=(e,r)=>t.view.resourceController.memoryController.newCache(e,r);if(GO){let t=qO.get(e);return t?(t.configure(r),t.newCache=i,t.ref(),t):(t=new gO(e,r,i),qO.set(e,t),t.ref(),t)}return new gO(e,r,i)}(i,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&Xe.A.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&(0,it.A)("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):Xe.A.getLogger(this).error("A WebGL2 context could not be created.")}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}getObjectAndLayerIdColor(e){return null!=this.objectAndLayerIdRenderHelper?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return null==this._componentObjects&&(this._componentObjects=new YC(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(e){this._componentObjects=e}};(0,ze._)([(0,Qe.MZ)({type:Boolean,readOnly:!0})],$O.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)()],$O.prototype,"_rctx",void 0),(0,ze._)([(0,Qe.MZ)()],$O.prototype,"_container",void 0),(0,ze._)([(0,Qe.MZ)()],$O.prototype,"_canvas",void 0),(0,ze._)([(0,Qe.MZ)()],$O.prototype,"stippleTextures",void 0),(0,ze._)([(0,Qe.MZ)()],$O.prototype,"markerTextures",void 0),(0,ze._)([(0,Qe.MZ)()],$O.prototype,"waterTextures",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],$O.prototype,"objectAndLayerIdRenderHelper",void 0),(0,ze._)([(0,Qe.MZ)()],$O.prototype,"_textures",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],$O.prototype,"renderer",void 0),(0,ze._)([(0,Qe.MZ)()],$O.prototype,"_screenshotManager",void 0),(0,ze._)([(0,Qe.MZ)()],$O.prototype,"componentObjectCollection",null),(0,ze._)([(0,Qe.MZ)()],$O.prototype,"_componentObjects",void 0),(0,ze._)([(0,Qe.MZ)()],$O.prototype,"_needsUpdate",void 0),(0,ze._)([(0,Qe.MZ)()],$O.prototype,"_needsWaterReflectionUpdate",void 0),$O=(0,ze._)([(0,tt.$)("esri.views.3d.webgl-engine.parts.RenderView")],$O);const qO=EO();let WO=class extends ht.A{constructor(e){super(e),this._model=new EA,this._layers=new Ty.A,this._asyncChangeSet=new _A.VR,this._syncChangeSet=new _A.VR,this._layerSyncSet=new Set}initialize(){this._set("renderView",new $O(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(ll.W6.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(e){this._model.add(e),(0,bA.r)(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){null!=e&&!this.destroyed&&this._model.remove(e)&&((0,bA.r)(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){null!=e&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){null!=e&&(this._model?.removeMany(e),this.renderView?.requestRender())}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),!e.hasProgressed)return cl.G}_commit(e){const t=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll((r=>{if(e.done)return;const i=this._layerSyncSet.has(r.id)||r.updatePolicy===vA.q.SYNC,n=i?this._syncChangeSet:this._asyncChangeSet;t.commitLayer(r.id,n),this._layerSyncSet.delete(r.id),n.empty||(this.renderer.modify(n,i?ll.Bb:e),this.renderView.requestRender(),e.madeProgress())})),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,ll.Bb),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll((r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==vA.q.ASYNC||(t.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))})),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll((t=>{this._layerSyncSet.has(t.id)||t.updatePolicy===vA.q.SYNC?(e.commitLayer(t.id,this._syncChangeSet),this._layerSyncSet.delete(t.id)):e.commitSyncUpdates(t.id,this._syncChangeSet)}));for(const t of this._layerSyncSet)e.commitLayer(t,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,ll.Bb),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,ll.Bb),this.renderView.requestRender())}schedule(e,t){return this._frameTask.schedule(e,t)}reschedule(e,t){return this._frameTask.reschedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),null!=this._layers.removeUnordered(e)&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,ll.Bb))}addRenderPlugin(e,t){const r=this.renderer.plugins.add(e,t),i=()=>{sb(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if((0,Ke.$X)(r))return r.then(i);i()}removeRenderPlugin(e){this.destroyed||(sb(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){}};WO.DebugSettings={endFrameContentValidation:!1},(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],WO.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],WO.prototype,"options",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],WO.prototype,"viewingMode",null),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],WO.prototype,"container",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],WO.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],WO.prototype,"_model",void 0),(0,ze._)([(0,Qe.MZ)()],WO.prototype,"renderView",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],WO.prototype,"renderer",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],WO.prototype,"running",null),WO=(0,ze._)([(0,tt.$)("esri.views.3d.webgl-engine.Stage")],WO);var YO=r(90992),XO=r(59801),JO=r(9685);const KO="esri-component";let QO=class extends ht.A{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(e){this._set("id",e)}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(KO),t&&t.classList.remove(KO),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?"string"==typeof e||function(e){return e&&"nodeType"in e}(e)?(this._set("widget",null),(0,Wi.$H)(e)):(function(e){return e&&"function"==typeof e.render}(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};(0,ze._)([(0,Qe.MZ)()],QO.prototype,"id",null),(0,ze._)([(0,Qe.MZ)()],QO.prototype,"node",null),(0,ze._)([(0,ft.w)("node")],QO.prototype,"castNode",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],QO.prototype,"widget",void 0),QO=(0,ze._)([(0,tt.$)("esri.views.ui.Component")],QO);const eI=QO;r(11265);var tI=r(91896),rI=r(76099),iI=r(38042);const nI={left:0,top:0,bottom:0,right:0},sI={bottom:30,top:15,right:15,left:15},oI="esri-ui",aI={ui:oI,corner:`${oI}-corner`,innerContainer:`${oI}-inner-container`,manualContainer:`${oI}-manual-container`,cornerContainer:`${oI}-corner-container`,topLeft:`${oI}-top-left`,topRight:`${oI}-top-right`,bottomLeft:`${oI}-bottom-left`,bottomRight:`${oI}-bottom-right`};function lI(e){return 0===e?"0":`${e}px`}function cI(e){const t="object"==typeof e&&null!==e&&Object.getPrototypeOf(e);return null!==t&&t!==Object.prototype||!("component"in e||"index"in e||"position"in e)?null:e}function uI(e,t){let{top:r,bottom:i,left:n,right:s}=t;e.style.top=r,e.style.bottom=i,e.style.left=n,e.style.right=s}let hI=class extends pt.A.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=(0,iI.JK)(),this.view=null,this._applyViewPadding=()=>{const e=this.container;e&&uI(e,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const e=this._innerContainer;e&&uI(e,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([(0,gt.wB)((()=>[this.view?.padding,this.container]),this._applyViewPadding,gt.Vh),(0,gt.wB)((()=>this.padding),this._applyUIPadding,gt.Vh),(0,gt.wB)((()=>[this.container,this._locale]),(e=>{let[t,r]=e;t&&t.setAttribute("lang",r)}),gt.Vh),(0,iI.oQ)((e=>{this._locale=e}))])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(aI.ui),(0,tI.hY)(e),this._attachContainers(e)),t&&(t.classList.remove(aI.ui),uI(t,{top:"",bottom:"",left:"",right:""}),(0,Wi.Ie)(t)),this._set("container",e))}get height(){const e=this.view?.height??0;if(0===e)return e;const t=this._getViewPadding(),{top:r,bottom:i}=t;return Math.max(e-r-i,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return"number"==typeof e?{bottom:e,top:e,right:e,left:e}:{...sI,...e}}get width(){const e=this.view?.width??0;if(0===e)return e;const t=this._getViewPadding(),{left:r,right:i}=t;return Math.max(e-r-i,0)}add(e,t){let r,i,n;if(Array.isArray(e))return void e.forEach((e=>this.add(e,t)));const s=cI(e);s&&({index:r,position:t,component:e,key:i}=s),t&&"object"==typeof t&&({index:r,key:i,position:t,internal:n}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,r,i,n)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map((e=>this.remove(e,t)));const r=this._find(e);if(r){if(this._componentMap.has(r)&&this._componentMap.get(r)?.key!==t)return;const e=this._components.indexOf(r),i=r.node.parentNode;return i?.removeChild(r.node),this._componentMap.delete(r),r.widget?.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(e,1)[0]}}empty(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{removeInternal:!1};if(Array.isArray(e)){for(const r of e)this.empty(r,t);return}const r=this._positionNameToContainerLookup[e??"manual"],i=Array.prototype.slice.call(r.children).map((e=>this._findByNode(e))).filter((e=>null!=e&&(!this._componentMap.get(e)?.internal||t.removeInternal)));for(const n of i)this.remove(n)}move(e,t){if(Array.isArray(e)&&e.forEach((e=>this.move(e,t))),!e)return;let r;const i=cI(e)||cI(t);if(i&&(r=i.index,t=i.position,e=i.component||e),t&&!this._isValidPosition(t))return;const n=this.remove(e);n&&this.add(n,{position:t,index:r})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getComponents(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{includeInternal:!1};return e?Array.isArray(e)?e.flatMap((e=>this._getComponentsAtPosition(e,t))):this._getComponentsAtPosition(e,t):this._components.filter((e=>t.includeInternal||!this._componentMap.get(e)?.internal)).map((e=>{let{widget:t,node:r}=e;return t??r}))}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,r,i,n){e instanceof eI||(e=new eI({node:e}));const{widget:s}=e;null!=s&&s instanceof ht.A&&s.addHandles((0,mt.hA)((()=>{queueMicrotask((()=>this.remove(e)))})),this._removeWidgetHandleKey),this._place({component:e,position:t,index:r}),this._components.push(e),this._componentMap.set(e,{key:i,internal:n})}_find(e){return e?e instanceof eI?this._findByComponent(e):"string"==typeof e?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.view?.padding??nI}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(aI.innerContainer,aI.cornerContainer);const t=document.createElement("div");t.classList.add(aI.innerContainer,aI.manualContainer);const r=document.createElement("div");r.classList.add(aI.topLeft,aI.corner),e.appendChild(r);const i=document.createElement("div");i.classList.add(aI.topRight,aI.corner),e.appendChild(i);const n=document.createElement("div");n.classList.add(aI.bottomLeft,aI.corner),e.appendChild(n);const s=document.createElement("div");s.classList.add(aI.bottomRight,aI.corner),e.appendChild(s),this._innerContainer=e,this._manualContainer=t;const o=(0,rI.V8)();this._cornerNameToContainerLookup={"top-left":r,"top-right":i,"bottom-left":n,"bottom-right":s,"top-leading":o?i:r,"top-trailing":o?r:i,"bottom-leading":o?s:n,"bottom-trailing":o?n:s},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.position??"manual",{component:r,index:i}=e,n=this._positionNameToContainerLookup[t],s=null!=i&&i>-1;if(function(e){return e&&!e._started&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}(r.widget)&&r.widget.startup(),!s)return void n.appendChild(r.node);const o=Array.from(n.children);0!==i?i>=o.length?n.appendChild(r.node):(0,Wi.nc)(r.node,o[i]):n.firstChild?(0,Wi.nc)(r.node,n.firstChild):n.appendChild(r.node)}_toPixelPosition(e){return{top:lI(e.top),left:lI(e.left),right:lI(e.right),bottom:lI(e.bottom)}}_findByComponent(e){return this._components.find((t=>t===e))??null}_findById(e){return this._components.find((t=>{let{id:r}=t;return r===e}))??null}_findByNode(e){return this._components.find((t=>{let{node:r}=t;return r===e}))??null}_getComponentsAtPosition(e,t){const r=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(r.children).map((e=>this._findByNode(e))).filter(Dt.Ru).filter((e=>t.includeInternal||!this._componentMap.get(e)?.internal)).map((e=>{let{widget:t,node:r}=e;return t??r}))}};(0,ze._)([(0,Qe.MZ)()],hI.prototype,"_locale",void 0),(0,ze._)([(0,Qe.MZ)()],hI.prototype,"container",null),(0,ze._)([(0,Qe.MZ)()],hI.prototype,"height",null),(0,ze._)([(0,Qe.MZ)({value:sI})],hI.prototype,"padding",null),(0,ze._)([(0,ft.w)("padding")],hI.prototype,"castPadding",null),(0,ze._)([(0,Qe.MZ)()],hI.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)()],hI.prototype,"width",null),hI=(0,ze._)([(0,tt.$)("esri.views.ui.UI")],hI);const dI=hI;var pI=r(25329),fI=r(75228);function mI(e,t){return e&&"copyright"in e&&(!t||"function"==typeof e.originOf&&"user"===e.originOf("copyright"))}function gI(e,t,r){r&&t&&(e.find((e=>e.layerView===t&&e.text===r))||e.push({text:r,layerView:t}))}const yI=[];let _I=class extends ht.A{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new je.A,this.view=null,this._allLayerViewsChange=e=>{this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const t=this.view?.allLayerViews;t&&(this.addHandles(t.map((e=>(0,gt.wB)((()=>[e.suspended,e.layer?.attributionVisible]),(()=>this._updateAttributionItems())))).toArray(),"suspension"),t.forEach((e=>{"esri.views.3d.layers.Tiles3DLayerView3D"===e.declaredClass&&this.addHandles(e.on("visible-geometry-changed",(()=>this._updateAttributionItems())),"visible-geometry-changed")}))),e?.removed&&e.removed.forEach((e=>{this._pendingAttributions.delete(e),this._fetchedAttributionData.delete(e)})),this._updateAttributionItems()},this.addHandles([(0,gt.on)((()=>this.view?.allLayerViews),"change",(e=>this._allLayerViewsChange(e)),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),(0,gt.z7)((()=>!0===this.view?.stationary),(()=>this._updateAttributionItems()))])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.view?.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,t=e?.allLayerViews;if(yI.length=0,!e||!t)return void this._clear();t.forEach((t=>{if(t.suspended||!t.layer?.attributionVisible)return;const r=t.layer;if(mI(r,"user"))return void gI(yI,t,r.copyright);if(r.hasAttributionData){if(this._fetchedAttributionData.has(t)){const i=this._fetchedAttributionData.get(t);return void(i?gI(yI,t,this._getDynamicAttribution(i,e,r)):mI(r)&&gI(yI,t,r.copyright))}return void this._fetchAttributionData(t)}const i="portalItem"in r?r.portalItem?.accessInformation:void 0;gI(yI,t,i||r.copyright)}));const r=t.find((e=>"integrated-mesh-3dtiles"===e.layer?.type));if(this.view&&r){const e=(0,fI.pw)(this.view);if(e){const t=e.getAttributionText();for(let e=0;e<t.length;++e)gI(yI,r,t[e])}}(function(e,t){return e.length!==t.length||e.some(((e,r)=>e.text!==t[r].text))})(this.items,yI)&&(this.items.removeAll(),this.items.addMany(yI)),yI.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await(0,Fn.Ke)(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=t.ok?this._createContributionIndex(t.value,function(e){return"bing-maps"===e.type}(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,t){const r=e.contributors,i={};if(!r)return i;for(let n=0;n<r.length;n++){const e=r[n],s=e.coverageAreas;if(!s)return;for(const r of s){const s=r.bbox,o=r.zoomMin-(t&&r.zoomMin?1:0),a=r.zoomMax-(t&&r.zoomMax?1:0),l=new Zn.A({xmin:s[1],ymin:s[0],xmax:s[3],ymax:s[2],spatialReference:Bt.A.WGS84}),c={extent:(0,$r.Gh)(l),attribution:e.attribution||"",score:null!=r.score?r.score:100,id:n};for(let e=o;e<=a;e++)i[e]??=[],i[e].push(c)}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}_getDynamicAttribution(e,t,r){const{extent:i,scale:n}=t;let s=r.tileInfo?.scaleToZoom(n)??0;if(s=Math.min(e.maxKey??0,Math.round(s)),!i||null==s||s<=-1)return"";const o=e[s],a=(0,$r.Cv)(i.center.clone().normalize(),t.spatialReference),l=new Set;return o?o.filter((e=>{const t=e.id,r=!l.has(t)&&a&&e.extent&&(0,Rn.qz)(e.extent,a);return r&&l.add(t),r})).sort(((e,t)=>t.score-e.score||e.objectId-t.objectId)).map((e=>e.attribution)).join(", "):""}};(0,ze._)([(0,Qe.MZ)({readOnly:!0,type:je.A})],_I.prototype,"items",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],_I.prototype,"state",null),(0,ze._)([(0,Qe.MZ)()],_I.prototype,"view",void 0),_I=(0,ze._)([(0,tt.$)("esri.widgets.Attribution.AttributionViewModel")],_I);const vI=_I;var bI=r(98108),wI=r(20459),xI=r(63582),SI=r(54761);const TI="esri-attribution",MI={base:TI,poweredBy:`${TI}__powered-by`,sources:`${TI}__sources`,open:`${TI}--open`,sourcesOpen:`${TI}__sources--open`,link:`${TI}__link`};let AI=class extends pI.A{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver((e=>e.forEach((e=>{let{target:t}=e;return this._checkSourceTextOverflow(t)})))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new vI}initialize(){this.addHandles((0,gt.on)((()=>this.viewModel?.items),"change",(()=>this.scheduleRender())))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce(((e,t)=>(e.includes(t.text)||e.push(t.text),e)),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[MI.open]:this._isOpen};return(0,SI.K)("div",{bind:this,class:this.classes(MI.base,bI.D.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return(0,SI.K)("div",{class:MI.poweredBy},"Powered by"," ",(0,SI.K)("a",{class:MI.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,r=t?0:void 0,{attributionText:i}=this,n={[MI.sourcesOpen]:e,[bI.D.interactive]:t};return(0,SI.K)("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(MI.sources,n),innerHTML:i,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:r,clientWidth:i,scrollWidth:n}=e,s=n>i,o=this._attributionTextOverflowed!==s;if(this._attributionTextOverflowed=s,o&&(t=!0),this._isOpen){const e=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,e&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};(0,ze._)([(0,Qe.MZ)()],AI.prototype,"_isOpen",void 0),(0,ze._)([(0,Qe.MZ)()],AI.prototype,"_isInteractive",null),(0,ze._)([(0,Qe.MZ)()],AI.prototype,"_attributionTextOverflowed",void 0),(0,ze._)([(0,Qe.MZ)()],AI.prototype,"_prevSourceNodeHeight",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],AI.prototype,"attributionText",null),(0,ze._)([(0,Qe.MZ)()],AI.prototype,"icon",null),(0,ze._)([(0,Qe.MZ)()],AI.prototype,"itemDelimiter",void 0),(0,ze._)([(0,Qe.MZ)()],AI.prototype,"label",null),(0,ze._)([(0,Qe.MZ)(),(0,xI.G)("esri/widgets/Attribution/t9n/Attribution")],AI.prototype,"messages",void 0),(0,ze._)([(0,Qe.MZ)()],AI.prototype,"view",null),(0,ze._)([(0,Qe.MZ)({type:vI})],AI.prototype,"viewModel",void 0),(0,ze._)([(0,wI.$)()],AI.prototype,"_toggleState",null),AI=(0,ze._)([(0,tt.$)("esri.widgets.Attribution")],AI);const CI=AI;var EI=r(79535);let RI=class extends((0,EI.R)(ht.A)){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles((0,gt.wB)((()=>this.view),this._updateRotationWatcher,gt.Vh))}destroy(){this.view=null}get canShowNorth(){return function(e){return e?.spatialReference?.isWebMercator||e?.spatialReference?.isGeographic||!1}(this.view)}get state(){return!this.view?.ready||"2d"===this.view.type&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){this.view?.ready&&("2d"===this.view?.type?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:(0,ql.l5)((0,it.A)("mapview-essential-goto-duration"))}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){null!=e&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this._set("orientation",{x:0,y:0,z:t})}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles("2d"===e.type?(0,gt.wB)((()=>e?.rotation),this._updateForRotation,gt.Vh):(0,gt.wB)((()=>e?.camera),this._updateForCamera,gt.Vh))}};(0,ze._)([(0,Qe.MZ)({readOnly:!0})],RI.prototype,"canShowNorth",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],RI.prototype,"orientation",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],RI.prototype,"state",null),(0,ze._)([(0,Qe.MZ)()],RI.prototype,"view",void 0),RI=(0,ze._)([(0,tt.$)("esri.widgets.Compass.CompassViewModel")],RI);const PI=RI,OI="esri-compass",II={base:OI,iconContainer:`${OI}__icon-container`};var LI=r(77666);let NI=class extends pI.A{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new PI,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=e=>({transform:`rotateZ(${e.z}deg)`})}loadDependencies(){return(0,LI.W)({button:()=>Promise.all([r.e(9879),r.e(2785),r.e(4933),r.e(2602)]).then(r.bind(r,52602)),icon:()=>Promise.all([r.e(9879),r.e(5012)]).then(r.bind(r,95012))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"rotation"===this.viewModel.state?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,{messages:r}=this;return(0,SI.K)("div",{class:this.classes(II.base,bI.D.widget)},(0,SI.K)("calcite-button",{class:bI.D.widgetButton,disabled:"disabled"===t,kind:"neutral",label:r.reset,onclick:this._reset,round:!0,scale:"s",title:r.reset},(0,SI.K)("div",{"aria-hidden":"true",class:II.iconContainer,title:r.reset},(0,SI.K)("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};(0,ze._)([(0,Qe.MZ)()],NI.prototype,"goToOverride",null),(0,ze._)([(0,Qe.MZ)()],NI.prototype,"icon",null),(0,ze._)([(0,Qe.MZ)()],NI.prototype,"label",null),(0,ze._)([(0,Qe.MZ)(),(0,xI.G)("esri/widgets/Compass/t9n/Compass")],NI.prototype,"messages",void 0),(0,ze._)([(0,Qe.MZ)()],NI.prototype,"view",null),(0,ze._)([(0,Qe.MZ)({type:PI})],NI.prototype,"viewModel",void 0),NI=(0,ze._)([(0,tt.$)("esri.widgets.Compass")],NI);const DI=NI,FI="esri-navigation-toggle",kI=FI,zI=`${FI}--horizontal`;let UI=class extends ht.A{constructor(e){super(e),this._navigationMode="pan",this.view=null}initialize(){this.addHandles((0,gt.z7)((()=>this.view?.inputManager),(()=>this._setNavigationMode())))}destroy(){this.view=null}get state(){return this.view?.ready&&"3d"===this.view?.type?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._setNavigationMode()}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate")}_setNavigationMode(){const e=this.view?.inputManager;e&&(e.primaryDragAction="pan"===this._navigationMode?"pan":"rotate")}};(0,ze._)([(0,Qe.MZ)({readOnly:!0})],UI.prototype,"state",null),(0,ze._)([(0,Qe.MZ)()],UI.prototype,"_navigationMode",void 0),(0,ze._)([(0,Qe.MZ)()],UI.prototype,"view",void 0),UI=(0,ze._)([(0,tt.$)("esri.widgets.NavigationToggle.NavigationToggleViewModel")],UI);const VI=UI;let BI=class extends pI.A{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new VI,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{const e="pan"===this.viewModel?.navigationMode?this._rotateButton:this._panButton;e?.setFocus(),this.toggle()}}loadDependencies(){return(0,LI.W)({button:()=>Promise.all([r.e(9879),r.e(2785),r.e(4933),r.e(2602)]).then(r.bind(r,52602))})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e="disabled"===this.viewModel?.state,t="pan"===this.viewModel?.navigationMode,r=this.messages.toggle;return(0,SI.K)("div",{class:this.classes(kI,bI.D.widget,{[zI]:"horizontal"===this.layout})},(0,SI.K)("calcite-button",{afterCreate:e=>{this._panButton=e},appearance:t?"outline-fill":"solid",class:bI.D.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:r,onclick:this._toggle,tabIndex:t?void 0:-1,title:r}),(0,SI.K)("calcite-button",{afterCreate:e=>{this._rotateButton=e},appearance:t?"solid":"outline-fill",class:bI.D.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:r,onclick:this._toggle,tabIndex:t?-1:void 0,title:r}))}};(0,ze._)([(0,Qe.MZ)()],BI.prototype,"icon",null),(0,ze._)([(0,Qe.MZ)()],BI.prototype,"label",null),(0,ze._)([(0,Qe.MZ)({value:"vertical"})],BI.prototype,"layout",null),(0,ze._)([(0,Qe.MZ)(),(0,xI.G)("esri/widgets/NavigationToggle/t9n/NavigationToggle")],BI.prototype,"messages",void 0),(0,ze._)([(0,Qe.MZ)()],BI.prototype,"view",null),(0,ze._)([(0,Qe.MZ)({type:VI})],BI.prototype,"viewModel",void 0),BI=(0,ze._)([(0,tt.$)("esri.widgets.NavigationToggle")],BI);const jI=BI;let HI=class extends ht.A{get canZoomIn(){const e=this.view?.ready;if(!e)return!1;const t=this.view?.constraints?.effectiveMaxScale;return 0===t||this._scale>t}get canZoomOut(){const{view:e}=this,t=e?.ready;if(!t)return!1;const r=e.constraints?.effectiveMinScale;return 0===r||this._scale<r}get _scale(){const e=this.view?.animation?.target;return(e&&"then"in e?void 0:e?.scale)??this.view?.scale??0}};(0,ze._)([(0,Qe.MZ)({readOnly:!0})],HI.prototype,"canZoomIn",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],HI.prototype,"canZoomOut",null),(0,ze._)([(0,Qe.MZ)()],HI.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)()],HI.prototype,"_scale",null),HI=(0,ze._)([(0,tt.$)("esri.widgets.Zoom.ZoomConditions2D")],HI);const GI=HI;let ZI=class extends ht.A{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};(0,ze._)([(0,Qe.MZ)({readOnly:!0})],ZI.prototype,"canZoomIn",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],ZI.prototype,"canZoomOut",null),(0,ze._)([(0,Qe.MZ)()],ZI.prototype,"view",void 0),ZI=(0,ze._)([(0,tt.$)("esri.widgets.Zoom.ZoomConditions3D")],ZI);const $I=ZI;let qI=class extends ht.A{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return null!=this._zoomConditions&&this._zoomConditions.canZoomIn}get canZoomOut(){return null!=this._zoomConditions&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?"2d"===e.type?this._zoomConditions=new GI({view:e}):"3d"===e.type&&(this._zoomConditions=new $I({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;"2d"===e.type?e.mapViewNavigation.zoomIn():(0,Ke.QZ)(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;"2d"===e.type?e.mapViewNavigation.zoomOut():(0,Ke.QZ)(e.goTo({zoomFactor:.5}))}};(0,ze._)([(0,Qe.MZ)()],qI.prototype,"_zoomConditions",void 0),(0,ze._)([(0,Qe.MZ)()],qI.prototype,"canZoomIn",null),(0,ze._)([(0,Qe.MZ)()],qI.prototype,"canZoomOut",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],qI.prototype,"state",null),(0,ze._)([(0,Qe.MZ)()],qI.prototype,"view",null),qI=(0,ze._)([(0,tt.$)("esri.widgets.Zoom.ZoomViewModel")],qI);const WI=qI,YI="esri-zoom",XI="esri-zoom--horizontal";let JI=class extends pI.A{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new WI,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return(0,LI.W)({button:()=>Promise.all([r.e(9879),r.e(2785),r.e(4933),r.e(2602)]).then(r.bind(r,52602))})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[XI]:"horizontal"===this.layout},{canZoomIn:t,canZoomOut:r}=this.viewModel,{zoomIn:i,zoomOut:n}=this.messages;return(0,SI.K)("div",{class:this.classes(YI,bI.D.widget,e)},(0,SI.K)("calcite-button",{class:bI.D.widgetButton,disabled:!t,iconStart:"plus",kind:"neutral",label:i,onclick:this.zoomIn,title:i}),(0,SI.K)("calcite-button",{class:bI.D.widgetButton,disabled:!r,iconStart:"minus",kind:"neutral",label:n,onclick:this.zoomOut,title:n}))}};(0,ze._)([(0,Qe.MZ)()],JI.prototype,"icon",null),(0,ze._)([(0,Qe.MZ)()],JI.prototype,"label",null),(0,ze._)([(0,Qe.MZ)({value:"vertical"})],JI.prototype,"layout",null),(0,ze._)([(0,Qe.MZ)(),(0,xI.G)("esri/widgets/Zoom/t9n/Zoom")],JI.prototype,"messages",void 0),(0,ze._)([(0,Qe.MZ)()],JI.prototype,"view",null),(0,ze._)([(0,Qe.MZ)({type:WI})],JI.prototype,"viewModel",void 0),JI=(0,ze._)([(0,tt.$)("esri.widgets.Zoom")],JI);const KI=JI;let QI=class extends dI{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=e=>{this.components.forEach((t=>{const r=this._find(t),i=r?.widget;(function(e){return void 0!==e?.view})(i)&&(i.view=e)}))},this._componentsWatcher=(e,t)=>{this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}}initialize(){this.addHandles([(0,gt.wB)((()=>this.components),this._componentsWatcher,gt.Vh),(0,gt.wB)((()=>this.view),this._updateViewAwareWidgets,gt.Vh)])}_add(e,t,r,i,n){let s=e;if("string"==typeof e&&this._defaultPositionLookup[e]){if(this._find(e))return;s=this._createComponent(e)}super._add(s,t,r,i,n)}_removeComponents(e){e.forEach((e=>{const t=this._find(e);t&&(this.remove(t),t.destroy())}))}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(e){this.constructed&&e.forEach((e=>this.add(this._createComponent(e),this._defaultPositionLookup[e])))}_createComponent(e){const t=this._createWidget(e);return new eI({id:e,node:t})}_createWidget(e){const t=this.view;switch(e){case"attribution":return new CI({view:t});case"compass":return new DI({view:t});case"navigation-toggle":return new jI({view:t});case"zoom":return new KI({view:t})}}};(0,ze._)([(0,Qe.MZ)()],QI.prototype,"components",void 0),QI=(0,ze._)([(0,tt.$)("esri.views.ui.DefaultUI")],QI);const eL=QI;let tL=class extends eL{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};(0,ze._)([(0,Qe.MZ)()],tL.prototype,"components",void 0),tL=(0,ze._)([(0,tt.$)("esri.views.ui.3d.DefaultUI3D")],tL);const rL=tL;let iL=class extends(vn(Bn(Cn(ro)))){constructor(e){var t;super(e),t=this,this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new hm.M({slicePlane:hn.B},this),this._resourceController=function(e){return new Jb({view:e})}(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new l_({view:this}),this.labeler=new u_.C({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new fn,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new Ro,this.environment=new ca,this.environmentManager=new pu,this.floors=new je.A,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new yo({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Zv,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new rL,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new bb,(0,Qi.n_)();const r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null!=e&&e.type===Xi.R.MOVE||(t._updatingChanged(),t.map&&t.map.allLayers.forEach((async e=>{try{await e.when()}catch{}t._updatingChanged()})))};this.addHandles([(0,gt.on)((()=>this.map?.allLayers),"after-changes",(e=>r(e)),{onListenerAdd:()=>r(),onListenerRemove:()=>r(),sync:!0}),this.allLayerViews.on("after-changes",(e=>this._updateUpdatingMonitors(e))),(0,gt.wB)((()=>this.map),(e=>{e&&"load"in e&&e.load&&e.load().catch((()=>{}))}))]),this.inputManager=new Sy({view:this}),this.stateManager=new mm({view:this})}initialize(){this.groundView=new Dn({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.addHandles((0,gt.on)((()=>this.map?.allLayers),"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add((()=>this.qualitySettings.memoryLimit),(e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)}),gt.Vh),this.updatingHandles.add((()=>this.qualitySettings.additionalCacheMemory),(e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)}),gt.Vh),this.updatingHandles.add((()=>this.qualitySettings.frameRate??0),(e=>(0,Ji.QL)(e>0?1e3/Math.ceil(e):0)),gt.Vh),this.updatingHandles.add((()=>this.map?.ground),e,gt.pc),this.updatingHandles.add((()=>this.map?.ground?.opacity),(()=>this._updateDefaultHitTestOptions()),gt.pc),this.addHandles((0,gt.wB)((()=>this.spatialReference),(()=>this.notifyChange("clippingArea")),gt.OH))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=(0,Je.pR)(this.sharedSymbolResources),this._set("labeler",(0,Je.pR)(this.labeler)),this._set("deconflictor",(0,Je.pR)(this.deconflictor)),this._resourceController=(0,Je.pR)(this._resourceController),this._set("stateManager",(0,Je.pR)(this.stateManager)),this._set("inputManager",(0,Je.pR)(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",(0,Je.pR)(this.environmentManager)),this._set("environment",(0,Je.pR)(this.environment)),this.groundView=(0,Je.pR)(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(e){this.stateManager&&(this.stateManager.camera=e)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(e){this.stateManager&&(this.stateManager.contentCamera=e)}installContentCameraReset(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{sticky:!1};return this.stateManager.installContentCameraReset(e)}get center(){return this.stateManager?.center}set center(e){this.stateManager&&(this.stateManager.center=e)}get clippingArea(){if("global"===this.viewingMode)return null;const e=this.map;let t=this._userClippingArea||(0,Je.eJ)(e,"clippingArea");return!this._userClippingArea&&!(0,Je.eJ)(e,"clippingEnabled")||null==t?(this._clippingArea=null,null):t instanceof Zn.A?this.spatialReference&&(t=nL(t,this.spatialReference),null==t)?(Xe.A.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),null==t.intersection(this._groundAndLayersExtent)&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(Xe.A.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&"global"===this.viewingMode&&null!=e?Xe.A.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===$s.RT.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return null==t||null==e||t.spatialReference.equals(e)?t:nL(t,e)}get tileInfo(){return this.basemapTerrain?.tilingScheme?.toTileInfo()}get dataExtent(){let e=this._groundAndLayersExtent;const t=this.spatialReference||Bt.A.WGS84,r=nL(this.clippingArea,t);null!=r&&(e=null!=e?e.intersection(r):r);const i=this._get("dataExtent");return null!=e&&e.equals(i)?i:e}get _groundAndLayersExtent(){const e=this.spatialReference||Bt.A.WGS84;let t;const r=r=>{const i=nL(r,e);null!=i&&(null!=t?t.union(i):t=i.clone())},i=this.basemapTerrain;if(i?.spatialReference){const e=i.groundExtent;r(new Zn.A({xmin:e[0],ymin:e[1],zmin:0,xmax:e[2],ymax:e[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const e=e=>{null==e.fullExtent||"graphics"===e.type&&e.internal||r(e.fullExtent)};this.map.allLayers.forEach((t=>e(t)))}if(null==t)return null;t.hasZ?(t.zmin=Math.min(0,t.zmin??0),t.zmax=Math.max(0,t.zmax??0)):(t.zmin=0,t.zmax=0);const n=this._get("_groundAndLayersExtent");return t.equals(n)?n:t}castEnvironment(e){return e?e instanceof ca?e:e instanceof oa?this.environment?.cloneWithWebsceneEnvironment(e)??ca.fromWebsceneEnvironment(e):(0,et.dp)(ca,e):new ca}get extent(){return this.stateManager?.extent}set extent(e){this.stateManager&&(this.stateManager.extent=e)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(null==this.state||this.state.stationary)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}set qualityProfile(e){gb.isValidProfile(e)&&(gb.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||gb.getDefaultProfile()}set slicePlane(e){if(null!=this._stage&&this._stage.renderer.setParameters({slicePlane:e}),null==e)return void this._set("slicePlane",null);const t=this._propertiesPool.get("slicePlane");(0,hn.c)(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode&&!!this.stateManager?.preinit(this.spatialReference)}get resolution(){return null!=this.spatialReference?(0,pn.i1)(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get terrainScale(){return this.stateManager?.terrainScale}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return null!=e?on.A.deriveUnitFromSR(e,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,r=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach((i=>{if(i.isFulfilled()){if(i.updating){if(t=!0,i.suspended||(0,nx.eS)(i))return;++r,e+=i.updatingProgress}}else++r}));for(const n of this._updatingObjects)if(null!=n&&n.updating){const t=.1;r+=t,e+=.5*t}for(const n of this._updatingObjectsWithProgress)null!=n&&n.updating&&(++r,e+=n.updatingProgress);const i=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(t=!!(t||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some((e=>!e.isFulfilled()))||this.textures?.updating),t?(this._numUpdating=Math.max(r,this._numUpdating),e+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const r=performance.now();if(e<1){const t=Math.min((r-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-t)+e*t}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?r:0}return t}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){const e=this._predeterminedViewingMode;if(null!=e)return(0,$s._s)(e);const t=this.spatialReference;return t?null!=this.defaultsFromMap?.viewingMode&&t.equals(this.defaultsFromMap.spatialReference)?(0,$s._s)(this.defaultsFromMap.viewingMode):(0,XO.M)(t,$s.RT.Global)?"global":"local":"global"}set viewingMode(e){this.ready?Xe.A.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",e)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(e){this.stateManager&&(this.stateManager.viewpoint=e)}get zoom(){return this.stateManager.zoom}set zoom(e){this.stateManager&&(this.stateManager.zoom=e)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new tw(this)}on(e,t,r,i){return this.viewEvents.on(e,t,r,i)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return Xe.A.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=(0,xs.FV)(e)?(0,xs.xB)(this,e):e;return(0,Yv.av)(this,r,t,this._defaultToMapOptions)}toScreen(e){if(!this.ready)return Xe.A.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=(null==e.z?(0,Nf.R1)(this.elevationProvider,e):null)??0;return(0,cn.g)(e,sL,this.renderSpatialReference,t),this.state.camera.projectToScreen(sL,oL),(0,Ki.tc)(oL[0],oL[1])}pixelSizeAt(e){return this.ready?e?((0,cn.g)(e,sL,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(sL)):0:(Xe.A.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e,(()=>this.pixelSizeAt(e))):1}hitTest(e,t){if(!this.ready)return Xe.A.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=(0,xs.FV)(e)?(0,xs.xB)(this,e):e;return(0,Yv.CB)(this,r,t,this._defaultHitTestOptions)}async popupHitTest(e){return Ab(this,e)}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(null==e.parent)throw new Ze.A("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});switch(e.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(e.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(e)}}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();return OO(await this._stage.renderView.takeScreenshot(t),t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();return IO(await this._stage.renderView.takeScreenshot(t),this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(e){const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(t);return[IO(r[0],this._pixelFormat()),IO(r[1],this._pixelFormat())]}_completeSettings(e){const t=function(e,t){const r=PO(e,t),i=r.area,n=r.width/i.width,s=FO(r,t.padding),o=s.left+s.right,a=s.top+s.bottom,l=t.width-o,c=t.height-a,u=Math.floor(l*n+o),h=Math.floor(c*n+a),d=e?.layers??[],p=r.ignoreBackground,f=r.ignorePadding;return{framebufferWidth:u,framebufferHeight:h,region:{x:Math.floor(i.x*n)+s.left,y:Math.floor(i.y*n)+s.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:n,layers:d,disableDecorations:r.disableDecorations,ignoreBackground:p,ignorePadding:f,objectAndLayerIdColor:!1}}(e,this);return t.pixelRatio/=this.state.pixelRatio,function(e,t,r){if(!t)return e;const{framebufferWidth:i,framebufferHeight:n,pixelRatio:s,region:o}=e,a=FO(e,r),l=a.left+a.right,c=a.top+a.bottom,u=i-l,h=n-c,d=Math.min(8,Math.min((2048-l)/u,(2048-c)/h));return d<1.5?e:{...e,framebufferWidth:Math.round(u*d)+l,framebufferHeight:Math.round(h*d)+c,pixelRatio:s*d,resample:{region:{x:Math.round((o.x-a.left)*d)+a.left,y:Math.round((o.y-a.top)*d)+a.top,width:Math.round(o.width*d),height:Math.round(o.height*d)},width:i,height:n}}}(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){}async takeScreenshotWithObjectAndLayerId(e){if(!(0,it.A)("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(t),i=OO(r[0],t,this._pixelFormat()),n=this._completeSettings(e);return n.format="png",[i,OO(r[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(null==this._stage.renderView.objectAndLayerIdRenderHelper)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return uo(e)}hasLayerViewModule(e){return co(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let e=function(e){const t=(0,JO.C)();return t.available?"3d"===e&&t.majorPerformanceCaveat?new Ze.A("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):t.supportsHighPrecisionFragment?t.supportsVertexShaderSamplers?null:new Ze.A("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new Ze.A("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new Ze.A("webgl:required","WebGL2 is required but not supported.",(new Error).stack)}(this.type);const t=(0,it.A)("safari");if(t&&t<9&&(e=new Ze.A("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:t})),null!=e)throw Xe.A.getLogger(this).warn("#validate()",e.message),e}get _predeterminedViewingMode(){const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return null!=e?(0,$s.yX)(e):null}getSpatialReferenceSupport(e,t){const r=this._predeterminedViewingMode;if(null!=r)return this._validateSpatialReferenceForViewingMode(e,t,r)?{constraints:this._makeSpatialReferenceConstraints(e,t,r)}:null;const i=this._validateSpatialReferenceForViewingMode(e,t,$s.RT.Local),n=this._validateSpatialReferenceForViewingMode(e,t,$s.RT.Global);return i||n?i&&n?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:i?{constraints:this._makeSpatialReferenceConstraints(e,t,$s.RT.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,$s.RT.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,r){return!!(0,XO.M)(e,r)&&(null==t||!!(0,vt.qC)(t)||(!(0,vt.qK)(t)||null!=(0,nx.Uo)(t,e,r))&&(!(0,vt.qe)(t)||r!==$s.RT.Global))}_makeSpatialReferenceConstraints(e,t,r){if(null==t)return[{spatialReference:e,viewingMode:r}];const{isWebMercator:i,isWGS84:n}=e;return(0,vt.qC)(t)&&(i||n)?n&&r!==$s.RT.Local&&null!==(0,nx._y)(t.tileInfo,t.fullExtent,e,$s.RT.Global)?[{spatialReference:i?Bt.A.WGS84:Bt.A.WebMercator,viewingMode:r}]:[{spatialReference:e,viewingMode:r},{spatialReference:Bt.A.WebMercator,viewingMode:r}]:(0,vt.qK)(t)||(0,vt.qe)(t)||!i&&!n?(0,vt.qK)(t)&&i&&r!==$s.RT.Global?[{spatialReference:e,viewingMode:r},{spatialReference:Bt.A.WGS84,viewingMode:$s.RT.Local}]:[{spatialReference:e,viewingMode:r}]:[{spatialReference:e,viewingMode:r},{spatialReference:i?Bt.A.WGS84:Bt.A.WebMercator,viewingMode:r}]}_validateSpatialReference(e){const t=null!=this.getSpatialReferenceSupport(e),r=this._predeterminedViewingMode;return t||(null!=r?Xe.A.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${(0,$s._s)(r)} viewing mode.`):e.isGeographic&&Xe.A.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise((e=>{this.ready?e(this):this._resolveWhenReady.push(e)}))}trackGraphicState(e){if(!e.graphic)return Xe.A.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let r=null,i=!1;const n=t=>{!i&&null!=t&&"processor"in t&&"graphics-3d"===t.processor?.type&&t.processor.graphicsCore&&(r=t.processor.graphicsCore.trackGraphicState(e))};return null!=t?n(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then((e=>n(e)),(()=>{})).catch((()=>{})),(0,mt.hA)((()=>{i=!0,null!=r&&(r.remove(),r=null)}))}highlight(e){if(Array.isArray(e))return(0,mt.vE)(e.map((e=>this.highlight(e))));if(je.A.isCollection(e))return(0,mt.vE)(e.toArray().map((e=>this.highlight(e))));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):(0,mt.hA)()}maskOccludee(e){if(!e)return Xe.A.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let r=null,i=!1;const n=t=>{!i&&null!=t&&(0,YO.Uk)(t)&&(r=t.maskOccludee(e))};return null!=t?n(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then((e=>n(e)),(()=>{})).catch((()=>{})),(0,mt.hA)((()=>{i=!0,null!=r&&(r.remove(),r=null)}))}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find((t=>t.layer===e.layer)):null}graphicChanged(e){null!=this.graphicsView&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await(0,gt.C_)((()=>this.graphicsView)),this.graphicsView;if(!e.layer||!this.map)throw new Ze.A("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise(((t,r)=>{const i=this.map.allLayers.on("change",(n=>{n.added.includes(e.layer)&&(i.remove(),this.whenLayerView(e.layer).then(t,r))}))})):this.whenLayerView(e.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new sA({view:this})),this._set("elevationProvider",new hb({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Hw({view:this})),this._set("featureTiles",new Uv({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{const e=this.basemapTerrain?.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const e=null!=this.basemapTerrain.extent&&null!=this.basemapTerrain.spatialReference?(0,an.project)((0,un.w1)(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;null!=this.clippingArea?this.featureTiles.filterExtent=this.clippingArea.intersection(e):this.featureTiles.filterExtent=e}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add((()=>My.b.FEATURE_TILE_TREE_SHOW_TILES),(e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(r.e(4458).then(r.bind(r,14458))).then((e=>{let{FeatureTileTree3DDebugger:t}=e;!this._featureTreeDebugger&&My.b.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new t({view:this}))})):e||!this._featureTreeDebugger||My.b.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)}),gt.pc),this.updatingHandles.add((()=>this.clippingArea),e,gt.pc),this.updatingHandles.add((()=>this.basemapTerrain.extent),e,gt.pc)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new Sb(this.map,e));const t=this.state.isGlobal,r=(0,dn.Gs)(t,e);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",Db.d.create(this.state.viewingMode,r)),t||this.addHandles((0,gt.wB)((()=>this.basemapTerrain?.extent),(e=>{const t=this.renderCoordsHelper.spatialReference;null==e||0===e[0]&&0===e[1]&&0===e[2]&&0===e[3]||!(0,ln.S)(e,this.basemapTerrain.spatialReference,aL,t)||(this.renderCoordsHelper.extent=aL)}),gt.OH),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Id.TH/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null!=e&&e.type===Xi.R.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach((e=>{e.destroyed||(this.addHandles((0,gt.wB)((()=>[e.updating,e.updatingProgress]),(()=>this._updatingChanged()),gt.OH),"updatingMonitors"),e.when((()=>this._updatingChanged()),(()=>this._updatingChanged())))})),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(e,t,r){if(!this.overlay||!this.overlay.hasVisibleItems)return r;const i=e.getContext("2d");return i.putImageData(r,0,0),this.overlay.renderCanvas(e,{disableDecorations:t===hx.ID.OFF}),i.getImageData(0,0,r.width,r.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(e,t,r)=>this._renderScreenshotOverlay(e,t,r)}},t=new Kv(this.state.viewingMode,(e=>this._stage.layers.forAll(e)),this);this._set("sceneIntersectionHelper",t);const r=(0,Wi.$H)(this.surface);this._stage=new WO({view:this,options:e,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add((()=>this.qualitySettings.highQualityTransparency),(e=>this._stage.renderer.setParameters({highQualityTransparency:e})),gt.Vh),this.on("pointer-move",(()=>this._stage?.renderer.resetAnimation())),(0,Yi.on)(this._stage.renderView.canvas,"webglcontextlost",(e=>{this.fatalError=new Ze.A("webgl-context-lost",e.statusMessage)}))],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Id.TH/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=(0,Je.pR)(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new dw({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController)return;if(0===this.graphics.length)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await Promise.all([r.e(9154),r.e(5977)]).then(r.bind(r,15477))).default;(0,Ke.Te)(e),await(0,gt.C_)((()=>this.basemapTerrain?.ready),e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),null!=this.graphicsView&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=(0,$s.yX)(this.viewingMode);e===$s.RT.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.addHandles((0,gt.on)((()=>this.graphics),"after-changes",(()=>this._createGraphicsViewIfNeeded())),"graphics-view"),this._createGraphicsViewIfNeeded();const t=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties:null,r=t?.environment;r&&rn(this.environment,r),this.timeExtent=t?.timeExtent,this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new aw(this._stage,this.resourceController.scheduler));const i=this._resolveWhenReady;this._resolveWhenReady=[],i.forEach((e=>e(this)))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",(0,Je.pR)(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Jd.fo);for(const e of this.map.allLayers.items)(0,vt.Eq)(e.type)&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Jd.fo);for(const e of this.map.allLayers.items)(0,vt.Eq)(e.type)&&e.opacity<1&&this._defaultHitTestOptions.exclude.add(e.uid)}}};function nL(e,t){return null!=e&&(0,an.canProjectWithoutEngine)(e.spatialReference,t)?(0,an.project)(e,t):null}iL.type="3d",(0,ze._)([(0,Qe.MZ)()],iL.prototype,"_userClippingArea",void 0),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"_resourceController",void 0),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"_stage",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"deconflictor",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"labeler",void 0),(0,ze._)([(0,Qe.MZ)((0,sn.C)(fn,"analyses"))],iL.prototype,"analyses",void 0),(0,ze._)([(0,Qe.MZ)({type:so,readOnly:!0})],iL.prototype,"animation",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"basemapTerrain",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"elevationProvider",void 0),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"camera",null),(0,ze._)([(0,Qe.MZ)({type:Rt.A})],iL.prototype,"contentCamera",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"canvas",void 0),(0,ze._)([(0,Qe.MZ)({type:df.A})],iL.prototype,"center",null),(0,ze._)([(0,Qe.MZ)({type:Zn.A})],iL.prototype,"clippingArea",null),(0,ze._)([(0,Qe.MZ)({type:Ro})],iL.prototype,"constraints",void 0),(0,ze._)([(0,Qe.MZ)({type:Zn.A,readOnly:!0})],iL.prototype,"renderDataExtent",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"tileInfo",null),(0,ze._)([(0,Qe.MZ)({type:Zn.A,readOnly:!0})],iL.prototype,"dataExtent",null),(0,ze._)([(0,Qe.MZ)({type:Zn.A,readOnly:!0})],iL.prototype,"_groundAndLayersExtent",null),(0,ze._)([(0,Qe.MZ)({type:ca})],iL.prototype,"environment",void 0),(0,ze._)([(0,ft.w)("environment")],iL.prototype,"castEnvironment",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"environmentManager",void 0),(0,ze._)([(0,Qe.MZ)({type:Zn.A})],iL.prototype,"extent",null),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"floors",void 0),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"screenCenter",null),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"frustum",null),(0,ze._)([(0,Qe.MZ)({type:Number,readOnly:!0})],iL.prototype,"fullOpacity",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"graphicsView",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"analysisViewManager",void 0),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"groundView",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean})],iL.prototype,"initialExtentRequired",null),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"_defaultsFromMapSettings",null),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"interacting",null),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"stationary",null),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"navigating",null),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"map",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"mapCoordsHelper",void 0),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"padding",null),(0,ze._)([(0,Qe.MZ)({type:Hw,readOnly:!0})],iL.prototype,"pointsOfInterest",void 0),(0,ze._)([(0,Qe.MZ)({type:Uv,readOnly:!0})],iL.prototype,"featureTiles",void 0),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"_featureTreeDebugger",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean})],iL.prototype,"screenSizePerspectiveEnabled",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],iL.prototype,"deactivatedWebGLExtensions",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],iL.prototype,"debugWebGLExtensions",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],iL.prototype,"renderCanvas",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],iL.prototype,"state",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"inputManager",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"stateManager",void 0),(0,ze._)([(0,Qe.MZ)({type:["low","medium","high"]})],iL.prototype,"qualityProfile",null),(0,ze._)([(0,Qe.MZ)({type:Nb,get(){let e=this._get("qualitySettings");return e||(e=new Nb,gb.apply(this.qualityProfile,e)),e}})],iL.prototype,"qualitySettings",void 0),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"slicePlane",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"typeSpecificPreconditionsReady",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"renderCoordsHelper",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"sceneIntersectionHelper",void 0),(0,ze._)([(0,Qe.MZ)({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],iL.prototype,"resolution",null),(0,ze._)([(0,Qe.MZ)({type:Number})],iL.prototype,"scale",null),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"heightModelInfo",null),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"spatialReference",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean,constructOnly:!0})],iL.prototype,"alphaCompositingEnabled",void 0),(0,ze._)([(0,Qe.MZ)({constructOnly:!0})],iL.prototype,"preserveDrawingBufferEnabled",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean})],iL.prototype,"supersampleScreenshotsEnabled",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"type",void 0),(0,ze._)([(0,Qe.MZ)(),(0,ft.w)((e=>e instanceof eL?e:(0,et.PZ)(rL,e)))],iL.prototype,"ui",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],iL.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"_updatingObjects",null),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"_updatingObjectsWithProgress",null),(0,ze._)([(0,Qe.MZ)({type:Number,readOnly:!0,dependsOn:["updating"]})],iL.prototype,"updatingProgress",void 0),(0,ze._)([(0,Qe.MZ)({type:["global","local"]})],iL.prototype,"viewingMode",null),(0,ze._)([(0,Qe.MZ)({type:Lt})],iL.prototype,"viewpoint",null),(0,ze._)([(0,Qe.MZ)({type:Number})],iL.prototype,"zoom",null),(0,ze._)([(0,Qe.MZ)({type:bb})],iL.prototype,"highlightOptions",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"quality",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],iL.prototype,"resolutionScale",null),(0,ze._)([(0,Qe.MZ)()],iL.prototype,"textures",void 0),iL=(0,ze._)([(0,tt.$)("esri.views.SceneView")],iL);const sL=(0,nn.vt)(),oL=(0,Ki.gs)(),aL=(0,un.vt)();var lL=r(88685);const cL="esri-search",uL={base:cL,hasMultipleSources:`${cL}--multiple-sources`,isLoading:`${cL}--loading`,isSearching:`${cL}--searching`,showSuggestions:`${cL}--show-suggestions`,showSources:`${cL}--sources`,showWarning:`${cL}--warning`,container:`${cL}__container`,input:`${cL}__input`,inputContainer:`${cL}__input-container`,form:`${cL}__form`,submitButton:`${cL}__submit-button`,sourcesButton:`${cL}__sources-button`,sourcesButtonDown:`${cL}__sources-button--down`,sourcesButtonUp:`${cL}__sources-button--up`,clearButton:`${cL}__clear-button`,sourceName:`${cL}__source-name`,suggestionsMenu:`${cL}__suggestions-menu`,suggestionList:`${cL}__suggestions-list`,suggestionListCurrentLocation:`${cL}__suggestions-list--current-location`,sourcesMenu:`${cL}__sources-menu`,source:`${cL}__source`,warningMenu:`${cL}__warning-menu`,warningMenuBody:`${cL}__warning-body`,warningMenuHeader:`${cL}__warning-header`,warningMenuText:`${cL}__warning-text`,noValueText:`${cL}__no-value-text`},hL="esri-search-result-renderer",dL={base:hL,showMoreResults:`${hL}__more-results--show-more-results`,moreResults:`${hL}__more-results`,moreResultsList:`${hL}__more-results-list`,moreResultsHeader:`${hL}__more-results-header`,moreResultsItem:`${hL}__more-results-item`,moreResultsListHeader:`${hL}__more-results-list-header`};var pL=r(86560),fL=r(16868),mL=r(86100),gL=r(63860);let yL=class extends((0,Mi.sA)($e.oY)){constructor(e){super(e),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};(0,ze._)([(0,Qe.MZ)()],yL.prototype,"autoNavigate",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"filter",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"getResults",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"getSuggestions",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"maxResults",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"maxSuggestions",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"minSuggestCharacters",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"outFields",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"placeholder",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"popupEnabled",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"popupTemplate",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"prefix",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"resultGraphicEnabled",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"resultSymbol",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"suggestionsEnabled",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"suffix",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"withinViewEnabled",void 0),(0,ze._)([(0,Qe.MZ)()],yL.prototype,"zoomScale",void 0),yL=(0,ze._)([(0,tt.$)("esri.widgets.Search.SearchSource")],yL);const _L=yL;var vL=r(65215),bL=r(77269),wL=r(39348),xL=r(65256);const SL=/https?:\/\/services.*\.arcgis\.com/i,TL=/(?:\{([^}]+)\})/g,ML=()=>Xe.A.getLogger("esri.widgets.Search.support.layerSearchUtils");function AL(e,t){const{exactMatch:r=!1,location:i,maxResults:n,spatialReference:s,source:o,sourceIndex:a,suggestResult:l,view:c}=e,{layer:u,filter:h,zoomScale:d}=o,p=c?.scale,f=EL(o,c),m=t?.signal;return PL(u).then((()=>{const e=u.popupTemplate;return e?e.getRequiredFields(u.fieldsIndex):null})).then((e=>{const{objectIdField:t,returnZ:g}=u,y=FL(o);if(!zL(u,y))throw ML().error("invalid-field: displayField is invalid."),new Ze.A("getResults():invalid-field","displayField is invalid.");const _=e?.length?e:[y],v=o.outFields||_,b=RL(v);if(v.includes(t)||b||v.push(t),u.floorInfo?.floorField&&v.push(u.floorInfo.floorField),!b&&!kL(u,v))throw ML().error("invalid-field: outField is invalid."),new Ze.A("getResults():invalid-field","outField is invalid.");const w=u.createQuery(),{orderByFields:x}=o;if(x&&(w.orderByFields=x),s){w.outSpatialReference=s;const e=1/(0,pf.GA)(s);e&&(w.maxAllowableOffset=e)}const S="mesh"===u.geometryType||"multipatch"===u.geometryType,T=u.capabilities?.data?.supportsZ&&!S;if(w.returnZ=T&&!1!==g,w.returnGeometry=!0,w.multipatchOption=S?"xyFootprint":null,v&&(w.outFields=v),i)w.geometry=i;else if(l.key)w.objectIds=[l.key];else{const e=o.searchFields||[y];if(!kL(u,e))throw ML().error("invalid-field: search field is invalid."),new Ze.A("getResults():invalid-field","search field is invalid.");DL(u)&&(w.num=n),f&&(w.geometry=f);const t=l.text?.trim();if(!t)return[];const i=l.text,{prefix:s="",suffix:a=""}=o,c=UL(`${s}${i}${a}`);NL(u)&&IL(u,e)&&!r&&i&&(w.fullText=LL({text:i,searchFields:e}));const d=BL({searchTerm:c,layer:u,searchFields:e,filter:h,exactMatch:r,query:w,type:"search"});if(w.where=d,!OL(w))return[]}return u.queryFeatures(w,{signal:m}).then((e=>function(e,t,r,i,n,s,o){return e.features.map((e=>function(e,t,r,i,n,s,o){const a=e.clone(),l=e.sourceLayer,c=l?.objectIdField,u=c?e.attributes[c]:null,h=jL(e,r.searchTemplate,n);null!=s&&function(e){return null!=e&&null!=e.minScale&&null!=e.maxScale}(l)&&(l.minScale&&l.minScale<s?s=l.minScale:l.maxScale&&l.maxScale>s&&(s=l.maxScale));const d=a.geometry?(0,mL.ZY)(a.geometry,t??void 0,s??void 0):void 0,p="number"==typeof o&&d?(0,mL.DN)((0,qe.o8)(d),t??void 0,o):d,f=e.clone();return null!=p&&(f.geometry=vL.A.fromExtent(p)),{extent:p,target:f,feature:a,key:u,name:h,sourceIndex:i}}(e,t,r,i,n,s,o)))}(e,c,o,a,y,p,d)))}))}function CL(e,t){const{source:r,spatialReference:i,view:n,suggestTerm:s,maxSuggestions:o,sourceIndex:a,exactMatch:l}=e,{layer:c,filter:u}=r,h=t?.signal,d=EL(r,n);return PL(c).then((()=>{if(!DL(c))return[];const e=FL(r),t=r.searchFields||[e],n=[];r.suggestionTemplate?r.suggestionTemplate.replaceAll(TL,((e,t)=>(n.push(t),e))):n.push(e);const p=RL(n);n.includes(c.objectIdField)||p||n.push(c.objectIdField);const f=zL(c,e),m=p||kL(c,n),g=kL(c,t);if(!f)throw ML().error("invalid-field: displayField is invalid."),new Ze.A("getSuggestions():invalid-field","displayField is invalid.");if(!m)throw ML().error("invalid-field: outField is invalid."),new Ze.A("getSuggestions():invalid-field","outField is invalid.");if(!g)throw ML().error("invalid-field: search field is invalid."),new Ze.A("getSuggestions():invalid-field","search field is invalid.");const y=c.createQuery(),{orderByFields:_}=r;if(_&&(y.orderByFields=_),y.outSpatialReference=i,y.returnGeometry=!1,y.num=o,y.outFields=n,d&&(y.geometry=d),!s.trim())return[];const{prefix:v="",suffix:b=""}=r,w=UL(`${v}${s}${b}`);NL(c)&&IL(c,t)&&!l&&s&&(y.fullText=LL({text:s,searchFields:t}));const x=BL({searchTerm:w,layer:c,searchFields:t,filter:u,exactMatch:l,query:y,type:"suggest"});return y.where=x,OL(y)?c.queryFeatures(y,{signal:h}).then((t=>function(e,t,r,i){return e.features.map((e=>function(e,t,r,i){const n=e.sourceLayer,{attributes:s}=e,{objectIdField:o}=n,a=o?s[o]:null;return{text:jL(e,t.suggestionTemplate,i),key:a,sourceIndex:r}}(e,t,r,i)))}(t,r,a,e))):[]}))}function EL(e,t){const{filter:r,withinViewEnabled:i}=e,n=t?.extent,s=r?.geometry;return s??(i&&n?n:void 0)}function RL(e){return e&&e.includes("*")}async function PL(e){e&&await e.load()}function OL(e){return!(!e.fullText&&!e.where)}function IL(e,t){const r=e?.indexes;return!(!r||!t?.length)&&r.filter((e=>"FullText"===e.indexType)).some((e=>{const r=e.fields?.split(",").map((e=>e.trim().toLowerCase()))||[];return t.every((e=>r.includes(e.toLowerCase())))}))}function LL(e){let{text:t,searchFields:r}=e;return t.trim().split(" ").filter((e=>!!e.trim())).map((e=>new bL.A({onFields:r,searchTerm:e,searchType:"prefix"})))}function NL(e){return e?.capabilities?.query?.supportsFullTextSearch??!1}function DL(e){return e?.capabilities?.query?.supportsPagination??!1}function FL(e){return e.displayField||e.layer.displayField||function(e){return e?.fieldsIndex?.fields?.find((e=>"string"===e.type))?.name??""}(e.layer)}function kL(e,t){return!(!e||!t?.length)&&t.every((t=>zL(e,t)))}function zL(e,t){return!!e.getField(t)}function UL(e){return e.replaceAll("'","''")}function VL(e,t){const r=t?.where;return r?`(${e}) AND (${r})`:e}function BL(e){let{searchTerm:t,layer:r,searchFields:i,filter:n,exactMatch:s,query:o,type:a}=e;const{definitionExpression:l,url:c}=r;let u="";return!o.fullText&&t&&i&&i.forEach((e=>{const i=r.getField(e),o="function"==typeof r.getFieldDomain&&r.getFieldDomain(e),l=(o&&"coded-value"===o.type?function(e,t,r){let{codedValues:i}=e;return(0,Je.Pb)(i??[],(e=>{const i=e.name,n=r?i:i.toLowerCase();return(r?t:t.toLowerCase())===n?e.code.toString():null}))??null}(o,t,s):null)||t||null;if(null!==l){const e=function(e){let{currentTerm:t,field:r,filter:i,exactMatch:n,url:s,type:o}=e;const a=r?.type,l=r?.name;if("string"===a||"date"===a||"global-id"===a){const e=SL.test(s??""),r=e&&function(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}(t)?"N":"";return VL(n&&"search"===o?`${l} = ${r}'${t}'`:e?`${l} LIKE ${r}'${t}%'`:`LOWER(${l}) LIKE ${r}'${t.toLowerCase()}%'`,i)}if("oid"===a||"small-integer"===a||"integer"===a||"single"===a||"double"===a){const e=Number(t);return isNaN(e)?null:VL(`${l} = ${e}`,i)}return VL(`${l} = ${t}`,i)}({currentTerm:l,field:i,filter:n,exactMatch:s,url:c,type:a});e&&(u+=function(e,t){return e?` OR (${t})`:`(${t})`}(u,e))}})),l&&u?`(${l}) AND (${u})`:l||u}function jL(e,t,r){const i=e.sourceLayer,{attributes:n}=e,s="function"==typeof i.getFieldDomain&&i.getFieldDomain(r);if(t)return(0,wL.V)(t,n);if(r&&n){const e=i.getField(r),t=function(e,t){return e[t]??e[Object.keys(e).find((e=>e.toLowerCase()===t.toLowerCase()))]}(n,r);return null==t?"":s&&"coded-value"===s.type?function(e,t){let r=null;const{codedValues:i}=e;return i&&i.length&&i.some((e=>e.code===t&&(r=e.name,!0))),r}(s,t)??"":"date"===e?.type?(0,xL.Yq)(new Date(t)):"number"==typeof t?t.toString():"string"!=typeof t?"":t.trim()}return""}var HL;let GL=HL=class extends _L{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(e,t)=>AL({source:this,...e},t),this.getSuggestions=(e,t)=>CL({source:this,...e},t)}set layer(e){this._set("layer",e),e&&e.load().catch((()=>{}))}get name(){return this._getLayerTitle()??""}set name(e){this._overrideIfSome("name",e)}clone(){return new HL({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?(0,qe.o8)(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?(0,qe.o8)(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){return this.layer.fieldsIndex?.fields.find((e=>"string"===e.type))?.name??""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map((t=>{const r=e.getField(t);return r?.alias||t})).join(", ")}`:""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};(0,ze._)([(0,Qe.MZ)({json:{read:{source:"field.name"},write:{target:"field.name"}}})],GL.prototype,"displayField",void 0),(0,ze._)([(0,Qe.MZ)({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],GL.prototype,"exactMatch",void 0),(0,ze._)([(0,Qe.MZ)({value:null})],GL.prototype,"layer",null),(0,ze._)([(0,Qe.MZ)()],GL.prototype,"name",null),(0,ze._)([(0,Qe.MZ)({type:[String],json:{write:!0}})],GL.prototype,"orderByFields",void 0),(0,ze._)([(0,Qe.MZ)()],GL.prototype,"searchFields",void 0),(0,ze._)([(0,Qe.MZ)()],GL.prototype,"searchTemplate",void 0),(0,ze._)([(0,Qe.MZ)()],GL.prototype,"suggestionTemplate",void 0),GL=HL=(0,ze._)([(0,tt.$)("esri.widgets.Search.LayerSearchSource")],GL);const ZL=GL;var $L=r(54994);let qL=class extends $e.oY{constructor(e){super(e),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],qL.prototype,"address",void 0),(0,ze._)([(0,Qe.MZ)({type:Object,json:{write:!0}})],qL.prototype,"attributes",void 0),(0,ze._)([(0,Qe.MZ)({type:Zn.A,json:{write:!0}})],qL.prototype,"extent",void 0),(0,ze._)([(0,Qe.MZ)({type:df.A,json:{write:!0}})],qL.prototype,"location",void 0),(0,ze._)([(0,Qe.MZ)({type:Number,json:{write:!0}})],qL.prototype,"score",void 0),qL=(0,ze._)([(0,tt.$)("esri.rest.support.AddressCandidate")],qL);const WL=qL;var YL=r(29067);let XL=class extends $e.oY{constructor(e){super(e),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};(0,ze._)([(0,Qe.MZ)({type:Object,json:{write:!0}})],XL.prototype,"address",void 0),(0,ze._)([(0,Qe.MZ)(YL.K)],XL.prototype,"apiKey",void 0),(0,ze._)([(0,Qe.MZ)({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],XL.prototype,"categories",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],XL.prototype,"countryCode",void 0),(0,ze._)([(0,Qe.MZ)({type:Boolean,json:{write:!0}})],XL.prototype,"forStorage",void 0),(0,ze._)([(0,Qe.MZ)({type:df.A,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],XL.prototype,"location",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],XL.prototype,"locationType",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],XL.prototype,"magicKey",void 0),(0,ze._)([(0,Qe.MZ)({type:Number,json:{write:!0}})],XL.prototype,"maxLocations",void 0),(0,ze._)([(0,Qe.MZ)({type:[String],json:{write:{writer:(e,t)=>{t.outFields=e?e.join(","):null}}}})],XL.prototype,"outFields",void 0),(0,ze._)([(0,Qe.MZ)({type:Bt.A,json:{read:{source:"outSR"},write:{target:"outSR"}}})],XL.prototype,"outSpatialReference",void 0),(0,ze._)([(0,Qe.MZ)({type:Zn.A,json:{write:{writer:(e,t)=>{const r=e?e.shiftCentralMeridian():null;t.searchExtent=r}}}})],XL.prototype,"searchExtent",void 0),XL=(0,ze._)([(0,tt.$)("esri.rest.support.AddressToLocationsParameters")],XL),XL.from=(0,et.dp)(XL);const JL=XL;function KL(e){let{data:t}=e;if(!t)return[];const{candidates:r,spatialReference:i}=t;return r?r.map((e=>{if(!e)return;const{extent:t,location:r}=e,n=!t||function(e){return e&&"number"==typeof e.xmin&&"number"==typeof e.ymin&&"number"==typeof e.xmax&&"number"==typeof e.ymax}(t);return function(e){return!!e&&"number"==typeof e.x&&"number"==typeof e.y}(r)&&n?(t&&(t.spatialReference=i),r&&(r.spatialReference=i),WL.fromJSON(e)):void 0})):[]}let QL=class extends $e.oY{constructor(e){super(e),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};(0,ze._)([(0,Qe.MZ)(YL.K)],QL.prototype,"apiKey",void 0),(0,ze._)([(0,Qe.MZ)({type:df.A,json:{write:{writer:(e,t)=>{const r=e?e.clone().normalize():null,i=void 0!==r;t.location=i?r:null}}}})],QL.prototype,"location",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],QL.prototype,"locationType",void 0),(0,ze._)([(0,Qe.MZ)({type:Bt.A,json:{read:{source:"outSR"},write:{target:"outSR"}}})],QL.prototype,"outSpatialReference",void 0),QL=(0,ze._)([(0,tt.$)("esri.rest.support.LocationToAddressParameters")],QL),QL.from=(0,et.dp)(QL);const eN=QL;async function tN(e,t,r){t=eN.from(t);const i=(0,$L.Dl)(e),n={...t.toJSON(),f:"json"},s=(0,$L.lF)({...i.query,...n}),o=(0,$L.jV)(s,r),a=`${i.path}/reverseGeocode`;return(0,Ub.A)(a,o).then(rN)}function rN(e){let{data:t}=e;if(!t)return;const{address:r,location:i}=t,n=r?.Match_addr||"";return WL.fromJSON({address:n,attributes:r||{},location:i,score:100})}let iN=class extends $e.oY{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};(0,ze._)([(0,Qe.MZ)({type:Boolean,json:{write:!0}})],iN.prototype,"isCollection",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],iN.prototype,"magicKey",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],iN.prototype,"text",void 0),iN=(0,ze._)([(0,tt.$)("esri.rest.support.SuggestionCandidate")],iN);const nN=iN;let sN=class extends $e.oY{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};(0,ze._)([(0,Qe.MZ)(YL.K)],sN.prototype,"apiKey",void 0),(0,ze._)([(0,Qe.MZ)({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],sN.prototype,"categories",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],sN.prototype,"countryCode",void 0),(0,ze._)([(0,Qe.MZ)({type:df.A,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],sN.prototype,"location",void 0),(0,ze._)([(0,Qe.MZ)({type:Number,json:{write:!0}})],sN.prototype,"maxSuggestions",void 0),(0,ze._)([(0,Qe.MZ)({type:Bt.A,json:{read:{source:"outSR"},write:{target:"outSR"}}})],sN.prototype,"outSpatialReference",void 0),(0,ze._)([(0,Qe.MZ)({type:Zn.A,json:{write:{writer:(e,t)=>{const r=e?e.shiftCentralMeridian():null;t.searchExtent=JSON.stringify(r)}}}})],sN.prototype,"searchExtent",void 0),(0,ze._)([(0,Qe.MZ)({type:String,json:{write:!0}})],sN.prototype,"text",void 0),sN=(0,ze._)([(0,tt.$)("esri.rest.support.SuggestLocationsParameters")],sN),sN.from=(0,et.dp)(sN);const oN=sN;function aN(e){const{data:t}=e;if(!t)return[];const{suggestions:r}=t;return r?r.map((e=>new nN(e))):[]}const lN="Single Line Input",cN=3e5;function uN(e,t){return e.location?async function(e,t){const{source:r,spatialReference:i,location:n,sourceIndex:s,view:o}=e,{apiKey:a,url:l,zoomScale:c,defaultZoomScale:u}=r;if(null==l)return[];const h=o?.scale,d=t?.signal,p=new eN({location:n});a&&(p.apiKey=a),i&&(p.outSpatialReference=i);try{return mN([await tN(l,p,{signal:d})],{sourceIndex:s,scale:h,view:o,zoomScale:c,defaultZoomScale:u})}catch(Vr){return[]}}(e,t):async function(e,t){const{source:r,suggestResult:i,spatialReference:n,view:s,maxResults:o,sourceIndex:a}=e,l=r?.zoomScale,c=r?.defaultZoomScale,u=i.text?.trim();if(!u)return null;const h=!i.key&&r.prefix?r.prefix:"",d=!i.key&&r.suffix?r.suffix:"",p=`${h}${i.text}${d}`,f=new JL,{apiKey:m,url:g}=r,y=s?.scale,_=fN(r,s),v=t?.signal;if(m&&(f.apiKey=m),!g)return null;r.categories&&(f.categories=r.categories),r.locationType&&(f.locationType=r.locationType),n&&(f.outSpatialReference=n);const b=hN(s,r);b&&(f.location=b),f.maxLocations=o,_&&(f.searchExtent=_),r.countryCode&&(f.countryCode=r.countryCode);const{key:w}=i,x=`${w}`;return w&&(f.magicKey=x),f.address={},f.address[r.singleLineFieldName||lN]=p,r.outFields&&(f.outFields=r.outFields),async function(e,t,r){t=JL.from(t);const i=(0,$L.Dl)(e),{address:n,...s}=t.toJSON(),o={...n,...s,f:"json"},a=(0,$L.lF)({...i.query,...o}),l=(0,$L.jV)(a,r),c=`${i.path}/findAddressCandidates`;return(0,Ub.A)(c,l).then(KL)}(g,f,{signal:v}).then((e=>mN(e,{key:x,scale:y,sourceIndex:a,view:s,zoomScale:l,defaultZoomScale:c})))}(e,t)}function hN(e,t){if(t.localSearchDisabled)return null;const r=e?.scale;return"number"==typeof r&&r<=cN?e?.extent?.center:null}async function dN(e,t){const{source:r,spatialReference:i,view:n,suggestTerm:s,maxSuggestions:o,sourceIndex:a}=e,l=new oN,{apiKey:c,url:u}=r,h=fN(r,n),d=t?.signal;if(!u)return null;c&&(l.apiKey=c),r.categories&&(l.categories=r.categories),i&&(l.outSpatialReference=i);const p=hN(n,r);if(p&&(l.location=p),!s.trim())return null;const{prefix:f="",suffix:m=""}=r,g=`${f}${s}${m}`;return l.text=g,h&&(l.searchExtent=h),l.maxSuggestions=o,r.countryCode&&(l.countryCode=r.countryCode),async function(e,t,r){const i=(0,$L.Dl)(e),n={...(t=oN.from(t)).toJSON(),f:"json"},s=(0,$L.lF)({...i.query,...n}),o=(0,$L.jV)(s,r),a=`${i.path}/suggest`;return(0,Ub.A)(a,o).then(aN)}(u,l,{signal:d}).then((e=>function(e,t){return e.map((e=>function(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}(e,t)))}(e,a)))}function pN(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}function fN(e,t){const{filter:r,withinViewEnabled:i}=e,n=t?.scale,s=t?.extent,o=r?.geometry;return(o?(0,mL.ZY)(o,t??void 0,n):void 0)||(i&&s?s:void 0)}function mN(e,t){return e.filter(Boolean).map((e=>function(e,t){const{key:r,scale:i,sourceIndex:n,view:s,zoomScale:o,defaultZoomScale:a}=t,{attributes:l,extent:c,location:u,address:h}=e,d=new Ef.A({geometry:u,attributes:l}),p=c||u,f=p?(0,mL.ZY)(p,s??void 0,i??void 0):void 0,m=f?"number"==typeof o?(0,mL.DN)(f,s??void 0,o):"number"==typeof a&&"point"===p?.type?(0,mL.DN)(f,s??void 0,a):f:null,g=u?`${u.x},${u.y}`:"",y=h||g,_=d.clone();return null!=m&&(_.geometry=vL.A.fromExtent(m)),{extent:m,feature:d,target:_,key:r,name:y,sourceIndex:n}}(e,t)))}var gN;let yN=gN=class extends _L{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.localSearchDisabled=!1,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(e,t)=>uN({source:this,...e},t),this.getSuggestions=(e,t)=>dN({source:this,...e},t)}clone(){return new gN({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?(0,qe.o8)(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?(0,qe.o8)(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};(0,ze._)([(0,Qe.MZ)()],yN.prototype,"apiKey",void 0),(0,ze._)([(0,Qe.MZ)()],yN.prototype,"categories",void 0),(0,ze._)([(0,Qe.MZ)()],yN.prototype,"countryCode",void 0),(0,ze._)([(0,Qe.MZ)({json:{write:!0}})],yN.prototype,"defaultZoomScale",void 0),(0,ze._)([(0,Qe.MZ)()],yN.prototype,"localSearchDisabled",void 0),(0,ze._)([(0,Qe.MZ)()],yN.prototype,"locationType",void 0),(0,ze._)([(0,Qe.MZ)({json:{write:!0}})],yN.prototype,"name",void 0),(0,ze._)([(0,Qe.MZ)({json:{write:!0}})],yN.prototype,"placeholder",void 0),(0,ze._)([(0,Qe.MZ)()],yN.prototype,"searchTemplate",void 0),(0,ze._)([(0,Qe.MZ)({json:{write:!0}})],yN.prototype,"singleLineFieldName",void 0),(0,ze._)([(0,Qe.MZ)({json:{read:{source:"suggest"},write:{target:"suggest"}}})],yN.prototype,"suggestionsEnabled",void 0),(0,ze._)([(0,Qe.MZ)({json:{write:!0}})],yN.prototype,"url",void 0),(0,ze._)([(0,Qe.MZ)({json:{write:!0}})],yN.prototype,"zoomScale",void 0),yN=gN=(0,ze._)([(0,tt.$)("esri.widgets.Search.LocatorSearchSource")],yN);const _N=yN,vN=()=>Xe.A.getLogger("esri.widgets.support.geolocationUtils"),bN={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function wN(){return function(){const e=(0,it.A)("esri-geolocation");return e||vN().warn("geolocation-unsupported","Geolocation unsupported."),e}()&&function(){const e=window.isSecureContext;return e||vN().warn("insecure-context","Geolocation requires a secure origin."),e}()}let xN;function SN(e,t){if(xN)return xN(e,t);const{position:r,view:i}=e,n=function(e){const t=e&&e.coords||{},r={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e?{coords:r,timestamp:e.timestamp}:e}(r),s=n?.coords;if(!s)throw new Ze.A("geometry-service:no-coords","Geolocation has no coordinates");return function(e,t,r){if(!t)return Promise.resolve(e);const i=t.spatialReference;return i.isWGS84?Promise.resolve(e):i.isWebMercator?Promise.resolve((0,$r.Gh)(e)):function(e){if(pL.A.geometryServiceUrl)return Promise.resolve(pL.A.geometryServiceUrl);const t=qr.A.getDefault();return t.load(e).catch((()=>{})).then((()=>t.helperServices?.geometry?.url))}(r).then((t=>{if(!t)throw new Ze.A("geometry-service:missing-url","Geometry service URL is missing");const n=new Xr.A({geometries:[e],outSpatialReference:i});return(0,Yr.C)(t,n,r).then((e=>e[0]))}))}(function(e){let{longitude:t,latitude:r,altitude:i}=e;return new df.A({longitude:t,latitude:r,z:i||void 0,spatialReference:{wkid:4326}})}(s),i,t)}var TN=r(27410),MN=r(7246),AN=r(86875),CN=r(86659);function EN(e,t){return e.hasOwnProperty(t)&&null!=e[t]&&""!==e[t]}const RN="highlight",PN=je.A.ofType({key:e=>e.layer?"layer":"locator",base:_L,typeMap:{layer:ZL,locator:_N}}),ON=Bt.A.WGS84,IN=/<[\s\S]*?>/g,LN=-1;let NN=class extends((0,EI.R)(pt.A.EventedMixin(ht.A))){constructor(e){super(e),this._gotoController=null,this._searching=null,this._updatingPromise=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new PN,this.defaultSymbols={point:new TN.A({url:(0,ic.s)("esri/images/search/search-symbol-32.png"),size:24,width:24,height:24}),polyline:new MN.A({color:[130,130,130,1],width:2}),polygon:new AN.A({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=qr.A.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new PN,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const e=await(0,gL.ud)("esri/widgets/Search/t9n/Search");this.messages=e,this.defaultPopupTemplate=new fL.A({title:e.searchResult,content:"{Match_addr}"})};e(),this.addHandles([(0,gt.wB)((()=>[this.includeDefaultSources,this.view,this.portal]),(()=>this._update()),gt.Vh),(0,iI.oQ)(e)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics()}get activeSource(){return this.allSources.at(this.activeSourceIndex)??null}get activeSourceIndex(){return 1!==this.allSources.length&&this.searchAllEnabled?LN:0}set activeSourceIndex(e){this._overrideIfSome("activeSourceIndex",e)}get allPlaceholder(){return this.messages?.allPlaceholder}set allPlaceholder(e){this._overrideIfSome("allPlaceholder",e)}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:r}=this,i="function"==typeof r?r.call(null,{sources:e,defaultSources:t}):r?t.concat(e):e,n=this._get("allSources")||new PN;return n.removeAll(),n.addMany(i.filter(Boolean)),n}get locationEnabled(){return this._get("locationEnabled")||wN()}set locationEnabled(e){if(void 0===e)return void this._clearOverride("locationEnabled");const t=wN();if(e&&!t){const e=new Ze.A("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});Xe.A.getLogger(this).error(e)}this._override("locationEnabled",!!e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:r}=this;if(t===LN)return r??"";const i=e.at(t);return i?.placeholder??""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),""===e&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":0===this.allSources.length?"disabled":"ready"}get updating(){return null!=this._updatingPromise}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup();const{view:e,resultGraphic:t}=this;e&&t&&e.graphics.remove(t),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const r=this._createSuggestionForSearch(e),i=(async()=>{try{await this.when();const e=await this._getResultsFromSources(r,t);if(t?.signal?.aborted)return null;const i={activeSourceIndex:this.activeSourceIndex,searchTerm:r.text??"",numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(i,e,r);const n=this._getFirstResult(i.results),s=r.location&&n?n.name:r.text,o=s?.replace(IN,"");return this._set("searchTerm",o),(r.key&&"number"==typeof r.sourceIndex||r.location)&&this._set("selectedSuggestion",r),this._set("results",i.results),this._set("resultCount",i.results.reduce(((e,t)=>e+(t.results?.length??0)),0)),this.emit("search-complete",i),await this._selectFirstResult(n),i}finally{this._clearSearching()}})();return this._searching=i,i}async searchNearby(e){if(!this.locationEnabled){const e=new Ze.A("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});throw Xe.A.getLogger(this).error(e),e}const t=(async()=>{try{const t=await function(e){return e||(e=bN),new Promise(((t,r)=>{setTimeout((()=>r(new Ze.A("geolocation:timeout","getting the current geolocation position timed out"))),15e3),navigator.geolocation.getCurrentPosition(t,r,e??void 0)}))}(),r=await SN({position:t,view:this.view},e);return await this.search(r,e)}finally{this._clearSearching()}})();return this._searching=t,t}async select(e){if(this.clearGraphics(),!e){const t=new Ze.A("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});throw Xe.A.getLogger(this).error(t),t}const{view:t}=this,r=EN(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),i=null!=r?this.allSources.at(r):null;if(!i){const e=new Ze.A("select:missing-source","Cannot select without a source.",{source:i});throw Xe.A.getLogger(this).error(e),e}const n=i instanceof ZL?this._getLayerSourcePopupTemplate(i):i.popupTemplate,s=i.resultSymbol||this._getDefaultSymbol(e),o=EN(i,"resultGraphicEnabled")?i.resultGraphicEnabled:this.resultGraphicEnabled,a=EN(i,"autoNavigate")?i.autoNavigate:this.autoNavigate,l=EN(i,"popupEnabled")?i.popupEnabled:this.popupEnabled,c=l?n||this.popupTemplate||this.defaultPopupTemplate:null,{feature:u}=e;if(!u){const e=new Ze.A("select:missing-feature","Cannot select without a feature.",{feature:u});throw Xe.A.getLogger(this).error(e),e}const{attributes:h,geometry:d,layer:p,sourceLayer:f}=u,m=d?(0,mL.z8)(d):null,g={layerViewQuery:this._getLayerView(u),elevationQuery:t&&null!=m?(0,mL.Sv)(m,t):Promise.resolve(m)},y=await(0,Ke.Lx)(g),_=y.layerViewQuery.value,v=y.elevationQuery.value;s instanceof CN.A&&(s.text=e.name);const b=t&&a?e.target||e.extent:null,w=null!=b?this._goToSearchResult(b):Promise.resolve();await w;const x=_?u:new Ef.A({geometry:d,symbol:s,attributes:h,layer:p,sourceLayer:f,popupTemplate:c}),S=t?.popup,T=S&&l&&x.getEffectivePopupTemplate(S.defaultPopupTemplateEnabled);return T&&await t.openPopup({features:[x],location:v}),_&&(0,YO.Of)(_)&&!T&&this._highlightFeature({graphic:x,layerView:_}),!_&&o&&t&&t.graphics.push(x),this._setResultFloor(e),this._set("selectedResult",e),this._set("resultGraphic",x),this.emit("select-result",{result:e,source:i,sourceIndex:r}),e}async suggest(e,t,r){const i=e||this.searchTerm;this.emit("suggest-start",{searchTerm:i}),await this._suggestTimer(t,r);const n=await this._suggestImmediate(i,r);return this._set("suggestions",n?.results),this._set("suggestionCount",n?.results.reduce(((e,t)=>e+(t.results?.length??0)),0)??null),this.emit("suggest-complete",n),n}async when(){await(0,gt.C_)((()=>!this.updating))}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const r=this._updatingPromise=(0,Ke.Lx)([e?.load(),t?.when()]);if(this.destroyed)return;if(await r,r!==this._updatingPromise)return}await(0,gt.C_)((()=>this.messages)),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){const e=this.portal?.helperServices?.geocode;return e?e.map((e=>{if(!1===e.placefinding)return;const t=pL.A.apiKey&&pN(e.url)?{url:"https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer"}:null,r=_N.fromJSON({...e,...t}),i=r.url;if(pN(i)||function(e){return!!e&&/(?:\/servers\/[\da-z.-]+\/rest\/services\/world\/geocodeserver).*/i.test(e)}(i)||function(e){return!!e&&/(?:geocode-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}(i)){const e=r.outFields??["Addr_type","Match_addr","StAddr","City"],t=(r.placeholder||this.messages?.placeholder)??"",i="number"==typeof r.defaultZoomScale?r.defaultZoomScale:2500;r.singleLineFieldName="SingleLine",r.outFields=e,r.placeholder=t,r.defaultZoomScale=i}return r.singleLineFieldName?r:void 0})).filter(Dt.Ru):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach((e=>e?.destroy())),this._createdFeatureLayers=[]}_getLayerSources(e,t){const r=this.view?.map;return e.map((e=>{const i=r.findLayerById(e.id);if(!i)return;const n=this._getLayerJSON(e),s=ZL.fromJSON(n);return s.placeholder=t,this._getLayer(i,n).then((e=>{s.layer=e})),s})).filter(Dt.Ru).toArray()}_getTableSources(e,t){const r=this.view?.map;return e.map((e=>{if(!e.id)return;const i=r.findTableById(e.id);if(!i)return;const n=this._getLayerJSON(e),s=ZL.fromJSON(n);return s.placeholder=t,this._getLayer(i,n).then((e=>{s.layer=e})),s})).filter(Dt.Ru).toArray()}_convertApplicationProperties(){const e=this.view?.map,t=e?.applicationProperties?.viewing?.search;if(!t)return[];const{enabled:r,hintText:i,layers:n,tables:s}=t;return r?[...this._getLayerSources(n,i),...this._getTableSources(s,i)]:[]}async _getSubLayer(e,t){if(await e.load(),!e.allSublayers)throw new Error;const r=e.allSublayers.find((e=>e.id===t.subLayer));if(!r)throw new Error;const i=await(r.createFeatureLayer?.());if(!i)throw new Error;return this._createdFeatureLayers.push(i),i}async _getBuildingSubLayer(e,t){await e.load();const r=e.allSublayers.find((e=>e.id===t.subLayer));if("building-component"!==r?.type)throw new Error;if(await r.load(),null==r.associatedLayer)throw new Error;return await r.associatedLayer.load(),r}async _getLayer(e,t){if("feature"===e.type||"scene"===e.type||"csv"===e.type||"geojson"===e.type||"ogc-feature"===e.type)return e;if("map-image"===e.type)try{return await this._getSubLayer(e,t)}catch(r){const t=new Ze.A("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return Xe.A.getLogger(this).error(t),null}return"building-scene"===e.type?this._getBuildingSubLayer(e,t):null}_getLayerJSON(e){return"function"==typeof e.toJSON?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;this._destroyFeatureLayers(),e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){const e=this.view?.popup,{resultGraphic:t}=this;if(!e||!t)return;const r="selectedFeature"in e,i=r?e.selectedFeature:null;r&&i&&i===t&&e.close()}_suggestTimer(e,t){const r=null!=e?e:this.suggestionDelay;return(0,Ke.Pl)(r,null,t?.signal)}_createLocationForSearch(e){return e instanceof Ef.A&&e.geometry?(0,mL.z8)(e.geometry):e instanceof df.A?e:Array.isArray(e)&&2===e.length?new df.A({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&EN(e,"key")&&EN(e,"text")&&EN(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),r="string"==typeof e?e:this.searchTerm,{selectedSuggestion:i,selectedResult:n}=this,s=!e&&i&&n,o=s&&i.key===n.key&&i.sourceIndex===n.sourceIndex,a=s&&i.location;return o||a?i:{location:t,text:t?"":r,sourceIndex:null,key:null}}_getFirstResult(e){return(0,Je.Pb)(e,(e=>{let{results:t}=e;return t?.[0]}))??null}async _selectFirstResult(e){return this.autoSelect&&e?this.select(e):null}async _suggestImmediate(e,t){await this.when();const r=await this._getSuggestionsFromSources(e,t);if(t?.signal?.aborted)return null;const i={activeSourceIndex:this.activeSourceIndex,searchTerm:e??"",numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(i,r),i}_formatSourceResponse(e,t,r){const i=t?.value||[],n=t?.error,s=this.allSources.at(r);if(n){const t={sourceIndex:r,source:s,error:n};e.errors.push(t),Xe.A.getLogger(this).error(n),e.numErrors++}else{const t={sourceIndex:r,source:s,results:i};e.results.push(t),e.numResults+=i.length}}_formatResponse(e,t,r){if(t)if(e.activeSourceIndex===LN){const i=r&&EN(r,"sourceIndex")&&-1!==r.sourceIndex?r.sourceIndex:void 0;t.forEach(((t,r)=>{const n=void 0!==i?i:r;this._formatSourceResponse(e,t,n)}))}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}async _getResultsFromSources(e,t){const{allSources:r}=this,i=!e.location&&EN(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,n=[];if(!r.length){const e=new Ze.A("search:no-sources-defined","At least one source is required.",{allSources:r});throw Xe.A.getLogger(this).error(e),e}return i===LN?r.forEach(((r,i)=>{n.push(this._getResultsFromSource(e,i,t))})):n.push(this._getResultsFromSource(e,i,t)),(0,Ke.Lx)(n)}async _getSuggestionsFromSources(e,t){const{allSources:r,activeSourceIndex:i}=this,n=[];if(!r.length){const e=new Ze.A("suggest:no-sources-defined","At least one source is required.",{allSources:r});throw Xe.A.getLogger(this).error(e),e}return i===LN?r.forEach(((r,i)=>{n.push(this._getSuggestionsFromSource(e,i,t))})):n.push(this._getSuggestionsFromSource(e,i,t)),(0,Ke.Lx)(n)}async _getResultsFromSource(e,t,r){const i=null!=t?this.allSources.at(t):null;if(!i)return null;const{location:n=null}=e,s=this.view?.spatialReference||ON,o=EN(i,"maxResults")?i.maxResults:this.maxResults,a=!!(i instanceof ZL&&EN(i,"exactMatch"))&&i.exactMatch,{view:l}=this;return i.getResults?.({view:l,sourceIndex:t,location:n,suggestResult:e,spatialReference:s,exactMatch:a,maxResults:o},r)}async _getSuggestionsFromSource(e,t,r){const i=this.allSources.at(t);if(!i)return null;e??="";const n=EN(i,"suggestionsEnabled")?i.suggestionsEnabled:this.suggestionsEnabled,s=e?.length,o=EN(i,"minSuggestCharacters")?i.minSuggestCharacters:this.minSuggestCharacters;if(n&&e.trim()&&s>=o){const n=this.view?.spatialReference||ON,s=EN(i,"maxSuggestions")?i.maxSuggestions:this.maxSuggestions,{view:o}=this,a=!!(i instanceof ZL&&EN(i,"exactMatch"))&&i.exactMatch;return i.getSuggestions?.({view:o,sourceIndex:t,suggestTerm:e,spatialReference:n,maxSuggestions:s,exactMatch:a},r)}return null}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return EN(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){return(0,Je.Pb)(this.results??[],(t=>{let{results:r,sourceIndex:i}=t;const n=r?.includes(e);return n?i:null}))??null}async _goToSearchResult(e){this._abortGoTo();const t=new AbortController;this._gotoController=t;const r={target:{target:e},options:{signal:t.signal}};e||(r.options.animate=!1),await this.callGoTo(r),this._gotoController=null}_getDefaultSymbol(e){const{defaultSymbols:t}=this,r=e.feature?.geometry;if(null==r)return null;switch(r.type){case"point":case"multipoint":return t.point;case"polyline":return t.polyline;case"extent":case"polygon":return t.polygon;default:return null}}_removeHighlight(){this.removeHandles(RN)}async _getLayerView(e){const{view:t}=this;if(!e||!t||"building-component"===e.layer?.type||"subtype-sublayer"===e.layer?.type)return null;const{layer:r}=e;return r?(await t.when(),t.whenLayerView(r)):null}_highlightFeature(e){const{graphic:t,layerView:r}=e,{attributes:i,layer:n}=t,{objectIdField:s}=n,o=(s&&i?.[s])??null,a=r.highlight(o??t);this.addHandles(a,RN)}_setResultFloor(e){const{view:t}=this,r=e.feature?.attributes,i=e.feature?.sourceLayer;if(i&&"floorInfo"in i&&i?.floorInfo?.floorField&&r){const e=r[i.floorInfo.floorField];t?.emit("select-result-floor",e)}}};NN.ALL_INDEX=LN,(0,ze._)([(0,Qe.MZ)()],NN.prototype,"_searching",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"_updatingPromise",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0,value:null})],NN.prototype,"activeSource",null),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"activeSourceIndex",null),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"allPlaceholder",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],NN.prototype,"allSources",null),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"autoNavigate",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"autoSelect",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"defaultPopupTemplate",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],NN.prototype,"defaultSources",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"defaultSymbols",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"includeDefaultSources",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"locationEnabled",null),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"maxInputLength",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"maxResults",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"maxSuggestions",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"messages",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"minSuggestCharacters",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],NN.prototype,"placeholder",null),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"popupEnabled",void 0),(0,ze._)([(0,Qe.MZ)({type:fL.A})],NN.prototype,"popupTemplate",void 0),(0,ze._)([(0,Qe.MZ)({type:qr.A})],NN.prototype,"portal",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"resultCount",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"resultGraphicEnabled",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],NN.prototype,"resultGraphic",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],NN.prototype,"results",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],NN.prototype,"selectedSuggestion",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"searchAllEnabled",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],NN.prototype,"selectedResult",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"searchTerm",null),(0,ze._)([(0,Qe.MZ)({type:PN})],NN.prototype,"sources",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],NN.prototype,"state",null),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"suggestionDelay",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"suggestionCount",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],NN.prototype,"suggestions",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"suggestionsEnabled",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],NN.prototype,"updating",null),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"view",void 0),(0,ze._)([(0,Qe.MZ)()],NN.prototype,"clear",null),NN=(0,ze._)([(0,tt.$)("esri.widgets.Search.SearchViewModel")],NN);const DN=NN;let FN=class extends pI.A{constructor(e,t){super(e,t),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}destroy(){this.viewModel=null}render(){const e={[dL.showMoreResults]:this.showMoreResultsOpen};return(0,SI.K)("div",{class:this.classes(dL.base,bI.D.widget)},(0,SI.K)("div",{class:this.classes(dL.moreResults,e),key:"esri-search-renderer__container"},this._renderSearchResultName(),this._renderMoreResults()))}_renderMoreResults(){return(0,SI.K)("div",{key:"esri-search-renderer__more-results"},this._renderMoreResultsButton(),this._renderMoreResultsLists())}_renderSearchResultName(){const e=this.viewModel?.selectedResult,t=e?.name||"";return(0,SI.K)("div",{class:dL.moreResultsItem,key:"esri-search-renderer__result-name"},t)}_renderMoreResultsLists(){const{viewModel:e}=this;if(!e)return[];const t=e.results;if((e.resultCount??0)<2)return null;const r=t?.map((e=>this._renderMoreResultsList(e)));return(0,SI.K)("div",{class:dL.moreResultsList,key:"esri-search-renderer__more-results-container"},r)}_renderMoreResultsButton(){const{messages:e,viewModel:t}=this;return t?(t.resultCount??0)<2?null:(0,SI.K)("div",{class:dL.moreResultsItem,key:"esri-search-renderer__more-results-button"},(0,SI.K)("a",{bind:this,class:bI.D.anchor,href:"#",onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?e.hideMoreResults:e.showMoreResults)):null}_renderMoreResultsHeader(e,t){return(0,SI.K)("div",{class:dL.moreResultsListHeader,key:`esri-search-result-renderer__header-${t}`},e)}_renderMoreResultsList(e){const{results:t}=e,r=t?.length??0,i=r>0,n=this.viewModel?.selectedResult,s=1===r&&t[0]===n,o=this._getSourceName(e.source,e.sourceIndex),a=(this.viewModel?.results?.length??0)>1&&!s?this._renderMoreResultsHeader(o,e.sourceIndex):null,l=i&&t.map(((e,t)=>this._renderMoreResultsListItem(e,t))),c=i&&!s?(0,SI.K)("ul",{key:`esri-search-result-renderer__list-${e.sourceIndex}`},l):null;return i?(0,SI.K)("div",{key:`esri-search-result-renderer__results-${e.sourceIndex}`},a,c):null}_renderMoreResultsListItem(e,t){const r=this.viewModel?.selectedResult;return e!==r?(0,SI.K)("li",{key:`esri-search-result-renderer__list-item-${t}`},(0,SI.K)("a",{bind:this,class:bI.D.anchor,"data-result":e,href:"#",onclick:this._selectResultClick,onkeydown:this._selectResultClick,tabIndex:0},e.name)):null}_showMoreResultsClick(e){e.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;const t=this.viewModel?.view?.popup;t&&"reposition"in t&&t.reposition()}_selectResultClick(e){e.preventDefault();const t=e.currentTarget["data-result"];this.viewModel?.select(t)}_getSourceName(e,t){return t===DN.ALL_INDEX?this.messages.all:e.name}};(0,ze._)([(0,Qe.MZ)(),(0,xI.G)("esri/widgets/Search/t9n/Search")],FN.prototype,"messages",void 0),(0,ze._)([(0,Qe.MZ)()],FN.prototype,"showMoreResultsOpen",void 0),(0,ze._)([(0,Qe.MZ)()],FN.prototype,"viewModel",void 0),(0,ze._)([(0,wI.$)()],FN.prototype,"_showMoreResultsClick",null),(0,ze._)([(0,wI.$)()],FN.prototype,"_selectResultClick",null),FN=(0,ze._)([(0,tt.$)("esri.widgets.Search.SearchResultRenderer")],FN);const kN=FN;var zN=r(15062),UN=r(12254);const VN=/<[a-z/][\s\S]*>/i;let BN=class extends pI.A{constructor(e,t){super(e,t),this._activeMenuItemIndex=-1,this._inputNode=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new kN,this._suggestController=null,this._searchController=null,this._locateFailed=!1,this._container=null,this.activeMenu="none",this.disabled=!1,this.messages=null,this.messagesCommon=null,this.viewModel=new DN,this._clearActiveMenu=()=>{this.activeMenu="none"},this._removeActiveMenu=e=>{const t=e.relatedTarget;t&&this._container?.contains(t)||this._clearActiveMenu()},this.addHandles([(0,gt.wB)((()=>this.searchTerm),(e=>{(e&&"warning"===this.activeMenu||!e&&!this.viewModel?.selectedSuggestion?.location)&&this._clearActiveMenu()})),(0,gt.on)((()=>this.viewModel?.allSources),"change",(()=>this._watchSourceChanges())),(0,gt.wB)((()=>this.activeMenu),(()=>this._resetActiveMenuItemIndex()),gt.Vh),(0,gt.wB)((()=>this.viewModel?.defaultPopupTemplate),(e=>{e&&(e.content=this._renderSearchResultsContent.bind(this))}),gt.Vh)])}destroy(){this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer=(0,Je.pR)(this._searchResultRenderer)}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}get activeSource(){return this.viewModel?.activeSource}get activeSourceIndex(){return this.viewModel.activeSourceIndex}set activeSourceIndex(e){this.viewModel.activeSourceIndex=e}get allPlaceholder(){return this.viewModel.allPlaceholder}set allPlaceholder(e){this.viewModel.allPlaceholder=e}get allSources(){return this.viewModel.allSources}get autoNavigate(){return this.viewModel.autoNavigate}set autoNavigate(e){this.viewModel.autoNavigate=e}get autoSelect(){return this.viewModel.autoSelect}set autoSelect(e){this.viewModel.autoSelect=e}get defaultSources(){return this.viewModel.defaultSources}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"search"}set icon(e){this._overrideIfSome("icon",e)}get includeDefaultSources(){return this.viewModel.includeDefaultSources}set includeDefaultSources(e){this.viewModel.includeDefaultSources=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get locationEnabled(){return this.viewModel.locationEnabled}set locationEnabled(e){this.viewModel.locationEnabled=e}get maxResults(){return this.viewModel.maxResults}set maxResults(e){this.viewModel.maxResults=e}get maxSuggestions(){return this.viewModel.maxSuggestions}set maxSuggestions(e){this.viewModel.maxSuggestions=e}get minSuggestCharacters(){return this.viewModel.minSuggestCharacters}set minSuggestCharacters(e){this.viewModel.minSuggestCharacters=e}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(e){this.viewModel.popupEnabled=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get portal(){return this.viewModel?.portal}set portal(e){this.viewModel&&(this.viewModel.portal=e)}get resultGraphic(){return this.viewModel.resultGraphic}set resultGraphic(e){this.viewModel.resultGraphic=e}get resultGraphicEnabled(){return this.viewModel.resultGraphicEnabled}set resultGraphicEnabled(e){this.viewModel.resultGraphicEnabled=e}get results(){return this.viewModel.results}get searchAllEnabled(){return this.viewModel.searchAllEnabled}set searchAllEnabled(e){this.viewModel.searchAllEnabled=e}get searchTerm(){return this.viewModel.searchTerm}set searchTerm(e){this.viewModel.searchTerm=e}get selectedResult(){return this.viewModel.selectedResult}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get suggestions(){return this.viewModel.suggestions}get suggestionsEnabled(){return this.viewModel.suggestionsEnabled}set suggestionsEnabled(e){this.viewModel.suggestionsEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}clear(){this.viewModel.clear()}focus(){this._inputNode?.focus(),this.emit("search-focus")}blur(){this._inputNode?.blur(),this.emit("search-blur")}async search(e){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();const t=new AbortController,{signal:r}=t;this._searchController=t;try{const i=await this.viewModel.search(e,{signal:r});if(this._searchController!==t)return;return this.activeMenu=i?.numResults?"none":"warning",this._searchController=null,i}catch(i){if(this._searchController!==t)return;return this._clearActiveMenu(),void(this._searchController=null)}}async suggest(e){this._cancelSuggest();const t=new AbortController,{signal:r}=t;this._suggestController=t;try{const i=await this.viewModel.suggest(e,null,{signal:r});if(this._suggestController!==t)return;return this._suggestController=null,i?.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),i}catch(i){return this._suggestController!==t||(this._suggestController=null),null}}render(){const{state:e}=this.viewModel,t={[bI.D.disabled]:"disabled"===e,[bI.D.widgetDisabled]:this.disabled};return(0,SI.K)("div",{class:this.classes(uL.base,bI.D.widget,t)},"loading"===e?this._renderLoader():this._renderContainer())}_renderSubmitButton(){const{messages:e,disabled:t}=this;return(0,SI.K)("button",{"aria-label":e.searchButtonTitle,bind:this,class:this.classes(uL.submitButton,bI.D.widgetButton),disabled:t,key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:e.searchButtonTitle,type:"button"},(0,SI.K)("span",{"aria-hidden":"true",class:zN.T.search}))}_renderWarningMenu(){return(0,SI.K)("div",{class:this.classes(bI.D.menu,uL.warningMenu),key:"esri-search__error-menu"},(0,SI.K)("div",{class:uL.warningMenuBody},this._renderWarning()))}_renderSourceMenuButton(){const{messages:e,activeMenu:t,sourceMenuId:r,sourceMenuButtonId:i,disabled:n}=this,{activeSourceIndex:s,allSources:o}=this.viewModel;return o.length>1?(0,SI.K)("button",{afterCreate:rI.cA,"aria-controls":r,"aria-expanded":("source"===t).toString(),"aria-haspopup":"true","aria-label":e.searchIn,bind:this,class:this.classes(uL.sourcesButton,bI.D.widgetButton),"data-node-ref":"_sourceMenuButtonNode",disabled:n,id:i,key:"esri-search__source-menu-button",onclick:this._handleSourcesMenuToggleClick,onfocus:this._handleSourcesMenuToggleFocus,title:e.searchIn,type:"button"},(0,SI.K)("span",{"aria-hidden":"true",class:this.classes(zN.T.downArrow,uL.sourcesButtonDown)}),(0,SI.K)("span",{"aria-hidden":"true",class:this.classes(zN.T.upArrow,uL.sourcesButtonUp)}),(0,SI.K)("span",{class:uL.sourceName},this._getSourceName(s))):null}_renderSourcesList(){const{allSources:e,searchAllEnabled:t}=this.viewModel,{_activeMenuItemIndex:r,activeMenu:i,sourceMenuId:n,sourceMenuButtonId:s}=this,o="source"===i&&r>-1?this._buildId("source-item",r):null;return e.length>1?(0,SI.K)("ul",{afterCreate:rI.cA,"aria-activedescendant":o,"aria-labelledby":s,bind:this,class:bI.D.menuList,"data-node-ref":"_sourceListNode",id:n,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,role:"menu",tabIndex:-1},t?this._renderSource(DN.ALL_INDEX):null,e.map(((e,t)=>this._renderSource(t))).toArray()):null}_renderSourcesMenu(){const{allSources:e}=this.viewModel;return e.length>1?(0,SI.K)("div",{class:this.classes(bI.D.menu,uL.sourcesMenu),key:"esri-search__source-menu"},this._renderSourcesList()):null}_renderLoader(){const{messages:e,messagesCommon:t,disabled:r}=this;return(0,SI.K)("div",{class:bI.D.loader,key:"base-loader",tabIndex:r?-1:void 0},(0,SI.K)("span",{"aria-hidden":"true",class:bI.D.loaderAnimation}),(0,SI.K)("span",{class:zN.T.fontFallbackText},e.searchButtonTitle),(0,SI.K)("span",{class:bI.D.loaderText},t.loading))}_renderContainer(){const{allSources:e,state:t}=this.viewModel,{activeMenu:r}=this,i={[uL.hasMultipleSources]:e.length>1,[uL.isLoading]:"loading"===t,[uL.isSearching]:"searching"===t,[uL.showWarning]:"warning"===r,[uL.showSources]:"source"===r,[uL.showSuggestions]:"suggestion"===r};return(0,SI.K)("div",{afterCreate:e=>{this._container=e,e.addEventListener("focusout",this._removeActiveMenu)},afterRemoved:e=>{e.removeEventListener("focusout",this._removeActiveMenu)},class:this.classes(i,uL.container),key:"base-container",tabIndex:-1},this._renderSourceMenuButton(),this._renderSourcesMenu(),this._renderInputContainer(),this._renderSubmitButton(),this._renderWarningMenu())}_renderClearButton(){return this.searchTerm?(0,SI.K)("button",{bind:this,class:this.classes(uL.clearButton,bI.D.widgetButton),disabled:this.disabled,key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle,type:"button"},(0,SI.K)("span",{"aria-hidden":"true",class:zN.T.close})):null}_renderLocationGroup(){const{messages:e,locationEnabled:t,displayedSearchTerm:r}=this,i=t&&!r,n="suggestion"===this.activeMenu&&0===this._activeMenuItemIndex;return i?(0,SI.K)("ul",{class:this.classes(bI.D.menuList,uL.suggestionList,uL.suggestionListCurrentLocation),key:"esri-search__suggestion-list-current-location",role:"group"},(0,SI.K)("li",{"aria-selected":("suggestion"===this.activeMenu&&0===this._activeMenuItemIndex).toString(),bind:this,class:this.classes(bI.D.menuItem,n?bI.D.menuItemFocus:null),"data-current-location-item":!0,id:this._buildId("suggestion-item",0),onclick:this._handleUseCurrentLocationClick,role:"option"},(0,SI.K)("span",{"aria-hidden":"true",class:zN.T.locateCircled})," ",e.useCurrentLocation)):null}_renderInput(){const{activeMenu:e,locationEnabled:t,displayedSearchTerm:r,messages:i,suggestionsMenuId:n,inputId:s,_activeMenuItemIndex:o,disabled:a}=this,{maxInputLength:l,placeholder:c,searchTerm:u,suggestionCount:h}=this.viewModel,d=!((!t||r)&&!h),p="suggestion"===e&&o>-1?this._buildId("suggestion-item",o):null;return(0,SI.K)("input",{afterCreate:rI.cA,"aria-activedescendant":p,"aria-autocomplete":"list","aria-controls":d?n:null,"aria-expanded":(d&&"suggestion"===e).toString(),"aria-haspopup":"listbox","aria-label":i.searchButtonTitle,autocomplete:"off",bind:this,class:this.classes(bI.D.input,uL.input),"data-node-ref":"_inputNode",disabled:a,id:s,maxlength:l,onblur:this.blur,onclick:this._openSuggestionMenu,onfocus:this.focus,oninput:this._handleInputPaste,onkeyup:this._handleInputKeyup,onpaste:this._handleInputPaste,placeholder:c,role:"combobox",title:u?"":c,type:"text",value:u})}_renderForm(){return(0,SI.K)("form",{bind:this,class:uL.form,disabled:this.disabled,key:"esri-search__form",onsubmit:this._formSubmit,role:"search"},this._renderInput())}_renderSuggestList(e){const{sourceIndex:t}=e,{results:r}=e,i=r?.length;return i?(0,SI.K)("ul",{class:this.classes(bI.D.menuList,uL.suggestionList),key:`esri-search__suggestion-list-${t}`,role:"group"},r?.map((e=>this._renderSuggestion(e,this._menuItemCount++)))):null}_renderSuggestionsGroup(){const{suggestions:e}=this.viewModel;return e?e.map((e=>[this._renderSuggestionHeader(e),this._renderSuggestList(e)])):[]}_renderSuggestionsMenu(){const{displayedSearchTerm:e,locationEnabled:t,suggestionsMenuId:r,inputId:i}=this,{suggestionCount:n}=this.viewModel,s=t&&!e||n;return this._menuItemCount=0,s?(0,SI.K)("div",{afterCreate:rI.cA,"aria-labelledby":i,bind:this,class:this.classes(bI.D.menu,uL.suggestionsMenu),"data-node-ref":"_suggestionListNode",id:r,key:"esri-search__suggestions-menu",role:"listbox"},this._renderLocationGroup(),this._renderSuggestionsGroup()):null}_renderInputContainer(){return(0,SI.K)("div",{class:uL.inputContainer,key:"esri-search__input-container"},this._renderForm(),this._renderSuggestionsMenu(),this._renderClearButton())}_renderSuggestionHeader(e){const{allSources:t,activeSourceIndex:r}=this.viewModel,{sourceIndex:i}=e,n=e.results?.length,s=t.length>1&&r===DN.ALL_INDEX;return n&&s?(0,SI.K)("div",{class:bI.D.menuHeader,key:`esri-search__suggestion-header-${i}`},this._getSourceName(i)):null}_renderSuggestion(e,t){const{_activeMenuItemIndex:r,viewModel:{searchTerm:i}}=this;if(!i)return;const n="suggestion"===this.activeMenu&&r===t;return(0,SI.K)("li",{"aria-selected":("suggestion"===this.activeMenu&&this._activeMenuItemIndex===t).toString(),bind:this,class:this.classes(bI.D.menuItem,n?bI.D.menuItemFocus:null),"data-suggestion":e,id:this._buildId("suggestion-item",t),innerHTML:this._getSuggestResultHTML(e.text,i),key:`esri-search__suggestion_${t}`,onclick:this._handleSuggestionClick,role:"option"})}_renderSource(e){const{activeSourceIndex:t,searchAllEnabled:r}=this.viewModel,i={[bI.D.menuItemActive]:e===t,[bI.D.menuItemFocus]:"source"===this.activeMenu&&e===(r?this._activeMenuItemIndex-1:this._activeMenuItemIndex)},n=r?e+1:e;return(0,SI.K)("li",{"aria-checked":(e===t).toString(),bind:this,class:this.classes(uL.source,bI.D.menuItem,i),"data-source-index":e,id:this._buildId("source-item",n),key:`esri-search__source-${e}`,onclick:this._handleSourceClick,role:"menuitemradio"},this._getSourceName(e))}_renderNoResultsWarning(e){const{messages:t}=this,r=e?(0,wL.V)(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return(0,SI.K)("div",{key:"esri-search__no_results"},(0,SI.K)("div",{class:uL.warningMenuHeader},t.noResults),(0,SI.K)("div",{class:uL.warningMenuText},r))}_renderEmptySearchWarning(){const{messages:e}=this;return(0,SI.K)("div",{key:"esri-search__empty-search"},(0,SI.K)("span",{"aria-hidden":"true",class:zN.T.noticeTriangle}),(0,SI.K)("span",{class:uL.noValueText},e.emptyValue))}_renderLocateWarning(){const{messages:e}=this;return(0,SI.K)("div",{key:"esri-search__locate-error"},(0,SI.K)("span",{"aria-hidden":"true",class:zN.T.noticeTriangle}),(0,SI.K)("span",{class:uL.noValueText},e.locateError))}_renderWarning(){const{displayedSearchTerm:e,_locateFailed:t}=this,{viewModel:r}=this;return t?this._renderLocateWarning():r.selectedSuggestion?.location||e?this._renderNoResultsWarning(e):this._renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(e,t){return`${this.id}-${e}${void 0===t?"":`-${t}`}`}_watchSourceChanges(){const{viewModel:{allSources:e}}=this,t="sources";this.removeHandles(t),e.forEach((e=>this.addHandles((0,gt.wB)((()=>e.name),(()=>this.scheduleRender())),t)))}_handleSourcesMenuToggleFocus(){"source"!==this.activeMenu&&this._clearActiveMenu()}_handleSourcesMenuToggleClick(){const e="source"===this.activeMenu;this.activeMenu=e?"none":"source",this.renderNow(),"source"===this.activeMenu&&this._sourceListNode?.focus()}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(e){const t=jN(e.currentTarget);t&&(this._focus(),this.search(t))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const e=new AbortController,{signal:t}=e;this._searchController=e,(async()=>{try{const e=await this.viewModel.searchNearby({signal:t});this.activeMenu=e?.numResults?"none":"warning"}catch(e){this._locateFailed=!0,this.activeMenu="warning"}finally{this._searchController=null}})()}_handleSourceClick(e){this._setSourceFromMenuItem(e.currentTarget)}_setSourceFromMenuItem(e){if(!e)return;const t=function(e){return e?.["data-source-index"]}(e);null!=t&&(this.viewModel.activeSourceIndex=t,this._clearActiveMenu(),this._sourceMenuButtonNode?.focus())}_cancelSuggest(){this._suggestController=(0,Je.DC)(this._suggestController)}_cancelSearch(){this._searchController=(0,Je.DC)(this._searchController),this._locateFailed=!1}_handleInputKeyup(e){const{key:t}=e;if(e.ctrlKey||e.metaKey||"Copy"===t||"ArrowLeft"===t||"ArrowRight"===t||"Shift"===t)return;if("Tab"===t||"Escape"===t||e.shiftKey&&"Tab"===t)return this._cancelSuggest(),void("Escape"===t&&this._clearActiveMenu());const r="Home"===t||"End"===t||"ArrowUp"===t||"ArrowDown"===t;if("Enter"===t&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const i=this._suggestionListNode?.getElementsByTagName("li");if(i?.length){if("suggestion"!==this.activeMenu&&this._openSuggestionMenu(),r)return e.preventDefault(),this._cancelSuggest(),void this._handleItemNavigation(t,i,this._suggestionListNode);const n=i[this._activeMenuItemIndex];if("Enter"===t&&n){const e=jN(n);return void(e?(this._focus(),this.search(e)):function(e){return!!e?.["data-current-location-item"]}(n)&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}_handleItemNavigation(e,t,r){const i=this._activeMenuItemIndex;"Home"===e&&(this._activeMenuItemIndex=0),"End"===e&&(this._activeMenuItemIndex=t.length-1),"ArrowUp"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?t.length-1:this._activeMenuItemIndex-1),"ArrowDown"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex===t.length-1?0:this._activeMenuItemIndex+1),i!==this._activeMenuItemIndex&&r&&(0,rI.yH)(t[this._activeMenuItemIndex],r)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_openSuggestionMenu(){this.activeMenu="suggestion"}_handleInputPaste(e){const t=e.target;this.viewModel.searchTerm!==t.value&&(this.viewModel.searchTerm=t.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(e){const{key:t}=e;if((0,rI.OU)(t)){e.preventDefault();const t=this._sourceListNode?.getElementsByTagName("li"),r=t?.[this._activeMenuItemIndex];this._setSourceFromMenuItem(r)}else"ArrowUp"!==t&&"ArrowDown"!==t&&"End"!==t&&"Home"!==t||e.preventDefault()}_handleSourceMenuKeyup(e){const{key:t}=e,r="ArrowUp"===t||"ArrowDown"===t||"End"===t||"Home"===t;if(r&&e.preventDefault(),"Escape"===t)return this._clearActiveMenu(),void this._sourceMenuButtonNode?.focus();const i=this._sourceListNode?.getElementsByTagName("li");return i&&0!==i.length&&r?("source"!==this.activeMenu&&(this.activeMenu="source"),void this._handleItemNavigation(t,i,this._sourceListNode?.parentElement)):void 0}_focus(e){this.focus(),e&&(this.activeMenu=e)}_formSubmit(e){e.preventDefault(),-1===this._activeMenuItemIndex&&this.search()}_getSourceName(e){const{messages:t}=this,r=this.viewModel,{allSources:i}=r,n=i.at(e);return e===DN.ALL_INDEX?t.all:n&&n.name||t.untitledSource}_getSuggestResultHTML(e,t){return e?VN.test(e)?e:((e,t)=>{const r=(0,lL.Cj)(t).split(/\s/),i=new RegExp(`(${r.join("|")})`,"gi");return e.replace(i,(e=>`<strong>${e}</strong>`))})(e,t):this.messages.untitledResult}_renderSearchResultsContent(){return this._searchResultRenderer.showMoreResultsOpen=!1,this._searchResultRenderer.viewModel=this.viewModel,this._searchResultRenderer}};function jN(e){return e?.["data-suggestion"]}(0,ze._)([(0,Qe.MZ)()],BN.prototype,"_activeMenuItemIndex",void 0),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"displayedSearchTerm",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],BN.prototype,"inputId",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],BN.prototype,"suggestionsMenuId",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],BN.prototype,"sourceMenuId",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],BN.prototype,"sourceMenuButtonId",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"activeMenu",void 0),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],BN.prototype,"activeSource",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"activeSourceIndex",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"allPlaceholder",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],BN.prototype,"allSources",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"autoNavigate",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"autoSelect",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],BN.prototype,"defaultSources",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"disabled",void 0),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"goToOverride",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"icon",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"includeDefaultSources",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"label",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"locationEnabled",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"maxResults",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"maxSuggestions",null),(0,ze._)([(0,Qe.MZ)(),(0,xI.G)("esri/widgets/Search/t9n/Search")],BN.prototype,"messages",void 0),(0,ze._)([(0,Qe.MZ)(),(0,xI.G)("esri/t9n/common")],BN.prototype,"messagesCommon",void 0),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"minSuggestCharacters",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"popupEnabled",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"popupTemplate",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"portal",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"resultGraphic",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"resultGraphicEnabled",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],BN.prototype,"results",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"searchAllEnabled",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"searchTerm",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],BN.prototype,"selectedResult",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"sources",null),(0,ze._)([(0,Qe.MZ)({readOnly:!0})],BN.prototype,"suggestions",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"suggestionsEnabled",null),(0,ze._)([(0,Qe.MZ)()],BN.prototype,"view",null),(0,ze._)([(0,UN.U)(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),(0,Qe.MZ)({type:DN})],BN.prototype,"viewModel",void 0),BN=(0,ze._)([(0,tt.$)("esri.widgets.Search")],BN);const HN=function(){return(0,Ee.jsxs)(xe,{children:[(0,Ee.jsx)(Re,{}),(0,Ee.jsxs)(fe,{children:[(0,Ee.jsx)(de,{path:"/",element:(0,Ee.jsx)(Fe,{})}),(0,Ee.jsx)(de,{path:"/about",element:(0,Ee.jsx)(Ne,{})}),(0,Ee.jsx)(de,{path:"/contact",element:(0,Ee.jsx)(De,{})})]})]})},GN=e=>{e&&e instanceof Function&&r.e(6453).then(r.bind(r,46453)).then((t=>{let{getCLS:r,getFID:i,getFCP:n,getLCP:s,getTTFB:o}=t;r(e),i(e),n(e),s(e),o(e)}))};n.createRoot(document.getElementById("root")).render((0,Ee.jsx)(t.StrictMode,{children:(0,Ee.jsx)(HN,{})})),GN()})()})();
//# sourceMappingURL=main.ff9acb59.js.map